*******
Disimpy
*******

Disimpy is a Python package for generating simulated diffusion-weighted MR
signals that can be useful in the development and validation of data
acquisition and analysis methods. The data is generated by Monte Carlo random
walk simulations that run in massively parallel on Nvidia CUDA-capable GPUs. If
you use Disimpy in work that leads to a scientific publication, please cite
[1]_, where the details about signal generation can also be found.

Requirements and installation
#############################

Follow the `installation instructions
<https://disimpy.readthedocs.io/en/latest/installation.html>`_.
    
Usage example
#############

Read the `tutorial <https://disimpy.readthedocs.io/en/latest/tutorial.html>`_
to learn how to use Disimpy.

Validation
##########

Disimpy's functionality has been validated by comparing its results to
analytical solutions and to results from other simulators (e.g., `Camino
<http://camino.cs.ucl.ac.uk/>`_ and `MISST
<http://mig.cs.ucl.ac.uk/index.php?n=Tutorial.MISST>`_), and by automated
testing (:code:`disimpy.tests`). Examples of simulations used for validation
are provided `here
<https://disimpy.readthedocs.io/en/latest/validation.html>`_. However, Disimpy
is research software and some bugs undoubtedly remain. If you find any of them
or encounter unexpected behaviour, please open an `issue on GitHub
<https://github.com/kerkelae/disimpy/issues>`_.

Contribute
##########

If you want to contribute to the development of Disimpy, start by reading the
`contributing guidelines
<https://disimpy.readthedocs.io/en/latest/contributing.html>`_.

Support
#######

If you have questions or need help, open an `issue on Github
<https://github.com/kerkelae/disimpy/issues>`_.

References
##########

.. [1] Kerkel√§ et al., (2020). Disimpy: A massively parallel Monte Carlo
       simulator for generating diffusion-weighted MRI data in Python. Journal
       of Open Source Software, 5(52), 2527.
       https://doi.org/10.21105/joss.02527
************
Contributing
************

Contributions to Disimpy are warmly welcomed.

If you want to discuss ideas before writing code, please open an `issue on
GitHub <https://github.com/kerkelae/disimpy/issues>`_ and we'll discuss how to
continue. GitHub issues are also a great way to inform the developers about
any bugs or problems you may encounter.

Development workflow
####################

If you already have a well-defined idea or want to make small changes (fix
typos, improve documentation, etc.), please follow the steps below:

1. Fork the `repository on GitHub <https://github.com/kerkelae/disimpy/>`_.
2. Clone your fork:
    
    .. code-block::

        git clone git@github.com:YOUR-USERNAME/disimpy.git

3. Configure Git to sync your fork with the main repo:

    .. code-block::
       
        git remote add upstream https://github.com/kerkelae/disimpy.git

4. Create a branch with a name that describes your contribution:

    .. code-block::
        
        git checkout -b BRANCH-NAME

5. Write code, commit changes, and push to your fork on GitHub.

6. Open a pull request `on GitHub <https://github.com/kerkelae/disimpy/>`_.

GitHub docs provide more information on `forking a repository
<https://docs.github.com/en/get-started/quickstart/fork-a-repo>`_ and `creating
pull requests
<https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/
proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request-from-
a-fork>`_.

Code style
##########

All code should be formatted with `Black <https://github.com/psf/black>`_ using
the default settings and documented following the `Numpy docstring conventions
<https://numpydoc.readthedocs.io/en/latest/format.html>`_ (except trivial
internal functions).

Tests
#####

It is important to make sure that your changes have not broken
anything by running all tests:

.. code-block:: python

   import disimpy.tests
   disimpy.tests.test_all()

Documentation
#############

If you make changes to the documentation, you should build it locally to
confirm that it works as expected by executing the following in
``disimpy/docs``:

.. code-block::

    make clean
    make html

This will generate a local copy of the documentation in
``disimpy/docs/_build/html``. Once the changes are merged with the master
branch, the online documentation is automatically updated. Generating the
documentation locally requires `sphinx <https://www.sphinx-doc.org/>`_ and
`nbsphinx <https://nbsphinx.readthedocs.io/>`_ that can be installed with pip: 

.. code-block::

    pip install sphinx nbpshinx
*********************
Modules and functions
*********************


disimpy.gradients
#################

.. automodule:: disimpy.gradients
    :members:

disimpy.simulations
###################

.. automodule:: disimpy.simulations
    :members:

disimpy.substrates
##################

.. automodule:: disimpy.substrates
    :members:

disimpy.utils
#############

.. automodule:: disimpy.utils
    :members:
************
Installation
************

Hardware requirements
#####################

You need an Nvidia CUDA-capable GPU with compute capability 2.0 or above with
the appropriate Nvidia driver. You can check if your GPU is supported on
`Nvidia's website <https://developer.nvidia.com/cuda-gpus>`_.

Software requirements
#####################

You need the CUDA Toolkit version 8.0 or above which can be installed from
`Nvidia <https://developer.nvidia.com/cuda-toolkit>`_ or using Conda as
described in `Numba's documentation 
<https://numba.pydata.org/numba-doc/dev/cuda/overview.html#software>`_. Make
sure that the version you install supports your Nvidia driver or upgrade the
driver. The driver requirements of each CUDA Toolkit version can be found in
the `release notes <https://developer.nvidia.com/cuda-toolkit-archive>`_.
If you use the CUDA Toolkit not installed by Conda and encounter issues, check
that the `installation path is configured so that Numba can access it
<https://numba.pydata.org/numba-doc/dev/cuda/overview.html#setting-cuda-installation-path>`_.

In addition, you need the following Python packages:

- ``matplotlib``
- ``numba``
- ``numpy``
- ``pytest``
- ``scipy``

These are automatically installed by pip if you follow the installation
instructions below.

Installation
############

To avoid possible dependency issues, it is recommended to install Disimpy in a
virtual environment.

The most recent release can be installed with pip: 

.. code-block::

    pip install disimpy

The latest code in the master branch with the most recent updates can be
installed with pip: 

.. code-block::

    pip install git+https://github.com/kerkelae/disimpy.git



Alternatively, given that the requirements are met, you can use Disimpy without
installing by downloading the latest code `here
<https://github.com/kerkelae/disimpy/archive/master.zip>`_ and directly
importing the functions you want to use from the downloaded modules.

Automated tests
###############

To confirm that the installed simulator works, you should run the automated
tests by executing the following in the Python interpreter:

.. code-block:: python

   import disimpy.tests
   disimpy.tests.test_all()
.. include:: ../../README.rst

.. toctree::
   :hidden:
   :maxdepth: 2

   installation
   tutorial
   modules_and_functions
   contributing
   validation
   View on GitHub <https://github.com/kerkelae/disimpy>
