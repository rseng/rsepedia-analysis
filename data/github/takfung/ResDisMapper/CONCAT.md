# ResDisMapper
Resistance to Dispersal Mapper 

## Installation

```R
devtools::install_github("qt37t247/ResDisMapper")
```

## How to cite

Qian, T., Fung, T., Rheindt, F.E. (2020). ResDisMapper: An R package for fine-scale mapping of resistance
to dispersal. Molecular Ecology Resources 20(3) 819-831. https://doi.org/10.1111/1755-0998.13127

## Contact author

tangqiannus@gmail.com
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rdm_IBD_v7_TF.R
\name{rdm_IBD}
\alias{rdm_IBD}
\title{Calculates Isolation by Distance (IBD) residuals for each pair of individuals in a population}
\usage{
rdm_IBD(Gen_raw, Geo_raw, Dist_method = 1, IBD_method = 1)
}
\arguments{
\item{Gen_raw}{A string specifying the path to a file of genotype data in GENEPOP format, with alleles specified
using three digits. The GENEPOP file must have the extension \emph{.gen}.}

\item{Geo_raw}{A string specifying the path to a text file showing the name (1st column) and geographical x and y 
coordinates (2nd and 3rd columns) of each individual (each row). The first row needs to specify the column headings, 
and all entries need to be tab-delimited.}

\item{Dist_method}{An integer from 1 to 6 specifying the method used to calculate genetic distance among individuals. 
Integers 1 to 6 correspond to the methods incorporated into the following six functions from the
\code{poppr} R package, respectively: \code{diss.dist}, \code{nei.dist}, \code{rogers.dist}, \code{reynolds.dist},
\code{edwards.dist}, and \code{provesti.dist}. The default value is 1.}

\item{IBD_method}{An integer specifying the method used to calculate the IBD residual for each pair of individuals. 
A value of 1 means that the residuals are calculated by fitting a straight line to all pairs of genetic and 
geographic distances, and measuring the vertical distance from each pair to the fitted line. The fitted straight line 
represents the combinations of genetic and geographic distances that are expected from IBD. A value of 2 means
that a non-linear curve of the form \emph{y = a + b*}(1\emph{-}exp(\emph{-}exp(\emph{c})\emph{*x})) is fitted instead of a straight 
line, where \emph{a}, \emph{b} and \emph{c} are the fitted parameters. The default value is 1. The function 
\code{rdm_IBD} automatically plots the data points together with the fitted line or curve.}
}
\value{
An object of class \code{dist}, containing a matrix showing the IBD residuals for pairs of individuals.
}
\description{
\code{rdm_IBD}: Reads genotype data for individuals in a population together with the geographic 
coordinates of the individuals, models overall IBD trend for the population, and then calculates IBD residuals for each pair of individuals.
}
\examples{
rdm_IBD("files/genotypes.gen", "files/coordinates.txt")
}
\name{ResDisMapper-package}
\alias{ResDisMapper-package}
\alias{ResDisMapper}
\docType{package}
\title{
\packageTitle{ResDisMapper}
}
\description{
The Resistance to Dispersal Mapper (ResDisMapper) package provides functions to calculate and map environmental resistance to dispersal over a landscape, for a population of individuals. Firstly, there is a function called \code{rdm_IBD}, which reads in the geographic coordinates and genetic data for the individuals and computes the geographic and genetic distance between each pair of individuals. This function compares the geographic and genetic distance for each pair of individuals to expected values in the case of Isolation by distance (IBD), and calculates the corresponding residuals. Secondly, there is a function \code{rdm_residual}, which takes the residuals and visualizes them using a 3-D plot, and outputs the residuals together with line segments representing pairs of individuals over the landscape. Thirdly, there is a function \code{rdm_resistance}, which uses the residuals and line segments to calculate the environmental resistance to dispersal over the landscape. Lastly, the function \code{rdm_mapper} visualizes the resistance values using a raster map, with contour lines indicating areas of high and low resistance.
}
\author{
\packageAuthor{ResDisMapper}

Maintainer: \packageMaintainer{ResDisMapper}
}
\references{
Tang, Q., Fung, T., Rheindt, F.E. (2020). ResDisMapper: An R package for fine-scale mapping of resistance to dispersal. Molecular Ecology Resources 20 (3), 819-831 https://doi.org/10.1111/1755-0998.13127
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rdm_resistance_v8_TF_TQ.R
\name{rdm_resistance}
\alias{rdm_resistance}
\title{Produces environmental resistance to dispersal over a landscape, for individuals in a population}
\usage{
rdm_resistance(IBD.res, Res_SLDF, nrows = 30, ncols = 30,
  conf_intervals = 0.95, random_rep = 1000,
  outputfile = "resistance_map.csv")
}
\arguments{
\item{IBD.res}{An object of class \code{dist}, containing a matrix with the IBD residuals for pairs of 
individuals in a population.}

\item{Res_SLDF}{An object of class \code{SpatialLinesDataFrame}, containing the IBD residuals for each pair of 
individuals in a population and the coordinates of line segments connecting the pairs of individuals over the 
defined landscape. This object is produced by the function \code{rdm_residual}.}

\item{nrows}{Number of grid cells in each row of the raster map of resistance. The default value is 30.}

\item{ncols}{Number of grid cells in each column of the raster map of resistance. The default value is 30.}

\item{conf_intervals}{The coverage of the confidence interval generated for each resistance value in a grid cell, 
expressed as a proportion. This interval measures the uncertainty in the (observed) resistance in each cell. 
If a cell has no intersecting line segments or only one, then a confidence interval cannot be calculated and the cell
is no longer considered for further calculation. If the confidence interval does not overlap 0, then the resistance 
is statistically different from 0. The default value is 0.95 (corresponding to 95\% intervals).}

\item{random_rep}{Number of random resamples of the IBD residuals used to construct the null distribution of 
resistances in each grid cell. For a grid cell with \emph{n} intersecting line segments and \emph{n} corresponding IBD residuals,
a random resample consists of randomly sampling \emph{n} IBD residuals from the set of all IBD residuals over the entire
landscape, without replacement. If the observed resistance is above a threshold percentile of the null
distribution, then the cell is considered to have a high resistance that is statistically significant. If instead the observed 
resistance is below another threshold percentile of the null distribution, then the cell is considered to have a low resistance 
that is statistically significant. The default value is 1,000.}

\item{outputfile}{Name of the .csv file that is produced, containing resistance information in the output data frame. 
The default is 'resistance_map.csv'.}
}
\value{
A data frame with resistance information for each grid cell in the landscape with more than one 
 intersecting line segment. Each row corresponds to one cell, and the eight different columns refer to the 
 resistance, the number of intersecting line segments, the x and y coordinates specifying the location of the mid-point of the cell, 
 the lower and upper limits of the confidence interval for the resistance, the sign of the product of the lower and upper 
 limits of the confidence interval, and the percentile of the null distribution of resistances corresponding 
 to the observed resistance. When calculating this data, the function \code{rdm_resistance} prints out messages
 showing the current stage of calculation. There are four stages: Calculating (1) the resistances, (2) the
 numbers of intersecting line segments, (3) the lower limits of the confidence intervals for the resistances,
 and (4) the upper limits of the confidence intervals for the resistances.
}
\description{
\code{rdm_resistance}: Reads in IBD residuals for pairs of individuals in a population, represented
 as line segments connecting the pairs of individuals over a defined landscape, and then applies a novel method 
 (Tang et al., in review) to the residuals to calculate environmental resistance to dispersal over the landscape. 
 Essentially, the method splits the landscape into a grid of cells and for each cell, calculates the 
 resistance as the average of the IBD residuals of all line segments that intersect the cell.
}
\examples{
IBD_res <- rdm_IBD("files/genotypes.gen", "files/coordinates.txt")
Res_SLDF <- rdm_residuals(IBD_res, "files/coordinates.txt")
rdm_resistance(IBD_res, Res_SLDF)
}
\references{
Tang, Q., Fung, T., Rheindt, F.E. (In review). ResDisMapper: An R package for fine-scale mapping of resistance to dispersal.
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rdm_residual_v10_TF_TQ.R
\name{rdm_residual}
\alias{rdm_residual}
\title{Creates and plots IBD residuals for pairs of individuals in a population, represented as line segments over a 
 defined landscape}
\usage{
rdm_residual(IBD.res, Geo_raw, min.dist = 1, max.dist = Inf,
  n_resolution = 50, proj = sp::CRS("+init=epsg:4326"))
}
\arguments{
\item{IBD.res}{An object of class \code{dist}, containing a matrix with the IBD residuals for pairs of 
individuals in a population.}

\item{Geo_raw}{A string specifying the path to a text file showing the name (1st column) and geographical x and y 
coordinates (2nd and 3rd columns) of each individual (each row). The first row needs to specify the column headings, 
and all entries need to be tab-delimited.}

\item{min.dist}{IBD residuals are only calculated for pairs of individuals that are separated by a distance greater
than \code{min.dist}. The default value is 1.}

\item{max.dist}{IBD residuals are only calculated for pairs of individuals that are separated by a distance less
than \code{max.dist}. The default value is Inf.}

\item{n_resolution}{Specifies the number of cells that the landscape is divided into, for the purposes of creating
the 3-D plot. The landscape is divided into \code{n_resolution} cells along both coordinate axes. Individuals that
appear in the same cell are represented by a single point on the plot. The default value is 50.}

\item{proj}{The coordinate system that is used for plotting. The default is EPSG 4326.}
}
\value{
An object of class \code{SpatialLinesDataFrame}, containing coordinates of the line segments joining each 
 pair of individuals and the corresponding IBD residuals.
}
\description{
\code{rdm_residual}: Reads the IBD residuals for each pair of individuals in a population (as calculated 
 by function \code{rdm_IBD}) together with their geographic coordinates, and then creates a 
 3-D graph showing the residuals for each pair of individuals, represented as a line segment over the
 landscape considered. The 3-D graph can be rotated to obtain a better view.
}
\examples{
IBD_res <- rdm_IBD("files/genotypes.gen", "files/coordinates.txt")
rdm_residual(IBD_res, "files/coordinates.txt")
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rdm_mapper_v10.r
\name{rdm_mapper}
\alias{rdm_mapper}
\title{Visualizes the resistance to dispersal over a landscape, for individuals in a population}
\usage{
rdm_mapper(
  F.df,
  Geo_raw,
  p_signf = 0.05,
  p_size = 2,
  p_col = "yellow",
  disp_all_cells = 0,
  disp_contours = 1
)
}
\arguments{
\item{F.df}{A data frame containing eight columns with resistance information for each grid cell in a landscape. 
Each row corresponds to one cell, and the eight different columns refer to the resistance, the number of 
intersecting line segments (lines connecting pairs of individuals in the landscape), the x and y coordinates specifying 
the location of the mid-point of the cell, the lower and upper limits of the confidence interval for the resistance, the 
sign of the product of the upper and lower limits of the confidence interval, and the percentile of the null distribution of resistances 
corresponding to the observed resistance. A .csv file with this information is produced by the function
\code{rdm_resistance}.}

\item{Geo_raw}{A string specifying the path to a text file showing the name (1st column) and geographical x and y 
coordinates (2nd and 3rd columns) of each individual (each row). The first row needs to specify the column headings, 
and all entries need to be tab-delimited.}

\item{p_signf}{Specifies the percentiles of the null distribution of resistances used to define areas of high and low
resistance that are statistically significant. In a grid cell, a resistance value that is above the 100*(\code{1-p_signf})\% percentile 
is considered to be a high resistance that is statistically significant, whereas a resistance value that is below the 
100*(\code{p_signf})\% percentile is considered to be a low resistance that is statistically significant. Default value of 0.05.}

\item{p_size}{Specifies the size of the sampling points in the plotted raster map of resistances. Default value of 2.}

\item{p_col}{Specifies the color of the sampling points in the plotted raster map of resistances. Default color is yellow.}

\item{disp_all_cells}{Specifies whether to display all cells (1) or just cells with resistances that are statistically 
different from zero (0). For a further description of the meaning of resistances that are statistically different from zero, 
please refer to the description of the function \code{rdm_resistance}. Default value of 0.}

\item{disp_contours}{Specifies whether to display red and green contour lines that delineate areas with statistically significant high and low
resistance values respectively (1), or not (0). For a further description of the meaning of a statistically significant high or low resistance value, 
please refer to the description of the function \code{rdm_resistance}. Default value of 1.}
}
\value{
Function plots a map of resistance, but does not return an output object.
}
\description{
\code{rdm_mapper}: Reads in the resistance to dispersal for individuals of a population, over
 a grid of cells defining the landscape containing the individuals, and then creates a raster map of resistance.
}
\examples{
F.df <- read.csv("files/resistance_map.csv") 
rdm_mapper(F.df, "files/coordinates.txt")
}
