get support openmm two main venu get support openmm discuss forumhttpssimtkorgforumsviewforumphpf github repositoryhttpsgithubcomopenmmopenmm overlap two gener speak forum user orient issu repositori develop orient issu question use openmm includ write program access public api post forum want suggest chang code think found bug open issu github core develop monitor dont worri arent sure one appropri question see either way also may want consult documentationhttpdocsopenmmorg quit thorough may abl find answer question contribut openmm develop welcom anyon want contribut project whether ad featur fix bug improv document process quit simpl first alway best begin open issu github describ chang want make give everyon chanc discuss put lot work bug fix confirm behavior actual bug propos fix correct new featur decid whether propos featur someth want discuss possibl design everyon agreement next step creat pull requesthttpshelpgithubcomenarticlesaboutpullrequest code chang larger featur feel free creat pull request even implementaton finish get earli feedback code put letter wip start titl pull request indic still work progress new featur consult new featur checklisthttpsgithubcomopenmmopenmmwikichecklistwhenaddinganewfeatur list variou item need includ featur merg document test serial support api etc everi item necessarili applic everi new featur usual least core develop review pull request may suggest chang simpli push chang branch pull automat ad pull request addit full test suit automat run everi pull request rerun everi time chang ad test pass everyon satisfi code pull request merg congratul succes contribut contributor coven code conduct pledg interest foster open welcom environ contributor maintain pledg make particip project commun harassmentfre experi everyon regardless age bodi size disabl ethnic gender ident express level experi nation person appear race religion sexual ident orient standard exampl behavior contribut creat posit environ includ use welcom inclus languag respect differ viewpoint experi grace accept construct critic focus best commun show empathi toward commun member exampl unaccept behavior particip includ use sexual languag imageri unwelcom sexual attent advanc troll insultingderogatori comment person polit attack public privat harass publish other privat inform physic electron address without explicit permiss conduct could reason consid inappropri profession set respons project maintain respons clarifi standard accept behavior expect take appropri fair correct action respons instanc unaccept behavior project maintain right respons remov edit reject comment commit code wiki edit issu contribut align code conduct ban temporarili perman contributor behavior deem inappropri threaten offens harm moreov project maintain strive offer feedback advic ensur qualiti consist contribut code contribut outsid group project maintain strongli welcom final decis whether commit merg codebas rest team project maintain scope code conduct appli within project space public space individu repres project commun exampl repres project commun includ use offici project email address post via offici social media account act appoint repres onlin offlin event represent project may defin clarifi project maintain enforc instanc abus harass otherwis unaccept behavior may report contact project team peastmanstanfordedu project team review investig complaint respond way deem appropri circumst project team oblig maintain confidenti regard report incid detail specif enforc polici may post separ project maintain follow enforc code conduct good faith may face temporari perman repercuss determin member project leadership attribut code conduct adapt contributor covenanthomepag version avail httpcontributorcovenantorgversionvers homepag httpcontributorcovenantorg version httpcontributorcovenantorgvers gh action statushttpsgithubcomopenmmopenmmworkflowscibadgesvghttpsgithubcomopenmmopenmmactionsquerybranchamasterworkflowaci condahttpsimgshieldsiocondavcondaforgeopenmmsvghttpsanacondaorgcondaforgeopenmm anaconda cloud badgehttpsanacondaorgcondaforgeopenmmbadgesdownloadssvghttpsanacondaorgcondaforgeopenmm openmm high perform molecular dynam librari introduct openmmhttpopenmmorg toolkit molecular simul use either standalon applic run simul librari call code provid combin extrem flexibl custom forc integr open high perform especi recent gpu make truli uniqu among simul code get help need help check documentationhttpdocsopenmmorg discuss forumshttpssimtkorgforumsviewforumphpf author jaim rodr√≠guezguerra chodera lab decemb continu integr setup openmm describ c librari wrapper avail differ program languag python c fortran heavi lift perform backend platform base cpu cuda andor opencl possibl futur support differ oper system architectur result ci setup get bit involv document tri clarifi work support implement overview openmm ci run mainli github action one separ jenkin box run gpu test gener provid jason swail build matrix cover oper system architectur linux x maco intel window linux ppcle powerpc linux aarch arm python cpython cuda version linux x linux ppcle window opencl implement nvidia test along cuda amd sysroot c compil linux system gcc whatev condaforg pin gcc write maco system target sdk window vs describ pipelin clarifi concept idiosyncrasi github action configur file live githubworkflowsciyml directori host one yml _workflow_ describ set event trigger run workflow specifi set trigger key list job run run ci workflow push master pull request target master nightli current workflow contain four job unix window docker doc job run sever time depend configur jobsstrategymatrix job replica run parallel individu action summaryhttpsgithubcomopenmmopenmmactionsrun overview help visual within job find step step either run script shell use github action perform task exampl clone repo set miniconda independ github _actions_ recogn contain keyword use run cmake shell step use run note step run new shell session environ variabl wont surviv across step unless add github_env file echo variablevalu github_env also use step output that involv rare need note due design condaincubatorsetupminiconda subsequ step reli conda environ requir us specifi osdepend custom shell rememb need add step job step run skip base condit express insid key control whether need instal cuda exampl job check need step defin environ variabl env key avail step job avail step detail per oper system differ implement similar linux x explain one detail rest comment relev differ linux x part unix pipelin run ubuntulatest provid github action use condaincubatorsetupminiconda setup bundl miniconda instal conda environ avail provid build test depend cmake swig adequ python version etc environ file locat devtoolscighactionscondaenv per oper system depend matrix configur also instal cuda andor amd opencl condit step evalu use gha builtin mechan ideal would instal within conda environ sometim avail licens issu etc deleg system packag vendor instal cuda check whether cudavers empti pass devtoolscighactionsscriptsinstall_cudash environ variabl opencl check whether opencl true run devtoolscighactionsscriptsinstall_amd_openclsh reli instal locat bucket could refactor instal differ opencl implement rocm intel etc matrix entri requir us instal conda forg compil use instead system present need configur download ccach content key built matrix name yyyyddmmhhmmss timestamp secret cache_vers also includ one bump cach modifi secret repositori set configur done environ variabl defin begin job key jobsunixenv cmake final invok target conda environ destin conda_prefix addit flag pass matrix configur enabl disabl featur per matrix entri ccach perform assess build c librari python wrapper separ way visual check part fail easili test also run separ reason whether python built andor test check content cmake_flag maco intel part unix pipelin run macoslatest use condaincubatorsetupminiconda point relev environ file neither cuda opencl instal script run instead download instal sdk use devtoolscighactionsscriptsinstall_macos_sdksh done mimic conda forg feedstock check script comment info everyth els window sole member window pipelin run windowslatest use condaincubatorsetupminiconda point relev environ file instal cuda nvidia instal use devtoolscighactionsscriptsinstall_cudabat requir environ variabl cuda_vers export correspond matrix entri run matrixcudavers empti everyth els powerpc arm part docker pipelin run docker imag top ubuntulatest docker imag depend architectur chosen ppcle aarch cuda version want provid conda forg conda preinstal readi go sinc differ architectur need configur qemu first done automat docker imag mimick conda forg start docker imag work directori github_workspac mount readwrit permiss homecondaworkspac commun back host use file also use ccach docker imag run devtoolscighactionsscriptsrun_steps_inside_docker_imagesh script mostli saw linux x differ dont need instal cuda setup miniconda preinstal docker imag patch depend environ file avail architectur save one conda environ solv also patch python version environ file imag dont come system compil specifi one matrix configur compil contain valu start devtoolset understand want cento devtools far specifi devtoolset compil thing understand that spacesepar seri conda packag sinc conda forg provid metapackag name compil instal current platform use one that entri compil compil entri everyth els run usual note whole docker run singl github action step visual appeal tri best group command group syntax easier follow script run success creat empti file test exist docker run make sure note sinc use softwar emul realli slow still run success within h gha provid gha upgrad better ci machin hardwar base virtual might abl run closeton perform doc linuxx pipelin optim build document provid separ entri didnt want overcompl logic unix pipelin essenti use differ environ file setupminiconda build doc depend test exampl contain deploy step copi content bucket _only_ run master ignor cron job requir secret must defin repositori set follow exact key name copi past valu github encrypt mask aws_s_bucket aws_access_key_id aws_secret_access_key also check dead link use node packag run _after_ deploy wont prevent still signal job fail doc contain broken link shortcom limit compar ci servic guess list shorter time cach invalid directli instead includ secret cache_vers part cach key chang valu secret function prevent access previou cach also expir everi day note sinc trick use secret valu cache_vers mask log output result make sure use someth short meaningless difficult find wild eg pqgbhl instead there ci skip function yet extra content debug powerpc arm local root repositori run follow script variabl might want edit ppc vs arm python version etc take look script first case bash bash devtoolscighactionsstart_docker_locallysh insid docker imag moment repo root mount homecondaworkspac run script reproduc ci step exactli sourc script sinc failur exit docker altogeth alway use new bash process avoid start scratch bash bash homecondaworkspacedevtoolscighactionsscriptsrun_steps_inside_docker_imagesh conda forg releas openmm final releas creat new version tag openmmopenmm publish new github releas conda forg bot would auto submit pr new version within coupl hour _if_ use sourceurl field point gh releas sinc build full repo sure autom work need switch manual mode havent yet fork condaforgeopenmmfeedstock condaforgeopenmmfeedstock fork creat new branch recent upstream branch master rc edit metayaml updat packagevers reset buildnumb make sure sourcegit_rev point releas tag want publish could git commit tag prefer commit push fork push upstream open new pr condaforgeopenmmfeedstock make sure target condaforgeopenmmfeedstock master fork review checklist open pr open pr post comment condaforgeadmin pleas rerend wait green review merg alway make sure merg master merg check ci statu master branch green red network error might happen need _rerun_ fail job link appear next click detail menu ci provid trigger whatev reason master might need littl _push_ pun intend empti commit master make sure condaforgeopenmmfeedstock configur upstream git remot v git checkout master git fetch upstream master git merg upstreammast git commit allowempti trigger ci git push upstream master releas candid technic publish rc tag github releas bot pick havent test yet manual instruct havent yet fork condaforgeopenmmfeedstock creat new branch recent upstream branch master rc edit metayaml updat packagevers new version number plu rcx x number check cfephttpsgithubcomcondaforgecfepblobmastercfepmd case doubt reset buildnumb make sure sourcegit_rev point releas tag want publish could git commit tag prefer edit conda_build_configyaml key differ rc releas publish differ label channel_target set condaforg openmm_rc yaml channel_target condaforg openmm_rc commit push fork push upstream open new pr condaforgeopenmmfeedstock make sure target condaforgeopenmmfeedstock rc fork target rc branch master key differ rc candid stay rc review checklist open pr open pr post comment condaforgeadmin pleas rerend wait green review merg alway make sure merg rc merg check ci statu rc branch green red network error might happen need _rerun_ fail job link appear next click detail menu ci provid trigger whatev reason rc might need littl _push_ pun intend empti commit rc make sure condaforgeopenmmfeedstock configur upstream git remot v git checkout rc git fetch upstream rc git merg upstreamrc git commit allowempti trigger ci git push upstream rc packag openmm zip instal set environ variabl tag git tag releas bash openmm export tagcaaa sourc start docker contain bash docker run rm e tag v pwdio jchoderaomniabuildboxcudaamdclang bash patch docker contain miss latex file tlmgr instal fncychap tabulari captof eqparbox environ trimspac build instal insid docker contain bash clone openmm beta releas candid tag tag git clone httpsgithubcompandegroupopenmmgit cd openmm git checkout tag cd build packag sourc openmmdevtoolspackagingscriptssourcepreparesh sourc openmmdevtoolspackagingscriptssourcebuildsh sourc openmmdevtoolspackagingscriptssourcepackagesh recov packag host directori cp packagingcompress io linux start docker contain bash docker run rm e tag v pwdio jchoderaomniabuildboxcudaamdclang bash patch docker contain miss latex file tlmgr instal fncychap tabulari captof eqparbox environ trimspac build instal insid docker contain bash clone openmm beta releas candid tag tag git clone httpsgithubcompandegroupopenmmgit cd openmm git checkout tag cd build packag sourc openmmdevtoolspackagingscriptslinuxpreparesh sourc openmmdevtoolspackagingscriptslinuxbuildsh sourc openmmdevtoolspackagingscriptslinuxpackagesh recov packag host directori cp packagingcompress io os x osx machin xcode os x framework instal bash clone openmm beta releas candid tag tag git clone httpsgithubcompandegroupopenmmgit cd openmm git checkout tag cd build packag sourc openmmdevtoolspackagingscriptsosxpreparesh sourc openmmdevtoolspackagingscriptsosxbuildsh sourc openmmdevtoolspackagingscriptsosxpackagesh manifest autom packag sourc binari distribut detail explan packag protocol found develop wiki httpsgithubcompandegroupopenmmwikipackagingopenmminstal content sourc directori file copi github repo sourc distribut binari directori file copi instal directori build binari distribut _theopenmmlibrari part ii openmm librari toctre number maxdepth library_introduct library_compil library_tutori library_platform_specif library_languages_not_cpp library_integration_exampl library_testing_valid library_amoeba_plugin library_rpmd_plugin library_drude_plugin defaultdomain py _theopenmmapplicationlay part openmm applic layer toctre number maxdepth application_getting_start application_running_sim application_model_building_edit application_advanced_sim_exampl application_creating_ff openmm user manual theori guid latex includ licenserst toctre number maxdepth introduct toctre maxdepth applic librari theori toctre number maxdepth zbibliographi html includ licenserst introduct openmm consist two part set librari let programm easili add molecular simul featur program applic layer expos featur end user want run simul guid divid three section refpart theopenmmapplicationlay describ applic layer relev user especi relev peopl want use openmm standalon applic run simul refpart ii theopenmmlibrari describ use openmm librari within applic primarili relev programm want write simul applic refpart iii thetheorybehindopenmm describ mathemat theori behind featur found openmm relev user onlin resourc find document materi websit httpopenmmorg among thing discuss forum wiki video lectur use openmm referenc openmm work use openmm cite follow public p eastman j swail j chodera r mcgibbon zhao k beauchamp lp wang c simmonett p harrigan c stern r p wiewiora b r brook v pand openmm rapid develop high perform algorithm molecular dynam plo comp biol e depend academ research grant fund openmm develop effort citat public help demonstr valu openmm acknowledg openmm softwar relat activ manual fund simbio nation center biomed comput nation institut health roadmap medic research grant u gm nation institut health grant rgm _thetheorybehindopenmm part iii theori behind openmm toctre number maxdepth theory_introduct theory_standard_forc theory_custom_forc theory_integr theory_other_featur html bibliographi bibliographi referencesbib style unsrt _ringpolymermoleculardynamicsplugin ring polym molecular dynam rpmd plugin ring polym molecular dynam rpmd provid effici approach includ nuclear quantum effect molecular simul citecraig use calcul static equilibrium properti rpmd reduc path integr molecular dynam give exact descript effect quantum fluctuat given potenti energi model citeparrinello dynam properti rpmd longer exact shown good approxim mani case system classic potenti energi e q rpmd hamiltonian given math hsum _knleftfracp_kmeq_kfracmk_btnhbarq_kq_kright hamiltonian resembl system classic ring polym differ copi system connect harmon spring henc copi classic system commonli refer bead spread ring polym repres particl directli relat de brogli thermal wavelength uncertainti posit rpmd calcul must converg respect number n bead use bead evolv effect temperatur nt temperatur properti requir number bead need converg calcul estim use citemarkland math nfrachbaromega_maxk_bt mathomega_max highest frequenc problem exampl flexibl liquid water highest frequenc oh stretch around cm sup around bead need depend accuraci requir rigid water highest frequenc around cm sup bead typic need due replic need classic system extra cost calcul compar classic simul increas linearli number bead use cost reduc contract ring polym smaller number bead citemarkland rapidli chang forc comput full number bead slower chang forc comput smaller set case flexibl water exampl common arrang would comput high frequenc bond forc bead direct space nonbond forc bead reciproc space nonbond forc singl bead due stiff spring term bead nve rpmd trajectori suffer ergod problem henc thermostat highli recommend especi dynam properti requir citehal thermostat implement path integr langevin equat pile approach citeceriotti method coupl optim white nois langevin thermostat normal mode polym leav one paramet chosen user control friction appli center mass ring polym good choic use valu similar use classic calcul system _examplesofopenmmintegr exampl openmm integr gromac gromac larg complex applic written primarili c consider involv adapt use openmm like similar face develop exist applic first principl follow adapt gromac keep openmmrel code isol file modifi littl exist gromac code possibl minim risk break exist part code make openmmrel part easi work possibl also minim need c code invok c api would issu use openmm c api wrapper less conveni c api place openmm call separ c file solv problem equal well nearli openmmspecif code contain singl file openmm_wrappercpp defin four function encapsul interact openmm rest gromac codeopenmm_init argument function take pointer lot intern gromac data structur describ simul run creat system integr context base return opaqu refer object contain refer input argument function defin openmm_wrappercpp allow inform pass function without expos rest gromac codeopenmm_take_one_step call codestep integr creat codeopenmm_init codeopenmm_copy_st call codegetst context creat codeopenmm_init copi inform result state variou gromac data structur function state data gener openmm pass back gromac output analysi etc codeopenmm_cleanup call end simul delet object creat codeopenmm_init set function defin interact gromac openmm copi inform applic openmm perform integr copi inform openmm back applic free resourc end simul detail implement specif gromac overal pattern fairli gener similar set function use mani applic well tinkeropenmm tinker written primarili fortran use common block extens store applicationwid paramet rather modifi tinker build script allow c code decid use openmm c api instead despit differ overal approach use add openmm support similar use gromac tinkeropenmm allow openmm use calcul forc energi perform integr main molecular dynam loop chang tinker sourc code file codedynamicf setup run simul ad file codedynamic_openmmc contain interfac c code tinker openmm flow molecular dynam simul use openmm follow tinker code use read amoeba paramet file codexyz codekey file pars commandlin option routin codemap_common_blocks_to_c_data_struct call map fortran common block c data structur use set paramet use openmm routin codeopenmm_valid call codedynamicf main loop routin check requir option set obtain input step common block step avail option set unsupport program exit appropri messag routin codeopenmm_valid openmm interfac method file codedynamic_openmmc codeopenmm_init call creat openmm system integr context object codeopenmm_take_step call take specifi number time step codeopenmm_upd call retriev state energiespositionsveloc popul appropri tinker data structur valu convert openmm unit kjnm kcal√• popul tinker array main loop complet routin codeopenmm_cleanup call delet openmm object releas resourc use gpu _usingopenmmwithsoftwarewritteninlanguagesotherthanc use openmm softwar written languag c although nativ openmm api objectori c code possibl directli translat interfac callabl c fortran python substanti conceptu chang develop straightforward map languag perhap eleg possibl sever advantag almost document train forum discuss equal use user languag syntact differ cours import concept remain unchang abl gener c fortran python api c api obvious reduc develop effort importantli mean api like errorfre alway avail immedi nativ api updat openmm perform expens oper bulk notic overhead access oper c fortran python api symbol introduc c fortran program begin prefix codeopenmm_ interfer symbol alreadi use avail api languag necessari c fortran bind built main openmm librari separ librari requir python wrapper contain modul distribut openmm instal execut setuppi script standard way doesnt appli user build openmm sourc use cmake want api bind gener sure enabl codeopenmm_build_c_and_fortran_wrapp option c fortran codeopenmm_build_python_wrapp option python python modul place subdirectori main build directori call python document api languag extens doxygen document avail c python api separ onlin document c fortran api instead use c document employ map describ figur equival syntax c fortran c api start write c program call openmm sure build run two c exampl suppli openmm see chapter numrefopenmmtutori built suppli codemakefil linux mac suppli codenmakefil visual studio solut file window exampl program codehelloargoninc codehellosodiumchlorideinc argon exampl serv quick check instal set properli know build c program link openmm also tell whether openmm execut gpu run slowli refer platform howev argon exampl good templat follow program sodium chlorid exampl though necessarili simplifi structur roughli way recommend set program call openmm pleas sure program execut success machin continu mechan use c api c api gener automat c api openmm built two result compon c bind function call c declar header file c bind small codeextern global interfac function one everi method everi openmm class whose signatur name argument predict class name method signatur also helper type function provid case c behavior directli map c interfac helper function compil main openmm librari noth special get access codeinclud subdirectori openmm instal directori machinegener header file codeopenmmcwrapperh includ c program make call openmm function header contain declar openmm c interfac function relat type note follow suggest structur need includ file codemain compil unit instead use local file write provid simpl interfac exist code see chapter numrefopenmmtutori map c api c api autom gener c wrapper follow translat strategi shown autonumreftablec api idea see construct left c api document interpret correspond construct right c pleas look suppli exampl program see done practic construct c api declar equival c api namespac openmm openmm_ prefix class class openmmclassnam typedef openmm_classnam constant openmmradiansperdeg openmm_radiansperdeg static constant class enum openmmstateposit openmm_state_posit constructor new openmmclassnam openmm_classnam openmm_classname_cr addit constructor _create_ etc destructor openmmclassnam thing openmm_classnam thing delet thing openmm_classname_destroyth class method openmmclassnam thing openmm_classnam thing thingmethodarg openmm_classname_methodth arg boolean type constant bool openmm_boolean true fals openmm_tru openmm_fals string stdstring char vector openmmvec typedef openmm_vec array stdvectorstdstr typedef openmm_stringarray stdvectordoubl typedef openmm_doublearray stdvectorvec typedef openmm_vecarray stdvectorstdpairintint typedef openmm_bondarray stdmapstdstringdoubl typedef openmm_parameterarray autonumbertablec api default map object c api c api except gener translat rule shown tabl enumer next section c api equival array type describ detail except two method handl somewhat differ c api c api openmmcontextgetst c version codeopenmm_context_getst return pointer heap alloc codeopenmm_st object must explicitli destroy codest object done call codeopenmm_state_destroy openmmplatformloadpluginsfromdirectori c version codeopenmm_platform_loadpluginsfromdirectori return heapalloc codeopenmm_stringarray object contain list file name success load must explicitli destroy codestringarray object done ignor return valu youll memori leak sinc codestringarray still alloc c api equival method return refer exist memori rather new heapalloc memori return object need destroy openmm_vec helper type unlik openmm object opaqu manipul via pointer c api provid explicit definit c codeopenmm_vec type compat codeopenmmvec type definit codeopenmm_vec codeblock c typedef struct doubl x z openmm_vec work directli individu field type c program want conveni scale function provid creat new openmm_vec old one scale factor codeblock c openmm_vec openmm_vec_scaleconst openmm_vec vec doubl scale array helper type c builtin contain type codestdvector codestdmap openmm use manipul array object dont direct equival c suppli special array type kind object openmm creat contain string doubl vec bond paramet map see autonumreftablec array name c type object array array type provid function prefix codeopenmm_ actual thing name syntax shown conceptu sinc differ slightli kind object tabularcolumn function oper thing array createint size creat heapalloc array thing space prealloc hold codes start codes want sinc array dynam resiz void destroy thing array free heap space current use passedin array thing int getsiz thing array return current number thing array mean codeget codeset element codegets void resiz thing array int size chang size array indic valu may smaller larger current size exist element remain locat long still fit void append thing array thing add thing end array increas array size one precis syntax depend actual type thing see void set thing array int index thing store copi thing indic element array index array must length least codeindex cant grow array function thing get thing array int index retriev particular element array index thing valu return argument rather function return autonumbertablec array gener descript array helper type exact declar deviat gener descript note array type openmm_doublearray codeblock c openmm_doublearray openmm_doublearray_createint size void openmm_doublearray_destroyopenmm_doublearray int openmm_doublearray_getsizeconst openmm_doublearray void openmm_doublearray_resizeopenmm_doublearray int size void openmm_doublearray_appendopenmm_doublearray doubl valu void openmm_doublearray_setopenmm_doublearray int index doubl valu doubl openmm_doublearray_getconst openmm_doublearray int index openmm_stringarray codeblock c openmm_stringarray openmm_stringarray_createint size void openmm_stringarray_destroyopenmm_stringarray int openmm_stringarray_getsizeconst openmm_stringarray void openmm_stringarray_resizeopenmm_stringarray int size void openmm_stringarray_appendopenmm_stringarray const char string void openmm_stringarray_setopenmm_stringarray int index const char string const char openmm_stringarray_getconst openmm_stringarray int index openmm_vecarray codeblock c openmm_vecarray openmm_vecarray_createint size void openmm_vecarray_destroyopenmm_vecarray int openmm_vecarray_getsizeconst openmm_vecarray void openmm_vecarray_resizeopenmm_vecarray int size void openmm_vecarray_appendopenmm_vecarray const openmm_vec vec void openmm_vecarray_setopenmm_vecarray int index const openmm_vec vec const openmm_vec openmm_vecarray_getconst openmm_vecarray int index openmm_bondarray note bond specifi pair integ atom indic codeget method return pair final argument rather function return codeblock c openmm_bondarray openmm_bondarray_createint size void openmm_bondarray_destroyopenmm_bondarray int openmm_bondarray_getsizeconst openmm_bondarray void openmm_bondarray_resizeopenmm_bondarray int size void openmm_bondarray_appendopenmm_bondarray int particl int particl void openmm_bondarray_setopenmm_bondarray int index int particl int particl void openmm_bondarray_getconst openmm_bondarray int index int particl int particl openmm_parameterarray openmm return refer intern codeparameterarray support usercr codeparameterarray codeget codegets function avail also note sinc actual map rather array index name paramet rather ordin codeblock c int openmm_parameterarray_getsizeconst openmm_parameterarray doubl openmm_parameterarray_getconst openmm_parameterarray const char name fortran api start write fortran program call openmm sure build run two fortran exampl suppli openmm see chapter numrefopenmmtutori built suppli codemakefil linux mac suppli codenmakefil visual studio solut file window exampl program codehelloargoninfortran codehellosodiumchlorideinfortran argon exampl serv quick check instal set properli know build fortran program link openmm also tell whether openmm execut gpu run slowli refer platform howev argon exampl good templat follow program sodium chlorid exampl though necessarili simplifi structur roughli way recommend set program call openmm pleas sure program execut success machin continu mechan use fortran api fortran api gener automat c api openmm built two result compon fortran bind subroutin call fortran declar type subroutin form fortran modul file fortran bind small interfac subroutin one everi method everi openmm class whose signatur name argument predict class name method signatur also helper type subroutin provid case c behavior directli map fortran interfac helper subroutin compil main openmm librari noth special get access fortran caseinsensit call fortran subroutin howev capit map compil alllowercas alluppercas name differ compil use differ convent automaticallygener openmm fortran wrapper subroutin gener c thu casesensit provid two form compat major fortran compil includ intel fortran gfortran two form alllowercas trail underscor alluppercas without trail underscor regardless fortran compil use find suitabl subroutin call main openmm librari codeinclud subdirectori openmm instal directori machinegener modul file codeopenmmfortranmodulef must compil along fortran program make call openmm function look codemakefil visual studio solut file provid openmm exampl see build program use modul file modul file contain definit two modul codemodul openmm_typ codemodul openmm howev codeopenmm modul appear user program refer modul intern modul contain declar openmm fortran interfac subroutin relat type paramet constant note follow suggest structur need codeus codeopenmm modul codemain compil unit instead use local file write provid simpl interfac exist code see chapter numrefopenmmtutori map c api fortran api autom gener fortran wrapper follow translat strategi shown autonumreftablefortran api idea see construct left c api document interpret correspond construct right fortran pleas look suppli exampl program see done practic note subroutin modul declar codeimplicit none mean type everi symbol declar explicitli infer first letter symbol name construct c api declar equival fortran api namespac openmm openmm_ prefix class class openmmclassnam type openmm_classnam constant openmmradiansperdeg paramet openmm_radiansperdeg class enum openmmstateposit paramet openmm_state_posit constructor new openmmclassnam type openmm_classnam thing call openmm_classname_createth addit constructor _create_ etc destructor openmmclassnam thing type openmm_classnam thing delet thing call openmm_classname_destroyth class method openmmclassnam thing type openmm_classnam thing thingmethodarg call openmm_classname_methodth arg boolean type constant bool integ true paramet openmm_tru fals paramet openmm_fals string stdstring charact vector openmmvec real vec array stdvectorstdstr type openmm_stringarray stdvectordoubl type openmm_doublearray stdvectorvec type openmm_vecarray stdvectorstdpairintint type openmm_bondarray stdmapstdstr doubl type openmm_parameterarray autonumbertablefortran api default map object c api fortran api c api equival array type describ detail openmm_vec helper type unlik openmm object opaqu manipul via pointer fortran api use ordinari coder array place codeopenmmvec type work directli individu element type fortran program want conveni codescal function provid creat new vec old one scale factor codeblock fortran subroutin openmm_vec_scalevec scale result real vec scale result explicit codetyp codeopenmm_vec provid fortran api sinc need array helper type c builtin contain type codestdvector codestdmap openmm use manipul array object dont direct equival fortran suppli special array type kind object openmm creat contain string doubl vec bond paramet map see autonumreftablefortran array name fortran type object array array type provid function prefix codeopenmm_ actual thing name syntax shown conceptu sinc differ slightli kind object function oper subroutin createarrays creat heapalloc array thing space prealloc hold codes type openmm_ thing array array start codes want sinc array dynam resiz integ size subroutin destroyarray free heap space current use passedin array thing type openmm_ thing array array function getsizearray return current number thing array mean codeget type openmm_ thing array array codeset element codegets integ size subroutin resizearrays chang size array indic valu may smaller larger type openmm_ thing array array current size exist element remain locat long still fit integ size subroutin appendarrayelt add thing end array increas array size one precis syntax depend type openmm_ thing array array actual type thing see thing elt subroutin setarrayindexelt store copi codeelt indic element array index array must type openmm_ thing array array length least codeindex cant grow array function integ size thing elt subroutin getarrayindexelt retriev particular element array index thing requir one type openmm_ thing array array argument return integ size thing elt autonumbertablefortran array gener descript array helper type exact declar deviat gener descript note array type openmm_doublearray codeblock fortran subroutin openmm_doublearray_createarray size integ size type openmm_doublearray array subroutin openmm_doublearray_destroyarray type openmm_doublearray array function openmm_doublearray_getsizearray type openmm_doublearray array integ openmm_doublearray_gets subroutin openmm_doublearray_resizearray size type openmm_doublearray array integ size subroutin openmm_doublearray_appendarray valu type openmm_doublearray array real valu subroutin openmm_doublearray_setarray index valu type openmm_doublearray array integ index real valu subroutin openmm_doublearray_getarray index valu type openmm_doublearray array integ index real valu openmm_stringarray codeblock fortran subroutin openmm_stringarray_createarray size integ size type openmm_stringarray array subroutin openmm_stringarray_destroyarray type openmm_stringarray array function openmm_stringarray_getsizearray type openmm_stringarray array integ openmm_stringarray_gets subroutin openmm_stringarray_resizearray size type openmm_stringarray array integ size subroutin openmm_stringarray_appendarray str type openmm_stringarray array charact str subroutin openmm_stringarray_setarray index str type openmm_stringarray array integ index charact str subroutin openmm_stringarray_getarray index str type openmm_stringarray array integ index characterstr openmm_vecarray codeblock fortran subroutin openmm_vecarray_createarray size integ size type openmm_vecarray array subroutin openmm_vecarray_destroyarray type openmm_vecarray array function openmm_vecarray_getsizearray type openmm_vecarray array integ openmm_vecarray_gets subroutin openmm_vecarray_resizearray size type openmm_vecarray array integ size subroutin openmm_vecarray_appendarray vec type openmm_vecarray array real vec subroutin openmm_vecarray_setarray index vec type openmm_vecarray array integ index real vec subroutin openmm_vecarray_getarray index vec type openmm_vecarray array integ index real vec openmm_bondarray note bond specifi pair integ atom indic codeget method return pair final argument rather function return codeblock fortran subroutin openmm_bondarray_createarray size integ size type openmm_bondarray array subroutin openmm_bondarray_destroyarray type openmm_bondarray array function openmm_bondarray_getsizearray type openmm_bondarray array integ openmm_bondarray_gets subroutin openmm_bondarray_resizearray size type openmm_bondarray array integ size subroutin openmm_bondarray_appendarray particl particl type openmm_bondarray array integ particl particl subroutin openmm_bondarray_setarray index particl particl type openmm_bondarray array integ index particl particl subroutin openmm_bondarray_getarray index particl particl type openmm_bondarray array integ index particl particl openmm_parameterarray openmm return refer intern codeparameterarray support usercr codeparameterarray codeget codegets function avail also note sinc actual map rather array index name paramet rather ordin codeblock fortran function openmm_parameterarray_getsizearray type openmm_parameterarray array integ openmm_parameterarray_gets subroutin openmm_parameterarray_getarray name param type openmm_parameterarray array charact name charact param python api map c api python api python api follow c api close possibl three notabl differ codegetst method codecontext class take pythonictyp argument indic state variabl made avail exampl mycontextgetstategetenergytru getforcefals wherev c api use refer return multipl valu method python api return tupl exampl c would queri harmonicbondforc bond paramet follow int particl particl doubl length k fgetbondparametersi particl particl length k python equival code particl particl length k fgetbondparametersi unlik c python api accept return quantiti unit attach valu see section numrefunitsanddimensionalanalysi detail short mean valu c implicit unit python api return object valu explicit unit mechan use python api use python api sure includ gpu support librari librari path would c applic set codeld_library_path environ variabl linux codedyld_library_path mac codepath window see chapter numrefinstallingopenmm detail python api contain openmm packag unit code contain openmmunit packag applic layer describ applic guid contain openmmapp packag program use therefor typic begin import openmm mm import openmmunit unit creat use openmm object done exactli c system mmsystem nb mmnonbondedforc nbsetnonbondedmethodmmnonbondedforcecutoffnonperiod nbsetcutoffdistanceunitnanomet systemaddforcenb note set cutoff distanc explicitli specifi nanomet could easili specifi differ unit nbsetcutoffdistanceunitangstrom use unit openmm discuss next section _unitsanddimensionalanalysi unit dimension analysi python api includ unit c api openmm use implicit set unit physic quantiti length mass energi etc unit base dalton nanomet picosecond mass length time dimens respect use c api import ensur quantiti manipul alway express term unit exampl read distanc angstrom must multipli distanc convers factor turn nanomet use c api convers sourc tedium error true mani area scientif program unit confus blame loss mar climat orbit spacecraft cost million unit introduc python api minim chanc error python api address potenti problem convers error use quantiti explicit unit particular distanc express angstrom python api know angstrom time come call c api understand quantiti must convert nanomet programm must declar upfront quantiti angstrom unit api take care detail use explicit unit bit like brush teeth requir effort upfront probabl save troubl long run quantiti unit dimens explicit unit system base three concept dimens unit quantiti dimens measur physic concept mass length time energi energi actual composit dimens base mass length time unit defin linear scale use measur amount particular physic dimens exampl unit includ meter second joul inch gram quantiti specif amount physic dimens exampl quantiti kilogram quantiti express combin valu eg unit eg kilogram quantiti express differ unit set basedimens defin openmmunit modul includ mass length time temperatur amount charg lumin intens precis list base dimens use si unit system si defin current charg per time base unit openmmunit use charg openmmunit treat angl dimens even though angl quantiti often consid dimensionless case choos err side explicit particularli interconvers degre radian frequent sourc unit headach unit exampl mani common unit defin openmmunit modul openmmunit import nanomet angstrom dalton sometim dont want type full unit name everi time assign shorter name use codea function openmmunit import nanomet nm new quantiti creat valu unit use either multipli oper explicit quantiti constructor simkunit import nanomet quantiti construct quantiti use multipli oper bond_length nanomet equival use explicit quantiti constructor bond_length quantiti nanomet verbos bond_length quantityvalu unitnanomet arithmet unit addit subtract quantiti permit quantiti share dimens make sens add mass distanc attempt add subtract two quantiti differ dimens except rais good thing help avoid error x dalton nanomet error addit subtract quantiti dimens differ unit fine result new quantiti creat use correct convers factor unit use x nanomet angstrom ok result nanomet quantiti ad subtract nake unit multipli divid two quantiti creat new quantiti composit dimens exampl divid distanc time result veloc openmmunit import kilogram meter second meter second acceler kilogram mass f forc kgm multipl divis two unit result composit unit mp meter second unlik amount mole angl radian arguabl dimensionless openmmunit treat angl anoth dimens use trigonometr function openmmunit modul python math modul deal unit quantiti openmmunit import sin co aco x sindegre angl aco return angl quantiti radian method codepow builtin python method work quantiti unit area powmet equival area meter area meter method codesqrt builtin codepow use python codemathsqrt method unit quantiti use codeopenmmunitsqrt method instead openmmunit import sqrt side_length sqrtmeter atom scale mass energi unit per amount mass energi unit atom scale specifi per amount openmmunit modul amount mole one seven fundament dimens si unit system atom scale mass unit dalton defin gram per mole dimens dalton therefor massamount instead simpli mass similarli atom scale energi unit kilojoule_per_mol kilocalorie_per_mol per amount dimens care alway use per amount mass energi type atom scale dimension analysi work properli energi unit kilocalories_per_mol dimens macroscop energi unit kilocalori molecular scientist sometim use word kilocalori mean kilocalori per mole use kilocalori per mole orkilojoul per mole molecular energi use kilocalori metabol energi content lunch energi unit kilojoule_per_mol happen go natur unit nanomet picosecond dalton kilojoulemol happen equal gramnanomet sup molepicosecond sup therefor consist molecular dynam unit system use c openmm api per mole unit use molecular calcul long use si cg calori sort unit si prefix mani unit si prefix milligram milli kilomet kilo provid openmmunit modul other creat multipli prefix symbol nonprefix unit openmmunit import mega kelvin megakelvin mega kelvin megakelvin gram meter get si prefix yotto sup yotta sup automat convert differ unit use codequantityin_units_of method creat new quantiti differ unit openmmunit import nanosecond fortnight x nanosecondin_units_offortnight want plain number quantiti use codevalue_in_unit method openmmunit import femtosecond picosecond femtosecond t_just_a_numb tvalue_in_unitpicosecond use codevalue_in_unit put respons unit analysi back hand avoid sometim necessari howev call upon use nonunitsawar python api list tupl vector numpi array unit unit attach contain number creat vector quantiti openmmunit modul overload code__setitem__ code__getitem__ method contain ensur quantiti go vec nanomet printa nm printain_units_ofangstrom centimet print cm printsmillimet import numpi numpyarray centimet printa cm printamillimet convert whole list differ unit much faster convert element individu exampl consid follow code print posit everi particl state measur angstrom v stategetposit printvvalue_in_unitangstrom rewritten follow v stategetpositionsvalue_in_unitangstrom printv two version produc ident result second one run faster therefor prefer _platformspecificproperti platformspecif properti creat context specifi valu properti specif particular platform use control calcul done way outsid scope gener openmm api pass platform object map properti valu context constructor codeblock c platform platform platformgetplatformbynameopencl mapstr string properti propertiesdeviceindex context contextsystem integr platform properti context creat use platform codegetpropertyvalu method queri valu properti opencl platform opencl platform recogn follow platformspecif properti precis select numer precis use calcul allow valu singl mix doubl set singl nearli calcul done singl precis fastest option also least accur set mix forc comput singl precis integr done doubl precis give much better energi conserv slight decreas speed set doubl calcul done doubl precis accur option usual much slower other usecpupm select whether use cpubas pme implement allow valu true fals depend hardwar might might improv perform use option must fftw singl precis multithread instal cpu must support sse openclplatformindex multipl opencl implement instal comput use select one use valu zerobas index platform opencl sens openmm sens use order return opencl platform api use exampl select whether use gpu cpu base opencl implement deviceindex multipl opencl devic avail comput use select one use valu zerobas index devic use order return opencl devic api opencl platform also support parallel simul across multipl gpu set deviceindex properti comma separ list valu exampl codeblock c propertiesdeviceindex tell use devic split work cuda platform cuda platform recogn follow platformspecif properti precis select numer precis use calcul allow valu singl mix doubl set singl nearli calcul done singl precis fastest option also least accur set mix forc comput singl precis integr done doubl precis give much better energi conserv slight decreas speed set doubl calcul done doubl precis accur option usual much slower other usecpupm select whether use cpubas pme implement allow valu true fals depend hardwar might might improv perform use option must fftw singl precis multithread instal cpu must support sse cudacompil specifi path cuda kernel compil version cuda requir separ compil execut specifi openmm tri locat compil specifi want overrid default locat logic use pick default locat depend oper system maclinux first look environ variabl call openmm_cuda_compil set valu use otherwis default locat set usrlocalcudabinnvcc window look environ variabl call cuda_bin_path append nvccex environ variabl set cuda instal usual present tempdirectori specifi directori temporari file written compil kernel openmm usual locat oper system temp directori automat exampl look temp environ variabl rare need specifi deviceindex multipl cuda devic avail comput use select one use valu zerobas index devic use order return cuda api useblockingsync use control cuda runtim synchron cpu gpu set true default cuda allow call thread sleep gpu perform comput allow cpu work set fals cuda spinlock gpu work set fals improv perform slightli also prevent cpu anyth els gpu work deterministicforc case cuda platform may comput forc way fulli determinist typic differ order set number get ad togeth mean comput forc twice particl posit may tini differ result case problem certain algorithm depend forc exactli reproduc last bit set properti true instead calcul way produc fulli determinist result cost small decreas perform cuda platform also support parallel simul across multipl gpu set deviceindex properti comma separ list valu exampl codeblock c propertiesdeviceindex tell use devic split work cpu platform cpu platform recogn follow platformspecif properti thread specifi number cpu thread use specifi openmm select default number thread follow environ variabl call openmm_cpu_thread set valu use number thread otherwis number thread set number logic cpu core comput run usual default valu work well mainli use run someth els comput time want prevent openmm monopol avail core _platformspecificpropertiesdetermin determin whether simul determinist depend plaform run addit settingsmethod use instanc write use pme refer opencl doubleprecis cuda result determinist simul singleprecis cuda cpu platform determinist case howev none behavior guarante futur version mani case still result ident trajectori determin critic need care check ensur set platform allow _openmmtutori openmm tutori exampl file overview four exampl file provid exampl folder design specif object helloargon simpl exampl intend verifi instal openmm correctli also introduc basic class within openmm hellosodiumchlorid exampl show recommend strategi integr openmm exist molecular dynam code helloethan main purpos exampl demonstr tell openmm bond forc bond stretch bond angl bend dihedr torsion hellowaterbox exampl show use openmm model explicit solvat includ set period boundari condit run extrem fast gpu slowli cpu excel exampl use compar perform gpu versu cpu exampl provid use system perform differ would small notic two fundament exampleshelloargon hellosodiumchloridear provid c c fortran indic tabl two exampleshelloethan hellowaterboxfollow structur hellosodiumchlorid demonstr call within openmm api provid c adapt run c fortran follow map describ chapter numrefusingopenmmwithsoftwarewritteninlanguagesotherthanc helloargon hellosodiumchlorid also serv exampl map section describ helloargon hellosodiumchlorid helloethan program detail exampl solvent thermostat boundari forc constraint api argon vacuum none none nonbond c c fortran sodium chlorid implicit water langevin none nonbond c c fortran ethan vacuum none none nonbond stretch bend torsion c water box explicit water andersen period nonbond stretch bend constraint c van der waal coulomb forc _runningexamplefil run exampl file instruct run helloargon program similar process would use run exampl visual studio navig wherev save exampl file descend directori folder visualstudio doubleclick file helloargonsln microsoft visual studio solut file visual studio launch note file creat use visual studio use recent version ask want convert file new version agre continu convers process visual studio make sure solut configur set releas debug solut configur set use dropdown menu top toolbar next green arrow see autonumreffigurevisu studio configur due incompat among visual studio version provid precompil debug binari figur imagesvisualstudiosetconfigurationjpg align center width autonumberfigurevisu studio configur set solut configur releas mode visual studio command option select debug start without debug ctrlf see autonumreffigurerun visual studio also compil program previous compil figur imagesvisualstudiolaunchjpg align center width autonumberfigurerun visual studio run program visual studio see seri line like follow output screen remark use openmm platform refer model atom ar ar atom ar ar atom ar ar endmdl model atom ar ar atom ar ar atom ar ar endmdl model atom ar ar atom ar ar atom ar ar endmdl model atom ar ar atom ar ar atom ar ar endmdl determin platform use first line output indic whether run cpu refer platform gpu cuda opencl platform say one follow remark use openmm platform refer remark use openmm platform cuda remark use openmm platform opencl support gpu program default run gpu visual result output result pdb file could visual use program like vmd httpwwwksuiuceduresearchvmd pymol httppymolsourceforgenet within visual studio rightclick project name helloargon one file select properti option properti page form select debug configur properti node command argument field type argonpdb save output file call argonpdb current work directori default visualstudio directori want save anoth directori need specifi full path select ok run program visual studio text appear short time see messag codepress key continu indic program complet pdb file complet written mac os xlinux navig wherev save exampl file verifi makefil consult makefilenot file directori necessari type make run program type helloargon see seri line like follow output screen remark use openmm platform refer model atom ar ar atom ar ar atom ar ar endmdl model atom ar ar atom ar ar atom ar ar endmdl model atom ar ar atom ar ar atom ar ar endmdl model atom ar ar atom ar ar atom ar ar endmdl determin platform use first line output indic whether run cpu refer platform gpu cuda opencl platform say one follow remark use openmm platform refer remark use openmm platform cuda remark use openmm platform opencl support gpu program default run gpu visual result output result pdb file could visual use program like vmd httpwwwksuiuceduresearchvmd pymol httppymolsourceforgenet type helloargon argonpdb compil fortran c exampl makefil provid exampl also use compil fortran c exampl fortran compil need load version libstdcdylib librari compat version gcc use build openmm openmm mac compil use gcc compil differ version edit makefil add follow flag fcpplib codelusrlibgcci appledarwin makefil updat type make helloargon program helloargon program simul three argon atom vacuum simpl program primarili intend verifi abl compil link run openmm also demonstr basic call need run simul use openmm includ openmmdefin function openmm header file openmmh instruct program includ everyth defin openmm librari includ header file ad follow line top program includ openmmh run program gpu platform default program run refer platform order run program anoth platform eg nvidia amd gpu need load requir share librari platform eg cuda opencl easi way call codeblock c openmmplatformloadpluginsfromdirectoryopenmmplatformgetdefaultpluginsdirectori load share librari plugin found need explicitli know librari avail given machin way program abl run anoth platform avail run simul use openmm public api openmm public api describ section numreftheopenmmpublicapi see use class creat simpl system three argon atom run short simul main compon simul within function codesimulateargon system first establish system add nonbond forc point particl system codeblock c creat system nonbond forc openmmsystem system openmmnonbondedforc nonbond new openmmnonbondedforc systemaddforcenonbond add three argon atom system system data particl hardcod program realist scenario make exampl simpler clearer codestdvectoropenmmvec array vector codeblock c creat three atom stdvectoropenmmvec initposinnm int initposinnma openmmveca locat nm systemaddparticl mass ar gram per mole charg lj sigma nm well depth kj nonbondaddparticl vdwradar nm unit care unit program easi make mistak unit recommend includ variabl name done codeinitposinnm posit nanomet openmm provid convers constant use whenev convers done simplic helloargon exampl show use constant hard overemphas import care unit handlingit easi make mistak despit perhap trivial natur unit convers inform unit use openmm see section numrefunit ad particl inform system nonbond forc requir inform particl system need know mass particl nonbond forc requir inform charg case argon uncharg lennardjon paramet sigma zeroenergi separ distanc well depth see section numreflennardjonesinteract detail note van der waal radiu argon nm alreadi convert sigma nm exampl ad nonbond forc code make use appropri convers factor suppli openmm discuss section numrefunit integr next specifi integr use perform calcul case choos verlet integr run constant energi simul argument requir step size picosecond codeblock c openmmverletintegr integr step size ps chosen use picosecond femtosecond larger use typic molecular dynam simul howev sinc exampl bond higher frequenc compon like molecular dynam simul accept valu context context object consist integr system manag state simul code initi context let context select best platform avail run sinc specif specifi print chosen platform use inform especi debug codeblock c let openmm context choos best platform openmmcontext contextsystem integr printfremark use openmm platform sn contextgetplatformgetnamec_str initi system set initi time well initi posit veloc atom exampl leav time veloc default valu zero codeblock c set start posit atom leav time veloc zero contextsetpositionsinitposinnm initi run simul next block code run simul save output frame simul exampl frame defin advanc interv integr see current state simul obtain written pdbformat file codeblock c simul int framenum framenum output current state inform openmmst state contextgetstateopenmmstateposit const doubl timeinp stategettim writepdbframeframenum state output coordin get state inform done bulk ask inform particl comput expens sinc inform resid gpu requir commun overhead retriev want often code request posit sinc need time state simul stop ps otherwis ask integr take step one frame equival time step normal would want take step time get reasonablelook anim use codeblock c timeinp break advanc state mani step time effici use openmm integratorstep use lot normal error handl openmm error handl openmm explicitli design check statu everi call anyth goe wrong openmm throw except use standard except mani platform get except messag automat howev recommend use codetrycatch block ensur catch except codeblock c int main tri simulateargon return success catch report usag runtim error detect openmm fail catchconst stdexcept e printfexcept sn ewhat return failur write pdb file helloargon program provid simpl pdb file write function codewritepdbfram write argon atom function noth openmm except use openmm state function extract posit state nanomet sup convert angstrom sup compat pdb format emphas import track unit use codeblock c void writepdbframeint framenum const openmmst state refer atom posit openmm state const stdvectoropenmmvec posinnm stategetposit use pdb model card number trajectori frame printfmodel dn framenum start frame int intposinnms printfatom ar ar atom number printffff n coordin convert nanomet angstrom posinnma posinnma posinnma printfendmdln end frame codemodel codeendmdl use mark begin end frame respect includ multipl frame pdb file visual simul trajectori helloargon output output helloargon program save pdb file visual use program like vmd pymol see section numrefrunningexamplefil see three atom move linearli away toward one anoth figur imagesargonpng align center may need adjust van der waal radiu visual program see atom collid hellosodiumchlorid program hellosodiumchlorid model sever sodium na sup chlorid cl sup ion implicit solvent use gener bornsurfac area gbsa obc model helloargon program nonbond forc simul main purpos exampl illustr recommend strategi integr openmm exist molecular dynam md code write highlevel interfac routin contain openmm call rather make openmm call throughout program recommend write hand interfac routin understand md code data structur openmm organ routin separ compil unit make huge chang exist md code routin could written languag callabl exist md code recommend write c sinc openmm written also write c fortran see chapter numrefusingopenmmwithsoftwarewritteninlanguagesotherthanc call highlevel interfac routin exist md code provid clean separ exist md code openmm chang openmm directli impact exist md code one way implement use opaqu handl standard trick use exampl open file linux exist md code commun openmm via handl know none detail handl hold handl give back openmm exampl describ see strategi implement simpl md code chapter numrefexamplesofopenmmintegr describ strategi use integr openmm real md code _simplemoleculardynamicssystem simpl molecular dynam system initi section hellosodiumchloridecpp repres simpl molecular dynam system system includ model simul paramet atom forc field data also provid data structur codeposinang store current state section repres highli simplifi form inform would avail exist md code use demonstr integr openmm exist md program codeblock c model simul paramet static const doubl temperatur kelvin static const doubl frictioninperp collis per picosecond static const doubl solventdielectr typic water static const doubl solutedielectr typic protein static const doubl stepsizeinf integr step size fs static const doubl reportintervalinf often issu pdb frame fs static const doubl simulationtimeinp total simul time ps decid whether request energi calcul static const bool wantenergi true atom forc field data part openmm struct use collect atom paramet exampl normal atom paramet would come forc field parameter file go use data angstrom kilocalori unit show safe convert openmm intern unit system use nanomet kilojoul static struct myatominfo const char pdb doubl mass charg vdwradiusinang vdwenergyinkc gbsaradiusinang gbsascalefactor doubl initposinang doubl posinang leav room runtim state info atom pdb mass charg vdwrad vdwenergi gbsarad gbsascal initpo na cl na cl na cl end list interfac routin key recommend integr strategi interfac routin need decid interfac routin requir effect commun exist md program openmm typic six seven exampl follow four routin suffic initi data structur alreadi exist md program ie forc field constraint atom system pass codeiniti routin make appropri call openmm return handl openmm object use exist md program termin clean heap space alloc codeiniti pass handl codetermin routin advanc state codeadvancest routin advanc simul requir call function exist md code give handl retriev state want analysi gener kind report call coderetrievest routin give handl fill data structur defin exist md code allow md program use exist routin without modif note descript routin functionsy call anyth like implement whatev way make sens md code exampl code four routin perform function plu opaqu data structur handl would declar shown main program set run report simul access routin opaqu data structur case variabl codeomm see access openmm declar interfac routin write need chang build environ codeblock c struct myopenmmdata static myopenmmdata myinitializeopenmmconst myatominfo atom doubl temperatur doubl frictioninp doubl solventdielectr doubl solutedielectr doubl stepsizeinf stdstring platformnam static void mystepwithopenmmmyopenmmdata int numstep static void mygetopenmmstatemyopenmmdata bool wantenergi doubl time doubl energi myatominfo atom static void myterminateopenmmmyopenmmdata main program int main const int numreport intsimulationtimeinp reportintervalinf const int numsilentstep intreportintervalinf stepsizeinf alway enclos openmm call trycatch block make sure usag runtim error caught report tri doubl time energi stdstring platformnam set openmm data structur return openmm platform name myopenmmdata omm myinitializeopenmmatom temperatur frictioninperp solventdielectr solutedielectr stepsizeinf platformnam run simul write first line pdb file initi configur run silent entir within openmm report interv write pdb frame time come printfremark use openmm platform sn platformnamec_str mygetopenmmstateomm wantenergi time energi atom mywritepdbfram time energi atom int frame frame numreport frame mystepwithopenmmomm numsilentstep mygetopenmmstateomm wantenergi time energi atom mywritepdbframefram time energi atom clean openmm data structur myterminateopenmmomm return normal return main catch report usag runtim error detect openmm fail catchconst stdexcept e printfexcept sn ewhat return examin implement four interfac routin opaqu data structur handl section unit simpl molecular dynam system describ section numrefsimplemoleculardynamicssystem employ commonli use unit angstrom kcal differ unit paramet use within openmm see section numrefunit nanomet kilojoul differ may small critic must care account interfac routin lennardjon potenti lennardjon potenti describ energi two ident atom distanc vari van der waal size paramet use identifi distanc energi two atom minimum van der waal forc attract sever way specifi paramet typic either van der waal radiu r subvdw actual distanc two atom submin also call r submin twice van der waal radiu r subvdw third way describ potenti sigma mathsigma identifi distanc energi function cross zero atom move closer togeth submin see section numreflennardjonesinteract detail relationship mathsigma turn submin close enough submin make hard distinguish two care use correct valu exampl show use builtin openmm convers constant avoid error lennardjon paramet defin pair ident atom must also appli pair dissimilar atom done combin rule differ among popular md code two common lorentzberthelot use amber charmm math rfracr_ir_j epsilonsqrtepsilon_i epsilon_j jorgensen use opl math rsqrtr_i r_j epsilonsqrtepsilon_i epsilon_j r effect van der waal size paramet minimum radiu minimum distanc zero cross sigma mathepsilon effect van der waal energi well depth paramet dissimilar pair atom j openmm implement lorentzberthelot directli other implement use customnonbondedforc class see section numrefcustomnonbondedforc detail opaqu handl myopenmmdata exampl handl use interfac openmm pointer struct call codemyopenmmdata pointer opaqu mean call program knowledg layout object point use directli interfac openmm call program simpli pass opaqu handl one interfac routin anoth mani differ way implement handl code show one exampl simul requir three openmm object system context integr must exist within handl object requir simul would add handl would chang main program use handl codeblock c struct myopenmmdata myopenmmdata system context integr myopenmmdata delet system delet context delet integr openmmsystem system openmmcontext context openmmintegr integr addit establish pointer requir three openmm object codemyopenmmdata constructor codemyopenmmdata set pointer three openmm object zero destructor codemyopenmmdata c give heap space back done inlin helloargon program recommend use someth like method instead myinitializeopenmm codemyinitializeopenmm function take data structur simul paramet exist md code return new handl use effici comput openmm also return codeplatformnam call program know platform eg cuda opencl refer use codeblock c static myopenmmdata myinitializeopenmm const myatominfo atom doubl temperatur doubl frictioninp doubl solventdielectr doubl solutedielectr doubl stepsizeinf stdstring platformnam initi routin similar helloargon exampl program except object creat put handl instanc helloargon program first step load openmm plugin program run best perform platform avail system creat assign handl codeomm similarli forc ad system alreadi handl codeblock c load avail openmm plugin default locat openmmplatformloadpluginsfromdirectori openmmplatformgetdefaultpluginsdirectori alloc space hold openmm object use myopenmmdata omm new myopenmmdata creat system forc object within system retain refer forc object fill forc note openmm system take ownership forc objectsdont delet ommsystem new openmmsystem openmmnonbondedforc nonbond new openmmnonbondedforc openmmgbsaobcforc gbsa new openmmgbsaobcforc ommsystemaddforcenonbond ommsystemaddforcegbsa specifi dielectr gbsa implicit solvat gbsasetsolventdielectricsolventdielectr gbsasetsolutedielectricsolutedielectr next step atom ad system within handl inform atom come data structur pass initi function exist md code shown helloargon program system forc need inform atom unfamiliar c standard templat librari codepush_back function call end code snippet add given argument end c vector contain codeblock c specifi atom properti system need know mass nonbondedforc need chargesvan der waal propertiesin md unit gbsa need charg radiu scale factor collect default posit initi simul later stdvectorvec initialposinnm int n atomsnpdb n const myatominfo atom atomsn ommsystemaddparticleatommass nonbondaddparticleatomcharg atomvdwradiusinang openmmnmperangstrom openmmsigmapervdwradiu atomvdwenergyinkc openmmkjperkc gbsaaddparticleatomcharg atomgbsaradiusinang openmmnmperangstrom atomgbsascalefactor convert initi posit nm append array const vec posinnmatominitposinang openmmnmperangstrom atominitposinang openmmnmperangstrom atominitposinang openmmnmperangstrom initialposinnmpush_backposinnm unit emphas need pay special attent unit mention earlier exist md code exampl use unit angstrom kcal openmm use nanomet kilojoul initi routin need convert valu exist md code openmm unit assign openmm object code use unit convers constant come openmm eg codeopenmmnmperangstrom perform convers combin name convent includ unit variabl name eg codeinitposinang unit convers constant use remind pay attent unit minim error final initi routin creat integr context simul note chang unit argument routin get platform use run simul return along handl codeomm back call function codeblock c choos integr advanc time context connect system integr simul let context choos best avail platform initi configur default posit collect initi veloc zero could set ommintegr new openmmlangevinmiddleintegratortemperatur frictioninp stepsizeinf openmmpsperf ommcontext new openmmcontextommsystem ommintegr ommcontextsetpositionsinitialposinnm platformnam ommcontextgetplatformgetnam return omm mygetopenmmst codemygetopenmmst function take handl return time energi data structur atom way exist md code use without modif codeblock c static void mygetopenmmstatemyopenmmdata omm bool wantenergi doubl timeinp doubl energyinkc myatominfo atom anoth interfac routin need care unit note convers openmm unit back unit use exist md code codeblock c int infomask infomask openmmstateposit wantenergi infomask openmmstateveloc kinet energi cheap infomask openmmstateenergi pot energi expens forc also avail cheap const openmmst state ommcontextgetstateinfomask timeinp stategettim openmm time ps alreadi copi openmm posit atom array chang unit nm angstrom const stdvectorvec positionsinnm stategetposit int intpositionsinnms int j j j atomsiposinangj positionsinnmij openmmangstromspernm energi request obtain convert kj kcal energyinkc wantenergi energyinkc stategetpotentialenergi stategetkineticenergi openmmkcalperkj mystepwithopenmm codemystepwithopenmm routin take handl use find integr set number step integr take return valu codeblock c static void mystepwithopenmmmyopenmmdata omm int numstep ommintegratorstepnumstep myterminateopenmm codemyterminateopenmm routin take handl delet compon eg context system clean heap space codeblock c static void myterminateopenmmmyopenmmdata omm delet omm helloethan program helloethan program simul ethan hcch vacuum structur similarli hellosodiumchlorid exampl includ bond forc bond stretch bond angl bend dihedr torsion set bond forc program illustr inconsist definit unit watch bond forc ad system within initi interfac routin similar nonbond forc ad hellosodiumchlorid exampl codeblock c creat system forc object within system retain refer forc object fill forc note system own forc object take care delet dont openmmsystem system ommsystem new openmmsystem openmmnonbondedforc nonbond new openmmnonbondedforc openmmharmonicbondforc bondstretch new openmmharmonicbondforc openmmharmonicangleforc bondbend new openmmharmonicangleforc openmmperiodictorsionforc bondtors new openmmperiodictorsionforc systemaddforcenonbond systemaddforcebondstretch systemaddforcebondbend systemaddforcebondtors constrain nonconstrain bond initi routin also set bond constraint use tell system constrain bond codeblock c stdvector stdpairintint bondpair int bondsityp endoflist const int atom bondsiatom const bondtyp bond bondtypebondsityp useconstraint bondcanconstrain systemaddconstraintatom atom bondnominallengthinangstrom openmmnmperangstrom otherwis need give harmonicbondforc bond stretch paramet warn constant use specifi stiff may defin differ exist md code openmm instanc amber use constant given harmon energi term kx sup forc kx k constant x distanc openmm want constant use forc term kx energi kx sup factor must introduc set bond stretch paramet openmm system use data amber system codeblock c bondstretchaddbondatom atom bondnominallengthinangstrom openmmnmperangstrom bondstiffnessinkcalperangstrom openmmkjperkc openmmangstromspernm openmmangstromspernm nonbond exclus next deal nonbond exclus use pair atom appear close one anoth network bond molecul atom close normal nonbond forc appli reduc magnitud first creat list bond gener non bond exclus codeblock c bondpairspush_backstdmake_pairatom atom openmm nonbond forc provid conveni routin creat common except atom connect one bond connect one addit bond coulomb van der waal term appli atom connect three bond coulomb van der waal term appli reduc forcefield depend scale factor gener may introduc addit except standard one suffic mani circumst codeblock c exclud bond atom nonbond forc scale bond atom nonbondcreateexceptionsfrombondsbondpair coulombscal lennardjonesscal creat bond angl harmon term int anglesityp endoflist const int atom anglesiatom const angletyp angl angletypeanglesityp see note bond stretch regard factor bondbendaddangleatomatomatom anglenominalangleindegre openmmradiansperdegre anglestiffnessinkcalperradian openmmkjperkc creat bond torsion dihedr term int torsionsityp endoflist const int atom torsionsiatom const torsiontyp torsion torsiontypetorsionsityp bondtorsionaddtorsionatomatomatomatom torsionperiod torsionphaseindegre openmmradiansperdegre torsionamplitudeinkc openmmkjperkc rest code similar hellosodiumchlorid exampl cover detail pleas refer program helloethanecpp wellcom addit detail _compilingopenmmfromsourcecod compil openmm sourc code chapter describ procedur build instal openmm sourc code case best use prebuilt version instal conda sometim might need build sourc though want modifi openmm conda provid packag compat environ first describ build linux mac describ build window process slightli differ _compilingopenmmfromsourcelinux compil linux mac prerequisit build openmm sourc need certain tool c compil must c compil instal attempt build openmm sourc recent version clang gcc work correctli linux instal compil system standard packag manag apt yum maco get c compil instal xcode develop tool app store altern use packag manag homebrew instal clang gcc python need bit python x environ recommend use miniconda httpsdocscondaioenlatestminicondahtml includ conda packag manag openmm sourc code also need openmm sourc code download brows httpsgithubcomopenmmopenmmreleas find latest releas click link download sourc either zip targz file unpack file note locat unpack openmm sourc code altern want recent develop version code rather version correspond particular releas get httpsgithubcomopenmmopenmm awar develop code constantli chang may contain bug never use product work want stabl well test version openmm download sourc code latest releas describ cuda opencl support want compil openmm support run gpu need cuda andor opencl maco come opencl built noth els need instal linux need appropri sdk easiest way instal recent cuda toolkit httpsdevelopernvidiacomcudadownload includ header librari need compil cuda opencl applic addit runtim librari need run cuda applic runtim compon opencl applic includ gpu driver nvidia amd intel make sure uptod driver requir softwar sever tool requir build openmm easiest way instal conda follow command instal everyth need build openmm conda instal c condaforg cmake make cython swig fftw doxygen numpi step configur cmake first creat directori build openmm start root level openmm sourc tree directori contain top cmakeliststxt file execut follow command codeblock none mkdir build cd build ccmake typo codeccmak two cs ccmake visual cmake configur tool press codec within ccmake interfac load openmm build script begin configur cmake sever variabl adjust cmake interfac set variabl cmake_install_prefix locat want instal openmm use conda environ variabl point full path root directori environ set variabl python_execut python interpret plan use openmm usual detect automat lot option start openmm_build control whether build particular featur openmm plugin api wrapper document usual opencl librari header detect automat reason cmake unabl find set opencl_include_dir point directori contain header usual usrlocalcudainclud linux opencl_librari point librari usual usrlocalcudaliblibopenclso linux configur press c adjust variabl caus error continu configur press c star cmake variabl display press g gener makefil build project step build build openmm command make _testyourbuild step test build step option recommend test take sever minut depend hardwar configur recommend make sure local build openmm work tri instal openmm built run unit test make sure work enter command make test see seri test result like codeblock none start testreferenceandersenthermostat test testreferenceandersenthermostat pass sec start testreferencebrownianintegr test testreferencebrownianintegr pass sec start testreferencecheckpoint test testreferencecheckpoint pass sec mani test codepass good codefail bad test fail run individu get detail error inform exampl testreferencelangevinintegr note test stochast therefor expect fail small fraction time test say error messag codeblock none except assert failur testreferencelangevinintegratorcpp expect found test stochast may occasion fail get error messag codeexcept error launch cuda compil need specifi path cuda compil nvcc use codeopenmm_cuda_compil environ variabl exampl use someth like follow openmm_cuda_compilerpath_to_custom_cuda_dirnvcc step instal instal local build openmm use follow command make instal instal system directori usrlocalopenmm need admin capabl instal case use sudo make instal step instal python api build instal python api command make pythoninstal instal system python usrbinpython need type sudo make pythoninstal test python api instal use python openmmtestinstal congratul success built instal openmm sourc compil window prerequisit build openmm sourc need certain tool c compil window system use c compil visual studio later download free version visual studio httpsvisualstudiomicrosoftcom python need bit python x environ recommend use miniconda httpsdocscondaioenlatestminicondahtml includ conda packag manag cmake cmake build system use openmm must instal cmake version higher attempt build openmm sourc get cmake httpwwwcmakeorg openmm sourc code also need openmm sourc code download brows httpsgithubcomopenmmopenmmreleas find latest releas click link download sourc either zip targz file unpack file note locat unpack openmm sourc code altern want recent develop version code rather version correspond particular releas get httpsgithubcomopenmmopenmm awar develop code constantli chang may contain bug never use product work want stabl well test version openmm download sourc code latest releas describ cuda opencl support want compil openmm support run gpu need cuda andor opencl instal recent cuda toolkit httpsdevelopernvidiacomcudadownload includ header librari need compil cuda opencl applic addit runtim librari need run cuda applic runtim compon opencl applic includ gpu driver nvidia amd intel make sure uptod driver requir softwar sever tool requir build openmm easiest way instal conda window start menu select anaconda prompt miniconda open command window preconfigur conda enter follow command instal everyth need build openmm conda instal c condaforg cython swig fftw doxygen numpi step configur cmake first creat directori build openmm anaconda prompt window open cd root level openmm sourc tree directori contain top cmakeliststxt file execut follow command codeblock none mkdir build cd build cprogram filescmakebincmakeguiex launch cmake gui configur tool critic launch anaconda prompt window shown launch start menu abl find tool instal conda box label sourc code brows openmm sourc directori contain top cmakeliststxt file box label build binari brows build directori creat click configur button bottom cmake window select visual studio list gener whichev version instal click finish sever variabl adjust cmake interfac set variabl cmake_install_prefix locat want instal openmm set variabl python_execut python interpret plan use openmm usual detect automat lot option start openmm_build control whether build particular featur openmm plugin api wrapper document usual opencl librari header detect automat reason cmake unabl find set opencl_include_dir point directori contain header usual cprogram filesnvidia gpu comput toolkitcudavinclud except correct version number toolkit instal opencl_librari point librari usual cprogram filesnvidia gpu comput toolkitcudavlibxopencllib press configur adjust variabl caus error continu press configur red cmake variabl display press gener creat visual studio project file build openmm step build instal open file fileopenmmsln build directori visual studio note file appear fileopenmm configur explor hide file name extens set configur type releas debug toolbar build menu select build solut take time solut explor rightclick instal select build step instal python api solut explor rightclick pythoninstal select build step test build openmm built run unit test make sure work solut explor rightclick run_test select build see seri test result like codeblock none start testreferenceandersenthermostat test testreferenceandersenthermostat pass sec start testreferencebrownianintegr test testreferencebrownianintegr pass sec start testreferencecheckpoint test testreferencecheckpoint pass sec mani test codepass good codefail bad test fail run individu get detail error inform rightclick test solut explor select debug start new instanc note test stochast therefor expect fail small fraction time test say error messag codeblock none except assert failur testreferencelangevinintegratorcpp expect found test stochast may occasion fail congratul success built instal openmm sourc build document option document your current read well develop guid api document built cmake need instal addit tool easiest way use codeconda instal python environ follow command instal everyth need build document html format conda instal c condaforg sphinx sphinxcontribbibtex breath jinja build document pdf format also must function latex instal obtain httpswwwlatexprojectorgget want build document make sure openmm_generate_api_doc set configur build cmake build document use follow build target codesphinxhtml build user guid develop guid html format codesphinxpdf build user guid develop guid pdf format codecapidoc build c api document codepythonapidoc build python api document target requir alreadi built codeinstal target codemak instal linux mac build target use codemak command exampl make sphinxhtml window rightclick target solut explor select build build document build codeinstal target instal document instal directori one specifi cmake_install_prefix use local build openmm alongsid conda tool depend common case local build openmm environ tool depend achiev forc remov openmm instal tool use conda use codeopenmmtool exampl replac softwar packag requir openmm step instal tool usual instal tool use conda commonli exampl use conda instal c condaforg openmmtool pull condaforg packag codeopenmm dont want sinc want use local build step remov conda openmm packag remov openmm packag instal previou step use conda remov forc openmm remov codeopenmm packag without chang remov depend step instal local build openmm instal local build codeopenmm instruct ref_compilingopenmmfromsourcelinux _theopenmmlibraryintroduct introduct openmm librari openmm consist two part first set librari perform mani type comput need molecular simul forc evalu numer integr energi minim etc librari provid interfac target develop simul softwar allow easili add simul featur program second applic layer set python librari provid high level interfac run simul layer target comput biologist peopl want run simul may may programm first part guid focus applic layer describ run simul turn lower level librari assum programm write applic want add simul featur applic follow chapter describ openmm get start provid number file make easi get start openmm precompil binari provid quickli get openmm onto comput see chapter numrefinstallingopenmm setup instruct recommend compil run tutori exampl describ chapter numrefopenmmtutori highlight key function within openmm teach basic program concept use openmm readi begin integr openmm specif softwar packag read chapter numrefexamplesofopenmmintegr see softwar develop done licens two differ licens use differ part openmm public api low level api refer platform cpu platform applic layer distribut mit licens permiss licens allow use almost way requir retain copyright notic disclaim distribut cuda opencl platform distribut gnu lesser gener public licens lgpl also allow use modifi distribut way want requir also distribut sourc code modif restrict appli modif openmm need distribut sourc code applic use openmm also use sever piec code written peopl cover licens licens similar term mit licens significantli restrict openmm use licens may found licens directori includ openmm design principl design openmm api guid follow principl api must support effici implement varieti architectur import consequ goal api provid direct access state inform particl posit veloc etc time architectur access inform expens gpu exampl store video memori must transfer main memori outsid code access distribut architectur might even present local comput openmm therefor allow state inform access bulk understand may slow oper api easi understand easi use seem obviou worth state explicit goal creat openmm hope mani peopl use achiev goal possibl someon learn without enorm amount effort equal import aspect easi use easi use correctli well design api minim opportun programm make mistak reason clariti simplic essenti modular extens hope provid everi featur user ever want reason import openmm easi extend user want add new molecular forc field new thermostat algorithm new hardwar platform api make easi api hardwar independ comput architectur chang rapidli imposs predict hardwar platform might import support futur one goal openmm separ api hardwar develop simul applic abl write code automat take advantag architectur openmm support even architectur yet exist write choic languag molecular model simul tool written varieti languag c c fortran python tcl etc import tool abl use openmm two possibl approach achiev goal one option provid separ version api languag could creat hand gener automat wrapper gener swig would requir api use lowest common denomin featur reason support languag exampl object orient api would option sinc could cleanli express c fortran option provid singl version api written singl languag would permit cleaner simpler api also restrict languag could directli call exampl c api could invok directli fortran python chosen use hybrid two approach openmm base object orient c api primari way invok openmm api fulli expos featur librari believ ultim produc best easiest use api creat least work develop use requir code directli invok api must written c signific burden regardless languag chosen develop would need write thin layer translat applic data model openmm layer part need written c addit creat wrapper api allow openmm invok languag current releas includ wrapper c fortran python wrapper support mani featur reason possibl given constraint particular languag featur fulli support particular write plugin extend openmm api done c also awar featur c easili lead compat portabl problem tri avoid featur particular make minim use templat avoid multipl inherit altogeth goal support openmm major compil oper system architectur overview openmm base layer architectur shown follow diagram figur imagesarchitecturelayersjpg align center width autonumberfigureopenmm architectur openmm architectur highest level openmm public api api develop program use openmm within applic design simpl easi understand complet platform independ layer mani user ever need look public api implement layer platform independ code serv interfac lower level platform specif code user never need look next level openmm low level api olla act abstract layer hide detail hardwar platform consist set c interfac platform must implement user want extend openmm need write class olla level note differ role play public api low level api public api defin interfac user invok code olla defin interfac user must implement invok openmm implement layer lowest level hardwar specif code actual perform comput code may written languag use technolog appropri exampl code gpu written stream process languag opencl cuda code written run cluster use mpi distribut comput tool code written multicor processor use thread tool pthread openmp etc openmm set restrict comput kernel written long wrap appropri olla interfac openmm use _theopenmmpublicapi openmm public api public api base small number class system system specifi gener properti system simul number particl contain mass one size period box etc interact particl specifi set forc object see ad system forc field specif paramet particl charg direct properti system properti forc object contain within system forc forc object ad system defin behavior particl forc abstract class subclass implement specif behavior forc class actual slightli gener name suggest forc inde appli forc particl also directli modifi particl posit veloc arbitrari way thermostat barostat exampl implement forc class exampl forc subclass includ harmonicbondforc nonbondedforc montecarlobarostat context store state inform simul particl posit veloc well arbitrari paramet defin forc system possibl creat multipl context singl system thu multipl simul system progress time integr implement algorithm advanc simul time abstract class subclass implement specif algorithm exampl integr subclass includ langevinintegr verletintegr brownianintegr state state store snapshot simul particular point time creat call method context discuss earlier potenti expens oper way queri valu state variabl particl posit veloc context provid method access directli exampl sourc code creat system run simul might look like codeblock c system system int numparticl systemaddparticleparticleimass harmonicbondforc bond new harmonicbondforc systemaddforcebond int numbond bondsaddbondbondiparticl bondiparticl bondilength bondik harmonicangleforc angl new harmonicangleforc systemaddforceangl int numangl anglesaddangleangleiparticl angleiparticl angleiparticl angleiangl angleik creat initi forc field term way langevinmiddleintegr integratortemperatur friction stepsiz context contextsystem integr contextsetpositionsinitialposit contextsetvelocitiesinitialveloc integratorstep creat system add variou forc set paramet system forc creat langevinmiddleintegr initi context run simul instruct integr advanc simul time step openmm low level api openmm low level api olla defin set interfac user must implement code want extend openmm creat new forc subclass support new hardwar platform base concept kernel defin particular comput perform specif abstract class call kernelimpl instanc class rather subclass creat kernelfactori object class provid concret implement kernel particular platform exampl perform calcul gpu one would creat one kernelimpl subclass implement comput gpu kernel one kernelfactori subclass instanti kernelimpl object object encapsul singl object extend platform kernelfactori object regist platform use creat specif name kernel choic implement use gpu implement multithread cpu implement mpibas distribut implement etc consist entir choos platform use discuss far low level api way specif molecular simul fairli gener comput api addit defin gener class openmm also defin abstract subclass kernelimpl correspond specif calcul exampl class call calcharmonicbondforcekernel implement harmonicbondforc class call integratelangevinstepkernel implement langevinintegr class platform must provid concret subclass architectur design allow easi extens support new hardwar platform exampl creat concret subclass abstract kernel class creat appropri factori platform subclass bind everyth togeth program use openmm use implement simpli specifi platform subclass platform use altern might want creat new forc subclass implement new type interact defin abstract kernelimpl subclass correspond new forc write forc class use platform support new forc provid concret implement kernelimpl subclass furthermor easili provid implement even exist platform creat peopl simpli creat new kernelfactori subclass kernel regist platform object goal complet modular system modul might distribut independ librari either add new featur exist platform support exist featur new platform fact noth special kernel class defin openmm simpli kernelimpl subclass happen use forc integr happen bundl openmm treat exactli like kernelimpl includ one defin import understand olla defin interfac implement would easi assum onetoon correspond kernelimpl object piec code actual perform calcul need case gpu implement exampl singl kernelimpl might invok sever gpu kernel altern singl gpu kernel might perform calcul sever kernelimpl subclass _platform platform releas openmm contain follow platform subclass referenceplatform design serv refer code write platform written simplic clariti mind perform cpuplatform platform provid high perform run convent cpu cudaplatform platform implement use cuda languag perform calcul nvidia gpu openclplatform platform implement use opencl languag perform calcul varieti type gpu cpu choic platform use simul depend variou factor refer platform much slower other therefor rare use product simul cpu platform usual fastest choic fast gpu avail howev requir cpu support sse includ cpu made last sever year platform may avail older comput also simul use certain featur primarili variou custom forc class may faster use opencl platform run cpu cuda platform use nvidia gpu use amd intel gpu use opencl platform amoeba forc field work cuda platform opencl platform also work refer cpu platform perform usual slow use platform _amoebaplugin amoeba plugin openmm version provid plugin implement amoeba polariz atom multipol forc field jay ponder lab amoeba forc field may use openmm python applic layer also creat modifi version tinker refer tinkeropenmm use openmm acceler amoeba simul tinkeropenmm creat tinker packag use three file made avail openmm home page openmm amoeba forc system object contain amoeba forc serial present amoeba support cuda refer platform opencl platform follow section individu forc option avail plugin list step requir build use plugin tinkeropenmm outlin valid result also report benchmark found openmm wiki httpwikisimtkorgopenmmbenchmark openmm amoeba support forc option _supportedforcesandopt support forc option amoeba forc term implement openmm list autonumreftablemap tinker along support unsupport option tinker option support openmm forc includ group atom eg protein chain infinit polym check exclus particl energyforc calcul activeinact particl virial calcul forc rotat axi type support zthenx bisector zbisect fold zonli tinker forc openmm forc optionnot ebond bondterm amoebabondforc bndtypharmon support mors implement eangl angleterm amoebaangleforc angtypharmon inplan support linear fourier implement etorsa torsionterm periodictorsionforc option implement smooth versionetorsb support etortor tortorterm amoebatorsiontorsionforc option implement eopbend opbendterm amoebaoutofplanebendforc opbtyp alling implement wdc implement epitor pitorsterm amoebapitorsionforc option implement estrbnd strbndterm amoebastretchbendforc option implement ehala vdwterm amoebavdwforc ehalblight support empolea mpoleterm amoebamultipoleforc poltyp mutual direct support empolec mpoleterm pme amoebamultipoleforc poltyp mutual direct support boundari vacuum unsupport esolv solvateterm amoebawcadispersionforc bornradiusgrycuk solvategk support unsupport solvat set amoebageneralizedkirkwoodforc asp sasa onion pb gbhpmf gkhpmf sasa comput base ace approxim eurey ureyterm harmonicbondforc option implement autonumbertablemap tinker map tinker openmm amoeba forc specif detail awar follow forc avail tinker implement openmm amoeba plugin includ follow angleangl outofplan distanc improp dihedr improp torsion stretchtors chargecharg atomwis chargedipol dipoledipol reaction field ligand field restraint scf molecular orbit calcul strictli speak part amoeba forc field implicit solvent tinkeropenmm implement key file entri solvat gk entri bornradiu grycuk also includ grycuk option calcul born radii avail plugin tinker nonpolar caviti contribut solvat term calcul use algorithm map well gpu instead openmm plugin use tinker version ace approxim estim caviti contribut sasa calcul use cuda platform may done either singl doubl precis refer platform doubl precis use tinker use doubl precis tinker paramet file amoeba forcefield paramet base unit kilocalorie√• wherea openmm use unit kilojoulesnanomet tinker openmm use picosecond time unit henc map forcefield paramet tinker file openmm mani paramet valu must convert openmm unit setup method tinkeropenmm applic perform requir convers support integr addit limit forc outlin tinkeropenmm use either verlet stochast integr openmm plugin use equival tinker beeman integr unavail openmm openmm amoeba valid openmm tinker use comput atom forc dihydrofol reductas dhfr implicit explicit solvent calcul use cuda platform repeat singl doubl precis everi atom rel differ openmm tinker comput f submm f subt f submm f subt f submm forc comput openmm f subt forc comput tinker median atom shown autonumreftablecomparison tinker openmm tinker use differ approxim comput caviti term differ forc much larger implicit solvent explicit solvent therefor repeat calcul remov caviti term yield much closer agreement openmm tinker demonstr differ come entir one term solvent model singl doubl implicit sup sup implicit caviti term sup sup explicit sup sup autonumbertablecomparison tinker median rel differ forc openmm tinker _testingandvalidationofopenmm test valid openmm goal test valid make sure openmm work correctli mean run without crash otherwis fail produc correct result furthermor must work correctli varieti hardwar platform eg differ model gpu softwar platform eg oper system opencl implement type simul three type test use valid openmm unit test small test design test specif featur piec code isol exampl test harmonicbondforc might creat system particl bond comput forc energi compar analyt expect valu thousand unit test collect cover openmm system test wherea unit test valid small featur isol system test design valid entir librari whole simul realist model biomolecul perform test like fail problem exist anywher librari direct comparison openmm program third type valid perform direct comparison individu forc comput openmm comput program collect biomolecul type test outlin greater detail discuss current statu test given descript test unit test unit test sourc code build sourc run see section numreftestyourbuild detail run test exampl type make test linux mac produc output someth like start testreferenceandersenthermostat test testreferenceandersenthermostat pass sec start testreferencebrownianintegr test testreferencebrownianintegr pass sec start testreferencecheckpoint test testreferencecheckpoint pass sec mani test line repres test suit may contain multipl unit test test within suit pass print word pass long suit took execut otherwis print error messag test fail run individu one separ execut get detail went wrong system test sever differ type system test perform type run varieti system includ protein nucleic acid involv implicit explicit solvent full suit test repeat cuda opencl platform use singl doubl precis integr test mix precis well varieti oper system hardwar four type test consist platform forc energi comput use platform test compar one comput refer platform result requir agre within small toler energyforc consist verifi forc realli gradient energi first comput vector forc given conform gener four conform displac particl posit small amount along forc direct comput energi one use calcul fourth order finit differ approxim deriv along direct compar actual forc requir agre within small toler energi conserv system simul constant energi use verlet integr total energi period record linear regress use estim rate energi drift addit constrain distanc monitor simul make sure never differ expect valu constraint toler thermost system simul constant temperatur use langevin integr mean kinet energi cours simul comput compar expect valu base temperatur addit constrain distanc monitor simul make sure never differ expect valu constraint toler want run system test found subvers repositori httpssimtkorgsvnpyopenmmtrunktestsystemtest check directori execut runalltestssh shell script creat seri file detail inform result test awar run full test suit may take long time possibl sever day depend speed gpu direct comparison openmm program final check ident system set openmm anoth program gromac tinker one use comput forc atom result directli compar test result section highlight major result obtain test describ exhaust give reason idea level accuraci expect openmm comparison refer platform differ forc comput refer platform comput opencl cuda platform shown autonumreftableforc comparison platform everi atom rel differ platform comput f subref f subtest f subref f subtest f subref forc comput refer platform f subtest forc comput platform test opencl cuda median atom given system comput estim typic forc error system final median valu test system comput give valu shown tabl forc opencl singl opencl doubl cuda singl cuda doubl total forc sup sup sup sup harmonicbondforc sup sup sup sup harmonicangleforc sup sup sup sup periodictorsionforc sup sup sup sup rbtorsionforc sup sup sup sup nonbondedforc cutoff sup sup sup sup nonbondedforc cutoff nonperiod sup sup sup sup nonbondedforc cutoff period sup sup sup sup nonbondedforc ewald sup sup sup sup nonbondedforc pme sup sup sup sup gbsaobcforc cutoff sup sup sup sup gbsaobcforc cutoff nonperiod sup sup sup sup gbsaobcforc cutoff period sup sup sup sup autonumbertableforc comparison platform median rel differ forc refer platform openclcuda platform energi conserv autonumreffigureenergi drift show total system energi versu time three simul ubiquitin obc implicit solvent three simul use cuda platform verlet integr time step fs constraint cutoff nonbond interact differ level numer precis use calcul see chapter numrefplatformspecificproperti figur imagesenergydriftpng align center autonumberfigureenergi drift total energi versu time simul run three differ precis mode mix doubl precis simul drift energi almost entir diffus neglig systemat drift singl precis simul signific upward drift time though rate drift still small compar rate short term fluctuat fit straight line curv give long term rate energi drift kjmolen singl precis kjmolen mix precis kjmolen doubl precis commonli report unit ktnsdof correspond sup singl precis sup mix precis sup doubl precis awar differ simul paramet give differ result simul design minim sourc error except inher openmm sourc error may signific situat particular use larger time step increas integr error roughli proport dt sup system involv constraint level error depend strongli constraint toler specifi integr use ewald summat particl mesh ewald accuraci depend strongli ewald error toler appli distanc cutoff implicit solvent calcul increas error shorter cutoff greater error result rate energi drift may much greater simul one shown comparison gromac openmm gromac use comput atom forc dihydrofol reductas dhfr implicit explicit solvent implicit solvent calcul use obc solvent model cutoff nonbond interact explicit solvent calcul use particl mesh ewald nm cutoff direct space interact openmm ewald error toler set sup gromac codefourierspac set codeewald_rtol sup constraint appli degre freedom program use singl precis test repeat opencl cuda cpu platform everi atom rel differ openmm gromac comput f submm f subgro f submm f subgro f submm forc comput openmm f subgro forc comput gromac median atom shown autonumreftablecomparison gromac solvent model opencl cuda cpu implicit sup sup sup explicit sup sup sup autonumbertablecomparison gromac median rel differ forc openmm gromac _drudeplugin drude plugin drude oscil method incorpor electron polariz model citelamoureux polariz particl second particl drude particl attach anisotrop harmon spring particl locat equival ordinari point particl appli electr field caus drude particl move short distanc away parent particl creat induc dipol moment polariz mathalpha relat charg q drude particl spring constant k math alpha fracqk damp interact citethol use dipol bond equat motion integr three differ method self consist field scf method ordinari particl first updat usual local energi minim perform select new posit drude particl ensur induc dipol moment respond instantli chang environ method accur comput expens extend lagrangian method posit drude particl treat dynam variabl like particl small amount mass transfer parent particl drude particl allow integr normal dual langevin nosehoov integr use maintain center mass drude particl pair system temperatur use much lower temperatur rel intern motion practic produc dipol moment close scf solut much faster comput nos√©hoov dual thermostat method approach motion nondrud site center mass motion drude pair thermost target temperatur one thermostat anoth thermostat use keep rel motion drude pair differ typic much lower temperatur maintain separ nuclear electron degre freedom minim specif follow drudenosehooverintegr integratortemperatur frequenc temperaturedrud frequencydrud femtosecond first third argument specifi centerofmass temperatur rel temperatur drude pair respecitv second fourth argument describ frequenc interact centerofmass rel heat bath respect specifi invers time unit fifth argument timestep multitimestep nos√©hoov chain length may also specifi sensibl default provid defaultdomain py _modelbuildingandedit model build edit sometim pdb file need work simul mayb doesnt contain hydrogen atom common structur determin xray crystallographi need add perhap want simul system explicit water pdb file doesnt contain water molecul mayb contain water molecul contain wrong number interact site water model want use openmm model class fix problem use creat classmodel object provid initi classtopolog atom posit invok variou model function one modifi system way creat new classtopolog list posit done retriev classmodel use start point simul samepag pdb pdbfileinputpdb model modellerpdbtopolog pdbposit call model function system forcefieldcreatesystemmodellertopolog nonbondedmethodpm simul simulationmodellertopolog system integr simulationcontextsetpositionsmodellerposit caption autonumberexamplemodel outlin let consid particular function call ad hydrogen call methaddhydrogen function add miss hydrogen atom modelleraddhydrogensforcefield forc field need determin posit hydrogen atom system alreadi contain hydrogen miss other fine model recogn exist one figur one need ad residu exist differ proton state depend ph detail local environ default assum ph specifi differ valu modelleraddhydrogensforcefield ph residu select proton state common specifi ph case cystein residu also check whether residu particip disulfid bond select state use histidin two differ proton state equal like neutral ph therefor select one use base form better hydrogen bond want control possibl specifi exactli proton state use particular residu detail consult api document model class default classmodel load inform hydrogen standard amino acid nucleic acid call methloadhydrogendefinit load definit type molecul particular system contain carbohydr plan simul glycam forc field call modellerloadhydrogendefinitionsglycamhydrogensxml subsequ call methaddhydrogen make use newli load definit ad solvent call methaddsolv creat box solvent water ion around model modelleraddsolventforcefield construct box water around solut ensur water molecul come closer solut atom sum van der waal radii also determin charg solut add enough posit neg ion make system neutral call shown methaddsolv expect period box dimens specifi pdb file use size water box pdb file specifi box size want use differ size specifi one modelleraddsolventforcefield boxsizevec nanomet request nm nm nm box nonrectangular box specifi three box vector defin unit cell modelleraddsolventforcefield boxvectorsavec bvec cvec anoth option specifi pad distanc modelleraddsolventforcefield paddingnanomet determin largest size solut along axi x z creat cubic box width solut sizepad line guarante part solut come closer nm edg box final specifi exact number solvent molecul includ water ion add use want solvat sever differ conform molecul guarante amount solvent modelleraddsolventforcefield numad default methaddsolv creat tipp water molecul also support water model modelleraddsolventforcefield modeltipp allow valu codemodel option tipp tippfb spce tippew tippfb tipp sure includ singl quot around valu anoth option add extra ion pair give desir total ionic strength exampl modelleraddsolventforcefield ionicstrengthmolar solvat system salt solut whose ionic strength molar note comput ionic strength consid ion ad neutral solut assum bound solut contribut bulk ionic strength default na sup cl sup ion use specifi differ one use codepositiveion codenegativeion option exampl creat potassium chlorid solut modelleraddsolventforcefield ionicstrengthmolar positiveionk allow valu codepositiveion cs k li na rb allow valu codenegativeion cl br f sure includ singl quot around valu also awar forc field includ paramet ion type need use type support chosen forc field ad membran want simul membran protein may need creat membran well call methaddmembran call instead methaddsolv addit one method add membran solvent ion make sure lipid head group properli solvat exampl creat popc membran ensur least nm pad side modelleraddmembraneforcefield lipidtypepopc minimumpaddingnanomet membran ad xy plane exist protein assum alreadi orient posit correctli possibl recommend start model orient protein membranes_ opm databas otherwis select protein posit method also add solvent take mani argument methaddsolv see api document detail _orient protein membran httpopmpharumichedu _addingorremovingextraparticl ad remov extra particl extra particl particl repres ordinari atom includ virtual interact site use mani water model drude particl etc use forc field involv extra particl must add classtopolog call modelleraddextraparticlesforcefield look forc field determin extra particl need modifi residu includ function remov extra particl well ad remov water call deletewat remov water molecul system modellerdeletewat use exampl want simul implicit solvent awar though remov water molecul ion small molecul might consid solvent _savingtheresult save result finish edit model immedi use result classtopolog object atom posit input classsimul plan simul mani time though usual better save result new pdb file use input simul avoid cost repeat model oper start everi simul also ensur simul realli start exactli structur follow exampl load pdb file add miss hydrogen build solvent box around perform energi minim save result new pdb file samepag openmmapp import openmm import openmmunit import printload pdb pdbfileinputpdb forcefield forcefieldambersbxml tippxml model modellerpdbtopolog pdbposit printad hydrogen modelleraddhydrogensforcefield printad solvent modelleraddsolventforcefield modeltipp paddingnanomet printminim system forcefieldcreatesystemmodellertopolog nonbondedmethodpm integr verletintegratorpicosecond simul simulationmodellertopolog system integr simulationcontextsetpositionsmodellerposit simulationminimizeenergymaxiter printsav posit simulationcontextgetstategetpositionstruegetposit pdbfilewritefilesimulationtopolog posit openoutputpdb w printdon caption autonumberexamplemodel complet defaultdomain py _advancedsimulationexampl advanc simul exampl previou chapter look basic script run simul saw lot way custom want dorun straightforward molecular simulationsy alreadi know everyth need know use exampl script custom way describ section numrefsimulationparamet openmm far script full openmm api dispos along power python languag librari chapter consid exampl illustr advanc techniqu rememb still exampl would imposs give exhaust list everyth openmm hope give sens possibl inspir experi start section assum knowledg program well familiar openmm api consult user guid openmm api document uncertain someth work also useth python codehelp command exampl helpsimul print detail document classsimul class simul anneal simpl exampl simul anneal follow line linearli reduc temperatur k k increment execut time step temperatur samepag simulationcontextsetpositionspdbposit simulationminimizeenergi rang integratorsettemperatureikelvin simulationstep caption autonumberexamplesimul anneal code need littl explan loop execut time time adjust temperatur classlangevinmiddleintegr call codestep take time step appli extern forc particl spheric contain exampl simul nonperiod system contain insid spheric contain radiu nm implement contain appli harmon potenti everi particl math er begincas rle r r endcas r distanc particl origin measur nm easili use openmm classcustomexternalforc class class appli forc particl system energi arbitrari function particl x z coordin code samepag system forcefieldcreatesystempdbtopolog nonbondedmethodcutoffnonperiod nonbondedcutoffnanomet constraintsnon forc customexternalforcemax r rsqrtxxyyzz systemaddforceforc rangesystemgetnumparticl forceaddparticlei integr langevinmiddleintegratorkelvin picosecond picosecond caption autonumberexamplespher contain first thing creat classcustomexternalforc object add classsystem argument classcustomexternalforc mathemat express specifi potenti energi particl function x z want also depend global perparticl paramet wide varieti restraint steer forc shear forc etc implement method next must specifi particl appli forc case want affect everi particl system loop call methaddparticl one two argument index particl affect list perparticl paramet valu empti list case perparticl paramet make forc stronger particl other would specifi notic immedi creat classsystem arbitrari choic warn add new forc classsystem must creat classsimul creat classsimul modifi classsystem effect classsimul extract report forc data openmm provid report three output format pdb httpswwwwwpdborgdocumentationfileformatcontentformatvhtml_ pdbxmmcif httpsmmcifwwpdborgpdbxmmcifhomepagehtml_ dcd httpswwwksuiuceduresearchnamdugnodehtml_ format store posit veloc forc data section creat new report output forc illustr two import thing write report queri simul forc data definit classforcereport class samepag class forcereporterobject def __init__self file reportinterv self_out openfil w self_reportinterv reportinterv def __del__self self_outclos def describenextreportself simul step self_reportinterv simulationcurrentstepself_reportinterv return step fals fals true fals none def reportself simul state forc stategetforcesvalue_in_unitkilojoulesmolenanomet f forc self_outwriteg g gn f f f caption autonumberexampleforcereport constructor destructor straightforward argument constructor output filenam interv time step gener report open output file write record report interv destructor close file two method everi report must implement methdescribenextreport methreport simul object period call methdescribenextreport report find report next gener report inform need gener return valu six element tupl whose element follow number time step next report calcul report interv current step report interv exampl want report everi step simul current step return whether next report need particl posit whether next report need particl veloc whether next report need forc whether next report need energi whether posit wrap period box none automat decid whether wrap posit base whether system use period boundari condit time come next schedul report classsimul call methreport gener report argument classsimul object classstat guarante contain inform request methdescribenextreport state object contain snapshot inform simul forc particl posit call methgetforc retriev forc convert unit want output kjmolenm loop valu write file keep exampl simpl print valu text format one line per particl real program might choos differ output format defin class use exactli like report exampl simulationreportersappendforcereporterforcestxt output forc file call forcestxt everi time step comput energi exampl illustr differ sort analysi instead run simul assum alreadi identifi set structur interest structur save set pdb file want loop file directori load one time comput potenti energi one assum alreadi creat classsystem classsimul follow line perform analysi samepag import os file oslistdirstructur pdb pdbfileospathjoinstructur file simulationcontextsetpositionspdbposit state simulationcontextgetstategetenergytru printfil stategetpotentialenergi caption autonumberexamplecomput energi use python codelistdir function list file directori creat classpdbfil object one call methsetposit context specifi particl posit load pdb file comput energi call methgetst option codegetenergytru print consol along name file defaultdomain py _theopenmmapplicationlayerintroduct get start introduct first thing understand openmm applic layer exactli applic tradit sens program call openmm run rather collect librari written python program languag librari easili chain togeth creat python program run simul dont worri dont need know anyth python program program use nearli molecular simul applic ask write sort script specifi detail simul run openmm script happen written python harder write applic guid teach everyth need know even graphic interfac write script base simpl set option see section numrefthescriptbuilderappl never need type singl line code hand dont mind littl program approach give enorm power flexibl script complet access entir openmm applic program interfac api well full power python languag librari complet control everi detail simul defin molecular system analyz result _installingopenmm instal openmm openmm instal use conda packag manag httpsdocscondaio conda includ part anaconda python distribut download httpsdocscontinuumioanacondainstal python distribut specif design scientif applic mani popular mathemat scientif packag preinstal altern use miniconda avail httpsdocscondaioenlatestminicondahtml includ python plu conda packag manag offer much smaller initi download abil instal packag want third option compil openmm sourc provid flexibl much work rare need anyon advanc user compil sourc detail instruct chapter numrefcompilingopenmmfromsourcecod begin instal recent bit python x version either anaconda miniconda option want run openmm gpu make sure instal modern driver vendor nvidia gpu download latest driver httpswwwnvidiacomdownloadindexaspx cuda provid codecudatoolkit packag instal codeopenmm next step amd gpu use linux window download latest version driver httpssupportamdcom os x opencl includ oper system support os x later open command line termin type follow command conda instal c condaforg openmm recent codeconda version v instal version openmm compil latest version cuda support driver altern request version compil specif cuda version command conda instal c condaforg openmm cudatoolkit code replac particular cuda version want target build packag cuda linux cuda window differ cuda releas binari compat openmm work particular cuda version compil note prior v conda packag openmm distribut codeomnia channel httpsanacondaorgomnia start v openmm use codecondaforg channel check document previou version case want instal older packag verifi instal type follow command python openmmtestinstal command confirm openmm instal check whether gpu acceler avail via opencl andor cuda platform verifi platform produc consist result defaultdomain py _runningsimul run simul _afirstexampl first exampl let begin first exampl openmm script load pdb file call fileinputpdb defin biomolecular system parameter use amber forc field tippfb water model energi minim simul step langevin integr save snapshot frame pdb file call fileoutputpdb everi time step samepag openmmapp import openmm import openmmunit import sy import stdout pdb pdbfileinputpdb forcefield forcefieldamberallxml ambertippfbxml system forcefieldcreatesystempdbtopolog nonbondedmethodpm nonbondedcutoffnanomet constraintshbond integr langevinmiddleintegratorkelvin picosecond picosecond simul simulationpdbtopolog system integr simulationcontextsetpositionspdbposit simulationminimizeenergi simulationreportersappendpdbreporteroutputpdb simulationreportersappendstatedatareporterstdout steptru potentialenergytru temperaturetru simulationstep caption autonumberexamplepdb exampl find script fileexampl folder openmm instal call filesimulatepdbpi execut command line go terminalconsolecommand prompt window see section numrefinstallingopenmm set window use openmm navig fileexampl folder type cd examples_directori typic directori fileusrlocalopenmmexampl linux mac machin filecprogram filesopenmmexampl window machin type python simulatepdbpi name script whatev want let go script line line see work openmmapp import openmm import openmmunit import sy import stdout line tell python interpret librari use dont worri exactli mean includ start script pdb pdbfileinputpdb line load pdb file disk fileinputpdb file fileexampl directori contain villin headpiec explicit solvent precis creat classpdbfil object pass file name fileinputpdb argument assign object variabl call codepdb classpdbfil object contain inform read file molecular topolog atom posit file need call fileinputpdb feel free chang line specifi file want though must contain atom need forc field inform add miss atom residu use openmm tool found chapter numrefmodelbuildingandedit make sure includ singl quot around file name openmm also load file newer pdbxmmcif format chang classpdbfil classpdbxfil forcefield forcefieldamberallxml ambertippfbxml line specifi forc field use simul forc field defin xml file openmm includ xml file defin lot standard forc field see section numrefforcefield find need extend repertoir forc field avail find inform creat xml file chapter numrefcreatingforcefield case load two file fileamberallxml contain amber forc field fileambertippfbxml contain tippfb water model classforcefield object assign variabl call codeforcefield system forcefieldcreatesystempdbtopolog nonbondedmethodpm nonbondedcutoffnanomet constraintshbond line combin forc field molecular topolog load pdb file creat complet mathemat descript system want simul precis invok classforcefield object methcreatesystem function creat classsystem object assign variabl codesystem specifi addit option use particl mesh ewald long rang electrostat interact codenonbondedmethodpm use nm cutoff direct space interact codenonbondedcutoffnanomet constrain length bond involv hydrogen atom codeconstraintshbond note way specifi cutoff distanc nm use codenanomet exampl power unit track automat convers facil built openmm python api make specifi unitbear quantiti conveni less errorpron could equival specifi codeangstrom instead codenanomet achiev result unit system describ detail later section numrefunitsanddimensionalanalysi integr langevinmiddleintegratorkelvin picosecond picosecond line creat integr use advanc equat motion specifi classlangevinmiddleintegr perform langevin dynam assign variabl call codeintegr also specifi valu three paramet specif langevin dynam simul temperatur k friction coeffici ps sup step size ps lot integr method also avail exampl want simul system constant energi rather constant temperatur would use codeverletintegr avail integr method list section numrefintegr simul simulationpdbtopolog system integr line combin molecular topolog system integr begin new simul creat classsimul object assign variabl call codesimul classsimul object manag process involv run simul advanc time write output simulationcontextsetpositionspdbposit line specifi initi atom posit simul case posit load pdb file simulationminimizeenergi line tell openmm perform local energi minim usual good idea start simul sinc coordin pdb file might produc larg forc simulationreportersappendpdbreporteroutputpdb line creat report gener output simul add classsimul object list report classpdbreport write structur pdb file specifi output file call fileoutputpdb structur written everi time step simulationreportersappendstatedatareporterstdout steptru potentialenergytru temperaturetru use get regular statu report simul run monitor progress line add anoth report print basic inform everi time step current step index potenti energi system temperatur specifi codestdout quot output file mean write result consol also could given file name quot classpdbreport write inform file simulationstep final run simul integr equat motion time step finish load pdb file program want analysi visual vmd_ pymol_ ambertools_ etc _vmd httpwwwksuiuceduresearchvmd _pymol httpwwwpymolorg _ambertool httpambermdorg _using_amber_fil use amber file openmm build system sever differ way one option shown start pdb file select forc field model altern use ambertools_ model system case provid classprmtop file classinpcrd file openmm load file creat classsystem illustr follow script found openmm fileexampl folder name filesimulateamberpi samepag openmmapp import openmm import openmmunit import sy import stdout prmtop amberprmtopfileinputprmtop inpcrd amberinpcrdfileinputinpcrd system prmtopcreatesystemnonbondedmethodpm nonbondedcutoffnanomet constraintshbond integr langevinmiddleintegratorkelvin picosecond picosecond simul simulationprmtoptopolog system integr simulationcontextsetpositionsinpcrdposit inpcrdboxvector none simulationcontextsetperiodicboxvectorsinpcrdboxvector simulationminimizeenergi simulationreportersappendpdbreporteroutputpdb simulationreportersappendstatedatareporterstdout steptru potentialenergytru temperaturetru simulationstep caption autonumberexampleamb exampl script similar previou one signific differ prmtop amberprmtopfileinputprmtop inpcrd amberinpcrdfileinputinpcrd line load prmtop file inpcrd file precis creat classamberprmtopfil classamberinpcrdfil object assign variabl codeprmtop codeinpcrd respect chang line specifi file want sure includ singl quot around file name note classamberprmtopfil reader provid openmm support newstyl fileprmtop file introduc amber amber distribut still contain number exampl file oldstyl fileprmtop format oldstyl file run openmm next classsystem object creat differ way system prmtopcreatesystemnonbondedmethodpm nonbondedcutoffnanomet constraintshbond previou section load topolog pdb file forc field creat system base case dont need forc field fileprmtop file alreadi contain forc field paramet creat system directli simul simulationprmtoptopolog system integr simulationcontextsetpositionsinpcrdposit notic get topolog fileprmtop file atom posit fileinpcrd file previou section came pdb file amber put topolog posit separ file also add follow line inpcrdboxvector none simulationcontextsetperiodicboxvectorsinpcrdboxvector period system fileprmtop file specifi period box vector pdb file call methcreatesystem set default period box vector use automat simul howev fileinpcrd may also specifi period box vector want use one instead exampl system equilibr barostat box vector may chang equilibr therefor check see fileinpcrd file contain box vector call methsetperiodicboxvector tell use one overrid default one provid classsystem _using_gromacs_fil use gromac file third option creat system use gromac setup tool produc filegro file contain coordin filetop file contain topolog openmm load exactli amber file shown follow script found openmm fileexampl folder name filesimulategromacspi samepag openmmapp import openmm import openmmunit import sy import stdout gro gromacsgrofileinputgro top gromacstopfileinputtop periodicboxvectorsgrogetperiodicboxvector includedirusrlocalgromacssharegromacstop system topcreatesystemnonbondedmethodpm nonbondedcutoffnanomet constraintshbond integr langevinmiddleintegratorkelvin picosecond picosecond simul simulationtoptopolog system integr simulationcontextsetpositionsgroposit simulationminimizeenergi simulationreportersappendpdbreporteroutputpdb simulationreportersappendstatedatareporterstdout steptru potentialenergytru temperaturetru simulationstep caption autonumberexamplegromac exampl script nearli ident previou one replac classamberinpcrdfil classamberprmtopfil classgromacsgrofil classgromacstopfil note creat classgromacstopfil specifi valu two extra option first specifi codeperiodicboxvectorsgrogetperiodicboxvector unlik openmm amber store period unit cell inform topolog gromac store coordin let classgromacstopfil creat classtopolog object therefor need tell period box vector load filegro file need simul period system implicit solvent simul usual omit second specifi codeincludedirusrlocalgromacssharegromacstop unlik amber store forc field paramet directli fileprmtop file gromac store refer forc field definit file instal gromac applic openmm need know find file codeincludedir paramet specifi directori contain omit paramet openmm assum default locat fileusrlocalgromacssharegromacstop often instal unixlik oper system autonumrefexamplegromac exampl actual could omit paramet gromac file instal locat would need includ _usingcharmmfil use charmm file yet anoth option load file creat charmm setup tool compat tool vmd includ filepsf file contain topolog inform ordinari pdb file atom coordin coordin also load charmm coordin restart file use classcharmmcrdfil classcharmmrstfil class addit must provid set file contain forc field definit use involv sever differ file vari format filenam extens filepar fileprm filetop filertf fileinp filestr load definit file classcharmmparameterset object includ object first paramet call methcreatesystem classcharmmpsffil samepag openmmapp import openmm import openmmunit import sy import stdout exit stderr psf charmmpsffileinputpsf pdb pdbfileinputpdb param charmmparametersetcharmmrtf charmmprm system psfcreatesystemparam nonbondedmethodnocutoff nonbondedcutoffnanomet constraintshbond integr langevinmiddleintegratorkelvin picosecond picosecond simul simulationpsftopolog system integr simulationcontextsetpositionspdbposit simulationminimizeenergi simulationreportersappendpdbreporteroutputpdb simulationreportersappendstatedatareporterstdout steptru potentialenergytru temperaturetru simulationstep caption autonumberexamplecharmm exampl note charmm xplor version filepsf file format support _thescriptbuilderappl openmmsetup applic one way creat script start one exampl given custom suit need there even easier option openmmsetup graphic applic walk whole process load input file set option gener complet script even run figur imagesopenmmsetuppng align center width autonumberfigureopenmm setup openmmsetup applic instal openmmsetup open command line termin type follow command conda instal c condaforg openmmsetup launch type command openmmsetup automat open window web browser display user interfac openmmsetup far script gener fix problem input file add miss atom build membran water box much easi way quickli necessari prepar setup highli recommend user openmm novic expert _simulationparamet simul paramet let consid lot way might want custom script platform creat classsimul option tell classplatform use openmm includ four platform classrefer classcpu classcuda classopencl descript differ see section numrefplatform three way classplatform chosen default openmm tri select fastest avail classplatform usual choic reason sometim may want chang altern set envvaropenmm_default_platform environ variabl name classplatform use overrid default logic final explicitli specifi classplatform object script creat classsimul follow line specifi use classcuda platform platform platformgetplatformbynamecuda simul simulationprmtoptopolog system integr platform platform name one codeopencl codecuda codecpu coderefer also specifi platformspecif properti custom calcul done see chapter numrefplatformspecificproperti detail properti platform support exampl follow line specifi parallel work across two differ gpu cuda devic comput doubl precis platform platformgetplatformbynamecuda properti deviceindex precis doubl simul simulationprmtoptopolog system integr platform properti _forcefield forc field creat forc field specifi one xml file load forc field definit often one file defin main forc field possibl second file defin water model either implicit explicit exampl forcefield forcefieldamberallxml ambertippfbxml case one xml file may load sever other exampl fileamberallxml realli shortcut load sever differ file togeth make amber forc field need finer grain control paramet load instead specifi compon file individu awar forc field water model includ extra particl lone pair drude particl exampl includ charmm polariz forc field site water model use forc field must first add extra particl classtopolog see section numrefaddingorremovingextraparticl detail forc field describ one bundl openmm addit forc field avail onlin httpsgithubcomchoderalabopenmmforcefield amber amber citemai forc field made variou file defin paramet protein dna rna lipid water ion tabularcolumn file paramet fileamberproteinffsbxml protein recommend fileamberproteinffipqxml protein altern fileamberdnaolxml dna recommend fileamberdnabscxml dna altern fileamberrnaolxml rna fileamberlipidxml lipid fileamberglycam_jxml carbohydr glycosyl protein citekirschn fileambertippxml tipp water model citejorgensen ion fileambertippfbxml tippfb water model citewang ion fileambertippewxml tippew water model citehorn ion fileambertippfbxml tippfb water model citewang ion fileamberspcexml spce water model citeberendsen ion conveni file fileamberallxml use shortcut includ fileamberproteinffsbxml fileamberdnaolxml fileamberrnaolxml fileamberlipidxml case simpli includ file plu one water model fileambertippfbxml tippfb water model ion citewang forcefield forcefieldamberallxml ambertippfbxml glycam includ default sinc quit larg system contain carbohydr includ file well forcefield forcefieldamberallxml ambertippfbxml amberglycam_jxml awar glycam work somewhat differ forc field use nonstandard name convent httplegacyglycamorgdocsforcefieldglycamnamingindexhtml_ carbohydr requir input file follow residu name differ expect glycam unabl assign paramet tip solvent model xml file includ fileamb directori includ water ion compat water model mistakenli specifi filetippxml instead fileambertippxml run risk classforcefield throw except sinc filetippxml miss paramet ion system convert paramet set come ambertool releas httpambermdorgambertoolsphp_ convert use openmmforcefield httpsgithubcomchoderalabopenmmforcefields_ packag parm httpsgithubcomparmedparmed_ charmm charmm citebest forc field provid paramet protein dna rna lipid carbohydr water ion variou small molecul see httpmackerellumarylandeducharmm_ffshtmlrefs_ full refer tabularcolumn file paramet filecharmmxml protein dna rna lipid carbohydr small molecul filecharmmwaterxml default charmm water model modifi version tipp citejorgensen ion filecharmmspcexml spce water model citeberendsen ion filecharmmtipppmebxml tipppmeb water model citepric ion filecharmmtipppmefxml tipppmef water model citepric ion filecharmmtippewxml tippew water model citehorn ion filecharmmtippxml tipp water model citeabasc ion filecharmmtippxml tipp water model citemahoney ion filecharmmtippewxml tippew water model citerick ion file filecharmmxml bundl everyth water ion singl file case simpli includ file plu one water model filecharmmwaterxml specifi default charmm water model modifi version tipp citejorgensen ion forcefield forcefieldcharmmxml charmmwaterxml warn drude polariz site lone pair yet support parm httpsgithubcomparmedparmed_ charmm forcefield depend featur includ port use charmm polariz forc field citelop includ singl file filecharmm_polar_xml tip solvent model xml file includ filecharmm directori includ water ion compat water model mistakenli specifi filetippxml instead filecharmmwaterxml run risk classforcefield rais except due miss paramet ion system tip charmm make extens use patch automat combin residu templat creat expand librari patch residu templat classforcefield mean patch residu ace nme patch termini must occur singl residu order classforcefield correctli match residu templat appli paramet sinc patch residu standard pdb residu classmodel know add hydrogen nonstandard residu input topolog must alreadi contain appropri hydrogen often caus problem tri read pdb file sourc charmmgui httpcharmmguiorg_ gener pdb file compli pdb standard httpwwwwwpdborgdocumentationfileformat_ your use file charmmgui httpcharmmguiorg_ easiest load psf file directli discuss section numrefusingcharmmfil tip tri read pdb file sourc charmmgui httpcharmmguiorg_ gener pdb file compli pdb standard httpwwwwwpdborgdocumentationfileformat_ omit conect record specifi bond residu cystein includ conect record specifi nonchem hh bond water caus issu detect paramet assign disulfid bond make sure file read compli appropri standard regard addit bond nonstandard residu definit your use file charmmgui httpcharmmguiorg_ easiest load psf file directli discuss section numrefusingcharmmfil convert paramet set come charmm juli updat httpmackerellumarylandeducharmm_ffshtml_ convert use openmmforcefield httpsgithubcomchoderalabopenmmforcefields_ packag parm httpsgithubcomparmedparmed_ implicit solvent amber charmm forc field describ use gener born implicit solvent model amber use includ extra file creat forcefield exampl forcefield forcefieldamberallxml implicitgbnxml tabularcolumn file implicit solvent model fileimplicithctxml hawkinscramertruhlar gbsa model citehawkin correspond igb amber fileimplicitobcxml onufrievbashfordcas gbsa model citeonufriev use gb supobc paramet correspond igb amber fileimplicitobcxml onufrievbashfordcas gbsa model citeonufriev use gb supobc ii paramet correspond igb amber fileimplicitgbnxml gbn solvat model citemongan correspond igb amber fileimplicitgbnxml gbn solvat model citenguyen correspond igb amber nonbond method support implicit solvent codenocutoff default codecutoffnonperiod codecutoffperiod choos use nonbond cutoff implicit solvent usual best set cutoff distanc larger typic explicit solvent cutoff nm give good result case period boundari condit usual use implicit solvent fact lack need period artifact creat one advantag implicit solvent option still offer sinc could use unusu situat control solvat model way first specifi dielectr constant use solut solvent system forcefieldcreatesystemtopolog solutedielectr solventdielectr specifi solut solvent dielectr constant default respect also model effect nonzero salt concentr specifi debyehuckel screen paramet citesrinivasan system forcefieldcreatesystemtopolog implicitsolventkappananomet screen paramet calcul math kappa sqrtfraciepsilon mathi ionic strength moleslit mathepsilon solvent dielectr constant matht temperatur kelvin amoeba amoeba polariz forc field provid paramet protein nucleic acid water ion tabularcolumn file paramet fileamoebaxml amoeba citeshi fileamoeba_gkxml gener kirkwood solvat model citeschnied use amoeba forc field fileamoebaxml amoeba forc field deprec recommend use amoeba instead fileamoeba_gkxml gener kirkwood solvat model use amoeba forc field fileamoebaxml amoeba citeren forc field deprec recommend use amoeba instead fileamoeba_gkxml gener kirkwood solvat model use amoeba forc field explicit solvent simul includ singl file fileamoebaxml amoeba also support implicit solvent use gener kirkwood model enabl also includ fileamoeba_gkxml older amoeba forc field provid backward compat recommend simul charmm polariz forc field use charmm polariz forc field citelop includ singl file filecharmm_polar_xml includ paramet protein lipid water ion use forc field rememb add extra particl classtopolog describ section numrefaddingorremovingextraparticl forc field also requir use one special integr support drude particl option drudelangevinintegr drudenosehooverintegr drudescfintegr older forc field openmm includ sever older forc field well simul newer forc field describ prefer still use reproduc older result tabularcolumn file forc field codeamberxml amber citekollman codeambersbxml amber citewang modifi backbon torsion citehornak codeambersbildnxml ambersb plu improv side chain torsion citelindorfflarsen codeambersbnmrxml ambersb modif fit nmr data cite codeamberxml amber citeduan codeamberxml amber document ambertools_ manual ff codecharmm_polar_xml version charmm polariz forc field citelop sever forc field support implicit solvent enabl also includ correspond obc file tabularcolumn file implicit solvat model codeamber_obcxml gbsaobc solvat model citeonufriev use amber forc field codeamber_obcxml gbsaobc solvat model use amber forc field variant codeamber_obcxml gbsaobc solvat model use amber forc field codeamber_obcxml gbsaobc solvat model use amber forc field note gbsaobc paramet file use tinker citetink design use amber forc field differ paramet found amber applic water model follow file defin popular water model use forc field provid water model use amber charmm use water file includ forc field instead sinc also includ ion paramet tabularcolumn file water model codetippxml tipp water model citejorgensen codetippfbxml tippfb water model citewang codetippewxml tippew water model citehorn codetippfbxml tippfb water model citewang codetippxml tipp water model citemahoney codespcexml spce water model citeberendsen codeswmndpxml swmndp water model citelamoureux small molecul paramet openmm forc field includ pregener templat biopolym solvent system instead contain small molecul often necessari gener paramet fli two option within openmm app ecosystem small molecul residu templat gener one approach use residu templat gener small molecul openmmforcefields_ conda packag instal via conda codeblock bash conda instal c condaforg openmmforcefield add small molecul residu templat gener use open forc field initi small molecul forc field use follow exampl creat openff molecul object benzen smile openfftoolkittopolog import molecul molecul moleculefrom_smilescccccc creat smirnoff templat gener default instal forc field openff openmmforcefieldsgener import smirnofftemplategener smirnoff smirnofftemplategeneratormoleculesmolecul creat openmm forcefield object amber ffsb tipp compat ion openmmapp import forcefield forcefield forcefieldamberproteinffsbxml ambertipp_standardxml ambertipp_hfe_multivalentxml regist smirnoff templat gener forcefieldregistertemplategeneratorsmirnoffgener altern use older amber gaff small molecul forc field httpambermdorgantechambergaffhtml_ creat openff molecul object benzen smile openfftoolkittopolog import molecul molecul moleculefrom_smilescccccc creat gaff templat gener openmmforcefieldsgener import gafftemplategener gaff gafftemplategeneratormoleculesmolecul creat openmm forcefield object amber ffsb tipp compat ion openmmapp import forcefield forcefield forcefieldamberproteinffsbxml ambertipp_standardxml ambertipp_hfe_multivalentxml regist gaff templat gener forcefieldregistertemplategeneratorgaffgener parameter openmm topolog object contain specifi molecul forcefield load appropri gaff paramet need antechamb use gener small molecul paramet fli openmmapp import pdbfile pdbfile pdbfiletlysozymelawithbenzenepdb system forcefieldcreatesystempdbfiletopolog document found openmmforcefields_ page manag forc field systemgener altern explicitli regist templat gener openmmforcefields_ packag provid systemgener facil simplifi biopolym small molecul forc field manag use simpli specifi small molecul forc field want use defin keyword argument feed forcefield openmm import unit app forcefield_kwarg constraint apphbond rigidwat true removecmmot fals hydrogenmass unitamu initi systemgener use gaff openmmforcefieldsgener import systemgener system_gener systemgeneratorforcefieldsamberffsbxml ambertipp_standardxml small_molecule_forcefieldgaff forcefield_kwargsforcefield_kwarg cachedbjson creat openmm system openmm topolog object system system_generatorcreate_systemopenmm_topolog altern creat openmm system openmm topolog object list openff molecul object molecul moleculefrom_filemoleculessdf file_formatsdf system system_generatorcreate_systemopenmm_topolog moleculesmolecul systemgener match instanc molecul found moleculessdf appear topolog note proton tautomer state must match exactli molecul read appear topolog see openmmforcefields_ document detail _openmmforcefield httpgithubcomopenmmopenmmforcefield amber implicit solvent creat system prmtop file specifi forc field file need differ way tell use implicit solvent done codeimplicitsolv paramet system prmtopcreatesystemimplicitsolventobc openmm support gener born model use amber allow valu codeimplicitsolv tabularcolumn valu mean codenon implicit solvent use codehct hawkinscramertruhlar gbsa model citehawkin correspond igb amber codeobc onufrievbashfordcas gbsa model citeonufriev use gb supobc paramet correspond igb amber codeobc onufrievbashfordcas gbsa model citeonufriev use gb supobc ii paramet correspond igb amber model use gbsaobc file describ section numrefforcefield codegbn gbn solvat model citemongan correspond igb amber codegbn gbn solvat model citenguyen correspond igb amber control solvat model way first specifi dielectr constant use solut solvent system prmtopcreatesystemimplicitsolventobc solutedielectr solventdielectr specifi solut solvent dielectr default respect valu chosen consist amber slightli differ use elsewher openmm build system forc field solvent dielectr default also model effect nonzero salt concentr specifi debyehuckel screen paramet citesrinivasan system prmtopcreatesystemimplicitsolventobc implicitsolventkappananomet nonbond interact creat system either forc field prmtop file specifi option nonbond interact treat system prmtopcreatesystemnonbondedmethodpm nonbondedcutoffnanomet codenonbondedmethod paramet follow valu tabularcolumn valu mean codenocutoff cutoff appli codecutoffnonperiod reaction field method use elimin interact beyond cutoff distanc valid amoeba codecutoffperiod reaction field method use elimin interact beyond cutoff distanc period boundari condit appli atom interact nearest period copi everi atom valid amoeba codeewald period boundari condit appli ewald summat use comput long rang coulomb interact option rare use sinc pme much faster smallest system valid amoeba codepm period boundari condit appli particl mesh ewald method use comput long rang coulomb interact codeljpm period boundari condit appli particl mesh ewald method use comput long rang interact coulomb lennardjon use method codenocutoff also specifi cutoff distanc sure specifi unit shown exampl exampl codenonbondedcutoffnanomet codenonbondedcutoffangstrom legal valu use codeewald codepm codeljpm option specifi error toler forc comput exampl system prmtopcreatesystemnonbondedmethodpm nonbondedcutoffnanomet ewalderrortoler error toler roughli equal fraction error forc due truncat ewald summat specifi default valu use anoth option paramet use cutoff codeswitchdist caus lennardjon interact smoothli go zero finit rang rather sharpli truncat cutoff distanc improv energi conserv use specifi distanc interact start reduc exampl system prmtopcreatesystemnonbondedmethodpm nonbondedcutoffnanomet switchdistancenanomet nonbond forc amoeba amoeba forc field valid valu codenonbondedmethod codenocutoff codepm nonbond method codecutoffnonperiod codecutoffperiod codeewald unavail forc field implicit solvent run use amoeba codenonbondedmethod option codenocutoff avail lennardjon interact cutoff valu addit amoeba forc field cutoff lennardjon interact independ valu use electrostat interact may specifi use keyword codevdwcutoff system forcefieldcreatesystemnonbondedmethodpm nonbondedcutoffnanomet ewalderrortoler vdwcutoffnanomet codevdwcutoff specifi valu codenonbondedcutoff use lennardjon interact specifi polar method use amoeba forc field openmm allow induc dipol calcul three differ way slowest potenti accur method iter calcul dipol converg specifi toler select specifi codepolarizationmutu use codemutualinducedtargetepsilon option select toler situat valu work well altern specifi codepolarizationextrapol use analyt approxim citesimmonett estim fulli converg dipol without actual continu calcul converg mani case significantli faster small loss accuraci final specifi codepolarizationdirect use direct polar approxim induc dipol depend fix multipol induc dipol even faster produc differ forc mutual polar use forc field specif parameter use approxim exampl use method system forcefieldcreatesystemnonbondedmethodpm nonbondedcutoffnanomet vdwcutoffnanomet polarizationmutu mutualinducedtargetepsilon system forcefieldcreatesystemnonbondedmethodpm nonbondedcutoffnanomet vdwcutoffnanomet polarizationextrapol system forcefieldcreatesystemnonbondedmethodpm nonbondedcutoffnanomet vdwcutoffnanomet polarizationdirect implicit solvent solut dielectr implicit solvent simul use amoeba forc field fileamoeba_gkxml file includ initi forc field forcefield forcefieldamoebaxml amoeba_gkxml codenonbondedmethod option codenocutoff avail implicit solvent run use amoeba addit solvent solut dielectr valu specifi implicit solvent simul systemforcefieldcreatesystemnonbondedmethodnocutoff solutedielectr solventdielectr default valu solut dielectr solvent dielectr constraint creat system either forc field amber fileprmtop file option tell openmm constrain certain bond length angl exampl system prmtopcreatesystemnonbondedmethodnocutoff constraintshbond codeconstraint paramet follow valu tabularcolumn valu mean codenon constraint appli default valu codehbond length bond involv hydrogen atom constrain codeallbond length bond constrain codehangl length bond constrain addit angl form hxh hox x arbitrari atom constrain main reason use constraint allow one use larger integr time step constraint one typic limit time step fs typic biomolecular forc field like amber charmm codehbond constraint increas fs verlet dynam fs langevin dynam codehangl sometim increas even regardless valu paramet openmm make water molecul complet rigid constrain bond length angl disabl behavior coderigidwat paramet system prmtopcreatesystemnonbondedmethodnocutoff constraintsnon rigidwaterfals awar flexibl water may requir reduc integr step size typic fs note amoeba forcefield design use without constraint default openmm make amoeba water flexibl still forc rigid specifi coderigidwatertru heavi hydrogen creat system either forc field amber fileprmtop file option tell openmm increas mass hydrogen atom exampl system prmtopcreatesystemhydrogenmassamu appli hydrogen bond heavi atom mass ad hydrogen subtract heavi atom keep total mass constant slow fast motion hydrogen combin constraint typic codeconstraintsallbond often allow increas integr step size _integr integr openmm offer choic sever differ integr method select one use creat integr object appropri type detail descript integr found chapter numrefintegratorstheori addit built integr lot other avail part openmmtool httpsopenmmtoolsreadthedocsio_ packag langevin middl integr exampl previou section use langevin integr integr langevinmiddleintegratorkelvin picosecond picosecond three paramet valu line simul temperatur k friction coeffici ps sup step size ps free chang whatev valu want sure specifi unit valu exampl step size could written either codepicosecond codefemtosecond exactli equival note codelangevinmiddleintegr leapfrog integr veloc offset half time step posit langevin integr codelangevinintegr similar codelangevinmiddleintegr use differ discret langevin equat codelangevinmiddleintegr tend produc accur configur sampl therefor prefer applic also note codelangevinintegr like codelangevinmiddleintegr leapfrog integr veloc offset half time step posit nos√©hoov integr codenosehooverintegr use middl leapfrog propag algorithm codelangevinmiddleintegr replac stochast temperatur control veloc scale algorithm produc accur transport properti citebasconi veloc scale result propag chain extra variabl slightli reduc comput effici respect codelangevinmiddleintegr thermost integr minim creat syntax analog codelangevinmiddleintegr exampl nosehooverintegr integratorkelvin picosecond picosecond first argument specifi target temperatur second specifi frequenc interact heat bath lower valu interact minim yield microcanon ensembl limit zero frequenc larger frequenc perturb system greater keep closer target temperatur third argument integr timestep like argument must specifi unit initi equilibr target temperatur larger interact frequenc recommend eg ps sup integr support lot option includ abil coupl differ part system thermostat differ temperatur see api document detail leapfrog verlet integr leapfrog verlet integr use run constant energi dynam command integr verletintegratorpicosecond option step size brownian integr brownian diffus dynam use specifi follow integr brownianintegratorkelvin picosecond picosecond paramet langevin dynam temperatur k friction coeffici ps sup step size ps variabl time step langevin integr variabl time step langevin integr continu adjust step size keep integr error specifi toler case allow use larger averag step size would possibl fix step size integr also use case know advanc step size stabl first equilibr system creat integr follow command integr variablelangevinintegratorkelvin picosecond place step size specifi integr error toler exampl best think valu absolut mean think adjust paramet affect step size integr accuraci smaller valu produc smaller averag step size tri differ valu find largest one produc trajectori suffici accur purpos variabl time step leapfrog verlet integr variabl time step leapfrog verlet integr work similarli variabl time step langevin integr continu adjust step size keep integr error specifi toler command integr integr variableverletintegr paramet integr error toler whose mean langevin integr multipl time step integr classmtsintegr class implement rrespa multipl time step algorithm citetuckerman allow forc system evalu frequent other detail use consult api document multipl time step langevin integr classmtslangevinintegr similar classmtsintegr use langevin method perform constant temperatur dynam detail use consult api document compound integr classcompoundintegr class use case want use multipl integr algorithm within singl simul allow creat multipl integr switch back forth detail use consult api document temperatur coupl want run simul constant temperatur use langevin integr shown exampl usual best way openmm provid altern howev use verlet integr add andersen thermostat system provid temperatur coupl add classandersenthermostat object classsystem shown system prmtopcreatesystemnonbondedmethodpm nonbondedcutoffnanomet constraintshbond systemaddforceandersenthermostatkelvin picosecond integr verletintegratorpicosecond two paramet andersen thermostat temperatur k collis frequenc ps sup pressur coupl exampl far constant volum simul want run constant pressur instead add mont carlo barostat system exactli way ad andersen thermostat previou section system prmtopcreatesystemnonbondedmethodpm nonbondedcutoffnanomet constraintshbond systemaddforcemontecarlobarostatbar kelvin integr langevinmiddleintegratorkelvin picosecond picosecond paramet mont carlo barostat pressur bar temperatur k barostat assum simul run constant temperatur anyth regul temperatur warn therefor critic alway use along langevin integr andersen thermostat specifi temperatur barostat integr thermostat otherwis get incorrect result also anisotrop barostat scale axi period box independ allow chang shape use anisotrop barostat specifi differ pressur axi follow line appli pressur bar along x axe pressur bar along z axi systemaddforcemontecarloanisotropicbarostat bar kelvin anoth featur anisotrop barostat appli certain axe period box keep size axe fix done pass three addit paramet specifi whether barostat appli axi follow line specifi x z axe period box scale axi chang size systemaddforcemontecarloanisotropicbarostat bar kelvin fals true fals third barostat design specif simul membran assum membran lie xy plane treat x axe box differ z axi also appli uniform surfac tension plane membran follow line add membran barostat appli pressur bar surfac tension barnm specifi x axe treat isotrop z axi free chang independ systemaddforcemontecarlomembranebarostatbar barnanomet montecarlomembranebarostatxyisotrop montecarlomembranebarostatzfre kelvin see api document detail allow paramet valu mean energi minim seen exampl perform local energi minim take singl line script simulationminimizeenergi case need two option paramet specifi want control minim first specifi toler energi consid converg simulationminimizeenergytolerancekilojoulemol specifi paramet default toler kjmole use second specifi maximum number iter simulationminimizeenergymaxiter minim exit specifi number iter reach even energi yet converg specifi paramet minim continu converg reach matter mani iter take option independ specifi want simulationminimizeenergytolerancekilojoulemol maxiter remov center mass motion default classsystem object creat openmm applic tool add classcmmotionremov remov center mass motion everi time step system whole drift time almost alway want rare situat may want allow system drift time specifi coderemovecmmot paramet creat system system forcefieldcreatesystempdbtopolog nonbondedmethodnocutoff removecmmotionfals write trajectori openmm save simul trajectori disk three format pdb_ pdbxmmcif_ dcd_ wide support format abl read analysi visual program _pdb httpwwwwwpdborgdocumentationformatvhtml _pdbxmmcif httpmmcifwwpdborg _dcd httpwwwksuiuceduresearchvmdpluginsmolfiledcdpluginhtml save trajectori add report simul shown exampl script simulationreportersappendpdbreporteroutputpdb two paramet classpdbreport output filenam often number time step output structur written use pdbxmmcif dcd format replac classpdbreport classpdbxreport classdcdreport paramet repres valu simulationreportersappenddcdreporteroutputdcd record data addit save trajectori may want record inform cours simul potenti energi temperatur openmm provid report purpos also creat classstatedatareport add simul simulationreportersappendstatedatareporterdatacsv timetru kineticenergytru potentialenergytru first two paramet output filenam often number time step valu written remain argument specifi valu written report avail option codestep index current time step codetim codeprogress percentag simul complet coderemainingtim estim long take simul complet codepotentialenergi codekineticenergi codetotalenergi codetemperatur codevolum volum period box codedens total system mass divid volum period box codespe estim quickli simul run includ either codeprogress coderemainingtim option must also includ codetotalstep paramet specifi total number time step includ simul one line written file report contain request valu default valu written commaseparatedvalu csv format use codesepar paramet choos differ separ exampl follow line caus valu separ space instead comma simulationreportersappendstatedatareporterdatatxt progresstru temperaturetru totalstep separ save simul progress result three builtin way save result simul openmm addit method written import packag like mdtraj parm simpli interest save structur write pdb file use codepdbfilewritefil see exampl model section numrefsavingtheresult hope save inform posit use codesimulationsavest save entir state simul includ posit veloc box dimens much xml file file load back openmm use continu simul importantli file text file transfer differ platform differ version openmm potenti downsid approach state file often quit larg may fit use case here exampl use simulationsavestateoutputxml load simul back simulationloadstateoutputxml third way save simul known checkpoint file save entir simul binari file allow exactli continu simul need aris though whether simul determinist depend platform method see numrefplatformspecificpropertiesdetermin import caveat approach howev binari use restart simul machin hardwar openmm version one save therefor use clear wont issu simulationsavecheckpointstatechk load back like simulationloadcheckpointstatechk final openmm come builtin report save checkpoint classcheckpointreport help restart simul fail unexpectedli due outsid reason eg server crash save checkpoint file everi step exampl simulationreportersappendcheckpointreportercheckpntchk note checkpoint report overwrit last checkpoint file enhanc sampl method mani situat goal simul sampl rang configur access system matter whether simul repres singl physic realist trajectori whether produc correct distribut state case varieti method use sampl configur space much quickli effici singl physic trajectori would known enhanc sampl method openmm offer sever choos briefli describ consult api document detail descript exampl code simul temper simul temper citemarinari involv make frequent chang temperatur simul high temperatur quickli cross energi barrier explor wide rang configur lower temperatur thoroughli explor local region configur space power method speed sampl know advanc motion want sampl simpli specifi rang temperatur simul algorithm handl everyth mostli automat metadynam metadynam citebarducci use know advanc motion want sampl specifi one collect variabl algorithm add bias potenti make simul explor wide rang valu variabl period ad bump bias potenti current valu collect variabl encourag simul move away region alreadi explor sampl wide rang valu end simul bias potenti use calcul free energi system function collect variabl acceler molecular dynam amd amd citehamelberg anoth method use know advanc motion want acceler alter potenti energi surfac ad boost potenti whenev potenti energi threshold make local minima shallow allow frequent transit boost appli total potenti energi subset interact typic dihedr torsion separ integr class option classamdintegr classamdforcegroupintegr classdualamdintegr defaultdomain py _creatingforcefield creat forc field openmm use simpl xml file format describ forc field includ mani common forc field also creat forc field use standard openmm forc class well flexibl custom forc class even extend forcefield class add support complet new forc one defin plugin make power tool forc field develop basic concept let start consid openmm defin forc field small number basic concept understand atom type atom class forc field paramet assign atom base atom type atom type specif identif atom ever need two atom type forc field alway treat ident everi way multipl atom type group togeth atom class gener two type class forc field usual necessarili alway treat ident exampl mathalpha carbon alanin residu probabl differ atom type mathalpha carbon leucin residu probabl atom class forc field paramet specifi either atom type atom class class exist conveni make forc field definit compact necessari could defin everyth term atom type mani type share paramet conveni specifi residu templat type assign atom match residu templat templat specifi list atom type one bond residu pdb file forc field search list templat one ident set atom ident bond match templat neither order atom name matter care element set bond pdb file reader care name cours sinc need figur atom line file correspond forc forc field defin atom type residu templat must defin forc field paramet gener involv one block xml forc object ad system detail differ forc gener consist set rule ad interact base bond atom type class exampl ad harmonicbondforc forc field loop everi pair bond atom check type class see match rule call codeaddbond harmonicbondforc none match simpli ignor pair continu write xml file root element xml file must codeforcefield tag codeblock xml forcefield forcefield codeforcefield tag contain follow children codeatomtyp tag contain atom type definit coderesidu tag contain residu templat definit option codepatch tag contain patch definit zero tag defin specif forc order tag matter describ detail atomtyp atom type definit look like codeblock xml atomtyp type name classn elementn mass type name classh elementh mass type name classct elementc mass atomtyp one codetyp tag atom type specifi name type name class belong symbol element mass amu name arbitrari string need number exampl requir type uniqu name class also arbitrari string gener uniqu two type belong class list valu codeclass attribut residu residu templat definit look like codeblock xml residu residu nameac atom namehh type atom namech type atom namehh type atom namehh type atom namec type atom nameo type bond atomnamehh atomnamech bond atomnamech atomnamehh bond atomnamech atomnamehh bond atomnamech atomnamec bond atomnamec atomnameo externalbond atomnamec residu residu nameala residu residu one coderesidu tag residu templat turn contain follow tag codeatom tag atom residu specifi name atom atom type codebond tag pair atom bond codeatomnam codeatomnam attribut name two bond atom older forc field use altern tag codeto codefrom specifi atom index instead name still support backward compat specifi atom name recommend sinc make residu definit much easier understand codeexternalbond tag atom bond atom differ residu codeatomnam name atom altern deprec codefrom tag may indic atom index instead name coderesidu tag may also contain codevirtualsit tag follow exampl codeblock xml residu namehoh atom nameo typetippewo atom nameh typetippewh atom nameh typetippewh atom namem typetippewm virtualsit typeaverag sitenamem atomnameo atomnameh atomnameh weight weight weight bond atomnameo atomnameh bond atomnameo atomnameh residu codevirtualsit tag indic atom residu repres virtual site codetyp attribut may equal codeaverag codeaverag codeoutofplan codelocalcoord correspond twoparticleaveragesit threeparticleaveragesit outofplanesit localcoordinatessit class respect codesitenam attribut give name atom repres virtual site atom calcul base specifi codeatomnam codeatomnam etc old forc field use deprec tag codeindex codeatom codeatom etc refer index instead name remain attribut specif virtual site class specifi paramet calcul site posit twoparticleaveragesit codeweight codeweight threeparticleaveragesit codeweight codeweight codeweight outofplanesit codeweight codeweight codeweightcross localcoordinatessit codep codep codep give x z coordin site posit local coordin system codewo codewx codewi codewo codewx codewi give weight comput origin x axi axi patch patch set rule modifi residu templat possibl multipl templat exampl termin amino acid slightli differ one middl chain forc field could cours defin multipl templat amino acid standard ntermin ctermin monom sinc modif nearli amino acid simpler includ standard templat along set patch modifi termin residu exampl patch definit codeblock xml patch patch nament removeatom nameh removebond atomnamen atomnameh addatom nameh typeh addatom nameh typeh addatom nameh typeh addbond atomnamen atomnameh addbond atomnamen atomnameh addbond atomnamen atomnameh removeexternalbond atomnamen changeatom namen typen patch patch one codepatch tag patch definit turn may contain follow tag codeaddatom tag indic atom ad templat specifi name atom atom type codechangeatom tag indic type atom alreadi present templat alter specifi name atom new atom type coderemoveatom tag indic atom remov templat specifi name atom remov codeaddbond tag indic bond ad templat specifi name two bond atom coderemovebond tag indic bond alreadi present templat remov specifi name two bond atom codeaddexternalbond tag indic new extern bond ad templat specifi name bond atom coderemoveexternalbond tag indic extern bond aleadi present templat remov specifi name bond atom addit defin patch also must identifi residu templat patch appli done two way common one templat identifi patch appli done codeallowpatch tag codeblock xml residu nameala allowpatch namect allowpatch nament residu altern patch indic residu may appli done codeapplytoresidu tag codeblock xml patch nament applytoresidu nameala applytoresidu namearg patch patch alter multipl templat use creat bond molecul allow atom type one residu depend ident residu bond creat multiresidu patch ad coderesidu attribut codepatch tag specifi mani residu patch cover whenev refer atom prefix name index residu belong codeblock xml patch namedisulfid residu removeatom namehg removeatom namehg addbond atomnamesg atomnamesg applytoresidu nameci applytoresidu nameci patch exampl patch modifi two residu type need alway true codeapplytoresidu tag therefor indic one residu templat modifi may specifi type similarli residu templat includ codeacceptpatch tag multiresidu patch must specifi name patch follow index residu within patch codeblock xml allowpatch namedisulfid miss residu templat caution featur experiment api subject chang use methgetunmatchedresidu method get list residu provid codetopolog object current match residu templat defin classforcefield pdb pdbfileinputpdb forcefield forcefieldambersbxml tippxml unmatched_residu forcefieldgetunmatchedresiduestopolog use identifi issu prepar system debug issu residu templat definit identifi addit residu need parameter conveni parameter new residu also get list residu empti residu templat use methgeneratetemplatesforunmatchedresidu pdb pdbfileinputpdb forcefield forcefieldambersbxml tippxml templat residu forcefieldgeneratetemplatesforunmatchedresiduestopolog se atom type templat templat atom templateatom atomtyp set atom type regist templat forcefield forcefieldregisterresiduetemplatetempl find templat seem incorrectli match anoth use function methgetmatchingtempl help identifi templat match pdb pdbfileinputpdb forcefield forcefieldambersbxml tippxml templat forcefieldgetmatchingtemplatestopolog residu templat zippdbtopologyresidu templat printresidu match templat residueid residuenam templatenam harmonicbondforc add harmonicbondforc system includ tag look like codeblock xml harmonicbondforc bond classc classc length k bond classc classca length k bond classc classcb length k harmonicbondforc everi codebond tag defin rule creat harmon bond interact atom tag may identifi atom either type use attribut codetyp codetyp class use attribut codeclass codeclass everi pair bond atom forc field search rule whose atom type atom class match two atom find one call codeaddbond harmonicbondforc specifi paramet otherwis ignor pair continu codelength equilibrium bond length nm codek spring constant kjmolnm sup harmonicangleforc add harmonicangleforc system includ tag look like codeblock xml harmonicangleforc angl classc classc classo angl k angl classc classc classoh angl k angl classca classc classca angl k harmonicangleforc everi codeangl tag defin rule creat harmon angl interact triplet atom tag may identifi atom either type use attribut codetyp codetyp class use attribut codeclass codeclass forc field identifi everi set three atom system first bond second second third one search rule whose atom type atom class match three atom find one call codeaddangl harmonicangleforc specifi paramet otherwis ignor set continu codeangl equilibrium angl radian codek spring constant kjmolradian sup periodictorsionforc add periodictorsionforc system includ tag look like codeblock xml periodictorsionforc proper classhc classct classct classct period phase k proper classhc classct classct classhc period phase k improp classn classc classct classo period phase k improp classn classc classct classh period phase k periodictorsionforc everi child tag defin rule creat period torsion interact set four atom tag may identifi atom either type use attribut codetyp codetyp class use attribut codeclass codeclass forc field recogn two differ type torsion proper improp proper torsion involv four atom bond sequenc improp torsion involv central atom three other bond atom bond atom forc field begin identifi everi set atom system type one search rule whose atom type atom class match four atom find one call codeaddtors periodictorsionforc specifi paramet otherwis ignor set continu codeperiod period torsion codephas phase offset radian codek forc constant kjmol torsion definit specifi multipl period torsion term add atom add second one add three attribut codeperiod codephas codek mani term want exampl rule add three torsion term atom codeblock xml proper classct classct classct classct period phase k period phase k period phase k also use wildcard defin torsion simpli leav type class name atom empti caus match atom exampl follow definit match sequenc atom second atom class os third class p codeblock xml proper class classo classp class period phase k codeperiodictorsionforc tag also support option codeord attribut provid better compat way improp assign differ simul packag codeorderingdefault specifi default behavior attribut omit codeorderingamb produc behavior replic behavior ambertool leap codeorderingcharmm produc behavior consist charmm codeorderingsmirnoff allow multipl improp ad use exact match replic beheavior smirnoff httpsopenforcefieldtoolkitreadthedocsioenlatestuserssmirnoffhtml_ improp differ codeperiodictorsionforc tag specifi differ codeord valu use subel appear within tag rbtorsionforc add rbtorsionforc system includ tag look like codeblock xml rbtorsionforc proper classct classct classo classct c c c c c c proper classc classn classct classc c c c c c c improp classn classc classct classo c c c c c c improp classn classc classct classh c c c c c c rbtorsionforc everi child tag defin rule creat ryckaertbelleman torsion interact set four atom tag may identifi atom either type use attribut codetyp codetyp class use attribut codeclass codeclass forc field recogn two differ type torsion proper improp proper torsion involv four atom bond sequenc improp torsion involv central atom three other bond atom bond atom forc field begin identifi everi set atom system type one search rule whose atom type atom class match four atom find one call codeaddtors rbtorsionforc specifi paramet otherwis ignor set continu attribut codec codec coeffici term ryckaertbelleman forc express also use wildcard defin torsion simpli leav type class name atom empti caus match atom exampl follow definit match sequenc atom second atom class os third class p codeblock xml proper class classo classp class c c c c c c cmaptorsionforc add cmaptorsionforc system includ tag look like codeblock xml cmaptorsionforc map map torsion map classct classct classc classn classct torsion map classn classct classc classn classct cmaptorsionforc codemap tag defin energi correct map content list energi valu kjmole list correct order cmaptorsionforc codeaddmap method separ white space see api document detail size map determin number energi valu codetors tag defin rule creat cmap torsion interact set five atom tag may identifi atom either type use attribut codetyp codetyp class use attribut codeclass codeclass forc field identifi everi set five atom bond sequenc one search rule whose atom type atom class match five atom find one call codeaddtors cmaptorsionforc specifi paramet otherwis ignor set continu first torsion defin sequenc atom second one atom codemap index map use start order list file also use wildcard defin torsion simpli leav type class name atom empti caus match atom exampl follow definit match sequenc five atom middl three class ct c n respect codeblock xml torsion map class classct classc classn class nonbondedforc add nonbondedforc system includ tag look like codeblock xml nonbondedforc coulombscal ljscale atom type charg sigma epsilon atom type charg sigma epsilon atom type charg sigma epsilon nonbondedforc codenonbondedforc tag two attribut codecoulombscal codeljscal specifi scale factor pair atom separ three bond set nonbond paramet atom forc field call codecreateexceptionsfrombond nonbondedforc pass scale factor argument codeatom tag specifi nonbond paramet one atom type specifi codetyp attribut atom class specifi codeclass attribut fine mix two method tag specifi type other specifi class howev must make sure uniqu set paramet defin everi atom type codecharg measur unit proton charg codesigma nm codeepsilon kjmole gbsaobcforc add gbsaobcforc system includ tag look like codeblock xml gbsaobcforc atom type charg radiu scale atom type charg radiu scale atom type charg radiu scale gbsaobcforc codeatom tag specifi obc paramet one atom type specifi codetyp attribut atom class specifi codeclass attribut fine mix two method tag specifi type other specifi class howev must make sure uniqu set paramet defin everi atom type codecharg measur unit proton charg coderadiu gbsa radiu nm codescal obc scale factor custombondforc add custombondforc system includ tag look like codeblock xml custombondforc energyscalekrr globalparamet namescal defaultvalu perbondparamet namek perbondparamet namer bond classow classhw r k bond classhw classhw r k bond classc classc r k custombondforc energi express custombondforc specifi codeenergi attribut mathemat express give energi bond function length r also may depend arbitrari list global perbond paramet use codeglobalparamet tag defin global paramet codeperbondparamet tag defin perbond paramet everi codebond tag defin rule creat custom bond interact atom tag may identifi atom either type use attribut codetyp codetyp class use attribut codeclass codeclass everi pair bond atom forc field search rule whose atom type atom class match two atom find one call codeaddbond custombondforc otherwis ignor pair continu remain attribut valu use perbond paramet perbond paramet must specifi everi codebond tag attribut name must match name paramet instanc perbond paramet name k everi codebond tag must includ attribut call codek customangleforc add customangleforc system includ tag look like codeblock xml customangleforc energyscalekthetatheta globalparamet namescal defaultvalu perangleparamet namek perangleparamet name theta angl classhw classow classhw theta k angl classhw classhw classow theta k angl classc classc classo theta k customangleforc energi express customangleforc specifi codeenergi attribut mathemat express give energi angl function angl theta also may depend arbitrari list global perangl paramet use codeglobalparamet tag defin global paramet codeperangleparamet tag defin perangl paramet everi codeangl tag defin rule creat custom angl interact triplet atom tag may identifi atom either type use attribut codetyp codetyp class use attribut codeclass codeclass forc field identifi everi set three atom system first bond second second third one search rule whose atom type atom class match three atom find one call codeaddangl customangleforc otherwis ignor set continu remain attribut valu use perangl paramet perangl paramet must specifi everi codeangl tag attribut name must match name paramet instanc perangl paramet name k everi codeangl tag must includ attribut call codek customtorsionforc add customtorsionforc system includ tag look like codeblock xml customtorsionforc energyscalekcosperthetaphas globalparamet namescal defaultvalu pertorsionparamet namek pertorsionparamet namep pertorsionparamet namephas proper classhc classct classct classct per phase k proper classhc classct classct classhc per phase k improp classn classc classct classo per phase k improp classn classc classct classh per phase k customtorsionforc energi express customtorsionforc specifi codeenergi attribut mathemat express give energi torsion function angl theta also may depend arbitrari list global pertors paramet use codeglobalparamet tag defin global paramet codepertorsionparamet tag defin pertors paramet everi child tag defin rule creat custom torsion interact set four atom tag may identifi atom either type use attribut codetyp codetyp class use attribut codeclass codeclass forc field recogn two differ type torsion proper improp proper torsion involv four atom bond sequenc improp torsion involv central atom three other bond atom bond atom forc field begin identifi everi set atom system type one search rule whose atom type atom class match four atom find one call codeaddtors customtorsionforc specifi paramet otherwis ignor set continu remain attribut valu use per torsion paramet everi codetors tag must includ one attribut everi pertors paramet attribut name must match name paramet also use wildcard defin torsion simpli leav type class name atom empti caus match atom exampl follow definit match sequenc atom second atom class os third class p codeblock xml proper class classo classp class per phase k customnonbondedforc add customnonbondedforc system includ tag look like codeblock xml customnonbondedforc energyscaleepsilonepsilonsigmasigmar bondcutoff globalparamet namescal defaultvalu perparticleparamet namesigma perparticleparamet nameepsilon atom type sigma epsilon atom type sigma epsilon atom type sigma epsilon customnonbondedforc energi express customnonbondedforc specifi codeenergi attribut mathemat express give energi pairwis interact function distanc r also may depend arbitrari list global perparticl paramet use codeglobalparamet tag defin global paramet codeperparticleparamet tag defin perparticl paramet express may also depend comput valu defin codecomputedvalu tag tag two attribut codenam name comput valu codeexpress express use comput exclus creat automat base codebondcutoff attribut set nonbond paramet atom forc field call codecreateexclusionsfrombond customnonbondedforc pass valu argument avoid creat exclus set codebondcutoff codeatom tag specifi paramet one atom type specifi codetyp attribut atom class specifi codeclass attribut fine mix two method tag specifi type other specifi class howev must make sure uniqu set paramet defin everi atom type remain attribut valu use peratom paramet peratom paramet must specifi everi codeatom tag attribut name must match name paramet instanc peratom paramet name radiu everi codeatom tag must includ attribut call coderadiu customnonbondedforc also allow defin tabul function see section numreftabulatedfunct detail customgbforc add customgbforc system includ tag look like codeblock xml customgbforc globalparamet namesolventdielectr defaultvalu globalparamet namesolutedielectr defaultvalu perparticleparamet namecharg perparticleparamet nameradiu perparticleparamet namescal computedvalu namei typeparticlepairnoexclus steprsrorluulrsrsrrloglurc ursr corlstepsrror lmaxor dabsrsr sr scaleor radiu radiu computedvalu computedvalu nameb typesingleparticl ortanhpsipsipsiradiu psiior orradiu computedvalu energyterm typesingleparticl radiusradiusb solutedielectricsolventdielectricchargeb energyterm energyterm typeparticlepair solutedielectricsolventdielectricchargechargef fsqrtrbbexprbb energyterm atom type charg radiu scale atom type charg radiu scale atom type charg radiu scale customgbforc rather complic exampl defin gener born model equival gbsaobcforc definit consist set comput valu defin codecomputedvalu tag energi term defin codeenergyterm tag evalu accord mathemat express see api document detail express may depend arbitrari list global peratom paramet use codeglobalparamet tag defin global paramet codeperatomparamet tag defin peratom paramet codeatom tag specifi paramet one atom type specifi codetyp attribut atom class specifi codeclass attribut fine mix two method tag specifi type other specifi class howev must make sure uniqu set paramet defin everi atom type remain attribut valu use peratom paramet peratom paramet must specifi everi codeatom tag attribut name must match name paramet instanc peratom paramet name radiu everi codeatom tag must includ attribut call coderadiu customgbforc also allow defin tabul function see section numreftabulatedfunct detail customhbondforc add customhbondforc system includ tag look like codeblock xml customhbondforc particlesperdonor particlesperacceptor bondcutoff energyscalekdistanceadrangleaddtheta globalparamet namescal defaultvalu perdonorparamet nametheta peracceptorparamet namek peracceptorparamet namer donor classh classn classc theta acceptor classo classc k r customhbondforc energi express customhbondforc specifi codeenergi attribut mathemat express give energi donoracceptor interact function variou particl coordin distanc angl see api document detail codeparticlesperdonor specifi number particl make donor group codeparticlesperacceptor specifi number particl make acceptor group express may depend arbitrari list global perdonor peracceptor paramet use codeglobalparamet tag defin global paramet codeperdonorparamet tag defin perdonor paramet codeperacceptorparamet tag defin peracceptor paramet exclus creat automat base codebondcutoff attribut atom donor within specifi distanc measur bond atom acceptor exclus ad prevent interact donor acceptor share atom common bond distanc alway exclud everi codedonor codeacceptor tag defin rule creat donor acceptor group number atom specifi one must match valu codeparticlesperdonor codeparticlesperacceptor specifi parent tag tag may identifi atom either type use attribut codetyp codetyp class use attribut codeclass codeclass forc field consid everi atom system number atom everi pair bond atom number atom everi set three atom first bond second second third number atom one search rule whose atom type atom class match atom find one call codeadddonor codeaddacceptor customhbondforc otherwis ignor set continu remain attribut valu use perdonor peracceptor paramet paramet must specifi everi tag attribut name must match name paramet instanc perdonor paramet name k everi codedonor tag must includ attribut call codek customhbondforc also allow defin tabul function see section numreftabulatedfunct detail custommanyparticleforc add custommanyparticleforc system includ tag look like codeblock xml custommanyparticleforc particlesperset permutationmodeuniquecentralparticl bondcutoff energyscaledistancepprdistanceppr globalparamet namescal defaultvalu perparticleparamet namer typefilt index type atom type r filtertyp atom type r filtertyp atom type r filtertyp custommanyparticleforc energi express custommanyparticleforc specifi codeenergi attribut mathemat express give energi interact function variou particl coordin distanc angl see api document detail codeparticlesperset specifi number particl involv interact codepermutationmod specifi permut mode express may depend arbitrari list global peratom paramet use codeglobalparamet tag defin global paramet codeperatomparamet tag defin peratom paramet exclus creat automat base codebondcutoff attribut set nonbond paramet atom forc field call codecreateexclusionsfrombond custommanyparticleforc pass valu argument avoid creat exclus set codebondcutoff type filter may specifi codetypefilt tag codeindex attribut specifi index particl appli filter codetyp comma separ list allow type codeatom tag specifi paramet one atom type specifi codetyp attribut atom class specifi codeclass attribut fine mix two method tag specifi type other specifi class howev must make sure uniqu set paramet defin everi atom type addit codeatom tag must includ codefiltertyp attribut specifi atom type use type filter remain attribut valu use peratom paramet peratom paramet must specifi everi codeatom tag attribut name must match name paramet instanc peratom paramet name radiu everi codeatom tag must includ attribut call coderadiu custommanyparticleforc also allow defin tabul function see section numreftabulatedfunct detail write custom express custom forc describ chapter involv user defin algebra express express specifi charact string may involv varieti standard oper mathemat function follow oper support add subtract multipli divid power parenthes may use group follow standard function support sqrt exp log sin co sec csc tan cot asin aco atan sinh cosh tanh erf erfc min max ab floor ceil step delta select stepx x otherwis deltax x otherwis selectxyz z x otherwis custom forc allow addit function defin tabul valu number may given either decim exponenti form follow valid number e e variabl may appear express specifi api document forc class addit express may follow definit intermedi valu appear express semicolon use delimit valu definit exampl express aabb aaa bbb exactli equival aaaabbbb definit intermedi valu may involv intermedi valu use valu must appear valu definit _tabulatedfunct tabul function forc customnonbondedforc customgbforc allow defin tabul function defin function includ codefunct tag insid codecustomnonbondedforc codecustomgbforc tag codeblock xml function namemyfn typecontinuousd min max function tag attribut defin name function type function rang valu defin requir set attribut depend function type tabularcolumn type requir attribut continuousd min max continuousd xmin ymin xmax ymax xsize ysize continuousd xmin ymin zmin xmax ymax zmax xsize ysize zsize discret discret xsize ysize discret xsize ysize zsize min max attribut defin rang independ variabl continu function size attribut defin size tabl along axi tabul valu list insid bodi tag success valu separ white space see api document detail residu templat paramet forc use codeatom tag defin paramet atom type class altern mechan also use defin paramet valu residu templat use situat come certain forc field exampl codenonbondedforc codegbsaobcforc codecharg attribut defin charg atom type conveni avoid potenti bug also mani forc field differ charg atom type lennardjon paramet type class would prefer repeat paramet valu mani time write residu templat add arbitrari addit attribut codeatom tag exampl might includ codecharg attribut follow codeblock xml atom nameca type charg write tag forc includ codeuseattributefromresidu tag insid indic specifi attribut taken residu templat final simpli omit attribut forc codeatom tag exampl codeblock xml nonbondedforc coulombscal ljscale useattributefromresidu namecharg atom classcx sigma epsilon nonbondedforc notic codecharg attribut miss paramet specifi class type mean sigma epsilon need specifi class atom charg differ type taken residu templat instead includ file sometim use split forc field definit multipl file still abl use forc field specifi singl file accomplish codeinclud tag exampl codeblock xml forcefield includ filedefinitionsxml forcefield codefil attribut give path file includ may rel either directori contain parent xml file one codeinclud tag openmm data directori one contain built forc field use multipl file multipl xml file specifi forcefield creat definit combin follow file may refer atom type class defin well defin previou file may refer one defin later file mean order file list call forcefield constructor potenti signific forc involv peratom paramet nonbondedforc gbsaobcforc requir paramet valu defin everi atom type matter file type defin exampl file defin explicit water model gener defin small number atom type well nonbond paramet type contrast file defin implicit solvent model defin new atom type provid paramet atom type defin main forc field file forc file effect independ exampl two file includ codeharmonicbondforc tag bond creat base rule first file bond creat base rule second file mean could potenti end multipl bond singl pair atom extend forcefield forcefield class design modular extens mean add support entir new forc type one implement plugin ad new forc type everi forc class gener class pars correspond xml tag creat forc object add system forcefield maintain map tag name gener class forcefield creat scan xml file look gener class tag ask class creat gener object base call codecreatesystem loop gener ask one creat forc object ad new forc type therefor simpli matter creat new gener class ad forcefield map gener class must defin two method first need static method follow signatur pars xml tag creat gener staticmethod def parseelementel forcefield codeel xml tag xmletreeelementtreeel object codeforcefield forcefield creat method creat gener add forcefield gener myforcegener forcefield_forcesappendgener pars inform contain xml tag configur gener base second must defin method follow signatur def createforceself system data nonbondedmethod nonbondedcutoff arg codecreatesystem call forcefield first creat system object loop gener call codecreateforc one method creat forc object add system codedata forcefield_systemdata object contain inform system creat atom type bond angl etc codesystem system object remain argument valu pass codecreatesystem get better idea work look exist gener class forcefieldpi gener class may option also defin method follow signatur def postprocesssystemself system data arg method exist call forc creat give gener chanc make addit chang system final need regist class ad forcefield map forcefieldparsersmyforc myforcegeneratorparseel key xml tag name valu static method use pars simpli creat forcefield object usual xml file contain codemyforc tag recogn process correctli ad residu templat gener caution featur experiment api subject chang typic classforcefield encount residu templat simpli rais codeexcept sinc know assign atom type unknown residu howev classforcefield api regist residu templat gener call residu without exist templat encount gener may creat new residu templat match exist atom type paramet even creat new atom type new paramet ad classforcefield function use ad residu templat gener abl parameter small molecul repres protein nucleic acid forcefield exampl creat new residu templat posttransl modifi residu covalentlybound ligand unnatur amino acid base regist new residu templat gener name codegener simpli call methregistertemplategener method exist classforcefield object forcefieldregistertemplategeneratorgener codegener function must conform follow api def generatorforcefield residu paramet forcefield openmmappforcefield forcefield object residu templat andor paramet ad residu openmmapptopologyresidu residu topolog templat gener return success bool gener abl success parameter residu true return gener parameter residu return fals modifi forcefield gener either regist residu templat directli forcefieldregisterresiduetemplatetempl call forcefieldloadfilefil load residu definit ffxml file also use forcefield programmat api add addit atom type via forcefieldregisteratomtypeparamet addit paramet classforcefield object modifi residu templat gener residu without previous defin templat encount templat ad classforcefield new residu type encount subsequ residu parameter use residu templat without call codegener _otherfeatur featur period boundari condit mani forc object support period boundari condit act space tile infinit repeat copi system comput forc act singl copi base infinit period copi case appli cutoff particl interact singl copi particl openmm support triclin period box mean period defin three vector mathmathbfa mathmathbfb mathmathbfc given particl posit infinit period copi particl gener ad vector form mathi mathbfaj mathbfbk mathbfc mathi mathj mathk arbitrari integ period box vector must chosen satisfi certain requir roughli speak mathmathbfa mathmathbfb mathmathbfc need mostli correspond x z axe must form math mathbfa a_x mathbfb b_x b_i mathbfc c_x c_i c_z alway possibl put box vector form rotat system mathmathbfa parallel x mathmathbfb lie xy plane furthermor must obey follow constraint math a_x b_i c_z a_x ge b_x a_x ge c_x b_i ge c_i effect requir box vector specifi particular reduc form form combin box vector process known lattic reduct alway possibl put form without chang period system repres requir import consequ period unit cell alway treat axisalign rectangular box size matha_x b_i c_z remain nonzero element box vector caus repeat copi system stagger rel affect shape size copi volum unit cell simpli given matha_x b_i c_z localenergyminim provid implement lbfg optim algorithm citeliu given context specifi initi particl posit search nearbi set posit repres local minimum potenti energi distanc constraint enforc minim ad harmon restrain forc potenti function strength restrain forc steadili increas minimum energi configur satisfi constraint within toler specifi context integr xmlserial provid abil serial system forc integr state object portabl xml format reconstruct later serial system xml data contain complet copi entir system definit includ forc ad exampl use class model build util could gener system memori serial file disk program perform simul analysi could reconstruct model simpli load xml file run simul cluster model construct could done singl node system integr could encod xml allow easili transmit node xmlserial templat class principl use serial type object present howev system forc integr state support forc group possibl split forc object system group group evalu independ done call codesetforcegroup forc forc class also provid finer grain control group exampl nonbondedforc allow direct space comput one group reciproc space comput differ group import use forc group implement multipl time step algorithm customintegr exampl might evalu slowli chang nonbond interact less frequent quickli chang bond one done put slow fast forc separ group use classmtsintegr classmtslangevinintegr evalu group differ frequenc anoth import use defin forc use integr equat motion still queri effici call codesetintegrationforcegroup classintegr group omit ignor simul queri time call codegetst virtual site virtual site particl whose posit comput directli posit particl integr equat motion import exampl extra site present site water model particl massless therefor integr instead posit comput posit massiv particl water molecul virtual site specifi creat virtualsit object tell system use particular particl virtualsit defin rule comput posit abstract class subclass specif type rule twoparticleaveragesit virtual site locat comput weight averag posit two particl math mathbfrw_mathbfr_w_mathbfr_ threeparticleaveragesit virtual site locat comput weight averag posit three particl math mathbfrw_mathbfr_w_mathbfr_w_mathbfr_ outofplanesit virtual site locat comput weight averag posit three particl cross product rel displac math mathbfrmathbfr_w_mathbfr_w_mathbfr_w_mathitcrossleftmathbfr_tim mathbfr_right mathmathbfr_ mathbfr_mathbfr_ mathmathbfr_ mathbfr_mathbfr_ allow virtual site locat outsid plane three particl localcoordinatessit locat sever particl use comput local coordin system virtual site place fix locat coordin system number particl use defin coordin system user defin origin coordin system direct x axe specifi weight sum locat particl math mathbfowo_mathbfr_ wo_mathbfr_ mathbfdxwx_mathbfr_ wx_mathbfr_ mathbfdywy_mathbfr_ wy_mathbfr_ mathbfdzmathbfdxtim mathbfdi vector use construct set orthonorm coordin axe follow math mathbfhatxmathbfdxmathbfdx mathbfhatzmathbfdzmathbfdz mathbfhatymathbfhatztim mathbfhatx final posit virtual site set math mathbfrmathbfop_mathbfhatxp_mathbfhatyp_mathbfhatz random number stochast integr forc openmm includ mani stochast integr forc make extens use random number imposs gener truli random number comput like would dice roll coin flip real lifeinstead program reli pseudorandom number gener prng take sort initi seed valu step sequenc seemingli random number exact implement prng import fact platform may prng whose perform optim hardwar import howev prng must gener uniform distribut random number random number drawn distribut manipul yield random integ desir rang even random number differ type probabl distribut function eg normal distribut mean random number use integr forc within openmm discern pattern pattern induc prng two princip way prng use bad algorithm short period two prng start use seed prng algorithm common use periodicthat sequenc random number repeat given period defin number uniqu random number repeat pattern long period longer total number random number applic requir prefer order magnitud first problem describ avoid prng employ openmm period far longer current simul cycl point two far common biomolecular simul result strang artifact may difficult detect exampl langevin dynam two simul use sequenc random number appear synchron global movement citeuberuaga citesindhikara therefor import stochast forc integr openmm gener uniqu sequenc pseudorandom number within singl simul two differ simul system well includ restart previou simul everi stochast forc integr could make use random number two instanc method attach methgetrandomnumberse methsetrandomnumberseedint seed set uniqu random seed two differ simul differ forcesintegr applic openmm guarante gener sequenc random number differ contrast guarante made seed result ident random number sequenc sinc break simul piec andor run multipl replic system obtain complet statist common practic new strategi employ openmm version later aim tri ensur simul start uniqu random seed random seed valu default caus uniqu random seed gener new classcontext instanti prior introduct featur deseri serial classsystem xml file would result stochast forc integr assign random seed origin instanc serial use classsystem xml file gener version openmm older start new simul manual set random number seed stochast forc integr anoth uniqu valu _standardforc standard forc follow class implement standard forc field term wide use molecular simul harmonicbondforc harmon bond repres energi term form math efrackleftxx_right x distanc two particl x sub equilibrium distanc k forc constant produc forc magnitud k x x sub awar forc field defin harmon bond paramet slightli differ way e k x x sub sup lead forc magnitud k x x sub compar two form see k k sure check form particular forc field use necessari multipli forc constant harmonicangleforc harmon angl repres energi term form math efrackleftthetatheta_right maththeta angl form three particl maththeta_ equilibrium angl k forc constant harmonicbondforc awar forc field defin harmon angl paramet e k maththeta maththeta sub sup sure check form particular forc field use necessari multipli forc constant periodictorsionforc torsion repres energi term form math eklefttextcosleftnthetatheta_rightright maththeta dihedr angl form four particl maththeta_ phase offset n period k forc constant rbtorsionforc torsion repres energi term form math esum _ic_ilefttextcosphirighti mathphi dihedr angl form four particl c sub c sub constant coeffici reason convent periodictorsionforc rbtorsonforc defin torsion angl differ maththeta zero first last particl side bond form middl two particl ci configur wherea mathphi zero opposit side tran configur mean maththeta mathphi mathpi cmaptorsionforc torsion pair repres energi term form math eflefttheta_theta_right maththeta_ maththeta_ two dihedr angl coupl term f x defin usersuppli grid tabul valu natur cubic spline surfac fit tabul valu evalu determin energi arbitrari maththeta_ maththeta_ pair nonbondedforc _lennardjonesinteract lennardjon interact lennardjon interact pair particl repres energi term form math eepsilonleftleftfracsigmarrightleftfracsigmarrightright r distanc two particl mathsigma distanc energi equal zero mathepsilon set strength interact nonbondedmethod use anyth nocutoff r greater cutoff distanc energi forc set zero interact decreas quickli distanc cutoff usual littl effect accuraci simul option use switch function make energi go smoothli cutoff distanc mathr_mathitswitch r r_mathitcutoff energi multipli math sxxx mathx rr_mathitswitchr_mathitcutoffr_mathitswitch function decreas smoothli mathr r_mathitswitch mathr r_mathitcutoff continu first second deriv end except ad pair particl mathsigma mathepsilon paramet specifi except otherwis determin paramet individu particl use lorentzberthelot combin rule math sigmafracsigma_sigma_ math epsilonsqrtepsilon_ epsilon_ use period boundari condit nonbondedforc option add term known long rang dispers correct energi approxim repres contribut interact beyond cutoff distanc citeshirt math e_textcorfracpi nvleftfraclangl epsilon_ijsigma_ijrangler_cfraclangl epsilon_ijsigma_ijrangler_cright n number particl system v volum period box mathr_c cutoff distanc mathsigma_ij mathepsilon_ij interact paramet particl particl j mathlangl text rangl repres averag pair particl system switch function use also contribut correct depend integr e switch interv long rang dispers correct primarili use run simul constant pressur sinc produc accur variat system energi respect volum lennardjon interact often parameter two equival way one math eepsilonleftleftfracr_mathitminrrighttextleftfracr_mathitminrrightright mathr_mathitmin sometim known mathd_mathitmin radiu centertocent distanc energi minimum relat mathsigma math sigmafracr_mathitmin turn mathr_mathitmin relat van der waal radiu mathr_mathitmin r_mathitvdw anoth common form math efracartextfracbr coeffici b relat mathsigma mathepsilon math sigmaleftfracabright math epsilonfracba coulomb interact without cutoff form coulomb interact pair particl depend nonbondedmethod use nocutoff given math efracpiepsilon_fracq_q_r q sub q sub charg two particl r distanc coulomb interact cutoff cutoffnonperiod cutoffperiod modifi use reaction field approxim deriv assum everyth beyond cutoff distanc solvent uniform dielectr constant citetironi math efracq_q_piepsilon_leftfracrk_mathitrfrc_mathitrfright math k_mathitrfleftfracr_mathitcutoffrightleftfracepsilon_mathitsolventepsilon_mathitsolventright math c_mathitrfleftfracr_mathitcutoffrightleftfracepsilon_mathitsolventepsilon_mathitsolventright mathr_mathitcutoff cutoff distanc mathepsilon_mathitsolv dielectr constant solvent limit mathepsilon_mathitsolv caus forc go zero cutoff reaction field approxim appli nonbond except alway evalu full strength regardless cutoff distanc except primarili use model interact realli type bond interact typic parametr without cutoff togeth bond interact coulomb interact ewald summat ewald total coulomb energi sum three term direct space sum reciproc space sum selfenergi term citetoukmaji math ee_mathitdire_mathitrece_mathitself math e_mathitdirfracsum _ijsum_mathbfnq_iq_jfractexterfcleftmathitalpha r_ijmathbfnrightr_ijmathbfn math e_mathitrecfracpivsum _ijq_i q_jsum _mathbfkneqfractextexppi mathbfkalphapi mathbfk cdot mathbfr_imathbfr_jmathbfm math e_mathitselffracalphasqrtpisum _iq_i express indic j run particl n n sub n sub n sub run copi period cell k k sub k sub k sub run integ wave vector k submax k submax k submax k submax k submax k submax exclud mathmathbfr_i posit particl mathr_ij distanc particl j v volum period cell mathalpha intern paramet direct space sum pair apart cutoff distanc ignor cutoff requir less half width period cell number term sum never greater squar number particl error made appli direct space cutoff depend magnitud mathtexterfcalphar_mathitcutoff similarli error made reciproc space sum ignor wave number beyond k submax depend magnitud mathtextexppik_maxalpha chang mathalpha one decreas error either term increas error one instead user specifi mathalpha k submax nonbondedforc instead ask user choos error toler mathdelta calcul mathalpha math alpha sqrttextlogleftdeltarightr_mathitcutoff final estim error reciproc space sum math mathiterrorfrack_mathitmaxsqrtdalphatextexppi k_mathitmaxdalpha width period box select smallest valu k submax give error mathdelta box squar k submax differ valu along axi mean accuraci calcul determin mathdelta mathr_mathitcutoff affect accuraci result affect speed calcul chang rel cost direct space reciproc space sum therefor test differ cutoff find valu give best perform gener vari size system platform use calcul optim cutoff use everi simul overal cost evalu nonbond forc scale sup number particl awar error toler mathdelta rigor upper bound error formula given empir found produc averag rel error forc less similar mathdelta across varieti system paramet valu guarante made import valid simul identifi paramet valu produc accept accuraci system coulomb interact particl mesh ewald particl mesh ewald pme algorithm citeessmann similar ewald summat instead calcul reciproc space sum directli first distribut particl charg onto node rectangular mesh use th order bspline use fast fourier transform sum comput quickli give perform scale log n number particl assum volum period box proport number particl ewald summat user specifi direct space cutoff mathr_mathitcutoff error toler mathdelta nonbondedforc select mathalpha math alpha sqrttextlogleftdeltarightr_mathitcutoff number node mesh along dimens math n_mathitmeshfracalpha ddelta width period box along dimens altern user may choos explicitli set valu paramet note platform may choos use larger valu mathn_mathitmesh given equat exampl fft implement requir mesh size multipl certain small prime number platform might round nearest permit valu guarante mathn_mathitmesh never smaller valu given comment previou section regard interpret mathdelta ewald summat also appli pme even behavior error pme complic simpl ewald summat formula usual produc averag rel error forc less similar mathdelta rigor guarante pme also sensit numer roundoff error ewald summat platform calcul singl precis make mathdelta small typic sup actual caus error increas lennardjon interact particl mesh ewald pme algorithm also use lennardjon interact usual necessari sinc lennardjon forc short rang situat membran simul neglect interact beyond cutoff measur affect result comput effici certain approxim made citewennberg interact beyond cutoff distanc includ attract mathr term repuls mathr term sinc latter much smaller former long distanc usual neglig effect also interact particl farther apart cutoff distanc comput use geometr combin rule math sigmasqrtsigma_ sigma_ effect approxim also quit small still far accur ignor interact altogeth would happen pme formula use comput number node along dimens mesh slightli differ one use coulomb interact math n_mathitmeshfracalpha ddelta empir formula usual produc averag rel error forc less similar mathdelta guarante _gbsaobcforc gbsaobcforc gener born term gbsaobcforc consist two energi term gener born approxim term repres electrostat interact solut solvent surfac area term repres free energi cost solvat neutral molecul gener born energi given citeonufriev math etextfracleftfracepsilon_mathitsolutefracepsilon_mathitsolventrightsum _ijfracq_iq_jf_textgbleftd_ijr_ir_jright indic j run particl mathepsilon_mathitsolut mathepsilon_mathitsolv dielectr constant solut solvent respect mathq_i charg particl mathd_ij distanc particl j mathf_textgbd_ij r_i r_j defin math f_textgbleftd_ijr_ir_jrightleftd_ijr_ir_jtextexpleftfracd_ijr_ir_jrightright mathr_i born radiu particl calcul math r_ifracrho_ir_itexttanhleftalpha psi_ibeta psi_igamma psi_iright mathalpha mathbeta mathgamma gb supobc ii paramet mathalpha mathbeta mathgamma mathrho_i adjust atom radiu particl calcul atom radiu mathr_i mathrho_i r_i nm mathpsi_i calcul integr van der waal sphere particl outsid particl math psi_ifracrho_ipiint_textvdwthetaleftmathbfrrho _irightfracmathbfrdmathbfr maththeta r step function exclud interior particl integr surfac area term surfac area term given citeschaef citepond math ee_sa cdot pi sum _ileftr_ir_mathitsolventrightleftfracr_ir_iright mathr_i atom radiu particl mathr_i atom radiu mathr_mathitsolv solvent radiu taken nm default valu energi scale mathe_sa kjmolnm sup gayberneforc similar lennardjon interact describ section numreflennardjonesinteract instead base distanc two point particl base distanc closest approach two ellipsoid citeevera let mathmathbfa_ mathmathbfa_ rotat matric transform lab frame bodi frame two interact ellipsoid rotat determin posit particl describ api document let mathmathbfr_ vector point particl particl mathhatmathbfr_mathbfr_mathbfr_ let mathmathbfs_ mathmathbfs_ diagon matric contain three radii particl math mathbfs_ibeginbmatrix a_i b_i c_i endbmatrix energi comput product three term math eu_rmathbfa_ mathbfa_ mathbfr_ cdot eta_mathbfa_ mathbfa_ cdot chi_mathbfa_ mathbfa_ hatmathbfr_ first term describ distanc depend similar form lennardjon interact math u_repsilonleftleftfracsigmah_sigmarightleftfracsigmah_sigmarightright mathh_ approxim distanc closest approach two ellipsoid math h_mathbfr_sigma_mathbfa_ mathbfa_ hatmathbfr_ math sigma_mathbfa_ mathbfa_ hatmathbfr_left frac hatmathbfr_t mathbfg_ hatmathbfr_ right math mathbfg_mathbfa_t mathbfs_ mathbfa_ mathbfa_t mathbfs_ mathbfa_ second term adjust energi base rel orient two ellipsoid math eta_mathbfa_ mathbfa_left frac s_ s_textdetmathbfg_ right math s_ia_i b_i c_isqrta_i b_i third term appli userdefin scale factor mathe_a mathe_b mathe_c adjust strength interact along axi math chi_mathbfa_ mathbfa_ hatmathbfr_ hatmathbfr_t mathbfb_ hatmathbfr_ math mathbfb_mathbfa_t mathbfe_ mathbfa_ mathbfa_t mathbfe_ mathbfa_ math mathbfe_ibeginbmatrix e_ai e_bi e_ci endbmatrix use cutoff option use switch function make energi go smoothli cutoff distanc mathr_mathitswitch r r_mathitcutoff energi multipli math sxxx mathx rr_mathitswitchr_mathitcutoffr_mathitswitch function decreas smoothli mathr r_mathitswitch mathr r_mathitcutoff continu first second deriv end andersenthermostat andersenthermostat coupl system heat bath randomli select subset particl start time step set veloc new valu chosen boltzmann distribut repres effect random collis particl system particl heat bath citeandersen probabl given particl experi collis given time step math pefdelta f collis frequenc mathdelta step size compon veloc set math v_isqrtfrack_btmr thermostat temperatur particl mass r random number chosen normal distribut mean zero varianc one montecarlobarostat montecarlobarostat model effect constant pressur allow size period box vari time citechow citeaqvist regular interv attempt mont carlo step scale box vector coordin molecul center factor scale factor chosen chang volum period box v v mathdelta v math sleftfracvdelta vvright chang volum chosen randomli math delta vacdot r scale factor r random number uniformli distribut step accept reject base weight function math delta wdelta epdelta vnk_bt textlnleftfracvdelta vvright mathdelta e chang potenti energi result step p pressur appli system n number molecul system mathk_b boltzmann constant system temperatur particular mathdelta wle step alway accept mathdelta w step accept probabl mathtextexpdelta wk_b algorithm tend effici determinist barostat berendsen parrinellorahman algorithm sinc requir expens virial calcul everi time step mont carlo step involv two energi evalu done much less often everi time step also requir specifi compress system usual known advanc scale factor determin size step chosen automat produc accept rate approxim initi set period box volum accept rate monitor vari much modifi accordingli mont carlo step modifi particl posit scale centroid molecul appli result displac particl molecul ensur molecul translat unit bond length constrain distanc unaffect montecarlobarostat assum simul run constant temperatur well pressur simul temperatur affect step accept probabl perform temperatur regul howev must use anoth mechan along maintain temperatur langevinintegr andersenthermostat montecarloanisotropicbarostat montecarloanisotropicbarostat similar montecarlobarostat instead scale entir period box uniformli mont carlo step scale one axi box allow box chang shape use simul anisotrop system whose compress differ along differ direct also allow differ pressur specifi axi specifi barostat appli certain axe box keep axe fix use exampl constant surfac area simul membran montecarlomembranebarostat montecarlomembranebarostat similar montecarlobarostat special simul membran assum membran lie xy plane addit appli uniform pressur regul volum period box also appli uniform surfac tension regul cross section area period box xy plane weight function decid whether accept step math delta wdelta epdelta vsdelta ank_bt textlnleftfracvdelta vvright surfac tension mathdelta chang cross section area notic pressur surfac tension defin opposit sens larger pressur tend make box smaller larger surfac tension tend make box larger montecarlomembranebarostat offer addit option custom behavior period box x axe either isotrop alway scale amount ratio remain fix anisotrop chang size independ z axi either free size chang independ x axe fix size chang invers vari x axe total box volum chang montecarloflexiblebarostat montecarloflexiblebarostat similar montecarlobarostat allow period box fulli flexibl citevandenhaut mont carlo step chang length box side also angl especi use simul bulk materi shape crystal unit cell may known advanc could even chang time transit phase cmmotionremov cmmotionremov prevent system drift space period remov center mass motion start everi n th time step n set user calcul total center mass veloc system math mathbfv_textcmfracsum _im_imathbfv_isum _im_i mathm_i mathmathbfv_i mass veloc particl subtract mathmathbfv_textcm veloc everi particl rmsdforc rmsdforc comput rootmeansquar deviat rmsd current particl posit mathmathbfx_i set refer posit mathmathbfx_itextref math textrmsd sqrtfracsum_i mathbfx_i mathbfx_itextref n comput refer posit first translat rotat minim rmsd comput valu therefor mathargmintextrmsd mathargmin taken possibl translat rotat forc normal use customcvforc see section numrefcustomcvforc one rare want forc whose energi exactli equal rmsd mani situat use restrain bias forc depend rmsd way _integratorstheori integr verletintegr verletintegr implement leapfrog verlet integr method posit veloc store context offset half time step step updat follow math mathbfv_itdelta tmathbfv_itdelta tmathbff_itdelta tm_i math mathbfr_itdelta tmathbfr_itmathbfv_itdelta tdelta mathmathbfv_i veloc particl mathmathbfr_i posit mathmathbff_i forc act mathm_i mass mathdelta time step posit alway half time step later veloc care must use calcul energi system particular potenti energi kinet energi state correspond differ time simpli add get total energi system instead better retriev state two success time step calcul onstep veloc math mathbfv_itfracmathbfv_ilefttdelta trightmathbfv_ilefttdelta tright use veloc calcul kinet energi time langevininteg langevininteg simul system contact heat bath integr langevin equat motion math m_ifracdmathbfv_idtmathbff_igamma m_i mathbfv_imathbfr_i mathmathbfv_i veloc particl mathmathbff_i forc act mathm_i mass mathgamma friction coeffici mathmathbfr_i uncorrel random forc whose compon chosen normal distribut mean zero varianc mathm_i gamma k_b temperatur heat bath integr done use langevin leapfrog method citeizaguirr step posit veloc updat follow math mathbfv_itdelta tmathbfv_itdelta talphamathbff_italphagammam_i sqrtktalphamr math mathbfr_itdelta tmathbfr_itmathbfv_itdelta tdelta mathk boltzmann constant matht temperatur mathgamma friction coeffici mathr normal distribut random number mathalphaexpgammadelta comment offset posit veloc appli integr verletintegr langevinmiddleintegr integr similar langevininteger instead use lfmiddl discret citezhang step posit veloc updat follow math mathbfv_itdelta mathbfv_itdelta mathbff_itdelta tm_i math mathbfr_itdelta mathbfr_it mathbfv_itdelta tdelta math mathbfv_itdelta mathbfv_itdelta talpha sqrtktalphamr math mathbfr_itdelta mathbfr_itdelta mathbfv_itdelta tdelta tend produc accur sampl configur properti free energi less accur sampl kinet properti configur properti much import kinet one simul integr gener prefer langevinintegr often allow one use larger time step still maintain similar better accuraci one disadvantag integr requir appli constraint twice per time step compar langevinintegr make slightli slower system involv constraint howev usual compens allow use larger time step _nosehooverintegratorstheori nosehooverintegr like langevinmiddleinteger use lfmiddl discret citezhang step posit veloc updat follow math mathbfv_itdelta mathbfv_itdelta mathbff_itdelta tm_i math mathbfr_itdelta mathbfr_it mathbfv_itdelta tdelta math mathbfv_itdelta mathrmscaletimesmathbfv_itdelta math mathbfr_itdelta mathbfr_itdelta mathbfv_itdelta tdelta univers scale factor use third step determin propag auxilliari degre freedom alongsid regular particl origin nos√©hoov formul use singl harmon oscil heat bath problemat small stiff system nonergod chain formul extend replac singl oscil thermostat chain connect oscil citemartyna larg system singl oscil ie chain length one suffic longer chain necessari properli thermostat nonergod system openmm default use chain length three cover latter case safe reduc increas effici larg system heat bath propag perform use multitimestep algorithm propag step discret substep use factor yoshida suzuki default discret use mathmathcalodelta approach use point point may also use increas performac expens accuraci step subdivid multitimestep default multi time step per propag number yoshidasuziki point valu may increas increas accuraci addit comput expens brownianintegr brownianintegr simul system contact heat bath integr brownian equat motion math fracdmathbfr_idtfracgamma m_imathbff_imathbfr_i mathmathbfr_i posit particl mathmathbff_i forc act mathgamma friction coeffici mathmathbfr_i uncorrel random forc whose compon chosen normal distribut mean zero varianc math k_b tm_i gamma temperatur heat bath brownian equat motion deriv langevin equat motion limit larg mathgamma case veloc particl determin entir instantan forc act kinet energi ceas much mean sinc disappear soon appli forc remov variableverletintegr similar verletintegr instead use step size everi time step continu adjust step size keep integr error userspecifi toler compar posit gener verlet integr would gener explicit euler integr take differ estim integr error math errorleftdelta trightsum _ifracmathbff_im_i mathmathbff_i forc act particl mathm_i mass practic error made euler integr usual larger made verlet integr tend overestim true error even provid use mechan step size control select valu mathdelta make error exactli equal specifi error toler math delta tsqrtfracdeltasum _ifracmathbff_im_i mathdelta error toler largest step may taken consist userspecifi accuraci requir note integr may sometim choos use smaller valu mathdelta given exampl might restrict much step size grow one step next keep step size constant rather increas small amount behavior specifi may vari platform requir howev mathdelta never larger valu given variabl time step integr gener superior fix time step one stabil effici take larger step averag automat reduc step size preserv accuraci avoid instabl unusu larg forc occur convers use step size averag variabl time step one usual accur sinc time step concentr difficult area trajectori unlik fix step size verlet integr variabl step size verlet symplect mean given averag step size conserv energi precis long time period even though local region trajectori accur reason appropri precis energi conserv import simul system constant temperatur constant energi simul must maintain energi accur long time period fix step size verlet may appropri variablelangevinintegr similar langevinintegr continu adjust step size use method variableverletintegr usual prefer fix step size langevin integr reason given furthermor langevin dynam involv random forc never symplect therefor fix step size verlet integr advantag appli langevin integr _customintegr customintegr customintegr flexibl class use implement wide rang integr method includ determinist stochast integr metropol integr multipl time step integr algorithm must integr addit quantiti along particl posit momenta algorithm specifi seri comput execut order perform singl time step comput comput valu valu variabl two type variabl global variabl singl valu perdof variabl separ valu everi degre freedom everi x z compon particl customintegr defin lot variabl comput andor use comput variabl exampl includ step size global particl posit perdof forc act particl perdof addit defin mani variabl want use actual comput defin mathemat express describ section numrefwritingcustomexpress sever type comput support global express evalu result store global variabl perdof express evalu everi degre freedom result store perdof variabl sum express evalu everi degre freedom result degre freedom ad togeth sum store global variabl also special type comput involv mathemat express exampl comput appli distanc constraint modifi particl posit veloc accordingli customintegr power tool descript give vagu idea scope capabl full detail exampl consult api document _thetheorybehindopenmmintroduct introduct overview guid describ mathemat theori behind openmm comput class describ comput class perform use serv two purpos use openmm within applic guid teach use correctli implement openmm api new platform teach correctli implement requir kernel hand mani detail intent left unspecifi behavior specifi either guid api document left platform may implement differ way differ platform exampl integr requir produc trajectori satisfi constraint within userspecifi toler algorithm use enforc constraint left platform similarli guid provid function form forc specifi level numer precis must calcul essenti featur design openmm allow api implement effici wide varieti hardwar softwar platform use whatev method appropri platform hand mean singl program may produc meaning differ result depend platform use exampl differ constraint algorithm may differ region converg thu time step stabl one platform may unstabl differ one essenti valid simul methodolog platform intend use assum good result one platform guarante good result anoth platform use ident paramet _unit unit sever differ set unit wide use molecular simul exampl energi may measur kcalmol kjmol distanc may angstrom nm angl may degre radian openmm use follow unit everywher quantiti unit distanc nm time ps mass atom mass unit charg proton charg temperatur kelvin angl radian energi kjmol unit import featur form intern consist set exampl forc alway unit kjmolnm whether calcul gradient energi product mass acceler true wide use unit system express energi kcalmol header file unitsh contain predefin constant convert openmm unit common unit exampl applic express distanc angstrom multipli openmmnmperangstrom pass openmm posit calcul openmm multipli openmmangstromspernm pass back applic _physicalconst physic constant openmm use codata valu physic constant specif valu use constant frequent come molecular simul quantiti valu elementari charg math sup c boltzmann constant mathk_b sup jk avogadro number mathn_a sup vacuum permitt mathepsilon_ sup fm _customforc custom forc addit standard forc describ previou chapter openmm provid number custom forc class class provid detail control mathemat form forc allow user specifi one arbitrari algebra express detail write custom express describ section numrefwritingcustomexpress custombondforc custombondforc similar harmonicbondforc repres interact certain pair particl function distanc allow precis form interact specifi user interact energi bond given math efleftrright f r user defin mathemat express addit depend interparticl distanc r energi may also depend arbitrari set user defin paramet paramet may specifi two way global paramet singl fix valu perbond paramet defin specifi valu bond customangleforc customangleforc similar harmonicangleforc repres interact set three particl function angl allow precis form interact specifi user interact energi angl given math efleftthetaright mathftheta user defin mathemat express addit depend angl maththeta energi may also depend arbitrari set user defin paramet paramet may specifi two way global paramet singl fix valu perangl paramet defin specifi valu angl customtorsionforc customtorsionforc similar periodictorsionforc repres interact set four particl function dihedr angl allow precis form interact specifi user interact energi angl given math eftheta mathftheta user defin mathemat express angl maththeta guarante rang mathpi pi like periodictorsionforc defin zero first last particl side bond form middl two particl ci configur addit depend angl maththeta energi may also depend arbitrari set user defin paramet paramet may specifi two way global paramet singl fix valu pertors paramet defin specifi valu torsion _customnonbondedforc customnonbondedforc customnonbondedforc similar nonbondedforc repres pairwis interact particl system allow precis form interact specifi user interact energi pair particl given math efr f r user defin mathemat express addit depend interparticl distanc r energi may also depend arbitrari set user defin paramet paramet may specifi two way global paramet singl fix valu perparticl paramet defin specifi valu particl customnonbondedforc option restrict subset particl pair system done defin interact group see api document detail use cutoff switch function option appli make energi go smoothli cutoff distanc mathr_mathitswitch r r_mathitcutoff energi multipli math sxxx mathxrr_mathitswitchr_mathitcutoffr_mathitswitch function decreas smoothli mathrr_mathitswitch mathrr_mathitcutoff continu first second deriv end use period boundari condit customnonbondedforc option add term known long rang truncat correct energi approxim repres contribut interact beyond cutoff distanc citeshirt math e_corfracpi nvleftlangleundersetr_mathitcutoffoversetinftyinterrdrrightrangl n number particl system v volum period box mathlangl text rangl repres averag pair particl system switch function use addit contribut correct given math e_corprimefracpi nvleftlangleundersetr_mathitswitchoversetr_mathitcutoffint ersrrdrrightrangl long rang dispers correct primarili use run simul constant pressur sinc produc accur variat system energi respect volum customexternalforc customexternalforc repres forc appli independ particl function posit energi particl given math efxyz f x z user defin mathemat express addit depend particl x z coordin energi may also depend arbitrari set user defin paramet paramet may specifi two way global paramet singl fix valu perparticl paramet defin specifi valu particl customcompoundbondforc customcompoundbondforc support wide varieti bond interact defin bond singl energi term depend posit fix set particl number particl involv bond energi depend posit configur may depend posit individu particl distanc pair particl angl form set three particl dihedr angl form set four particl interact energi bond given math efx_ir_itheta_iphi_i f user defin mathemat express may depend arbitrari set posit mathx_i distanc mathr_i angl maththeta_i dihedr angl mathphi_i guarante rang mathpi pi distanc angl dihedr defin specifi sequenc particl chosen among particl make bond distanc variabl defin two particl equal distanc angl variabl defin three particl equal angl dihedr variabl defin four particl equal angl first last particl axi form middl two particl equal zero first last particl side axi addit depend posit distanc angl dihedr energi may also depend arbitrari set user defin paramet paramet may specifi two way global paramet singl fix valu perbond paramet defin specifi valu bond customcentroidbondforc customcentroidbondforc similar customcompoundbondforc instead creat bond individu particl bond center group particl use purpos restrain distanc two molecul pin center mass singl molecul first step comput forc calcul center posit defin group particl calcul weight averag posit particl group weight user defin comput proce exactli customcompoundbondforc energi bond calcul base center set group rather posit individu particl class support function type featur customcompoundbondforc fact interact could implement customcompoundbondforc also implement class simpli defin group contain singl atom custommanyparticleforc custommanyparticleforc similar customnonbondedforc repres custom nonbond interact particl allow interact depend two particl allow repres wide rang nonpairwis interact defin specifi number particl mathn involv interact energi depend posit specif take user specifi energi function math efx_ir_itheta_iphi_i may depend arbitrari set posit mathx_i distanc mathr_i angl maththeta_i dihedr angl mathphi_i particular set mathn particl distanc angl dihedr defin specifi sequenc particl chosen among particl set distanc variabl defin two particl equal distanc angl variabl defin three particl equal angl dihedr variabl defin four particl equal angl first last particl axi form middl two particl equal zero first last particl side axi addit depend posit distanc angl dihedr energi may also depend arbitrari set user defin paramet paramet may specifi two way global paramet singl fix valu perparticl paramet defin specifi valu particl energi function evalu one time everi uniqu set mathn particl system exact number time depend permut mode set mathn particl mathn possibl permut codesinglepermut mode function evalu singl arbitrarili chosen one permut codeuniquecentralparticl mode function evalu mathn permut particl central particl number time energi function evalu restrict specifi type filter particl may type assign mathn particl involv interact may restrict specifi set type provid great deal flexibl control particl interact customgbforc customgbforc implement complex multipl stage nonbond interact particl design primarili implement gener born implicit solvat model although strictli limit purpos interact specifi seri comput defin arbitrari algebra express comput consist number perparticl comput valu follow one energi term comput valu scalar valu comput particl system may depend arbitrari set global perparticl paramet well comput valu calcul comput valu calcul energi term deriv evalu determin system energi particl forc energi term may depend global paramet perparticl paramet perparticl comput valu comput valu calcul two differ way singl particl valu calcul evalu user defin express particl math value_iflefttexttexttextright f may depend properti particl coordin paramet well comput valu alreadi calcul particl pair valu calcul sum pair particl math value_isum _jne ifleftrtextright sum particl system f r function distanc r particl j well paramet comput valu energi term may similarli calcul perparticl perparticlepair singl particl energi term calcul evalu user defin express particl math eflefttexttexttextright f may depend properti particl coordin paramet comput valu particl pair energi term calcul evalu user defin express everi pair particl system math esum _ijfleftrtexttexttextright sum particl pair j f r function distanc r particl j well paramet comput valu note energi term assum symmetr respect two interact particl therefor evalu per pair contrast express comput valu need symmetr therefor calcul twice pair calcul valu first particl calcul valu second particl awar although class extrem gener comput defin particular platform may support restrict type comput particular current exist platform requir first comput valu must particl pair comput comput valu first must singl particl comput suffici gener born model might permit type calcul implement customhbondforc customhbondforc support wide varieti energi function use repres hydrogen bond comput interact donor particl group acceptor particl group group may includ three particl typic donor group consist hydrogen atom atom bond acceptor group consist neg charg atom atom bond interact energi donor group acceptor group given math efr_itheta_iphi_i f user defin mathemat express may depend arbitrari set distanc mathr_i angl maththeta_i dihedr angl mathphi_i distanc angl dihedr defin specifi sequenc particl chosen interact donor acceptor group six atom choos sinc group may contain three atom distanc variabl defin two particl equal distanc angl variabl defin three particl equal angl dihedr variabl defin four particl equal angl first last particl axi form middl two particl equal zero first last particl side axi addit depend distanc angl dihedr energi may also depend arbitrari set user defin paramet paramet may specifi three way global paramet singl fix valu perdonor paramet defin specifi valu donor group peracceptor paramet defin specifi valu acceptor group _customcvforc customcvforc customcvforc comput energi function collect variabl collect variabl may scalar valu function particl posit paramet one defin codeforc object function defin via forc class either standard custom use collect variabl energi comput math ef f user suppli mathemat express collect variabl also may depend user defin global paramet _writingcustomexpress write custom express custom forc describ chapter involv user defin algebra express express specifi charact string may involv varieti standard oper mathemat function follow oper support add subtract multipli divid power parenthes may use group follow standard function support sqrt exp log sin co sec csc tan cot asin aco atan atan sinh cosh tanh erf erfc min max ab floor ceil step delta select stepx x otherwis deltax x otherwis selectxyz z x otherwis custom forc allow addit function defin tabul valu number may given either decim exponenti form follow valid number e e variabl may appear express specifi api document forc class addit express may follow definit intermedi valu appear express semicolon use delimit valu definit exampl express aabb aaa bbb exactli equival aaaabbbb definit intermedi valu may involv intermedi valu use valu must appear valu definit set paramet custom forc two type paramet defin simplest type global paramet repres singl number valu store classcontext chang time call methsetparamet global paramet design inexpens chang even set new valu global paramet everi time step overhead usual quit small except rule howev exampl classcustomnonbondedforc use long rang correct chang global paramet may requir correct coeffici recalcul expens type paramet one record mani valu one element forc perparticl perbond paramet valu store directli forc object henc part system definit classcontext creat valu copi thereaft two disconnect modifi forc effect classcontext alreadi exist forc provid way modifi paramet via methupdateparametersincontext method method tend somewhat expens best call often hand still much less expens call methreiniti classcontext way updat system definit run simul paramet deriv mani custom forc abil comput deriv potenti energi respect global paramet use featur first defin global paramet energi depend instruct custom forc comput deriv respect paramet call methaddenergyparameterderiv whenev forc energi comput specifi deriv also comput time queri call methgetst classcontext would queri forc energi import applic featur use combin classcustomintegr describ section numrefcustomintegr deriv appear directli express defin integr algorithm use implement algorithm lambdadynam global paramet integr dynam variabl role code raw html style code fontfamilymonospac style style caption textaligncent style highlight c _thecpuplatform cpu plaform cpuplatform subclass referenceplatform provid optim version small number kernel use refer implement other kernel implement written refer platform work equal well cpu platform cours kernel happen perform bottleneck probabl want write optim version mani kernel neglig effect perform use implement platform choos easili support platform singl plugin librari implement coderegisterkernelfactori like extern c void registerkernelfactori int platformgetnumplatform platform platform platformgetplatformi dynamic_castreferenceplatformplatform null creat regist kernelfactori loop identifi everi referenceplatform either instanc base class subclass regist kernelfactori everi one role code raw html style code fontfamilymonospac style style caption textaligncent style highlight c _writingplugin write plugin plugin dynam librari add new featur openmm typic store codelibplugin directori insid openmm instal get load along plugin user call platformloadpluginsfromdirectoryplatformgetdefaultpluginsdirectori also possibl load plugin differ directori load individu call codeplatformloadpluginlibrari everi plugin must implement two function declar plugininitializerh header file extern c void registerplatform extern c void registerkernelfactori plugin load two function invok regist platform kernelfactori defin plugin mani plugin load call codeplatformloadpluginsfromdirectori coderegisterplatform first call coderegisterkernelfactori call allow one plugin defin platform differ plugin add kernelfactori platform guarante regist first plugin second plugin tri add kernelfactori regardless order plugin happen load creat new platform one common type plugin defin new platform four plugin come openmm one refer platform one cpu platform one cuda platform one opencl platform defin new platform must creat subclass variou abstract class openmm low level api subclass platform one subclass kernelfactori subclass kernelimpl easi say huge amount work actual mani differ algorithm involv comput forc enforc constraint perform integr togeth make platform cours requir everi platform must implement everi possibl featur provid implement particular kernel simpli mean platform use simul requir kernel user tri except thrown plugin coderegisterplatform function creat instanc platform subclass regist call codeplatformregisterplatform also must regist kernelfactori kernel platform support done coderegisterkernelfactori function simpli directli platform constructor use mani differ kernelfactori want differ kernel usual simplest use singl kernelfactori support multipl kernelfactori exist primarili let plugin add new featur exist platform describ next section creat new forc anoth common type plugin defin new forc provid implement exist platform defin new integr specif discuss process similar two plugin come openmm implement amoeba forc field drude oscil respect exampl suppos want creat new forc subclass call stringforc use equat string theori comput interact particl want provid implement four standard platform refer cpu cuda opencl first thing realiz done plugin librari plugin load dynam runtim relat low level api must also provid public api user class need creat stringforc object call method mean provid header file class declar nonplugin librari class definit link code implement particular platform plugin public api class put differ full plugin user perspect consist three part librari openmm load runtim openmm consid plugin second librari user link code header file includ sourc code defin api need creat follow class stringforc public api forc user directli link librari contain stringforceimpl forceimpl subclass correspond stringforc defin librari stringforc stringforc codecreateimpl method creat instanc calcstringforcekernel abstract class extend kernelimpl defin api stringforceimpl invok kernel need provid header file implement provid platform suppos write opencl implement stringforc class need write openclcalcstringforcekernel extend calcstringforcekernel provid implement virtual method code class probabl complic actual work worth nobel prize may execut mani differ gpu kernel creat intern data structur detail entir intern code long class implement virtual method calcstringforcekernel anyth want insid openclstringforcekernelfactori kernelfactori subclass know creat instanc openclcalcstringforcekernel class packag dynam librari linux dylib mac dll window load plugin librari must also implement two function plugininitializerh coderegisterplatform noth sinc plugin implement new platform coderegisterkernelfactori call codeplatformgetplatformbynameopencl get opencl platform creat new openclstringforcekernelfactori call coderegisterkernelfactori platform regist opencl platform avail catch except return without anyth like mean opencl runtim comput code run role code raw html style code fontfamilymonospac style style caption textaligncent style highlight c _theopenclplatform opencl platform opencl platform much complic refer platform also provid mani tool simplifi work tool complic use correctli chapter attempt explain use import one teach program opencl mani tutori subject avail elsewher guid assum alreadi understand overview use opencl platform platformspecif data store contextimpl type openclplatformplatformdata declar openclplatformh import field class codecontext vector openclcontext one openclcontext devic use common case run everyth singl devic case one openclcontext parallel comput across multipl devic discuss openclcontext store import inform simul posit veloc forc opencl commandqueu use execut kernel workspac buffer variou sort etc provid mani use method compil execut kernel clear reduc buffer also provid access three import object openclintegrationutil openclnonbondedutil openclbondedutil discuss alloc devic memori gener done openclarray class take care much work memori manag provid simpl interfac transfer data host devic memori everi kernel specif particular openclcontext turn specif particular openmmcontext mean kernel sourc code custom particular simul exampl valu number particl turn compiletim constant specif version kernel select base devic use particular aspect system simul codeopenclcontextcreateprogram make easi specifi list preprocessor definit use compil kernel normal way execut kernel call codeexecutekernel openclcontext allow specifi total number workitem execut option size workgroup specifi workgroup size use default number workgroup launch select automat base workgroup size total number workitem number comput unit devic execut numer precis opencl platform support three precis mode singl valu store singl precis nearli calcul done singl precis array posit veloc forc energi return openclcontext codegetposq codegetvelm codegetforc codegetforcebuff codegetenergybuff method type codefloat codefloat case codegetenergybuff mix forc comput store singl precis integr done doubl precis veloc type codedoubl posit still store singl precis avoid ad overhead forc calcul second array type codefloat creat store correct posit return openclcontext getposqcorrect method ad posit correct togeth give full doubl precis posit doubl posit veloc forc energi store doubl precis nearli calcul done doubl precis call codegetusemixedprecis codegetusedoubleprecis openclcontext determin mode use addit compil kernel call codecreatekernel automat defin two type make easier write kernel work mode coder defin codefloat singl mix precis mode codedoubl doubl precis mode codemix defin codefloat singl precis mode codedoubl mix doubl precis mode also defin vector version type coder coder etc _computingforc comput forc forc comput store either two place array codelong valu store bit fix point valu collect buffer coder valu store float point format gpu support atom oper bit integ allow mani thread simultan record forc without danger conflict low end gpu support howev especi embed gpu found mani laptop devic write float point buffer care coordin make sure two thread never write memori locat time start forc calcul forc buffer set zero forc free add contribut buffer final buffer sum produc total forc particl total record float point fix point array size float point buffer equal number particl round next multipl call codegetpaddednumatom openclcontext get number actual forc buffer obtain call codegetforcebuff first n entri n pad number atom repres first forc buffer next n repres second forc buffer gener th forc buffer contribut forc particl j store element codeicontextgetpaddednumatomsj fix point buffer order differ atom x compon forc store element codei compon element codeicontextgetpaddednumatom z compon element codeicontextgetpaddednumatom convert valu float point fix point multipli x sup cast codelong call codegetlongforcebuff get array fix point valu potenti energi also accumul set buffer one simpli list float point valu set zero start comput sum end comput yield total energi opencl implement forc object defin subclass computeforceinfo regist instanc call codeaddforc openclcontext implement method determin whether particular particl group particl ident import reorder particl discuss nonbond forc comput nonbond interact effici complic busi best case even complic gpu furthermor algorithm must vari base type processor use whether distanc cutoff whether period boundari condit appli openclnonbondedutil class tri simplifi use need provid piec code comput interact two particl take respons gener neighbor list loop interact particl load particl paramet global memori write forc energi appropri buffer thing done use algorithm appropri processor run high level aspect interact whether use cutoff whether particular particl pair need exclud cours system reli certain assumpt import forc repres sum independ pairwis interact case thing becom much complic may still abl use featur openclnonbondedutil use simpl mechan outlin beyond scope guid defin nonbond interact call codeaddinteract openclnonbondedutil provid block opencl sourc code comput interact block sourc code insert middl appropri kernel point insert variou variabl defin describ interact comput codeatom codeatom indic two interact particl coder coder codeinvr distanc r two particl r sup r respect codeisexclud codebool specifi whether pair particl mark exclud interact exclud pair skip automat case still need process differ pair codeposq codeposq coder contain posit xyz field charg w field two particl perparticl paramet may specifi describ follow preprocessor macro also defin codenum_atom total number particl system codepadded_num_atom pad number particl system codeuse_cutoff defin cutoff use codeuse_period defin period boundari condit use codecutoff codecutoff_squar cutoff distanc squar respect defin cutoff use final two output variabl defin add energi interact codetempenergi add deriv energi respect interparticl distanc codededr also defin arbitrari perparticl paramet call codeaddparamet openclnonbondedutil provid array devic memori contain set valu valu two interact particl load store variabl call codenam codenam name name specifi paramet note nonbond interact comput codecalcforcesandenergi call everi forceimpl possibl make paramet valu chang time modifi insid codecalcforcesandenergi also note length array contain paramet valu must equal pad number particl system final specifi arbitrari memori object pass argument interact kernel call codeaddargu rest kernel ignor argument make use interact code consid simpl exampl suppos want implement nonbond interact form e k sub k sub r sup k perparticl paramet first creat paramet follow nbaddparametercomputeparameterinfokparam kparam float codenb openclnonbondedutil context call codeaddinteract defin interact follow sourc code ifdef use_cutoff isexclud r cutoff_squar els isexclud endif tempenergi kparamkparamr dedr kparamkparamr import point code execut everi pair particl pad list atom mean interact involv pad atom actual includ might think code incorrect need anoth check filter extra interact atom num_atom atom num_atom necessari case codeisexclud flag alway set interact involv pad atom forc use exclud interact check codeisexclud would need add extra check self interact similar case check codeatom atom exclus flag prevent process forc check necessari bond forc openclnonbondedutil simplifi task creat nonbond interact openclbondedutil simplifi process mani type bond interact bond interact mean one appli small fix group particl includ bond angl torsion etc import point list particl form bond known advanc chang time use openclbondedutil similar process describ provid block opencl code evalu singl interact block code insert middl kernel loop interact evalu one point insert follow variabl defin describ interact comput codeindex index interact evalu codeatom codeatom indic interact particl codepo codepo coder contain posit xyz field interact particl variabl call codeenergi defin accumul total energi interact code add energi interact also defin coder variabl call codeforc codeforc store forc atom simpl exampl follow sourc code implement pairwis interact form e r sup real delta pospo energi deltaxdeltax deltaydeltay deltazdeltaz real forc fdelta real forc fdelta use call codeaddinteract context openclbondedutil object also provid list particl involv everi bond interact exactli nonbond interact call codeaddargu specifi arbitrari memori object pass argument interact kernel might contain perbond paramet use codeindex look appropri element inform want reorder particl nonbond calcul done bit differ opencl platform cpu base code particular interact comput block particl time number particl need pad bring multipl neighbor list actual list pair block pair individu particl close enough interact work well sequenti particl tend close togeth block spatial compact gener true particl macromolecul true solvent molecul water molecul exampl move independ water molecul particl happen sequenti whatev order molecul defin need spatial close togeth opencl platform address period reorder particl sequenti particl close togeth mean opencl platform call particl need system call particl reorder done frequent must fast data structur describ structur system forc act need updat would make prohibit slow opencl platform therefor reorder particl way alter part system definit practic mean exchang entir molecul long two molecul truli ident posit veloc exchang without affect system way everi forc contribut defin boundari molecul determin whether two molecul ident done computeforceinfo add openclcontext specifi two type inform given pair particl say whether two particl ident far forc concern exampl forc object implement coulomb forc would check whether two particl equal charg defin particl group opencl platform ensur particl group part molecul also specifi whether two group ident exampl forc implement harmon bond group would consist two particl connect bond two group would ident spring constant equilibrium length integr util openclcontext openclintegrationutil provid featur use mani integr two import random number gener constraint enforc plan use random number call codeinitrandomnumbergener initi specifi random number seed use awar one random number gener even multipl class make use two class call codeinitrandomnumbergener request differ seed except thrown request seed second call simpli ignor effici random number gener bulk store array devic memori access call codegetrandom time need use block random number call codepreparerandomnumb specifi mani valu need regist mani valu use return index array start read valu enough unus valu remain array gener new batch random valu return appli constraint simpli call codeapplyconstraint numer accuraci constraint algorithm work particl posit directli rather displac taken recent integr step displac must store array get call codegetposdelta constraint algorithm assum actual unconstrain posit particl equal posit store openclcontext plu delta store openclintegrationutil modifi delta distanc constraint satisfi integr must finish time step ad delta posit store main posit array openmm develop guid latex includ licenserst toctre maxdepth number _introductionrst _core_libraryrst _writing_pluginsrst _reference_platformrst _cpu_platformrst _opencl_platformrst _cuda_platformrst _common_computerst html includ licenserst role code raw html style code fontfamilymonospac style style caption textaligncent style highlight c _thecorelibrari core librari openmm base layer architectur shown follow diagram figur imagesarchitecturelayersjpg align center width autonumberfigurearchitectur layer openmm architectur public api layer consist class access use openmm applic system forc subclass integr subclass context class defin public interfac comput next layer consist implement class mirror public api class contextimpl forceimpl subclass forceimpl subclass forc harmonicbondforceimpl nonbondedforceimpl etc object creat automat creat context store inform relat particular simul defin method perform calcul note wherea forc logic part system forceimpl logic part context see autonumreffigureapi relationship creat mani context simul system still one system one copi forc separ forceimpl context forceimpl store inform relat particular context figur imagessystemcontextrelationshipsjpg align center autonumberfigureapi relationship relationship public api implement layer object also note integratorimpl class need integr alreadi specif one context mani context simul system must integr inform specif one simul store directli integr next layer openmm low level api olla import class layer platform kernel kernelimpl subclass kernelfactori kernel refer count pointer kernelimpl real work done kernelimpl object precis instanc subclass kernelfactori creat kernelimpl object platform tie togeth set kernelfactori well defin inform appli gener perform comput platform class except kernel abstract particular platform provid concret subclass exampl refer platform defin platform subclass call referenceplatform kernelfactori subclass call referencekernelfactori concret subclass abstract kernelimpl type referencecalcnonbondedforcekernel extend calcnonbondedforcekernel turn extend kernelimpl referenceintegrateverletstepkernel extend integrateverletstepkernel understand better walk entir sequenc event take place creat context exampl suppos creat system add nonbondedforc creat verletintegr creat context use refer platform happen context constructor creat contextimpl contextimpl call codecreateimpl forc system creat instanc appropri forceimpl subclass contextimpl call codecontextcr platform turn call codesetplatformdata contextimpl allow platformspecif inform store contextimpl everi platform mechan store particl mass constraint definit particl posit contextimpl therefor allow platform creat arbitrari block data store access platform kernel contextimpl call codecreatekernel platform sever time get instanc variou kernel need calckineticenergykernel applyconstraintskernel etc kernel platform look kernelfactori regist particular kernel case referencekernelfactori call codecreatekernelimpl kernelfactori creat return instanc appropri kernelimpl subclass referencecalckineticenergykernel referenceapplyconstraintskernel etc contextimpl loop forceimpl call codeiniti one forceimpl ask platform creat whatev kernel need exampl nonbondedforceimpl request calcnonbondedforcekernel get back referencecalcnonbondedforcekernel contextimpl call codeiniti integr like object request kernel platform exampl verletintegr request integrateverletstepkernel get back referenceintegrateverletstepkernel point context fulli initi readi comput refer implement variou kernelimpl creat alway referenc abstract superclass similarli data structur specif refer platform creat store contextimpl format content structur opaqu contextimpl whenev need access exampl get set particl posit kernel updatestatedatakernel case suppos call codestep verletintegr happen execut time step verletintegr call codeupdatecontextst contextimpl give forc opportun modifi state context start time step contextimpl loop forceimpl call codeupdatecontextst one case forceimpl nonbondedforceimpl return without anyth hand andersenthermostat system forceimpl would invok kernel modifi particl veloc verletintegr call codecalcforcesandenergi contextimpl request forc comput contextimpl call codebegincomput calcforcesandenergykernel initi forc zero initi platform requir forc comput exampl platform construct nonbond neighbor list point contextimpl loop forceimpl call codecalcforcesandenergi one case nonbondedforceimpl invok calcnonbondedforcekernel comput forc final contextimpl call codefinishcomput calcforcesandenergykernel addit work need determin final forc sum valu intermedi buffer final verletintegr invok integrateverletstepkernel take forc posit veloc store platform specif format contextimpl use comput new posit veloc store contextimpl role code raw html style code fontfamilymonospac style style caption textaligncent style highlight c introduct guid describ intern architectur openmm librari target develop want add featur openmm either modifi core librari directli write plugin want write applic use openmm need read guid user manual tell everyth need know guid intend peopl want contribut openmm organ follow chapter numrefthecorelibrari describ architectur core openmm librari discuss high level low level api relat flow execut chapter numrefwritingplugin describ detail write plugin focus two common type plugin defin new forc implement new platform chapter numrefthereferenceplatform discuss architectur refer platform provid inform relev write refer implement new featur chapter numrefthecpuplatform discuss architectur cpu platform provid inform relev write cpu implement new featur chapter numreftheopenclplatform discuss architectur opencl platform provid inform relev write opencl implement new featur chapter numrefthecudaplatform discuss architectur cuda platform provid inform relev write cuda implement new featur chapter numrefcommoncomput describ common comput framework let write singl implement featur use opencl cuda guid assum alreadi familiar public api use openmm applic case first read user manual work exampl program pay especi close attent introduct openmm librari chapter sinc introduc concept import understand guid role code raw html style code fontfamilymonospac style style caption textaligncent style highlight c _commoncomput common comput common comput platform share mani element one exist reduc code duplic opencl cuda platform allow singl implement written kernel use platform opencl cuda similar comput model nearli ident exampl base around launch kernel execut parallel mani thread group thread block commun synchron permit thread block one differ block similar memori hierarchi high latenc global memori low latenc localshar memori use commun thread block local variabl visibl singl thread even languag write kernel similar opencl kernel add two array togeth store result third array __kernel void addarrays__glob const float restrict __global const float restrict b __global float restrict c int length int get_global_id length get_global_s ci aibi correspond cuda kernel __extern c __global__ void addarraysconst float __restrict__ const float __restrict__ b _float __restrict__ c int length int blockidxxblockdimxthreadidxx length blockdimxgriddimx ci aibi differ larg mechan findandreplac mani year write maintain nearli ident kernel hand final occur us translat could done automat compil simpli defin preprocessor macro follow kernel compil equal well either opencl cuda kernel void addarraysglob const float restrict global const float restrict b global float restrict c int length int global_id length global_s ci aibi write devic code compil kernel common comput api follow macro defin macro opencl definit cuda definit codekernel code__kernel codeextern c __global__ codedevic code__device__ codeloc code__loc code__shared__ codelocal_arg code__loc codeglob code__glob coderestrict coderestrict code__restrict__ codelocal_id codeget_local_id codethreadidxx codelocal_s codeget_local_s codeblockdimx codeglobal_id codeget_global_id codeblockidxxblockdimxthreadidxx codeglobal_s codeget_global_s codeblockdimxgriddimx codegroup_id codeget_group_id codeblockidxx codenum_group codeget_num_group codegriddimx codesync_thread codebarrierclk_local_mem_fenceclk_global_mem_f code__syncthread codesync_warp simt width comput capabl codemem_fenceclk_local_mem_f code__syncwarp otherwis otherwis empti codebarrierclk_local_mem_f codemem_f codemem_fenceclk_local_mem_fenceclk_global_mem_fencecode__threadfence_block codeatomic_adddest valuecodeatom_adddest valu codeatomicadddest valu symbol may may defin base devic run codesupports_double_precis codesupports__bit_atom use codeifdef block symbol condit compil code base featur support devic addit cuda compil defin symbol code__cuda_arch__ check symbol want differ code block cuda opencl opencl cuda defin vector type like codeint codefloat type support differ overlap write common code use vector type support opencl cuda element vector type codeshort codeint codefloat codedoubl cuda use function construct vector valu codemake_floatx opencl instead use typecast like syntax codefloat x common code use cuda style codemake_ function openmm provid definit function compil opencl cuda vector type simpli data structur access element much contrast opencl vector mathemat type standard math oper defin well geometr function like codedot codecross compil kernel cuda openmm provid definit oper function opencl also support swizzl notat vector exampl codef codefloat construct vector first three element write codefxyz swap first two element write codefxi fyx unfortun practic way support cuda swizzl notat use common code strip final element four compon vector common oper openmm provid special function codetrimtof vector first three element bit integ anoth data type need special handl opencl cuda support use differ name codelong opencl codelong long cuda work around inconsist openmm provid typedef codemm_long codemm_ulong sign unsign bit integ devic code write host code host code common comput similar host code opencl cuda fact class provid opencl cuda platform subclass common comput class exampl openclcontext cudacontext subclass computecontext write common code kernelimpl expect computecontext pass constructor use common api provid abstract class use either opencl cuda base particular context pass runtim similarli openclnonbondedutil cudanonbondedutil subclass abstract nonbondedutil class arrayinterfac abstract class defin interfac array store devic openclarray cudaarray subclass simplifi code creat use array also third subclass call computearray act wrapper around openclarray cudaarray automat creat array appropri type current platform practic follow rule whenev need creat array make computearray whenev write function expect array pass declar type arrayinterfac two thing differ platform handl automat opencl cuda quit differ api compil invok kernel hide differ openmm provid set abstract class compil devic code pass sourc code codecompileprogram computecontext return computeprogram call codecreatekernel method get computekernel object method set argument invok kernel sometim need refer vector type host code set valu kernel argument access element array opencl cuda defin type differ name case want avoid use openclspecif cudaspecif type common code openmm therefor defin type vector host code name correspond type devic code prefix codemm_ exampl codemm_int codemm_float three compon vector need special care context platform defin differ opencl three compon vector essenti four compon vector whose last compon ignor exampl codesizeoffloat cuda opencl within kernel distinct usual ignor commun host devic becom vital import gener best avoid store three compon vector array pass argument codemm_ host type defin three compon vector cuda opencl would requir defin differ way role code raw html style code fontfamilymonospac style style caption textaligncent style highlight c _thereferenceplatform refer platform refer platform written simplic clariti mind perform still alway simpl clear one might hope goal implement new featur recommend creat refer implement first use model version platform use refer platform platformspecif data store contextimpl type referenceplatformplatformdata declar referenceplatformh field store posit veloc box vector type data platformdata vector forc contain one element particl start forc evalu element set zero forc add contribut vector end contain total forc act particl addit class contain use static method simtkopenmmutil variou util function import random number gener referenceforc provid method calcul displac two posit option take period boundari condit account role code raw html style code fontfamilymonospac style style caption textaligncent style highlight c _thecudaplatform cuda platform cuda platform similar opencl platform previou chapter appli equal well chang opencl cuda class name differ worth note compil kernel like opencl platform cuda platform compil kernel runtim unlik opencl cuda built support runtim compil openmm therefor need implement write sourc code disk invok nvcc compil separ process load compil kernel disk part ignor call codecreatemodul cudacontext pass cuda sourc code take care detail compil load return cumodul object done call codegetkernel look individu kernel modul repres cufunct object codeexecutekernel execut cuda platform need two thing make work directori disk write temporari file path nvcc compil specifi cudatempdirectori cudacompil properti creat new context often figur suitabl valu sometim need help see platformspecif properti chapter user manual detail accumul forc opencl platform describ section numrefcomputingforc use two type buffer accumul forc set float point buffer singl fix point buffer contrast cuda platform use fix point buffer repres cuda type codelong codelong mean cuda platform work devic support bit atom oper comput capabl higher currentmodul openmmopenmm openmm python api python api provid inform class method avail openmm python develop openmm consist two part first set reflibrari librari perform mani type comput need molecular simul forc evalu numer integr energi minim etc second refappl layer app set python librari provid high level interfac run simul layer target comput biologist peopl want run simul may may programm see user guid detail toctre maxdepth app librari objnam underlin currentmodul modul autoclass objnam block method automethod __init__ method rubric method autosummari item method name item endfor endif endblock block attribut attribut rubric attribut autosummari item attribut name item endfor endif endblock extra class tabul function class use tabl valu defin mathemat function use variou refcustom forc customforc refopenmmtabulatedfunct class abstract class class extend toctre maxdepth generatedtabulatedfunct generatedcontinuousdfunct generatedcontinuousdfunct generatedcontinuousdfunct generateddiscretedfunct generateddiscretedfunct generateddiscretedfunct virtual site virtual site particl whose posit comput directli posit particl refopenmmvirtualsit class abstract class class extend toctre maxdepth generatedvirtualsit generatedlocalcoordinatessit generatedoutofplanesit generatedthreeparticleaveragesit generatedtwoparticleaveragesit serial class use serial object allow store disk toctre maxdepth generatedserializationnod generatedserializationproxi generatedxmlseri class class dont fit neatli categori say arent import toctre maxdepth generatedlocalenergyminim generatednosehooverchain generatedopenmmexcept generatedvec _forc forc forc abstract class forc object ad system defin behavior particl forc abstract class subclass implement specif behavior class extend forc may implement actual physic forc number process either actual appli forc particl directli modifi posit momenta toctre maxdepth generatedforc common bond nonbond forc class implement forc wide use biomolecular simul toctre maxdepth generatedcmaptorsionforc generateddrudeforc generatedgbsaobcforc generatedgayberneforc generatedharmonicangleforc generatedharmonicbondforc generatednonbondedforc generatedperiodictorsionforc generatedrbtorsionforc amoeba forc forc use implement polariz amoeba forc field toctre maxdepth generatedamoebageneralizedkirkwoodforc generatedamoebamultipoleforc generatedamoebatorsiontorsionforc generatedamoebavdwforc generatedamoebawcadispersionforc generatedhippononbondedforc pseudoforc inherit forc describ physic forc use implement thermostat barostat otherwis modifi simul step step conceptu closer modif integr provid forc simplifi implement allow combin arbitrari way toctre maxdepth generatedandersenthermostat generatedcmmotionremov generatedmontecarloanisotropicbarostat generatedmontecarlobarostat generatedmontecarloflexiblebarostat generatedmontecarlomembranebarostat generatedrmsdforc generatedrpmdmontecarlobarostat _customforc custom forc openmm provid number class make easier implement custom forc common scenario class implement constructor take algebra express string class instanti extend provid forc object effici implement provid express toctre maxdepth generatedcustomangleforc generatedcustombondforc generatedcustomcvforc generatedcustomcentroidbondforc generatedcustomcompoundbondforc generatedcustomexternalforc generatedcustomgbforc generatedcustomhbondforc generatedcustommanyparticleforc generatedcustomnonbondedforc generatedcustomtorsionforc openmm c api c api provid inform class method avail openmm c develop openmm use objectori api make function avail small number class core class toctre maxdepth hidden generatedsystem generatedcontext generatedst generatedplatform cppclassopenmmsystem system specifi gener properti molecular system simul number particl contain mass one size period box interact particl specifi set refforc forc object ad system forc field specif paramet particl charg store forc object direct properti system cppclassopenmmcontext context store state inform simul particl posit veloc well arbitrari paramet defin forc system possibl creat multipl context singl system thu multipl simul system progress time context provid method access state variabl directli must read via state object cppclassopenmmst state object must construct data read simul state variabl access directli via context order make explicit precis time variabl reflect state creat call method context store inform request invoc cppclassopenmmplatform platform singl implement openmm low level allow high level api document use sort comput hardwar gpu supercomput platform implement set kernel defin oper support write new platform allow openmm port new hardwar implement new way without rewrit entir applic forc forc object defin behavior particl system forc class actual slightli gener name suggest forc inde appli forc particl also directli modifi particl posit veloc arbitrari way thermostat barostat exampl implement forc class exampl forc subclass includ cppclassharmonicbondforc openmmharmonicbondforc cppclassnonbondedforc openmmnonbondedforc cppclassmontecarlobarostat openmmmontecarlobarostat toctre maxdepth forc integr integr implement algorithm advanc simul time provid context mean step simul forward must coupl context function exampl integr subclass includ cppclasslangevinintegr openmmlangevinintegr cppclassverletintegr openmmverletintegr cppclassbrownianintegr openmmbrownianintegr toctre maxdepth integr extra openmm public api includ class support toctre maxdepth extra integr integr abstract class integr implement algorithm advanc simul time integr abstract class subclass implement specif algorithm toctre maxdepth generatedintegr gener purpos integr integr appropri tradit md bd simul toctre maxdepth generatedbrownianintegr generatedlangevinintegr generatedlangevinmiddleintegr generatednosehooverintegr generatedvariablelangevinintegr generatedvariableverletintegr generatedverletintegr drude integr integr permit model polar drude particl toctre maxdepth generateddrudeintegr generateddrudelangevinintegr generateddrudenosehooverintegr generateddrudescfintegr ring polym molecular dynam integr rpmd integr implement ring polym md toctre maxdepth generatedrpmdintegr custom integr class facilit customis integr customintegr allow wide varieti integr algorithm implement effici without write lowlevel code integr built seri step defin algebra express compoundintegr allow differ integr combin make possibl switch activ integr middl simul toctre maxdepth generatedcustomintegr generatedcompoundintegr