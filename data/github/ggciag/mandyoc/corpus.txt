project author mandyoc develop current maintain victor sacekhttpsgithubcomvictorsacek sacekuspbr iag universidad de são paulo brazil orcid follow peopl made significantli contribut project alphabet order last name consid mandyoc develop jamison assunçãohttpsgithubcomjamisonassuncao jamisonassuncaouspbr iag universidad de são paulo brazil orcid agustina pescehttpsgithubcomaguspesc pesceagustinagmailcom instituto geofísico sismológico ing volponi universidad nacion de san juan argentina conicet argentina orcid rafael monteiro da silvahttpsgithubcomrafaelmd rafaelmsilvaalumniuspbr iag universidad de são paulo brazil orcid contribut mandyoc contribut mandyoc welcom issu bug code contribut document contribut thank help improv mandyoc contribut mandyoc submit bug report featur request write tutori exampl fix typo improv document write code everyon use report bug find issu click new issu rememb _choos bug label_ type issu creat bug report pleas specif possibl describ reproduc issu includ intendedexpect result actual get attach much possibl follow inform issu minim paramet file reproduc issu logtxt file creat model run error messag saw screen inform help us understand think bug reproduc make mandyoc better first thank consid contribut project want make kind contribut mandyoc pleas note follow gener guidelin gener guidelin _follow git pull request workflowhttpswwwasmeurercomgitworkflow make chang code base_ everi chang made goe pull request even continu integr servic chang check code standard pass test way mastermain branch alway stabl gener guidelin pull request pr open issu first describ want alreadi issu match pr leav comment instead let us know plan creat fork repositori person account clone comput bash git clone yourforkurl creat separ branch sometim call featur branch modif bash git checkout b branchnam creat branch make chang commit rememb keep commit atom commit repres singl unit chang also rememb write help commit messag someon understand commit bash git add filenam git commit push chang fork bash git push make pull request ensur pr descript clearli describ problem solut includ relev issu number rememb test chang regress test check mandyoc output result equal expect result make test need instal pytest run bash make test _note_ might need manual set environ variabl petsc_dir petsc_arch use prefix instal question mandyoc code ask question open issu label _question_ contributor code conduct pledg interest foster open welcom environ contributor maintain pledg make particip project commun harassmentfre experi everyon regardless age bodi size disabl ethnic gender ident express level experi nation person appear race religion sexual ident orient standard exampl behavior contribut creat posit environ includ use welcom inclus languag respect differ viewpoint experi grace accept construct critic focus best commun show empathi toward commun member exampl unaccept behavior particip includ use sexual languag imageri unwelcom sexual attent advanc troll insultingderogatori comment person polit attack public privat harass publish other privat inform physic electron address without explicit permiss conduct could reason consid inappropri profession set respons project maintain respons clarifi standard accept behavior expect take appropri fair correct action respons instanc unaccept behavior project maintain right respons remov edit reject comment commit code wiki edit issu contribut align code conduct ban temporarili perman contributor behavior deem inappropri threaten offens harm see action last resort goal maintain friendli inclus commun everyon feel welcom particip express conduct individu jeopard harmoni project need address scope code conduct appli within project space public space individu repres project commun exampl repres project commun includ use offici project email address post via offici social media account act appoint repres onlin offlin event represent project may defin clarifi project maintain enforc instanc abus harass otherwis unaccept behavior may report contact victor saceksacekuspbr complaint review investig result respons deem necessari appropri circumst project team oblig maintain confidenti regard report incid detail specif enforc polici may post separ project maintain follow enforc code conduct good faith may face temporari perman repercuss determin member project leadership attribut code conduct adapt contributor covenanthttpcontributorcovenantorg version avail httpcontributorcovenantorgversionhttpcontributorcovenantorgvers titl mandyoc finit element code simul thermochem convect parallel tag petsc mantl convect lithospher geodynam finit element author name victor sacek orcid affili name jamison assunção orcid affili name agustina pesc orcid affili name rafael monteiro da silva orcid affili affili name instituto de astronomia geofísica e ciência atmosférica universidad de são paulo brazil index name instituto geofísico sismológico ing volponi universidad nacion de san juan argentina index name conicet argentina index date june bibliographi paperbib option field submit aa journal see blog post httpsblogjosstheojorganewcollaborationwithaaspublish aasdoi xxxxx updat doi aa know aasjourn astrophys journal name aa journal summari mandyoc finit element code written c dedic simul thermochem convect interior terrestri planet differ linear nonlinear rheolog adopt appropri simul strain stress pattern earth crust mantl extension collision tecton addit code allow variat boundari condit veloc field space time simul differ puls tecton numer scenario statement need mandyoc acronym mantl dynam simul code design simul stoke flow type thermochem convect take differ composit layer account also appropri simul earth lithospher dynam geolog timescal similar code avail geodynam problem like aspect khbaspectbangerthwolfgang_bangerth__ underworld moresicomputationalbeucheruwgeodynam therefor mandyoc altern preexist softwar one advantag mandyoc possibl creat scenario veloc boundari condit variabl space time allow user simul differ tecton puls model run addit current version incorpor surfac process impos rate eros sediment top free surfac silvainflu recent thermomechan code avail scientif commun incorpor interact surfac process eg beuchermorphotecton neuharthevolut take account simul fluvial hillslop process present version mandyoc predefin erosionsediment rate variabl space time possibl previou version code use studi evolut continent margin show interact continent lithospher asthenospher mantl sacekpostsalazarlater mathemat mandyoc solv equat conserv mass momentum energi use finit element method assum extend boussinesq approxim respect beginalign u_ii sigma_ijj g_i rho fracparti tpartial u_i t_i kappa t_ii frachc_p rho fracu_i g_i alpha tc_p endalign beginalign sigma_ij p delta_ij eta left u_ij u_ji right rho rho_ left alpha t_ right endalign u_i compon veloc field temperatur time kappa thermal diffus h volumetr heat product c_p specif heat capac g graviti rho effect rock densiti depend temperatur composit rho_ refer rock densiti temperatur t_ alpha coeffici thermal expans p dynam pressur eta effect viscos delta_ij kroneck delta code fulli parallel use portabl extens toolkit scientif comput petsc petscefficientpetscuserrefpetscwebpag present version code simul thermochem convect use differ rheolog formul newtonian flow nonlinear viscou flow viscoplast deform exampl lithospher simul combin differ viscoplast layer effect viscos depend nonlinear power law viscou rheolog plastic yield criterion like druckerprag criterion addit strain soften implement facilit local strain plastic regim exampl lithospher stretch composit strain histori track particl present interior finit element exchang particl among subdomain model effici parallel petsc use dmswarm maydmswarm free surfac earth simul numer stabil use free surfac stabil algorithm kausstabil surfac process eros sediment also incorpor thermomechan model allow coupl earth interior dynam process occur surfac complex boundari condit veloc field variabl space time adopt user simul differ episod tecton differ benchmark avail repositori reproduc user includ thermochem convect vancomparison plumelithospher interact cramericomparison exampl applic mandyoc autoreffigrift present snapshot one numer scenario lithospher stretch impos diverg flow direct result rift breakup exampl upper crust lower crust lithospher mantl asthenospher present differ rheolog densiti result fault mainli upper crust part lithospher mantl addit deform lower crust base lithospher mantl accommod ductil creep flow exampl reproduc repositori mandyoc exampl applic thermomechan model simul stretch lithospher assum differ rheolog scale gray repres cumul strain differ materi detail found repositorylabelfigriftjoss_figurepng acknowledg acknowledg contribut dave may help implement multigrid algorithm project sponsor fapesp process petrobra process refer imag httpsjosstheojorgpapersjossstatussvg target httpsdoiorgjoss raw html div classbann hmandyoch p strongmantl dynam simul codestrongp div mandyoc finit element code written top petsc_ librari simul thermochem convect earth mantl differ linear nonlinear rheolog adopt appropri simul strain stress pattern earth crust mantl extension collision tecton document document page httpsggciaggithubiomandyoc__ abl find relev inform code work implement instal descript paramet input file applic use exampl need help discuss happen github httpsgithubcomggciagmandyoc__ feel free open issu httpsgithubcomggciagmandyocissuesnew__ comment open issu pull request also send email sacekuspbr jamisonassuncaouspbr contribut code conduct pleas note project releas contributor code conduct httpsgithubcomggciagmandyocblobmaincode_of_conductmd__ particip project agre abid term contribut guidelin contribut mandyoc welcom issu bug code contribut document contribut thank help improv mandyoc check contribut guid httpsgithubcomggciagmandyocblobmaincontributingmd__ licens free softwar redistribut andor modifi term bsd claus licens copi licens provid licens httpsgithubcomggciagmandyocblobmainlicense__ _petsc httpswwwmcsanlgovpetsc mandyocdoc document master file creat sphinxquickstart mon nov adapt file complet like least contain root toctre direct includ readmerst toctre hidden number maxdepth caption get start filestheori filesimplement filesinstal filesparameterfil filesinput filesbenchmark filesrefer toctre hidden number maxdepth caption get help contribut contribut httpsgithubcomggciagmandyocblobmaincontributingmd code conduct httpsgithubcomggciagmandyocblobmaincode_of_conductmd sourc code httpsgithubcomggciagmandyoc refer bibliographi _inputfil input file mandyoc accept ascii file use initi condit simul initi temperatur file input_temperature_txt file contain initi interfac geometri interfacestxt file contain initi veloc field face model input_velocity_txt next subsect help creat one file ascii temperatur file grid initi temperatur configur provid ascii file call intialtemperaturetxt consid mathx longitudin direct mathi vertic direct mathz latitudin direct next subsect guid understand initi temperatur file structur grid initi temperatur configur provid ascii file call input_temperature_txt consid mathx longitudin direct mathi vertic direct next subsect guid understand initi temperatur file structur temperatur grid consid grid number node mathx mathi direct mathnxgeq mathnygeq respect mathnx element mathx direct mathni element mathi direct node grid identifi coordin pair mathx_n y_m mathn mathm natur number mathx_n mathy_m mathx mathi posit meter grid node numrefcoordinatesd show scheme grid red dot repres grid node everi node label mathx_n y_m pair dot line repres number intermedi node consid grid mathnx element mathx direct mathni element mathi direct number node mathx mathi direct mathnx mathni respect node identifi pair mathx_n y_m mathn leq nx mathbbn mathm leq ny mathbbn mathx_n mathy_m mathx mathi posit meter grid node numrefcoordinatesd show scheme grid red dot repres grid node dot line repres number element node everi node label mathx_n y_m pair _coordinatesd figur figscoordinatesdpng width align center alt coordin grid scheme red dot repres grid node valu temperatur must defin dot line repres number grid node simplif label indic mathx mathi posit node note way mandyoc deal coordin node mathx_y_ alway origin math also true grid mathx_y_z_ math note way mandyoc deal coordin node mathx_y_ alway origin math exampl show input_temperature_txt file must written grid numrefcoordinatesd write four line comment file must includ temperatur mathtx_n y_m node start bottom left model go mathi direct intuit temperatur given horizont layer everi mathx_n literalinclud srcinitialtemperaturedtxt languag text lineno tip alway help use four comment line write use inform later line simpli skip rule write symbol use convent temperatur grid construct input_temperaturetxt file three dimension grid numrefcoordinatesd similar case except necessari provid temperatur horizont layer node mathxz mathyy_y_y_ni grid numrefcoordinatesd number node mathz direct call mathnz temperatur node mathtx_n y_m z_p mathp leq nz mathbbn _coordinatesd figur figscoordinatesdpng width align center alt coordin grid scheme red dot repres grid node valu temperatur must defin dot line repres number grid node simplif exampl show input_temperaturetxt file gener grid numrefcoordinatesd follow four line comment temperatur valu node must provid line literalinclud srcinitialtemperaturedtxt languag text lineno ascii interfac file input_interfacestxt file grid start seven line variabl use rheolog model variabl interfac might use eqpowerlaw eqfrankkamenetskii mathc mathrho_r mathh matha mathn mathq mathv one variabl possess number valu column assign litholog unit model everi interfac boundari two litholog unit therefor number column plu number interfac set paramtxt file see docparamet file sectionparameterfil mathi interfac mathi valu variabl must provid input_interfacestxt file discuss order valu shortli interfacestxt file grid start seven line variabl use rheolog model variabl interfac might use eqpowerlaw eqfrankkamenetskii mathc mathrho_r mathh matha mathn mathq mathv one variabl possess number valu column assign litholog unit model everi interfac boundari two litholog unit therefor number column plu number interfac set paramtxt file see docparamet file sectionparameterfil mathi interfac mathi valu variabl must provid interfacestxt file discuss order valu shortli initi interfac exampl correspond grid two interfac therefor three litholog unit first column contain vertic posit meter everi grid node mathy_m correspond deepest interfac boundari start mathxx_ line end mathxx_nx line mathnx second column contain vertic posit everi mathy_m correspond second interfac boundari defin interfac rather common touch interfac must provid tetri manner interfac collinear part fit interfac note interfac defin linearli node import defin properli everi point insid grid attribut litholog unit literalinclud srcinitialinterfacesdtxt languag text lineno valu variabl first seven line valu litholog unit bound interfac grid two interfac first valu variabl refer litholog unit first interfac second valu variabl refer litholog unit first second interfac third valu variabl refer litholog unit second interfac interfac ad unit bound upper lower interfac initi interfac grid input_interfacestxt file similar grid one differ lie complet interfac mathzz_ anoth set valu ad subsequ mathzz_ mathzz_nz input_interfacestxt file show exampl case literalinclud srcinitialinterfacesdtxt languag text lineno ascii veloc file grid input_velocitytxt file possess four line header follow veloc data node model initi veloc file allow initi veloc field establish simul fluid present initi momentum respect conserv mass equat design initi veloc field fundament simul run properli addit veloc boundari condit defin paramtxt see docparamet file sectionparameterfil use defin normal tangenti veloc face model simul initi veloc velocity_from_ascii true set paramtxt file initi veloc field must provid ascii file call input_velocity_txt grid input_velocity_txt file possess four line header follow veloc data node model veloc must defin mathx mathi direct take exampl file input_velocity_txt file must written way valu veloc mathx direct mathv_x veloc mathi direct mathv_i node mathx_y_ correspond line respect veloc valu mathx_y_ correspond line mathx_nxy_ node mathy_ written valu mathx_n insert mathy_ mathy_ni literalinclud srcinitialvelocitydtxt languag text lineno multipl initi veloc user provid multipl veloc field set differ instant simul set multi_veloc true paramtxt file ascii file call multi_veloctxt must provid follow structur shown exampl file first line file contain amount instant differ veloc field use line contain time million year veloc field adopt exampl differ veloc field use three instant file must follow structur present last section name sequenc input_velocity_txt input_velocity_txt input_velocity_txt name file label three differ instant set first line multi_veloctxt file literalinclud srcmulti_veloctxt languag text lineno note input_velocity_txt use begin simul multipl initi veloc set simul start input_velocity_txt end input_velocity_xtxt mathx number differ instant veloc field chang rescal boundari condit variable_bcv true set paramtxtfil ascii file call scale_bcvtxt use defin sequenc rescal step veloc boundari condit exampl file exampl file written exampl file first line correspond number instant simul veloc field rescal first column contain time million year veloc field chang second column contain scale valu exampl instant math myr veloc field multipli math effect halv math myr current veloc field direct chang henc multipli math final math veloc field direct chang doubl multipli math literalinclud srcscale_bcvtxt languag text lineno initi veloc similarli grid input_velocity_txt file grid must contain veloc valu mathx mathi mathz compon therefor result file differ case shown exampl specifi veloc node mathxz plane depth mathy_m literalinclud srcinitialvelocitydtxt languag text lineno instal mandyoc instal simpl consist instal petsc_ mandyoc warn follow instal step work linux maco machin test made instal mandyoc window machin yet _depend depend build mandyoc follow requir need petsc_ current test version v gcc make git recommend strictli need alreadi petsc instal may need fortran compil addit follow addit softwar need run exampl come mandyoc python requir python packag numpi matplotlib panda jupyterlab run test addit python packag requir pytest build document python packag necessari sphinx sphinx_rtd_them petsc instal mandyoc requir petsc librari run check petsc installation_ detail note follow step exampl instal minimum requir run mandyoc first step download petsc v releas petsc website_ clone repositori machin mandyoc might work latest releas petsc guarante sinc new verion might introduc break chang clone repositori desir locat git clone b v httpsgitlabcompetscpetscgit second configur petsc build set instal directori codeblock bash cd pathtopetsc configur petsc_dirpathtopetsc petsc_archarchlabeloptim withdebug withccgcc withcxxg withfcgfortran downloadfblaslapack downloadmpich downloadmump downloadscalapack downloadparmeti downloadmeti note exampl instal use gfortran compil may use anoth fortran compil chang withfc flag also possibl configur petsc without fortran use withfc chang downloadfblaslapack downloadfcblaslapack note default mandyoc use direct solver lu choleski provid mumps_ requir addit extern packag refer petsc documentation_ inform note want build develop version mandyoc recommend build debug version petsc set withdebug case may set petsc_archarchlabeldebug note prefer openmpi need swith downloadmpich downloadopenmpi check instal codeblock make check follow instruct pop termin inform petsc librari check petsc website_ final add symlink mpirun localbin codeblock ln pathtopetsarchlabeloptimizedbinmpirun localbinmpirun mandyoc instal instal mandyoc machin need clone download latest releas code mandyoc repository_ clone repositori navig directori wish instal mandyoc type codeblock bash git clone httpsgithubcomggciagmandyoc instal mandyoc mast set environ variabl indic path petsc instal folder codeblock bash export petsc_dirpathtopetsc build mandyoc run codeblock make next instal mandyoc codeblock make instal default instal localbin note make sure directori localbin exist otherwis command fail chang instal locat set install_path variabl run codeblock make install_pathpathtoinstallmandyoc instal note print mandyoc runtim option run mandyoc flag command line argument check mandyoc instal codeblock make test note need python python packag run last commmand succes check requir dependencies_ section docker contain provid docker container_ imag mandyoc docker implement contain virtual cite document lightweight standalon execut packag softwar includ everyth need run applic code runtim system tool system librari set visit dockerhub mandyoc repository_ find use contain run mandyoc note use mandyoc docker imag requir instal docker engin find instal docker engine_ page exampl benchmark experi locat exampl httpsgithubcomggciagmandyoctreemainexamples_ folder mandyoc repositori insid exampl folder find jupyt notebook detail explan instruct run experi _petsc httpspetscorgreleas _petsc instal httpspetscorgreleaseinstal _petsc websit httpspetscorgreleasedownload _petsc document httpspetscorgmaindocsmanualpagesmatmatsolvermumpshtml _mandyoc repositori httpsgithubcomggciagmandyoc _mump httpmumpsenseeihtfr _docker contain httpswwwdockercomresourceswhatcontain _dockerhub mandyoc repositori httpshubdockercomrggciagmandyoc _instal docker engin httpsdocsdockercomengineinstal _parameterfil paramet file role rawhtmlraw format html paramet file paramtxt contain inform necessari simul run geometri nx default rawhtmlbr type integ rawhtmlbr unit rawhtmlbr definit number node horizont direct nz default rawhtmlbr type integ rawhtmlbr unit rawhtmlbr definit number node vertic direct lx default rawhtmlbr type real rawhtmlbr unit rawhtmlbr definit extent horizont direct lz default rawhtmlbr type real rawhtmlbr unit rawhtmlbr definit extent vertic direct simul option solver default direct rawhtmlbr type directit rawhtmlbr unit rawhtmlbr definit set solver direct iter denok default e rawhtmlbr type real number rawhtmlbr unit rawhtmlbr definit toler criterion uzawa scheme rtol default e rawhtmlbr type real number rawhtmlbr unit rawhtmlbr definit absolut size residu norm relev iter method rk default euler rawhtmlbr type eulerrungekutta rawhtmlbr unit rawhtmlbr definit particl advect method xi_min default e rawhtmlbr type real number rawhtmlbr unit rawhtmlbr definit toler criterion converg nonlinear flow random_initial_strain default rawhtmlbr type real number rawhtmlbr unit rawhtmlbr definit nondimension valu initi strain perturb entir domain pressure_const default ie use rawhtmlbr type real number rawhtmlbr unit pa rawhtmlbr definit set constant pressur valu domain relev plain view initial_dynamic_rang default fals rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit method smoothen converg veloc field scenario wide viscos rang see gerya citegerya periodic_boundari default fals rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit allow simul period boundari horizont direct high_kappa_in_asthenospher default fals rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit mimic high heat transport asthenospher increas thermal diffus coeffici basal_heat default ie use rawhtmlbr type real number rawhtmlbr unit wm rawhtmlbr definit set basal heat flux valu particl option particles_per_el default rawhtmlbr type integ rawhtmlbr unit rawhtmlbr definit number lagrangian particl element particles_per_element_x default automat calcul rawhtmlbr type integ rawhtmlbr unit rawhtmlbr definit number lagrangian particl horizont direct particles_per_element_z default automat calcul rawhtmlbr type integ rawhtmlbr unit rawhtmlbr definit number lagrangian particl vertic direct particles_perturb_factor default rawhtmlbr type real number rawhtmlbr unit rawhtmlbr definit indic amount perturb initi locat particl rel regular grid distribut surfac process sp_surface_track default fals rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit allow free surfac track across time output sea_level default rawhtmlbr type real number rawhtmlbr unit rawhtmlbr definit sea level use limit influenc surfac process sp_surface_process default fals rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit allow eros sediment simul sp_dt default rawhtmlbr type real number rawhtmlbr unit year rawhtmlbr definit time step surfac process simul al default true rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit allow convers air particl land particl sediment sp_mode default rawhtmlbr type integ rawhtmlbr unit rawhtmlbr definit specifi surfac process method free_surface_stab default true rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit set free surfac stabil algorithm fssa use see kau et al citekau theta_fssa default rawhtmlbr type real number rawhtmlbr unit rawhtmlbr definit weight influenc fssa method relev free_surface_stab true sticky_blanket_air default fals rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit allow increas viscos first air layer particl precipitation_profile_from_ascii default fals rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit set precipit profil along horizont axi read ascii file climate_change_from_ascii default fals rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit true rescal time precipit profil use ascii file time constrain step_max default rawhtmlbr type integ rawhtmlbr unit step rawhtmlbr definit maximum timestep simul time_max default rawhtmlbr type real number rawhtmlbr unit year rawhtmlbr definit maximum time simul dt_max default rawhtmlbr type real number rawhtmlbr unit year rawhtmlbr definit maximum time step simul step_print default rawhtmlbr type integ rawhtmlbr unit step rawhtmlbr definit make output file everi step_print sub_division_time_step default rawhtmlbr type real number rawhtmlbr unit rawhtmlbr definit rescal valu calcul timestep initial_print_step default ie use rawhtmlbr type integ rawhtmlbr unit rawhtmlbr definit step_print use initial_print_max_tim initial_print_max_tim default e rawhtmlbr type real number rawhtmlbr unit year rawhtmlbr definit maximum time make output file everi initial_print_step viscos viscosity_refer default rawhtmlbr type real number rawhtmlbr unit pa rawhtmlbr definit refer mantl viscos viscosity_max default rawhtmlbr type real number rawhtmlbr unit pa rawhtmlbr definit maximum viscos simul viscosity_min default rawhtmlbr type real number rawhtmlbr unit pa rawhtmlbr definit minimum viscos simul viscosity_per_el default constant rawhtmlbr type constantvari rawhtmlbr unit rawhtmlbr definit set viscos constant linearli variabl everi element viscosity_mean_method default harmon rawhtmlbr type harmonicarithmet rawhtmlbr unit rawhtmlbr definit defin method calcul viscos element viscosity_depend default depth rawhtmlbr type pressuredepth rawhtmlbr unit rawhtmlbr definit defin viscos depend pressur depth extern ascii inputsoutput interfaces_from_ascii default fals rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit set interfac litholog read ascii file interfacestxt n_interfac default rawhtmlbr type rawhtmlbr unit rawhtmlbr definit set number interfac read interfac ascii file interfacestxt temperature_from_ascii default fals rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit set initi temperatur read ascii file input_temperature_txt velocity_from_ascii default fals rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit set initi veloc field read ascii file input_velocity_txt variable_bcv default fals rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit allow veloc field rescal time accord ascii file scale_bcvtxt multi_veloc default fals rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit set boundari veloc chang time ascii file multi_veloctxt addit input_velocity_xtxt file binary_output default fals rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit set output binari format print_step_fil default true rawhtmlbr type truefals rawhtmlbr unit rawhtmlbr definit set particl posit print output file physic paramet temperature_differ default rawhtmlbr type real number rawhtmlbr unit k rawhtmlbr definit temperatur differ top bottom model relev temperature_from_ascii fals thermal_expansion_coeffici default rawhtmlbr type real number rawhtmlbr unit k rawhtmlbr definit valu coeffici thermal expans thermal_diffusivity_coeffici default rawhtmlbr type real number rawhtmlbr unit ms rawhtmlbr definit valu coeffici thermal diffus gravity_acceler default rawhtmlbr type real number rawhtmlbr unit ms rawhtmlbr definit valu graviti acceler density_mantl default rawhtmlbr type real number rawhtmlbr unit kgm rawhtmlbr definit valu mantl refer densiti heat_capac default rawhtmlbr type real number rawhtmlbr unit jk rawhtmlbr definit valu heat capac non_linear_method default rawhtmlbr type onoff rawhtmlbr unit rawhtmlbr definit set non linear method use momentum equat adiabatic_compon default rawhtmlbr type onoff rawhtmlbr unit rawhtmlbr definit set adiabat heatingcool activ radiogenic_compon default rawhtmlbr type onoff rawhtmlbr unit rawhtmlbr definit set radiogen heat activ veloc boundari condit top_normal_veloc default rawhtmlbr type fixedfre rawhtmlbr unit rawhtmlbr definit set normal veloc top side model fix free top_tangential_veloc default rawhtmlbr type fixedfre rawhtmlbr unit rawhtmlbr definit set tangenti veloc top side model fix free bot_normal_veloc default rawhtmlbr type fixedfre rawhtmlbr unit rawhtmlbr definit set normal veloc bottom side model fix free bot_tangential_veloc default rawhtmlbr type fixedfre rawhtmlbr unit rawhtmlbr definit set tangenti veloc bot side model fix free left_normal_veloc default rawhtmlbr type fixedfre rawhtmlbr unit rawhtmlbr definit set normal veloc left side model fix free left_tangential_veloc default rawhtmlbr type fixedfre rawhtmlbr unit rawhtmlbr definit set tangenti veloc left side model fix free right_normal_veloc default rawhtmlbr type fixedfre rawhtmlbr unit rawhtmlbr definit set normal veloc right side model fix free right_tangential_veloc default rawhtmlbr type fixedfre rawhtmlbr unit rawhtmlbr definit set tangenti veloc right side model fix free temperatur boundari condit top_temperatur default rawhtmlbr type fixedfre rawhtmlbr unit rawhtmlbr definit set temperatur top side model fix free bot_temperatur default rawhtmlbr type fixedfre rawhtmlbr unit rawhtmlbr definit set temperatur bottom side model fix free left_temperatur default rawhtmlbr type fixedfre rawhtmlbr unit rawhtmlbr definit set temperatur left side model fix free right_temperatur default rawhtmlbr type fixedfre rawhtmlbr unit rawhtmlbr definit set temperatur right side model fix free rheology_model default rawhtmlbr type integ rawhtmlbr unit rawhtmlbr definit flag number predefin rheolog model use simul t_initi default rawhtmlbr type integ rawhtmlbr unit rawhtmlbr definit flag number predefin temperatur model use simul relev temperature_from_ascii fals exampl paramet file paramtxt use make simul mandyoc literalinclud srcparamtxt languag text lineno _basictheori basic theori mandyoc code simul thermochem convect earth mantl follow section explain equat solv code numer approach use basic equat simul mantl thermochem convect adopt formul nonnewtonian fluid togeth boussinesq approxim solv follow equat conserv mass eqmassconserv momentum eqmomentumconserv energi eqenergyconserv citezhong math label massconserv u_ii math label momentumconserv sigma_ijjg_irho_alphatt_ math label energyconserv fracparti tpartial u_it_ikappa t_ii frachc_pfracalpha g u_ec_p mathu veloc mathi direct mathg graviti acceler mathrho_ refer rock densiti temperatur matht_ mathalpha coeffici volumetr expans matht temperatur mathkappa thermal diffus mathh rate radiogen heat per unit mass mathc_p specif heat mathdelta_ij kroneck delta mathsigma_ij stress tensor math label stresstensor sigma_ijpdelta_ijeta u_iju_ji mathp dynam pressur matheta effect viscos rock note adopt einstein notat repeat index term repres summat index comma partial deriv spatial coordin numer approach equat conserv mass momentum energi solv use finit element method citezhong mandyoc use hexahedr element three dimension grid quadrilater element two dimension grid citehugh refmassmomentumimplement subsect present numer method use solv mass momentum equat refenergyimplement subsect show implicit formul use solv energi equat citebraun simul scenario user must provid paramet file paramtxt necessari ascii file initi temperatur field veloc field andor initi interfac model see file createdmodifi see section refparameterfil refinputfil flowchart numrefmandyocschem summar step mandyoc take solv conserv equat perform simul _mandyocschem figur figsmandyocschemepng width align center alt flowchart flowchart show step mandyoc take solv equat conserv mass momentum energi numrefmandyocschem show code start run input file read paramtxt ascii input file mandyoc use effect viscos field matheta eqeffectiveeta calcul veloc field mathu check converg condit satisfi toler mathtol shown eqtol citethieulot math label tol chi_ffraclangl fi langl fi rangl ranglecdot langl fi langl fi rangl ranglelangl fi langl fi rangl ranglecdot langl fi langl fi rangl rangleleq tol mathf vector compon veloc mathu mesh node mathi iter number mathlangl f rangl repres mean valu mathf mathtol toler paramet minimum toler reach mandyoc util uzawa method iter calcul new mathu mathp field updat field modifi viscos field matheta turn disturb veloc field field updat toler reach default toler valu mandyoc math addit composit factor mathc evalu advect equat solut calcul place randomli number particl within finit element mesh displac base adjac node veloc valu citetackley individu valu particl obtain linear interpol node valu math label advect fracparti cpartial u_ic_i veloc field solv mandyoc comput temperatur field function mathu mathkappa mathh next step surfac process comput maximum time step maximum simul time reach code updat time goe back comput new veloc field _numericalimplement numer implement follow section show numer method implement solv equat conserv mass momentum energi present refbasictheori section _massmomentumimplement mass momentum equat solut domain mathomega find flow veloc mathu_ig_iv_i pressur mathp state galerkin weak formul stoke flow mathg_i specifi boundari veloc mathv_i belong set function mathmathcalv everi function equal zero boundari mathith compon veloc mathg_i mathp belong set function mathmathcalp equat conserv mass momentum written follow citezhong math label weakformul int_omegaw_ijsigma_ijdomega int_omegaqu_iidomega int_omegaw_i f_idomega sum_in_sdint_gamma_h_iw_i h_i dgamma mathw_i mathcalv mathq mathcalp weight function boundari condit defin math label boundarycondit u_i g_i text gamma_g_i sigma_ijn_j h_i text gamma_h_i mathgamma_h_i boundari mathith compon forc set mathh_i mathn_j normal vector boundari mathgamma_h_i mathf_igrho_ alpha delta_i citehugh weak formul rewritten math label weakformul int_omegaw_ijc_ijklv_kldomega int_omegaqv_iidomega int_omegaw_iipdomega int_omegaw_if_idomega sum_in_sdint_gamma_h_iw_ih_idgamma int_omegaw_ijc_ijklg_kldomega mathc_ijkletadelta_ikdelta_jldelta_ildelta_jk obtain stress tensor equat see eqstresstensor docbas theori sectiontheori veloc field pressur field weight function shape function interpol grid point everi node given math label vshapefunct mathbfv v_i mathbfe_i sum_ain omegavgammav_g_in_a v_iamathbfe_i math label wshapefunct mathbfw w_i mathbfe_i sum_ain omegavgammav_g_in_a w_iamathbfe_i math label gshapefunct mathbfg sum_ain omegavgammav_g_in_a g_iamathbfe_i math label pshapefunctionn p sum_bin omegapm_b p_b math label qshapefunct q sum_bin omegapm_b q_b mathn_a shape function veloc node mathm_b shape function pressur node b mathomegav veloc node set mathomegap pressur node set mathgammag_g_i veloc node set along boundari mathgamma_g_i mandyoc defin mathomegap center element mathomegav defin everi element vertex avoid spuriou flow solut numer instabl citezhong keep veloc shape function one order higher pressur shape function common strategi use finit element model incompress media citehugh shape function galerkin weak formul eqweakformul follow express obtain math label implic sum_binomegavgammav_g_jbig mathbfet_i int_omegabt_a b_b domega mathbfe_j v_jb big sum_bin omegapbig mathbfe_i int_omegan_ai m_b domega p_b big int_omegan_a mathbfe_i f_i domega sum_in_sdint_gamma_h_in_a mathbfe_i h_i dgamma sum_bin gammav_g_jbig mathbfet_i int_omegabt_a bt_b domega mathbfe_j g_jb big also math label implic sum_bin omegav gammav_g_jint_omegam_a n_bj domega mathbfe_j v_jb matrix represent two equat present math label matrixrepresent beginbmatrix k g gt endbmatrix left beginarrayc v p endarray right left beginarrayc f endarray right mathv vector veloc valu mathomegav mathp vector pressur valu mathomegap mathf result vector rigthhand side equat eqimpl eqimpl mathk stiff matrix mathg discret gradient oper mathgt discret diverg oper citezhong mathk mathg mathgt deriv first second term eqimpl eqimpl matrix oper mathb eqimpl contain spatial deriv shape function mathn plane written math label b_a b_a beginbmatrix n_a n_a n_a n_a endbmatrix eqimpl plane strain problem effect viscos matrix mathd written math label beginbmatrix eta eta eta endbmatrix stiff matrix mathk gradient oper mathg written math label k k_lm mathbfet_i int_omegabt_a b_b domega mathbfe_j math label g g_lm mathbfe_i int_omegan_a m_b domega mathbfe_j subscript matha mathb global veloc node number mathi mathj degre freedom per grid node rang math mathn_sd mathl mathm global equat number veloc rang math mathn_v n_sd mathn_v number veloc node grid _energyimplement energi equat possibl repres energi conserv equat eqenergyconserv finit element problem solut domain mathomega_v follow math label feenergyconserv mathbfm mathbfdota_t mathbfk_a mathbfk_cmathbfa_t mathbff mathmathbfm mathmathbfk_a mathmathbfk_c mathmathbff written math label mathbfm int_omega_vmathbfnt_v rho_ c_p mathbfn_v domega_v math label ka mathbfk_a int_omega_vmathbfnt_v rho_ c_p mathbfv cdot mathbfb_v domega_v math label kc mathbfk_c int_omega_vmathbfbt_v rho_ c_p mathbfv cdot mathbfb_v domega_v math label f mathbff int_omega_vmathbfnt_v big frachc_p fracalpha g u_c_p big domega_v mathmathbfn_v row vector shape function mathmathbfa_t column vector unknown temperatur paramet mathmathbfdota_t time deriv mathmathbfb_v equiv nabla mathbfn_v note superscript matht repres transpos matrix nonsuperscript matht repres temperatur mathmathbfm mathmathbfk_c symmetr mathmathbfk_a asymmetri decreas accuraci solut advect domin conduct citezienkiewicz chapter increas numer accuraci stabil mandyoc use streamlin upwind petrovgalerkin process modifi mathmathbfk_a mathmathbfk_a citezienkiewiczhugheshugh math label kastar mathbfk_a int_omega_vmathbfnt_v rho_ c_p mathbfv cdot mathbfb_v domega_v mathn_vi math label nstar n_vi n_vi fracalpha_opt mathbfv cdot nabla n_vimathbfv mathh characterist element size advect veloc direct mathmathbfv mathalpha_opt math label alphaopt alpha_opt cothp fracp text pe fracmathbfvh kappa rho_ c_p time discret made implicit scheme citebraun math label timediscret fracmathbfa_ttdelta mathbfa_ttdelta theta mathbfdota_ttdelta tthetamathbfa_tt maththeta weight paramet multipli side eqtimediscret mathmathbfmtdelta assum mathmathbfmtdelta approx mathbfmt math label timediscret mathbfmtdelta fracmathbfa_ttdelta mathbfa_ttdelta theta mathbfftdelta mathbfk_ttdelta mathbfa_ttdelta thetamathbfftmathbfk_ttmathbfa_tt mathmathbfk_tmathbfk_amathbfk_c rearrang eqtimediscret allow rewrit numer form solv energi equat math label numericalformenergyequ mathbfmtdelta delta theta mathbfk_ttdelta tmathbfa_tttdelta mathbfmtdelta delta tthetamathbfk_ttmathbfa_tt delta ttheta mathbfftdelta thetamathbfft free surfac mandyoc use free surfac stabil algorithm citekau modifi stoke equat avoid numer instabl occur surfac model upanddown oscil around steadi state slosh instabl drunken sailer effect would requir small time step would increas run time unfeas amount modif done stiff matrix mathk_ mathtildek_ek_el_ correct mathl_ evalu boundari mathgamma_ finit element correct given eql math label le l_e int_gamma_emathbfn theta deltarho delta mathbfg mathbfn dgamma mathmathbfn element shape function math leq theta leq wight factor correct term mathdelta rho densiti contrast two medium mathdelta numer integr time step mathmathbfg graviti acceler vector mathmathbfn normal vector element _rheologysect rheolog consid viscoplast model effect viscos matheta follow formul describ moresi solomatov citemoresi combin plastic deform viscou deform math label effectiveeta eta mineta_plaseta_visc minbiggfractau_yielddotvarepsilon_iieta_viscbigg mathtau_yield ruptur tension mathdotvarepsilon_iidotvarepsilon_ijdotvarepsilon_ij second invari deviator strain rate tensor matheta_pla matheta_visc plastic ductil viscos plastic deform plastic deform calcul use byerle law citebyerle comput mathtau_yield matheta_pla eqbyerleelaw show relationship implement mandyoc math label byerleelaw tau_yield c_mu rho g z mathc_ intern cohes mathmu friction coeffici mathrho densiti mathz depth altern user choos use drukerprag criterion citedruckerprag present eqdruckerprag math label druckerprag tau_yield c_ cosvarphi p sinvarphi mathvarphi intern angl friction viscou deform mandyoc contain sever rheolog model user choos viscou deform among two discuss ductil rheolog simul use frankkamenetskii approxim follow formul describ solomatov moresi citesolomatov viscos function temperatur matht equat formul also use sacek citesacek earlier mandyoc version math label frankkamenetskii eta_visct c eta_r b expgamma matheta_r refer viscos mathci composit factor scale effect viscos mathb mathgamma e_a rt_b constant turn mathe_a activ energi mathr ga constant matht_b basal temperatur addit rheolog also consid follow power law function temperatur matht composit factor mathc pressur mathp strain rate mathvarepsilon follow math label powerlaw eta_visc c afracn dotvarepsilonfracnn expfracqv pnrt matha preexponenti scale factor mathn power law expon mathdotvarepsilon squar root second invari strain rate tensor mathq activ energi mathv activ volum valu matha mathn mathq mathv measur laboratori condit citekaratogleason nonlinear iter nonlinear option chosen user effect viscos depend veloc field iter updat follow algorithm describ thieulot citethieulot algorithm veloc effect viscos field iter updat follow converg criterion satisfi math label nonlinear chi_f fraclangl filangl firangl cdot filangl firangl ranglefilangl firangl filangl firangl le tol mathf repres array nodal valu veloc compon mathtol toler factor mathlangl frangl mean valu mathf superscript mathi mathi indic two consecut iter time step iter momentum mass equat calcul updat effect viscos field _benchmark benchmark order test accuraci mandyoc code result compar benchmark studi follow subsect present procedur result well establish model problem case provid inform applic perform code well limit script build run numer experi locat exampl httpsgithubcomggciagmandyoctreemainexamples_ folder mandyoc repositori insid exampl folder find jupyt notebook detail explan instruct run experi van keken et al citevankeken note mandyoc version use benchmark v set simul propos van keken et al citevankeken compar sever method studi two dimension thermochem convect boussinesq approxim infinit prandtl number use benchmark first case present three distinct variat propos articl simul consist two layer buoyant thin layer denser thicker packag problem interpret salt layer sediment packag interfac layer defin eqinterfacerayleigh math label interfacerayleigh lambda_i cosfracpi x lambda_x mathlambda_x mathlambda_i horizont vertic length simul box respect simul carri cartesian box fluid isotherm rayleightaylor instabl expect propos setup tabl list paramet use run scenario togeth distinct three propos simul case b c listtabl paramet use rayleightaylor instabl simul headerrow width align center paramet center symbol valu horizont length center mathlambda_x vertic length center mathlambda_i thermal diffus coeffici center mathkappa mathtim graviti acceler center mathg math refer viscos center matheta_r mathtim buoyant layer viscos center matheta_ mathtimeseta_r case mathtimeseta_r case b mathtimeseta_r case c result case case matheta_eta_r numrefvankekencaseaevolut compar evolut isovisc rayleightaylor instabl van keken et al citevankeken mandyoc time step shown mandyoc code closest simul could provid consid chosen simul paramet _vankekencaseaevolut figur figsvankekensnapsapng align center width alt result evolut isovisc rayleightaylor instabl matheta_eta_r best result present van keken et al citevankeken left mandyoc result right note differ method use van keken et al citevankeken mandyoc mandyoc result evolut isovisc rayleightaylor instabl present data color instead contour numrefvankekencaseagraph compar chang mathv_rm time show result van keken et al citevankeken gray mandyoc black _vankekencaseagraph figur figsvrmsapng align center width alt result evolut mathv_rm matheta_eta_r van keken et al citevankeken result shown black mandyoc code result shown gray result case b case b matheta_eta_r numrefvankekencasebevolut compar evolut isovisc rayleightaylor instabl van keken et al citevankeken mandyoc time step shown mandyoc code closest simul could provid consid chosen simul paramet _vankekencasebevolut figur figsvankekensnapsbpng align center width alt result evolut isovisc rayleightaylor instabl matheta_eta_r best result present van keken et al citevankeken left mandyoc result right numrefvankekencasebgraph compar chang mathv_rm time show result van keken et al citevankeken gray mandyoc black _vankekencasebgraph figur figsvrmsbpng align center width alt result evolut mathv_rm matheta_eta_r van keken et al citevankeken result shown black mandyoc code result shown gray result case c case c matheta_eta_r numrefvankekencasecevolut compar evolut isovisc rayleightaylor instabl van keken et al citevankeken mandyoc time step shown mandyoc code closest simul could provid consid chosen simul paramet _vankekencasecevolut figur figsvankekensnapscpng align center width alt result evolut isovisc rayleightaylor instabl matheta_eta_r best result present van keken et al citevankeken left mandyoc result right numrefvankekencasecgraph compar chang mathv_rm time show result van keken et al citevankeken gray mandyoc black _vankekencasecgraph figur figsvrmscpng align center width alt result evolut mathv_rm matheta_eta_r van keken et al citevankeken result shown black mandyoc code result shown gray basic scale numrefvankekencaseascalinggraph show result basic scale test mandyoc v run intelr coretm cpu ghz _vankekencaseascalinggraph figur figsscaling_vankeken_caseapng align center width alt scale result vankeken_casea result scale test vankeken_casea crameri et al citecrameri note mandyoc version use benchmark v case experi present crameri et al citecrameri evalu sticki air method obtain numer surfac topographi geodynam model experi analys chang topographi due rise mantl plume model setup numrefcrameri_setup consist math mathrmkm math mathrmkm box math mathrmkm sticki air layer top model mantl thick math mathrmkm math mathrmkm thick lithospher lithospher densiti math mathrmkgm viscos math mathrmpa mantl densiti math mathrmkgm viscos math mathrmpa mantl plume densiti math mathrmkgm viscos math mathrmpa initi center plume horizont center math mathrmkm base model top sticki air layer densiti math mathrmkgm viscos math mathrmpa free slip boundari condit appli upper boundari sticki air layer vertic side model base kept fix temperatur differ geodynam evolut guid sole composit densiti differ _crameri_setup figur figscramerietalcasesetuppng width align center alt crameri case model setup case model setup evalu sticki air method extract crameri et al citecrameri result experi reproduc mandyoc obtain maximum topographi time similar fig crameri et al citecrameri present numrefmaximum_topographi model use comparison underworld citemoresi stagyy citetackley ivi citegerya data use comparison extract crameri et al use underworld v version inform stagyy ivi code report _maximum_topographi figur figscramerietalcasecomparisonpng width align center alt comparison mandyoc result comparison maximum topographi time case numrefcrameri_setup model setup crameri et al citecrameri basic scale numrefcrameriscalinggraph show result basic scale test mandyoc v run intelr coretm cpu ghz _crameriscalinggraph figur figsscaling_crameri_casepng align center width alt scale result crameri_cas result scale test crameri_cas