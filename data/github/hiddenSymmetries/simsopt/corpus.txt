simsopt githubhttpsimgshieldsiogithublicensehiddensymmetriessimsopt codecovhttpscodecovioghhiddensymmetriessimsoptbranchmastergraphbadgesvgtokenltnqonzphttpscodecovioghhiddensymmetriessimsopt doihttpszenodoorgbadgesvghttpszenodoorgbadgelatestdoi simsoptdocssourcelogopng simsoptdocssourcecoils_and_surfacespng simsopt framework optim stellaratorshttpsenwikipediaorgwikistellar highlevel routin simsopt python call c fortran need perform sever type compon includ interfac physic code eg mhd equilibrium tool defin object function paramet space optim geometr object import stellar surfac curv sever avail parameter effici implement biotsavart law magnet field represent includ deriv tool parallel finitediffer gradient calcul design simsopt guid sever principl thorough unit test regress test continu integr extens possibl add new code term object function without edit modul alreadi work ie openclos principlehttpsenwikipediaorgwikiopeneclosed_principl edit work code potenti introduc bug modular physic modul need optim problem need instal instanc optim spec equilibria vmec modul need instal flexibl compon use defin object function reus applic standard optim instanc simsopt object function standard python function plot pass optim packag outsid simsopt etc simsopt fulli opensourc anyon welcom use make suggest contribut sever method avail instal simsopt one recommend approach use pip pip instal simsopt detail instal instruct specif system see wikihttpsgithubcomhiddensymmetriessimsoptwiki also docker contain avail simsopt compon preinstal start use docker run rm hiddensymmetriessimsopt instal optionshttpssimsoptreadthedocsioenlatestgetting_startedhtml instruct docker containerhttpssimsoptreadthedocsioenlatestcontainershtml inform found main simsopt document herehttpssimsoptreadthedocsio physic modul compil code resid separ repositori separ modul includ vmechttpsgithubcomhiddensymmetriesvmec mhd equilibrium spechttpsgithubcomprincetonuniversityspec mhd equilibrium booz_xformhttpshiddensymmetriesgithubiobooz_xform boozer coordin use simsopt research kindli cite code use referencehttpsdoiorgjoss landreman b medasani f wechsung giuliani r jorg c zhu simsopt flexibl framework stellar optim j open sourc softwar see also simsopt public pagehttpssimsoptreadthedocsioenlatestpublicationshtml grate acknowledg fund simon foundat hidden symmetri fusion energi projecthttpshiddensymmetriesprincetonedu simsopt test framework overview directori contain integratedregress test sourc code unit test compon store subdirectori compon layout subfold within test nearli mimic simsopt code srcsimsopt folder test file input output data file collect teststest_fil run test run test must first instal simsopt pip instal main simsopt directori chang test directori run python unittest run test see python unittest documentationhttpsdocspythonorglibraryunittesthtml option background file directori dof_garabediansp spec input file describ circularcrosssect toru torsion magnet axi volum vacuum field dof_targetiotaandvolumesp spec input file describ classic stellar rotat ellipt crosssect volum vacuum field qhresiduessp spec input file describ wistella configur bader et al journal plasma physic use volum vacuum field model inputcircular_tokamak boozmn_circular_tokamaknc vmec input file booz_xform output file axisymmetr tokamak circular crosssect use iterlik paramet iter poloid shape exampl use test simsopt function case axisymmetri inputli_low_r wout_li_low_res_referencenc boozmn_li_low_resnc vmec input output file booz_xform output file refer li configur ncsx contrast offici version ncsx vmec resolut paramet mpol ntor ns lower test run quickli inputsimsopt_nfp_qa___ inputnfp_qh__ vmec input file come previou simsopt optim quasiaxisymmetri quasihel symmetri respect file use test measur quasisymmetri inputlandremansengupta_section_b_a vmec input file quasihelicallysymmetr configur section landreman sengupta journal plasma physic except aspect ratio rais mean field increas tesla configur use compar analyt result nearaxi expans inputlandremansenguptaplunk_sectionp wout_landremansenguptaplunk_sectionp_referencenc vmec input output file refer configur section landreman sengupta plunk journal plasma physic configur stellaratorsymmetr file use test simsopt function work nonstellaratorsymmetr geometri inputnuhrenbergzille__qh vmec input file first quasisymmetr configur found nuhrenberg zill inputwx_standard_configur vmec input file wx standard configur plasma pressur current inputcfqs_b vmec input file configur cfq experi inputrotating_ellips vmec input file classic stellar rotat ellipt crosssect tf_only_half_teslaplasma focu input file give ncsx plasma boundari well compon b normal boundari due tesla pure toroid field exampl exampl divid four folder _simpl _intermedi _advanc stellarator_benchmark major exampl run use run_exampl script also call continu integr test file gener run exampl easili delet use cleanup script vmecspec input file need script insid subfold call input _simpl exampl simsopt take object function onesever simpl geometr measur length volum need extern librari depend just_a_quadrat minim fxyz x z logger_exampl exampl file transpar log mpi serial job minimize_curve_length minim length curv hold frequenc fourier mode fix result circl surface_volume_and_area optim minor radiu elong axisymmetr toru obtain desir volum area graph_surf_vol_area optim minor radiu elong axisymmetr toru obtain desir volum area use graph optimiz object _intermedi exampl simsopt specif optim object function associ stellar magnet field quasisymmetri rotat transform script need extern depend vmec spec qsc boozer comput surfac boozer coordin magnet field induc coil eliminate_magnetic_island show shape boundari magnet surfac adjust elimin magnet island insid consid vacuum field spec code use singl radial domain qa perform sever run vmec python wrapper chang particular surfac fourier coeffici qh_fixed_resolut optim quasihel symmetri n given radiu qsc optim axi shape firstord shape flux surfac first order near magnet axi target iota low elong use stellar quasisymmetri construct code httpsgithubcomlandremanpyqsc resolution_increas show increas size paramet space refin resolut calcul optim object function target quasiaxisymmetri iota profil _advanc exampl simsopt take sever extern librari togeth vmecspec optim object function associ stellar magnet field quasisymmetri magnet island optimize_qs_and_islands_simultan simultan optim quasisymmetri elimin magnet island vmec spec call object function stellarator_benchmark folder contain scenario present httpsgithubcomlandremanstellopt_scenario sever benchmark problem stellar optim may use compar optim algorithm test new code exampl often need either vmec spec build document guid build document local onlin document get updat whenev master branch updat prerequsit instal sphinx sphinxrtdthem sphinxcontribnapoleon sphinxautodocnapoleontypehint pip build use sphinxbuild bash cd doc sphinxbuild b html sourc build document gener html format docsbuild folder start indexhtml file use suppli makefil bash cd doc make html document gener html format docsbuildhtml folder start indexhtml file updat document whenev code updat repopul code tree run either step step bash cd doc sphinxapidoc f sourc srcsimsopt simsopt docker contain document explain build docker contain simsopt also provid instruct run simsopt docker contain build contain instal docker build docker imag run docker build command bash docker build user_nameimage_nametag f dockerfileubuntu command user_nam typic use upload imag docker hub local build omit user_nam use choic image_nam tag option given default latest upload imag docker hub want distribut bash docker push image_nametag run contain two case docker imag built local docker imag download repo local build identifi local imag use command bash docker imag ls identifi imag built local use either image_nametag imag id hexadecim number run docker imag next command remot repo assum imag upload docker hub use user_nameimage_nametag automat download imag next command interact run run docker contain command bash docker run rm imag execut python script bash docker run vpwdpwd imag python pwdpython_script command work addit file need run script simsopt_cor packag submodul simsopt_corederiv modul automodul simsopt_corederiv member undocmemb showinherit privatememb simsopt_coredof modul automodul simsopt_coredof member undocmemb showinherit privatememb simsopt_coregraph_optimiz modul automodul simsopt_coregraph_optimiz member undocmemb showinherit privatememb simsopt_coreoptimiz modul automodul simsopt_coreoptimiz member undocmemb showinherit privatememb simsopt_coreutil modul automodul simsopt_coreutil member undocmemb showinherit privatememb modul content automodul simsopt_cor member undocmemb showinherit privatememb contribut simsopt glad decid contribut simsopt develop pleas follow contribut guidlin post type contribut big small contribut simsopt welcom way contribut simsopt submit feedback report bug fix bug improv document request new featur contribut new algorithm implement new featur submit feedback give feedback simsopt open issu httpsgithubcomhiddensymmetriessimsoptissues_ proposingrequest new featur new algorithm explain detail featur need demo problem couldnt implement exist code featur ambiti take time may implement keep scope featur narrow possibl make easier implement contribut alway welcom bug report report bug packag open issu httpsgithubcomhiddensymmetriessimsoptissues_ pleas includ bug report oper system type mac linux version pertin detail local setup mpi compil info might help troubleshoot step reproduc bug fix bug look github issu bug anyth tag bug help want open whoever want implement implement new featur algorithm first becom familiar simsopt code least subpackag contribut quickest way reach develop ask help simsopt enforc code qualiti throught unittest unit test readi go code exampl showcas problem two solv new featur would even better improv document feel document lag place pleas feel free submit pr focus fix improv document step build document local found httpsgithubcomhiddensymmetriessimsopttreecontributingdocs_ code develop workflow log github fork simsopt repositori creat duplic githubcomyour_accountsimsopt person fork fork oppos repositori githubcomhiddensymmetriessimsopt convent refer upstream repositori git parlanc clone fork machin open consol execut codeblock git clone httpsgithubcomyour_accountsimsoptgit make sure clone fork upstream repo creat directori call simsopt navig execut codeblock git remot add upstream httpsgithubcomhiddensymmetriessimsoptgit way machin know fork git call origin upstream repositori upstream develop make chang code fork code prevent frequent reinstal simsopt modif reflect chang immedi instal simsopt edit codeblock pip instal e use new branch start implement chang would good idea codeblock git checkout b your_branch_nam use git add commit command save chang codeblock git add your_new_file_or_modified_fil git commit brief messag highlight chang implement make sure run_test run_tests_mpi examplesrun_exampl pass run local help catch bug develop submit chang run autopep fix format issu use suppli run_autopep script dont forget run step push chang github code block git push chang fork submit pullrequest pr merg run_test run_tests_mpi examplesrun_exampl pass request least review simsopt develop bharat medasani matt landreman florian wechshung last review approv charg merg contribut review merg upstream repositori simsopt develop satisfi code qualiti pleas note full tutori use git need know addit git command effici get stuck git conflict simsoptgeo packag submodul simsoptgeoboozersurfac modul automodul simsoptgeoboozersurfac member undocmemb showinherit simsoptgeoconfig modul automodul simsoptgeoconfig member undocmemb showinherit simsoptgeocurv modul automodul simsoptgeocurv member undocmemb showinherit simsoptgeocurvehel modul automodul simsoptgeocurvehel member undocmemb showinherit simsoptgeocurveperturb modul automodul simsoptgeocurveperturb member undocmemb showinherit simsoptgeocurveobject modul automodul simsoptgeocurveobject member undocmemb showinherit simsoptgeocurverzfouri modul automodul simsoptgeocurverzfouri member undocmemb showinherit simsoptgeocurvexyzfouri modul automodul simsoptgeocurvexyzfouri member undocmemb showinherit simsoptgeojit modul automodul simsoptgeojit member undocmemb showinherit simsoptgeoplot modul automodul simsoptgeoplot member undocmemb showinherit simsoptgeoqfmsurfac modul automodul simsoptgeoqfmsurfac member undocmemb showinherit simsoptgeosurfac modul automodul simsoptgeosurfac member undocmemb showinherit simsoptgeosurfacegarabedian modul automodul simsoptgeosurfacegarabedian member undocmemb showinherit simsoptgeosurfacehenneberg modul automodul simsoptgeosurfacehenneberg member undocmemb showinherit simsoptgeosurfaceobject modul automodul simsoptgeosurfaceobject member undocmemb showinherit simsoptgeosurfacerzfouri modul automodul simsoptgeosurfacerzfouri member undocmemb showinherit simsoptgeosurfacexyzfouri modul automodul simsoptgeosurfacexyzfouri member undocmemb showinherit simsoptgeosurfacexyztensorfouri modul automodul simsoptgeosurfacexyztensorfouri member undocmemb showinherit modul content automodul simsoptgeo member undocmemb showinherit field line particl trace objsimsoptfieldtrac modul provid tool trace field line follow particl motion magnet field latter full orbit includ gyromot guid center trajectori follow cylindr coordin guid center motion follow boozer coordin exampl variou trace featur found examples_simpletracing_fieldlinepi examples_simpletracing_particlepi examples_intermediatetracing_boozerpi particl motion cylindr coordin main function use case objsimsoptfieldtracingtrace_particl click link inform input output paramet abl use two differ set equat depend input paramet mode case modeful solv math ddot x ddot ddot z fracqm dot x dot dot z time mathbf b case modegc_vac solv guid center equat assumpt mathnabla p math dot x dot dot z v_fracmathbf bb fracmqb leftfracv_perp v_right mathbf btime nabla b dot v_ mu mathbf b cdot nabla b mathv_perp mu b see equat guid center motion hj de blank httpsdoiorgfsta_ exampl vertic drift experienc two particl simpl toroid magnet field codeblock simsoptfieldmagneticfieldclass import toroidalfield simsoptgeocurvexyzfouri import curvexyzfouri simsoptutilconst import proton_mass elementary_charg one_ev simsoptfieldtrac import trace_particles_starting_on_curv bfield toroidalfieldb r start_curv curvexyzfouri start_curveset_dof nparticl proton_mass q elementary_charg tmax e ekin one_ev gc_ti gc_phi_hit trace_particles_starting_on_curv start_curv bfield nparticl tmaxtmax seed massm chargeq ekinekin umin umax phi modegc_vac tole z_particle_ gc_ti z_particle_ gc_ti printz_particle_ printz_particle_ note simsopt draw initi data particl consist guid center posit parallel veloc perpendicular speed comput speed user specifi total kinet energi interv pitchangl mathu_min u_max given pitch angl mathu total speed mathv comput kinet energi particl mass parallel speed given mathv_ u v mathv_perp sqrtvv_ case full orbit simul need veloc initi data henc defin initi data phase specifi phase one pass phase_angl variabl trace function valu math pi expect optim quasisymmetri tutori shown optim boundari shape vmec configur achiev quasisymmetri sever variant problem shown includ quasihel symmetri quasiaxisymmetri two object function avail simsopt achiev quasisymmetri demonstr one object function objsimsoptmhdvmec_diagnosticsquasisymmetryratioresidu base fact mathvecbtimesnabla b cdotnablapsivecbcdotnabla b flux function quasisymmetri demonstr paper arxiv httpsarxivorgpdf__ object function use objsimsoptmhdboozerquasisymmetri tradit one base fourier mode boozer coordin mathb_mn break symmetri recommend approach use objsimsoptmhdvmec_diagnosticsquasisymmetryratioresidu sinc modest advantag requir transform boozer coordin although method effect first two exampl page requir booz_xform packag wherea third exampl optim exampl probabl want write script submit queue comput cluster like take minut ten minut one node fix resolut exampl run ippcobra ptmpmlansimsopt_docs_tutorials_qh_fixed_resolut final configur also avail box syncworkwout__simsopt_docs_tutorials_nfp_qh_warm_start__nc exampl also avail qh_fixed_resolutionpi examples_intermedi directori usual driver script begin import class function need import numpi np simsoptutilmpi import mpipartit simsoptmhdvmec import vmec simsoptmhdvmec_diagnost import quasisymmetryratioresidu simsoptobjectivesgraph_least_squar import leastsquaresproblem simsoptsolvegraph_mpi import least_squares_mpi_solv problem want mpi parallel finit differ gradient explain particular problem independ variabl take advantag concurr function evalu onesid differ therefor optim divid mpi process worker group inform mpi worker group see docmpi objsimsoptutilmpimpipartit script therefor use mpi mpipartit necessari use group code function properli choic select group group beyond th sit idl select fewer group function evalu need finit differ gradient distribut among group avail need make number group multipl number avail mpi process although group process next initi vmec object input file vmec vmecinputnfp_qh_warm_start mpimpi file found examples_intermediateinput directori file describ configur alreadi partial optim quasihel symmetri small paramet space keep poloid toroid mode number latter divid number field period imag example_quasisymmetry_qh_beforepng width present exampl refin configur optim larger paramet space poloid toroid mode number defin paramet space set fix properti boundari fourier mode follow defin paramet space surf vmecboundari surffix_al max_mod surffixed_rangemmin mmaxmax_mod nminmax_mod nmaxmax_mod fixedfals surffixrc major radiu code first fix mode boundari sinc want mode number greater fix desir rang mode set fix rang includ mn mode essenti mean major radiu dont need want vari overal scale configur conveni remov mode paramet space confirm mode vari print name free degre freedom dof printparamet space surfdof_nam result codeblock paramet space surfacerzfourierrc surfacerzfourierrc surfacerzfourierrc surfacerzfourierrc surfacerzfourierrc surfacerzfourierrc surfacerzfourierrc surfacerzfourierrc surfacerzfourierrc surfacerzfourierrc surfacerzfourierrc surfacerzfourierrc surfacerzfourierz surfacerzfourierz surfacerzfourierz surfacerzfourierz surfacerzfourierz surfacerzfourierz surfacerzfourierz surfacerzfourierz surfacerzfourierz surfacerzfourierz surfacerzfourierz surfacerzfourierz next need configur term object function repres departur quasisymmetri done follow configur quasisymmetri object qs quasisymmetryratioresidualvmec nparang radii target helicity_m helicity_n n want b sever adjust option detail found api document objsimsoptmhdvmec_diagnosticsquasisymmetryratioresidu also find mathemat express object function second argument objsimsoptmhdvmec_diagnosticsquasisymmetryratioresidu set quasisymmetri object evalu uniform grid surfac normal toroid flux math result quasisymmetri target throughout volum free provid differ valu singl float want target quasisymmetri singl surfac also option argument weight wish differ weight object function quasisymmetri differ surfac helicity_n argument also set rather quasihel symmetri amount mirrorrevers though initi configur use consist handed readi defin total object function includ quasisymmetri aspect ratio aspect ratio must includ otherwis quasisymmetri made arbitrarili good increas aspect ratio infin simsopt object function defin follow defin object function prob leastsquaresproblemfrom_tuplesvmecaspect qsresidu seen target aspect ratio object function sum leastsquar term correspond quasisymmetri residu x grid point flux surfac target plu one addit term vmecaspect x resolut default objsimsoptmhdvmec_diagnosticsquasisymmetryratioresidu larg number residu term problem introduc neglig comput cost compar cost equilibrium calcul may well use high resolut check valu object function optim rather print residu term scalar total quasisymmetri term obtain total method codeblock printquasisymmetri object optim qstotal printtot object optim probobject result sinc aspect ratio term neglig final solv optim problem least_squares_mpi_solveprob mpi gradtru suppos written command file name simsopt_driv depend comput system script run use command like srun python simsopt_driv slurm system mpirun n simsopt_driv sinc object function multipl local minima final result optim sensit small chang simsopt vmec packag depend therefor necessarili obtain exactli result shown one result produc optim script follow configur imag example_quasisymmetry_qh_afterpng width imag example_quasisymmetry_qh_after_dpng width figur produc box syncmatlabm_plotvmecwoutm imag example_quasisymmetry_qh_after_boozerpng width figur produc box syncworkboozplothalffluxunfil wout__simsopt_docs_tutorials_nfp_qh_warm_start__nc last figur show reason good quasisymmetri achiev qualiti quasisymmetri improv significantli refin configur use one round optim fourier mode paramet space print qstotal probobject end optim seen reduc significantli result shown dynam resolut exampl run ippcobra ptmpmlansimsopt_docs_tutorials_qa_dynamic_resolut final configur also avail box syncworkwout__simsopt_docs_tutorials_qa_dynamic_resolution__nc sinc simsopt optim problem defin use python script free add script problem definit show capabl use increas numer resolut code vmec optim time increas number fourier mode paramet space optim exampl also found examples_intermedi directori resolution_increasepi exampl similar quasiaxisymmetri optim shown arxiv httpsarxivorgpdf__ usual begin necessari import import numpi np simsoptutilmpi import mpipartit simsoptmhdvmec import vmec simsoptmhdvmec_diagnost import quasisymmetryratioresidu simsoptobjectivesgraph_least_squar import leastsquaresproblem simsoptsolvegraph_mpi import least_squares_mpi_solv split pool mpi process worker group simplic make process worker group omit argument mpi mpipartit initi vmec configur input file start configur axisymmetr circular crosssect start scratch vmec vmecinputnfp_qa mpimpi input file found examples_intermediateinput directori defin quasisymmetri object previou section except specifi helic instead get quasiaxisymmetri instead quasihel symmetri configur quasisymmetri object qs quasisymmetryratioresidualvmec nparang radii target helicity_m helicity_n n want b defin total object function exampl necessari includ nonzero target valu rotat transform object prevent optimum truli axisymmetr defin object function prob leastsquaresproblemfrom_tuplesvmecaspect vmecmean_iota qs seen seek configur aspect ratio averag iota slightli reson function funcsimsoptmhdvmecvmecmean_iota use return mathint_ iota ds math toroid flux normal valu vmec boundari set loop sever optim step step resolut paramet mpol ntor vmec increas time optim step larger rang poloid toroid mode number set vari optim step rang max_mod step vmec mpol ntor vmecindatampol step vmecindatantor vmecindatampol mpiproc_world printbegin optim max_mod max_mod vmec mpolntor vmecindatampol previou vmec iter vmecit defin paramet space surffix_al surffixed_rangemmin mmaxmax_mod nminmax_mod nmaxmax_mod fixedfals surffixrc major radiu carri optim step least_squares_mpi_solveprob mpi gradtru mpiproc_world printdon optim max_mod max_mod final vmec iter vmecit like paramet could adjust step radial resolut number iter vmec solver toler maximum number iter optim algorithm previou section final result optim sensit small chang simsopt vmec packag depend therefor necessarili obtain exactli result shown one result produc optim script follow configur imag example_quasisymmetry_qa_afterpng width imag example_quasisymmetry_qa_after_dpng width figur produc box syncmatlabm_plotvmecwoutm imag example_quasisymmetry_qa_after_boozerpng width figur produc box syncworkboozplothalffluxunfil wout__simsopt_docs_tutorials_qa_dynamic_resolution__nc bmn object show altern method quasisymmetri optim use differ object function objsimsoptmhdboozerquasisymmetri base symmetrybreak fourier mode aplitud mathb_mn boozer coordin exampl also found examples_intermedi directori resolution_increase_boozerpi case import need simsoptutilmpi import mpipartit simsoptmhdvmec import vmec simsoptmhdbooz import boozer quasisymmetri simsoptobjectivesgraph_least_squar import leastsquaresproblem simsoptsolvegraph_mpi import least_squares_mpi_solv split pool mpi process worker group initi vmec object previou exampl mpi mpipartit vmec vmecinputnfp_qa mpimpi input file correspond axisymmetr toru circular crosssect found examples_intermediateinput directori next altern quasisymmetri object creat follow configur quasisymmetri object boozer boozervmec qs quasisymmetrybooz radiu target n want b sever adjust option detail found api document objsimsoptmhdboozerbooz objsimsoptmhdboozerquasisymmetri numer resolut boozercoordin transform adjust pass paramet objsimsoptmhdboozerbooz constructor boozervmec mpol ntor second argument quasisymmetri set quasisymmetri object evalu normal toroid flux free provid differ valu list valu provid target quasisymmetri multipl surfac objsimsoptmhdboozerquasisymmetri also option argument adjust normal weight differ fourier mode defin total object function previou quasiaxisymmetri exampl necessari includ nonzero target valu rotat transform object prevent optimum truli axisymmetr constrain iota edg magnet axi order prescrib magnet shear defin object function prob leastsquaresproblemfrom_tuplesvmecaspect vmeciota_axi vmeciota_edg qs seen seek configur aspect ratio iota slightli set loop sever optim step step resolut paramet mpol ntor vmec increas fourier resolut paramet booz_xform time optim step larger rang poloid toroid mode number set vari optim step rang max_mod step vmec mpol ntor vmecindatampol step vmecindatantor vmecindatampol booz_xform mpol ntor boozermpol step boozerntor boozermpol mpiproc_world printbegin optim max_mod max_mod vmec mpolntor vmecindatampol boozer mpolntor boozermpol previou vmec iter vmecit defin paramet space surffix_al surffixed_rangemmin mmaxmax_mod nminmax_mod nmaxmax_mod fixedfals surffixrc major radiu carri optim step least_squares_mpi_solveprob mpi gradtru mpiproc_world printdon optim max_mod max_mod final vmec iter vmecit like paramet could adjust step radial resolut number iter vmec solver toler maximum number iter optim algorithm previou exampl final result optim sensit small chang simsopt vmec packag depend therefor necessarili obtain exactli result shown one result produc optim script follow configur imag example_quasisymmetry_qa_bmn_afterpng width imag example_quasisymmetry_qa_bmn_after_dpng width figur produc box syncmatlabm_plotvmecwoutm imag example_quasisymmetry_qa_bmn_after_boozerpng width figur produc box syncworkboozplothalffluxunfil simsopt_nfp_qa___wout_simsopt_nfp_qa____scalednc simsoptobject packag submodul simsoptobjectivesfluxobject modul automodul simsoptobjectivesfluxobject member undocmemb showinherit simsoptobjectivesfunct modul automodul simsoptobjectivesfunct member undocmemb showinherit simsoptobjectivesgraph_funct modul automodul simsoptobjectivesgraph_funct member undocmemb showinherit simsoptobjectivesgraph_least_squar modul automodul simsoptobjectivesgraph_least_squar member undocmemb showinherit simsoptobjectivesleast_squar modul automodul simsoptobjectivesleast_squar member undocmemb showinherit modul content automodul simsoptobject member undocmemb showinherit simsopt packag subpackag toctre maxdepth simsopt_cor simsoptfield simsoptgeo simsoptmhd simsoptobject simsoptsolv simsoptutil simsoptpp modul content automodul simsopt member undocmemb showinherit simsoptutil packag submodul simsoptutilconst modul automodul simsoptutilconst member undocmemb showinherit simsoptutildev modul automodul simsoptutildev member undocmemb showinherit simsoptutillog modul automodul simsoptutillog member undocmemb showinherit simsoptutilmpi modul automodul simsoptutilmpi member undocmemb showinherit simsoptutilmpi_logg modul automodul simsoptutilmpi_logg member undocmemb showinherit simsoptutiltyp modul automodul simsoptutiltyp member undocmemb showinherit simsoptutilzoo modul automodul simsoptutilzoo member undocmemb showinherit modul content automodul simsoptutil member undocmemb showinherit sourc code github httpsgithubcomhiddensymmetriesbooz_xform_ sourc code simsopt found httpsgithubcomhiddensymmetriessimsopt mpi partit worker group use mpi parallel simsopt must instal mpipi httpsmpipyreadthedocsioenstable_ packag mpi simsopt program gener launch use mpirun mpiexec eg codeblock mpiexec n name_of_your_python_driver_script replac number processor want use may specif instruct run mpi program hpc system consult document system given set mathm mpi process optim problem parallel differ way one extrem mathm process could work togeth evalu object function optim algorithm initi singl evalu object function mathf time extrem optim algorithm could request mathm evalu mathf evalu perform singl processor type parallel use instanc finit differ use evalu gradient type parallel could use time allow type parallel simsopt use concept worker group mpi partit worker group set mpi process work togeth evalu object function mpi partit divis total set mathm mpi processor one worker group mathw worker group group approxim mathmw processor approxim one may need round simsopt class objsimsoptutilmpimpipartit manag divis processor worker group mpiawar simsopt object objsimsoptmhdvmecvmec keep instanc objsimsoptutilmpimpipartit set constructor number worker group set argument objsimsoptutilmpimpipartit instanc tell vmec object use four worker group one could write codeblock simsoptmhdvmec import vmec simsoptutilmpi import mpipartit mpi mpipartit equil vmecinputli_low_r mpimpi objsimsoptutilmpimpipartit instanc pass solver code defin optim problem prob simsoptsolvegraph_mpi import least_squares_mpi_solv least_squares_mpi_solveprob mpi gradtru mani optim algorithm use deriv support concurr evalu object case number worker group mathw equal algorithm use deriv levenbergmarquardt take advantag multipl worker group evalu deriv finit differ number paramet ie independ variabl mathn ideal want set mathwn use side finit differ set mathwn use center differ ideal valu requir howev simsopt evalu finit differ deriv valu mathw result exactli independ mathw derivativefre algorithm intrins support parallel hopspack though algorithm avail simsopt yet mpi partit associ three mpi commun world group leader world commun repres mathm mpi processor avail program normal commun mpi_comm_world could subset thereof wish group commun also contain mathm processor group color differ color repres worker group therefor oper mpi_send mpi_bcast commun exchang data within one worker group group commun therefor one must use evalu object function final leader commun includ mathw processor rank group commun commun use commun data within parallel optim algorithm oppos within parallel object function given instanc objsimsoptutilmpimpipartit name mpi number worker group avail mpingroup index given processor group mpigroup commun avail mpicomm_world mpicomm_group mpicomm_lead number processor within commun determin mpinprocs_world mpinprocs_group mpinprocs_lead rank present processor within commun avail mpirank_world mpirank_group mpirank_lead determin present processor rank commun use variabl mpiproc_world mpiproc_group type bool public use simsopt research kindli cite simsopt use refer recommend also give refer simsopt releas version use work releas zenodo archiv uniqu doi doi latest releas imag httpszenodoorgbadgesvg target httpszenodoorgbadgelatestdoi click badg take zenodo right page find list doi previou releas list public simsopt result appear symbol use put blank line item landreman b medasani f wechsung giuliani r jorg c zhu simsopt flexibl framework stellar optim j open sourc softwar journal version httpsdoiorgjoss__ f wechsung giuliani landreman cerfon g stadler singlestag gradientbas stellar coil design stochast optim submit arxiv version httpsarxivorgpdf__ landreman b medasani c zhu stellar optim good magnet surfac time quasisymmetri phi plasma journal version httpsdoiorg__ arxiv version httpsarxivorgpdf__ bader anderson drevlak b j faber c c hegna henneberg landreman j c schmitt suzuki ware energet particl transport optim stellar nuclear fusion journal version httpsdoiorgac__ arxiv version httpsarxivorgpdf__ landreman e paul magnet field precis quasisymmetri plasma confin physic review letter journal version httpsdoiorgphysrevlett__ arxiv version httpsarxivorgpdf__ baillod j loizu j p grave landreman stellar optim good magnet surfac finit β toroid current submit arxiv version httpsarxivorgpdf__ simsoptsolv packag submodul simsoptsolvegraph_mpi modul automodul simsoptsolvegraph_mpi member undocmemb showinherit simsoptsolvegraph_seri modul automodul simsoptsolvegraph_seri member undocmemb showinherit simsoptsolvempi modul automodul simsoptsolvempi member undocmemb showinherit simsoptsolveseri modul automodul simsoptsolveseri member undocmemb showinherit modul content automodul simsoptsolv member undocmemb showinherit simsoptfield packag submodul simsoptfieldbiotsavart modul automodul simsoptfieldbiotsavart member undocmemb showinherit simsoptfieldboozermagneticfield modul automodul simsoptfieldboozermagneticfield member undocmemb showinherit simsoptfieldcoil modul automodul simsoptfieldcoil member undocmemb showinherit simsoptfieldmagneticfield modul automodul simsoptfieldmagneticfield member undocmemb showinherit simsoptfieldmagneticfieldclass modul automodul simsoptfieldmagneticfieldclass member undocmemb showinherit simsoptfieldsampl modul automodul simsoptfieldsampl member undocmemb showinherit simsoptfieldtrac modul automodul simsoptfieldtrac member undocmemb showinherit modul content automodul simsoptfield member undocmemb showinherit instal page provid gener inform instal detail instal instruct specif system also found wiki httpsgithubcomhiddensymmetriessimsoptwiki_ requir simsopt python packag focus stellar optim requir python version higher simsopt also requir mandatori python packag list requirementstxt packag instal automat instal use pip anoth python packag manag conda discuss prefer instal via python setuppi instal python setuppi develop need instal python packag manual use pip conda mandatori packag numpi jax jaxlib scipi nptype ruamelyaml option packag mpi support mpipi spec support py_spec pyoculu hpi fnml vmec support httpsgithubcomhiddensymmetriesvmec comput boozer coordin booz_xform httpshiddensymmetriesgithubiobooz_xform_ requir separ physic modul like vmec see document modul wish use virtual environ option step user strongli encourag use python virtual environ instal simsopt two popular way creat python virtual environ use either venv modul suppli python conda virtual environ venv python virtual envion creat venv use codeblock python venv pathtonewvirtualenviron activ newli creat virtual environmnet bash shell codeblock pathtonewvirtualenvironmentbinactiv differ shell use activ file appropri extens reflect shell type inform pleas refer venv offici document httpshttpsdocspythonorglibraryvenvhtml_ conda instal either miniconda httpsdocscondaioenlatestminicondahtml_ anaconda httpswwwanacondacom_ hpc system anaconda either avail default via modul conda python virtual environ creat run codeblock conda creat n your_virtual_env_nam python new virtual environ python version chosen command free choos version want newli creat virtual environ activ simpl command codeblock conda activ your_virtual_env_nam activ conda virtual environ name environ appear shell prompt instal method pypi work venv conda virtual environ codeblock pip instal simsopt run command instal simsopt mandatori depend instal option depend relat spec mpi run follow command codeblock pip instal simsoptmpispec system may permiss instal packag default locat case add user flag pip packag instal user pip instal user simsopt conda precompil conda packag simsopt avail instal approach work conda virtual environ first need add condaforg one channel codeblock conda config add channel condaforg conda config set channel_prior strict instal simsopt run codeblock conda instal c hiddensymmetri simsopt sourc approach work venv conda virtual environ first instal git alreadi instal clone repositori use codeblock git clone httpsgithubcomhiddensymmetriessimsoptgit instal packag local python environ codeblock cd simsopt pip instal e e flag make instal edit mean instal packag pointer local repositori rather copi sourc file time instal henc edit code local repositori immedi reflect packag import permiss instal python packag default locat add user flag pip packag instal user pip instal user e warn instal local sourc creat directori call build reinstal simsopt sourc updat code make local chang git pull remov directori build reinstal want build simsopt local option depend run codeblock pip instal user e mpispec howev your use zsh termin exampl latest macbook version youll need run instead codeblock pip instal user e mpispec docker contain docker imag simsopt along depend vmec spec booz_xform preinstal avail docker hub contain allow use simsopt without compil code instal docker httpsdocsdockercomgetdocker_ run simsopt contain directli docker imag upload docker hub codeblock docker run rm hiddensymmetriessimsopt python command load python shell come simsopt docker contain run first time imag download automat patient inform use simsopt docker found docher contain postinstal instal success simsopt ad python environ abl import modul python import simsopt defin optim problem optimiz class basic tool defin optim problem simsopt class objsimsopt_coregraph_optimizableoptimiz mani class simsopt subclass class parent class provid sever function first allow paramet object either fix vari optim use name string associ degre freedom box constraint paramet set second objsimsopt_coregraph_optimizableoptimiz class manag depend object exampl mhd equilibrium depend objsimsoptgeosurfacesurfac object repres boundari equilibrium object know need recomput equilibrium objsimsoptgeosurfacesurfac chang third set object depend combin object function objsimsopt_coregraph_optimizableoptimiz class automat combin nonfix degre freedom global state vector pass numer optim algorithm user creat optimiz object two way one method creat standard python function appli objsimsoptmake_optimiz function explain directli subclass objsimsopt_coregraph_optimizableoptimiz optimiz degre freedom notebook contain exampl section found box syncwork simsopt optimiz demoipynb paramet object potenti includ paramet space optim refer simsopt dof degre freedom dof float integ optim simsopt dof sever properti either fix free string name upper lower bound free dof vari optim wherea fix one demonstr function use objsimsoptgeocurvexyzfouriercurvexyzfouri object concret exampl simsoptgeocurvexyzfouri import curvexyzfouri c curvexyzfourierquadpoint order object provid fourier represent close curv commonli use coil optim dof object fourier seri amplitud cartesian coordin mathxtheta ytheta ztheta respect paramet maththeta choos order mode number includ dof string name queri use objsimsopt_coregraph_optimizableoptimizablelocal_dof_nam properti clocal_dof_nam xc xs xc yc ys yc zc zs zc evid nine dof case number parenthes mode number mathm valu dof read written use objsimsopt_coregraph_optimizableoptimizablex properti cx array cx cx array cx although use indic retriev select element objsimsopt_coregraph_optimizableoptimizablex last line assign valu individu element objsimsopt_coregraph_optimizableoptimizablex ie cx work assign entir array objsimsopt_coregraph_optimizableoptimizablex get set individu dof use index string name objsimsopt_coregraph_optimizableoptimizableget objsimsopt_coregraph_optimizableoptimizableset method cget cgetx cset cx array csetzc cx array sometim may want vari particular dof optim time may want hold dof fix common use case fix dof fix major radiu minor radiu surfac fix highmodenumb mode surfac fix current coil dof objsimsoptgeocurvexyzfouriercurvexyzfouri object free default fix dof use objsimsopt_coregraph_optimizableoptimizablefix method dof fix exclud state vector objsimsopt_coregraph_optimizableoptimizablex still access valu either name objsimsopt_coregraph_optimizableoptimizablefull_x properti give free fix dof cfixxc cx array cfull_x array cgetxc check dof free use objsimsopt_coregraph_optimizableoptimizabledofs_free_statu properti statu individu dof also check use objsimsopt_coregraph_optimizableoptimizableis_fix objsimsopt_coregraph_optimizableoptimizableis_fre specifi dof either use index string name cdofs_free_statu arrayfals true true true true true true true true cis_fix true cis_fixedxc true cis_freexc fals addit objsimsopt_coregraph_optimizableoptimizablefix also manipul fixedfre statu dof use function objsimsopt_coregraph_optimizableoptimizableunfix objsimsopt_coregraph_optimizableoptimizablefix_al objsimsopt_coregraph_optimizableoptimizableunfix_al cfix_al cx array dtypefloat cunfixyc cx array cunfix_al cx array depend collect optimiz object depend repres simsopt direct acycl graph dag vertex graph instanc objsimsopt_coregraph_optimizableoptimiz object direct edg indic depend objsimsopt_coregraph_optimizableoptimiz object depend dof object call parent orign object consid child parent object object ancestor object parent parent ie object depend note dof own one object even multipl object depend valu dof mani function properti discuss previou section two variant one appli dof own directli object anoth appli dof object togeth ancestor version appli dof directli own object name begin local_ exampl analog properti objsimsopt_coregraph_optimizableoptimizablex objsimsopt_coregraph_optimizableoptimizabledof_nam includ ancestor dof also properti objsimsopt_coregraph_optimizableoptimizablelocal_x objsimsopt_coregraph_optimizableoptimizablelocal_dof_nam demonstr featur consid follow small collect object objsimsoptfieldcoilcoil pair objsimsoptfieldcoilcurr objsimsoptgeocurvecurv latter use subclass objsimsoptgeocurvexyzfouriercurvexyzfouri previou section object creat follow simsoptfieldcoil import current coil simsoptgeocurvexyzfouri import curvexyzfouri current current curv curvexyzfourierquadpoint order coil coilcurv current coil child curv current curv current parent coil correspond graph look follow origin vector graphic follow figur matt laptop box syncwork simsopt optimiz doc graphspptx imag graphpng width arrow point children parent access list parent ancestor object parent ancestor attribut coilpar simsoptgeocurvexyzfouriercurvexyzfouri xac simsoptfieldcoilcurr xa object coil dof local_ properti return empti array wherea nonlocal_ properti includ dof parent coillocal_dof_nam coildof_nam currentx curvexyzfourierxc curvexyzfourierx curvexyzfourierxc curvexyzfourieryc curvexyzfourieri curvexyzfourieryc curvexyzfourierzc curvexyzfourierz curvexyzfourierzc note name return objsimsopt_coregraph_optimizableoptimizabledof_nam name object colon prepend distinguish instanc own dof uniqu name object instanc access objsimsopt_coregraph_optimizableoptimizablenam current curv object sinc ancestor objsimsopt_coregraph_optimizableoptimizabledof_nam objsimsopt_coregraph_optimizableoptimizablelocal_dof_nam except nonlocal_ version object name prepend curvelocal_dof_nam xc xs xc yc ys yc zc zs zc curvedof_nam curvexyzfourierxc curvexyzfourierx curvexyzfourierxc curvexyzfourieryc curvexyzfourieri curvexyzfourieryc curvexyzfourierzc curvexyzfourierz curvexyzfourierzc currentlocal_dof_nam x currentdof_nam currentx objsimsopt_coregraph_optimizableoptimizablex properti discuss previou section includ dof ancestor relat properti objsimsopt_coregraph_optimizableoptimizablelocal_x appli dof directli own object dof parent chang objsimsopt_coregraph_optimizableoptimizablex properti child object automat updat curvex curvex array curvelocal_x array currentx array currentlocal_x array coilx array e e e e e e e e e e coillocal_x array dtypefloat see objsimsopt_coregraph_optimizableoptimizablex objsimsopt_coregraph_optimizableoptimizablelocal_x give result curv current sinc object ancestor coil objsimsopt_coregraph_optimizableoptimizablelocal_x return empti array coil dof objsimsopt_coregraph_optimizableoptimizablex concaten dof ancestor function objsimsopt_coregraph_optimizableoptimizableget objsimsopt_coregraph_optimizableoptimizableset objsimsopt_coregraph_optimizableoptimizablefix objsimsopt_coregraph_optimizableoptimizableunfix objsimsopt_coregraph_optimizableoptimizableis_fix objsimsopt_coregraph_optimizableoptimizableis_fre refer dof directli own object integ index suppli function must local index string name suppli function object name colon prepend instanc curvefixyc work curvefixcurvexyzfourieryc coilfixyc coilfixcurvexyzfourieryc dof fix parent object dof automat remov global state vector objsimsopt_coregraph_optimizableoptimizablex child object curvefix_al curveunfixzc coilx array e coildof_nam currentx curvexyzfourierzc thu objsimsopt_coregraph_optimizableoptimizablex properti child object conveni use state vector numer optim packag automat combin select degre freedom wish vari object involv optim problem wish get set state vector includ fix dof use properti objsimsopt_coregraph_optimizableoptimizablefull_x includ ancestor objsimsopt_coregraph_optimizableoptimizablelocal_full_x correspond string label includ fix dof access use objsimsopt_coregraph_optimizableoptimizablefull_dof_nam objsimsopt_coregraph_optimizableoptimizablelocal_full_dof_nam coilfull_x array e e e e e e e e e e coilfull_dof_nam curvexyzfourierxc curvexyzfourierx curvexyzfourierxc curvexyzfourieryc curvexyzfourieri curvexyzfourieryc curvexyzfourierzc curvexyzfourierz curvexyzfourierzc realist optim problem significantli complic graph exampl graph problem describ paper stellar optim good magnet surfac time quasisymmetri landreman b medasani c zhu phi plasma httpsdoiorg__ imag graphpng width function refer follow tabl provid refer mani properti function objsimsopt_coregraph_optimizableoptimiz object mani come set x variant listtabl state vector width headerrow stubcolumn exclud ancestor includ ancestor fix free objsimsopt_coregraph_optimizableoptimizablelocal_full_x objsimsopt_coregraph_optimizableoptimizablefull_x free objsimsopt_coregraph_optimizableoptimizablelocal_x objsimsopt_coregraph_optimizableoptimizablex listtabl number element state vector width headerrow stubcolumn exclud ancestor includ ancestor fix free objsimsopt_coregraph_optimizableoptimizablelocal_full_dof_s objsimsopt_coregraph_optimizableoptimizablefull_dof_s free objsimsopt_coregraph_optimizableoptimizablelocal_dof_s objsimsopt_coregraph_optimizableoptimizabledof_s listtabl string name width headerrow stubcolumn exclud ancestor includ ancestor fix free objsimsopt_coregraph_optimizableoptimizablelocal_full_dof_nam objsimsopt_coregraph_optimizableoptimizablefull_dof_nam free objsimsopt_coregraph_optimizableoptimizablelocal_dof_nam objsimsopt_coregraph_optimizableoptimizabledof_nam listtabl whether dof free width headerrow stubcolumn exclud ancestor includ ancestor fix free objsimsopt_coregraph_optimizableoptimizablelocal_dofs_free_statu objsimsopt_coregraph_optimizableoptimizabledofs_free_statu free na na attribut name parent ancestor function objsimsopt_coregraph_optimizableoptimizableget objsimsopt_coregraph_optimizableoptimizableset objsimsopt_coregraph_optimizableoptimizablefix objsimsopt_coregraph_optimizableoptimizableunfix objsimsopt_coregraph_optimizableoptimizableis_fix objsimsopt_coregraph_optimizableoptimizableis_fre cach optimiz object may need run rel expens comput comput mhd equilibrium long dof chang result reus without rerun comput howev dof chang either dof own local ancestor object comput need rerun mani optimiz object simsopt therefor implement cach result save cach clear due chang dof objsimsopt_coregraph_optimizableoptimiz base class provid function objsimsopt_coregraph_optimizableoptimizablerecompute_bel assist cach function call automat whenev dof object ancestor chang subclass objsimsopt_coregraph_optimizableoptimiz overload default empti objsimsopt_coregraph_optimizableoptimizablerecompute_bel function manag cach custom way specifi leastsquar object function common use case minim nonlinear leastsquar object function consist sum sever term case objsimsoptobjectivesgraph_least_squaresleastsquaresproblem class use suppos want solv leastsquar optim problem objsimsopt_coregraph_optimizableoptimiz object obj dof optim obj function func defin object function weight objfunc goal follow simsoptobjectivesgraph_least_squar import leastsquaresproblem prob leastsquaresproblemfrom_tuplesobjfunc goal weight note problem defin use element tupl form function_handl goal weight exampl func could return scalar could return numpi array latter case sumweight objfunc goal would includ object function goal could either scalar numpi array length return func similarli defin leastsquar problem addit term list multipl tupl prob leastsquaresproblemfrom_tuplesobjfunc goal weight objfunc goal weight correspond object funtion weight objfunc goal weight objfunc goal list tupl includ mixtur term defin scalar function numpi arrayvalu function note function handl specifi member objsimsopt_coregraph_optimizableoptimiz object objsimsoptobjectivesgraph_least_squaresleastsquaresproblem subclass objsimsopt_coregraph_optimizableoptimiz free dof object go object function avail global state vector probx overal scalar object function avail funcsimsoptobjectivesgraph_least_squaresleastsquaresproblemobject vector residu scale weight factor objfunc goal avail funcsimsoptobjectivesgraph_least_squaresleastsquaresproblemunweighted_residu vector residu scale weight factor sqrtweight objfunc goal avail funcsimsoptobjectivesgraph_least_squaresleastsquaresproblemresidu leastsquar problem also defin altern way prob leastsquaresproblemgo goal goal weight weight weight objfn objfn objfn prefer specifi sigma sqrtweight rather weight use leastsquaresproblemfrom_sigma prob leastsquaresproblemfrom_sigmago goal goal sigma sigma sigma objfn objfn objfn custom object function optimiz object may wish use custom object function recommend approach use funcsimsopt_coregraph_optimizablemake_optimiz import toplevel simsopt modul approach first defin standard python function take argument objsimsopt_coregraph_optimizableoptimiz object function depend function return float numpi array appli funcsimsopt_coregraph_optimizablemake_optimiz function handl includ parent object addit argument newli creat objsimsopt_coregraph_optimizableoptimiz object function j return function creat instanc suppos wish minim object function valu vmec dmerc array mercier stabil outermost avail grid point accomplish follow simsopt import make_optimiz simsoptmhdvmec import vmec simsoptobjectivesgraph_least_squar import leastsquaresproblem def myfuncv vrun ensur vmec run latest dof return vwoutdmerc vmec vmecinputextens myopt make_optimizablemyfunc vmec prob leastsquaresproblemfrom_tuplesmyoptj exampl new objsimsopt_coregraph_optimizableoptimiz object dof howev funcsimsopt_coregraph_optimizablemake_optimiz also creat objsimsopt_coregraph_optimizableoptimiz object dof paramet syntax see api document funcsimsopt_coregraph_optimizablemake_optimiz altern use funcsimsopt_coregraph_optimizablemake_optimiz write subclass objsimsopt_coregraph_optimizableoptimiz approach exampl look follow simsopt_coregraph_optimiz import optimiz simsoptmhdvmec import vmec simsoptobjectivesgraph_least_squar import leastsquaresproblem class myoptoptimiz def __init__self v selfv v optimizable__init__self depends_onv def jself selfvrun ensur vmec run latest dof return selfvwoutdmerc vmec vmecinputextens myopt myoptvmec prob leastsquaresproblemfrom_tuplesmyoptj deriv simsopt use derivativefre derivativebas optim exampl includ deriv comput analyt adjoint method automat differenti gener object objsimsoptgeo objsimsoptfield modul provid deriv inform object objsimsoptmhd asid sever adjoint method latter problem deriv class objsimsopt_corederivativederiv use see api document class detail class provid chain rule automat mask row gradient correspond fix dof chain rule comput revers mode use vectorjacobian product effici case object function scalar vector fewer dimens number dof object return gradient gradient function typic name dj elimin magnet island exampl show shape boundari magnet surfac adjust elimin magnet island insid consid vacuum field exampl use spec code singl radial domain geometri come quasihel symmetr configur develop univers wisconsin elimin island minim object function involv green residu sever opoint xpoint similar approach hanson cari initi configur defin spec input file qhresiduessp found examples_intermediateinput directori gener poincar plot boundari shape run standalon spec seen island chain correspond mathiota reson figur gener matt box syncworkatenandsimsoptaten_poincare_redboundari imag qhresiduesbeforepng width island chain elimin slight chang shape boundari magnet surfac simsopt first step import item need import numpi np simsoptmhdspec import spec residu simsoptobjectivesgraph_least_squar import leastsquaresproblem simsoptsolvegraph_seri import least_squares_serial_solv creat spec object base input file specqhresiduessp mani fourier mode boundari affect island width choos nearli subset boundari mode vari optim keep exampl fast pick two mode vari rather mode mode high poloid mode number coupl particularli strongli island choos vari two mode sinc origin configur contain mode must increas number mode boundari shape order mode avail vari sboundarychange_resolut sboundaryntor pick mode boundari shape vari optim sboundaryfix_al sboundaryunfixz sboundaryunfixz next let us defin object function object function base residu defin green residu properti period trajectori field line opoint xpoint magnet island good magnet surfac exist ration valu mathiota residu zero minim squar residu promot good surfac qualiti simsopt defin residu object base spec object togeth ration number island chain reson surfac iota p q p q guess radial locat island chain s_guess residu residu p q s_guesss_guess initi guess radial coordin critic newton method find period field line robust case default residu comput poloid angl zero correspond opoint island chain defin second residu xpoint specifi poloid angl mathpi instead zero residu residu p q s_guesss_guess thetanppi get numer valu residu call j function object automat caus spec run initial_r residuej initial_r residuej printfiniti residu initial_r initial_r spec run output close follow initi residu free also defin residu ration surfac confin region exampl turn use also control residu mathiota surfac sinc boundari adjust elimin island open island therefor let us defin residu object x point second ration surfac p q s_guess residu residu p q s_guesss_guess residu residu p q s_guesss_guess thetanppi combin four residu leastsquar object function sum squar residu object function sum_j residue_j prob leastsquaresproblemfrom_tuplesresidu residu residu residu want island present instead absent might case design island divertor valu zero could use goal valu eg residu final let us solv optim problem least_squares_serial_solveprob solut take function evalu like take minut two afterward examin optimum final_r residuej final_r residuej printffin residu final_r final_r residu reduc final residu e e gener poincar plot final configur use standalon spec island chain elimin figur gener matt box syncworkatenandsimsoptaten_poincare_optim imag qhresiduesafterpng width note make poincar plot like spec increas valu nppt nptrj spec input file simsoptpp packag modul content automodul simsoptpp member undocmemb showinherit overview way use simsopt simsopt collect class function use sever way one applic solv optim problem involv stellar similar stellopt could also defin object function use simsopt use optim librari outsid simsopt solv could use simsopt optim infrastructur optim object may may connect stellar altern use stellaratorrel object script purpos optim plot code output vari input paramet chang evalu finitediffer gradient code output manipul object interact python command line jupyt notebook input file simsopt use input data file defin optim problem contrast stellopt rather problem specifi use python driver script object defin configur howev object relat specif physic code may use input file particular objsimsoptmhdvmecvmec object initi use standard vmec input input file objsimsoptmhdspecspec object initi use standard spec sp input file optim stage recent optim stellar design use two stage perform use simsopt first stage paramet space shape toroid boundari flux surfac coil consid explicitli stage object function involv surrog confin stabil plasma insid boundari surfac second optim stage coil shape optim produc plasma shape result stage paramet space stage repres space coil shape object function stage usual involv sever term one term deviat magnet field produc coil magnet field desir plasma boundari given stage solut term object function introduc regular coil shape coil length andor curvatur reflect engin consider distanc coil futur aim introduc altern optim strategi simsopt besid twostag approach combin singlestag method optim optim use simsopt four basic step defin physic entiti optim problem coil mhd equilibria etc creat instanc relev simsopt class defin independ variabl optim choos degre freedom object free vs fix defin object function solv optim problem defin pattern evid tutori document exampl directori repositori typic object mhd equilibrium repres vmec spec code electromagnet coil defin object function varieti addit object defin depend mhd equilibrium coil objsimsoptmhdboozerbooz object boozercoordin transform objsimsoptmhdspecresidu object repres green residu magnet island objsimsoptgeoobjectiveslpcurvecurvatur penalti coil curvatur detail set degre freedom defin object function found docoptimiz page solut step two function provid present methsimsoptsolvegraph_serialleast_squares_serial_solv methsimsoptsolvegraph_mpileast_squares_mpi_solv first simpler second allow mpiparallel finit differ use optim modul class function simsopt organ sever modul objsimsoptgeo contain sever represent curv surfac objsimsoptfield contain machineri biotsavart law magnet field represent objsimsoptmhd contain interfac mhd equilibrium code tool diagnos output objsimsoptobject contain tool common object function objsimsoptsolv contain wrapper optim algorithm objsimsoptutil contain util function objsimsopt_cor defin optimiz class tool use intern simsopt simsopt document simsopt framework optim stellar httpsenwikipediaorgwikistellarator_ highlevel routin python call c fortran need perform sever type compon includ interfac physic code eg mhd equilibrium tool defin object function paramet space optim geometr object import stellar surfac curv sever avail parameter effici implement biotsavart law magnet field represent includ deriv tool parallel finitediffer gradient calcul design simsopt guid sever principl thorough unit test regress test continu integr extens possibl add new code term object function without edit modul alreadi work ie openclos principl httpsenwikipediaorgwikiopeneclosed_principle_ edit work code potenti introduc bug modular physic modul need optim problem need instal instanc optim spec equilibria vmec modul need instal flexibl compon use defin object function reus applic standard optim instanc simsopt object function standard python function plot pass optim packag outsid simsopt etc simsopt fulli opensourc anyon welcom use make suggest contribut physic modul compil code resid separ repositori separ modul includ vmec httpsgithubcomhiddensymmetriesvmec_ mhd equilibrium spec httpsgithubcomprincetonuniversityspec_ mhd equilibrium booz_xform httpshiddensymmetriesgithubiobooz_xform_ boozer coordin quasisymmetri grate acknowledg fund simon foundat hidden symmetri fusion energi project httpshiddensymmetriesprincetonedu_ simsopt one sever avail system stellar optim other includ stellopt httpsgithubcomprincetonuniversitystellopt_ rose httpsdoiorgaaed_ lasso httpsgitlabcomwistell_ toctre maxdepth caption content overview instal contain optimiz geo field trace mpi test sourc public contribut toctre maxdepth caption tutori example_vmec_onli example_quasisymmetri example_island example_coil toctre maxdepth caption api simsopt indic tabl refgenindex refmodindex refsearch optim equilibrium code walk exampl small optim problem fixedboundari mhd equilibrium code use code requir either vmec spec use variant problem shown two independ variabl optim control shape toroid boundari object function involv rotat transform volum exampl document stellopt scenario collect httpsgithubcomlandremanstellopt_scenariostreemasterdof_vmeconly_targetiotaandvolume_ also find sourc code exampl exampl directori httpsgithubcomhiddensymmetriessimsoptblobmasterexamplesstellarator_benchmarksdof_vmeconly_targetiotaandvolumepy_ problem two independ variabl rbc zb control shape plasma boundari rphi costheta rbc costheta phi zphi sintheta zb sintheta phi note boundari five field period consid vacuum field insid boundari magnet surfac ie plasma current pressur object function codeblock f iota iota_target volum volume_target iota rotat transform magnet axi iota_target volume_target volum volum enclos plasma boundari object function landscap look like imag dof_vmeconly_targetiotaandvolume_landscapepng width seen total object function two long narrow valley fairli straight two symmetr optima one bottom valley either two independ variabl boundari surfac becom infinitesm thin equilibrium code like fail optimum configur look follow color indic magnet field strength imag dof_vmeconly_targetiotaandvolume_optimumpng width spec version show spec version exampl simplic mpi parallel use start must import sever class simsoptmhd import spec simsoptobjectivesgraph_least_squar import leastsquaresproblem simsoptsolvegraph_seri import least_squares_serial_solv creat equilibrium object start input file equil specdof_targetiotaandvolumesp file found examplesstellarator_benchmarksinput directori prepend path filenam need next defin independ variabl optim choos degre freedom fix fix case independ variabl two fourier amplitud defin boundari choos independ variabl follow surf equilboundari surffix_al surfunfixrc surfunfixz next step defin object function detail defin leastsquar object function see docoptimiz page present problem use codeblock desired_volum volume_weight term equilvolum desired_volum volume_weight desired_iota iota_weight term equiliota desired_iota iota_weight prob leastsquaresproblemfrom_tuplesterm term final solv optim problem least_squares_serial_solveprob spec run mani time like take bit less minut find optimum problem solv examin properti optimum printat optimum print rcmn surfget_rc print zsmn surfget_z print volum accord spec equilvolum print volum accord surfac surfvolum print iota axi equiliota print object function probobject result codeblock optimum rcmn zsmn volum accord spec volum accord surfac iota axi object function number match solut found use stellopt vmec stellopt_scenario httpsgithubcomlandremanstellopt_scenariostreemasterdof_vmeconly_targetiotaandvolume_ vmec version use vmec instead spec essenti chang use objsimsoptmhdvmecvmec object equilibrium instead spec object also show add mpi exampl mpi use parallel finitediffer gradient within vmec comput time introduc mpi first initi objsimsoptutilmpimpipartit object choos number worker group instanc pass argument vmec object methsimsoptsolvermpi_solveleast_squares_mpi_solv function detail mpi see docmpi complet exampl follow simsoptutilmpi import mpipartit simsoptmhd import vmec simsoptobjectivesgraph_least_squar import leastsquaresproblem simsoptsolvegraph_mpi import least_squares_mpi_solv next line adjust mani group pool mpi process split mpi mpipartitionngroup initi vmec input file equil vmecinputdof_vmeconly_targetiotaandvolum mpi surf equilboundari choos paramet optim set fix attribut surffix_al surfunfixrc surfunfixz target equip shift weight becom term leastsquar object function list term combin form nonlinearleastsquar problem desired_volum volume_weight term equilvolum desired_volum volume_weight desired_iota iota_weight term equiliota_axi desired_iota iota_weight prob leastsquaresproblemfrom_tuplesterm term solv minim problem least_squares_mpi_solveprob mpi gradtru vmec input file use found exampl directori repositori geometr object simsopt contain implement two type geometr object import stellar curv surfac avail varieti parameter sever deriv provid curv surfac object found objsimsoptgeo modul _curv curv curv use repres electromagnet coil magnet axi curv repres simsopt subclass base class objsimsoptgeocurvecurv simsopt curv model function mathgamma mathbbr note curv paramet goe mathpi curv simsopt assum period paramet curv object store list mathn_theta quadratur point maththeta_ ldot theta_n_theta subset varieti class method return inform curv quadratur point avail method follow curvegamma return n_theta array contain mathgammatheta_i mathiin ldot n_theta ie return list xyz coordin along curv curvegammadash return n_theta array contain mathgammatheta_i mathiin ldot n_theta ie return nonunitlength tangent vector along curv curvekappa return n_theta array contain curvatur mathkappa curv quadratur point curvetors return n_theta array contain torsion mathtau curv quadratur point curvefrenet_fram return element tupl lead element n_theta array contain cartesian compon unit tangent vector quadratur point similarli remain two entri tupl give unit normal binorm vector differ curv class objsimsoptgeocurverzfouriercurverzfouri objsimsoptgeocurvexyzfouriercurvexyzfouri differ way curv discret take array dof paramet eg fourier coeffici turn function mathgamma mathbbr dof queri set via x full_x properti former give nonfix dof wherea latter give dof includ fix also set individu dof use string name exampl objsimsoptgeocurvexyzfouriercurvexyzfouri object c zerofrequ fourier mode cartesian compon set use csetyc chang dof chang shape curv simsopt abl comput deriv relev quantiti respect discret paramet exampl comput deriv coordin curv quadratur point one call curvedgamma_by_dcoeff one obtain numpi array shape n_theta n_dof contain deriv posit everi quadratur point respect everi degre freedom curv way one comput deriv quantiti curvatur via curvedkappa_by_dcoeff torsion via curvedtorsion_by_dcoeff number quantiti implement objsimsoptgeocurveobject comput objsimsoptgeocurvecurv curvelength comput length curv lpcurvecurvatur comput penalti base mathl_p norm curvatur curv lpcurvetors comput penalti base mathl_p norm torsion curv minimumdist comput penalti term minimum distanc set curv valu quantiti deriv respect curv dof obtain call eg curvelengthj curvelengthdj _surfac surfac surfac use repres flux surfac particularli boundari mhd equilibria target surfac stage coil optim surfac repres simsopt use subclass base class objsimsoptgeosurfacesurfac surfac model simsopt function mathgamma time mathbbr evalu quadratur point mathphi_ ldot phi_n_phitimestheta_ ldot theta_n_theta mathphi toroid angl maththeta poloid angl note mathphi maththeta go math pi surfac simsopt assum period angl practic almost never use base objsimsoptgeosurfacesurfac class rather typic use one subclass correspond specif parameter present avail subclass objsimsoptgeosurfacerzfouriersurfacerzfouri objsimsoptgeosurfacegarabediansurfacegarabedian objsimsoptgeosurfacehennebergsurfacehenneberg objsimsoptgeosurfacexyzfouriersurfacexyzfouri objsimsoptgeosurfacexyztensorfouriersurfacexyztensorfouri mani case convert surfac one type anoth go objsimsoptgeosurfacerzfouriersurfacerzfouri surfac type to_rzfouri from_rzfouri method note objsimsoptgeosurfacerzfouriersurfacerzfouri correspond surfac parameter use intern vmec spec code howev use code simsopt avail surfac subclass use repres surfac simsopt automat handl convers objsimsoptgeosurfacerzfouriersurfacerzfouri run code point mathphi_j maththeta_j use evalu posit vector deriv comput integr plot sever avail method specifi point maththeta_j typic specifi keyword argument ntheta constructor instanti surfac class result grid ntheta uniformli space point endpoint altern specifi list array point quadpoints_theta keyword argument instanti surfac class specifi maththeta_j directli ntheta quadpoints_theta specifi except rais mathphi coordin sometim want point full toru sometim mathn_fp one field period sometim math n_fp half field period three case select set rang keyword argument surfac subclass full toru field period half period equival set rang constant srange_full_toru srange_field_period srange_half_period objsimsoptgeosurfacesurfac subclass note mathphi grid point begin full toru field period wherea half period mathphi grid shift half grid space preserv spectral accuraci integr three case nphi keyword argument set desir number mathphi grid point altern pass list array quadpoints_phi keyword argument constructor surfac subclass specifi mathphi_j point directli except rais nphi quadpoints_phi specifi inform argument see objsimsoptgeosurfacerzfouriersurfacerzfouri api document method avail surfac class similar objsimsoptgeocurvecurv class surfacegamma return n_phi n_theta array contain mathgammaphi_i theta_j mathiin ldot n_phi jin ldot n_theta ie return list xyz coordin surfac surfacegammadash return n_phi n_theta array contain mathpartial_phi gammaphi_i theta_j mathiin ldot n_phi jin ldot n_theta surfacegammadash return n_phi n_theta array contain mathpartial_theta gammaphi_i theta_j mathiin ldot n_phi jin ldot n_theta surfacenorm return n_phi n_theta array contain mathpartial_phi gammaphi_i theta_jtim partial_theta gammaphi_i theta_j mathiin ldot n_phi jin ldot n_theta surfacearea return surfac area surfacevolum return volum enclos surfac number quantiti implement objsimsoptgeosurfaceobject comput objsimsoptgeosurfacesurfac toroidalflux comput flux toroid cross section surfac valu quantiti deriv respect surfac dof obtain call eg toroidalfluxj toroidalfluxdj_dsurfacecoeffici cach quantiti simsopt comput curv surfac often depend exampl curvatur torsion curv reli curvegammadash avoid repeat calcul geometr object contain cach automat manag quantiti curv request cach check see whether alreadi comput cach clear manual call curveinvalidate_cach function call everi time valu assign curvex mean shape curv chang graphic basic graphic function provid curv surfac object plot singl curv surfac call plot function object present three graphic engin support matplotlib mayavi plotli select plot engin pass engin keyword argument eg c curv object call cplotenginemayavi use close argument control whether segment drawn last quadratur point first option see api document funcsimsoptgeocurvecurveplot funcsimsoptgeosurfacesurfaceplot multipl curv andor surfac object conveni way plot togeth axe function funcsimsoptgeoplotplot accept list object argument keyword pass function pass plot method individu object may wish pass keyword engin close altern also use ax show argument plot method individu curv surfac object put share axe also possibl export curv surfac object vtk format view paraview function requir python packag pyevtk instal via pip instal pyevtk list curv object export use function funcsimsoptgeocurvecurves_to_vtk export vtk file surfac call to_vtkfilenam function object see funcsimsoptgeosurfacesurfaceto_vtk detail coil optim work exampl stage coil optim approach consid target plasma boundari shape alreadi chosen stage present task optim shape coil produc target field tutori similar exampl examples_intermediatestage_two_optimizationpi note stage problem mhd code like vmec spec use need instal object function minim math j frac int vecbcdotvecn ds alpha sum_j l_j beta j_dist first righthandsid term quadrat flux area integr target plasma surfac squar magnet field normal surfac coil exactli produc flux surfac target shape term vanish next mathl_j length mathjth coil scalar regular paramet mathalpha chosen balanc tradeoff larg valu give smooth coil cost inaccuraci produc target field small valu mathalpha give accur match target field cost complic coil final mathj_dist penalti prevent coil becom close precis definit see objsimsoptgeocurveobjectivesminimumdist constant mathbeta select balanc minimum distanc penalti object analyt deriv use optim tutori consid vacuum field magnet field due current plasma need subtract quadrat flux term configur consid precis qa case arxiv httparxivorgpdfpdf_ two field period quasiaxisymmetr stage optim problem automat parallel simsopt use openmp vector mpi use mpipi python packag need exampl run second laptop begin solv optim problem simsopt first import class use import numpi np scipyoptim import minim simsoptgeosurfacerzfouri import surfacerzfouri simsoptobjectivesfluxobject import squaredflux simsoptgeocurv import curves_to_vtk create_equally_spaced_curv simsoptfieldbiotsavart import biotsavart simsoptfieldcoil import current coils_via_symmetri simsoptgeocurveobject import curvelength minimumdist simsoptgeoplot import plot target plasma surfac given vmec input file teststest_filesinputlandremanpaul_qa load surfac use codeblock nphi ntheta filenam teststest_filesinputlandremanpaul_qa surfacerzfourierfrom_vmec_inputfilenam rangehalf period nphinphi nthetantheta adjust directori filenam appropri system surfac could also read vmec wout file use objsimsoptgeosurfacerzfouriersurfacerzfourierfrom_wout vmec need instal initi surfac vmec input output file note surfac object carri grid quadratur point posit vector evalu differ circumst may want point cover differ rang toroid angl problem stellar symmetri fieldperiod symmetri need consid half field period order evalu integr entir surfac reason rang paramet surfac set half period next set initi condit coil equal space circl consid case four uniqu coil shape repeat four time due stellar symmetri twofieldperiod symmetri give total coil four uniqu coil shape call base coil copi coil also carri current allow uniqu coil shape differ current allow wx tutori consid coil infinitesim thin filament simsopt coil repres objsimsoptfieldcoilcoil class essenti curv pair current repres use objsimsoptgeocurvecurv objsimsoptfieldcoilcurr respect initi condit set follow number uniqu coil shape ncoil major radiu initi circular coil r minor radiu initi circular coil r number fourier mode describ cartesian compon coil order base_curv create_equally_spaced_curvesncoil snfp stellsymtru rr rr orderord base_curr current rangencoil one detail optim coil vacuum configur optim cheat make current go zero make quadrat flux vanish close loophol fix current first base coil base_currentsfix_al current object one degre freedom henc use fix_al wish fix current coil forc valu full set coil obtain use stellar symmetri fieldperiod symmetri coil coils_via_symmetriesbase_curv base_curr snfp true illumin look nonfix degre freedom coil depend done print dof_nam properti printcoildof_nam curvexyzfourierxc curvexyzfourierx curvexyzfourierxc printcoildof_nam currentx curvexyzfourierxc curvexyzfourierx curvexyzfourierxc printcoildof_nam curvexyzfourierxc curvexyzfourierx curvexyzfourierxc notic current appear list dof coil coil sinc fix current coil also notic coil degre freedom own curvexyzfouri coil coil refer base coil shape sever way view object creat far one approach function objsimsoptgeoplotplot accept list coil curv andor surfac object plotcoil enginemayavi closetru imag coils_initpng width instead mayavi select matplotlib plotli graphic engin although matplotlib problem display multipl object proper order altern export object vtk format open paraview curv ccurv c coil curves_to_vtkcurv curves_init sto_vtksurf_init evalu magnet field target surfac creat objsimsoptfieldbiotsavartbiotsavart object base coil instruct evalu field surfac bs biotsavartcoil bsset_pointssgammareshap surfac posit vector gamma return array size nphi ntheta reshap number_of_evaluation_point objsimsoptfieldbiotsavartbiotsavart object let us check size field normal target surfac optim b_dot_n npsumbsbreshapenphi ntheta sunitnorm axi printiniti max b dot n npmaxb_dot_n result tesla defin object function weight curv length object function alpha e threshhold coiltocoil distanc penalti object function min_dist weight coiltocoil distanc penalti term object function beta jf squaredflux bs jl curvelengthc c base_curv jdist minimumdistancecurv min_dist scale add term form total object function object jf alpha sumjl beta jdist last line use fact optimiz object repres individu term object scale constant ad featur appli optimiz object function j return object gradient use function dj return gradient check degre freedom vari optim print dof_nam properti object printobjectivedof_nam currentx currentx currentx curvexyzfourierxc curvexyzfourierx curvexyzfourierzc curvexyzfourierxc curvexyzfourierx curvexyzfourierz curvexyzfourierzc desir fourier amplitud four base coil appear three four current next interfac scipi minim routin write small function def fundof objectivex dof return objectivej objectivedj note dj method object call comput gradient simsopt automat appli chain rule assembl deriv variou term object entri gradient correspond degre freedom fix current first coil automat remov run optim use lbfgsb algorithm scipi httpsdocsscipyorgdocscipyreferenceoptimizeminimizelbfgsbhtmloptimizeminimizelbfgsb_ re minimizefun objectivex jactru methodlbfgsb optionsmaxit iprint tole optim take second output look like codeblock none run lbfgsb code machin precis n problem unconstrain x variabl exactli bound iter f proj g iter f proj g iter f proj g iter f proj g iter f proj g tit total number iter tnf total number function evalu tnint total number segment explor cauchi search skip number bfg updat skip nact number activ bound final gener cauchi point projg norm final project gradient f final function valu n tit tnf tnint skip nact projg f f e stop total iter reach limit adjust paramet toler number iter let us check final mathvecbcdotvecn surfac b_dot_n npsumbsbreshapenphi ntheta sunitnorm axi printfin max b dot n npmaxb_dot_n final valu tesla reduc two order magnitud initi state initi condit plot optim coil shape directli simsopt use codeblock plotcoil enginemayavi closetru export object vtk format open paraview latter option also export final mathvecbcdotvecn surfac use follow syntax curv ccurv c coil curves_to_vtkcurv curves_opt sto_vtksurf_opt extra_datab_n b_dot_n none imag coils_finalpng width optim valu current coil j obtain use coilsjcurrentget_valu optim fourier coeffici coil j obtain coilsjcurvex mean array element seen coilsjcurvedof_nam posit vector coil j cartesian coordin obtain coilsjcurvegamma magnet field simsopt provid sever represent magnet field includ biotsavart field associ coil well other magnet field repres subclass base class objsimsoptfieldmagneticfieldmagneticfield variou field type scale sum togeth instanc add pure toroid field field coil field object associ set evalu point point queri field b vector potenti deriv respect posit field paramet field type coil biotsavart simsopt filamentari coil repres class objsimsoptfieldcoilcoil coil pair objsimsoptgeocurvecurv current magnitud latter repres objsimsoptfieldcoilcurr object inform curv object see refth page geometr object curv wish sever filamentari curv carri current reus objsimsoptfieldcoilcurr object multipl objsimsoptfieldcoilcoil object objsimsoptfieldcoilcoil object defin magnet field produc evalu use class objsimsoptfieldbiotsavartbiotsavart class provid implement biotsavart law math bmathbfx fracmu_pi sum_kn_mathrmcoil i_k int_ fracgamma_kphimathbfxtim gamma_kphigamma_kphimathbfx dphi mathmu_pi time vacuum permit mathgamma_k posit vector coil mathk mathi_k indic electr current exampl import numpi np simsoptgeocurvexyzfouri import curvexyzfouri simsoptfieldcoil import current coil simsoptfieldbiotsavart import biotsavart curv curvexyzfouri number quadratur point max fourier mode number curvex set fourier amplitud coil coilcurv current kampereturn field biotsavartcoil multipl coil includ list fieldset_pointsnparray printfieldb complex exampl objsimsoptfieldbiotsavartbiotsavart object use coil optim see examples_intermediatestage_two_optimizationpi toroidalfield objsimsoptfieldmagneticfieldclassestoroidalfield class repres pure toroid magnet field field given mathmathbf b b_ fracr_r mathbf e_phi mathr_ mathb_ input scalar quantiti mathr_ repres refer major radiu mathb_ magnet field mathr_ mathr radial coordin cylindr coordin system mathrzphi vector mathmathbf e_phi unit vector point direct increas mathphi mathphi standard azimuth angl given cartesian coordin mathxyz mathmathbf e_phi calcul mathmathbf e_phisin phi mathbf e_xco phi mathbf e_i mathphiarctanyx poloidalfield objsimsoptfieldmagneticfieldclassespoloidalfield class repres poloid magnet field acord formula mathmathbf b b_ fracrq r_ mathbf e_theta mathr_ q mathb_ input scalar quantiti mathr_ repres major radiu magnet axi mathb_ magnet field mathrr_ q mathq safeti factor associ sum poloid magnet field toroid magnet field major radiu mathr_ magnet field onaxi mathb_ mathr radial coordin simpl toroid coordin system mathrphitheta given set point mathxyz mathr calcul mathrsqrtsqrtxyr_z vector mathmathbf e_theta unit vector point direct increas maththeta maththeta poloid angl simpl toroid coordin system mathrphitheta given set point mathxyz mathmathbf e_theta calcul mathmathbf e_thetasin theta co phi mathbf e_xsin theta sin phi mathbf e_yco theta mathbf e_z mathphiarctanyx maththetaarctanzsqrtxyr_ scalarpotentialrzmagneticfield objsimsoptfieldmagneticfieldclassesscalarpotentialrzmagneticfield class initi vacuum magnet field mathmathbf b nabla phi defin via scalar potenti mathphi cylindr coordin mathrzphi field mathphi specifi analyt express via string argument simsopt perform necessari partial deriv order find mathmathbf b deriv exampl function scalarpotentialrzmagneticfieldphi repres toroid magnet field mathmathbf b nabla phir mathbf e_phi note function need librari sympi analyt deriv circularcoil objsimsoptfieldmagneticfieldclassescircularcoil class repres magnet field creat singl circular coil take four input quantiti matha radiu coil mathmathbf cc_xc_yc_z center coil mathi current flow coil mathmathbf n normal vector plane coil center coil radiu could specifi either three cartesian compon mathmathbf nn_xn_yn_z mathmathbf nthetaphi spheric angl maththeta mathphi magnet field calcul analit use follow express refer httpsntrsnasagovcitations_ mathb_xfracmu_ ipifracx zalpha beta rholeftarekalpha kkright mathb_yfracyxb_x mathb_zfracmu_ ipi alpha betaleftarekalpha kkright mathrhoxi mathrxyz mathalphaararho mathbetaar rho mathkalphabeta dommaschk objsimsoptfieldmagneticfieldclassesdommaschk class repres vacuum magnet field mathmathbf b nabla phi basi function scalar potenti mathphi describ w dommaschk comput physic commun httpswwwsciencedirectcomsciencearticlepii_ represent provid explicit analyt formula vacuum field mixtur flux surfac island chao follow origin refer toroid field mathb_r_ alreadi includ definit input paramet take two array first array mathntim array mathm_n_m_n_ specifi harmon coeffici mathm mathn nonzero second array mathntim array mathb_c_b_c_ mathb_ib_m_in_i mathc_ic_m_in_i coeffici use dommaschk represent reiman objsimsoptfieldmagneticfieldclassesreiman provid magnet field model section reiman greensid comput physic commun httpswwwsciencedirectcomsciencearticlepii_ analyt magnet field represent allow explicit calcul width magnet field island interpolatedfield objsimsoptfieldmagneticfieldclassesinterpolatedfield function take exist field interpol regular grid mathrphiz result interpol evalu quickli use effici trace field line particl trajectori scale sum field magnet field object ad togeth either use oper creat instanc class objsimsoptfieldmagneticfieldmagneticfieldsum oper creat latter magnet field also scale constant accomplish either use oper creat instanc class objsimsoptfieldmagneticfieldmagneticfieldmultipli oper creat latter exampl simsoptfieldmagneticfieldclass import toroidalfield circularcoil field circularcoili r field toroidalfieldr b total_field field field common oper magnet field object larg number function avail evalu field must set evalu point done use either cartesian cylindr coordin let objsimsoptfieldmagneticfieldmagneticfield object suppos n point wish evalu field mset_points_cart take numpi array size n cartesian coordin x z point mset_points_cyl take numpi array size n cylindr coordin r phi z point mset_point shorthand mset_points_cart mget_points_cart return numpi array size n cartesian coordin x z point mget_points_cyl return numpi array size n cylindr coordin r phi z point varieti function avail return magnet field mathb vector potenti matha gradient commonli use one follow mb return array size n cartesian coordin mathb mb_cyl return array size n cylindr r phi z coordin mathb return array size n cartesian coordin matha mabsb return array size n field magnitud mathb mdb_by_dx return array size n cartesian coordin mathnabla b denot indic mathijl result contain mathpartial_j b_lx_i mdb_by_dxdx return array size n cartesian coordin mathnablanabla b denot indic mathijkl result contain mathpartial_k partial_j b_lx_i mda_by_dx return array size n cartesian coordin mathnabla denot indic mathijl result contain mathpartial_j a_lx_i mda_by_dxdx return array size n cartesian coordin mathnablanabla denot indic mathijkl result contain mathpartial_k partial_j a_lx_i mgradabsb return array size n cartesian compon mathnabla b exampl codeblock import numpi np simsoptfieldmagneticfieldclass import circularcoil field circularcoili r point nparray fieldset_pointspoint printfieldb printfielddb_by_dx contain _docker_doc docker contain docker contain simsopt avail allow use simsopt without compil code contain includ vmec spec booz_xform warn docker gener allow run comput hpc center due secur issu wish run simsopt nersc machin pleas refer refshifter_doc requir docker need instal run docker contain docker softwar obtain docker websit httpsdocsdockercomgetdocker_ check docker get start webpag httpsdocsdockercomgetstarted_ instal instruct well tutori get feel docker contain linux may need start docker daemon proceed warn mac default gb memori per contain assign docker desktop suffici increas memori contain least gb run simsopt much faster instal docker hub easiest way get simsopt docker imag come simsopt depend spec vmec preinstal use docker hub instal docker httpsdocsdockercomgetstarted_ run simsopt contain directli simsopt docker imag upload docker hub codeblock docker run rm hiddensymmetriessimsopt python linux user prefix command sudo command load python shell come simsopt docker contain run first time imag download automat patient abl import modul python import simsopt way use simsopt docker contain ipython shell easiest way start ipython shell import simsopt librari approach use command need execut load python modul execut codeblock docker run rm hiddensymmetriessimsopt ipython bash shell approach write simsopt base driver script optim problem one need mount host directori contain run script use v flag mount current directori codeblock docker run rm v pwdmy_mount hiddensymmetriessimsopt contain cd my_mount contain python driver_script jupyt notebook simsopt contain come jupyt notebook preload launch jupyt contain use command codeblock docker run rm v pwdmy_mount p hiddensymmetriessimsopt contain cd my_mount contain jupyt notebook ip nobrows allowroot run command link print use open jupyt consol web browser link typic start httptoken sever link print last one list work browser run outsid contain copi full link past browser comput persist contain use intruct creat fresh contain time delet contain exit would like creat persist contain eg instal addit pip packag insid reus time remov rm command specifi contain name via name codeblock docker run namemycontain v pwdmy_mount hiddensymmetriessimsopt contain cd my_mount contain python driver_script restart rejoin contain codeblock docker start mycontain docker exec mycontain binbash contain sourc venvbinactiv _shifter_doc shifter contain shifter httpsdocsnerscgovdevelopmentshifter_ contain technolog deploy nersc circumv secur issu associ docker contain shifter allow use simsopt docker imag file host docker hub detail instruct use shifter found nersc page simsopt wiki httpsgithubcomhiddensymmetriessimsoptwikinersccori_ test simsopt includ unit regress test continu integr python test suit main test suit base standard unittest python modul sourc code python test locat test directori test use instal version simsopt python packag may differ code local repositori make edit instal see docinstal run test test suit one processor type codeblock run_test command line repositori home directori equival run codeblock python unittest test directori test involv mpi use execut test variou number process make sure test pass case purpos necessari run entir test suit test mpi involv conveni run script codeblock run_tests_mpi repositori home directori script run test mpi name test run processor test make use data file teststest_fil directori longer exampl conveni main test suit design run minut mean complic integr regress test requir substanti time includ may wish run complic test hand develop number exampl found exampl subdirectori also simsopt stellopt benchmark sever problem stellopt_scenario collect httpsgithubcomlandremanstellopt_scenarios_ includ correspond simsopt input file continu integr serial mpi test automat run everi commit repositori autom handl github action control script githubworkflowsciyml view result continu integr run click action link github repositori page httpsgithubcomhiddensymmetriessimsopt_ directli visit httpsgithubcomhiddensymmetriessimsoptactions_ simsoptmhd packag submodul simsoptmhdbooz modul automodul simsoptmhdbooz member undocmemb showinherit simsoptmhdspec modul automodul simsoptmhdspec member undocmemb showinherit simsoptmhdvmec modul automodul simsoptmhdvmec member undocmemb showinherit simsoptmhdvmec_diagnost modul automodul simsoptmhdvmec_diagnost member undocmemb showinherit modul content automodul simsoptmhd member undocmemb showinherit