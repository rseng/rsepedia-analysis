p aligncent img width srchttpsrawgithubusercontentcomexoplanetdevexoplanetmaindocs_staticlogopng brbr hrefhttpsgithubcomexoplanetdevexoplanetactionsworkflowstestsyml img srchttpsgithubcomexoplanetdevexoplanetactionsworkflowstestsymlbadgesvg alttest hrefhttpsdocsexoplanetcod img srchttpsreadthedocsorgprojectsexoplanetbadgeversionlatest altdoc hrefhttpscoverallsiogithubexoplanetdevexoplanetbranchmain img srchttpscoverallsioreposgithubexoplanetdevexoplanetbadgesvgbranchmain altcoverag p exoplanet fast scalabl mcmc exoplanet need _exoplanet_ toolkit probabilist model time seri data astronomi focu observ exoplanetshttpsenwikipediaorgwikiexoplanet use pymchttpsdocspymcio _pymc_ flexibl highperform model build languag infer engin scale well problem larg number paramet _exoplanet_ extend _pymc_ languag support mani custom function distribut requir fit exoplanet dataset read full document docsexoplanetcodeshttpsdocsexoplanetcod instal quickest way get start use piphttpspippypaio bash python pip instal exoplanet note need python instal work instal requir depend check main instal document pagehttpsdocsexoplanetcodesenlatestuserinstal option usag check tutori api doc doc pagehttpsdocsexoplanetcod exampl usag much info also find indepth exampl exoplanet case studi pagehttpsgalleryexoplanetcod contribut _exoplanet_ open sourc project would love want contribut check develop documentationhttpsdocsexoplanetcodesenlatestuserdev info get start contributor coven code conduct pledg interest foster open welcom environ contributor maintain pledg make particip project commun harassmentfre experi everyon regardless age bodi size disabl ethnic sex characterist gender ident express level experi educ socioeconom statu nation person appear race religion sexual ident orient standard exampl behavior contribut creat posit environ includ use welcom inclus languag respect differ viewpoint experi grace accept construct critic focus best commun show empathi toward commun member exampl unaccept behavior particip includ use sexual languag imageri unwelcom sexual attent advanc troll insultingderogatori comment person polit attack public privat harass publish other privat inform physic electron address without explicit permiss conduct could reason consid inappropri profession set respons project maintain respons clarifi standard accept behavior expect take appropri fair correct action respons instanc unaccept behavior project maintain right respons remov edit reject comment commit code wiki edit issu contribut align code conduct ban temporarili perman contributor behavior deem inappropri threaten offens harm scope code conduct appli within project space public space individu repres project commun exampl repres project commun includ use offici project email address post via offici social media account act appoint repres onlin offlin event represent project may defin clarifi project maintain enforc instanc abus harass otherwis unaccept behavior may report contact project team foremanmackeygmailcom complaint review investig result respons deem necessari appropri circumst project team oblig maintain confidenti regard report incid detail specif enforc polici may post separ project maintain follow enforc code conduct good faith may face temporari perman repercuss determin member project leadership attribut code conduct adapt contributor covenanthomepag version avail httpswwwcontributorcovenantorgversioncodeofconducthtml homepag httpswwwcontributorcovenantorg answer common question code conduct see httpswwwcontributorcovenantorgfaq contribut exoplanet report issu find bug unexpect behavior use exoplanet open issu github repositoryhttpsgithubcomexoplanetdevexoplanetissu tri respond hope solv problem time manner similarli featur request question librari best place post current github issu like chang user commun grow report issu pleas give detail need reproduc problem version exoplanet depend platform small standalon piec code demonstr problem clearli contribut code welcom contribut codebas scale typo fix new featur would like add substanti featur would good idea first open issu describ plan discuss advanc detail process contribut found develop doc httpsdocsexoplanetcodesenstableuserdev name bug report creat report help us improv titl label bug assigne describ bug clear concis descript bug reproduc section includ simpl standalon code snippet demonstr issu expect behavior clear concis descript expect happen setup pleas complet follow inform version exoplanet oper system python version instal method pip conda etc addit context add context problem name featur request suggest idea project titl label enhanc assigne featur request relat problem pleas describ clear concis descript problem ex im alway frustrat describ solut youd like clear concis descript want happen describ altern youv consid clear concis descript altern solut featur youv consid addit context add context screenshot featur request titl exoplanet gradientbas probabilist infer exoplanet data astronom time seri tag python astronomi author name daniel foremanmackey orcid affili name rodrigo luger orcid affili name eric agol orcid affili name thoma barclay orcid affili name luke g bouma orcid affili name timothi brandt orcid affili name ian czekala orcid affili name trevor j david orcid affili name jiayin dong orcid affili name emili gilbert orcid affili name tyler gordon orcid affili name christina hedg orcid affili name daniel r hey orcid affili name brett morri orcid affili name adrian pricewhelan orcid affili name arjun b savel orcid x affili affili name center comput astrophys flatiron institut new york ny usa index name virtual planetari laboratori univers washington seattl wa usa index name depart astronomi univers washington univers washington seattl wa usa index name center space scienc technolog univers maryland baltimor counti baltimor md usa index name depart astrophys scienc princeton univers princeton nj usa index name depart physic univers california santa barbara santa barbara ca usa index name depart astronomi astrophys pennsylvania state univers univers park pa usa index name center exoplanet habit world pennsylvania state univers univers park pa usa index name center astrostatist pennsylvania state univers univers park pa usa index name institut comput data scienc pennsylvania state univers univers park pa usa index name depart astrophys american museum natur histori new york ny usa index name depart astronomi astrophys univers chicago chicago il usa index name nasa ame research center moffett field ca usa index name bay area environment research institut moffett field ca usa index name sydney institut astronomi school physic univers sydney camperdown new south wale australia index name stellar astrophys centr depart physic astronomi aarhu univers aarhu denmark index name center space habit univers bern bern switzerland index name depart astronomi univers maryland colleg park md usa index date april bibliographi paperbib summari exoplanet toolkit probabilist model astronom time seri data focu observ exoplanet use pymc pymc pymc flexibl highperform modelbuild languag infer engin scale well problem larg number paramet exoplanet extend pymc model languag support mani custom function probabl distribut requir fit exoplanet dataset astronom time seri use applic studi stellar variabl eg gillen medina primari purpos exoplanet character exoplanet eg gilbert plavchan multiplestar system eg czekala use timeseri photometri astrometri andor radial veloc particular typic use case would use one dataset place constraint physic orbit paramet system planet mass orbit period simultan take account effect stellar variabl statement need timedomain astronomi prioriti observ astronom commun huge survey dataset current avail forthcom within research domain signific invest discoveri character exoplanet planet orbit star sun dataset larg scale hundr thousand observ per star spacebas observatori _kepler_ _tess_ research question becom ambiti term comput cost physic model flexibl model packag _exoplanet_ ecosystem design enabl rigor probabilist infer larg dataset highdimension model provid highperform welltest infrastructur integr model modern model framework pymc sinc initi releas end exoplanet wide use citat zenodo record zenodo far _exoplanet_ softwar ecosystem besid primari exoplanet packag _exoplanet_ ecosystem project includ sever librari paper describ primari refer full suit packag follow provid short descript librari within ecosystem discuss relat exoplanetexoplanet primari librari includ implement mani special function requir exoplanet data analysi includ spheric geometri comput orbit exoplanetspecif distribut eccentr kippingb vaneylen limb darken kip exposuretim integr limbdarken transit light curv exoplanetcoreexoplanetcor provid effici welltest differenti implement exoplanetspecif oper must compil perform includ effici solver kepler equat base algorithm propos raposo limb darken transit light curv agol besid implement pymc exoplanetcor includ implement numpi numpi jax jax celeritecelerit updat implement _celerite_ algorithmcelerit foremanmackey foremanmackey scalabl gaussian process regress time seri data like exoplanetcor celerit includ support numpi jax pymc well recent gener _celerite_ algorithm gordon pymcextpymcext includ set helper function make pymc amen typic astronom data analysi workflow exampl provid tune schedul pymc sampler base method use stan project describ carpent provid better perform model correl paramet reboundpymcreboundpymc provid interfac _rebound_ rein _reboundx_ tamayo pymc enabl infer full nbodi orbit integr document case studi main document page _exoplanet_ librari live docsexoplanetcodeshttpsdocsexoplanetcod host readthedocshttpsreadthedocsorg tutori includ document automat execut everi push pull request github repositori goal ensur tutori alway compat current version code celerit project document page celeritereadthedocsiohttpsceleritereadthedocsio tutori similarli automat execut alongsid document page parallel case studi websit galleryexoplanetcodeshttpsgalleryexoplanetcod includ detail exampl use case exoplanet librari describ like tutori document page case studi automat execut use github action lower cadenc week new releas exoplanet librari made sinc runtim much longer autoreffigfigur show result two exampl case studi demonstr potenti use case exoplanet softwar ecosystem exampl dataset fit use exoplanet full analys behind exampl avail case studi page jupyt notebook left fit light curv transit exoplanet observ two differ spacebas photometr survey kepler tess right phasefold radial veloc time seri exoplanet observ differ observatori differ instrument fit simultan use exoplanet labelfigfigurefiguresfigurepng similar tool rich ecosystem tool avail infer model one support exoplanet tool set strength limit make detail comparison worth list tool situat exoplanet context popular tool space includ note far comprehens list exofast eastman eastman radvel fulton juliet espinoza exostrik trifonov pyaneti barragan allesfitt guenther orbit blunt similar tool also exist model observ eclips binari system includ jktebop southworth eb irwin phoeb conroy packag focu provid highlevel interfac design model execut fit contrast exoplanet design lower level conceptu similar tool like batman kreidberg pytransit parviainen ldtk parviainenb ellc maxt starri luger limbdarkjl agol provid build block evalu model requir infer exoplanet dataset fact sever higherlevel packag list includ lowerlevel librari depend hope exoplanet could provid backend futur highlevel librari emphas titl paper main sell point exoplanet compar tool space support differenti compon model design integr seamlessli aesara aesara automat differenti framework use pymc worth note aesara previous known theano theano name sometim use interchang pymc exoplanet documentationtheanoaesara allow use modern infer algorithm uturn sampl hoffman automat differenti variat infer kucukelbir algorithm comput conceptu advantag infer method use gradient especi highdimension model comput gradient also use model optim necessari say search new exoplanet map degeneraci multipl mode posterior estim uncertainti hessian care taken provid gradient numer stabl accur faster evalu finitediffer gradient acknowledg would like thank astronom data group flatiron listen everi iter project provid great feedback everi step way research partial conduct _exostar_ program _kavli institut theoret physics_ uc santa barbara support part nation scienc foundat grant nsf phi besid softwar cite exoplanet also built top arviz arviz astropi astropi astropi refer exoplanet httpsgithubcomexoplanetdevexoplanethttpsgithubcomexoplanetdevexoplanet exoplanetcor httpsgithubcomexoplanetdevexoplanetcorehttpsgithubcomexoplanetdevexoplanetcor celerit httpsceleritereadthedocsiohttpsceleritereadthedocsio celerit httpsceleritereadthedocsiohttpsceleritereadthedocsio pymcext httpsgithubcomexoplanetdevpymcexthttpsgithubcomexoplanetdevpymcext reboundpymc httpsgithubcomexoplanetdevreboundpymchttpsgithubcomexoplanetdevreboundpymc theanoaesara inform distinct avail httpsdocsexoplanetcodesenstableusertheanohttpsdocsexoplanetcodesenstableusertheano jupytext text_represent extens md format_nam myst format_vers jupytext_vers kernelspec display_nam python languag python name python light travel time delay codecel nbsphinx hidden import exoplanet exoplanetutilsdocs_setup printfexoplanet__version__ exoplanet__version__ simpl exampl show effect light travel time delay edgeon planet orbit similar earth codecel import matplotlibpyplot plt import numpi np astropi import unit u import exoplanet xo let instanti orbit correspond massless earth orbit sun circular orbit view edgeon codecel orbit xoorbitskeplerianorbit period incl nppi ecc omega omega m_planet m_star r_star observ coordin system earth seen transit sun x posit zero specifi refer transit time let check inde case comput time closest point x codecel nplinspac x z orbitget_planet_positiont t_ob tnpargminnpabsxev printfformatt_ob surpris happen add light travel time delay mix codecel x z orbitget_planet_positiont light_delaytru t_ob tnpargminnpabsxev printfformatt_ob recal time day default let see minut codecel printfformatt_ob udaytouminut account light travel time delay earth appear transit sun earli minut exoplanet refer time specifi rel origin coordin system case posit sun check fact light travel time sun earthhttpsimagegsfcnasagovpoetryvenusqhtml sinc transit happen earli might guess opposit true secondari eclips appear occur late let check absent time delay center eclips occur x half period transit codecel nplinspac orbitperiodev orbitperiodev x z orbitget_planet_positiont t_ob tnpargminnpabsxev printfformatt_ob codecel x z orbitget_planet_positiont light_delaytru t_ob tnpargminnpabsxev printfformatt_ob differ two codecel printfformatt_ob t_ob udaytouminut expect exampl here comparison transit light curv includ light travel delay one doesntt codecel region around transit nplinspac light delay light_curv xolimbdarklightcurv get_light_curveorbitorbit r tt eval light delay light_curv xolimbdarklightcurv get_light_curveorbitorbit r tt light_delaytru eval plot fig pltfigurefigs pltplott light_curv labelno delay pltplott light_curv labelwith delay pltxlabeltim day pltylabelrel flux pltlegendfonts loclow right _ plttitl light delay caus transit occur minut earli fontsiz jupytext text_represent extens md format_nam myst format_vers jupytext_vers kernelspec display_nam python languag python name python tutori follow tutori automat execut everi chang code make sure alway date code result design requir rel small amount comput time use exoplanet research probabl find runtim longer indepth tutori realworld applic real data check case studi pagehttpsgalleryexoplanetcod top tutori youll find cell like follow indic version exoplanet use gener tutori codecel import exoplanet exoplanetutilsdocs_setup printfexoplanet__version__ exoplanet__version__ cell also includ call exoplanetutilsdocs_setup function squash warn gener caus theanoaesara see reftheano info set matplotlib style exectut tutori click button top right page launch notebook use binderhttpsmybinderorg download ipynb file directli codecel jupytext text_represent extens md format_nam myst format_vers jupytext_vers kernelspec display_nam python languag python name python autodiff automat different gradientbas infer codecel import exoplanet exoplanetutilsdocs_setup printfexoplanet__version__ exoplanet__version__ major sell point exoplanet compar similar librari integr pymc probabilist model framework pymc offer gradientbas infer algorithm comput effici per effect sampl tool commonli use probabilist infer astrophys write gradientbas infer methodolog wide use astro difficult comput relev gradient deriv log probabl function respect paramet pymc mani framework like handl issu use automat differenti adhttpsenwikipediaorgwikiautomatic_differenti method collect method automat propag deriv code beyond scope tutori go mani detail ad user exoplanet shouldnt need interact much least give littl tast kind thing ad demonstr translat effici infer probabilist model main thing want emphas ad symbol differenti go provid mathemat express gradient also numer method like finit differencehttpsenwikipediaorgwikifinite_differ use ad evalu gradient model gener faster effici numer stabl altern alway except rule time provid ad framework custom implement andor different rule particular function benefici term cost stabil exoplanet design provid custom implement use eg solv kepler equat evalu limbdarken light curv reli exist ad toolkit elsewher automat different theanoaesara let start give quick tast ad work context pymc exoplanet pymc built top librari call aesara formerli theano see reftheano design ad fast linear algebra context neural network learn curv steep code end look littl differ usual way would write python code your look someth python jaxhttpsgithubcomgooglejax might good altern purpos well stick aesara aesara start defin relationship variabl ask evalu variabl use graph might seem littl counterintuit hope wont worri much handi workflow aesara compil optim model background gener make faster structur allow us evalu deriv variabl respect anoth here simpl exampl defin relationship two variabl x expleftsinleftfracpixrightright calcul deriv use ad comparison symbol deriv fracmathrmdymathrmdx fracpiexpleftsinleftfracpixrightrightcosleftfracpixright codecel import numpi np import matplotlibpyplot plt aesara_theano_fallback import aesara import aesara_theano_fallbacktensor defin relationship two variabl x yfx x_ atvectorx y_ atexpatsin nppi x_ aesara compil function evalu func aesarafunctionx_ y_ request gradient respect x note call sum bit cheat sinc default aesara comput gradient scalar function grad aesarafunctionx_ aesaragradatsumy_ x_ plot function deriv x nplinspac pltplotx funcx k lw labelfx pltplotx gradx c labeldfxdx ad lw overplot symbol deriv comparison pltplot x nppi funcx npco nppi x c lw labeldfxdx symbol pltlegend plttitlea silli function deriv pltylabelfx dfxdx _ pltxlabelx exampl obvious pretti artifici think imagin someth like would start come handi model get complic particular think youll probabl pretti regularli find experi differ choic paramet would real pain requir rewrit deriv code everi new choic parameter gradientbas infer way easili evalu deriv scalar function wide array new infer algorithm dispos exampl use aesara evalu log probabl function could pass valu gradient scipyoptimizeminimizehttpsdocsscipyorgdocscipyreferencegeneratedscipyoptimizeminimizehtml order find maximum likelihood maximum posteriori paramet point exoplanet integr pymc provid implement variou gradientbas markov chain mont carlo mcmc method like hamiltonian mont carlohttpsenwikipediaorgwikihamiltonian_monte_carlo uturn samplinghttpsarxivorgab pymc also support gradientbas method variat inferencehttpsenwikipediaorgwikivariational_bayesian_method far exoplanet mostli use mcmc take look refintrotopymc specif introductori exampl use pymc mcmc gener motiv use pymc instead emceehttpsemceereadthedocsio dynestyhttpsdynestyreadthedocsio exampl far comput effici per effect sampl especi model coupl paramet go systemat studi rel perform differ method fraught problem specif let look anoth artifici exampl compar perform sampl dimension gaussian use pymc emceehttpsemceereadthedocsio codecel import time import emce import log import pymc pm import arviz az import pymc_ext pmx make pymc less noisi exampl logger logginggetloggerpymc loggersetlevelloggingerror first defin sampl model use pymc pmmodel model pmnormalx shape run fake chain get everyth compil pmsampl tune draw chain return_inferencedatatru progressbarfals run time sampl start timetim pymc_trac pmsampl tune draw chain core return_inferencedatatru progressbarfals pymc_tim timetim start comput cost per sampl pymc_per_eff pymc_tim npmeanazsummarypymc_traceess_bulk sampl model use emce func pmxget_theano_function_for_varmodellogpt modelmodel def logptheta return functheta init nprandomrandn modelndim nwalker ndim initshap sampler emceeensemblesamplernwalk ndim logp start timetim init samplerrun_mcmcinit samplerreset samplerrun_mcmcinit emcee_tim timetim start emcee_trac azfrom_emceesamplersampl emcee_per_eff emcee_tim npmeanazsummaryemcee_traceess_bulk run chain compar rel perform rememb artifici exampl caveat small print yadda etc compar perform differ mcmc sampler best metric comput cost per effect sampl parameterfunct care case well look total runtim includ burnin divid estaimt mean effect sampl size across dimens lower better codecel print ffor pymc runtim per effect sampl pymc_per_eff ef ms print ffor emce runtim per effect sampl emcee_per_eff ef ms case pymc order magnitud effici model get complex term comput cost number paramet geometri paramet space mileag might vari experi use pymc almost alway good idea tip find model sampl well almost alway caus parameter issu youll probabl get drastic better perform reparameter see refreparameter tip trick codecel jupytext text_represent extens md format_nam myst format_vers jupytext_vers kernelspec display_nam python languag python name python reparameter reparameter one thing youll often find use exoplanet pymc librari gradientbas infer perform infer quit sensit parameter problem exampl might see warn pymc tell consid reparameter model diverg wors might find sampl unreason slow number effect sampl small issu almost alway solv investig sourc nonlinear degeneraci paramet model heavi tail posterior densiti stan user guidehttpsmcstanorgdocs_stanusersguidereparameterizationsectionhtml includ gener advic reparameter use place start ive found best choic tend pretti problem specif throughout tutori case studieshttpsgalleryexoplanetcod tri select sensibl parameter sometim mani experi comment wherev weve chosen someth nonstandard trickiest paramet thing like orbit eccentr inclin angl case eccentr sometim reparameter term observ transit durat see quick fit tess light curv case studi angl sometim better parameter term sum differ pair angl see exampl refdataandmodelsastrometri demo learn gener advic reparameter exoplanet model ill tri keep page updat meantim feel free start discuss github repositoryhttpsgithubcomexoplanetdevexoplanetdiscuss discov particularli good tricki parameter problem codecel jupytext text_represent extens md format_nam myst format_vers jupytext_vers kernelspec display_nam python languag python name python dataandmodel data model codecel import exoplanet exoplanetutilsdocs_setup printfexoplanet__version__ exoplanet__version__ tutori provid overview kind dataset exoplanet design model worth note certainli comprehens list exoplanet design lowlevel librari built top support new use case tip real world use case exampl check case studieshttpsgalleryexoplanetcod page overview one primari interfac exoplanet via classexoplanetorbitskeplerianorbit object gener like classexoplanetorbitsttvorbit keplerianorbit object defin set independ possibl massiv bodi orbit central bodi keplerian trajectori orbit parameter orbit element one primari use exoplanet measur orbit element given observ given keplerianorbit user exoplanet evalu thing like posit veloc bodi function time exampl here could defin orbit singl bodi plot orbit codecel import numpi np import matplotlibpyplot plt import exoplanet xo defin orbit orbit xoorbitskeplerianorbit period time day incl nppi angl radian ecc omega omega m_planet mass distanc solar unit get posit veloc function time nplinspac x z orbitget_relative_positiont vx vy vz orbitget_star_velocityt plot coordin note use eval throughout sinc coordin aesaratheano object fig axe pltsubplot figsiz sharextru ax axe axplott xeval labelx axplott yeval labe axplott zeval labelz axset_ylabelposit orbit bodi r_ axlegendfonts loc ax axe axplott vxeval labelv_x axplott vyeval labelv_i axplott vzeval labelv_z axset_xlimtmin tmax axset_xlabeltim day axset_ylabelveloc central r_day _ axlegendfonts loc key fetur exoplanet paramet keplerianorbit pymc variabl mean element someth infer exampl want fit orbit period defin pymc model like follow codecel import pymc pm pmmodel log_period pmnormallog_period munplog sigma orbit xoorbitskeplerianorbit periodpmmathexplog_period defin rest model use orbit follow section go specif way might use orbit defin model first orbit convent orbit convent orbit specifi respect singl central bodi gener massiv bodi system noninteract bodi orbit central good parameter exoplanetari system binari star sometim suffici system multipl massiv bodi interact import dynam follow set intern consist orbit convent also attempt respect mani establish convent stellar exoplanetari field possibl locat bodi keplerian orbit respect center mass given perifoc plane boldsymbolr left beginarrayc x z endarray right construct orbit bodi perifoc frame constrain entir x plane shown figur orbit geometry_staticorbitdpng rang orbit convent choic mainli stem locat bodi perifoc frame convert observ frame boldsymbolr left beginarrayc x z endarray right choos orient hatboldsymbolx unit vector north direct hatboldsymboli east direct hatboldsymbolz toward observ convent inclin orbit defin dotproduct orbit angular momentum vector hatboldsymbolz conform common astrometr convent zero inclin orbit faceon test bodi orbit counterclockwis manner around primari bodi stellar exoplanetari field less agreement segment line node defin ascend node choos defin ascend node point orbit bodi cross plane sky move away observ ie cross z z convent histor choic visual binari field opposit convent occasion appear exoplanet planetari studi implement transform perifoc frame observ frame consid rotat matric boldsymbolp_xphi left beginarrayccc co phi sin phi sin phi co phi endarrayright boldsymbolp_z phi left beginarrayccc co phi sin phi sin phi co phi endarrayright result clockwis rotat axe defin use right hand rule mean look zaxi posit angl phi would x axe rotat clockwis order find defin counterclockwis consid rotat look right hand rule cross product axe unit vector sinc hatboldsymbolx time hatboldsymboli hatboldsymbolz look z axi direct xaxi toward yaxi defin counter clockwis similarli hatboldsymboli time hatboldsymbolz hatboldsymbolx hatboldsymbolz time hatboldsymbolx hatboldsymboli convert posit boldsymbolr perifoc frame observ frame boldsymbolr referenc figur three rotat requir rotat zaxi angl omega xaxi coincid line node ascend node ii rotat xaxi angl two plane coincid final iii rotat zaxi angl omega appli rotat matric yield boldsymbolr boldsymbolp_z omega boldsymbolp_xi boldsymbolp_zomega boldsymbolr function true anomali f posit observ frame given beginarraylc x r co omega co omega co f sin omega sin f sin omega co sin omega co f co omega sin f r sin omega co omega co f sin omega sin f co omega co isin omega co f co omega sin f z r sin sin omega co f co omega sin f endarray simplifi equat use sum angl ident find beginarraylc x r co omega cosomega f sinomega sinomega f cosi r sin omega cosomega f cosomega sinomega f cosi z r sinomega f sini endarray central bodi defin two radiu r_star mass m_star densiti rho_star third physic paramet alway comput use two exoplanet throw error three given even numer selfconsist orbit typic defin check docstr classexoplanetorbitskeplerianorbit option period p semimajor axi orbit time conjunct t_ time periastron passag t_mathrmp planet radiu r_mathrmpl mass m_mathrmpl eccentr e argument periastron omega longitud ascend node omega inclin orbit plane impact paramet b keplerianorbit object exoplanet alway fulli specifi exampl orbit defin use period p semimajor axi comput use kepler third law dataandmodelsrv radial veloc classexoplanetorbitskeplerianorbit use comput expect radial veloc time seri given set paramet one typic parameter radial veloc fit would look someth like codecel import arviz az import pymc_ext pmx import aesara_theano_fallbacktensor tt creat dummi dataset random nprandomdefault_rng t_plot nplinspac npsortrandomuniform rv_err npzeros_liket rv_ob npsin nppi npsqrt rv_err randomnormalsizel pmmodel period semiamplitud eccentr log_period pmnormallog_period munplog sigma period pmdeterministicperiod ttexplog_period log_semiamp pmnormallog_semiamp munplog sd semiamp pmdeterministicsemiamp ttexplog_semiamp ecc pmuniformecc lower upper low eccentr omega phase periastron phi correl best fit omega phi plu pmxangleplu minu pmxangleminu phi pmdeterministicphi plu minu omega pmdeterministicomega plu minu nonzero eccentr sometim better use sqrtesinomega sqrtecosomega paramet ec pmxunitdiskec testval npone ecc pmdeterministicecc ttsumec axi omega pmdeterministicomega ttarctanec ec phi pmxanglephi jitter system mean veloc offset log_jitt pmnormallog_jitt munplog sd zero_point pmnormalzero_point mu sd defin orbit tperi pmdeterministictperi period phi nppi orbit xoorbitskeplerianorbit periodperiod t_periastrontperi eccecc omegaomega defin rv model rv_model zero_point orbitget_radial_velocityt ksemiamp final add observ model err ttsqrtrv_err ttexp log_jitt pmnormalob murv_model sigmarv_err observedrv_ob well also track model plot purpos pmdeterminist rv_plot zero_point orbitget_radial_velocityt_plot ksemiamp soln pmxoptimizevarsplu minu ecc soln pmxoptimizesoln trace pmxsampl tune draw core chain startsoln return_inferencedatatru plot result rv_plot traceposteriorrv_plotvalu q q q nppercentilerv_plot axi plterrorbart rv_ob yerrrv_err fmtk labeldata pltplott_plot q pltfill_betweent_plot q q alpha labelposterior pltxlim pltlegendfonts loc pltxlabeltim day pltylabelradi veloc ms azsummarytrac var_namesrv_plot filter_varsregex instead use semiamp paramet could pass m_planet incl paramet keplerianorbit fit physic orbit similarli joint fit transit light curv see refdataandmodelscombin could parameter term time refer transit instead phase periastron mention comment discuss refreparameter perform fit problem specif depend choic paramet therefor often worthwhil experi differ parameter good place start radial velocityonli fit dataandmodelsastrometri astrometri astrometr observ usual consist measur separ posit angl secondari star directli imag exoplanet rel primari star function time exoplanet could also use model motion center light unresolv orbit typic classexoplanetorbitskeplerianorbit definit astrometr dataset similar radial veloc fit codecel random nprandomdefault_rng t_plot nplinspac npsortrandomuniform rho_err randomuniform lent theta_err randomuniform lent pmmodel period semimajor axi eccentr log_period pmnormallog_period munplog sigma period pmdeterministicperiod ttexplog_period log_a pmnormallog_a munplog sd pmdeterministica ttexplog_a ecc pmuniformecc lower upper tperi pmnormaltperi mu sigma astrometr orbit good choic parameter omega omega plu pmxangleplu minu pmxangleminu omega pmdeterministicomega plu minu omega pmdeterministicomega plu minu well use uniform prior cosincl cos_incl pmuniformcos_incl lower upper testval incl pmdeterministicincl ttarccoscos_incl defin orbit orbit xoorbitskeplerianorbit aa t_periastrontperi periodperiod inclincl eccecc omegaomega omegaomega defin rv model rho_model theta_model orbitget_relative_anglest simul data model test remov follow line code rho_ob theta_ob pmxeval_in_modelrho_model theta_model rho_ob rho_err randomnormalsizel theta_ob theta_err randomnormalsizel end simul data defin observ model simpl rho pmnormalrho_ob murho_model sdrho_err observedrho_ob want cogniz fact theta wrap follow equival pmnormalobs_theta mutheta_model observedtheta_ob sdtheta_err take account wrap theta_diff ttarctan ttsintheta_model theta_ob ttcostheta_model theta_ob pmnormaltheta_ob mutheta_diff sdtheta_err observ well also track model plot purpos rho_plot theta_plot orbitget_relative_anglest_plot pmdeterministicrho_plot rho_plot pmdeterministictheta_plot theta_plot trace pmxsampl tune draw core chain target_accept return_inferencedatatru plot result fig ax ax pltsubplot figsiz sharextru q q q nppercentil traceposteriorrho_plotvalu axi axerrorbart rho_ob yerrrho_err fmtk labeldata axplott_plot q axfill_betweent_plot q q alpha labelposterior axset_ylabelrrho arcsec q q q nppercentil traceposteriortheta_plotvalu axi axerrorbart theta_ob yerrrho_err fmtk labeldata axplott_plot q axfill_betweent_plot q q alpha labelposterior axset_xlimt_plotmin t_plotmax axlegendfonts loc axset_ylabelrtheta radian axset_xlabeltim day comput converg stat azsummarytrac var_names_plot filter_varsregex exampl unit arcsecond funcexoplanetorbitskeplerianorbitget_relative_angl function accept parallax argument constraint parallax system provid parallax argument provid usual unit solar radii dataandmodelstransit transit occult eclips exoplanet built support evalu quadrat limb darken light curv model use algorithm agol et al httpsarxivorgab need flexibl surfac model higher order limb darken check starri packagehttpsstarryreadthedocsio also integr pymc transit occult model one primari applic exoplanet quit option includ transit time variat detach eclips binari model much highlight case studieshttpsgalleryexoplanetcod page breadandbutt transit model implement exoplanet might look someth like follow codecel random nprandomdefault_rng num_transit nparang yerr e pmmodel baselin flux mean pmnormalmean mu sigma often best parameter actual term time two refer transit rather period pmnormalt mu sigma pmnormalt mu sigma period pmdeterministicperiod num_transit kip parameter quadrat limb darken paramt u xodistributionsquadlimbdarku testvalnparray radiu ratio impact paramet paramet introduc pretti seriou covari ripe reparameter log_r pmnormallog_r munplog sigma r pmdeterministicr ttexplog_r b xodistributionsimpactparameterb rorr testval set keplerian orbit planet orbit xoorbitskeplerianorbitperiodperiod tt bb comput model light curv note index use sinc get_light_curv return object shape n_time n_planet light_curv xolimbdarklightcurveu uget_light_curv orbitorbit rr tt mean track valu model light curv plot purpos pmdeterministiclight_curv light_curv simul data model test remov follow line code pmxeval_in_modellight_curv yerr randomnormalsizeleni end simul data likelihood function assum known gaussian uncertainti pmnormalob mulight_curv sdyerr observedi trace pmxsampl tune draw core chain return_inferencedatatru plot result q q q nppercentil traceposteriorlight_curvevalu axi pltplott k ms labeldata pltplott q pltfill_betw q q alpha labelposterior pltxlim pltlegendfonts loc pltxlabeltim day pltylabelrel flux comput converg stat azsummarytrac var_nameslight_curv filter_varsregex dataandmodelscombin combin dataset sinc exoplanet built top pymc capac support essenti arbitrariliy complic model mean share paramet fit multipl dataset howev want wont go mani detail see exampl case studieshttpsgalleryexoplanetcod joint transitradi veloc fit infer base dataset multipl instrument basic idea behind simultan fit multipl dataset youll need defin relationship dataset perhap share paramet share keplerianorbit youll includ likelihood dataset model exampl line like python pmnormalob murv_model sigmarv_err observedrv_ob model defin gaussian likelihood condit observ data combin dataset simpli add multipl line like one dataset behind scene pymc multipli likelihood actual add logarithm concret exampl check case studieshttpsgalleryexoplanetcod that suffici feel free start discuss github repositoryhttpsgithubcomexoplanetdevexoplanetdiscuss ask help codecel jupytext text_represent extens md format_nam myst format_vers jupytext_vers kernelspec display_nam python languag python name python cite exoplanet depend _exoplanet_ packag mostli glue connect mani idea softwar situat like easi forget import infrastructur upon scienc built order make sure easili give credit credit due tri make painless possibl work citat expect model fit use _exoplanet_ includ funcexoplanetcitationsget_citations_for_model function introspect current pymc model construct list citat function use model exampl might comput quadrat limb darken light curv use starri via classexoplanetlimbdarklightcurv class codecel import pymc pm import exoplanet xo pmmodel model u xodistributionsquadlimbdarku orbit xoorbitskeplerianorbitperiod light_curv xolimbdarklightcurveu u transit light_curveget_light_curv orbitorbit txt bib xocitationsget_citations_for_model funcexoplanetcitationsget_citations_for_model function would gener acknowledg cite pymchttpsdocspymciocitingpymc infer engin model framework theanoaesarahttpsaesarareadthedocsioenlatestcitationhtml numer infrastructur astropyhttpwwwastropyorgacknowledginghtml unit constant kip httpsarxivorgab reparameter limb darken paramet quadrat law luger et al httpsarxivorgab light curv calcul first output funcexoplanetcitationsget_citations_for_model give acknowledg text codecel printtxt second output string bibtex entri citat acknowledg text codecel printbibsplitnn nn codecel jupytext encod code utf text_represent extens md format_nam myst format_vers jupytext_vers kernelspec display_nam python languag python name python introtopymc quick intro pymc codecel import exoplanet exoplanetutilsdocs_setup printfexoplanet__version__ exoplanet__version__ gradientbas infer method like hamiltonian mont carlo hmchttpsenwikipediaorgwikihamiltonian_monte_carlo havent wide use astrophys standard method probabilist infer use markov chain mont carlo mcmc mani field exoplanet design provid build block fit mani exoplanet dataset use technolog tutori present basic featur pymchttpsdocspymcio model languag infer engin document pymchttpsdocspymcio includ mani tutori check get familiar featur avail tutori go two simpl exampl fit data use pymc first classic fit line data unknown error bar second relev exampl fit radial veloc model public radial veloc observ peghttpsenwikipediaorgwiki_pegasi read fit line data bibl line fittinghttpsarxivorgab see anoth exampl fit peg data use hmc time use stanhttpmcstanorg herehttpsdfmiopostsstanc hello world aka fit line data standard intro new model languag infer framework fit line data let pymc start well gener fake data use linear model feel free chang random number seed tri differ dataset codecel import numpi np import matplotlibpyplot plt nprandomse true_m true_b true_log nplog x npsortnprandomuniform true_b true_m x npexptrue_log nprandomrandnlenx pltplotx k pltylim pltxlabelx _ pltylab fit model data model paramet slope intercept b log uncertainti logsigma start let choos broad uniform prior paramet begineqnarray pm leftbeginarrayl mathrmif mathrmotherwis endarrayright pb leftbeginarrayl mathrmif b mathrmotherwis endarrayright plogsigma leftbeginarrayl mathrmif logsigma mathrmotherwis endarrayright endeqnarray loglikelihood function log py_nmblogsigma fracsum_nn leftfracy_n mx_n bsigma logpisigmaright note second normal term need model fit sigma second term constant anoth way write model might familiar follow begineqnarray sim mathrmuniform b sim mathrmuniform logsigma sim mathrmuniform y_n sim mathrmnormalmx_nbsigma endeqnarray way model like often defin statist use implement model pymc take moment make sure understand notat let implement model pymc document distribut avail pymc model languag found herehttpsdocspymcioapidistributionscontinuoushtml come handi go write model codecel import pymc pm pmmodel model defin prior paramet pmuniformm lower upper b pmuniformb lower upper log pmuniformlog lower upper defin likelihood comment mathemat oper like exp cant use numpi instead use mathemat oper defin pmmath condit data use observ keyword argument distribut case want use normal distribut look doc pmnormalob mum x b sdpmmathexplog observedi sampl model take look doc see paramet avail trace pmsampl draw tune chain core return_inferencedatatru sinc sampl let make diagnost plot first plot look traceplot implement pymc plot youll see margin distribut paramet left trace plot paramet valu function step number right panel see two line differ color result differ independ chain result substanti differ differ chain probabl someth go wrong codecel import arviz az _ azplot_tracetrac var_namesm b log also good quantifi look substanti differ argument implement pymc summari function tabl key column look n_eff rhat n_eff show estim number effect independ sampl paramet case n_eff probabl around per chain chain run rhat show gelmanrubin statistichttpsdocspymcioapidiagnosticshtmlpymcdiagnosticsgelman_rubin close codecel azsummarytrac var_namesm b log last diagnost plot well make corner plot made use cornerpyhttpscornerreadthedocsio codecel import corner _ cornercorn trace truthsdictmtrue_m btrue_b logstrue_log extra credit suggest thing tri get familiar pymc tri initi paramet use testval argument distribut improv perform case substanti improv perform complic exampl tri chang prior paramet exampl tri uninform prior recommend jake vanderpla bloghttpjakevdpgithubioblogfrequentismandbayesianismbayesianinpythonprioronslopeandintercept happen substanti increas decreas simul nois perform chang significantli realist exampl radial veloc exoplanet exampl cute doesnt realli fulli exploit power pymc doesnt realli show real issu face use pymc astronom get better sens might use pymc real life let take look realist exampl fit keplerian orbit radial veloc observ one key aspect problem want highlight fact pymc underli model build framework theano recent renam aesarahttpsaesarareadthedocsio dont outofthebox support rootfind requir solv kepler equat part process comput keplerian rv model must solv equat e esin e eccentr anomali e given mean anomali eccentr e commonli accept method solv equat use newton methodhttpsenwikipediaorgwikinewtons_method want expos pymc defin custom theano operationhttpsaesarareadthedocsioenlatestextendingindexhtml custom gradient wont go detail math blog ithttpsdfmiopostsstanc wont go detail implement tutori well use custom kepler solver implement part exoplanet fit publicli avail radial veloc observ famou exoplanetari system peg use pymc first need download data exoplanet archiv codecel import request import panda pd import matplotlibpyplot plt download dataset exoplanet archiv url httpsexoplanetarchiveipaccaltechedudataexodatadatauid__rvc_tbl r requestsgeturl rstatus_cod requestscodesok rraise_for_statu data nparray lsplit l rtextsplitlin lstartswith lstartswith dtypefloat rv rv_err datat npmeant plot observ fold publish period butler et al httpsarxivorgabsastroph lit_period plterrorbar lit_period lit_period rv yerrrv_err fmtk capsiz pltxlim pltylim pltannot period f daysformatlit_period xy xycoordsax fraction xytext textcoordsoffset point haright vabottom fontsiz pltylabelradi veloc ms _ pltxlabelphas here implement radial veloc model pymc look familiar hello world exampl thing bit complic take minut take look see follow there lot go want point thing pay attent mathemat oper exampl exp sqrt perform use theanoaesara see reftheano instead numpi paramet initi guess provid exampl make big differ paramet like period tightli constrain line wrap determinist distribut use allow us track valu chain progress even theyr paramet exampl sampl sampl bkg background rv trend step chain especi use make plot result similarli end model definit comput rv curv singl orbit fine grid use diagnos fit gone wrong paramet specifi angl like omega call w model ineffici sampl angl directli fact valu wrap around pi instead better sampl unit vector specifi angl paramet unit disk combin eccentr practic achiev sampl vector isotrop gaussian normal compon norm implement pymcexthttpsgithubcomexoplanetdevpymcext packag codecel import pymc_ext pmx import aesara_theano_fallbacktensor tt import exoplanet xo pmmodel model paramet logk pmuniform logk lower uppernplog testvalnplog npmaxrv npminrv logp pmuniform logp lower uppernplog testvalnploglit_period phi pmuniformphi lower upper nppi testval parameter eccentr use h sqrte sinw k sqrte cosw hk pmxunitdiskhk testvalnparray e pmdeterministic hk hk w pmdeterministicw ttarctanhk hk rv pmnormalrv mu sd testval rvtrend pmnormalrvtrend mu sd testval determinist transform n nppi ttexplogp p pmdeterministicp ttexplogp k pmdeterministick ttexplogk cosw ttcosw sinw ttsinw phi w n rv model bkg pmdeterministicbkg rv rvtrend n phi w line use custom kepler solver f xoorbitsget_true_anomalym e ttzeros_likem rvmodel pmdeterminist rvmodel bkg k cosw ttcosf e sinw ttsinf condit observ pmnormalob murvmodel sdrv_err observedrv comput phase rv signal phase nplinspac m_pred nppi phase phi w f_pred xoorbitsget_true_anomalym_pr e ttzeros_likem_pr rvphase pmdeterminist rvphase k cosw ttcosf_pr e sinw ttsinf_pr case ive found use first optim paramet find maximum posteriori map paramet start sampler use mcmc design find maximum posterior meant sampl shape posterior perform mcmc method realli bad initi isnt good especi paramet well constrain find maximum posteriori paramet use pymc use optim function pymcexthttpsgithubcomexoplanetdevpymcext codecel model map_param pmxoptim let make plot check initi look reason top plot look rv observ function time initi guess longterm trend overplot blue lower panel plot fold curv wrap observ onto bestfit period predict singl overplot orang doesnt look good tri adjust initi guess paramet see get better fit exercis tri chang initi guess paramet specifi testval argument see sensit result valu paramet less import codecel fig axe pltsubplot figsiz period map_paramsp ax axe axerrorbart rv yerrrv_err fmtk axplott map_paramsbkg colorc lw axset_ylim axset_ylabelradi veloc ms axset_xlabeltim day ax axe axerrorbart period rv map_paramsbkg yerrrv_err fmtk axplotphas period map_paramsrvphas colorc lw axset_ylim axset_ylabelradi veloc ms axset_xlabelphas day plttight_layout let sampl posterior start map estim use sampl routin pymcexthttpsgithubcomexoplanetdevpymcext wrap pymc function better default codecel model trace pmxsampl draw tune startmap_param chain core target_accept return_inferencedatatru alway good idea take look summari statist chain everyth went plan effect sampl per chain rhat valu close bad second run time codecel azsummari trace var_nameslogk logp phi e w rv rvtrend similarli make corner plot model codecel _ cornercornertrac var_namesk p e w final last plot well make posterior predict densiti case mean want look distribut predict model consist data top plot show raw observ black error bar rv trend model overplot blue time blue line actual compos line sampl posterior trend consist data bottom panel orang line indic posterior sampl rv curv one orbit codecel fig axe pltsubplot figsiz period map_paramsp ax axe axerrorbart rv yerrrv_err fmtk axset_ylabelradi veloc ms axset_xlabeltim day ax axe axerrorbart period rv map_paramsbkg yerrrv_err fmtk axset_ylabelradi veloc ms axset_xlabelphas day bkg traceposteriorbkgvalu rvphase traceposteriorrvphasevalu ind nprandomrandintnpprodbkgshap size npunravel_indexind bkgshape axesplott bkgi colorc lw alpha axesplotphas period rvphasei colorc lw alpha axesset_ylim axesset_ylim plttight_layout