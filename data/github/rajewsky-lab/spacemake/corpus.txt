hrefhttpspypiorgprojectspacemak img srchttpsimgshieldsiopypivspacemakesvg hrefhttpsspacemakereadthedocsio img srchttpsreadthedocsorgprojectsspacemakebadgeversionlatest hrefhttpspepytechprojectspacemak img srchttpspepytechbadgespacemak spacemak process analysi largescal spatial transcriptom data img srchttpsrawgithubusercontentcomrajewskylabspacemakemasterdocsgraphical_abstract_twitterpng width document found herehttpsspacemakereadthedocsioenlatest output html_document toc true toc_depth version author tama ryszard sztankatoth nikolao karaisko email tamasryszardsztankatothmdcberlind nikolaoskaraiskosmdcberlind licens gpl r knitr_opt includefals cachefals knitropts_chunkset autodep true messag fals warn fals comment na r load_librari echo f librarytidyvers libraryyaml librarycowplot libraryknitr librarygrid librarygt librarykableextra libraryp theme_settheme_cowplot r function echo f readstarlog functionlog_fil list line readlineslog_fil outinput_read line strsplitt unlist asinteg outuniq_mapped_read line strsplitt unlist asinteg outavg_length line strsplitt unlist asnumer tibbleobservationnamesout valueunlistunnameout r load_run_info echo f run_mode_set bind_rowssnakemakeparamsrun_mod nestumi_cutoff cumi_cutoff bind_colstibblerun_mod namessnakemakeparamsrun_mod gathervariable_nam valu run_mod spreadrun_mod valu run_mode_nam run_mode_set name sample_info bind_rowssnakemakeparamssample_info selectspeci sequencing_d investig experi uniqu gatherinfo_nam valu add_rowinfo_nam project_id valu snakemakewildcardsproject add_rowinfo_nam sample_id valu snakemakewildcardssampl add_rowinfo_nam puck_id valu snakemakewildcardspuck run inform r print_sample_info echo f sample_info kblcolnamesnul kable_classic_full_widthf positionleft satur analysi v gener r formatsystim dbi contact tamasryszardsztankatothmdcberlind nikolaoskaraiskosmdcberlind downstream stat r parse_metadata echo f val f eval f metadata readstarlogsnakemakeinputstar_log rbindread_tablesnakemakeinputreads_type_out col_namescobserv valu convert million mutatevalu roundvalu e mutat input_read filter observ input_readsvalu mutatelabel ifelseobserv input_read valu pastevalu roundvalueinput_read dplyrselectobserv label spreadobserv label dplyrrenameasutr utr intron intron intergen intergen ascd code reorder column dplyrselectinput_read uniq_mapped_read intergen intron ascd asutr kabl metadata satur analysi order know whether would gain sequenc deeper downsampl data finalbam file contain read creat digitalexpress matrix normal dropseq pipelin give us insight whether reach satur point term median umi per cell median gene per cell whether sequenc deeper result plot r read_summari echo f downsampled_summari snakemakeinputstartswithnamessnakemakeinput downsampl dge_data tibblenam namesdownsampled_summari filenam unlistdownsampled_summari separatenam cna run_mod percentag sep mutatecont mapfilenam read_csv mutatecell_bc ascharactercell_bc unnestcont selectfilenam renameumi total_count gene n_genes_by_count read n_read mutatepcr read umi r define_plotting_funct echo f cpalett listgrey light_orangeef light_blueb green e yellow fe blue b oranged pinkcca clr cumiscpalettelight_orang pcr cpalettelight_blu readscpalettegreen genescpalettepink n_bead black median_clr clr namesmedian_clr cpastemedian_ namesclr namesclr plot_observ functionmetr run_mode_in log_scal ttl pl dge_data filterrun_mod run_mode_in selectcell_bc percentag pcr umi read run_mod gatherob val umi pcr read filterob metric mutatepercentag asintegerpercentag filterpercentag c group_bypercentag ob run_mod filterbetweenv quantilev narmt quantilev narmt mutatepercentag factorpastepercentag level c ggplotaesv fill ob geom_dens facet_gridpercentagerun_mod scale free_i scale_fill_manualvalu clr labsxttl themelegendpositionnon stripbackgroundxelement_blank striptextx element_blank stripbackgroundi element_blank striptexti element_textangl axisticksi element_blank axistexti element_blank log_scal pl pl scale_x_log annotation_logtickssidesb returnpl plot_deciled_data functionrun_mode_in decile_dat dge_data filterrun_mod run_mode_in group_bypercentag mutatecumsum_read cumsumread decile_limit sumread put bead decil number read decil floorcumsum_read decile_limit get top decil artifact round last bead filterdecil group_bypercentag decil summarisemedian_read medianread median_gen mediangen median_pcr medianpcr median_umi medianumi n_bead n gatherobserv valu median_readsn_bead mutatedecil factordecil percentag asintegerpercentag observ factorobserv level c median_read median_umi median_gen median_pcr n_bead pl decile_dat ggplotaespercentag valu color decil fill decil geom_smoothformula ylogx size sef geom_points color black pch scale_x_continuousbreaksseq scale_fill_manualvaluesparula scale_color_manualvaluesparula facet_wrapobserv scale free ncol labsi xdownsampl percentag guidesfil guide_legendnrow byrowt overridea listsiz themelegendposit bottom stripbackground element_blank returnpl plot_data functionrun_mode_in obs_in obs_nam umi_cutoffc tibbleumi_cutoff umi_cutoff dat mapumi_cutoff filterdge_data umi unnestdat filterrun_mod run_mode_in group_bypercentag umi_cutoff summarisemedian_read medianread median_umi medianumi median_gen mediangen median_pcr medianpcr n_bead n gatherobserv valu median_readsn_bead as_tibbl mutatepercentag asintegerpercentag observ factorobserv level c median_read median_umi median_gen median_pcr n_bead mutateumi_cutoff factorumi_cutoff filterobserv obs_in ggplotaespercentag valu color observ fillobserv linetypeumi_cutoff scale_color_manualvaluesmedian_clr scale_fill_manualvaluesmedian_clr geom_smoothformula ylogx size sef geom_points color black pch scale_x_continuousbreaksseq labelspasteseq labsyobs_nam xdownsampl percentag color fill linetypeumi cutoff themestripbackgroundelement_blank legendpositionbottom legendkeywidthunit cm guidescolour nonefillnon linetyp guide_legendnrow byrowt overridea listsiz histogram per run_mod tabset r plot_histogram_of_observ echo f figwidth figheightresultsasi run_mode_nam dge_data run_mod uniqu run_mode_in run_mode_nam umi_cutoff snakemakeparamsrun_modesrun_mode_inumi_cutoff catpastenn run_mode_in nn printplot_observationsumi run_mode_in ttl umi per spatial unit printplot_observationsread run_mode_in ttl read per spatial unit printplot_observationspcr run_mode_in log_scalef ttlread umi per spatial unit median plot per run_mod tabset r plot_median_values_of echo f figwidthfigheightresultsasi run_mode_nam dge_data run_mod uniqu run_mode_in run_mode_nam umi_cutoff snakemakeparamsrun_modesrun_mode_inumi_cutoff catpastenn run_mode_in nn printplot_datarun_mode_in obs_in median_read obs_nam median readsnper spatial unit umi_cutoff c umi_cutoff printplot_datarun_mode_in obs_in median_umi obs_nam median umisnp spatial unit umi_cutoff c umi_cutoff printplot_datarun_mode_in obs_in median_pcr obs_nam median readsumisnp spatial unit umi_cutoff c umi_cutoff decil median plot per run_mod tabset r plot_deciled_median_values_of echo f figwidthfigheightresultsasi run_mode_nam dge_data run_mod uniqu run_mode_in run_mode_nam umi_cutoff snakemakeparamsrun_modesrun_mode_inui_cutoff catpastenn run_mode_in nn printplot_deciled_datarun_mode_in output html_document toc true self_contain ye toc_float true toc_depth theme flatli highlight tango version author tama ryszard sztankatoth nikolao karaisko email tamasryszardsztankatothmdcberlind nikolaoskaraiskosmdcberlind licens gpl r knitr_opt includefals cachefals knitropts_chunkset autodep true messag fals warn fals comment na r librari includ f cachef librarytidyvers libraryyaml libraryknitr librarymagrittr librarykableextra librarycowplot theme_settheme_cowplot cpalett listorang de blue b green e black yellow fe grey light_orang ef light_blu readstarlog functionlog_fil list line readlineslog_fil outinput_read line strsplitt unlist asinteg outuniq_mapped_read line strsplitt unlist asinteg outmulti_mapped_read line strsplitt unlist asinteg outavg_mapped_length line strsplitt unlist asnumer outunmapped_too_short line strsplitt unlist asinteg tibbleobservationnamesout valueunlistunnameout r read_sample_information_t echo f run_mode_set bind_rowssnakemakeparamsrun_mod nestumi_cutoff cumi_cutoff bind_colstibblerun_mod namessnakemakeparamsrun_mod gathervariable_nam valu run_mod spreadrun_mod valu run_mode_nam run_mode_set name run_mode_n lengthrun_mode_nam normal_run_mode_nam run_mode_set gatherrun_modev variable_nam filtervariable_nam mesh_data unnestv filterv run_mod meshed_run_mode_nam run_mode_set gatherrun_modev variable_nam filtervariable_nam mesh_data unnestv filterv run_mod sample_info bind_rowssnakemakeparamssample_info selectspeci sequencing_d investig experi uniqu gatherinfo_nam valu add_rowinfo_nam project_id valu snakemakewildcardsproject add_rowinfo_nam sample_id valu snakemakewildcardssampl add_rowinfo_nam puck_id valu snakemakewildcardspuck cpalett listgrey light_orangeef light_blueb green e yellow fe blue b oranged pinkcca clr cumiscpalettelight_orang gene cpalettelight_blu readscpalettegreen pcrcpalettepink summarised_clr cclr black namessummarised_clr cpastemedian_ namesclr n_bead nucl_clr cafc cfd taa gf n load dge summari dge_summari tibblerun_mod run_mode_nam obs_df snakemakeinputpasterun_mod dge_summari unnestobs_df mutatedat mapobs_df read_csv mutatecell_bc ascharactercell_bc unnestdat selectobs_df renamepcr reads_per_count umi total_count gene n_genes_by_count read n_read group_byrun_mod filtergreplactgan cell_bc overview tabset sampl info r show_sample_info echo f sample_info kblcolnamesnul kable_classic_full_widthf positionleft run mode sampl process use follow run mode run mode variabl r plot_run_mod echo f col_names_to_show colnamesrun_mode_set run_mode_set kblcolnam c col_names_to_show kable_classic_full_widthf positionleft add_header_abovec run mode lengthcol_names_to_show column_spec border_rightt row_spec boldt r load_read_statist echo f rrna_stat read_tablesnakemakeinputribo_log col_namescobserv valu spreadobserv valu mutatemapped_to_rrna aligned_read gatherobserv valu filterobserv mapped_to_rrna mutatevalu ifelsevalu none valu read_stat tibblestar_log snakemakeinputstar_log reads_type_out snakemakeinputreads_type_out mutatetrim ifelsegreplpolya_adapter_trim reads_type_out fixedtru polya_adapter_trim untrim mutatestar_log_dat mapstar_log readstarlog reads_type_out_dat mapreads_type_out read_tabl col_nam cobserv valu mutaterrna_stats_dat mapstar_log rbindrrna_stat selectstar_log reads_type_out gatherdat_typ dat trim selectdat_typ unnestdat group_bytrim rbindrrna_stat convert million mutatevalu ifelseobserv avg_mapped_length roundvalu e valu add input_read column per group spreadobserv valu mutateinp_read input_read gatherobserv valu trim inp_read mutatelabel ifelseobserv cinput_read avg_mapped_length valu pastevalu roundvalueinp_read dplyrselectobserv label spreadobserv label dplyrrenameasutr utr intron intron intergen intergen ambigu amb ascd code reorder column dplyrselectinput_read uniq_mapped_read avg_mapped_length multi_mapped_read unmapped_too_short intergen intron ascd ambigu asutr mapped_to_rrna gathermetr valu trim spreadtrim valu chang order slice map_typ colnamesselectread_stat metric map statist sampl map use r map_typ read map statist shown method r show_read_stat echo f col_names_to_show colnamesread_stat read_stat kblcolnam c col_names_to_show kable_classic_full_widthf positionleft add_header_abovec map mode lengthcol_names_to_show column_spec border_rightt row_spec boldt add_indentc footnotegener valu except avg_mapped_length shown million summaris metric bead r calculate_summarised_metrics_over_bead echo f col_names_to_show colnamesrun_mode_set dge_summari group_byrun_mod summarisesum_read sumread narmt median_read medianread narmt median_umi medianumi narmt median_pcr medianpcr narmt median_gen mediangen narmt n_bead n mutatesum_read pasteroundsum_read e e gatherob valu run_mod spreadrun_mod valu kblcolnam c col_names_to_show kable_classic_full_widthf positionleft add_header_abovec run mode lengthcol_names_to_show column_spec border_rightt row_spec boldt qc plot qc plot show per run mode basi see downstream differ base run mode variabl set kneeplot tabset plot call kneeplot yaxi cummul sum read xaxi bead barcod sort number read singlecel sampl plot tell roughli mani bead sampl r knee_plot echo f figheight figwidth resultsasi read_count dge_summari selectrun_mod cell_bc read mutatereads_cumsum cumsumread ix n run_mode_in uniquedge_summaryrun_mod cat pastenn run_mode_in nn pl_knee read_count filterrun_mod run_mode_in ggplotaesix reads_cumsum geom_lin labsxbead sort number read ycummulativensum read printpl_kne catnn umicutoff plot r create_umi_cutoff echo f figwidth figheight umi_cutoff seq dge_summari dge_summari group_byrun_mod mutatereads_cumsum cumsumread mutatequartil cutreads_cumsum break includelowest label cq q q q selectreads_cumsum summarise_dge_summari functionumi_cutoff dge_summari filterumi umi_cutoff summarisemedian_read medianread median_umi medianumi median_gen mediangen median_pcr medianpcr n_bead n umi_cutoff_data tibbleumi_cutoff umi_cutoff mutatedat mapumi_cutoff summarise_dge_summari unnestdat r plot_umi_cutoff_plot echo f figheight figwidth metric_nam listumi umi gene gene pcr read umi readsread umi_cutoff_plot functionmetr y_log_transform f legend_posnon y_label strsplitmetr _ y_label pastey_label metric_namesy_label pl umi_cutoff_data gatherob valu umi_cutoff run_mod filterob metric ggplotaesumi_cutoff valu colorob linetyp run_mod geom_lin scale_color_manualvaluessummarised_clr scale_x_logbreak ce e e e themestripbackgroundelement_blank striptextxelement_blank text element_texts face plain legendpositionlegend_po legendtitl element_blank legendmargin margint bl r unit cm legendspac unit cm plotmargin unitc line labscolor linetyp ypastey_label nper spatial unit xminimum umi guideslinetyp guide_legendoverridea listsiz ncol color guide_legendoverridea listsiz y_log_transform pl pl scale_y_log annotation_logtickssidesbl els pl pl annotation_logtickssidesb returnpl pl umi_cutoff_plotn_bead y_log_transform pl umi_cutoff_plotmedian_read pl umi_cutoff_plotmedian_gen pl umi_cutoff_plotmedian_umi pl umi_cutoff_plotmedian_pcr legend_po right plt_legend get_legendpl plot_gridpl pl pl pl pl themelegendpositionnon plt_legend alignvh hjust label nrow histogram metric bead tabset next show mertic number umi gene read pcr per physic spot distinguish run mode show one histogram r plot_n_reads_bead_hist echo f figwidth figheight dpi resultsasi libraryscal to_plot dge_summari gatherob val cell_bc quartil run_mod min_differ to_plot group_byob filterisnav summarisemin_v minvalnarmt max_val maxvalnarmt differ max_val min_val summarisemin_differ mindiffer min_differ metric_plot functionrun_mode_in metric legend_posnon y_label metric_namesmetr to_plot to_plot filterob metric pl to_plot filterrun_mod run_mode_in ggplotaesx val fillob geom_histogrambin scale_x_logbreak c e e e e e e labelstrans_formatlogmath_formatx scale_fill_manualvaluesclr labsfil xpast y_label ypast ofn spatial unit themelegendposit legend_po stripbackgroundelement_rectfillwhit text element_texts ifmin_differ pl pl annotation_logtickssidesb returnpl run_mod uniquedge_summaryrun_mod cat pastenn run_mod nn pl metric_plotrun_mod read pl metric_plotrun_mod pcr pl metric_plotrun_mod gene pl metric_plotrun_mod umi printplot_gridpl pl pl pl alignvh hjust label nrow catnn nucleotid distribut per bead tabset next bin data base read quartil run_mod data divid bead read mean first bin contain bead account read second contain bead account second read run mode plot nucleotid distribut per quartil pick run_mod shown dropdown list notmesh run_mod shown r plot_nucl_freq resultsasi figwidth figheight echof dpi plot_nucl_freq functiondge_ cell_bc_len nchardge_ cell_bc nucl dge_ cell_bc strsplit nucl dge_ selectcell_bc quartil run_mod bind_colstibblenuclnucl unnestnucl group run_mod cell_bc nt correct po group_byrun_mod cell_bc mutatepo pastepos_ n group_byrun_mod po nucl quartil summarisenucl_count n ungroup tidyrcompleterun_mod po nucl quartil filllistnucl_count lbl_df dge_ ungroup group_byquartil summariselbl n mutatelbl pastequartil n lbl lbl lbl_dflbl nameslbl lbl_dfquartil nucl ggplotaespo nucl_count fill nucl geom_barstatident positiondodg scale_fill_manualvaluesnucl_clr scale_x_discretelabelsseq cell_bc_len facet_wrapquartil ncol scalesfree_i labelleras_labellerlbl labsxnucleotid posit barcod ynucleotid count themetext element_texts run_mode_in uniquenormal_run_mode_nam cat pastenn run_mode_in nn dge_summari filterrun_mod run_mode_in plot_nucl_freq print shannon entropi string compress tabset r plot_shannon echo f figheight figwidth resultsasi dpi plot_shannon_scompress functionrun_mode_in dat dge_summari filterrun_mod run_mode_in selectcell_bc run_mod ends_withcompress ends_withentropi gatherobserv valu cell_bc run_mod replac first _ separ later mutateobserv str_replaceobserv _ observ str_replaceobserv observ str_replaceobserv _ separateobserv ctype observ sep pl dat filterobserv entropi ggplotaesvalu fill type geom_histogrambin colorblack positiondodg scale_fill_manualvaluesccpalettegrey cpaletteorangelabelsctheoret observ labsfil barcod xshannon entropi barcod themelegendposit c text element_texts faceplain pl dat filterobserv compress ggplotaesvalu fill type geom_histogrambin colorblack positiondodg scale_fill_manualvaluesccpalettegrey cpaletteorang scale_x_continuouslimitsc na labsfil barcod xlength barcod compress themetext element_texts faceplain legendpositionnon plt_legend get_legendpl plot_gridpl pl alignvh hjust label nrow run_mod uniquedge_summaryrun_mod cat pastenn run_mod nn printplot_shannon_scompressionrun_mod r prepare_spati echo f barcod file attach python level is_spati snakemakeparamsis_spati r spatial_head evalis_spati echof resultsasi cat spatial qc tabsetnn r prepare_spatial_data evalis_spati echo f run_mode_info dge_summari selectrun_mod summarisen_cellsn mutatedef_plot_bead_s ifelsen_cel mutatedef_plot_bead_s ifelsen_cel def_plot_bead_s mutatedef_plot_bead_s ifelsen_cel def_plot_bead_s plot_bead_s run_mode_set filtervariable_nam cmesh_data mesh_spot_diameter_um gatherrun_mod variable_valu variable_nam unnestvariable_valu add_rowvariable_nam spot_diameter_um run_mod run_mode_nam variable_valu snakemakeparamspuck_variablesspot_diameter_um spreadvariable_nam variable_valu inner_joinrun_mode_info byrun_mod mutatemesh_data aslogicalmesh_data group_byrun_mod mutateplot_bead_s minifelsemesh_data mesh_spot_diameter_um spot_diameter_um def_plot_bead_s selectrun_mod plot_bead_s x_limit dge_summaryx_po cmin max y_limit dge_summaryy_po cmin max ratio x_limit x_limit y_limit y_limit puck_width_um snakemakeparamspuck_variableswidth_um scale_factor ifelsepuck_width_um mm_dist maxscale_factor roundpuck_width_um digit scale_factor mm_diff mm_dist x_mm_break seq puck_width_um mm_dist x_mm_break pastex_mm_break mm_diff mm_dist mm y_mm_break seq puck_width_um ratio mm_dist y_mm_break pastey_mm_break mm_diff mm_dist mm px_to_um x_limit x_limit snakemakeparamspuck_variableswidth_um x_break seqx_limit x_limit px_to_um mm_dist y_break seqy_limit y_limit px_to_um mm_dist plot_spatial_qc functionvari dat_in plot_bead_s ttl cut_distt min_valu is_hexagonalf spatial_qc_dat dat_in mutateqnt quantilev narmt arrangev ifcut_dist spatial_qc_dat spatial_qc_dat mutatev ifelsev qnt qnt val limit cmin_valu quantilespatial_qc_datv narmt ifis_hexagon pl spatial_qc_dat ggplotaesx_po y_po fill val group geom_hexstatident colorgray guidesfil guide_colorbarbarheight labsfillttl x ifcut_dist pl pl scale_fill_viridis_copt magma limit limit els pl pl scale_fill_viridis_copt magma els pl spatial_qc_dat ggplotaesx_po y_po color val geom_pointsizeplot_bead_s guidescolor guide_colorbarbarheight labscolorttl x ifcut_dist pl pl scale_color_viridis_copt magma limit limit els pl pl scale_color_viridis_copt magma pl pl scale_x_continuouslabel x_mm_break break x_break limitsx_limit scale_y_continuouslabel y_mm_break break y_break limitsy_limit coord_fix themepanelbackground element_rectfil gray legendspac unit cm axislin element_linecolor black text element_textcolorblack size returnpl qc_var cn_join read gene umi pcr pct_counts_mt exact_entropi exact_compress qc_var_info dge_summari ungroup selectcell_bc x_po y_po total_counts_mt run_mod theoretical_entropi theoretical_compress quartil uniqu colnam tibbleqc_var inner_jointibbleqc_var qc_var ttl c bead joinednp spatial unit readsnper spatial unit genesnp spatial unit umisnp spatial unit read umisnp spatial unit mt countsnper spatial unit shannonnentropynp spatial unit barcod lengthnafterncompressionnp spatial unit cut_dist cf f f min_valu c byqc_var mutateqc_var factorqc_var level qc_var r plot_per_run_mod echo f resultsasi figwidth figheight evalis_spati dpi run_mode_nam run_mode_nam catpastenn run_mode_nam nn qc_var qc_var_infoqc_var pb filterplot_bead_s run_mod run_mode_nameplot_bead_s dat_in dge_summari filterrun_mod run_mode_nam ungroup selectx_po y_po matchesqc_var renamev qc_var filterisnav qc_var colnamesdge_summari nrowdat_in qc_var_info filterqc_var qc_var plot_spatial_qc qc_var dat_in plot_bead_s pb ttl ttl cut_dist cut_dist min_valu min_valu is_hexagonalsnakemakeparamsrun_modesrun_mode_namemesh_typ hexagon print headerinclud usepackagefloat usepackagetablexcolor output html_document toc true toc_depth classopt landscap geometri margincm version author tama ryszard sztankatoth nikolao karaisko email tamasryszardsztankatothmdcberlind nikolaoskaraiskosmdcberlind licens gpl titl sampl overview pagetitl sampl overview date r formatsystimedmi r knitr_opt includefals cachefals knitropts_chunkset cach f autodep true messag fals warn fals comment na optionsknitrtableformat markdown r function echo f readstarlog functionlog_fil list line readlineslog_fil outinput_read line strsplitt unlist asinteg outuniq_mapped_read line strsplitt unlist asinteg outavg_length line strsplitt unlist asnumer tibbleobservationnamesout valueunlistunnameout r load_projects_puck_info echof librarytidyvers librarymagrittr metadata read_csvsnakemakeinput r collect_data echo f root_dir snakemakeconfigroot_dir read_metr metadata selectproject_id sample_id puck_id speci sequencing_d mutatestar_log pasteroot_dir project project_id processed_data sample_id illuminacomplete_datastar_logfinalout read_typ pasteroot_dirproject project_id processed_data sample_id illuminacomplete_datasplit_readsread_type_numtxt mutatestar_log mapstar_log readstarlog unneststar_log mutateread_typ mapread_typ read_tabl col_namescrt_ob rt_valu unnestread_typ mutatert_ob tolowerrt_ob spreadrt_ob rt_valu spreadobserv valu r show_sample_t echo f librarykableextra to_tabl read_metr mutateum_r uniq_mapped_read gatherob val intergen amb code intron utr mutateval_p roundval um_r val roundval e add ratio paranthesi ob cd val pastev val_p uniq_mapped_read rounduniq_mapped_read e input_read roundinput_read e uniq_mapped_read pasteuniq_mapped_read rounduniq_mapped_read input_read selectum_r val_p spreadob val arrangespeci selectsample_id puck_id speci sequencing_d input_read uniq_mapped_read code utr intergen intron amb renameuniq_m uniq_mapped_read input_r input_read cd code r load_strand_info echo f strand_info metadata selectproject_id sample_id puck_id speci sequencing_d mutatefilenam pasteroot_dir project project_id processed_data sample_id illuminacomplete_datasplit_readsstrand_type_numtxt content mapfilenam read_tabl col_nam cob num unnestcont selectfilenam project_id group_bysample_id mutatenum_sum sumnum num_ratio roundnum num_sum num roundnum e num pastenum num_ratio selectnum_ratio num_sum spreadob num r load_barcode_metadata echo f umi_cutoff c load_filter_dg functionx read_tablex skip filternum_transcript read_dge_summari functionfilenam tibbleumi_cutoff umi_cutoff filenamefilenam mutatedat mapfilenam umi_cutoff load_filter_dg selectfilenam unnestdat group_byumi_cutoff summaris median_umi mediannum_transcript median_read mediannum_genic_read median_gen mediannum_gen median_pcr medianroundnum_genic_read num_transcript mean_umi asintegermeannum_transcript mean_read asintegermeannum_genic_read mean_gen asintegermeannum_gen num_bead n barcode_metadata metadata selectproject_id sample_id puck_id speci sequencing_d mutatefilenam pasteroot_dir project project_id processed_data sample_id illuminacomplete_datadg mutatefilenam ifelsefileexistspastefilenam dge_all_summarytxt pastefilenam dge_all_summarytxt pastefilenam dge_all_cleaned_summarytxt content mapfilenam read_dge_summari selectfilenam project_id unnestcont overview show downstream metadata experi perform st project three type tabl read inform tabl contain pars output map input read number uniqu map read number etc express summari tabl contain median number umi gene read mean per bead sampl done appli umi filter strand inform tabl contain number read map correct strand tabl follow column sample_id puck_id speci sequencing_d tabl column descript __read inform table__ input_r number input read million flowcel uniq_m number uniqu map read million paranthes ratio input_r cd utr intergen intron amb code utr intergen intron ambient overlap gene strand assign singl gene part million paranthes ratio uniq_m __express summari tables__ column raw count mean median umi gene read per bead median pcr median readsumi per bead __strand inform table__ column minus_amb minus_minu minus_plu plus_amb plus_minu plus_plu first part posit read plu minu strand second posit map gene amb mean map gene ambient overlap gene differ strand read intergen tabl speci contain sequenc metadata r print_by_speci echo f result asi for uniqueto_tablespeci catpast sampl catn cat read inform tablen to_tabl filterspeci kablehtml kable_stylingstrip font_siz row_specrow boldt print catn catback topnn cat express summari tablesn forcutoff umi_cutoff catpast umi cutoff cutoff catn barcode_metadata filterspeci umi_cutoff cutoff kablehtml kable_stylingstrip font_siz row_specrow boldt print catn catback topnn cat strand inform tablen strand_info filterspeci kablehtml kable_stylingstrip font_siz row_specrow boldt print catn catback topnn output html_document toc true self_contain ye version author tama ryszard sztankatoth nikolao karaisko email tamasryszardsztankatothmdcberlind nikolaoskaraiskosmdcberlind licens gpl r knitr_opt includefals cachefals knitropts_chunkset autodep true messag fals warn fals comment na r librari includ f cachef librarytidyvers libraryyaml libraryknitr librarymagrittr librarykableextra librarycowplot theme_settheme_cowplot cpalett listorang de blue b green e black yellow fe grey light_orang ef light_blu clr cumiscpalettelight_orang gene cpalettelight_blu readscpalettegreen pcrcpalettepink pct_counts_mt black sourcesnakemakeparamsr_shared_script r read_data echo f obs_df read_csvsnakemakeinputobs_df mutatepct_counts_mt asdoublepct_counts_mt var_df read_csvsnakemakeinputvar_df n_bead nrowobs_df data_empti n_bead data_empti data_empti sumobs_dftotal_count overview r create_overview_t echo f puck_width_um snakemakeparamspuck_variableswidth_um parameter_stat rbindcumi filter snakemakewildcardsumi_cutoff c gene data nrowvar_df c spot data obs_df selectcell_bc uniqu nrow cmedian umi medianobs_dftotal_count cmedian gene medianobs_dfn_genes_by_count cpuck width um puck_width_um parameter_stat kblcolnamesnul kable_classic_full_widthf pack_rowssampl info pack_rowsdata info histogram metric bead r data_empti echo f eval data_empti resultsasi catthi dataset bead pass filter r plot_histogram_of_metr echo f figwidth evaldata_empti pl obs_df selectcell_bc total_count n_genes_by_count dplyrrenameumistotal_count genesn_genes_by_count gatherob valu cell_bc ggplotaesvalu fillob geom_histogrambin scale_fill_manualvaluesclr facet_wrapob ncol scalesfre lengthuniqueobs_dftotal_count pl pl scale_x_log annotation_logtickssidesb labsxlogvalu ycount els pl pl labsx valu ycount pl obs_df selectcell_bc pct_counts_mt gatherob valu cell_bc ggplotaesvalu fillob geom_histogrambin scale_fill_manualvaluesclr facet_wrapob ncol scalesfre labsxvalu ycount plot_gridpl plot_gridpl null ncol rel_widthsc ncol rel_heightsc label r check_complet echo f figsiz figwidth obs_df obs_df gatherr cluster starts_withleiden data_complet f cluster colnamesobs_df data_complet is_spati snakemakeparamsis_spati data_complet fig_height fig_width r incompleteness_warn evaldata_complet echof resultsasi cat warn data incompletenn catpastethi dataset n_bead cell pass filter snakemakewildcardsumi_cutoff nrowvar_df genesnn catpastethi dataset small couldnt properli cluster analys automat r umap_text evaldata_complet echo f resultsasi cat umap plot use differ resolut tabsetnn r plot_umi_umap evaldata_complet echof figheightfig_height figwidthfig_width obs_df obs_df mutateclust factorclust mutatelogp_total_count logtotal_count n_cell obs_df selectcell_bc uniqu nrow def_plot_bead_s ifelsen_cel def_plot_bead_s ifelsen_cel def_plot_bead_s def_plot_bead_s ifelsen_cel def_plot_bead_s obs_colnam colnamesobs_df barcod file attach python level is_hexagon snakemakeparamsrun_mode_variablesmesh_typ hexagon snakemakeparamsrun_mode_variablesmesh_data filter_qu quantileobs_dftotal_count narmt limit c quantileobs_dftotal_count narmt is_spati calcul break limit puck puck_fil read_csvsnakemakeinputpuck_fil x_limit puck_filex_po cmin max y_limit puck_filey_po cmin max ratio x_limit x_limit y_limit y_limit scale_factor ifelsepuck_width_um mm_dist maxscale_factor roundpuck_width_um digit scale_factor mm_diff mm_dist x_mm_break seq puck_width_um mm_dist x_mm_break pastex_mm_break mm_diff mm_dist mm y_mm_break seq puck_width_um ratio mm_dist y_mm_break pastey_mm_break mm_diff mm_dist mm px_to_um x_limit x_limit snakemakeparamspuck_variableswidth_um x_break seqx_limit x_limit px_to_um mm_dist y_break seqy_limit y_limit px_to_um mm_dist puck_bead_s mindef_plot_bead_s ifelsesnakemakeparamsrun_mode_variablesmesh_data snakemakeparamsrun_mode_variablesmesh_spot_diameter_um snakemakeparamspuck_variablesspot_diameter_um res_colnam obs_dfr uniqu umi_pl obs_df filterr res_colnam arrangetotal_count mutatetotal_count ifelsetotal_count filter_qu filter_qu total_count ifis_hexagon umi_pl umi_pl ggplotaesxx_po yy_po fill total_count group geom_hexstatident colorgray coord_fix scale_x_continuouslabel x_mm_break break x_break limitsx_limit scale_y_continuouslabel y_mm_break break y_break limitsy_limit scale_fill_viridis_copt magma limit limit guidesfil guide_colorbarbarheight labsfillumi count x els umi_pl umi_pl ggplotaesx_po y_po color total_count geom_pointsizepuck_bead_s coord_fix scale_x_continuouslabel x_mm_break break x_break limitsx_limit scale_y_continuouslabel y_mm_break break y_break limitsy_limit scale_color_viridis_copt magma limit limit guidescolor guide_colorbarbarheight labscolor umisnp spatial unit x umi_pl umi_pl themepanelbackground element_rectfil gray legendspac unit cm axislin element_linecolor black text element_textcolorblack size umi_pl r plot_clusters_umap_puck echo f figheightfig_height figwidthfig_width evaldata_complet resultsasi libraryp cluster_clr unnameglasbey top_marker_t read_tablesnakemakeinputcluster_mark obs_df re uniqu re asdoublestrspl _ catpastenn re resolut tabsetnn dat obs_df filterr dplyrselectcell_bc umap_ umap_ cluster umap_plot dat ggplotaesumap_ umap_ color cluster geom_pointsizedef_plot_bead_s guidescolour guide_legendoverridea listsiz coord_fix themeaxistext element_blank legendposit none axistick element_blank axislin element_linecolorwhit n_cluster lengthuniquedatclust ifn_clust lengthcluster_clr umap_plot umap_plot scale_color_manualvaluescluster_clr is_spati physical_plot obs_df filterr dplyrselectcell_bc x_po y_po cluster ifis_hexagon physical_plot physical_plot ggplotaesx_po y_po fill cluster geom_hexstatident colorgray guidesfil guide_legendoverridea listsiz ncol coord_fix labsx scale_x_continuouslabel x_mm_break break x_break limitsx_limit scale_y_continuouslabel y_mm_break break y_break limitsy_limit ifn_clust lengthcluster_clr physical_plot physical_plot scale_fill_manualvaluescluster_clr els physical_plot physical_plot ggplotaesx_po y_po color cluster geom_pointsizepuck_bead_s guidescolour guide_legendoverridea listsiz ncol coord_fix labsx scale_x_continuouslabel x_mm_break break x_break limitsx_limit scale_y_continuouslabel y_mm_break break y_break limitsy_limit ifn_clust lengthcluster_clr physical_plot physical_plot scale_color_manualvaluescluster_clr physical_plot physical_plot themepanelbackground element_rectfil gray legendspac unit cm axislin element_linecolor black plotsubtitleelement_texts text element_textcolorblack ggtitl subtitlepasteresolut re printumap_plot printphysical_plot els printumap_plot r nhood_enrichment_titl echo f evalis_spati resultsasi catnn neighborhood enrichmentnn r plot_nhood_enrich echo f evalis_spati nhood_dat read_csvsnakemakeinputnhood_enrich obs_df re uniqu re asdoublestrspl _ dat nhood_dat filterresolut re mutatea ascharact cluster_a b ascharact cluster_b mutatezscor ifelsezscor zscore zscore ifelsezscor zscore lab dat selectcluster_a cluster_b b filtercluster_a cluster_b pl dat ggplotaesa b fillzscor geom_tilecolorwhit scale_fill_viridis_coptioninferno limit c guidesfil guide_colorbarbarheight scale_x_discretelabel labscluster_a breakslabsa scale_y_discretelabel labscluster_b breakslabsb coord_fix labsfillneighborhoodnenrichmentnscor xcluster ident ycluster ident ggtitl subtitlepasteresolut re coord_equ themeplotsubtitleelement_texts printpl snakemak function configur instal spacemak configur run includ sharedspacemake_initrst option also provid download_speci flag download gencod genom annot mous human place project_rootspecies_dataspeci speci either mous human includ sharedshared_sample_variablesrst configur speci _configurespeci add speci follow command use spacemak config add_speci name name name speci ad genom genom path genom fa file speci ad annot annot path annot gtf file speci ad rrna_genom rrna_genom option path ribosomalrna genom fa file speci ad spacemak config update_speci take argument spacemak config delete_speci take name list current avail speci type spacemak config list_speci configur barcode_flavor _configurebarcode_flavor samplevari describ cellbarcod umi extract read read default valu barcode_flavor dropseq cell_barcod r cellbarcod come first nt read umi r umi come nt read sampl barcode_flavor provid default run_mod use provid barcode_flavor spacemak provid follow barcode_flavor box codeblock yaml default cell r umi r slide_seq_bc cell r umi r slide_seq_bc cell r umi r visium cell r umi r sc_x_v cell r umi r seq_scop umi r cell r list current avail barcode_flavor type spacemak config list_barcode_flavor add new barcode_flavor codeblock spacemak config add_barcode_flavor name name name barcod flavor umi umi structur umi use python list syntax exampl set umi nt read use umi r also possibl use first nt read umi umi r cell_barcod cell_barcod structur cell barcod use python list syntax exampl set cell_barcod nt read use cell_barcod r also possibl revers cell barcod instanc r updatedelet barcode_flavor spacemak config update_barcode_flavor take argument spacemak config delete_barcode_flavor take name configur run_mod _configurerun_mod specifi run mode essenti flexib spacemak offer set run_mod sampl process analys downstream variou fashion run_mod follow variabl n_bead number cellbarcod expect umi_cutoff list integ downstream analysi run use umi cutoff cellbarcod less umi discard clean_dg whether clean cellbarcod overhang primer creat dge detect_tissu spatial true apart umi cutoff spacemak tri detect tissu insilico polya_adapter_trim true polya stretch apat trim read count_intronic_read true intron read count creat dge count_mm_read true multimapp count multimap read count way map exactli one cd utr segment gene mesh_data spatial true mesh creat run run_mod mesh_typ spatial spacemak current offer two type mesh circl circl given mesh_spot_diameter_um place hexagon grid mesh_spot_distance_um distanc apart hexagon grid equal hexagon mesh_spot_diameter_um side place full mesh grid whole area cover mesh_spot_diameter_um spatial diamet mesh spatialunit micron mesh_spot_distance_um spatial circl mesh distanc mesh circl micron parent_run_mod run_mod parent fall back one run_mod variabl miss variabl parent use parent provid default run_mod parent provid run_mod codeblock yaml default n_bead umi_cutoff clean_dg fals detect_tissu fals polya_adapter_trim true count_intronic_read true count_mm_read fals mesh_data fals mesh_typ circl mesh_spot_diameter_um mesh_spot_distance_um visium n_bead umi_cutoff clean_dg fals detect_tissu true polya_adapter_trim fals count_intronic_read fals count_mm_read true slide_seq n_bead umi_cutoff clean_dg fals detect_tissu fals scrna_seq n_bead umi_cutoff detect_tissu fals polya_adapter_trim true count_intronic_read true count_mm_read fals seq_scop clean_dg fals count_intronic_read fals count_mm_read fals detect_tissu fals mesh_data true mesh_spot_diameter_um mesh_spot_distance_um mesh_typ hexagon n_bead umi_cutoff note sampl run_mod provid default use note run_mod variabl provid variabl default run_mod use list current avail run_mod type spacemak config list_run_mod add new run_mod see refvari descript configurerun_mod codeblock spacemak config add_run_mod name name parent_run_mod parent_run_mod umi_cutoff umi_cutoff umi_cutoff n_bead n_bead clean_dg truetruefalsefals detect_tissu truetruefalsefals polya_adapter_trim truetruefalsefals count_intronic_read truetruefalsefals count_mm_read truetruefalsefals mesh_data truetruefalsefals mesh_typ circlehexagon mesh_spot_diameter_um mesh_spot_diameter_um mesh_spot_distance_um mesh_spot_distance_um updatedelet run_mod spacemak config update_run_mod take argument spacemak config delete_run_mod take name configur puck _configurepuck spatial sampl need puck puck samplevari defin dimension underli spatial structur spacemak use autmat analysi plot puck follow variabl width_um width puck micron spot_diameter_um diamet bead puck micron barcod option path barcod file contain cell_barcod xy posit handi sever puck barcod x visium provid puck codeblock yaml default width_um spot_diameter_um visium barcod puck_datavisium_barcode_positionscsv width_um spot_diameter_um seq_scop width_um spot_diameter_um slide_seq width_um spot_diameter_um see visium puck come barcod variabl point puck_datavisium_barcode_positionscsv upon initi file automat place spacemak list current avail puck type spacemak config list_puck add new puck codeblock spacemak config add_puck name name name puck width_um width_um spot_diameter_um spot_diameter_um barcod barcod path barcod file option initi initi use requir argument includ sharedspacemake_initrst option argument spacemak init command take follow option argument root_dir root_dir spacemak instanc default directori spacemak init ran temp_dir path temporari directori default tmp download_speci set spacemak download genom fa annot gtf file mous human gencod specifi httpsgithubcomrajewskylabspacemakeblobmasterspacemakedataconfigspecies_data_urlyaml_ henc complet spacemak init command look like spacemak init root_dir root_dir option temp_dir temp_dir option download_speci option dropseq_tool dropseq_tool requir welcom document spacemak spacemak pipelin process analys sequenc base spatialtranscriptom data imag graphical_abstract_twitterpng width alt graphic abstract note project activ develop content toctre maxdepth instal quickstartindexrst initi config projectsindex run tutorialsindex apiindex _run spacemak gener run spacemak main modul spacemak configur spacemak config command projectssampl ad spacemak project command spacemak run spacemak run command take follow paramet spacemak run core core number core use total dryrun n invok dri snakemak run print command rerunincomplet ri forc snakemak rerun incomplet gener file keepgo job fail keep execut independ job recommend alway set run spacemak overnight printshellcmd p print shell command rule exist touch rather run rule touch file with_fastqc wfqc run also fastqc part spacemak run downsampl run downsampl satur analysi one use follow command spacemak run downsampl project_id_list project_id_list sample_id_list sample_id_list project_id_list sample_id_list argument one specifi list project_id sample_id respect downsampl run possibl set one argument set downsampl run sampl project_id sample_id list intersect note addit list argument specifi downsampl command also take argument simpl spacemak run command _seqscop httpswwwsciencedirectcomsciencearticlepii _visium httpswwwxgenomicscomproductsspatialgeneexpress _slideseq httpswwwnaturecomarticless _dropseq httpsmccarrolllaborgdropseq _x chromium httpswwwxgenomicscomproductssinglecellgeneexpress instal step creat conda environ straightforward way instal spacemak first creat conda environ packag highli recommend use mamba httpsgithubcommambaorgmamba_ much faster conda packag manag conda mamba instal download environmentyaml httpsrawgithubusercontentcomrajewskylabspacemakedevenvironmentyaml_ environmentyaml contain depend requir spacemak download instal spacemak depend type mamba env creat f environmentyaml creat conda environ call spacemak activ newli creat environ type conda activ spacemak step download dropseqtool work spacemak current need download dropseqtool httpsgithubcombroadinstitutedropseq_ packag collect process tool origin written dropseq httpswwwcellcomcellfulltexts_ spacemak use sever function packag preprocess process without imposs run spacemak simpli download one releas recommend use httpsgithubcombroadinstitutedropseqreleasesdownloadvdropseq_toolszip_ place somewher filesystem step instal spacemak creat conda environ download dropseqtool describ spacemak instal via pip pip instal spacemak instal spacemak good go warn make sure first creat conda environ describ although also possibl instal requir packag independ instal spacemak option test one quickli run depend issu error instal development version spacemak dev branch github type follow command pip instal githttpsgithubcomrajewskylabspacemakegitdev one import part spacemak socal share samplevari reusabl userdefin variabl assign sever sampl shortli defin follow speci collect genom annot rrna_genom default speci sampl exactli one speci barcode_flavor variabl specifi structur read read name cell_barcod umi extract valu provid sampl default use run_mod sampl sever run_mod user defin run_mod specifi sampl process use default run_mod set puck spatial sampl sampl spatial puck variabl puck specifi default puck use add updat delet list share samplevari use follow command spacemak config add_sharedsamplevari spacemak config update_sharedsamplevari spacemak config delete_sharedsamplevari spacemak config list_sharedsamplevari sharedsamplevari one speci barcode_flavor run_mod puck instal spacemak specifi refher instal readi process analyz spatial sampl initi spacemak cd directori want start spacemak directori project_root simpli type spacemak init dropseq_tool path_to_dropseq_tools_dir path_to_dropseq_tools_dir point directori download dropseqtool packag download refin step instal step download dropseqtool sampl ad spacemak run spacemak run core n_core keepgo keepgo flag option howev ensur spacemak run job even one job fail logic directli taken snakemak complet explan spacemak run command refcheck document run spacemak gener includ linksrst _quick start guid main quick start guid exampl minim code piec quickli get start spacemak assum spacemak instal follow instruct refher instal _quick start guid initi spacemak initi spacemak includ sharedspacemake_initrst _quick start guid share samplevari share samplevari includ sharedshared_sample_variablesrst spacemak come default valu speci anyth done new speci ad spacemak config add_speci name name speci genom path fa file annot path gtf file rrna_genom option path ribosomalrna genom star_index_dir option path exist star index directori info refher configurespeci warn star_index_dir flag provid spacemak check star index provid version star commandlin star case error rais visium quick start step add visium sampl refspacemak initi initi visium_ sampl ad add visium_ sampl type termin codeblock consol spacemak project add_sampl project_id project_id sample_id sample_id r path_to_rfastqgz singl r sever r file r path_to_rfastqgz singl r sever r file speci speci puck visium run_mod visium barcode_flavor visium add new visium project puck run_mod barcode_flavor set visium possibl spacemak come predefin variabl suit visium visium run_mod process sampl way spacerang httpssupportxgenomicscomspatialgeneexpressionsoftwarepipelineslatestwhatisspaceranger_ would intron read count multimapp multimap read map one cd utr region count polya stretch trim read note r r possibl provid singl fastqgz file one per mate sever file per mate exampl result demultiplex run follow sample_a_rfastqgz sample_b_rfastqgz sample_a_rfastqgz sample_b_rfastqgz mean r r split two one simpli call spacemak follow command spacemak project add_sampl r sample_a_rfastqgz sample_b_rfastqgz r sample_a_rfastqgz sample_b_rfastqgz import thing alway keep order consist two mate see valu predefin variabl checkout refconfigur configur doc add sever visium sampl follow refth tutori addseveralsampl _run spacemak visium step run spacemak includ run_spacemakerst slideseq quick start step add slideseq sampl refspacemak initi initi slideseq_ sampl ad add slideseq_ sampl type termin codeblock consol spacemak project add_sampl project_id project_id sample_id sample_id r path_to_rfastqgz r path_to_rfastqgz speci speci puck slide_seq run_mod slide_seq barcode_flavor slide_seq_bc puck_barcode_fil path_to_puck_barcode_fil add new slideseq_ project puck run_mod set slide_seq predefin set slideseq_ sampl note spatial sampl visium slideseq_ need provid puck_barcode_fil sinc puck differ barcod unlik visium sampl file comma tab separ contain column name first row accept column name cell_bc barcod barcod cellbarcod xcoord x_po xposit ycoord y_po yposit exampl barcode_flavor set slide_seq_bc predefin barcode_flavor spacemak cell_barcod come first nt read umi come nt remain nt predefin barcode_flavor slideseq_ slide_seq_bc cell_barcod come first nt read umi come nt remain read see valu predefin variabl checkout refconfigur configur doc add sever slide_seq project follow refth tutori addseveralsampl _run spacemak slideseq step run spacemak includ run_spacemakerst seqscop quick start step add seqscop sampl refspacemak initi initi seqscope_ sampl ad ad seqscope_ sampl similar slideseq codeblock consol spacemak project add_sampl project_id project_id sample_id sample_id r path_to_rfastqgz singl r sever r file r path_to_rfastqgz singl r sever r file speci speci puck seq_scop run_mod seq_scop barcode_flavor seq_scop puck_barcode_fil path_to_puck_barcode_fil use predefin variabl puck barcode_flavor run_mod set seq_scop seq_scop puck micron width bead size set micron seq_scop barcode_flavor describ cell_barcod umi extract describ seqscope_ paper cell_barcod come nt read umi come nt read seq_scop run_mod set follow codeblock yaml seq_scop clean_dg fals count_intronic_read fals count_mm_read fals detect_tissu fals mesh_data true mesh_spot_diameter_um mesh_typ hexagon n_bead umi_cutoff import thing notic default creat hexagon mesh seq_scop run_mod mean downstream rather work micron bead spaceam creat mesh adjasc equal hexagon micron side _run spacemak seqscop step run spacemak includ run_spacemakerst scrnaseq quick start step add singlecel rnaseq sampl spacemak written spatialtranscriptom pipelin howev also work singlecel experi spatial inform avail add scrnaseq sampl simpli type spacemak project add_sampl project_id project_id sample_id sample_id r path_to_rfastqgz singl r sever r file r path_to_rfastqgz singl r sever r file speci speci run_mod scrna_seq barcode_flavor default use flavor x chromium seen defin fewer variabl speci run_mod need warn seen set barcode_flavor default use dropseq_ scrnaseq barcod strategi cell_barcod nt read umi nt read x sampl either sc_x_v x chromium singl cell v visium x chromium singl cell v visium use barcode_flavor predefin spacemak anoth barcod strategi use custom barcode_flavor defin refher complet guid add custom barcode_flavor add new barcode_flavor note set run_mod scrna_seq use predefin run_mod set tailor singlecel experi expect number cell bead k intron count umi cutoff multimapp count polya adapt sequenc trim read cours run singlecel sampl run_mod set also possibl refher learn add custom run_mod add new run_mod tailor experiment need see valu predefin variabl checkout refconfigur configur doc add sever singlecel project follow refth tutori addseveralsampl _run spacemak scrnaseq step run spacemak includ run_spacemakerst intern api projectdf projectdf class core backend class spacemak autoclass spacemakeproject_dfprojectdf member configfil class respons updat spacemak configur autoclass spacemakeconfigconfigfil member api intern api toctre api internal_api api spacemak class access spacemak object python autoclass spacemakespacemak member integr modul autofunct spacemakespatialhe_integrationalign_he_spot_img autofunct spacemakespatialhe_integrationalign_he_aggregated_img autofunct spacemakespatialhe_integrationattach_he_adata novosparc integr modul autofunct spacemakespatialnovosparc_integrationnovosparc_denovo autofunct spacemakespatialnovosparc_integrationsave_novosparc_r autofunct spacemakespatialnovosparc_integrationnovosparc_map autofunct spacemakespatialnovosparc_integrationquantify_clusters_spati longread integr spacemak sampl associ illumina sequenc read via r r command line argument also assign long read eg pacbio nanopor etc use longread commandlin argument ad function purpos troubleshoot problem librari construct see spacemak paper long sequenc read captur entir cdna sequenc includ illumina sequenc adapt primer handl cell umi barcod polyat well actual cdna insert add long read sampl enabl spacemak annot catalog oligo sequenc thought build block librari everi long read allow assess follow feaur fraction molecul conform expect layout build block exampl smarthandl barcod polyt cdna insert tsohandl part parenthesi infer space adjac block directli annot fraction molecul miss one expect build block size distribut match distribut start end posit turn allow infer size distribut insert barcod sequenc concatamer unexpect multipl occurr build block point undesir sidereact build block signatur order fulli util longread function spacemak need know sequenc build block well expect layout tie togeth signatur signatur defin moment manual longreadyaml file spacemak find file name root project folder default load spacemakerootspacemakedatalongreadyaml excerpt file list known sequenc build block codeblock yaml block p aatgatacggcgaccaccgagatctacacgcctgtccgcgg nx ctgtctcttatacacatctccgagcccacgagacnnnnnnnnatctcgtatgccgtcttctgcttg smart_prim aagcagtggtatcaacgcagagt smart_bead aagcagtggtatcaacgcagagtac dnsmrt aagcagtggtatcaacgcagagtga tso aagcagtggtatcaacgcagagtgaatggg polyt tttttttttttttttttttttttttttttt see smart_prim smart_bead similar sequenc differ end smart_bead contain extra ac dinucleotid case multipl partial match build block match higher score ie match supersed overlap match lower score allow distinguish handl start captur oligo featur ac end occurr smart primer site might introduc via differ rout next section yaml file describ expect structur sequenc read term build block excerpt includ definit dropseqnadia cdna librari codeblock yaml signatur chromium label chromium prio color gray cb r umi r intact x_startpolytx_tso_rc x_c_rt_primerx_c_rt_prim cdna_aft polyt prefix p suffix nx read_prim x_start read_prim x_tso dropseq label dropseq prio color gray cb r umi r intact smart_beadpolyt cdna_aft polyt smart_primerdnsmrttsosc_prim prefix p suffix nx read_prim smart_bead read_prim nx predefin signatur moment visium almost ident chromium coupl experiment design ongo inhous develop prio color field relev overview plot across multipl sampl affect order prio color visual represent sampl metric import intact field list buidl block expect present order correct librari molecul p nx consid option prefixessuffix point may choos perform long read sequenc librari index pcr first build block list intact expect present molecul deriv use captur technolog contamin artifact case dropseqnadia bead would smart handl follow ac case x chromium visium librari would x_start primer handl attach gel bead visium slide respect occurr first build block use distinguish captur molecul orient everi long read sequenc long read either forward reversecompl orient happen soon least one sampl associ long sequenc read spacemak run invok dedic tool specif long read align known build block overlap match collect integr read base presenceabs block read classifi statist observ long read class gather particular emphasi read fall class defin intact cdna extract map genom via starlong associ mappabl build block presenceabs investig report plot gener sampl processed_datasample_idlongreadreport step complet everi sampl long read overview plot gener present high level result across sampl sidebysid project folderlongread_overview like util function outsid spacemakesnakemak workflow either invok longread command via python spacemakelongread import spacemakelongread modul python script nanopr exampl full exampl use small test dataset download test data add sampl spacemak project run analysi look output gener use wget download small test data set altern use git clone httpsgithubcomrajewskylabspacemaketestdatagit check collect differ test data assum speci label human alreadi set spacemak todo add link codeblock consol wget httpsbimsbstaticmdcberlinderajewskyspacemaketestdatalongreadsrr_subsamplefastqgz spacemak project add_sampl project_idtest sample_idtest_longread longreadssrr_subsamplefastqgz longreadsignaturechromium specieshuman spacemak run np core spacemak lay follow task process longread sampl shorten breviti codeblock consol job count count job cmd_align cmd_alnstat cmd_annot cmd_edit cmd_extract cmd_overview cmd_report map_cdna dryrun flag n order job reflect order execut rule cmd_align python spacemakelongread parallel configlongreadyaml cacheprojectstestprocessed_datatest_longreadlongreadcach annotationoutprojectstestprocessed_datatest_longreadlongreadannot statsoutprojectstestprocessed_datatest_longreadlongreadstat reportoutprojectstestprocessed_datatest_longreadlongreadreport examplesoutprojectstestprocessed_datatest_longreadlongreadexampl sampletest_longread signaturechromium align srr_subsamplefastqgz rule cmd_extract python spacemakelongread parallel configlongreadyaml cacheprojectstestprocessed_datatest_longreadlongreadcach annotationoutprojectstestprocessed_datatest_longreadlongreadannot statsoutprojectstestprocessed_datatest_longreadlongreadstat reportoutprojectstestprocessed_datatest_longreadlongreadreport examplesoutprojectstestprocessed_datatest_longreadlongreadexampl sampletest_longread signaturechromium extract srr_subsamplefastqgz projectstestprocessed_datatest_longreadlongreadcdnatest_longreadlog projectstestprocessed_datatest_longreadlongreadcdnatest_longreadfa rule cmd_annot python spacemakelongread parallel configlongreadyaml cacheprojectstestprocessed_datatest_longreadlongreadcach annotationoutprojectstestprocessed_datatest_longreadlongreadannot statsoutprojectstestprocessed_datatest_longreadlongreadstat reportoutprojectstestprocessed_datatest_longreadlongreadreport examplesoutprojectstestprocessed_datatest_longreadlongreadexampl sampletest_longread signaturechromium annot srr_subsamplefastqgz rule map_cdna mkdir p projectstestprocessed_datatest_longreadlongreadcdnatmp starlong runthreadn genomedir species_datahumanstar_index genomeload nosharedmemori readfilesin projectstestprocessed_datatest_longreadlongreadcdnatest_longreadfa readfilestyp fastx outsamtyp bam unsort outsamunmap within outsamattribut outsamprimaryflag allbestscor outstd bam_unsort outfiltermultimapscorerang outfilterscoremin outfilterscoreminoverlread outfiltermatchnminoverlread outfiltermatchnmin outfiltermismatchnmax winanchormultimapnmax seedsearchstartlmax seedperreadnmax seedperwindownmax aligntranscriptsperreadnmax aligntranscriptsperwindownmax outfilenameprefix projectstestprocessed_datatest_longreadlongreadcdnatmp datarajewskyshared_binsdropseq_toolstagreadwithgenefunct idevstdin oprojectstestprocessed_datatest_longreadlongreadcdnatest_longreadbam annotations_filespecies_datahumanannotationgtf rule cmd_report python spacemakelongread parallel configlongreadyaml cacheprojectstestprocessed_datatest_longreadlongreadcach annotationoutprojectstestprocessed_datatest_longreadlongreadannot statsoutprojectstestprocessed_datatest_longreadlongreadstat reportoutprojectstestprocessed_datatest_longreadlongreadreport examplesoutprojectstestprocessed_datatest_longreadlongreadexampl sampletest_longread signaturechromium report rule cmd_edit python spacemakelongread parallel configlongreadyaml cacheprojectstestprocessed_datatest_longreadlongreadcach annotationoutprojectstestprocessed_datatest_longreadlongreadannot statsoutprojectstestprocessed_datatest_longreadlongreadstat reportoutprojectstestprocessed_datatest_longreadlongreadreport examplesoutprojectstestprocessed_datatest_longreadlongreadexampl sampletest_longread signaturechromium edit srr_subsamplefastqgz rule cmd_overview python spacemakelongread parallel configlongreadyaml overview output longread_overview projectstestprocessed_datatest_longreadlongreadstatstest_longreadreporttsv ok sound good let codeblock consol spacemak run p core note pleas adapt core number appropri machin align stage longread process slow benefit strongli parallel therefor recommend run machin mani core graphic report spacemak run finish check longreadreport directori sampl assign longread data find sever graphic report let walk exampl nanopor data librari overview plot imag imgtest_longreaddonutspng width three panel test_longreaddonutspdf plot provid overview librari donut topleft show major read contain least x_start oligo match mean deriv captur technolog label beadrel cours good thing remain slice piechart correspond read x_start sequenc either absent mutat enough match relat buildingblock certain fraction read expect normal donut plot right zoom beadrel section left donut plot see slightli less half read conform expect full signatur lack recogniz match templateswitch oligo could either indic incomplet long read nanopor librari construct strategi truncat tso anoth use way look data horizont barplot lower left pleas note xaxi logarithm consist saw abund speci long read classifi x_startpolyt ie lack tso match howev close follow x_startpolytx_tso_rc expect speci note _rc end indic revers complement inde expect togeth two read speci account vast major librari zoom depend expect build block last plot lower left first bar correspond green beadrel slice first donut plot artifact contamin one could read fraction captur oligo gel bead correctli synthes begin x_start next barplot show fraction read start x_start go display polyt match next ie captur depend x_start polyt see strongli coupl much contrast last bar condens earlier find mani read lack good tso match repres fraction read begin x_startpolyt continu contain x_tso_rc oligo align qualiti plot imag imgtest_longreadoligo_editspng width order troubleshoot issu build block sequenc instanc detect build block match sampl read align refer sequenc condens stepplot left side refer sequenc posit xaxi perbas match rate yaxi provid detail right side detail kind mismatch delet insert observ yaxi posit xaxi heatmap row plot correspond one expect build block list intact final find clue tsomatch underrepres second half tso sequenc rare part sequenc read perhap indic nanopor sequenc librari gener nest primer mask part tso align correct refer sequenc howev heatmap indic neither mismatch insert delet posit tso_rc sequenc consist idea read end entir tso sequenc read histogram imag imgtest_longreadhistspng width lastli longread modul gener cumul histogram start posit first row endposit second row match score third row match lengt fourth row expect build block column importantli plot distinguish occurr part intact signatur read occurr given build block allow quickli spot look perhap differ speci moleculesartifact associ unexpect posit space block case consist idea tso match simpli truncat read otherwis conform expect includ linksrst process custom singlecel sampl tutori process custom singl cell sampl exampl use million read visium dataset httpswwwxgenomicscomresourcesdatasetsmousebrainsectioncoronalstandard_ note firstli exampl data use x visium_ dataset henc spatial howev sake tutori treat singlecel sampl secondli mani method visium_ x chromium_ slideseq_ seqscope_ spacemak provid predefin variabl use one method follow refquick start guid quick start guid instead step instal initi spacemak instal spacemak follow refinstal guid instal initi spacemak follow refiniti guid initi step download test data sake tutori work test dataset million read million read read visium_ adult mous brain download test data codeblock wget nv httpbimsbstaticmdcberlinderajewskyspacemaketestdatavisiumtest_fastqvisium_public_lane_joined_m_rfastqgz wget nv httpbimsbstaticmdcberlinderajewskyspacemaketestdatavisiumtest_fastqvisium_public_lane_joined_m_rfastqgz note alreadi data avail process analyz step omit step add new speci note initi spacemak downloadspeci flag omit step spacemak automat download configur mm mous genomefa annotationgtf file sampl work mous brain sampl add new speci codeblock consol spacemak config add_speci name mous annot pathtomouseannotationgtf genom pathtomousegenomefa step add new barcode_flavor barcode_flavor decid nucletodi readread extract umi cellbarcod perticular test sampl first nucleotid read cellbarcod follow nucleotid umi consequ creat new barcode_flavor like codeblock consol spacemak config add_barcode_flavor name test_barcode_flavor cell_barcod r umi r note sever barcode_flavor provid spacemak box visium x visium_ sc_x_v x chromium_ v kit default flavor ident dropseq_ librari nucleotid cellbarcod nucleotid umi refmor info provid flavor provid barcode_flavor want use one need add flavor step add new run_mod run_mod spacemak defin sampl process downstream tutori trim polya stretch end read count exon intron read expect cell analyz data turn multimapp count uniqu read count use umi cutoff set paramet defin test_run_mod like codeblock consol spacemak config add_run_mod name test_run_mod polya_adapter_trim true count_mm_read fals n_bead count_intronic_read true umi_cutoff note barcode_flavor spacemak provid sever run_mod box info refcheck detail guid configur run_mod step add sampl configur step readi add test sampl codeblock consol spacemak project add_sampl project_id test_project sample_id test_sampl r visium_public_lane_joined_m_rfastqgz r visium_public_lane_joined_m_rfastqgz speci mous barcode_flavor test_barcode_flavor run_mod test_run_mod note alreadi data avail read read fastqgz file ad instead test file step runn spacemak process sampl spacemak sinc ad one sampl one sampl process analyz start spacemak simpli write codeblock consol spacemak run core note number core use suit machin spacemak ran process one saml recommend use spacemak least core order achiev maximum parallel step result result analysi sampl projectstest_projectprocessed_datatest_sampleilluminacomplete_data directori sever file directori import finalpolya_adapter_trimmedbam final map tag bam file cb tag contain cell barcod mi contain umi qc_sheet_test_sample_no_spatial_datahtml qcsheet sampl selfcontain html file dge directori contain digit express matric dge dgeallpolya_adapter_trimmed_beadstxtgz compress text base dge dgeallpolya_adapter_trimmed_beadshad dge store format use anndata python packag httpsgithubcomtheislabanndataissues_ matrix store compress spars column matrix use scipysparsecsc_matrix httpsdocsscipyorgdocscipyreferencegeneratedscipysparsecsc_matrixhtml_ dgeallpolya_adapter_trimmed_beadssummarytxt summari dge one line per cell dgeallpolya_adapter_trimmed_beadsobscsv observ tabl matrix similar previou file detail automated_analysistest_run_modeumi_cutoff_ directori result autom analysi found seen automated_analysi directori two level one run_mod one umi_cutoff one sampl sever run_mod way one run_mod sever umi cutoff resultshad result autom analysi store anndata object dge contain process data test_sample_no_spatial_data_illumina_automated_reporthtml autom analysi selfcontain html report note test_project sampl would automat place projectstest_project similarili one spacemak directori sever project parallel directori structur project folder tutori toctre he_integr manual_he_integr process_single_cell_data longread manual align begin start make sure instal spacemak specifi refher instal manual allign use fiji opensourc imag process tool download httpsimagejnetsoftwarefijidownloads_ use tile nr seqscop httpswwwsciencedirectcomsciencearticleabspiis_ tutori correspond imag wt_x_jpg httpsdeepbluelibumichedudatadownloadsqvrw_ step gener express imag first use command line gener aggreg express imag directori spacemak project type codeblock consol spacemak spatial create_aggregated_expression_img project_id seq_scop sample_id seq_scope_liver_ run_mod seq_scop processed_data fals binari true out_img aggregated_seq_scope__img_bwpng gener black white imag base express data step load imag fiji next step load imag fiji like imag imgmanual_alignment_png width alt manual align first step step select correspond point next use multipoint tool manual select correspond point express imag imag select point one imag select correspond point imag least correspond point better match imag imgmanual_alignment_png width alt manual align second step step align imag use landmark correspond httpsimagejnetpluginslandmarkcorrespondences_ plugin align two imag base correspondenc point select previou step go plugin transform landmark correspond imag imgmanual_alignment_png width popup window select imag sourc imag express imag templat imag transform method select move least squar nonlinear set alpha mesh resolut set transform class affin imag imgmanual_alignment_png width transform two imag align save transform imag align spatial data imag imgmanual_alignment_png width step attach align imag first load spacemak process seqscop tile nr data codeblock ipython spacemak import spacemak spmk spacemakepathtoyourspacemakeproject adata_ spmkload_processed_adata project_id seq_scop sample_id seq_scope_liver_ run_mode_nam seq_scop umi_cutoff load previous manual align imag attach data codeblock ipython spacemakespatialhe_integr import attach_he_adata import cv matched_h cvimreadtransformedwt_x_tif adata attach_he_adataadata_copi matched_h push_by_spot_diameterfals raw_alignedtru attach plot express data top align scanpi httpsgithubcomtheislabscanpy_ codeblock ipython import scanpi sc scset_figure_paramsdpi scplspatialadata colortotal_count imag imgmanual_alignment_png width note axe scanpi flip respect axe fiji fiji read imag axe differ order manag project sampl spacemak sampl set store project_dfcsv root directori spacemak project sampl exactli one row project_dfcsv file backend spacemak use pandasdatafram load save csv file disk datafram index key project_id sample_id spacemak class respons backend logic refprojectdfprojectdf class add singl sampl sampl paramet spacemak sampl follo variabl project_id project_id sampl sample_id sample_id sampl r fastqgz file path read read file either singl file space separ list consecut file list provid file merg togeth merg rfastqgz process downstream r read read file longread option fastqgzfqgzbam file path pacbio long read librari debug longreadsignatur option identifi expect longread signatur see longreadyaml dge option sinc version spacemak possibl provid count matrix input data spacemak note raw count matrix expect non count matrix provid spacemak rais error barcode_flavor option barcode_flavor sampl provid default use dropseq speci speci sampl puck option name puck sampl puck contain barcod variabl path coordin file coordin use process sampl provid default puck use width_um spot_diameter_um puck_id option puck_id sampl puck_barcode_fil option path file contin xy posit barcod puck sampl barcod variabl ignor puck_barcode_fil use investig option name investig respons sampl experi option descript experi sequencing_d option sequenc date sampl run_mod option list run_mod name sampl sampl process defin run_mod provid provid default run_mod use add singl sampl use follow command spacemak project add_sampl project_id project_id requir sample_id sample_id requir r r r r requir longread r r r r requir longread longread longread requir r r longreadsignatur longread_signatur option barcode_flavor barcode_flavor option speci speci requir puck puck option puck_id puck_id option puck_barcode_fil puck_barcode_fil option investig investig option experi experi option sequencing_d sequencing_d option run_mod run_mod run_mod option warn sampl spatial either puck_barcode_fil provid sampl puck barcod variabl point barcod posit file case spacemak wont abl find spatial barcod sampl samp process singlecel sampl case puck_barcode_fil provid sampl puck barcod variabl set puck_barcode_fil use spatial coordin add visiumseqscopeslideseq sampl current spacemak work box three spatial method visium httpswwwxgenomicscomproductsspatialgeneexpression_ seqscop httpswwwsciencedirectcomsciencearticleabspiis_ slideseq httpspubmedncbinlmnihgov_ add visium sampl follow refquick start guid step add visium sampl add seqscop sampl follow refquick start guid step add seqscop sampl add slideseq sampl follow refquick start guid step add slideseq sampl add custom spatial sampl order process custom spatial sampl spacemak follow step step guid step specifi puck spatial sampl need socal puck configur first puck mean physic properti underli method visium instanc work mm mm size captur area spot micron diamet configur custom puck reffollow guid configur puck warn puck specifi spacemak still run use default puck specifi refher provid puck step format custom puck_barcode_fil spatial sampl need provid puck_barcode_fil file need comma tab separ need follow three name column cell_bc barcod barcod cellbarcod xcoord x_po xposit ycoord y_po yposit step configur run_mod barcode_flavor speci custom sampl ad run_mod barcode_flavor speci configur guid found refher runmod configur run_mod refher configur barcode_flavor refher speci configur speci configur run_mod specifi sampl process downstream barcode_flavor specifi barcod strategi use ie mani nucleotid use umi nucleotid use spot barcod warn run_mod provid spacemak use default run_mod specifi refher provid run_mod similarili barcode_flavor specifi spacemak use default barcode_flavor specifi refher provid barcode_flavor step add sampl everyth configur add custom spatial sampl follow command spacemak project add_sampl sampl project_id project_id project_id sampl sample_id sample_id sample_id one rfastqgz file r r r r one rfastqgz file r r r r name barcode_flavor configur step barcode_flavor barcode_flavor name speci configur step speci speci name puck configur step puck puck path custom barcod file configur step puck_barcode_fil puck_barcode_fil name run_mod configur step run_mod run_mod run_mod add singlecel sampl add singlecel sampl follow refquick start guid step add singlecel rnaseq sampl add preprocess countmatrix come soon add sever sampl _addseveralsampl possibl add sever sampl one command first sampl variabl defin samplesyaml file run follow command spacemak project add_samples_from_yaml samples_yaml samplesyaml samplesyaml follow structur codeblock yaml additional_project project_id visium sample_id visium_ r path_to_visium__rfastqgz r path_to_visium__rfastqgz speci mous puck visium barcode_flavor visium run_mod visium project_id visium sample_id visium_ r path_to_visium__rfastqgz r path_to_visium__rfastqgz speci human puck visium barcode_flavor visium run_mod visium project_id slideseq sample_id slideseq_ r path_to_slideseq__rfastqgz r path_to_slideseq__rfastqgz speci mous puck slideseq barcode_flavor slideseq_bc run_mod default slideseq puck_barcode_fil path_to_slideseq_puck_barcode_fil additional_project defin list element keyvalu pair insert project_dfcsv note use command sampl alreadi present project_dfcsv rather ad spacemak updat someon run spacemak project add_samples_from_yaml sampl yaml samplesyaml modifi someth samplesyaml run command project_dfcsv contain updat version set add sampl illumina samplesheet come soon list project list project alreadi configur ad simpli type spacemak project list show main variabl project project_dfcsv view extra variabl shown use variabl option specifi extra variabl show