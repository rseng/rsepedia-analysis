cite castro number castro paper describ part algorithm ask cite appropri paper describ capabl use gener code use use castro appreci cite recent code paper articlealmgren doi joss url httpsdoiorgjoss year publish open journal volum number page author ann almgren maria barrio sazo john bell alic harpol max katz jean sexton donald willcox weiqun zhang michael zingal titl castro massiv parallel compress astrophys simul code journal journal open sourc softwar welcom cite origin code paper well provid detail algorithm implement articleapja author almgren beckner bell jb day ms howel lh joggerst cc lijewski mj nonaka singer zingal titl castro new compress astrophys solver hydrodynam selfgrav journal apj archiveprefix arxiv eprint primaryclass astrophim keyword equat state gravit hydrodynam method numer nuclear reaction nucleosynthesi abund year month jun volum page doi x adsurl httpadsabsharvardeduabsapja adsnot provid saonasa astrophys data system also cite zenodo doi code releas bibtex entri latest releas found httpsdoiorgzenodo radiat hydrodynam use radiat hydrodynam capabl pleas addit cite follow articleapjsz author zhang w howel l almgren burrow bell j titl castro new compress astrophys solver ii gray radiat hydrodynam journal apj archiveprefix arxiv eprint primaryclass astrophim keyword diffus hydrodynam method numer radi transfer year month oct volum eid page doi adsurl httpadsabsharvardeduabsapjsz adsnot provid saonasa astrophys data system articleapjsz author zhang w howel l almgren burrow dolenc j bell j titl castro new compress astrophys solver iii multigroup radiat hydrodynam journal apj archiveprefix arxiv eprint primaryclass astrophim keyword diffus hydrodynam method numer radi transfer year month jan volum eid page doi adsurl httpadsabsharvardeduabsapjsz adsnot provid saonasa astrophys data system graviti rotat use poisson graviti solver rotat pleas cite follow includ lot improv coupl hydro graviti articleapjk author katz mp zingal calder ac swesti fd almgren zhang w titl white dwarf merger adapt mesh methodolog code verif journal apj archiveprefix arxiv eprint primaryclass astrophh keyword hydrodynam method numer supernova gener white dwarf year month mar volum eid page doi x adsurl httpadsabsharvardeduabsapjk adsnot provid saonasa astrophys data system gpu scale cpu perform number pleas cite inproceedingsjphcsaz author zingal almgren barrio sazo mg beckner bell jb friesen b jacob katz mp malon cm nonaka aj willcox de zhang w titl meet challeng model astrophys thermonuclear explos castro maestro amrex astrophys suit keyword astrophys instrument method astrophys booktitl journal physic confer seri year seri journal physic confer seri volum month may eid page doi archiveprefix arxiv eprint primaryclass astrophim adsurl httpsuiadsabsharvardeduabsjphcsaz adsnot provid saonasa astrophys data system gpu perform pleas cite articlearxivk author katz max p almgren ann barrio sazo maria eiden kiran gott kevin harpol alic sexton jean willcox e zhang weiqun zingal michael titl prepar nuclear astrophys exascal journal arxiv eprint keyword astrophys instrument method astrophys astrophys high energi astrophys phenomena year month jul eid arxiv page arxiv archiveprefix arxiv eprint primaryclass astrophim adsurl httpsuiadsabsharvardeduabsarxivk adsnot provid saonasa astrophys data system spectral defer correct nd th order sdc coupl hydro reaction pleas cite articleapjz author zingal katz mp bell jb minion ml nonaka aj zhang w titl improv coupl hydrodynam nuclear reaction via spectral defer correct journal apj keyword hydrodynam astrophys fluid dynam comput method comput astronomi astronomi softwar nuclear astrophys nucleosynthesi stellar nucleosynthesi physic comput physic astrophys instrument method astrophys year month dec volum number eid page doi abe archiveprefix arxiv eprint primaryclass physicscompph adsurl httpsuiadsabsharvardeduabsapjz adsnot provid saonasa astrophys data system doihttpszenodoorgbadgedoizenodosvghttpsdoiorgzenodo doihttpsjosstheojorgpapersjossstatussvghttpsdoiorgjoss amrexhttpsamrexcodesgithubiobadgespoweredbyamrexredsvghttpsamrexcodesgithubio ytprojecthttpsimgshieldsiostaticvlabelworkswithmessageytcolorblueviolethttpsytprojectorg github pageshttpsgithubcomamrexastrocastroworkflowsgithubpagesbadgesvghttpsgithubcomamrexastrocastroactionsqueryworkflowagithubpag castrohttpsgithubcomamrexastrocastroblobdevelopmentutillogocastro_logo_hot_png adapt mesh astrophys radiat hydrodynam simul code castro adaptivemesh compress radiat mhd hydrodynam code astrophys flow castro support gener equat state full poisson graviti reactiv flow parallel mpi openmp cpu mpi cuda gpu inform castro found httpamrexastrogithubiocastro get start get start section user guid walk run first problem httpsamrexastrogithubiocastrodocsgetting_startedhtml clone castro depend amrex starkil microphys user guid written restructur text use sphinx sourc castrodoc built automat develop branch run supercomput center document run amrex astrophys code popular supercomput center found httpsamrexastrogithubioworkflow call graph doxygengener call graph castro avail httpbenderastrosunysbeducastrostagingcastrohtml develop model develop gener follow follow idea new featur commit develop branch nightli regress test use ensur answer chang chang expect chang critic cherrypick commit develop main contribut welcom anyon form pull request fork castro target develop branch mistakenli target main chang pleas add line changesmd summar chang bug fix new featur refer pr issu appropri addit chang fix bug find bug fix current issu describ bug pleas file separ issu describ bug regardless signific bug possibl changesmd file issu pleas cite pull request number git commit hash problem introduc fix respect squash commit upon merg clean histori pleas ensur pr titl pr summari field descript sinc use squash commit messag first workday month perform merg develop main coordin amrex maestro microphys merg take place need pass regress test accommod need close merg window develop day merg day merg window close bug fix push develop merg develop main done merg window reopen core develop peopl make number substant contribut name core develop castro criteria becom core develop flexibl gener involv one follow nonmerg commit castrosourc castrodoc one problem scienc problem addit new algorithm modul substanti input code design process test core develop recogn follow way invit group slack team list user guid websit core develop list author list zenodo doi project given zenodojson file invit coauthor gener code paper proceed describ castro perform etc note scienc paper alway left scienc lead determin authorship core develop inact year may reassess statu core develop get help use github discuss ask gener question code httpsgithubcomamrexastrocastrodiscuss tile ad main loop mhd algorithm enabl scale perform increas use multipl thread openmp see issu castrohse_fixed_temp ad allow fix temperatur hse boundari enabl set posit valu set castrohse_interp_temp new option castrodrive_initial_convect ad use temperatur interpol initi model instead valu grid call reaction help prevent reactiv zone burn place convect veloc field establish carri energi burn_weight longer store default plotfil instead enabl set castrostore_burn_weight addit give better estim cost numer jacobian castrochange_max requir greater enforc timestep cap still allow timestep decreas use castromax_dt graviti modifi introduc parallel plane graviti point mass set radiu star castropoint_mass_location_offset integ castropoint_mass_offset_is_tru default paramet respect castrosource_term_predictor work simplifiedsdc disabl sourc predictor hydrodynam state interfac castroadd_sdc_react_source_to_advect ad disabl react sourc advect simplifiedsdc spong appli fulli implicit manner end ctu advanc rather use predictorcorrector approach time center consist origin form spong castro castro valid runtim paramet set input file commandlin set castroabort_on_invalid_param start releas problem setup written fortran longer support longer work pleas consult code document exampl problem setup exec understand new problem setup format need help convert fortran setup c pleas file issu spong paramet accept input file spong namelist probin file longer read ambient paramet accept input file ambient namelist probin file longer read update_sponge_param hook remov fortran problemspecif sourc file ext_src_ndf remov problemspecif sourc implement c problem_sourceh support legaci tag scheme base probin paramet denerr tempgrad etc remov replac equival tag criteria construct input file see doc exampl exec see use amrrefinement_ind fortran set_problem_tag hook remov c replac problem_tag problem_taggingh prescribedgrav function remov replac c implement want obtain function use problemdefin sourc term look problem_sourc document make appropri modif appli directli state eg momentum sourc term rho g custom radiat boundari use lo_bcflag hi_bcflag coupl implement rbndri remov longer store reactions_typ checkpoint file mean newer version castro restart old version paramet use_eos_in_riemann remov found instanc use option castroapply_sources_consecut remov simplifiedsdc correctli store reactiv part updat rho_enuc enuc rho_omegadot plotfil variabl axisymmetr geometri addit forc aris due chang direct unit vector divrho u u term paper bernandchampmartin discuss see issu add forc note corioli forc axisymmetri alreadi consist righthand system despit intern order state r z theta set microphys runtim paramet input file instead probin group paramet namesapc input file set way eg eosuse_coulomb c input valu take preced valu set probin set place minimum c standard support castro c modern compil support c notabl except rhel deriv like cento default compil gcc case newer compil must load particularli version gcc exampl instal devtoolset run hpc cluster provid modul use recent gcc modul multipl _prob_param file throughout sourc tree read problem file last take preced _prob_param file found timestep limit dtnuc_t remov dtnuc_ dtnuc_x still avail control burn timestep bug fix nd order true sdc reaction give wrong solut converg second bug fix defin weight radau quadratur use true sdc compil pgi compil longer requir cuda build castro recommend use compgnu version gcc c compliant gcc issu incorrect applic hse boundari condit deriv quantiti resolv also point old fortran implement hypfil denfil ext_hypfil ext_denfil remov problemspecif boundari condit implement use new c interfac releas minimum support hypr version switch fortran c implement vode microphys result also switch strang simplifi sdc burner castro use c implement network use castro alreadi port c network requir c implement network implement fortran useabl gpu eventu use c problem_checkpoint problem_restart move c fortran see execsciencewdmerg exampl new scheme problemf problem_fh delet code use implement problemspecif function still manual add file makepackag problem setup setup use poisson graviti tag turn locat fine level would adjac physic boundari previous led abort interfac problem tag c ad simplifi sdc support c integr mhd problem magnet field initi c minimum c standard support castro c modern compil support c notabl except rhel deriv like cento default compil gcc case newer compil must load particularli version gcc exampl instal devtoolset run hpc cluster provid modul use recent gcc modul new option castroretry_small_density_cutoff ad case small neg densiti retri may trigger updat move zone alreadi close small_den uncommon ambientfluff materi outsid star sinc zone dynam import anyway trigger retri unnecessari possibl counterproduct sinc may requir small timestep avoid set cutoff valu appropri retri skip densiti zone prior updat cutoff new refin scheme use input file rather fortran tag namelist ad exampl consid amrrefinement_ind den temp amrrefinedensmax_level amrrefinedensvalue_great amrrefinedensfield_nam densiti amrrefinetempmax_level amrrefinetempvalue_less amrrefinetempfield_nam temp amrrefinement_ind list userdefin name refin scheme defin name amrrefinenam accept predefin field describ tag current implement max_level maximum level refin start_tim start tag end_tim stop tag value_great valu refin value_less valu refin gradient absolut valu differ adjac cell refin field_nam name string defin field code refin indic ad either value_great value_less gradient must provid automat problem paramet configur avail everi problem place _prob_param file problem directori exampl found problem castroexec look set problem section document inform function option howev note file contain fortran modul name probdata_modul automat gener legaci probdataf file contain modul name renam variabl center problem namespac part automat gener probdata modul present time valid way chang problem center valu zero amrex_probinit initi problem paramet done automat call probdata_init longer requir amrex_probinit problem may initi c instead fortran instead implement amrex_probinit ca_initdata problem implement analog function initialize_problem initialize_problem_state_data switch new c initi sure delet prob_ndf file default implement noth pick either one pick extern heat sourc term routin port c problem use extern heat sourc look convert code c interpolate_ndf file move utilinterpol compil castro set use_interpolatetru reaction work mhd mhd use main slope routin order slope control plm_iorder hydro addit option mhd_limit_characterist determin limit done primit characterist variabl default rotation_typ remov statedata castrouse_post_step_regrid uncondit regrid everi timestep everi level issu gravitymax_solve_level result access invalid data resolv castrospeed_limit set number greater zero strictli enforc magnitud veloc use amr graviti rotat sourc term appli reflux would incorrect previou timestep retri fix abil access problemspecif runtim paramet c master branch renam main branch exist clone castro follow updat chang first git checkout master your alreadi old master branch git pull gather updat repo fail messag configur specifi merg ref refsheadsmast remot ref fetch simpli git checkout main local repo automat switch branch track updat upstream repo github like delet old master branch git branch master cuda build longer requir amrblocking_factor multipl though recommend perform reason previous requir due correct reason use amrex fortran function amrex_filccn note function longer requir due recent chang castro problem overrid bc_fill_ndf bc_ext_fill_ndf need provid initi fill ghost zone data implement specif boundari condit done call function may result race condit correct issu cuda build remov problem setup function permit rotat rate chang function time castrorotation_include_domegadt castrorotational_dpdt remov cuda illeg memori access error poisson graviti diffus fix paramet castrotrack_grid_loss remov paramet castroprint_fortran_warn longer effect remov ppm reconstruct ad mhd solver reactions_typ statedata rework first numspec compon rho omegadot rather omegadot numaux auxiliari compon store network auxiliari variabl rho enuc store enuc remov final burn weight store checkpoint version increment version code restart checkpoint gener earlier version code bug reflux amr level result incorrect result retri occur previou timestep fix paramet castrodensity_reset_method remov densiti reset uncondit set densiti small_den temperatur small_temp zero veloc constrainedtransport corner transport upwind mhd solver ad use compil use_mpi true present work singl level amr burn timestep limit dtnuc_t ad restrict burn updat temperatur factor dtnuc_t dtdt reaction weight metric implement version ad simplifi sdc reaction driver use simplifi sdc integr scheme save newtim reactions_typ data plotfil paramet use_custom_knapsack_weight associ function remov weve chang runtim paramet store previous static member respect class prevent use lambdacaptur function gpu runtim paramet group namespac extern manag data current scheme store reaction weight measur number rh evalu burn therefor proxi difficulti burn weight ad separ statedata depend runtim option use_custom_knapsack_weight instead place weight directli reactions_typ statedata new compon number ghost zone reactions_typ increas checkpoint version increment version code abl restart checkpoint gener earlier version code mean dt_cutoff chang fraction current simul time dt may smaller instead absolut measur set nonzero default e well backward compat restart checkpoint longer support checkpoint older version code determin checkpoint version castrohead file checkpoint directori restart ad option ctu reaction c compil flag use_cxx_react ad switch c integr microphys sinc phase implement network microphys optin core routin port c includ hydro diffus timestep estim spong amrex provid cpubndryfuncfab gpubndryfuncfab similar generic_fil hypfil amrex implement use still hypfil denfil function exist problem broken main one sourc longer call amrex_filcc ambient code problem overrid bc_fill_ndf thu longer requir call amrex_filcc alway issu timestep retri densiti advanc neg less small_den paramet castroretry_neg_dens_factor remov paramet castroretry_toler also remov longer effect timestep control paramet castrochange_max also prevent timestep shrink much one timestep previous would prevent grow much change_max violat timestep retri take grace step check problem setup initi densiti temperatur valu near small_den small_temp abort happen recours adjust small_den small_temp meaning valu problem src_q multifab remov instead convert conserv state sourc primit state sourc fab fab save lot memori expens eo call plm_well_balanc option remov essenti use_pslop except lower order work constant graviti use_pslop work ctuplm sdcplm new test problem hse_converg ad look behavior differ reconstruct method hse potenti undefin flux hll solver use hybrid_riemann fix paramet castroallow_small_energi remov code behavior similar would allow_small_energi intern energi never smaller allow small_temp bc interfac merg convert new fab interfac part port c boundari fill interfac hypfil denfil remov longer support overrid boundari condit data state_typ radiat still set custom boundari condit access input file describ doc convers ctu hydrodynam code c continu riemann solver convert c hybrid momentum routin plm reconstruct convers primit conserv variabl weve chang backup retri done present use_retri enabl make preemptiv copi statedata right begin timestep backup detect retri need depend fundament constant microphys instead keep copi castro remov ppm_predict_gamma option ctu hydro solver use frequent show much differ default rho e reconstruct microphys extern paramet avail c weve start convert ctu hydro solver fortran c ppm reconstruct done c option ppm_temp_fix remov use temperaturebas eigensystem characterist trace never use product scienc deriv variabl multipl compon compon ad plotfil previous first compon use updat workflow come castro depend previous castro ship minim set microphys allow basic problem setup like sedov compil advanc setup like one includ nuclear burn requir download starkillerastro microphys repositori addit step microphys repositori requir use castro current user microphys repositori prefer current workflow maintain microphys separ instal castro chang workflow necessari microphysics_hom set environ variabl castro use microphys instal directori howev also ad microphys git submodul castro requir path previous use advanc microphys also possibl previous use standalon microphys instal obtain use git submodul updat init recurs toplevel directori castro develop team ensur version microphys obtain way consist current version castro keep date code mostli normal except use git pull recursesubmodul instead git pull similarli amrex maintain git submodul rather extern standalon instal use git submodul command youll obtain amrex microphys may opt reli instal amrex set amrex_hom environ variabl howev respons keep sync castro use submodul youll get version amrex test ensur compat current version castro name conserv state variabl c densiti xmom etc chang match name fortran urho umx etc user code affect problemspecif setup code like probcpp refer specif state variabl compat kept copi old name around redirect new name old name consid deprec remov futur releas fix bug nuclear burn timestep estim gpu rewrot th order sdc hydro driver c allow code reus solver simplifi nd order sdc code dimension sweep reduc memori option radiationintegrate_planck remov use one test default alway full integr planck function radiat test problem move new opac directori rad_power_law paramet control behavior power law opac move extern probin modul alway expect pick specif opac implement paramet radiationuse_opacity_table_modul remov null opac implement previous move code fail compil attempt use need updat rad_power_law see document inform use new implement addit code multigroup solver effect previous set rosseland opac kappa_r equal planck opac kappa_p latter set former similar unintuit behavior behavior scatter paramet get exactli ask probin file given default _paramet file rad_power_law opac default constant coeffici neg invalid must set nonneg valu code work problem previous set const_kappa_p const_kappa_r set latter equal former maintain code behavior analog thing done expon kappa_p_exp_m kappa_p_exp_n kappa_p_exp_p paramet radiationdo_real_eo remov function enabl new equat state call rad_power_law new eo compat pure radiationdiffus test castrodo_hydro default use_retri instruct castro retri step smaller dt cfl violat burn failur neg timestep burn failur castro set microphys paramet abort_on_failur fals high prioriti overrid microphys default also check make sure combin paramet make sens runtim paramet castrohard_cfl_limit remov unnecessari clean_stat call remov support neutrino radiat diffus remov bug fix hydro cfl timestep estim simplifiedsdc timestep restrict need bug fix simplifiedsdc nuclear burn timestep estim new option castrolimit_fluxes_on_large_vel ad similar exist option limit_fluxes_on_small_den flux limit prevent veloc zone get high largest legal speed set castrospeed_limit gener previou solut propos castroriemann_speed_limit paramet remov amr paramet amrcompute_new_dt_on_regrid default avoid crash result cfl number larg regrid updat timestep see larger veloc still opt set want input file ad call hypr exist version new minimum requir castro radiat note hypr host github httpsgithubcomhyprespacehypr new option castrolimit_fluxes_on_large_vel ad similar exist option limit_fluxes_on_small_den flux limit prevent veloc zone get high largest legal speed set castroriemann_speed_limit new option castroapply_sources_consecut ad default add sourc term togeth option enabl add sourc one time sourc see effect previous ad sourc matter exampl spong sourc term may effect ad sourc term graviti updat veloc new option castroext_src_implicit ad extern sourc term previous implement explicit predictorcorrector scheme new option turn chang handl extern sourc term allow implicit solv done subtract full oldtim sourc ad full newtim sourc corrector rather respect still individu problem make sure consist scheme option turn add option use monopol bc set gravitymax_multipole_ord neg number use monopol graviti fill boundari condit rather multipl bc use debug purpos make behavior consist use multipol bc default well use_retri mechan enabl simplifi sdc time integr method case use_retri could result small last subcycl avoid longer alloc memori sourc speci conserv state unless prim_species_have_sourc set subroutin eos_on_host ad eo modul wrapper eo must use cuda build eo call probinit place dont run gpu use vode instead vode default new unit test ad model_burn read initi model call reaction network use test toler etc densiti flux limit simplifi fix race condit sdc algorithm use radau quadratur instead gausslobatto quadratur option castroppm_reference_eigenvector remov use default ctu ppm solver sdc algorithm implement burn condit depend rho react_rho_min react_rho_max react_t_min react_t_max sdcmol plm reconstruct implement reflect bc interfac state wellbalanc scheme ad piecewis linear sdc method enabl castroplm_well_balanac moment support constant graviti weight timenod flux store flux regist sdc fix choos reconstruct plm use castroplm_iord flag piecewis constant piecewis linear slope ad way specifi limit use linear slope castroplm_limit use nd order mc limit castroplm_limit use default th order mc limit previous way select nd order limit rungekutta base methodoflin integr method remov favor sdc integr new way specifi problem runtim paramet introduc specifi plain text file _prob_param compil time probdata_modul automat creat autom creation probdata variabl namelist read set manag cuda add abil output valu file like job_info featur optin need set use_prob_param gnumakefil defin problem paramet file _prob_param problem directori time output store job_info file sdc time advanc method document job_info file report number gpu use type castrognuex describ see list modul compil code built reaction quantiti comput proper th order averag plotfil use sdc_order velerr tag take ab veloc compon ensur tag larg posit neg veloc fix cuda compil remov special treatment th order outflow bc see slightli chang characterist trace done ctu ppm hydro solver use limit parabola edg state wave move toward interfac ctu ppm solver use lot less memori comput integr parabola need instead precomput store creat new error wrapper castro_error replac amrex amrex_error allow us deal error gpu new sdc solver substanti improv explicit thermal diffus implement nd th order accur solver new option castrosdc_extra take extra sdc iter newton solver sdc updat subcycl sdc_solver_relax_factor option fix absolut toler speci use error check sdc solv scale term jacobian fix use onesid stencil reconstruct physic boundari flame problem setup initi conserv preexist flame solut analysi routin seen improv work th order accur simul diffusion_test unit test work th order problem separ set boundari fill routin sourc term source_fillf previous handl generic_fillf tag routin reformul run gpu sinc tags_and_untag routin amrex gpuacceler opt directli fill tagboxarray tag routin pass tagbox fortran int_t mean interfac problem_tagging_ndf updat use integ castro_prob_err_listh relat file delet actual use anywher castro_errorcpp remov support write custom tag routin set variabl check tag hardcod castro expand need problemspecif tag done set_problem_tag function dimensionspecif code problem initi boundari condit extern heat term remov warn previou releas notic deprec notic releas dimensionspecif problem setup deprec present optin ad dimension_agnost true makefil use prob_ndf file instead prob_df file dimensionagnost prob_ndf use fill initi data dimens alway loop dimens unus dimens indic lo hi valid fortran current interfac found sourceproblemsprob_ndf problem convert dimensionagnost form remain one done shortli use eg sedov dustcollaps problem model problem dimens agnost problem setup also impli dimens agnost helper routin bc_fill_ndf userfac file end dddf file extens deprec releas support remov problem setup work dimens agnost pleas file issu need assist convert problem deprec notic releas problemspecif overrid castro_errorcpp gener custom tag routin includ castro_prob_errcpp associ file deprec support mechan problemspecif tag set_problem_tag function problem_tagging_ndf also dimensionspecif version file deprec pleas file issu need assist convert tag setup use problem tag need data interfac abl implement tag scheme support remov releas deprec notic releas problem_pre_tagging_hook problem_post_tagging_hook deprec actual use problem remov releas dimens agnost version extern sourc term ext_src_ndf updat use iso c bind interfac two paramet time dt pass valu see sourcesourcesext_src_ndf new interfac problem_derive_ndf renam problem_derive_ndf veloc calcul interfac riemann solv cgfcg riemann solver longer exceed speed light paramet castroriemann_speed_limit set control speed limit appli riemann solver use prevent unphys larg veloc creat shock front near larg densiti gradient algorithm recalcul sourc term amr reflux set data need correctli calcul posit fine level positiondepend sourc term rotat hybrid momentum calcul incorrectli caus strang effect amr simul rotat binari star orbit get wider time drift rel system center mass fix density_reset_method event densiti reset reset densiti begin timestep longer exist behavior use_retri retry_neg_dens_factor chang slightli sinc choos retri timestep base differ incorrect neg densiti densiti reset rather old densiti begin step still similar type timestep limit quantit timestep choos differ sign error fix hybrid_hydro angular momentum algorithm address issu commmit f chang sign introduc add_hybrid_momentum_sourc analog linear_to_hybrid runtim paramet castrofix_mass_flux remov clear use case test suit coverag fix bug introduc august result incorrect real bound pass ca_initdata restart problem use grown domain would result incorrect initi problem use grown restart capabl initi depend posit grid use pointmass graviti longer requir use_pointmass true makefil use_grav true suffici howev compens must includ castrouse_point_mass input file enabl point mass input paramet alreadi exist default sinc matter compil flag enabl default also coupl bug pointmass graviti fix algorithm correct resolv point mass valu preserv across restart issu your use point_mass_fix_solut updat point mass valu mass accret center domain fix well fix bug sourc term rho e evolut use mol new sdc integr also longer recomput sourc term reflux method dimens agnost problem setup interfac physic boundari condit chang hypfil denfil etc problem dimens agnost pleas consult new interfac sourceproblemsbc_fill_ndf understand convert problem chang ca_ prefix remov subroutin name time paramet pass valu lo hi indic target region updat boundari explicitli pass first two argument remov code extrapol diffus term ghost cell longer necessari remov enthalpi diffus known applic speci veloc diffus none routin regularli test problem diagnost castrodiagnost convert c remain compat amrex build system fix minor longstand bug simplifi sdc implement involv incorrect index chang result slightli number test involv reaction move hydro_test reacting_test old spectral defer correct method renam simplifi sdc access time_integration_method still requir build use_sdc true build way time integr method unavail th order hydro extend support gener equat state still singl level artifici viscos also ad framework new spectral defer correct method ad allow higherord time integr fix bug self_heat paramet initi burn timestep limit default longer alloc storag sourc term speci primit variabl state set via _variabl file pars set_variablespi allow speci sourc need set prim_species_have_sourc done current sdc renam qvar nqsrc make clear number sourc term primit variabl state also fix number place qvar use instead nq new runtim paramet t_guess creat use initi temperatur guess call eo input rho initi newton iter ctu hydrodynam driver rewritten c input paramet castrodo_ctu renam castrotime_integration_method current legal valu ctu default mol fix bug ppm_temp_fix reconstruct initi reconstruct temperatur flux limit use option limit_fluxes_on_low_den implement correctli fix pr ctu hydro solver longer alloc support routin done toplevel driver ctu solver make explicit rang cell loop transvers routin plotfil quantiti divu magvort fix axisymmetr coordin diff_term fix geometri abar new deriv variabl job_info file store domain inform job_info file also store checkpoint refin enuc nuclear energi gener rate control paramet tag probin namespac enucerr max_enucerr_lev also move dxnuc tag paramet input probin name dxnuc_min formerli castrodxnuc dxnuc_max max_dxnuc_lev diffus cutoff linear ramp instead discontin cutoff densiti less diffuse_cutoff_density_hi transport coeffici scale linearli densiti reach diffuse_cutoff_dens zero fix zenodojson user guid automat built develop branch use travi store job_info file checkpoint automat gener doxygen doc along user guid start ad docstr throughout code mg solver optim bit fix bug cuda version mol integr set interfac state incorrectli remov ppm_type use scienc simul never shown complet stabl near futur full fourth order method merg better replac bug fix sdc integr appli reactiv sourc term hydrodynam interfac predict appli sourc term plm transvers routin consist ppm version angular momentum plotfil comput respect center array initi probinit fix bug rotat ad sourc term outofplan veloc twice predict interfac state result overal firstord approxim fix issu result custom knapsack distribut map gener use distribut map reaction also fix edg case custom distribut map could caus numer overflow code crash rewrot reconstruct routin elimin temporari array make gpu friendli document convert sphinx chang interfac conduct routin conduct part eos_t weve restructur ctu solver longer use slab approach prepar offload solver gpu minor bug fix transvers routin ctu solver radiat simplifi conduct interfac match eo interfac move conduct variabl argument eo type fix handl extern bc unifi cuda hydro solver code methodoflin code offload graviti sourc term rotat reaction spong gpu cuda merg differ dimension version ctu consup routin singl routin remov unsaf option allow_negative_energi trace sourc nonzero save comput expens updat consist reset small intern energi e paramet dual_energy_update_e_from_ remov default behavior total energi e chang reset intern energi e caus chang simul output probin paramet eos_input_is_const true default mean call eo mode eos_input_r energi updat eo call eg newton iter scheme helmholtz caus chang simul output problemspecif runtim paramet probin written job_info file skip initi eo call prior burn redund alreadi clean_stat support recent version hypr old use_mlmg_solv paramet remov multigrid solver castro time paramet effect paramet dual_energy_eta remov introduc mostli test purpos end unnecessari also eo call begin burn remov provid modest comput gain answer may chang level eo toler function check regrid end timestep appli tag criteria t_sound t_enuc criterion bug fix occur retri trigger middl group subcycl rather begin advanc bug logic reflux use retri fix tag done rel gradient addit exist capabl absolut gradient exampl tempgrad_rel rel gradient criterion tag zone temperatur adjac zone temperatur differ tempgrad_rel tag enabl given level paramet max_tempgrad_rel_lev correspond new tag criteria field name similarli retri done dynam fashion advanc subcycl advanc alway keep subcycl done step default still singl timestep use_retri enabl help case reject timestep say cfl violat retri cfl criterion violat past would simpli abort run happen cut timestep keep go addit set abort_on_fals f probin file extern paramet burn microphys caus abort run castro know deal retri take shorter timestep logic burn failur come take larg hydrodynam timestep burner abl keep new gpu cuda hydrodynam solver base methodoflin solver ad base work initi done starlord work progress requir gpu branch amrex remov depend amrex f_boxlib sourc prepar sourc remov futur set number variabl compil time pars _variabl file interpret option set preprocessor note side effect chang number radiat group set compil time instead runtim chang need gpu port set number radiat group set ngroup eg group problem gnumakefil similar option exist neutrino relat chang possibl set number advect quantiti speci eo auxillari field via numadv gnumakefil new multilevel multigrid solver mlmg amrex framework default selfgrav construct oper explicit diffus new test problem classic doubl mach reflect ad fix issu retri logic could sometim result overflow estim number subcycl step improv behavior retri hit cfl violat gamma_ deriv variabl new diffus solver implement use new muligrid framework amrex comput diffus oper enabl diffusionuse_mlmg_solv job_info file indic runtim paramet chang default valu improv made th order hydro solver singlelevel option ppm_trace_sourc remov alway trace sourc term ppm addit sourc trace momentum sourc methodoflin integr rewritten work properli sourc note intend multilevel yet approxim state riemann solver split two part comput interfac state evalu flux interfac state give addit flexibililti use solver method paramet dtnuc_mod remov initi use test variou form burn timestep limit final form settl minor inconsist extern diffus sourc term construct simultan use reaction fix deprec paramet castrouse_colglaz remov deprec june obsolet paramet castroriemann_solv set use colella glaz riemann solver state variabl indici fortran defin singl file sourcedriver_vari make much clearer consist allow autodocument cleanup gpu acceler futur spong oper base pressur new paramet belong spong namelist name sponge_lower_pressur sponge_upper_pressur work principl densiti spong spong drive system particular veloc default still zero veloc new paramet belong spong namelist probin file name sponge_target_xyz_veloc sdc_source_typ statedata remov purpos supplant chang alway keep sourc term statedata see thu redund chang code output mean old checkpoint gener use sdc longer compat current code normal strive maintain forward compat checkpoint chang consid justifi sdc still consid experiment featur develop knowledg product scienc run yet done use sdc paramet gravitymax_solve_level remov ad work around converg issu multigrid solv converg issu sinc fix paramet longer use source_typ statedata hold actual old newtim sourc previous held sourc term predictor statedata use fill sources_for_hydro multifab provid sourc term use hydrodynam updat sinc statedata oper done fillpatch consequ sources_for_hydro data meaning data physic domain ghost zone ghost zone coarsefin interfac previous meaning data fulli interior ghost zone checkpoint old new data chang result differ simul output simul sourc term answer differ boundari coarsefin interfac relat bug use sdc fix paramet castrokeep_sources_until_end remov sourc term graviti rotat etc coalesc singl multifab reduc memori footprint code negat need code paramet update_state_between_sourc coalesce_update_diagnost remov caus chang result previou code behavior updat state success sourc term appli new time everi sourc term calcul use newtim state one come hydro sourc term appli state one shot end note old approach secondord accur time problem combin multipl sourc term caus chang larger roundoff particular rotat use conjunct sourc term chang rel larg corioli forc depend veloc sourc term bit differ see differ veloc new option castroplot_per_is_exact set timestep shorten exactli hit time interv specifi amrplot_p issu fix incorrect timestep would taken restart previou step shorten use new multigrid solver amrex implement c instead older fortran solver enabl gravityuse_mlmg_solv note work current sever option gravitymlmg_max_fmg_it integ paramet determin mani fmg cycl perform switch vcycl gravitymlmg_agglomer boolean flag determin amr level grid agglomer grid coarsen multigrid hierarchi gravitymlmg_consolid boolean flag determin grid amr fine level singlelevel solv lowest amr level multilevel composit solv consolid grid coarsen multigrid hierarchi consolid mean grid move fewer mpi process numer experi show scale better old solver appli sourc state ghost zone fix ensur advanc give valid updat ghost zone state_typ minor bug fix releas correspond releas amrex bug fix noncartesian simul amr spheric cylindr bug introduc around version result incorrect synchron pressur term momentum equat effect would manifest nonconserv momentum strang effect coarsefin interfac spong alway time center option otherwis introduc remov addit form energi sourc term correct time center case brought line energi sourc term sourc issu issu fix bug fix conductivity_dir renam conductivity_dir consist eos_dir network_dir longer get composit deriv part eo call need function need set preprocessor variabl fortran extra_thermo use system bla routin instead compil version microphys set use_system_blastru look blas_librari link line sometim use abl sort initi phase simul stop checkpoint restart possibl differ option main phase run case may want reset simul time zero analysi purpos new option castroreset_checkpoint_tim allow set time want checkpoint gener new time similarli castroreset_checkpoint_step allow reset timestep number exampl option work your use amrcheckpoint_on_restart requir amrregrid_on_restart option intend use case your gener checkpoint also need temporarili set max_step stop_tim target valu your reset prevent step restart new checkpoint undo temporari variabl continu run usual minor error graviti sourc term fix error normal observ fix bug artif viscos noncartesian geometri issu readmemd describ process becom core develop castro mean network_dir renam network_dir eos_dir renam eos_dir problem gnumakefil updat old name continu work near futur user encourag chang problem use new allcap name pr densiti flux limit function small toler also document timestep retri conserv accomplish save densiti flux use conserv graviti updat also bug timestep retri poisson graviti fix sourc directori structur reorgan put sourc file directori physic elimin src_d src_d subdirectori riemann solver merg singl dimensionalagnost version src_nd issu godunov state cg solver store interfac would affect intern eneri evolut plm ppm reconstruct routin merg singl dimensionalagnost version hydro characterist trace routin merg dimensionalagnost version hydro radiat chang fix outstand issu plm reconstruct use refer state issu option castrolimit_fluxes_on_small_den limit densiti name suggest origin also limit flux intern energi would go neg caus problem run mpi remov strictli need anyway normal logic handl neg intern energi reliabl two error fix implement trigger regrid end timestep method correctli conserv fluid variabl coarsefin boundari xgraph stuff output xmgrcompat ascii profil fix bug graviti runtim paramet properli initi fortran side code viscos routin separ conduct microphys also castro use stellar conduct part starkil starkillerastro microphys repo use denser tabl helmholtz eo thank frank timm use eo new tabl softlink build directori automat old copi lay around might fail run io error start code clean eventu gpu offload support merg starlord ad framework methodoflin integr hydrodynam characterist trace instead reconstruct multipl stage ode integr moment radiat support requir amrex librari instead boxlib librari microphys repositori reli eo reaction network part starkillerastro github chang clone refer via git remot seturl origin sshgitgithubcomstarkillerastromicrophys new mechan use stabil criterion trigger regrid end timestep ad pr clean logic momentum flux limit_hydro_fluxes_on_small_den issu protect ad retri code rewrot conserv graviti formul work potenti give best conserv amr equival descript appendix b katz et al new reflux method introduc remov determin provid benefit accuraci new deriv plot variabl avail use thermal diffus includ conduct diffus coeffici entir diffus term energi equat issu deriv variabl store plotfil store mass fraction twice eg save xhe latter store creat post_simul function call end simul exampl provid test_diffus output norm error analyt solut issu diagnost inform sourc term updat state overhaul made uniform sourc term includ hydro reset print chang state format paramet print_energy_diagnost renam print_update_diagnost new paramet coalesce_update_diagnost ad combin oldtim newtim updat one print issu support singl doubl precis float point declar use amrex_r type defin amrex_fort_modul set singl doubl precis compil time constant also use type breviti renam rt use statement issu spong timecent default issu ppm_temp_fix stuff document made consist across dimens issu job info git inform output git describ give inform includ last tag far tag abbrevi hash also indic work directori dirti radiationspecif version computetemp remov instead everyth goe main castro computetemp affect particular treat small intern energi radiat issu radiationspecif version umeth consup merg pure hydro routin give roundoff level differ also use veloc compon kinet energi correct radiat issu minor bug fix radiat characterist trace regard gamma_ gamc use fix restart bug radiat introduc cherrypick develop issu boxlib requir c compil default part transit parray replac c array addit chang boxlib build system mean need suppl comp compil fcomp ignor user guid updat reflect current flow algorithm distinguish graviti includ constant gravit acceler selfgrav graviti self_grav preprocessor direct work sync level done describ forthcom paper main chang default reflux recomput valu sourc term affect level newtim sourc term know updat state due flux graviti resembl origin castro paper describ sync sourc done consist way sourc term fairli cheap enabl default disabl see castroupdate_sources_after_reflux addit option chang new strategi reflux see castroreflux_strategi exist standard method reflux fine timestep coars timestep complet new method partial reflux end fine timestep mean coars state use time interpol fine level slightli accur go later fine timestep also need selfconsist conserv energi graviti present expens standard method graviti sync solv tradeoff simul accur order comput temperatur reset intern energi chang spot chang result default radiationspecif sourc move radiat subdirectori paramet first_order_hydro move radiat namespac castro namespac problem setup move subdirectori categori make easier read issu way use toler multigrid solv poisson graviti chang old behavior would pass gravityml_tol rel toler grid level absolut toler would use suffer defect notabl fine grid often loosen rel toler higher level achiev converg certain case scheme would fail complet exampl fine grid cover mass grid use input paramet gravityabs_tol control absolut scale toler either array valu one level singl scalar valu latter absolut toler pass multigrid scheme toler multipli maximum valu rh entir domain coars grid absolut toler pigrho_maxabs_tol fine grid multipli ref_ratio specifi gravityabs_tol reason valu select coars level scheme use give reason valu fine level well paramet gravityml_tol renam gravityrel_tol mean default zero gravityml_tol deprec remov futur releas note toler use determin converg alway less restrict rel absolut toler requir gravitydelta_tol remov issu radiat hydro solver use live castroradiationgit complet integr main castro git repo histori preserv transit also clean littl issu radiat build variabl network_input renam network_input consist eos use come castroradi avail microphysicsgit graviti diffus runtim paramet move master _cpp_paramet file issu enthalpi speci temperatur diffus properli timecent issu bug hi boundari inflow boundari condit diffus fix issu flux limit ad limit size hydro flux would caus rho rho e go neg use castrolimit_hydro_fluxes_on_small_den bug singlelevel problem poisson graviti fix multigrid toler set uniniti valu flaw sourc term primit variabl hydro updat fix sourc term like graviti longer affect pressur rho e interfac state issu predict sourc term halftim use hydrodynam reconstruct done properli fix issu radiat hydro ppm implement ppm_predict_gamma option longer ship vode bla castro provid separ microphys git repo document architectur castro significantli improv issu ppm trace routin radiat sync pure hydro version particular support ppm_trace_sourc implement refer state fix issu flatten ppm routin also updat support trace predict gamma_ instead rho e inconsist flatten fix paramet ppm_refer ppm_reference_edge_limit remov reason use anyth default paramet ppm_tau_in_trac remov use part preserv ppm_predict_gamma function use differ set primit variabl tau u p gamma_ predict interfac state flux correct axisymmetr spheric coord fix particular separ flux regist pressur term enter gradient momentum equat sign gravit potenti flip consist usual convent physic literatur ie potenti neg solv del phi pi g rho castro_advancecpp significantli clean sourc term graviti rotat diffus etc multifab associ affect state data chang result slightli typic rel chang larger e level due updat order oper consist usag ghost zone iter solver coupl reaction hydrodynam introduc enabl use_sdc true makefil number iter done timestep control castrosdc_max_it chang default graviti rotat sourc grav_source_typ rot_source_typ default conserv formul energi equat incorpor sourc flux energi equat see katz et al detail also implicit_rotation_upd default slightli better coupl corioli forc momentum equat implicit veloc updat also make ppm_trace_sourc default parabol reconstruct momentum sourc trace construct interfac state set castrocg_blend default effect default cgf riemann solver colella glaz solver castroriemann_solv augment secant iter pstar find bisect fail converg make root find star state robust new fake setup riemann_test_zon use send left right hydro state cg riemann solver test act unit test solver default castroallow_negative_energi safer choic default castropoint_mass_fix_solut chang expect behavior new user new paramet gravitymax_multipole_moment_level ad come play use multipol solver comput boundari condit domain isol mass distribut default behavior castro construct boundari condit graviti solv multipol expans sum densiti coars grid increas valu new paramet default higher number use data refin level construct boundari condit valu file sponge_ndf sourcesrc_nd renam sponge_ndf file extens chang indic run preprocessor pleas updat local name file your overrid problem setup spong updat usual done implicit fashion instead explicit updat castrosponge_implicit shock variabl output run shock detect enabl microphysicseo microphysicseo number chang done microphys repo see microphysicschang log consist across boxlib suit astro code weve renam main environ variabl castro_hom replac castro_dir microphysics_hom replac microphysics_dir eo network conduct routin move subdirectori castromicrophys reflect way layout standalon microphys repo well maestro routin sourcesrc_nd renam f file f file use preprocessor use prob_ndf problem_tagging_ndf rotation_frequencyf ext_src_ndf local copi problem directori overwrot pleas sure updat file extens castro recogn use allow_negative_energi case rhoe total ga energi zone neg indirectli cover would reset case due way logic work reset intern energi updat total energi consist howev one point ad option castrodual_energy_update_e_from_ disabl second updat also meant neg rhoe possibl possibl preclud directli reset rhoe way detect neg chang result unless use castrodual_energy_update_e_from_ also good time plug newer option castroallow_small_energi set reset hit rhoe less smallest possibl energi rho small_temp x zone note requir extra eo call default interpol coars zone fine zone piecewis linear option use piecewis constant instead set castrostate_interp_ord note use piecewis linear set castrolin_limit_state_interp want preserv linear combin therefor guarante say sumx set new option castrolimit_fluxes_on_small_den flux explicitli limit neg densiti never creat along similar line also new option reset neg densiti one aris set castrodensity_reset_method use averag adjac zone instead default characterist adjac zone highest densiti set want reset origin zone state hydro updat fix issu diffus work correctli add_ext_src diffus sourc term independ whether userdefin sourc term convertcheckpoint live util usersguid doc consist boxlib code burn longer done ghost cell boundari neighbor level refin instead ghost cell fill done fill likelevel neighbor cell consequ chang reset_internal_energi invok cell reset intern energi e k reset reflect ghost cell consist behavior previous energi never reset ghost cell titl castro massiv parallel compress astrophys simul code tag c fortran convect hydrodynam nuclear reaction nucleosynthesi abund supernova author name ann almgren orcid x affili name maria barrio sazo orcid affili name john bell orcid x affili name alic harpol orcid x affili name max katz orcid affili name jean sexton orcid affili name donald willcox orcid affili name weiqun zhang orcid affili name michael zingal orcid x affili affili name center comput scienc engin lawrenc berkeley nation laboratori index name depart physic astronomi stoni brook univers index name nvidia corpor index name center comput astrophys flatiron institut index date juli bibliographi paperbib summari castro highli parallel adapt mesh multiphys simul code compress astrophys flow use simul differ progenitor model type ia supernova xray burst corecollaps electron captur supernova dynam exoplanet togeth castro low mach number code maestroex maestroex cosmolog code nyx nyx make amrexastrophys suit opensourc adapt mesh perform portabl astrophys simul code core hydrodynam solver castro castro base direct unsplit corner transport upwind method ctu piecewis parabol reconstruct ppm model reactiv flow stellar environ core capabl castro astrophys reaction network stiff requir implicit integr techniqu accur stabl solut castro sever mode coupl reaction hydro simplest method tradit oper split approach use strang split achiev secondord time howev reaction energet coupl break two differ implement base spectral defer correct sdc method aim prevent hydro reaction becom decoupl simplifi sdc method use ctu ppm hydro togeth iter scheme fulli coupl reaction hydro still second order simple_sdc altern implement tradit sdc method coupl hydro reaction second fourthord space time castro_sdc present method singlelevel strang split simplifi sdc method retri scheme timestep reject retri smaller subcycl timestep burn solv fail meet toler neg densiti gener violat one timestep criteria addit reactiv hydrodynam castro includ full selfgrav isol boundari condit rotat implement energyconserv fashion explicit thermal diffus gray castroii multigroup castroiii flux limit diffus radiat hydrodynam constrain transport mhd solver base ctu algorithm also avail use physic sourc term castro use arbitrari equat state reaction network microphys routin provid starkil project starkil castro built amrex amrex adapt mesh refin amr librari larg written c fortran comput kernel amr level advanc timestep subcycl jump factor support level use mpi distribut amr grid across node use logic tile openmp divid grid across thread multicor cpu machin expos coarsegrain parallel cuda spread work across gpu thread gpubas machin finegrain parallel core physic run gpu shown scale well thousand gpu castro_ hundr thousand cpu core castro_ perform portabl use sourc code cpu gpu implement parallel loop abstract layer provid amrex abstract parallel loop accept argument rang indic bodi loop execut given index amrex backend dispatch work appropri eg one zone per gpu thread strategi similar way kokko kokko raja raja abstract model provid perform portabl c statement need number astrophys hydrodynam simul code castro offer uniqu featur origin motiv develop castro build simul code base modern wellsupport amr librari boxlib evolv amrex use unsplit integr techniqu target problem nuclear astrophys radiat solver key design consider earli develop larg develop commun contribut amrex repres larg number applic code across variou domain result castro continu gain optim new architectur castro evolv adopt fulli open develop model enzo enzo code exampl pride make scienc problem avail castro git repositori develop infrastructur use run problem write scienc paper publicli avail amrexastro organ simul code like flash flash also work gener equat state reaction network castro uniqu focus spectral defer correct techniqu coupl hydro reaction final astrophys code perform portabl fork like kathena kathena use kokko castro current design target cpu gpu solver achiev perform portabl core design principl avoid need fractur develop model acknowledg work stoni brook support doeoffic nuclear physic grant defger nsf award ast mz acknowledg support simon foundat research support exascal comput project scsc collabor effort us depart energi offic scienc nation nuclear secur administr work lbnl support us depart energi contract deacch also thank nvidia corpor donat titan x pascal titan v use research gpu develop castro benefit greatli numer gpu hackathon arrang olcf refer radiat diagnost directori contain diagnost castro radiat test gaussian_puls process gaussian radiat puls lgt_frntd process radi sedov problem produc rho u p function r comparison analyt solut rad_shock extract slice data radi shock test variabl singl variabl along specifi coordin direct plotfil plotfil rad_sourc analysi routin radiat sourc test take list file print rho e total radiat energi densiti first zone function time rad_spher print radiat quantiti specifi distanc origin written radiat sphere problem rhd_shocktub analysi routin rhd_shocktub build build one radiat diagnost specifi execut name target eg make dim rad_sphereex take care compil correct dimens ie set dim equal valu code gener plotfil investig run command line argument must pass execut provid plotfil anaylz problem paramet gaussian_puls p plotfile_nam plotfil provid plotfil slicefile_nam slicefil provid name file output result xctr x yctr provid coordin center domain xy provid default lgt_frntd p plotfile_nam plotfil provid plotfil slicefile_nam slicefil provid name file output result rad_shock p plotfile_nam plotfil provid plotfil slicefile_nam slicefil provid name file output result idir direct along take slice integ correspond xz direct default rad_sourc argument assum list plotfil analyz rad_spher p plotfile_nam plotfil provid plotfil g groupfile_nam groupfil provid name group file output runtim radspher problem r radiu radiu provid radiu print radiat quantiti rhd_shocktub p plotfile_nam plotfil provid plotfil g groupfile_nam groupfil provid name group file output runtim radspher problem slicefile_nam slicefil provid name file output result sedov diagnost process sedov problem produc rho u p function r comparison analyt solut build run ndimension diagnost built execut make dimn produc execut sedov_ndex run execut must provid list argument problem must provid name plotfil analyz name slicefil result shall output sedov_ndex p plotfile_nam slicefile_nam addit argument depend problem addit argument requir cylindr extra arguent xctr x yctr give coordin domain center xy provid default spheric argument sphr must provid indic spheric problem yctr argument provid give coordin domain center default cylindr extra arguent xctr x yctr give coordin domain center xy provid default spheric argument sphr must provid indic spheric problem extra arguent xctr x yctr zctr z give coordin domain center xyz provid default sedov diagnost routin diagnost routin diagnosticsdustcollaps use construct data appear figur first castro paper analyt maximum densiti comput initi densiti analyt rt use conserv mass hardwir maincpp file radiu star plotfil comput first comput radial averag densiti find radiu densiti equal half analyt maximum densiti build run type make dimn build diagnost routin ndimension problem run problem run dustcollapse_dex plotfil plotfil ie run execut follow list plotfil analyz problem addit argument pass list plotfil give coordin domain center provid default problem would dustcollapse_dex xctr x yctr plotfil plotfil similarli dustcollapse_dex xctr x yctr zctr z plotfil plotfil problem also possibl print profil file provid argument profil creat profil file profprofil plotfil directori analyt solut make analyt profil type gfortran analyticf aout analytictxt plot use gnuplot make figur use dustcollapsegp creat file analytictxt results_dtxt results_dtxt results_dtxt thank pr pleas provid descript titl fill follow field best note pr target develop branch follow style convent httpsamrexastrogithubiocastrodocscoding_conventionshtml pr summari pleas summar pr squash merg pr summari suitabl commit messag pr address issu refer issu well pr motiv pleas describ motiv pr appropri section includ commit messag use commun develop pr accept section option delet pr checklist test suit need run pr pr chang answer test suit roundoff level newlyad function docstr per code convent chang file updat appropri appropri chang describ doc sampl script volum render yt origin written wd merger problem mind volwdpi script basic volum render use perspect len volwdsphericalpi script spheric project pi steradian camera set origin use creat degre video upload youtub note prepar video youtub follow instruct httpssupportgooglecomyoutubeanswerhlen particular need add metadata video done googl spatial media metadata injector httpsgithubcomgooglespatialmediablobmasterspatialmediareadmemd construct logo creat bitmap slice wdmerger simul use script logopi use gimp resiz imag interact star cut axe use imag crop select open inkscap import imag use file import select imag use path trace bitmap set color check remov background box select largest element resiz canva use edit resiz page select problem radiationhydro sedovtaylor like blast wave castro paper ii default case one section kp variant larg planck mean opac one section radfront setup base opticallythin stream radiat front describ castro paper ii differ instead defin bc er im use correspond valu fr assum optic thin frcer fill region radiat im use do_hydro instead hyperbol updat medium low densiti temperatur im use valu rosseland planck coeff version domain size cm wherea x cm opac chang similar optic depth along domain setup case seen radiat front propag speed light problem setup pure diffus problem hydro use explicit diffus solver castro diffus gaussian thermal puls diffus castro incorpor energi equat solv dedt k l laplacian k thermal conduct assum k constant castro requir assumpt problem take  constant use gammalaw eo e c_v take form diffus equat dtdt k c_v constant diffus coeffici diffus explicitli constraint timestep dt dxd constant diffus coeffici analyt solut diffus gaussian remain gaussian amplitud descreas width increas time test problem creat deriv variabl analyt analyt solut time plotfil output allow compar current solut analyt solut assess error also use castro problemspecif postsimul hook probcpp output linf norm error numer vs analy solut end simul use converg test spheric amr use nd order accur predictorcorrector formul diffus use ctu hydrodynam solver test diffus spheric coordin level refin run castrodgnuex inputsdsph castrodgnuex inputsdsph amrn_cel castrodgnuex inputsdsph amrn_cel end run report norm error analyt solut give base resolut linf error e e sdc converg test thorder sdc algorithm run castrodgnuex inputsd castrotime_integration_method castrosdc_ord amrn_cel castrodgnuex inputsd castrotime_integration_method castrosdc_ord amrn_cel castrodgnuex inputsd castrotime_integration_method castrosdc_ord amrn_cel castrodgnuex inputsd castrotime_integration_method castrosdc_ord amrn_cel note cartesian spheric sinc dont spheric implement th order norm error output end function resolut resolut linf error e e e e nonconst conduct analyt solut nonconst conduct converg test vari resolut manner error report end run meaningless sinc compar analyt solut constant conduct secondord predictorcorrector algorithm powerlaw conduct simpli k k t build test conduct make dim conductivity_dirpowerlaw j test run castrodgnuex inputsdpowerlaw amrn_cel mv diffuse_plt diffuse_ castrodgnuex inputsdpowerlaw mv diffuse_plt diffuse_ castrodgnuex inputsdpowerlaw amrn_cel mv diffuse_plt diffuse_ error measur use richardsonconvergencetest tool amrextoolsc_utilconverg richardsonconvergencetestdgnuex coarfilediffuse_ medifilediffuse_ finefilediffuse_ give level l norm error compon warn boxarray length level level l norm error compon warn boxarray length level begintablep begincent begintabularcccc hline variabl e_h rightarrow h order e_h rightarrow h hline densiti e e xmom e e ymom e e zmom e e rho_e e e rho_e e e temp e e rho_x e e bit edit eg see secondord converg temperatur th order sdc built previou test make dim conductivity_dirpowerlaw j run castrodgnuex inputsdpowerlaw castrotime_integration_method castrosdc_ord amrn_cel mv diffuse_plt diffuse_ castrodgnuex inputsdpowerlaw castrotime_integration_method castrosdc_ord mv diffuse_plt diffuse_ castrodgnuex inputsdpowerlaw castrotime_integration_method castrosdc_ord amrn_cel mv diffuse_plt diffuse_ castrodgnuex inputsdpowerlaw castrotime_integration_method castrosdc_ord amrn_cel mv diffuse_plt diffuse_ richardsonconvergencetestdgnuex coarfilediffuse_ medifilediffuse_ finefilediffuse_ convergence_diffusiondlosdcout richardsonconvergencetestdgnuex coarfilediffuse_ medifilediffuse_ finefilediffuse_ convergence_diffusiondhisdcout give lower resolut run level l norm error compon warn boxarray length level level l norm error compon warn boxarray length level begintablep begincent begintabularcccc hline variabl e_h rightarrow h order e_h rightarrow h hline densiti e e xmom e e ymom e e zmom e e rho_e e e rho_e e e temp e e rho_x e e pressur e e eg see fourthord converg temperatur th order sdc built previou test make dim conductivity_dirpowerlaw j use_mpitru run mpiexec n castrodgnumpiex inputsdpowerlaw castrotime_integration_method castrosdc_ord amrn_cel mv diffuse_plt diffuse_d_ mpiexec n castrodgnumpiex inputsdpowerlaw castrotime_integration_method castrosdc_ord mv diffuse_plt diffuse_d_ mpiexec n castrodgnumpiex inputsdpowerlaw castrotime_integration_method castrosdc_ord amrn_cel mv diffuse_plt diffuse_d_ mpiexec n castrodgnumpiex inputsdpowerlaw castrotime_integration_method castrosdc_ord amrn_cel mv diffuse_plt diffuse_d_ richardsonconvergencetestdgnuex coarfilediffuse_d_ medifilediffuse_d_ finefilediffuse_d_ convergence_diffusiondlosdcout richardsonconvergencetestdgnuex coarfilediffuse_d_ medifilediffuse_d_ finefilediffuse_d_ convergence_diffusiondhisdcout give lower resolut run level l norm error compon warn boxarray length level level l norm error compon begintablep begincent begintabularcccc hline variabl e_h rightarrow h order e_h rightarrow h hline densiti e e xmom e e ymom e e zmom e e rho_e e e rho_e e e temp e e eg see fourthord converg temperatur model_burn take initi model read via model_pars simpli call burner zone initi model hse_converg meant simpl test assess converg hydro graviti maintain hse converg measur either richardsonconvergencetest tool look max u plotfil run problem use one converg script convergence_plmsh run ctu plm use default hse bc default use_pslop reflect bc without use_pslop final run reflect instead hse bc test show best result come hse bc reflect vel convergence_ppmsh run ctu ppm similar set configur plm one addit one grav_source_typ test show best result come hse bc reflect vel convergence_sdcsh use true_sdc integ first sdc plm reflect bc sdc ppm reflect bc hse bc final sdc reflect test show plm reflect use wellbalanc use_pslop sdc reflect give lowest error expect better converg evrard collaps problem collaps isotherm spheric ga cloud problem origin discuss evrard implement test come section springel v monthli notic royal astronom societi volum issu pp section hse_convergence_gener hse converg test problem base flame_wav meant run understand well preserv hse problem reacting_converg reaction test use measur converg react hydro built acoustic_pulse_gener test converg test castroexecreacting_testsreacting_converg make compintel j output directori mkdir reacting_converg cd reacting_converg cp castroexecreacting_testsreacting_convergencecastrodintelhaswellmpiex cp castroexecreacting_testsreacting_convergenceinput cp castroexecreacting_testsreacting_convergenceprobin cp castroexecreacting_testsreacting_convergencehelm_tabledat cp castroexecreacting_testsreacting_convergencejob_scriptscorireacting_convergenceslurm sbatch corireacting_convergenceslurm analysi output directori cp developmentcastroexecreacting_testsreacting_convergenceanalysischeck_convergencesh cp developmentcastroexecreacting_testsreacting_convergenceanalysiscreate_pretty_tablespi edit use bash give proper execut name check_convergencesh output set converg data file process set latex tabl row python create_pretty_tablespi bubble_converg problem develop test converg th order sdc solver graviti reaction reflect boundari condit featur castro sdc paper httpsuiadsabsharvardeduabsapjz measur converg script converge_testsh test converg bubbl rise problem run test differ resolut resolut shown paper build make use_true_sdctru j run test via converge_testsh reli built richardsonconvergencetest amrextoolsc_utilconverg put execut path output file produc sdc_convergeloout sdc_convergemidout sdc_convergehiout give order converg run respect creat summari tabl use create_pretty_tablespi eg mid hi resolut case would python create_pretty_tablespi simpl sdc_convergemidout sdc_convergehiout give rho e e e rho u e e e rho v e e e rho e e e e rho e e e e e e e rho xisotmh e e e rho xisotmc e e e rho xisotmo rho xisotmf essenti valu shown tabl castro sdc paper hse converg setup also use test hse converg build make use_true_sdctru use_reactfals j run test converge_test_sdc_nopertsh get maximum veloc fextremagnuex bubble__plt grep magvel fextremagnuex bubble__plt grep magvel fextremagnuex bubble__plt grep magvel give max u e demonstr nearli th order converg hse state origin cori converg test result castro sdc paper run cori use file job_script castroexecreacting_testsbubble_converg make use_true_sdctru compintel j output directori mkdir bubble_converg cd bubble_converg cp castroexecreacting_testsbubble_convergencecastrodintelhaswellmpiex cp castroexecreacting_testsbubble_convergencehelm_tabledat cp castroexecreacting_testsbubble_convergenceinputs_d cp castroexecreacting_testsbubble_convergenceprobin cp castroexecreacting_testsbubble_convergencejob_scriptscoribubble_convergenceslurm sbatch coribubble_convergenceslurm measur converg bubble_converg output directori cp developmentcastroexecreacting_testsbubble_convergencejob_scriptscheck_convergencesh cp developmentcastroexecreacting_testsbubble_convergencejob_scriptscreate_pretty_tablespi edit use bash give proper execut name check_convergencesh output set converg data file process set latex tabl row python create_pretty_tablespi nse_test simpl test problem design explor well hydro reaction coupl system enter nse version base reacting_converg turn base acoustic_pulse_gener use aprox network nse tabl enabl run strang converg test script convergence_strangsh script create_pretty_tablespi take output file make singl latexformat tabl result problem descript singl mode rayleightaylor instabl problem instabl trigger perturb interfac dens light fluid problem use castro paper compar differ ppm type particl run particl build make use_particlestru run inputs_dparticl input file assign particl accord particle_fil locat particl move fluid veloc time step leav domain disappear test primarili design test abil castro handl particl acoustic_puls acoust puls problem mccorquodal colella use measur converg note dim still run mode set input paramet probleminit_as_d puls coordin direct converg test detail procedur use converg test nersc process result pretti tabl includ castro sdc paper castroexechydro_testsacoustic_puls make compintel j output directori mkdir acoustic_puls cd acoustic_puls cp castroexechydro_testsacoustic_pulsecastrodintelhaswellmpiex cp castroexechydro_testsacoustic_pulseinputsd cp castroexechydro_testsacoustic_pulsejob_scriptscoriacoustic_pulse_convergenceslurm sbatch coriacoustic_pulse_convergenceslurm analysi output directori cp castroexechydro_testsacoustic_pulsejob_scriptscheck_convergencesh cp castroexechydro_testsacoustic_pulsejob_scriptscreate_pretty_tablespi may need edit check_convergencesh use bash differ execut name check_convergencesh output convergencedlosdcout convergencedhisdcout process set latex tabl row python create_pretty_tablespi sod onedimension shock tube problem use run classic sod problem input file also provid run test problem defin toro text plot analyt solut done use script data verif verif directori contain analyt solut sedov problem comput use frank timm exact sedov routin httpwwwcococubedcomcodessedovsedovf compar castro output need radial bin plotfil data get densiti total veloc pressur function radiu accomplish use fsedovf routin castrodiagnosticssedov cylindr explos cartesian coordin run castrodgnumpiex inputsdcyl_in_cartcoord creat angleaverag profil compil castrodiagnosticssedovfsedovd_cyl_in_cartcoordsf make programsfsedovd_cyl_in_cartcoord run fsedovd_cyl_in_cartcoordslinuxgfortranex p plt sedovdout plot gnuplot script plot data overtop analyt solut provid simpli execut gnuplot sedovdgp sedovverif directori slice output run inputsdsph_in_cylcoord inputsdsph use sedovgp instead sedovdgp note get good agreement analyt solut sedov problem necessari start small timestep accomplish set castroinit_shrink input file subsampl critic ensur perturb spheric possibl import use lot step sedovf routin get good analyt solut acoustic_puls altern version acoust puls problem mccorquodal colella version perturb pressur use constant entropi via eo find densiti converg test detail procedur use converg test nersc process result pretti tabl includ castro sdc paper castroexechydro_testsacoustic_pulse_gener make compintel j output directori mkdir acoustic_pulse_gener cd acoustic_pulse_gener cp castroexechydro_testsacoustic_pulse_generalcastrodintelhaswellmpiex cp castroexechydro_testsacoustic_pulse_generalinputsd cp castroexechydro_testsacoustic_pulse_generalhelm_tabledat cp castroexechydro_testsacoustic_pulse_generaljob_scriptscoriacoustic_pulse_convergenceslurm sbatch coriacoustic_pulse_convergenceslurm analysi output directori cp castroexechydro_testsacoustic_pulse_generaljob_scriptscheck_convergencesh cp castroexechydro_testsacoustic_pulse_generaljob_scriptscreate_pretty_tablespi may need edit check_convergencesh use bash differ execut name check_convergencesh output convergencedlosdcout convergencedhisdcout process set latex tabl row python create_pretty_tablespi sod_stellar problem setup use zingal katz test hydrodynam gener equat state problem pure shock tube problem gener equat state exact solut produc comparison use exact riemann solver castroutilexact_riemann test check initi relax phase set rel larg damp factor run relax turn approxim planet model hot jupit planet use conjunct castroradi code dimens actual model paramet defin calcul hotjupitercpp file output newmodelcpphs file castro read planetari model base paper youdin mitchel mechan greenhous burial heat turbul hot jupit atmospher input castro inputs_d file edit paramet veloc vortic probin file nse_deton directori contain set script setup run analyz set deton compar strang split simplifi sdc basic usag screen session similar setup_runspi creat run directori copi need file run job parallel use python pool mechan job run check statu show_statuspi run finis make suit plot make_plotspi flame_wav xrb flame setup use eiden et al httpsuiadsabsharvardeduabsapj origin paper use boost flame longer boost flame speed find input file boost flame castro version earlier current set input file inputs_h pure flame includ input file followon paper harpol et al prep setup also inputs_h_h mix hhe flame intend run rprox network script cori script corixferslurm use migrat file hpss processxrb script run via screen data transfer node dtn archiv data hpss flame wave analysi script plot_generatorpi script gener plot sequenc dataset use yt variabl plot whether use logscal domain colorbar bound streamlin option etc configur command line argument usag descript full list valid paramet type plot_generatorpi h todo add output dpi figur size set image_animatorpi use ffmpeg directli ossystem call gener anim sequenc imag allow user specifi output file offer support sort imag advantag fast low memori footprint configur framer restrict width height imag must divis mpl_image_animatorpi use matplotlib gener anim sequenc imag allow user specifi output file offer support sort imag advantag height width restrict offer stack featur vertic stack multipl imag use separ subplot restrict much slower ffmpeg version much larger memori footprint todo allow user specifi framer front_trackerpi script measur locat flame shock front sequenc snapshot allow user specifi metric track th local enuc maximum default whether use global local maximum domain bound thing usag descript full list valid paramet type front_trackerpi h work dataset test flame wave one restrict current track along one dimens user tell elimin other either slice averag track percentag maximum field output spacedelimit data file call front_trackingdat default flame_speedpi script read front track dataset plot fit line portion usag flame_speedpi data_fil starting_index start index index first datapoint consid fit line script print slope line rsquar valu fit error plot appear squash pop window need enlarg use scipi panda multirayspi plot vertic slice axisymmetr dataset gener ortho ray one end domain one along center variabl plot suppli command line argument eg multirayspi v temp parallel run multipl instanc particular analysi script parallel run one instanc time given directori overviewpi plot temperatur enuc zveloc vertic stack field plot set modifi field list script time_seriespi creat stack plot abar sequenc time point schlierenpi make schlieren plot plot ln   dataset problem descript simpl flame problem set fuel ash region smooth transit temperatur composit densiti comput domain constant pressur initi thermal diffus heat fuel point ignit flame ignit propag right usag public file go togeth boost flame flame_wav problem compil triple_alpha_plus_cago network flowchart introduct sever differ timeevolut method current implement castro best possibl share driver routin use preprocessor runtim variabl separ differ code path fall two categori index castrotime_integration_method use_simplified_sdc use_true_sdc strangctu strang evolut burn state mathdelta updat hydrodynam use burn state final mathdelta burn explicit coupl burn hydro done code path use cornertransport upwind ctu method unsplit characterist trace method citecolella default method mhd solver use driver sdc class iter method coupl advect reaction process explicitli see effect two sdc implement castro simplifi sdc method base ctu hydro updat iter construct term use lag reaction sourc input final conserv updat integr reaction system use ode solver explicit advect sourc includ piecewiseconstantintim fastion true sdc method fulli coupl hydro reaction either nd th order approxim integr time use simpl quadratur rule integr hydro explicitli reaction implicitli next time node iter allow process see one anoth achiev highord time converg describ citecastrosdc timeintegr method use control castrotime_integration_method time_integration_method origin castro method describ citecastro_i use strang split ctu hydrodynam scheme time_integration_method unus castro earlier methodoflin integr method strang split reaction time_integration_method full implement spectral defer correct formal nd th order integr implement moment support multilevel domain note differ interfac default strang method must compil use_true_sdc true method work particular defin extra_thermo enabl addit eo deriv time_integration_method simplif sdc method describ use ctu hydro advect ode reaction solv note requir differ set state variabl must compil use_simplified_sdc true method work particular defin prim_species_have_sourc index use_simplified_sdc use_true_sdc note default code compil strangsplit ctu evolut time_integration_method size differ state array differ integr scheme support need compil use use_simplified_sdctru simplifiedsdc method time_integration_method use_true_sdctru true sdc method time_integration_method note mhd radiat current support strangctu evolut time integr method sever helper function use throughout index clean_stat clean_stat mani way hydrodynam state may becom unphys evolut clean_stat routin enforc check state particular enforc densiti castrosmall_den enforc speed state dont exceed castrospeed_limit normal speci mass fraction sum sync linear hybrid momenta use_hybrid_momentumtru reset intern energi necessari small neg comput temperatur zone thermodynam consist state _flowsecnosdc main driveral time integr method driver support strang ctu integr castrotime_integration_method main evolut singl step contain castro_advancecpp castroadv follow advanc note part done depend preprocessor direct defin compiletimeth relev direct note start step initi initialize_adv set current level advanc follow action performend note omit action taken retri describ later sync level inform fortransid castro radiat initi set maximum densiti use poisson graviti toler initi intermedi storag array like hold sourc term etc swap statedata new old eg ensur next evolut start result previou step call clean_stat creat multifab hold primit variabl inform hydro solv zero flux true sdc initi data time node see refsecflow_true_sdc advanc call do_adv take singl step incorpor hydrodynam reaction sourc term radiationhydrodynam step advect hyperbol portion radiat updat sourc term includ graviti rotat diffus includ step timecent achiev secondord accuraci index retri castrouse_retri set subcycl current step violat stabil criteria reach desir mathdelta idea follow timestep took timestep suffici enforc stabil criteria would like achiev cfl criterion hydrodynam burn stabil criterion reaction retri timestep set castrouse_retri input file save current state data begin level advanc criteria satisfi reject advanc start old data seri subcycl timestep small enough satisfi criteria note effect doubl memori footprint level choos use see refchretri detail retri mechan note strangctu simplifiedsdc support retri aux_upd auxiliari quantitiy evolut auxiliari variabl castro obey continu equat option sourc pass eo subject constraint mass fraction sum one advect sourc term alreadi dealt main hydrodynam advanc step usersuppli routin ca_auxupd provid updat quantiti radial data pointmass point mass castrospherical_star set averag state data angl creat radial profil use boundari fill routin properli set dirichlet bc domain smaller star profil boundari uniform castropoint_mass_fix_solut set chang mass point mass option contribut gravit potenti take mass surround zone keep densiti zone constant radiat radiat implicit updat do_adv routin handl hyperbol portion radiat updat step implicit solv either gray multigroup advanc radiat energi new time level note moment backwarddiffer implicit firstord time stabil handl final_radiation_cal particl particl includ passivelyadvect particl advanc step final clean end step updat flux regist account mismatch coarsefin interfac clean memori use step free memori alloc level advanc _secstrangctu strangctu evolut do_advance_ctu castro_advance_ctucpp describ flow use strang split ctu hydrodynam mhd method includ graviti rotat diffus integr select via castrotime_integration_method system advanc reaction hydrodynam diffus rotat graviti consid consid system equat math fracpartialubparti bf aub rbub sb mathbf aub nabla cdot fbub mathfb flux vector mathrb reaction sourc term mathsb nonreact sourc term includ userdefin extern sourc mathsb_rm ext use strang split discret advectionreact equat summari time step updat conserv variabl mathub react half time step advect full time step ignor reaction term react half time step treatment sourc term complic littl actual updat sequenc look like math beginalign ubstar ubn fracdtrbubn ubna ubstar dt sbubstar ubnb ubna dt bf aubstar ubnc ubnb fracdt sbubnb sbubstar ubn ubnc fracdt rbubnc endalign label eqsource_correct note first step add full mathdelta oldtim sourc state predict ensur consist come time predict newtim sourc end updat construct advect term mathbf aub pure explicit base unsplit secondord godunov method predict standard primit variabl well mathrho e timecent edg use approxim riemann solver construct flux begin time step assum mathub gravit potenti mathphi defin consist ie mathrhon mathphin satisfi poisson equat math delta phin pi grhon see refchgrav detail poisson equat solv note eqeqsource_correct actual sourc implicitli updat densiti first momentum energi done rotat graviti make updat akin math ubnc ubnb fracdt sbubnc sbubn includ radiat part updat algorithm deal advect hyperbol term radiat updat singlelevel algorithm goal updat state_typ statedata old new time see refsoftsecstatedata use follow notat consist name use code s_old multifab refer oldtimelevel state_typ data sborder multifab ghost cell initi s_old hydrodynam reconstruct work s_new multifab refer newtimelevel state_typ data old_sourc multifab refer oldtimelevel source_typ data new_sourc multifab refer newtimelevel source_typ data singl step flowchat code object evolv state old time s_old new time s_new initi initialize_do_adv creat sborder initi s_old b check nan initi state s_old react mathdelta strang_react_first_half updat solut due effect reaction half time step integr method system equat use determin host runtim paramet part microphys packag basic idea evolv energi releas reaction speci mass fraction temperatur mathdelta use notat begin timelevel mathn state mathubn produc state evolv due reaction mathubstar math beginalign rho estar rho en fracdt rho h_mathrmnuc rho estar rho en fracdt rho h_mathrmnuc rho x_kstar rho x_kn fracdtrhoomegadot_k endalign mathh_mathrmnuc energi releas ergg burn mathomegadot_k creation rate speci mathk exit burner call eo mathrhostar mathestar mathx_kstar get new temperatur mathtstar note densiti mathrho chang via reaction strangsplit formul reaction data need valid ghost cell reaction appli entir patch includ ghost cell reaction clean_stat call end step sborder see effect reaction construct timelevel n sourc appli construct_old_grav do_old_sourc time level mathn sourc comput ad statedata source_typ sourc deal spong spong damp term ad momentum equat design drive veloc zero timescal implement spong follow maestro citemaestroiii b extern sourc user defin problemspecif sourc problem_sourceh file sourc differ equat conserv state vector mathub index use integ key defin state_indicesh eg urho commonli use extern heat sourc see toy_convect problem setup exampl problem use c mhd thermal sourc mhd system includ pdv work intern energi equat sourc term rather comput riemann problem sourc comput intern energi equat diffus diffus thermal diffus ad explicit formul secondord accuraci achiev averag timelevel mathn mathn term use predictorcorrector strategi describ note thermal diffus distinct radiat hydrodynam also note incorpor diffus bring addit timestep constraint sinc treatment explicit see chapter refchdiffus detail e hybrid_momentum angular momentum f graviti graviti full poisson graviti solv graviti use math gbn nablaphin qquad deltaphin pi grhon construct form graviti sourc momentum energi equat depend paramet castrograv_source_typ full detail graviti solver given chapter refchgrav g rotat rotat comput rotat potenti use energi updat rotat acceler use momentum equat includ corioli centrifug term constantangularveloc corot frame form rotat sourc construct depend paramet castrorot_source_typ detail given chapter refchrot sourc term evalu use postburn state mathubstar sborder later correct use new state burn mathubnb compat strangsplit sinc hydro sourc take place complet insid surround burn oper oldtim sourc term store old_sourc sourc appli state burn mathubstar full mathdelta weight correct later produc intermedi state mathubna store s_new construct hydro mhd updat construct_ctu_hydro_sourc construct_ctu_mhd_sourc goal advanc system consid advect term cartesian coordin written diverg flux hydro updat two partsfirst construct advect updat store hydro_sourc multifab conserv updat separ step separ allow us use advect updat separ complex timeintegr scheme strangsplit formul start reconstruct use state burn mathubstar sborder ctu method predict halftim mathn get secondord accur method note sborder know sourc except reaction method done differ depend whether hydro mhd hydrodynam advect step complic detail given section refsecadvect step summar version comput primit variabl ii convert sourc term act primit variabl iii predict primit variabl timecent edg iv solv riemann problem v comput flux advect term b mhd mhd updat describ refchmhd start hydrodynamicsmhd sourc construct need know hydrodynam sourc term timelevel mathn sinc enter predict interfac state essenti vector comput previou step modif import set castrosource_term_predictor extrapol sourc term mathn mathn use chang previou step note neglect reaction sourc term sinc alreadi account state directli due strangsplit natur method updat comput immedi appli s_new clean state clean_stat done s_new check check state nan updat radial data center mass monopol graviti quantiti comput use s_new correct sourc term n contribut construct_new_grav do_new_sourc selfgrav first comput updat gravit potenti use updat densiti s_new correct sourc term appli s_new timecent previous ad mathdelta sbubstar state realli want mathdelta tsbubstar sbubnb start comput sourc term vector mathsbubnb use updat state mathubnb comput correct mathdelta tsbubnb sbubstar add mathubnb give us properli timecent sourc fulli updat state mathubnc correct store new_sourc multifab _ process updat sourc updat temperatur make consist new state react mathdelta strang_react_second_half final mathdt react state begin mathubnc give us final state level mathubn larg strang_react_first_half current fill reaction ghost cell final finalize_do_adv final follow momentum sourc comput mathdsbdt use sourc term predictionextrapol hydrodynam interfac state next step b hybrid momentum algorithm sync hybrid linear momenta summari state input updat process present tabl updat sequenc state array strangctu align center step s_old sborder s_new init input updat react input updat old sourc input updat hydro input updat clean input updat radial center input correct sourc input updat react input updat _secflow_true_sdc sdc evolut sdc evolut select castrotime_integration_method away strang split instead coupl reaction hydro togeth directli note moment sdc solver support multilevel amr simul note code must compil use_true_sdc true use evolut type sdc solver follow algorithm detail citecastrosdc write evolut equat math fracparti ubparti bf aub bf rub mathbf aub nabla cdot bf fub bf sub hydrodynam sourc term mathbf group togeth flux diverg sdc updat look solut sever time node number depend desir tempor order accuraci iter updat solut node mathm mathm math beginalign avgubmk avgubmk delta left avgbf aubmk avgbf aubmk right delta left avgbf rubmk avgbf rubmk right int_tmtm left avgbf aubk avgbf rubk right dt endalign index castrosdc_ord castrosdc_quadratur mathk iter index sdc formal iter gain us order accuraci time order discret integr end express also write conserv state mathavgub remind us cell averag cellcent distinct import consid th order method castro two paramet togeth determin number locat tempor node accuraci integr henc overal accuraci time castrosdc_ord castrosdc_quadratur castrosdc_quadratur use gausslobatto integr includ start end time time node give us trapezoid rule nd order method simpson rule th order method choos castrosdc_quadratur use radau iia integr includ end time start time quadratur tabl sdc quadratur summari align center sdc_order quadratur tempor descript time node accuraci trapezoid rule simpson rule radau nd order radau th order overal evolut appear index k_new a_old a_new r_old initi initialize_adv creat multifab store need inform differ time node quantiti vector size sdc_node whose compon multifab time node k_new current solut time node note k_new alias s_old solut start step sinc never chang long th time node start timestep a_old advect term time node old iter a_new advect term time node current iter r_old reactiv sourc term time node old iter advanc iter loop call do_advance_sdc updat solut time node singl iter total number iter castrosdc_ord castrosdc_extra final clear multifab alloc sdc singl iter flowchart index do_advance_sdc updat time node singl iter done do_advance_sdc basic updat appear throughout driver use state_typ statedata storag current node particular use new time slot statedata refer s_new allow us fillpatch oper initi alloc sborder like strang ctu driver use input hydrodynam routin loop time node well use denot current time node sdc_iter denot current base iter loop time node follow node load start data s_new mathleftarrow k_newm clean_stat s_new fill sborder use s_new construct hydro sourc advect term note first time node sdc_iter dont need last time node last iter call do_old_sourc fill source_typ statedata old_sourc convert sourc th order averag need convert conserv variabl primit variabl call construct_mol_hydro_sourc get advect updat current time node store a_newm bootstrap first iter first iter dont old iter advect reaction term need sdc updat first time node first iter a_oldn a_old n loop time node comput reactiv sourc use node state store r_old fill time node r_oldn r_old sdc updat node call do_sdc_upd updat time next node solv nonlinear system reaction store solut k_newm store advect term next iter sinc done iter a_oldn mathleftarrow a_newn also store r_old next iter call reaction sourc one last time use data time node store newtim solut last iter save solut state_typ statedata s_new mathleftarrow k_newsdc_nod call finalize_do_adv clean memori simplifiedsdc evolut simplifi sdc method use ctu advect solver togeth ode solut updat comput advectivereact system select castrotime_integration_method use one addit statedata type simplified_sdc_react_typ hold reactiv sourc need hydrodynam note code must compil use_simplified_sdc true use evolut type express system math ub_t mathcalaub rbub mathmathcala advect sourc includ flux diverg hydrodynam sourc term eg graviti math mathcalaub nabla cdot fbub sb simplifiedsdc version main advanc loop look similar strang ctu version includ iter loop hydro graviti reaction updat differ happen step flowchart outlin flowsecnosdc__ particular step proce loop do_advance_ctu differ strang ctu version highlight note radiat implicit updat done part simplifiedsdc iter simplified_sdc hydro advanc evolut do_adv substanti differ strang case particular reaction evolv summar differ initi initialize_do_adv unchang initi ctu strang algorithm construct timelevel n sourc appli construct_old_grav do_old_sourc unlik strang case need extrapol sourc term halftim predict castrosource_term_predictor paramet sinc simplifiedsdc provid natur way approxim timecent sourcew simpli use iterativelylag newtim sourc add corrector previou iter sourc multifab ad current sourc corrector store source_corrector form math sbmathrmcorr frac left sbnk sn right mathsbn iter subscript sinc alway old time state appli corrector sourc time mathn give us sourc timecent math bf subn frac left bf subn bf subnk right construct timelevel mathn sourc differ compar strang algorithm construct hydro updat construct_hydro_sourc predict interfac state use iterativelylag approxim reaction sourc primit variabl mathmathcali_qk addit done construct_ctu_hydro_sourc sourc term convert primit variabl result approxim math nabla cdot bf fn yet full mathmathcalaub store hydro_sourc clean state clean_stat updat radial data center mass monopol graviti correct sourc term n contribut construct_new_grav do_new_sourc react mathdelta react_stat first comput mathmathcalaub use hydro_sourc old_sourc new_sourc via sum_of_sourc function produc advect sourc form math left mathcalaub right n nabla cdot bf fn frac sn sn burn full mathdelta includ advect updat sourc integr math fracdubdt left mathcalaub right n rbub result evolv equat store s_new note actual burn zone dont meet thermodynam threshold step noth state updat via hydrodynam s_new kept clean state ensur thermodynam state valid consist construct reaction sourc term construct chang primit variabl due reaction timestep mathmathcali_qk use next iter final finalize_do_adv differ strang final construct mathdsbdt instead store total hydrodynam sourc term new time discuss use next iter approxim timecent sourc term correct graviti slightli differ sinc directli comput timecent gravit sourc term use hydrodynam flux develop best practic code convent castro develop best adher follow code style guidelin gener indent space tab space prefer c condit appear code c condit els condit els c fortran c fortran interfac use iso c bind fortran subroutin use code fortran subroutin subroutine_namearg bindc namesubroutine_nam data pass refer c use scalar pass valu use fortran valu attribut fortran routin call c ca_ true even routin also call fortran separ tile lo hi pass subroutin expect fortran subroutin act exactli domain lo hi want includ ghost zone calcul includ box use mfigrowntileboxng instead mfivalidbox fortran put routin modulethi ensur argument list check use claus modul use statement explicitli make clear access modul toplevel use statement except get access rt type instead function subroutin modul use need directli new fortran file f file extens f file extens preprocess document c routin use doxygen style comment c function document header file use style code c descript function param bar brief descript variabl void fooint bar member variabl either document use style comment block brief inlin descript code c int var brief descript variabl fortran function use sphinx style comment fortran function document place comment block immedi prototyp ie without line betwen use style code fortran subroutin foobar descript function use some_modul implicit none integ intentinout bar brief descript bar document modul similarli format comment block come immedi modul definit castro releas outlin procedur monthli castro releas castro use submodul depend mean minimum must updat amrex microphys submodul monthli issu new releas releas amrex microphys must done first navig submodul directori checkout new tag toplevel directori castro git add extern directori store new tag exampl begin march would first issu tag microphys wait amrex releas tag cd castro_homeextern cd amrex git pull git checkout cd cd microphys git pull git checkout cd git add u git commit updat amrex microphys releas proceed issu releas month develop branch merg main releas tag need done coordin submodul depend gener procedur git pull main develop branch use git checkout xxx chang branch xxx main branch git merg develop fix conflict conflict unless commit check main directli without go develop main branch commit new releas note changesmd summar chang sinc last major releas tag new releas git tag castro yymm yymm git push git push tag git checkout develop git merg main git push interim updat break chang microphys occur develop branch castro depend must updat microphys submodul castro develop branch way replac git checkout statement latest commit hash microphys develop branch git submodul alway track specif committag target repo configur automat track particular branch sinc break chang usual accompani castro chang best practic ensur pr microphys castro approv merg microphys pr add updat microphys submodul castro pr merg similar process appli amrex continu integr github action run integr test code build deploy document current run clang static analyz httpsclanganalyzerllvmorg_ find potenti bug code also run script convert tab code space run pull request castro github repo run weekli develop branch tracer particl tracer particl track lagrangian evolut model fluid use discret particl hydrodynam simul base eulerian grid includ castro thermodynam variabl given time deriv solv equat motion fluid cell therefor scheme physic quantiti access discret quantiti given posit rather averag valu cell howev employ discret particl passiv advect fluid flow allow us obtain local instantan thermodynam variabl temperatur densiti welldefin posit independ spatial resolut ie spatial cell size mean follow evolut fluid given posit time castro provid tracer particl scheme use option scheme particl advanc use midpoint method either cellcent veloc facecent veloc markerandcel method _ number initi posit particl flexibl determin accord purpos given model initi particl one must includ tracer particl gnumakefil set use_particl true particl initi via castrodo_tracer_particl input file one want investig evolut fluid motion start specif posit certain rang area volum one manual specifi posit particl provid input file contain total number initi posit particl input file directori input file locat name input file determin via particlesparticle_init_fil particle_fil particle_fil userspecifi name file first line file assum contain number particl line contain posit coordin system adopt model cartesian coordin mathx z exampl input file model fluid particl cartesian coordin may look like e e e e e e e e e e e e accord input file particl posit height mathi coordin second column equal space mathx direct first column except particl number first line mathtim rm cm mathtim rm cm _particlesoutput_fil output file output file store directori whose name determin variabl particlestimestamp_dir exampl variabl set follow particlestimestamp_dir particle_dir directori particle_dir automat made directori main castro output file pltxxxxx simul start particl output file store insid directori name output file consist timestamp_ along number end number increas typic processor involv follow trajectori particl parallel comput comput domain divid accord number processor request processor follow particl domain assign processor record posit veloc given time differ output file sinc possibl particl move one domain anoth evolut histori store differ file output file larger number end file name produc processor track particl default output file contain posit veloc particl given time mean math time dimension column exampl particl domain column output file mathrm indexrm indexx z v_rm x v_rm v_rm z rho first two integ correspond particl index processor number one use two number order identifi particl extract histori ie trajectori numreffigparticletrajectori figur fluid_motionpng model atmospher arrow show direct fluid motion _figparticletrajectori figur tracer_trajectorypng trajectori particl follow fluid motion atmospher particl initi posit five differ height mathymathrmkmmathrmkm mathrmkm mathrmkm mathrmkm particl height solid line repres trajectori particl one also add last two column mathrho ie local densiti local temperatur fluid posit particl set follow particlestimestamp_temperatur particlestimestamp_dens exampl let consid particl domain particl initi processor rest anoth processor mean two processor track particl two output file produc output file written processor particl one find four line store time line correspond particl info output file particl line store time particleswrite_in_plotfil particl data store binari file along main castro output plotfil directori pltxxxxxtracer runtim screen output verbos written screen runtim turn set particlesv one simplifi interpol cellcent veloc howev lead decoupl pressur veloc compon possibl result instabl avoid facecent veloc regrid detail regrid strategi describ refsectag cover input paramet control grid describ later user defin fortran subroutin tag individu cell given level need refin list tag cell sent grid gener routin use bergerrigoutso algorithm citebrrefin creat rectangular grid contain tag cell relev runtim paramet amrregrid_fil name file read grid text default file set filenam eg fixed_gird list grid fine level read file grid procedur grid must violat amrmax_grid_s criterion rest grid procedur describ occur amrregrid_fil set amrn_error_buf radiu addit tag around alreadi tag cell integ mathgeq default amrmax_grid_s maximum size grid direct integ math default note amrmax_grid_s must even multipl amrblocking_factor everi level amrblocking_factor grid size must multipl integ math default amrblocking_factor everi level must power domain size must multipl amrblocking_factor level note import ellipt problem multigrid higher block factor allow multigrid algorithm coarsen lowest level reduc amount work requir bottom solver amrgrid_eff grid effici real math math default creat refin grid make box includ coars cell explicitli tag refin allow encompass nearbi untag cell order make larger regular box grid effici blocking_factor grid effici exactli fraction refin cell fine boxarray correspond coars cell tag block factor actual appli grid_eff level coarsen blocking_factor longer strictli fraction idea still amrrefine_grid_layout refin grid processor math grid fals true default note also amrn_error_buf amrmax_grid_s amrblocking_factor read singl valu assign everi level multipl valu one level exampl consid amrgrid_eff amrmax_grid_s amrblocking_factor grid effici amrgrid_eff mean grid creation process least cell grid level grid creation occur must tag cell higher grid effici mean fewer cell higher level may result product lot small grid ineffici cach openmp perform higher commun cost amrmax_grid_s paramet mean final grid longer cell side everi level altern could specifi valu level refin amrmax_grid_s case final grid longer cell side level cell side level cell side level amrblocking_factor mean final grid multipl level specifi levelbylevel basi like amrblocking_factor case dimens final grid multipl level multipl level multipl level get good perform paramet larg impact perform castro take time experi worth effort grid larg enough coarsen multipl level vcycl essenti good multigrid perform simul use selfgrav grid creat grid algorithm proce order grid creat use bergerrigoutso cluster algorithm modifi ensur new fine grid divis amrblocking_factor next grid list chop grid larger max_grid_s note amrmax_grid_s multipl amrblocking_factor amrblocking_factor criterion still satisfi next amrrefine_grid_layout processor grid amrmax_grid_s multipl amrblocking_factor grid redefin level independ maximum length grid level mathel dimens amrmax_grid_s mathel final amrrefine_grid_layout still processor grid amrmax_grid_s multipl amrblocking_factor grid redefin level independ maximum length grid level mathel dimens amrmax_grid_s mathel refer bibliographi refsbib style plain _chsdc spectral defer correct castro sdc solver coupl hydrodynam tightli togeth iter improv converg solut basi th order accur castro solver algorithm describ citecastrosdc note refer full sdc time integr scheme castrotime_integration_method simplifiedsdc solver option describ quadratur iter castrosdc_ord desir spatial tempor order support castrosdc_quadratur quadratur scheme use timeintegr determin number locat tempor node support valu gausslobatto radau iia castrosdc_extra number extra iter take default number iter use equal valu sdc_order option affect nonlinear solv sdc_solver method use nonlinear solut reaction system valu pure newton iter subdivid time interv need get newton method converg use vode solv nonlinear system express ode system use vode first iter newton subsequ iter sdc_solver_tol_den rel error densiti solv nonlinear system sdc_solver_tol_spec rel error partial densiti mathrho x_k nonlinear solv sdc_solver_tol_en rel error energi nonlinear solv sdc_solver_atol absolut error mass fraction nonlinear solv sdc_solver_relax_factor factor relax toler ie increas earlier iter reach desir toler final iter sdc_solve_for_rho whether solv system term mathrho e mathrho e sdc_newton_use_analytic_jac whether use analyt jacobian newton iter reaction part system comput numer _chmpiplusx run option cpu gpu castro use mpi coars parallel distribut box across comput node finegrain parallel openmp use cpubas comput cuda use gpu run cpu prefer run cpu use mpiopenmp compil use_mpitru use_omptru castro use tile divid box smaller tile distribut tile openmp thread manag mfiter level openmp direct need present comput kernel see mfiter tile httpsamrexcodesgithubioamrexdocs_htmlbasicshtmlsecbasicsmfitertiling_ inform optim number openmp thread depend comput architectur experiment need tile work best larger box increas amrmax_grid_s benefit perform run gpu castro comput kernel run gpu prefer way run supercomput gpu moment offload handl use cuda manag memori exact comput kernel use gpu cpu note almost castro run gpu main except true sdc solver use_true_sdc true enabl gpu comput compil use_mpi true use_omp fals use_cuda true use gpu almost comput done gpu mfiter loop box loop put singl zone gpu thread take advantag massiv parallel microphys starkil also take advantag gpu entir simul run gpu best perform obtain bigger box set amrmax_grid_s amrblocking_factor give good perform work supercomput center best practic run amrex astrophys code differ supercomput center produc workflow document httpsamrexastrogithubioworkflow _chbuildsystem build system overview make paramet build paramet control parallel includ physic etc gener set true fals castrospecif one interpret makecastro lot option featur enabl compil time allow castro reduc memori footprint state array alloc space variabl use gener build paramet index use_all_castro use_amr_cor use_hypr paramet affect build parallel perform etc paramet amrex use_all_castro compil core castro directori defailt true chang gener simul purpos flag unit test need castro directori compil use_amr_cor compil core amrex directori includ base amrcor amr boundari default true left set castro simul purpos flag unit test dont need amrex use_mlmg use amrex multilevel multigrid solver graviti diffus alway set true use_hypr compil hypr librari automat enabl radiat need specifi path hypr librari via either hypre_dir hypre_omp_dir fortran support mani problem built without fortran current except mhd radiat anyth use pynucastrogener network paramet control fortran support use_fort_microphys set true fortran version eo burner interfac compil use pynucastro network probabl set fals bl_no_fort set true amrex fortran sourc built current use mhd radiat solver parallel gpu index use_mpi use_omp use_cuda use_acc follow paramet control work divid across node core gpu use_cuda compil gpu support use cuda use_acc compil openacc note work progress use present use_mpi compil mpi librari allow distribut parallel use_omp compil openmp allow share memori parallel gener physic paramet index use_simplified_sdc use_true_sdc follow paramet control coupl hydro reaction handl use_simplified_sdc use simplifi spectral defer correct sdc solver coupl hydro reaction moment work ctu hydrodynam solver requir run castrotime_integration_method use_true_sdc use true sdc method coupl hydro reaction nd order th order accuraci moment work singl level requir run castrotime_integration_method radiat paramet use_rad use photon radiat diffus note multigroup radiat need set number radiat group control ngroup paramet index use_rad ngroup graviti paramet use_grav use graviti could constant selfgrav index use_grav use_gr use postnewtonian approxim gr graviti monopol solver index use_gr use_pointmass includ pointmass sourc gravit potenti index use_pointmass microphys paramet use_diffus enabl thermal diffus conduct set via conductivity_dir directori microphys repo index use_diffus conductivity_dir use_react enabl reaction reaction set need specifi network integr typic come microphys repo one common except general_nul network defin composit paramet come play network_dir network use expect subdirectori microphys repo network_input text file read defin composit use general_nul network eg gammalawnet build system look file microphys repo integrator_dir ode integr use integr reaction system expect subdirectori microphys repo index use_react general_nul general_net_input network_dir integrator_dir use_react_sparse_jacobian use_sparse_stop_on_oob eos_dir equat state use subdirectori microphys repo index eos_dir hydrodynam sourc term paramet use_rot includ rotat sourc index use_rot use_hybrid_momentum castro evolv angular momentum addit linear momentum index use_hybrid_momentum use_shock_var includ variabl state_typ statedata mark locat shock index use_shock_var simul flow paramet use_aux_upd network defin auxillari quantiti gener castro advect otherwis chang set use_aux_updatetru castro call usersuppli routin advance_aux chang auxillari quantiti index use_aux_upd use_post_sim defin castro call userdefin routin problem_post_simul full evolut problem end index use_post_sim use_maestro_init enabl code allow castro restart maestro simul need updat futur allow restart maestroex index use_maestro_init use_hdf compil support hdf need tabl use microphys routin index use_hdf tracer particl paramet use_particl compil support tracer particl build process procedur note build time number sourc file autogener base configur problem file output tmp_build_dircastro_sourcesndcompoptionsex n dimension comp compil name option number option mpi debug current build system process set_variablespi call index set_variablespi _variabl state_indices_ndf state_indicesh process castro _variabl file write state_indicesh state_indices_ndf fortran enabl tmp_build_dircastro_sourc directori use defin size variou state array integ key index state variabl hook makeauto_sourc build rule state_indices_ndf test portion build system make test_vari general_nul network network_propertiesh actual_networkf fortran enabl creat index write_networkpi done write_networkpi hook castro_homemicrophysicsnetworksgeneral_nullmakepackag runtim paramet file microphys routin pars write_probinpi index write_probinpi write routin manag microphys runtim paramet extern_parameterscpp extern_parametersh externf output tmp_build_dircastro_sourc hook makeauto_sourc rule extern_parametersh castro runtim paramet pars parse_castro_paramspi index parse_castro_paramspi write c header file manag read runtim paramet file output tmp_build_dircastro_sourc hook makeauto_sourc rule castro_paramsh problemspecif runtim paramet pars write_probdatapi problem directori defin _prob_param pars use c header sourc file prob_parametersh prob_parameterscpp handl read problem paramet input file even without problemspecif _prob_param variabl castrosourceproblems_default_prob_param includ script castroutilscriptswrite_probdatapi use hook makeauto_sourc prob_parametersh rule header output tmp_build_dircastro_sourc fortran depend file creat creat fdepend file tmp_build_dir script amrextoolsf_scriptsdeppi use hook amrextoolsgnumakemakerul depexetempdirfdepend target cc depend file creat creat individu file tmp_build_dir one sourc file set rule makerul handl descript line comment make file output stdout git version sourc via describe_sourcespi doesnt affect build process work need tmp_build_dir directori first vpath modifi sourc found use visual larg number tool use read castro amrex data make plot tool work castro plotfil give overview variabl plotfil control output well tool use visual visual tool amrvi favorit visual tool amrvi heartili encourag build amrvisd amrvisd execut tri use visual data use featur viewdataset allow actual view number handi debug modifi mani level data want see whether want see grid box palett use etc like amrvi display certain variabl certain scale first bring plotfil alway chang amrvi window open modifi amrvisdefault file directori amrvi default set everi time run directori corecollaps hse_test sod sedov amrvisdefault file work new run directori simpli copi one modifi visit visit also great visual tool directli handl plotfil format call boxlib inform check visitllnlgov use tip use boxlibd plugin select file mathrightarrow open file mathrightarrow open file type boxlib key read header file pltheader exampl rather tell read plt yt yt free opensourc softwar provid data analysi publicationlevel visual tool astrophys simul result castro produc yt scriptbas easi use visit certainli easi amrvi imag worth flesh yt give overview intend get person start full document explan section adapt found httpytprojectorgdocindexhtml exampl notebook use plotfil gener exampl docgetting_start section demonstr use yt load visual data section gener jupyt notebook found docssourceyt_exampleipynb castro repo includ yt_examplerst _chrotat rotat introduct current castro support contant solidbodi rotat fix space time axi transform evolut equat rotat frame refer includ rotat must set use_rot true gnumakefil rotat enabl via castrodo_rot input file rotat period must set via castrorotational_period rotat period intern convert angular frequenc use sourc term equat axi rotat current depend dimension problem valu coord_si case howev default axi rotat point problemcent vertic direct note make sure set problemcent variabl appropri problem done directli set problem_initi function vertic direct defin follow coord_si xy xyplan along zaxi coord_si rz along zaxi coord_si xyz along zaxi chang default modifi omega vector ca_rot routin found rotate_dimdf file main paramet affect rotat castrodo_rot includ rotat forc term default castrorotational_period period rotat default castrorotational_dpdt dperiod dt rotat default castrorotation_include_centrifug whether includ centrifug forc default castrorotation_include_corioli whether includ corioli forc default castrorotation_include_domegadt whether includ forc time deriv rotat frequenc default castrostate_in_rotating_fram whether state variabl measur rotat frame default castrorot_source_typ method updat energi rotat updat default castroimplicit_rotation_upd corioli term mix momenta sourc term whether solv updat implicitli default castrorot_axi rotat axi default cartesian cylindr complet show deriv sourc term appear momentum total energi evolut equat upon switch rotat refer frame coordin transform rotat frame figur tframespng alt inerti vs corot frame inerti frame mathc noninerti frame mathtildec consid fluid element mathp whose distanc two frame relat mathbf r tildebfr bf l consid inerti refer frame mathc noninerti refer frame mathwidetildec whose origin separ vector mathboldsymbol see figur noninerti frame rotat axi mathob constant angular veloc mathomega furthermor assum direct rotat axi fix consid fluid element point mathp whose locat given mathrb mathc mathrbt mathwidetildec math rb rbt boldsymbol compon notat math r_iboldsymbole_i widetilder_iwidetildeboldsymbole_i l_iboldsymbole_i label eqr mathboldsymbole_i mathwidetildeboldsymbole_i mathi th unit vector mathc mathwidetildec coordin system respect total time rate chang eqeqr given math fracdr_idtboldsymbole_i fracdwidetilder_idtwidetildeboldsymbole_i widetilder_ifracdwidetildeboldsymbole_idt fracdl_idtboldsymbole_i label eqvcomp use fact unit vector inerti frame mathc move least consid stationari chang mathboldsymbol give rel motion two coordin system definit unit vector chang length therefor chang mathwidetildeboldsymbole_i time come chang direct chang carri rotat mathob axi tip unit vector move circumferenti math fracdwidetildeboldsymbole_idt obtimeswidetildeboldsymbole_i label eqetilderot plug eqeqetilderot eqeqvcomp switch back vector notat math fracdrbdt fracdrbtdt obtimesrbt fracdboldsymbolldt label eqrdot left hand side eqeqrdot interpret veloc fluid element seen inerti frame first term right hand side veloc fluid element seen stationari observ rotat frame mathwidetildec second third term right hand side eqeqrdot describ addit veloc due rotat translat frame mathwidetildec seen mathc word math vb vbt obtimesrbt boldsymbolv_l label eqv use mathboldsymbolv_l repres translat veloc similarli take second time deriv eqeqv math fracdvbdt fracdvbtdt obtimesvbt obtimesleftobtimesrbtright fracdboldsymbolv_ldt label eqa henceforth assum two coordin system translat rel one anoth mathboldsymbolv_l also worth mention deriv respect spatial coordin involv addit term due rotat ie mathnablabcdotvb nablabcdotvbt continu equat remain unchang rotat frame math fracparti rhoparti nablabcdotleftrhovbtright label eqcontrot math fracdrhodt rhonablabcdotvbt label eqcontrottot momentum equat rotat frame usual momentum equat appli inerti frame math fracdleftrhovbrightdt rhovbcdotnablabvb nablab p rhogb label eqmom use continu equat eqeqcontrottot substitut term rotat frame eqeqa eqeqmom math beginalign rholeftfracdvbtdt obtimesvbt obtimesleftobtimesrbtrightright rhovbnablabcdotvb rhovbcdotnablabvb nablab p rhogb nonumb rholeftfracpartialvbtparti vbtcdotnablabvbtright nablab p rhogb rhoobtimesvbt rhoobtimesleftobtimesrbtright nonumb fracpartialleftrhovbtrightparti nablabcdotleftrhovbtvbtright nablab p rhogb rhoobtimesvbt nonumb rhoobtimesleftobtimesrbtrightlabeleqmomrot endalign math fracdleftrhovbtrightdt rhovbtcdotnablabvbt nablab p rhogb rhoobtimesvbt rhoobtimesleftobtimesrbtright label eqmomrottot energi equat rotat frame eqeqmomrottot veloc evolut equat rotat frame math fracdvbtdt fracrhonablab p gb obtimesvbt obtimesleftobtimesrbtright label eqvrot kinet energi equat obtain eqeqvrot mulitpli mathrhovbt math beginalign rhovbtcdotfracdvbtdt vbtcdotnablab p rhovbtcdotgb rhovbtcdotleftobtimesvbtright rhovbtcdotleftobtimesleftobtimesrbtrightright nonumb fracfracdleftrhovbtcdotvbtrightdt fracvbtcdotvbtfracdrhodt vbtcdotnablab p rhovbtcdotgb rhovbtcdotleftleftobcdotrbtrightob rhoomegarbtright nonumb fracfracdleftrhovbtcdotvbtrightdt fracrhovbtcdotvbtnablabcdotvbt vbtcdotnablab p rhovbtcdotgb rhovbtcdotleftleftobcdotrbtrightob rhoomegarbtright endalign label eqekinrottot intern energi simpli advect first law thermodynam chang due mathpdv work math fracdleftrho erightdt leftrho e prightnablabcdotvbt label eqeintrottot combin eqeqekinrottot eqeqeintrottot get evolut total specif energi rotat frame mathrho widetilde rho e fracrhovbtcdotvbt math beginalign fracdleftrho erightdt fracfracdleftrhovbtcdotvbtrightdt leftrho e p fracrhovbtcdotvbtrightnablabcdotvbt vbtcdotnablab p rhovbtcdotgb rhovbtcdotleftleftobcdotrbtrightob rhoomegarbtrightnonumb fracdleftrho widetildeerightdt rhowidetildeenablabcdotvbt nablabcdotleftpvbtright rhovbtcdotgb rhovbtcdotleftleftobcdotrbtrightob rhoomegarbtright labeleqetotrottot endalign math labeleqetotrot fracpartialleftrhowidetildeerightparti nablabcdotleftrhowidetildeevbt pvbtright rhovbtcdotgb rhovbtcdotleftleftobcdotrbtrightob rhoomegarbtright switch rotat refer frame choos stationari observ rotat refer frame drop tild indic term noninerti frame mathwidetildec make sure account offset mathboldsymbol two coordin system obtain follow equat hydrodynam rotat frame refer math beginalign fracpartialrhoparti nablabcdotleftrhovbright labeleqcontrotswitch fracparti leftrhovbrightparti nablabcdotleftrhovbvbright nablab p rhogb rhoobtimesvb rholeftobcdotrbrightob rhoomegarb labeleqmomrotswitch fracpartialleftrho erightparti nablabcdotleftrho evb pvbright rhovbcdotgb rholeftobcdotrbrightleftobcdotvbright rhoomegaleftvbcdotrbright labeleqetotrotswitch endalign ad forc hydrodynam sever way incorpor effect rotat forc hydrodynam evolut control use runtim paramet castrorot_source_typ integ valu current rang valu analog way graviti use updat momentum energi part differ energi updat done castrorot_source_typ use standard predictorcorrector formal updat momentum energi specif first updat equal mathdelta time mathbfsn mathmathbfsn valu sourc term oldtim usual call timelevel mathn end timestep corrector step subtract mathdelta time mathbfsn add mathdelta time mathbfsn end timestep sourc term properli time center castrorot_source_typ someth similar major differ evalu energi sourc term new time equal mathmathbfu cdot mathbfsn_rho mathbfu latter momentum sourc term evalu new time first updat momentum rather use valu mathmathbfu enter rotat sourc term permit tighter coupl momentum energi updat seen usual result accur evolut castrorot_source_typ momentum updat previou two energi updat put work updat kinet energi alon particular explicitli ensur mathrho e maintain updat mathrho k work due rotat ad new kinet energi old intern energi determin final total ga energi physic motiv work done veloc directli updat temperatur indirectli thing like shock castrorot_source_typ energi updat done conserv fashion previou method evalu valu sourc term cell center method evalu chang energi cell edg use hydrodynam mass flux permit total energi conserv exclud possibl loss open domain boundari addit veloc updat slightli differentfor corrector step note implicit coupl veloc compon directli solv coupl equat result slightli better coupl accur evolut major option castroimplicit_rotation_upd updat corioli term momentum equat implicitli eg veloc corioli forc zone depend updat momentum energi updat unchang detail discuss option verif test present citekatz timestep retri simul time two paramt defin simul end max_step maximum number level time step integ mathgeq default stop_tim final simul time real mathgeq default control number time step limit maximum number level time step max_step final simul time stop_tim code stop whichev criterion come first note code reach stop_tim final time step shorten end exactli stop_tim past exampl max_step stop_tim end calcul either simul time reach number level step taken equal whichev come first time step constraint hydrodynam castrodo_hydro typic code choos time step base cfl number math delta mathttcfl cdot min_ijkleftminleftfracdelta xu_ijkc_ijk fracdelta yv_ijkc_ijk fracdelta zw_ijkc_ijkrightright label eqcfl sdc integr use instead math delta mathttcfl cdot min_ijkleftleftfracdelta xu_ijkc_ijkright leftfracdelta yv_ijkc_ijkright leftfracdelta zw_ijkc_ijkrightright simul extran part relat mathv andor mathw remov addit control follow paramet affect timestep choic castrocfl cfl number real math mathleq default castroinit_shrink factor shrink initi time step real math mathleq default castrochange_max factor time step grow subsequ step real mathgeq default castrofixed_dt level time step regardless cfl set real math unus set castroinitial_dt initi level time step regardless set real math unus set castrodt_cutoff fraction current simul time time step calcul abort real math default e typic userdefin exampl consid castrocfl castroinit_shrink castrochange_max defin mathmathttcfl paramet eqeqcfl set via init_shrink first timestep take would otherwis allow us ramp hydrodynam timestep start simul change_max paramet restrict timestep increas coars timestep note time step shrink factor control extent grow dt_cutoff paramet forc code abort timestep ever drop math current time safeti featureif code hit small valu someth like went wrong simul abort wont burn entir alloc notic issu know forc particular timestep castrofixed_dt e set level time step e entir simul ignor timestep control note castroinit_shrink mathneq first time step fact castroinit_shrink mathcdot castrofixed_dt castroinitial_dt e set initi level time step math regardless castrocfl castrofixed_dt time step grow subsequ step factor castrochange_max step diffus diffus enabl timestep also limit math delta fracmin_ijkleftminleftfracdelta xd_ijk fracdelta yd_ijk fracdelta zd_ijkrightright mathd equiv k rho c_v diffus temperatur mathd equiv k rho c_p diffus enthalpi input paramet necessari enabl constraint see chapter refchdiffus detail reaction reaction enabl timestep also limit two constraint math delta mathttdtnuc_ min_ijk leftfrace_ijkdote_ijkright math delta mathttdtnuc_x min_ijk leftmin_nfracxn_ijkdotxn_ijkright math intern energi mathxn mass fraction mathn th speci safeti factor correspond runtim paramet castrodtnuc_ castrodtnuc_x limit say timestep must small enough zone chang intern energi fraction one step zone chang abund isotop fraction one step time deriv mathdot mathdotxn estim call righthandsid nuclear network given state time timestep limit calcul use small number floor prevent divis zero prevent timestep domin trace speci addit option castrodtnuc_x_threshold mass fraction threshold speci consid timestep constraint set larg number default effect disabl typic choic valu literatur mathsim subcycl subcycl amr mean coarser grid take larger timestep finer grid castro support number differ mode subcycl time set via amrsubcycling_mod amrsubcycling_mod auto default code run equal refin space time word level mathn factor refin level mathn mathn take step half durat everi level mathn step amrsubcycling_mod none code refin time level advanc togeth timestep dictat level strictest mathdt note ident deprec command amrnosub amrsubcycling_mod manual code subcycl accord valu suppli amrsubcycling_iter case amrsubcycling_mod manual subcycl manual mode largest allow timestep number iter level specifi amrsubcycling_iter take level timestep time requir take level timestep level step timestep level level step take timestep level level step altern could amrsubcycling_iter subcycl twice everi level except level index retri _chretri retri mechan castro strang ctu solver retri mechan discard time step level restart smaller timestep subcycl within level make full time step need level enabl set castrouse_retri note castro retri mechan enabl default ctu strang simplifi sdc integr number subcycl tri level control via castromax_subcycl paramet realli suggest go beyond usual indic bigger problem retri trigger number condit exceed cfl condit level neg densiti encount integr failur burner note requir follow set extern namelist retry_burn f abort_on_failur f instruct integr routin microphys abort integr fail instead tell call castro routin integr fail castro handl retri note combin use_retri abort_on_failur f unsaf support true sdc disabl retri reset abort_on_failur alway true sinc retri support integr set problem castro problem organ loos group describ intent eg scienc hydro test group subdirectori castroexec directori problem place subdirectori appropri group exampl castroexechydro_testssedov hold sedov test problem creat new problem creat new directori one group place follow file gnumakefil makefil problem tell castro option use network eo build problem_initializeh problem_initialize_state_datah hold problem initi routin mhd radiat problem requir addit file _prob_param option list runtim paramet problem read paramet control set input file problemparam param one paramet list _prob_param makepackag makefil fragment includ build process tell build system problemspecif file need compil input main input file control castro amrex behavior best way get start write new problem copi exist problem setup new directori index _prob_param runtim paramet problemspecif runtim paramet defin _prob_param form name datatyp default namelist size name name variabl put probdata_modul datatyp one real integ charact logic default default valu runtim paramet may overridden runtim read namelist namelist indic variabl abl set runtim paramet empti mark n variabl still creat problem namespac abl set via commandlin input file common usag defin global variabl might set problem initi use elsewher castro size array give size integ variabl known probdata_modul need variabl differ modul specifi size exampl nspec network express size tupl nspec network appropri use statement ad variabl initi gpu well problem initi describ main problem initi routin index initialize_problem initialize_problem c routin primarili respons onetim initi problem like read initi model model_parserh functionalityse toy_convect problem setup exampl routin also postprocess paramet defin _prob_param file defin problem namespac note mani problem set valu problemcent array problem namespac use note center problem necessarili need center domain eg axisymmetr problem center use sourc term includ rotat graviti comput deriv variabl like angular momentum need coordin inform obtain construct geometri object use defaultgeometri access problo probhi method problem_initialize_state_data routin initi state data given zone argument pass j k index zone fill data state array contain simul state data geomdata geometrydata object use obtain dx problo probhi etc fill data done simpli write stateijkurho etc _createbc boundari condit index boundari condit standard boundari condit includ outflow zerogradi period symmetri reflect handl amrex directli castro special hydrostat boundari condit use lower boundari access set castrolo_bc flag vertic coordin direct eg castrolo_bc flag valu tradit name inflow amrex gener mean boundari implement left user tell castro use hydrostat boundari condit set castroyl_ext_bc_typ castrohse_interp_temp castrohse_reflect_vel first paramet tell castro use hse boundari condit lower direct fill ghost cell hydrostat equilibrum integr last interior zone boundari need one equat integr either interpol densiti temperatur ghost cell depend valu castrohse_interp_temp final castrohse_reflect_vel determin treat veloc default give zero gradient test weve found reflect veloc integr hse profil better model planeparallel hydrostat atmospher use hydrostat boundari condit instead simpl symmetri boundari essenti use standard ctu ppm solver differ special boundari condit base outflow avail upper boundari work togeth model_pars modul fill ghost cell upper boundari initi model data set castrohi_bc castrofill_ambient_bc castroambient_fill_dir castroambient_outflow_vel ambient_fill_dir base direct fill use ambient state defin problem setup exampl overrid outflow boundari condit ydirect problem setup need fill ambient_st array defin ambienth exampl use boundari flame_wav problem implement boundari condit found castrosourceproblemscastro_bc_fill_ndcpp option file follow problemspecif file option stub main sourc tree problem_checkpointh problem_restarth provid two routin respect problem_checkpoint problem_restart use add inform checkpoint file read upon restart use global problemspecif quantiti instanc wdmerger problem use store center mass posit veloc inform checkpoint file use runtim diagnost name checkpoint directori pass argument problem_taggingh implement problemspecif tag refin function problem_tag full hydrodynam state state_typ pass problem mark zone refin set tag variabl zone set exampl provid toy_convect problem refin rectangular region fuel layer base densiti paramet h mass fraction problem_derivesh problem_deriveh problem_derivescpp togeth provid mechan creat deriv quantiti store plotfil problem_derivesh provid c code defin new plot variabl ad derive_lsta list deriv variabl castro know ad new variabl descript name fortran routin deriv compon statedata specifi two file provid header implement function comput deriv variabl exampl provid reacting_bubbl problem deriv sever new quantiti perturb background onedimension model case probcpp problemh file provid problemspecif routin comput global diagnost inform sum_integrated_quant function part castro class exampl provid toy_flam estim flame speed comput integr mass fuel grid model parser mani problem setup begin initi model map onto grid model_parserh provid function read initi model map castro grid enabl add use_cxx_model_pars true problem gnumakefil paramet set makefil control initi model storag max_npts_model maximum number data point initi model need known compil time make data manag gpu num_model number differ initi model want manag typic want problem like flame_wav use appli differ portion domain gener form initi model npt num variabl densiti temperatur pressur carbon oxygen magnesium e e first line give number point initi model next give number variabl follow variabl name one per line data data begin coordin variabl model one data point per line model read variabl list file match one castro know variabl recogn store model data otherwis ignor data map onto grid use interpol function eg real den interpolateheight modeliden fill den densiti posit height addit densiti specifi temperatur modelitemp pressur modelipr speci index modelispec auxiliari quantiti index modeliaux restart maestro overview initi castro simul use data maestro plotfil thought restart mode rather new simul special initi order use featur must make sure maestro plotfil proper variabl add new paramet input file add subroutin prob_xdf need build special execut use_maestro_inittru add maestro execut string multilevel problem extra step relat fact suppli grid file consist maestro grid structur maestro plotfil requir maestro plotfil need follow variabl x_vel y_vel z_vel depend dimension problem densiti castromaestro_init_typ option speci xc option read speci maestro plotfil case must make sure code manual defin speci cellbycel initi castro data tfromp pi castromaestro_init_typ entropi castromaestro_init_typ also model_cc_xxxxx need list variabl follow order default order found maestrosourcebase_iof r base_r rho p gammabar rhoh div_coeff psi tempbar etarho_cc tempbar_init list paramet addit paramet must add input file paramet definit type default castromaestro_plotfil name stdstring must set maestro plotfil castromaestro_modelfil name stdstring must set maestro model_cc file castromaestro_npts_model number int must set point maestro model_cc file castromaestro_first_speci name stdstring must set first speci els noth read castromaestro_nspec number stdstring numspec speci castro maestro plotfil castromaestro_cutoff_dens control real must set overwrit data edg star castromaestro_init_typ determin int must set initi castro state castromaestro_spher specifi int must set planar spheric problem exampl usag castromaestro_plotfil wd__ek_norotate_plt castromaestro_modelfil wd__ek_norotate_pltmodel_cc_ castromaestro_npts_model number point castromaestro_modelfil note thing npts_model number point initi model file use standard simul initi maestro plotfil castromaestro_first_speci xc specifi speci read alway manual specifi overwrit speci cellbycel later castromaestro_nspec specifi default number speci castro network numspec sometim maestro castro use differ network differ number speci castromaestro_cutoff_dens e code use densiti figur radial coordin r_model_start last radial coordin rho fall castromaestro_cutoff_dens possibl set castromaestro_cutoff_dens tini valu rho never fall valu case set r_model_start mathinfti initdata_makemodel creat new model integr outward start r_model_start initdata_overwrit overwrit newli initi castro data cell map radial coordin greater r_model_start interpol new model castromaestro_init_typ castro read data maestro plotfil call eo make sure mathrho math matht mathx_k consist input eo base valu castromaestro_init_typ math erhotx_k mathet etrhop_pix_k mathrho rhoep_pitx_k mathrhot rhotep_pisx_k castromaestro_spher planar spheric new subroutin prob_xdf three routin need ad local copi prob_xdf see castroexecwdconvectprob_df standard spheric maestro initi initdata_maestro fill castro state take maestro data call eo make proper variabl conserv quantiti specif need thermodynam consist mathrho matht math mathx_k algebra comput mathrhobf u mathrho e mathrho e mathrho x_k initdata_makemodel creat userdefin initi model start r_model_start initdata_overwrit overwrit initi castro data use new initi model cell map radial coordin greater r_model_start addit note note singlelevel multilevel maestro castro initi castro base grid structur match maestro base grid structur long problem domain exampl coarsest level maestro plotfil contain math cell divid math grid ok use castro base grid structur math grid math grid anyth els imagin grid dont even size normal case castro base grid structur creat base paramet castro input file amrmax_grid_s amrblocking_factor etc multilevel restart initi multilevel maestro plotfil extra step first need creat castrocompat grid file maestro plotfil done boxlibtoolspostprocessingf_srcfboxinfof util compil run use castro option eg fboxinfolinuxgfortranex castro pltxxxxx tee grmaestro gener castrocompat grid file note base grid structur still control amrmax_grid_s amrblocking_factor etc sinc c amrex grid file indic refin grid structur wherea fortran boxlib grid file contain base grid refin grid structur initi castro simul need specifi grid file use amrregrid_fil gr_d_level exampl happili run note regrid algorithm never call sinc castro think start new simul scratch grid file thu disabl regrid wish grid structur chang must tradit castro restart castrogener checkpoint file still use maestro execut execut built use_maestro_initfals make sure speciti amrregrid_fil els grid stay fix free specifi amrregrid_on_restart amrcompute_new_dt_on_regrid amrplotfile_on_restart sometim maestro plotfil total level ultim want run castro simul mani level refin recommend strategi follow initi castro simul maestro plotfil preserv exact grid structur run time step tradit castro restart chk increas amrmax_level run time step allow new grid structur effect resolut settl use c boxlib regrid algorithm tradit castro restart chk increas amrmax_level run time step repeat procedur previou step use updat checkpoint cours mani time desir _chmhd mhd introduct castro implement constrain transport ct corner transport upwind ctu ideal mhd scheme base work miniati martin citeminiati_martin mhd enabl compil use_mhd true replac pure hydrodynam solver use driver ctu hydrodynam solver mean sourc term support hydrodynam solver also support mhd note mhd solver support current mhd solver singlelevel amr support forthcom equat data structur ideal mhd equat solv appear math beginalign fracparti rho x_kpartial fracpartialparti x_j rho u_j x_k rho omegadot_k fracparti rho u_jparti fracpartialparti x_j rho u_i u_j p delta_ij b_j b_i s_rho u_j fracparti rho eparti fracpartialparti x_j left u_j rho e p b_j b_i u_i right s_rho e rho h_mathrmnuc fracparti b_iparti fracpartialparti x_j u_j b_i b_j u_i endalign math p p_g frac b math sourc repres hydrodynam sourc remaind reaction sourc mhd solver use timeadvanc driver hydrodynam ctu driver refsecstrangctu use strang split reaction default note note follow convent mhd commun set permeabl uniti magnet pressur form mathfrac b instead mathfracpi b effect carri magnet field mathbf bprime bf bsqrtpi wish express magnet field gauss need multipli valu castro carri mathsqrtpi constrain transport algorithm algebra ensur mathnabla cdot bf b throughout algorithm magnet field facecent electr field edgecent conserv state cellcent averag unless specifi otherwis use follow index convent uijk cellcent state mathu_ijk qleftijk interfac valu state exampl xdirect would mathq_ijk bxijk facecent xcompon magnet field mathb_xijk exijk edgecent xcompon electr field mathe_xijk problem initi index ca_initmag addit initi routin mhd problem_initialize_mhd_data use initi facecent magnet field compon done separ main conserv fluid state conserv fluid state initi problem_initialize_state_data pure hydrodynam problem note need includ magnet energi contribut total energi densiti ueden initi driver handl addit magnet contribut hydrodynam updat use piecewis linear piecewis parabol reconstruct characterist project full riemann solv corner transport upwind method hlld riemann solver use within solver use index primit state defin reftableprimlist addit qmagx qmagi qmagz cellcent magnet field compon qptot total pressur ga magnet like pure hydrodynam reconstruct type control castroppm_typ select piecewis linear select piecewis parabol piecewis linear method slope limit control plm_iorder runtim paramet hydrodynam addit option mhd_limit_characterist control whether want slope limit characterist variabl default primit variabl electr updat coupl hydrodynam updat electr field updat updat compon e use contact upwind scheme first propos citeg updat electr field give magnet field via faraday law discret ensur mathnabla cdot bf b _chgraviti graviti introduct graviti type castro incorpor graviti constant monopol approxim full poisson solv enabl graviti code set use_grav true gnumakefil turn input file via castrodo_grav want incorpor point mass castropoint_mass must use_pointmass true gnumakefil current three option graviti calcul control set gravitygravity_typ option constantgrav poissongrav monopolegrav relev use_grav true gnumakefil castrodo_grav input file set user requir specifi graviti type input file program abort note make sure set problemcent variabl appropri problem done directli set problem_initi function integr strategi castro use subcycl integr level differ timestep graviti algorithm need respect obtain full accuraci selfgrav comput via multigrid solv gravitygravity_typ poissongrav correct though graviti type coarsefin interfac stencil use laplacian understand coarsefin interfac differ stencil use interior two type solv discuss amr composit solv multilevel solv start coars level usual level solv potenti level finest level level solv solv potenti particular level finer level ignor coarsefin interfac data coars level act dirichlet boundari condit currentlevelsolv overal integr strategi follow similar discuss citecastro_i briefli begin simul multilevel composit solv gravityno_composit also multilevel composit solv regrid oldtim graviti coars level defin base composit solv also level solv coars level use determin differ composit solv level solv store multifab hydro advanc coars level anoth level solv use level solv composit solv lag predictor much need add back level solv get effect newtim valu phi coars level that defin phi use newtim graviti fine grid timestep use strategi amr synchron step across level see section refsecamr_synchron descript synchron occur choos synchron gravit field across level gravityno_sync solv start coars grid adjust mismatch finegrid phi coarsegrid phi well mismatch finegrid densiti flux coarsegrid densiti flux add result sync solv phi coars fine level thu within graviti error toler get final result done full composit solv end timestep assum gravityno_sync gravityno_composit never full multilevel solv graviti level defin solv level time would appropri fine level cover essenti mass grid time control full poisson solver gravitygravity_typ poissongrav behavior full poisson solv multigrid solver control gravityno_sync gravityno_composit isol boundari condit gravitygravity_typ poissongrav paramet gravitymax_multipole_ord gravitydirect_sum_bc control accuraci dirichlet boundari condit describ section secpoissondbcs__ monopolegrav must coord_si must coord_si follow paramet appli graviti solv gravitygravity_typ calcul graviti constantgrav poissongrav monopolegrav gravityconst_grav gravitygravity_typ constantgrav set valu constant graviti default gravityno_sync gravitygravity_typ poissongrav perform sync solv default gravityno_composit gravitygravity_typ poissongrav whether perform composit solv default gravitymax_solve_level maximum level solv mathphi mathmathbfg level interpol default max_lev gravityabs_tol gravitygravity_typ poissongrav absolut toler poisson solv specifi singl valu toler noth get reason default valu absolut toler use multigrid solv abs_tol mathtim pi g rho_textmax mathrho_textmax maximum valu densiti domain fine level absolut toler multipli mathmathttref_ratio account chang absolut scale laplacian oper also specifi array valu abs_tol one possibl level simul scale mathmathttref_ratio appli gravityrel_tol gravitygravity_typ poissongrav rel toler poisson solv default zero specifi singl valu toler appli everi level specifi array valu rel_tol one possibl level simul replac old paramet gravityml_tol gravitymax_multipole_ord gravitygravity_typ poissongrav max mathel valu use multipol bc must mathgeq default gravitydirect_sum_bc gravitygravity_typ poissongrav evalu bc use exact sum default gravitydrdxfac ratio dr monopol graviti bin grid resolut follow paramet affect coupl hydro graviti castrodo_grav turn onoff graviti castromoving_cent recomput center use multipol graviti solver step castropoint_mass point mass center star must mathgeq default note follow max_lev hardcod paramet sourcegravitycpp current set determin mani level track graviti object type approxim constantgrav graviti defin constant direct magnitud defin input file gravityconst_grav exampl set graviti magnitud math neg mathydirect neg mathzdirect actual set done gravitycpp gravsetvalconst_grav amrex_spacedim ng note present fill gravit potenti mathphi mode set zero note constantgrav use along cartesian direct vertic axisymmetr _secmonopolegrav monopolegrav monopolegrav integr mass distribut grid spheric shell defin enclos mass use comput gravit potenti acceler sphericallysymmetr fashion spheric coordin comput math gr fracg m_rm enclos r mathm_rm enclos calcul densiti time call level coarsest level defin extent level radial array rang center star mathr cell level farthest away origin gap fine grid rang interpol densiti coarser level order construct continu densiti profil note locat valu densiti profil gravit field exactli match locat data level need interpol point map radial profil mathg back onto origin grid comput radial averag densiti use comput graviti onedimension integr interpol graviti vector back onto cartesian grid cell coarsest level defin extent array rang center star farthest possibl point grid plu extra cell fill ghost cell valu graviti finer level first defin singl box contain box fine level interpol densiti coarser level need fill valu densiti everi fine cell box extent radial array center star nearest cell one face singl box ensur cell maximum radiu array contain box averag densiti onto radial array note map cartesian cell radial array back unlik case requir interpol use quadrat interpol limit interpol creat new maxima minima default resolut radial array level grid cell space level ie mathdelta r delta x increas accuraci one defin gravitydrdxfac number greater math math math recommend space radial array satisfi mathdelta x delta r drdxfac individu cartesian grid cell subdivid drdxfac coordin direct purpos averag densiti integr creat mathg done finer resolut new mathdelta r note center star defin subroutin probinit radiu comput distanc center note addit correct corner make_radial_grav account volum shell part grid potenti case make_radial_phi come play poissongrav gener case selfinduc gravit field math mathbfgmathbfxt nabla phi mathphi defin solv math mathbfdelta phi pi g rho label eqself graviti allow poissongrav comput monopol approxim spheric coordin faster accur solv poisson equat poisson boundari condit boundari condit period direct use monopol approxim coarsest level involv comput effect radial densiti profil level integr outward center get gravit acceler mathmathbfg integr mathg outward center get mathphi use mathphi boundari condit sinc mass enclos mathr detail see section secmonopolegrav__ _secpoissondbc poisson boundari condit follow describ method isol boundari condit best refer castro implement citekatz multipol expans default use multipol expans estim valu boundari condit accord exampl jackson classic electrodynam correspond chang poisson equat electr charg gravit charg expans spheric harmon mathphi math phimathbfx gsum_linftysum_ml fracpil q_lm fracy_lmthetaphirl label spherical_harmonic_expans origin coordin system taken center variabl must declar store probdata modul project directori valid expans use base assumpt sphere center center radiu approxim equal size half domain would enclos mass furthermor lowest order term expans captur departur spheric symmetri therefor crucial center near center mass system approach achiev good result multipol moment mathq_lm calcul expand green function poisson equat seri spheric harmon yield math q_lm int y_lmthetaprim phiprim rprimel rhomathbfxprim dxprime labelmultipole_moments_origin simplif eqspherical_harmonic_expans achiev use addit theorem spheric harmon math beginalign fracpil sum_mll y_lmthetaprimephiprim y_lmtheta phi p_ltextco theta p_ltextco thetaprim notag sum_ml fraclmlm p_lmtextco theta p_lmtextco thetaprim lefttextcosmphi textcosmphiprim textsinmphi textsinmphiprimerightendalign mathp_lm associ legendr polynomi mathp_l legendr polynomi algebra simplif potenti outsid mass distribut written follow way math phimathbfx approx gsum_ll_textmax leftq_l fracp_ltextco thetarl sum_m lleft q_lmc textcosmphi q_lm textsinmphiright fracp_lmtextco thetarl right modifi multipol moment math beginalign q_l int p_ltextco thetaprim rprimel rhomathbfxprim xprime q_lmc fraclmlm int p_lmtextco thetaprim textcosmphiprim rprimel rhomathbfxprim xprime q_lm fraclmlm int p_lmtextco thetaprim textsinmphiprim rprimel rhomathbfxprim xprimeendalign strategi multipol boundari condit pick valu mathl_textmax suffici high order captur distribut mass grid evalu discret analog modifi multipol moment math leq l leq l_textmax math leq leq l directli comput valu potenti boundari zone ultim mathmathcalon oper order monopol approxim wall time requir calcul boundari condit depend chosen valu mathl_textmax number mathl valu calcul control gravitymax_multipole_ord input file default set mean monopol approxim use current hardcod limit mathl_textmax method use gener legendr polynomi numer stabl arbitrari mathl polynomi get larg larg enough mathl direct sum truncat error caus discret boundari valu potenti comput exactli direct sum cell grid suppos consid ghost cell outsid grid locat mathmathbfrprim equiv xprime yprime zprime principl linear superposit appli gravit potenti math phimathbfrprim sum_textijk fracg rho_textijk delta v_textijkleftx xprime yprime z zprimeright mathx xi mathi yj mathz zk construct usual sens zone indic sum run everi cell physic domain calcul mathmathcalon boundari cell mathn ghost cell need poisson solv sinc six physic face domain total cost oper mathmathcalon oper coars grid present practic use domain decomposit inher code implement solv grid live mpi task creat six mathn array repres face iter everi cell grid comput respect contribut face global reduc add contribut cell togeth final place boundari condit term appropri grid onto respect cell quit expens even reason size domain option recommend analysi purpos check method produc accur result enabl set gravitydirect_sum_bc input file point mass pointmass graviti work form graviti separ option sinc poisson equat linear potenti deriv acceler also linear point mass option work ad gravit acceler point mass onto acceler whatev graviti type simul note point mass may mass use option point_mass_fix_solut set take zone adjac locat center variabl keep densiti constant chang densiti occur hydro updat zone reset mass delet ad pointmass expans densiti lower point mass reduc mass ad back grid calcul done pointmass_upd castro_pointmasscpp gr correct case compact object massiv star gener rel gr effect start play role _ first consid hydrostat equilibrium due effect gr deriv grcorrect term newtonian graviti correct term appli monopol approxim use_gr true set gnumakefil formula grcorrect base citegrbk detail physic pleas refer citegrbk describ strong gravit field need use einstein field equat math r_ikfracg_ikrfrackappact_ik quad quad kappafracpi gcquad label field mathr_ik ricci tensor mathg_ik metric tensor mathr riemann curvatur mathc speed light mathg gravit constant matht_ik energi momentum tensor ideal ga nonvanish compon matht_ mathvarrho c matht_ matht_ matht_ mathp contain rest mass energi densiti mathp pressur interest spheric symmetr mass distribut line element mathd given spheric coordin mathr vartheta varphi gener form math labelmetr ds enucdtelambdadrrdvarthetasin vartheta dvarphi quad mathnu nur mathlambda lambdar put express matht_ik mathd eqfield field equat reduc ordinari differenti equat math frackappa pc elambdaleft fracnuprimerfracr right fracr quad label diff math frackappa pc fracelambdaleft nuprimeprimefracnuprimefracnu primelambdaprim fracnuprimelambdaprim right quad label diff math kappa varrho elambdaleft fraclambdaprimerfracrright fracr quad label diff prime mean deriv respect mathr multipli mathpi r eqdiff integr yield math labelgmass kappa pi r elambda quad mathm call gravit mass insid r defin math labelgmass int_rpi r varrho drquad mathr r mathm becom mass mathm star mathm contain rest mass whole energi divid mathc includ intern gravit energi mathvarrho varrho_ uc contain whole energi densiti mathu restmass densiti mathvarrho_ differenti eqdiff respect mathr give mathp pprimelambdalambdaprim nunuprim mathlambdalambdaprimenunuprim elimin eqdiff eqdiff eqdiff final reach tolmanoppenheinmervolkoff tov equat hydrostat equilibrium gener rel math fracdpdr fracgmrvarrho left fracpvarrho cright left fracpi r pm cright left fracgmr c right quad label tov newtonian case mathc rightarrow infti revert usual form math labelnewton fracdpdr fracgmrvarrho quad take effect monopol graviti math tildeg fracgmr fracpvarrho cfracpi r pm c fracgmr c quad label tov gener situat neglect mathuc potenti energi usual much smaller mathvarrho_ matht reach math k mathkt approx m_p c mathm_p proton mass realli make differ eqtov express math labeltov tildeg fracgm_rm enclosedr left fracpvarrho c right left fracpi r pm_rm enclos c right left fracgm_rm enclosedr c right quad mathm_enclos mean monopolegrav approxim hydrodynam sourc term sever option incorpor effect graviti hydrodynam system main paramet castrograv_source_typ castrograv_source_typ use standard predictorcorrector formal updat momentum energi specif first updat equal mathdelta time mathbfsn mathmathbfsn valu sourc term oldtim usual call timelevel mathn end timestep corrector step subtract mathdelta time mathbfsn add mathdelta time mathbfsn end timestep sourc term properli time center castrograv_source_typ someth similar major differ evalu energi sourc term new time equal mathmathbfu cdot mathbfsn_rho mathbfu latter momentum sourc term evalu new time first updat momentum rather use valu mathmathbfu enter graviti sourc term permit tighter coupl momentum energi updat seen usual result accur evolut castrograv_source_typ momentum updat previou two energi updat put work updat kinet energi alon particular explicitli ensur mathrho e remain updat mathrho k work due graviti ad new kinet energi old intern energi determin final total ga energi physic motiv work done veloc directli updat temperatureonli indirectli thing like shock castrograv_source_typ energi updat done conserv fashion previou method evalu valu sourc term cell center method evalu chang energi cell edg use hydrodynam mass flux permit total energi conserv exclud possibl loss open domain boundari see citekatzthesi detail note gr code text contribut ken chen univ minnesota verif hydrodynam test problem sod problem shock tube problem exechydro_testssod problem directori set gener onedimension shock tube left right primitivevari state specifi solut evolv userspecifi end time simpl discontinu exact solut found exact riemann solver problem exact solut comput exact riemann solver toro citetoro chapter sod problem sod problem citesod simpl shock tube problem exhibit shock contact discontinu rarefact wave initi condit math beginarrayl rho_l u_l p_l endarray qquad beginarrayl rho_r u_r p_r endarray gamma_law equat state use mathgamma system evolv matht setup provid follow input file setup sod problem inputssodx sod problem along mathxdirect inputssodi sod problem along mathydirect inputssodz sod problem along mathzdirect multidimension run direct transvers jump kept constant use cfl number initi timestep shrink castroinit_shrink maximum factor timestep increas castrochange_max _figsod figur sod_dpng alt sod problem align center width castro solut sod problem run newest ppm limit along mathx mathi mathz axe coars grid zone direct propag level refin use analyt solut appear red line _figsod_ppm figur sod_d_ppmpng alt sod problem align center width castro solut sod problem run piecewiselinear godunov method limit along mathx mathi mathz axe coars grid zone direct propag level refin use analyt solut appear red line numreffigsod show castro solut use newest ppm limit compar analyt solut show densiti veloc pressur intern energi numreffigsod_ppm numreffigsod piecewiselinear godunov method limit shown comparison verif subdirectori includ analyt solut sod problem sodexactout mathgamma slice extract castro plotfil use fextract tool amrextoolspostprocessingc_src step gener verif plot castro exechydro_testssod build castro execut run sod problem castro mathx mathi mathz direct castrodlinuxintelintelex inputssodx castrodlinuxintelintelex inputssodi castrodlinuxintelintelex inputssodz build fextract tool amrextoolspostprocessingc_src run fextract castro output gener slice output fextractdlinuxintelex sodxout p sod_x_plt fextractdlinuxintelex sodyout p sod_y_plt fextractdlinuxintelex sodzout p sod_z_plt copi sodxyzout file verif directori verif run gnuplot script sod_dgp gnuplot sod_dgp produc figur sod_dep doubl rarefact doubl rarefact test problem describ toro citetoro chapter test center domain evacu two rarefact wave propag direct outward center difficult get intern energi behav center domain creat vacuum initi condit math beginarrayl rho_l u_l p_l endarray qquad beginarrayl rho_r u_r p_r endarray gamma_law equat state use mathgamma system evolv matht setup provid follow input file setup doubl rarefact problem inputstestx doubl rarefact problem along mathxdirect inputstesti doubl rarefact problem along mathydirect inputstestz doubl rarefact problem along mathzdirect use cfl number initi timestep shrink castroinit_shrink maximum factor timestep increas castrochange_max ppm solver new limit use _figtest figur test_dpng alt doubl rarefact align center width castro solut doubl rarefact problem run along mathx mathi mathz axe coars grid zone direct propag level refin use analyt solut appear red line numreffigtest show castro output run along coordin axe compar analyt solut comparison analyt solut follow procedur describ sod problem gnuplot script test_dgp gener figur slice creat fextract name testxout testyout testzout strong shock strong shock test test problem describ toro citetoro chapter test larg pressur jump initi interfac creat strong rightward move shock follow close contact discontinu initi condit math beginarrayl rho_l u_l p_l endarray qquad beginarrayl rho_r u_r p_r endarray gamma_law equat state use mathgamma system evolv matht setup provid follow input file probin file setup strong shock problem inputstestx strong shock problem along mathxdirect inputstesti strong shock problem along mathydirect inputstestz strong shock problem along mathzdirect use cfl number initi timestep shrink castroinit_shrink maximum factor timestep increas castrochange_max ppm solver new limit use _figtest figur test_dpng alt strong shock align center width castro solut strong shock problem run along mathx mathi mathz axe coars grid zone direct propag level refin use analyt solut appear red line numreffigtest show castro output run along coordin axe compar analyt solut comparison analyt solut follow procedur describ sod problem gnuplot script test_dgp gener figur slice creat fextract name testxout testyout testzout sedov problem sedov sedovtaylor blast wave standard hydrodynam test problem larg amount energi place small volum drive spheric cylindr cartesian coordin blast wave analyt solut found sedov citesedov cylindr blast wave eg point explos plane model cartesian coordin spheric blast wave model spheric axisymmetr cylindr mathrmathz cartesian coordin provid good test geometr factor hydrodynam solver use public avail code sedovf citetimmes_sedov_cod gener analyt solut castro implement sedov problem exechydro_testssedov number differ input file provid correspond differ sedovcastro geometri main one _tablesedov_input tabl sedov problem input file input file descript inputsdsph spheric sedov explos model spheric coordin inputsdsph_in_cylcoord spheric sedov explos model cylindr axisymmetr coordin inputsdcyl_in_cartcoord cylindr sedov explos model cartesian coordin inputsdsph spheric sedov explos model cartesian coordin sedov problem explos energi mathe_mathrmexp unit energi energymass energyvolum deposit singl point medium uniform ambient densiti mathrho_mathrmambi pressur mathp_mathrmambi initi problem difficult small volum typic cell extent lead grid imprint solut standard solut see exampl citeomang refer therein convert explos energi pressur contain within certain volum mathv_mathrminit radiu mathr_mathrminit math p_mathrminit fracgamma e_mathrmexpv_mathrminit pressur deposit cell mathr r_mathrminit minim grid effect subsampl zone zone divid mathn_mathrmsub subzon coordin direct subzon initi independ subzon averag togeth use volum weight spheric cylindricalaxisymmetr castro grid determin initi state full zone run use mathrho_mathrmambi mathp_mathrmambi mathe_mathrmexp mathr_mathrminit mathn_mathrmsub base grid zone coordin direct plu level refin use finest mesh would coorespond zone coordin direct domain run coordin direct analysi routin sedov problem provid castrodiagnosticssedov type make build specifi dimension dim variabl build spheric sedov explos model spheric cylindr axisymmetr cartesian coordin use input file describ numreftablesedov_input radial profil extract use analysi routin exampl run process cylindr sedov explos one would exechydro_testssedov build castro execut run spheric sedov problem castro cylindr coordin castrodlinuxintelintelex inputsdsph_in_cylcoord build sedov_d_ex tool castrodiagnosticssedov run analysi script castro output gener radial profil sedov_dex sphr yctr sedov_d_sph_in_cylout p sedov_d_sph_in_cyl_plt similar procedur use spheric sedov explos output name sedov_d_sphout sedov_d_sphout respect done sedov_sphgp gnuplot script use make plot compar solut analyt solut spherical_sedovdat numreffigsedov_sph show comparison castro spheric sedov explos simul analyt solut _figsedov_sph figur sedov_sphpng alt sedov blast wave align center width castro solut sedov blast wave problem run spheric axisymmetr cartesian coordin geometri produc spheric sedov explos cylindr blast wave figur sedov_cylpng alt sedov align center width castro solut sedov blast wave problem run cartesian coordin correspond cylindr sedov explos rayleightaylor domain size cell singl level calcul period x solid wall top bottom gamma law ga mathgamma reaction zero initi veloc constant mathgb densiti profil essenti mathrho bottom mathrho top perturb singlemod perturb construct math tild yx fraccospi x cospil_x x note symmetr form cosin done ensur roundoff error introduc leftright asymmetri problem without construct rt instabl lose symmetri evolv appli interfac tanh profil smooth transit high low densiti materi math rhoxi lefttanhleftfracytild yxrightright hydrostat pressur mathp bottom domain assum mathrho lower half domain mathrho upper half densiti perturb run matht piecewis linear old ppm new ppm cfl see numreffigrt _figrt figur rt_ppm_typepng alt rayleightaylor differ ppm type align center width rayleightaylor differ ppm type graviti test problem radiat test problem two photon radiat solver castroa gray solver multigroup solver gray solver follow algorithm outlin citehowellgreenough use notat describ paper particular radiat energi equat take form math fracparti e_rparti nabla cdot left fracc lambdae_rkappa_r nabla e_r right kappa_p sigma c e_r mathe_r radiat energi densiti mathkappa_r roselandmean opac mathkappa_p planckmean opaciy mathlambda quantiti mathl subject limit keep radiat field causal castro allow mathkappa_r mathkappa_p set independ powerlaw light front light front problem test abil radiat solver oper freestream limit radiat front estabilish initi one end comput domain finit radiat field zero radiat field everywher els speed propag radiat front keep check fluxlimit prevent exceed mathc diffus gaussian puls diffus gaussian puls problem test diffus term radiat energi equat radiat energi densiti initi time matht t_ gaussian distribut math e_r e_r_ exp left frac t_ r r_ right radiat diffus overal distribut remain gaussian timedepend solut math e_r e_r_ fract_t_ exp left frac t_ r r_ right radiat sourc problem radiat sourc problem test coupl radiat field ga energi radiat sourc term problem begin radiat field ga temperatur equilibrium ga cool radiat field heat ga hot radiat cool case ga energi radiat field evolv thermal equilibrium achiev implement problem follow citeswestymyra figur radiating_sourcepng alt radiatin sourc align center width castro solut radiat sourc test problem heat cool solut shown function time compar analyt solut gray photon solver use radiat sphere radiat sphere radspher multigroup radiat test problem hot sphere center origin spheric geometri spectrum sphere follow planck distribut ambient medium much lower temperatur frequencydepend opac make domain optic thin high frequeci optic thick low frequenc long time solut combin blackbodi radiat ambient medium plu radiat propag hot sphere analyt solut exist citegraziani give radiat energi function energi group specifi time distanc radiat sphere implement problem execradiation_testsradspher follow citeswestymyra routin comput analyt solut provid analyticf figur radiating_spherepng alt radiat sphere width castro solut radiat sphere problem show radiat energi densiti function energi group test run photon energi group regress test autom regress test suit castro amrexbas code written python exist amrexcod github organ get start note castro two sourc depend amrex httpsgithubcomamrexcodesamrex_ adapt mesh librari starkil microphys httpsgithubcomstarkillerastromicrophysics_ collect equat state reaction network microphys instruct describ get depend automat castro compil process manag amrex build system gener requir build castro c later compil eg gcc fortran xx compil python gnu make gcc main compil suit use develop run parallel mpi librari requir run gpu cuda later requir inform parallel build given section refchmpiplusx download code castro maintain repositori github obtain via standard git clone command first make sure git instal machinew recommend version x higher clonefork castro repositori amrexastro github organ use either http access git clone recurs httpsgithubcomamrexastrocastrogit ssh access ssh key enabl github git clone recurs gitgithubcomamrexastrocastrogit recurs option git clone use ensur castro depend download current requir amrex mesh refin framework maintain amrexcod organ github microphys repositori starkillerastro organ amrex add necessari code driver code simul microphys add equat state reaction network microphys need run castro forget recurs clone rectifi situat run follow toplevel castro directori git submodul updat init recurs note default main branch sourc develop castro primari depend amrex microphys done develop branch work want latest sourc git checkout develop castro team run nightli regress test develop branch bug usual found fix rel quickli gener less stabl stay main branch recommend set castro_hom environ variabl point path name put castro add follow bashrc export castro_homepathtocastro use analog form differ shell keep code date git pull recursesubmodul recommend frequenc monthli stabl main branch code issu new releas code begin month option develop prefer maintain amrex microphys standalon repositori rather git submodul clone github use git clone httpsgithubcomamrexcodesamrexgit git clone httpsgithubcomstarkillerastromicrophysicsgit via ssh git clone gitgithubcomamrexcodesamrexgit git clone gitgithubcomstarkillerastromicrophysicsgit set amrex_hom environ variabl point amrex directori microphysics_hom environ variabl point microphys directori castro look instead local extern subdirectori build code castro differ problem setup store subdirectori castroexec build castro execut problem subdirectori well build sedov problem directori check castro git repo type cd castroexechydro_testssedov put directori run sedov problem sedov edit gnumakefil set dim dimensionalityher pick comp gnu set compil gnuu good default choic use g gfortran also choos pgi intel exampl want tri compil gnu suit dont work pleas let us know debug fals disabl debug check result optim execut use_mpi fals turn parallel via mpi set true build mpithi requir mpi librari instal machin case build system need know mpi instal done edit makefil amrex tree default fallback look standard mpi wrapper eg mpic mpif build type make result execut look someth like castrodgnuex mean version code compil comp gnu inform variou build option given refchbuildsystem run code castro take input file overrid runtim paramet default code run castrodgnuex inputsdcyl_in_cartcoord run cylindr sedov problem cartesian mathxmathi coordin see possibl option clear name input file notic run code gener directori look like plt plt etc chk chk etc plotfil checkpoint file plotfil use visual checkpoint file use restart code visual result sever option visual data popular packag yt visit support amrex file format nativ _ standard tool use within amrexcommun amrvi demonstr amrvi avail github _secgettingstartedyt yt yt primari visual analysi tool use develop instal yt follow instruct get yt httpsytprojectorggetyt_ abl read plotfil use ytload plot describ yt cookbook httpsytprojectorgdoccookbookindexhtml_ sampl visual analysi plotfil gener section gener jupyt notebook found docssourceyt_exampleipynb castro repo includ yt_examplerst amrvi amrvi tool develop lbnl visual amrex data provid simpl gui allow quickli visual slice grid structur get amrvi git clone httpsgithubcomamrexcodesamrvi cd amrvi edit gnumakefil set dim set comp compil leav debug fals type make build result execut look like amrvisdex want build amrvi dim must first download build volpack git clone httpsccselblgovpubdownloadsvolpackgit cd volpack type make note amrvi requir osfmotif librari header dont need instal develop version motif packag manag linux distribut motif librari provid openmotif packag header file like xmh provid openmotifdevel packag instal use packag manag tool instal vari distribut distribut straightforward lesstif give function allow build amrvi execut amrvi may run properli may want creat alia amrvisd exampl alia amrvisdtmpamrvisamrvisdex tmpamrvisamrvisdex full path name amrvi execut configur amrvi copi amrvisdefault file home directori renam amrvisdefault wish edit file chang palett line point full pathfilenam palett file come amrvi visual return castroexechydro_testssedov directori number output file includ form pltxxxxx xxxxx number correspond timestep file output amrvisd filenam see singl plotfil amrvisd plt anim sequenc plotfil tri play around thisyou chang variabl look select region click dataset view order look actual number etc also export pictur sever differ format fileexport user found amrvi work properli x proprietari nvidia graphic driver fix provid faq refchfaqvisthi due default behavior dac mappu color recogn boxlib format distribut problem setup number standard problem setup come castro use start point toward write setup organ subdirectori broad type radiat hydro graviti etc standard categori includ problem gravity_test dustcollaps pressureless cloud collaps standard test problem graviti analyt solut describ radiu sphere function time found colgat white citecolgwhit problem also found flash user guid evrard_collaps collaps isotherm spheric ga cloud problem origin discuss citeevrard implement test come section citespringel hydrostatic_adjust model stellar atmospher planeparallel sphericalselfgravit dump energi via analyt heat sourc watch atmospher hydrostat state adjust respons counterpart maestro test_basest unit test hse_converg meant simpl test assess converg hydro graviti maintain hse converg measur either look max mathu plotfil hydrostatic_adjust problem explor chang hydrostat structur due heat use origin citemaestroii stargrav problem set singl spheric star hydrostat equilibrium use assess abil maintain hse uniform_cube_spher use comput gravit potenti perfect cube analyt solut test isol boundari condit demonstr citekatz hydro_test acoustic_puls acoust puls problem citemccorquodalecolella use measur converg pure hydrodynam problem use castro citecastrosdc acoustic_pulse_gener gener equat state version acoustic_puls use measur converg citecastrosdc double_bubbl initi bubbl stratifi atmospher isotherm isentrop allow bubbl differ mathgamma one anoth background atmospher use multigamma eo analog problem implement maestro kh kelvinhelmholtz shear instabl problem oddeven gridalign shock hit small densiti perturb demonstr oddeven decoupl problem discuss citequirk setup serv test castrohybrid_riemann option hydrodynam rt singlemodel rayleightaylor instabl problem sedov standard sedovtaylor blast wave problem setup use first castro paper citecastro_i sod onedimension shock tube setup includ classic sod problem setup use origin castro paper sod_stellar version sod shock tube gener stellar equat state setup includ input file use citezingalekatz toy_convect simpl novalik convect problem extern heat sourc problem show use model parser initi atmospher castro grid incorpor custom tag routin spong fluid atmospher write custom diagnost routin maestroex version problem setup also exist mhd_test alfven linear mhd wave test problem citecrockett citeminiati_martin briowu brio wu shock tube problem describ citebriowu standard test problem use mani mhd code paper eg citeathena daiwoodward shock tube problem describ citedai_ fastrarefact shock tube problem domin kinet energi describ citeminiati_martin magnetosonicwav fast slow magnetoson wave problem citecrockett orszagtang twodimension magnet vortex problem follow citeathena rt magnet rayleightaylor instabl problem speci simpl test problem ensur speci accur advect radiation_test radtshock set radiat shock compar semianalyt solut describ citelowrieedward radfront opticallythin stream radiat front problem demonstr origin castro citecastroii radshestakovbolstad linear multigroup diffus test problem first describ citeshestakov demonstr castro citecastroiii radsourcetest test implement sourc term gray radiat solver relax thermal equilibrium test describ citeswestymyra origin describ citeturnerston radspher multigroup radiat sphere test problem analyt solut describ citegraziani citeswestymyra shown castro citecastroiii radsuolson nonequlibrium marshak wave test describ citesuolson shown castro citecastroii radsuolsonmg multigroup version radsuolson describ citesuolson shown castro citecastroiii radthermalwav thermal wave test adapt citehowellgreenough shown castro citecastroii reacting_test bubble_converg react bubbl problem design measur converg reactiv hydro algorithm castro use citecastrosdc reacting_bubbl react bubbl stratifi white dwarf atmospher problem featur maestro reaction paper citemaestroiii reacting_converg simpl react hydrodynam problem measur converg use citecastrosdc scienc problem scienc directori scienc problem appear paper shortli mani activ use share reproduc deton set deton propag domain flame set deflagr propag domain setup use test citeeiden flame_wav model flame propag across neutron star model xray burst present citeeiden nova model convect base accret layer white dwarf model nova planet problem setup citeryu model shear turbul hot jupit atmospher subchandra model subchandra type ia supernova initi hot spot helium layer low mass carbonoxygen white dwarf wdmerger problem setup model white dwarf merger use citekatz xrb_mix compress version xray burst convect problem citezingal unit_test diffusion_test test thermal diffus without hydro use demonstr converg citecastrosdc citeeiden particles_test test passiv particl _sponge_sect spong castro use spong sourc term damp veloc region interest dynam prevent domin timestep constraint often buffer region domain interest boundari condit spong paramet set input file timescal damp set castrosponge_timescal factor radiusdensitypressur spong start begin appli describ spong valu mathf_mathrmspong comput describ spong factor mathf comput math f left frac alpha f_mathrmspongeright implicit updat math f alpha f_mathrmspong index sponge_implicit sponge_timescal explicit updat choic control sponge_implicit mathalpha construct sponge_timescal paramet matht_mathrmspong math alpha fracdelta tt_mathrmspong spong sourc ad momentum total energi equat gener spong paramet variabl runtim paramet mathf_mathrmlow sponge_lower_factor mathf_mathrmupp sponge_upper_factor three spong control differ runtim paramet radial spong radial spong oper beyond radiu defin term center posit problem take form math f_mathrmspong left beginarraycc f_mathrmlow r r_mathrmlow f_mathrmlow fracf_mathrmupp f_mathrmlow left co left fracpi r r_mathrmlowerdelta r right right r_mathrmlow le r r_mathrmupp f_mathrmupp r ge r_mathrmupp endarray right paramet control variou quantiti variabl runtim paramet mathr_mathrmlow sponge_lower_radiu mathr_mathrmupp sponge_upper_radiu mathdelta r r_mathrmupp r_mathrmlow densiti spong densiti spong turn base densiti threshold high densiti usual care dynam want spong densiti lower gradual turn spong take form math f_mathrmspong left beginarraycc f_mathrmlow rho rho_mathrmupp f_mathrmlow fracf_mathrmupp f_mathrmlow left co left fracpi rho rho_mathrmupperdelta rho right right rho_mathrmupp ge rho rho_mathrmlow f_mathrmupp rho rho_mathrmlow endarray right paramet control variou quantiti variabl runtim paramet mathrho_mathrmlow sponge_lower_dens mathrho_mathrmupp sponge_upper_dens mathdelta rho rho_mathrmupp rho_mathrmlow pressur spong pressur spong like densiti spong except key pressur take form math f_mathrmspong left beginarraycc f_mathrmlow p p_mathrmupp f_mathrmlow fracf_mathrmupp f_mathrmlow left co left fracpi p p_mathrmupperdelta p right right p_mathrmupp ge p ge p_mathrmlow f_mathrmupp rho rho_mathrmlow endarray right paramet control variou quantiti variabl runtim paramet mathp_mathrmlow sponge_lower_pressur mathp_mathrmupp sponge_upper_pressur mathdelta p p_mathrmupp p_mathrmlow _chamr adapt mesh refin approach adapt refin castro use nest hierarchi logicallyrectangular grid simultan refin grid space time integr algorithm grid hierarchi recurs procedur coars grid advanc time fine grid advanc multipl step reach time coars grid data differ level synchron regrid step increasingli finer grid recurs embed coars grid solut suffici resolv error estim procedur base userspecifi criteria describ section sectagging__ evalu addit refin need grid gener procedur dynam creat remov rectangular fine grid patch resolut requir chang good introduct style amr use lectur adapt mesh refin short cours httpsccselblgovpeoplejbbshortcourselecturepdf _sectag tag refin castro determin zone tag refin next regrid step use set builtin routin test quantiti densiti pressur determin whether quantiti gradient pass userspecifi threshold may extend amrn_error_buf math certain number zone beyond tag zone section describ process zone tag describ add custom tag criteria also provid mechan defin limit set refin scheme input file exampl amrrefinement_ind den temp amrrefinedensmax_level amrrefinedensvalue_great amrrefinedensfield_nam densiti amrrefinetempmax_level amrrefinetempvalue_less amrrefinetempfield_nam temp amrrefinement_ind list userdefin name refin scheme defin name amrrefinenam accept predefin field describ tag max_level maximum level refin start_tim start tag end_tim stop tag value_great valu refin value_less valu refin gradient absolut valu differ adjac cell refin relative_gradi rel valu differ adjac cell refin field_nam name string defin field code refin indic ad either value_great value_less gradient must provid note zone adjac physic boundari tag refin use poisson graviti solver tag criteria met zone ignor index problem_taggingh provid also abil user defin tag criteria done c function problem_tag file problem_taggingh function provid entir state includ densiti temperatur veloc etc array tag statu everi zone _secamr_synchron synchron algorithm present amr algorithm compress equat selfgrav graviti compon algorithm close relat ident miniati colella jcp content larg base content origin castro paper citecastro_i signific differ addit differ strategi employ synchron regardless whether origin new strategi use fundament synchron step ident _secsynchronization_methodolog synchron methodolog coars grid time step collect flux regist inform hyperbol part synchron math deltafb delta t_c ac fc sum delta t_f af ff analog end coars grid time step store mismatch normal gradient mathphi coarsefin interfac math delta f_phi ac fracparti phicparti n sum af fracparti phifparti n want composit mathphicf satisfi multilevel version eqeqself graviti synchron time want coars fine flux time match goal synchron mathphi across level time zero mismatch regist end coars grid time step defin mathoverlineubcf mathoverlinephicf composit data coars fine grid provision solut time mathn assum mathoverlineub averag data coars cell underli fine cell averag fine cell data synchron consist two part step hyperbol reflux hyperbol reflux step updat conserv variabl flux synchron adjust gravit term reflect chang mathrho mathub math ubc star overlineubc fracdeltafbv mathv volum cell correct mathdeltafb support coars cell adjac fine grid note enableddis via castrodo_reflux gener enabl also note axisymmetr spheric coordin reflux pressur gradient differ sinc express diverg geometri use separ flux regist hydro code store pressur term case step gravit synchron step correct mismatch normal deriv mathphicf coarsefin interfac well account chang sourc term mathrho ub mathrho e due chang mathrho coars grid defin math delta rhoc rhoc star overlinerhoc form composit residu compos two contribut first degre current mathoverlinephicf satisfi origin equat composit grid sinc solv mathoverlinephicf separ coars fine level second respons mathphi chang mathrho defin math r equiv pi g rhostarcf deltacf overlinephicf pi g delta rhoc nabla cdot delta f_phi _c solv math deltacf delta phicf r labeleqgravsync two level solv coars fine level defin updat graviti math delta bf gcf nabla delta phicf final need add mathdelta phicf directli mathphic mathphif interpol mathdelta phicf finer level add current mathphi level level mathc coarsest level calcul must transmit effect chang mathphi coarser level updat flux regist level mathc next coarser level mathcc particular set math delta f_phiccc delta f_phiccc sum ac fracparti delta phicfparti n graviti synchron algorithm disabl gravityno_sync done care gener okay reflux happen region low densiti dont affect graviti substanti _secsynchronization_sourc sourc term synchron appli state coars grid chang due chang flux coarsefin boundari well chang gravit field pose problem regard sourc term gener reli either state global variabl affect synchron gravit field newtim sourc construct coars grid depend state coarsegrid hydrodynam updat synchron associ flux correct step retroact chang hydrodynam updat one imagin perfect world would calcul hydrodynam updat first includ coarsefin mismatch correct comput sourc term new time inde algorithm subcycl march everi zone along timestep could code like flash actual newtim sourc term comput level hydrodynam updat fulli complet coarsefin mismatch correct castro gener assum abil subcycl architectur set alway calcul newtim sourc term given level immedi hydrodynam updat level henc coars level calcul newtim sourc term fine grid timestep occur one way fix suggest miniati colella case graviti explicitli comput differ sourc term result flux correct across coarsefin boundari work form updat case cellcent gravit forc contribut densiti advect across coarsefin interfac ie mathdelta rho mathbfg mathdelta rho densiti chang due coarsefin synchron coars rid well global chang gravit field due collect mass motion see miniati colella explicit form sourc term coupl sever limit first mean form sourc term chang form corrector term chang exampl less easi write form corrector term fluxbas gravit energi sourc term standard castro second graviti rel easi case due linear densiti gravit acceler sourc term repres complic physic might easili express represent term reflux contribut exampl gener nuclear reaction network analyt solut possibl write analyt express nuclear reaction occur mathdelta rho instead choos gener approach coars level save newtim sourc term appli end fine timestep also save fine level newtim sourc term amr synchron fine timestep first subtract previous appli newtim sourc term coars fine level flux correct associ gravit sync solv recomput newtim sourc term coars fine level _ way get almost ideal behavior arent subcycl get essenti state end fine timestep would code explicitli subcycl cost recomput newtim sourc term second time level common sourc term graviti seriou problem cost recomput mathrho mathbfg exampl alreadi know mathmathbfg neglig compar cost actual comput mathmathbfg say selfgrav believ error recomput sourc term suffici low comput cost comput high disabl behavior _ use code paramet castroupdate_sources_after_reflux note present nuclear reaction enabl part scheme present automat updat amr synchron amend futur releas castro _secsynchronization_tim synchron time goal synchron step coars fine grid match end coars timestep subcycl fine grid timestep complet two level reach simul time subcycl disabl coars fine grid take timestep suffici howev gener subcycl case situat complic consid discuss sourc term secsynchronization_sources__ coars level one fine level refin ratio two normal subcycl fine grid take two timestep everi one timestep taken coars level strategi advoc origin castro paper miniati colella amr synchron actual synchron time coars fine level end second fine timestep consequ actual updat sourc term second fine timestep thu note fine grid newtim sourc term second fine timestep updat moment thought reveal limit first fine grid timestep also respons modifi flux coars grid algorithm present didnt take full account inform gravit field old time second fine timestep actual miss inform would present updat coars grid alreadi way use inform assumpt make castro answer actual ye appli effect synchron synchron time end everi fine timestep everi fine timestep alway uptod inform possibl state gravit field cours fine timestep last one actual reach synchron time alreadi know end first fine timestep synchron correct fine timestep equal coars contribut flux regist normal contribut flux regist timestep true castro assum flux provid hydrodynam solver piecewiseconst timestep need secondord accur time flux time center _ fair say halfway coars timestep half coars flux advect mathemat split flux regist two contribut equal weight coars flux gener cours coars flux contribut fine timestep weight mathr mathr refin ratio coars fine level noth prevent us updat coars solut synchron time mathtn_c first fine timestep alreadi know point coars solut chang use inform updat gravit potenti mathtn_c use construct boundari condit gravit potenti solv fine grid begin second fine timestep practic mean call synchron routin describ secsynchronization_methodology__ modif flux regist contribut coars grid appropri weight fine grid timestep instead coars grid timestep includ current fine step math deltafb delta t_f ac fc delta t_f af ff form mathphi flux regist remain unchang intent graviti sync solv simpli instantan correct mismatch fine coars grid differ old strategi new method call synchron end everi fine timestep instead last subcycl one chang weight appropri new method expens current implement mathr gravit sync solv reflux sourc term recalcul instead one howev result maxim possibl accuraci especi case signific amount materi cross refin boundari reflux strategi control paramet castroreflux_strategi present old method still default note one need use selfgrav benefici even pure hydrodynam matter regrid occur fine level new zone boundari current fine level fill interpol coars level old method interpol use uptod data account synchron multipl level refin scheme extend natur old method alway call synchron synchron time two level exampl two jump refin factor two synchron end first two timestep level level level synchron next two timestep level level level synchron level level new method alway call synchron end everi timestep finest level simultan synchron everi level timestep mathdelta t_f flux regist timestep finest level unclear give saniti check sum flux regist total ad level contribut factor mathdelta equal coars grid timestep sinc sum timestep finest level entir advanc must equal level timestep final contribut flux regist save flux mismatch end level timestep synchron longer need call end coarser level timestep alreadi date result synchron appli end fine level timestep absenc global field like gravit potenti would need done coars level alway assum solut fine grid correct averag coars grid castro default fine level anticip fact graviti common compon mani product scienc simul could gener arent use global forc field dont bother updat fine level import scienc want pleas let castro develop know look gener may desir sourceterm specif set sourc term cheap physic import recomput synchron set updat other disabl import scienc applic pleas let develop know would straightforward extens current architectur scheme gener higherord method principl one would need integr flux mathdelta constantintim flux case input file castro execut use input file runtim set alter behavior algorithm initi condit runtim paramet take form namespaceparamet valu namespac identifi major code compon paramet take multipl valu separ space typic name input set amrex paramet grid refin etc geometri amr namespac enabl differ physic behavior castro namespac set problemspecif runtim paramet problem namespac set microphys runtim paramet variou namespac defin microphys like eo integr network warn input file handl c portion code quantiti specifi scientif notat must take form e dthe specifi recogn note addit note castro quantiti cg unit common input option problem geometri geometri namespac use amrex defin comput domain main paramet geometryprob_lo physic locat low corner domain type real must set note number need dimens problem geometryprob_hi physic locat high corner domain type real must set note number need dimens problem geometrycoord_si coordin system cartesian mathrmathz spheric must set geometryis_period domain period direct fals true default note integ need dimens problem castrocent physic locat problem center domain type real default problem center use graviti rotat quantiti necessarili geometr center domainoften choos coincid center mass system see refsoftprob_param detail note number need dimens problem exampl follow geometryprob_lo geometryprob_hi e e e geometrycoord_si geometryis_period castrocent e e e defin domain run math lower left math time time upper right physic space specifi cartesian geometri make domain period mathydirect problem center set halfway lower left upper right corner domain boundari condit boundari condit specifi use integ key interpret amrex runtim paramet use castrolo_bc boundari type low face must set castrohi_bc boundari type high face must set valid boundari type tabl boundari condit type align center interior period symmetri inflow slip wall outflow slip wall note castrolo_bc castrohi_bc must consist geometryis_periodicif domain period particular direct low high bc must set direct exampl follow castrolo_bc castrohi_bc geometryis_period defin problem inflow low mathx direct outflow high mathx direct slip wall low high mathyfac period mathzdirect see refsoftphys_bc resolut grid resolut specifi defin resolut coarsest level level number refin level factor refin level relev paramet amrn_cel number cell direct coarsest level integ math must set amrmax_level number level refin coarsest level integ mathgeq must set amrref_ratio ratio coars fine grid space subsequ level must set amrregrid_int often term number step regrid integ must set amrregrid_on_restart regrid immedi restart default note amrmax_level need set amrref_ratio amrregrid_int exampl amrn_cel would defin domain cell mathxdirect cell mathydirect cell mathzdirect coarsest level line appear input file final number ignor amrmax_level would allow maximum refin level addit coars level note addit level creat tag criteria cell flag need refin number refin level calcul must mathleq amrmax_level chang time need alway equal amrmax_level amrref_ratio would set factor refin level factor refin level note must least amrmax_level valu amrref_ratio addit valu may appear line ignor amrregrid_int tell code regrid everi step thu exampl new level grid creat everi level time step new level grid creat everi level time step amrregrid_int math level regrid start level disabl amrregrid_int never regrid level note compat amrregrid_on_restart paramet larg number solverspecif runtim paramet describ togeth discuss physic solver later chapter runtim paramet introduct runtim paramet castro runtim paramet set input file manag amrex parmpars class castrospecif paramet list runtim paramet file _cpp_paramet gener c code header compil time behavior network eo microphys routin control differ set runtim paramet paramet defin plaintext file _paramet locat differ directori hold microphys code compil time make function locat _paramet file need given choic network integr eo creat extern_parametersh extern_parameterscpp file manag paramet set runtim via input file castrospecif paramet castro paramet control behavior code physic modul list _cpp_paramet take form comment describ paramet name type default need fortran ifdef name name paramet look input file name actual take form b name use input file paramet set b name use within castro c class recommend name new paramet functionalitythi implement backward compat type one int real string default default valu paramet next column option need fill inform includ option column need eg go provid fortran name also need provid need fortran ifdef need fortran runtim paramet made avail fortran meth_params_modul note option deprec ifdef provid name preprocessor name wrap paramet definitionit compil name defin preprocessor final comment start immedi paramet definit use gener document describ paramet microphysicsextern paramet format microphysicsextern paramet definit take form comment describ paramet name datatyp defaultvalu prioriti prioriti simpli integ two directori defin paramet differ default version paramet highest prioriti take preced allow specif implement overrid gener paramet default paramet namespac toctre runtime_paramet introduct castro castro adapt mesh radiationmhd hydrodynam code design model astrophys react flow massiv parallel comput castro major capabl dimension unsplit ndorder finitevolum hydrodynam th order hydro uniform grid see refchhydro dimens constrain transport ideal mhd singl level current see refchmhd multigroup fluxlimit diffus radiat hydrodynam see refchradi gener retri mechan recov physic violat timestep see refchretri adapt mesh refin subcycl jump x x level see refchamr arbitrari equat state provid companion starkil microphys project gener nuclear reaction network explicit thermal diffus see refchdiffus full poisson graviti isol boundari condit conserv energi formul see refchgrav rotat corot frame axisymmetr see refchrot spectral defer correct time integr coupl hydro reaction see refchsdc parallel via mpi openmp mpi cuda develop model castro develop github httpsgithubcomamrexastrocastro main branch stabl use daytoday scienc new chang made via pull request develop branch ongo regress test done cpu gpu start month merg develop main appli tag form yymm eg feb also creat github releas mint zenodo doi use inform zenodojson file root level castro core develop made substanti code contribut detail main readmemd develop coauthor zenodo doi paper describ castro gener scienc paper coauthor decid scienc paper lead unit convent castro work cg unit unless otherwis specifi numreftableunit show common symbol name use throughout code document paper _tableunit tabl common quantiti unit name unit descript matht time mathrho mathgcc mass densiti mathub mathcm veloc vector mathp mathpresunit pressur mathgb mathaccelunit gravit acceler mathsb vari sourc term math mathergg specif total energi math mathergg specif intern energi matht mathk temperatur mathkth mathmathrmergcm thermal conduct sk mathx_k mass fraction speci mathk mathomegadot_k mathmathrm speci creation rate reaction physic constant use cg system avail microphysicsconst selfconsist field initi introduct hachisu selfconsist field scf method way gener equilibrium rotat nonrot initi configur gener singl multipl star system scf method origin develop variant propos hachisu citehachisuahachisub end becom popular techniqu scf method origin develop rapidli rotat singl star soon extend appli rotat binari system appli construct initi condit sever group studi binari white dwarf neutron star system use sever type rotat law citenewtohlineswcmotldsouzamotlevenkadamyoshida also use construct toroid configur citekim techniqu assum uniform temperatur composit gener barotrop equat state selfgravit repres poisson equat welldefin rotat law often rigidbodi rotat user requir specifi three quantiti maximum densiti equilibrium star two point stellar surfac singl star usual point equat point pole detach binari system correspond inner outer point teardropshap configur along axi join binari present support gener singl star use hachisu scf method plan extend later releas rotat toroid configur binari star system note hachisu scf method iter solv integr form euler equat essenti solv bernoulli equat classic fluid dynam approach use literatur usual directli solv coupl poisson bernoulli equat rather reli indirect iter coupl see exampl citeeriguchifujisawa citeclementaksenov altern method gener power promis faster converg also difficult implement see also citejackson yet anoth approach usag code paramet use scf initi techniqu must compil use_gravtru use_rotationtru enabl method castrodo_scf_initial_model respons initi grid initi guess mass distribut guess need accur exampl initi uniform spheric mass distribut suffici see execscf_testssingle_star howev import grid isotherm uniform composit temperatur composit retain final equilibrium configur sever code paramet avail control problem initi scf castroscf_maximum_dens target maximum densiti domain castroscf_equatorial_radiu target equatori radiu star castroscf_polar_radiu target polar radiu star castroscf_relax_tol toler requir scf converg first three option requir must set one limit method knowledg known way specifi natur paramet total mass star singl star algorithm bernoulli equat tell us math phi phi h mathrmconst mathphi gravit potenti mathphi rotat potenti mathphi omega r rigidbodi rotat mathr radiu equatori plane mathh enthalpi denot prescrib maximum densiti mathrho_ equatori polar radii mathr_a mathr_b respect b indic chosen consist hachisu radii enthalpi vanish math c phi_a phi_a math c phi_b phi_b note mathc c_a c_b constant everywher bodi given valu bernoulli constant invert bernoulli equat obtain enthalpi math h c phi phi given enthalpi call equat state given enthalpi composit temperatur input obtain densiti note invers gener requir newtonraphson iter realist equat state math rho rhot h x one housekeep item well notat rotat potenti math phi omega psi mathpsi r rigid bodi rotat ingredi need construct algorithm obtain equilibrium rotat singl star given initi densiti distribut mathrhon gravit field mathphin rotat field mathphin first calcul updat guess rotat frequenc mathomega math omegan sqrtfracphi_bn phi_anpsi_an psi_bn simpli involv find mathphi mathpsi vanish point updat rotat frequenc reconstruct rotat potenti mathphi updat enthalpi everywher domain math hn c phi phi_r howev want guarante maximum densiti domain fix given maximum densiti correspond maximum enthalpi math h_ hrho_ x rescal updat enthalpi maximum fix math hn rightarrow hn left frach_hn_mathrmmax right invert eo obtain mathrhon given new densiti distribut updat gravit potenti mathphin solv poisson equat procedur iter zone chang densiti factor castroscf_relax_tol prefac welcom castro user guid user guid describ download run castro massiv parallel code solv multicompon compress hydrodynam equat astrophys flow includ selfgrav nuclear reaction radiat castro use eulerian grid incorpor adapt mesh refin amr approach amr use nest hierarchi logicallyrectangular grid simultan refin space time util amrex librari citeamrexjoss core algorithm castro describ seri paper castro new compress astrophys solver hydrodynam selfgrav almgren v e beckner j b bell day l h howel c c joggerst j lijewski nonaka singer zingal apj httpdxdoiorgx castro new compress astrophys solver ii gray radiat hydrodynam w zhang l howel almgren burrow j bell apj httpdxdoiorg castro new compress astrophys solver iii multigroup radiat hydrodynam w zhang l howel almgren burrow j dolenc j bell apj httpdxdoiorg improv graviti solver rotat describ doubl white dwarf merger adapt mesh methodolog code verif p katz zingal c calder f swesti almgren w zhang apj httpdxdoiorgx th order reactiv hydrodynam spectral defer correct solver describ improv coupl hydrodynam nuclear reaction via spectral defer correct zingal p katz j b bell l minion j nonaka w zhang apj httpsuiadsabsharvardedulink_gatewayapjzdoiab castro gpu strategi perform describ prepar nuclear astrophys exascal p katz almgren barrio sazo k eiden k gott harpol j sexton e willcox w zhang zingal appear proceed sc httpsuiadsabsharvardeduabsarxivkabstract develop amrex librari led center comput scienc engin lawrenc berkeley nation laboratori castro develop done collabor includ ccse stoni brook univers castro core develop made substanti contribut code process becom core develop describ readmemd httpsgithubcomamrexastrocastroblobmainreadmemd_ castro root directori current castro core develop list httpsamrexastrogithubiocastrowhohtml castro develop take place project github page httpsgithubcomamrexastrocastro extern contribut welcom fork castro repo modifi local copi issu pullrequest amrexastrocastro project guidelin given readmemd httpsgithubcomamrexastrocastroblobmainreadmemd_ file get help use github discuss ask question code get help httpsgithubcomamrexastrocastrodiscuss also post issu github page report bug acknowledg cite castro use castro research would appreci cite relev code paper describ design featur test list found citat httpsgithubcomamrexastrocastroblobmaincitation_ file root castro directori develop castro support scienc applic interest contributor lot effort behind scene test optim develop new featur bug fix often done radar nevertheless happi volunt time help new user come speed castro signific new develop debug applic provid member castro develop commun would appreci consider invit develop coauthorship scienc paper result frequent ask question compil compil fail give cryptic messag modul found usual indic build system find sourc file sourc file specifi variou makepackag file throughout castro directori hierarchi make look directori vpath_loc find file thing check what happen first inspect directori vpath_loc done via make printvpath_loc next ask make tell find sourc file done script find_files_vpathpi hook castro build system run make file_loc end report list file find vpath expect like externf buildinfocppthes written compiletim miss file need investig im still troubl compil find make variabl set use make help tell valu compil option check make sure function signatur defin c consist implement fortran use make typecheck compil code report mismatch function signatur _debugging_backtrac debug castro crash float point exceptionhow get inform best thing recompil code testtru set gnumakefil amrex catch signal rais c fortran function behind scene defin amrex_test preprocessor flag initi memori alloc fab multifab signal nan snan use blbacktracehandl function handl variou signal rais c fortran function linuxunix capabl give us chanc print backtrac inform signal includ seg fault float point except nan divid zero overflow interrupt user system signal hand amrex control amrexeg use interrupt user use find mpi deadlock also includ amrex_assert statement use_assertiontru debugtru amrex paramet affect behavior amrexfpe_trap_invalid amrexfpe_trap_zero amrexfpe_trap_overflow capabl get inform backtrac call stack info instrument code exampl know line real rho statecel caus segfault could add print statement might print thousand even million line hit segfault instead could code c stdostringstream ss ss statebox statebox cell cell bl_backtrace_pushssstr push take stdstring real rho statecel state fab cell intvect print print stack string stdout hit segfault see last print backtrac file eg backtrac may need includ header amrex_blbacktraceh monitor state zone c side variou point evolut given multifab mf dump state print_statemf intvectd_decl intvect dimens compil handl preprocessor d_decl case inspect zone global index space note sinc multifab exist singl level integ indic refer global index space level want see data farraybox simpli output fab stdcout imagin mfiter loop multifab mf farraybox mfmfi stdcout stdendl output content fab one zone per line profil get linebylin profil inform gnu complier enabl profil gprof compil use_gproftru gnumakefil run file name gmonout produc process gprof run gprof execnam execnam name execut detail linebylin inform obtain pass l argument gprof manag run forc run code output even plot checkpoint interv paramet dont requir creat file call dump_and_continu eg touch dump_and_continu forc code output checkpoint file use restart option plot_and_continu output plotfil dump_and_stop output checkpoint file halt code stop_run simpli stop code note paramet amrmessage_int control often exist file check default check done end everi timestep multipl set input file youd like check everi timestep output plotfil singl precis amrex runtim paramet fabformat native_ control put input file note checkpoint file unaffect alway written nativ precis fabformat paramet overridden checkpoint code amrex check compil paramet castro execut build inform includ git hash modul eo network etc display run execut castroex describ _chfaqvi runtim error run retri castro request mani substep crash occur due cfl violat neg densiti densiti reset tri run castrolimit_fluxes_on_small_den use flux limit prevent densiti go neg visual tri use amrvi nvidia driver see blackno data fix need edit xorgconf file usual found etcx enabl dacbit option section look like section devic identifi devic driver nvidia vendornam nvidia corpor option dacbit true endsect dont alreadi xorgconf creat one run nvidiaxconfig first castro document main file creat sphinxquickstart mon dec adapt file complet like least contain root toctre direct castro adapt mesh compress hydrodynam code httpsgithubcomamrexastrocastro toctre maxdepth caption castro basic prefac introduct getting_start input rp_intro mpi_plus_x flowchart softwar problem_setup timestep creating_a_problem io regrid visual faq toctre maxdepth caption castro refer build_system debug hydrodynam mhd graviti diffus rotat spong radiat particl eosnetwork sdc amr convertcheckpoint self_consistent_field maestro_restart verif develop toctre maxdepth caption api filelist classlist namespacelist toctre caption refer zrefer indic tabl refgenindex refmodindex refsearch _chio output restart capabl index amrcheck_fil amrcheck_int amrcheck_p amrrestart index amrcheckpoint_files_output amrcheck_nfil amrcheckpoint_on_restart index castrogrown_factor castro standard sort checkpoint restart capabl input file follow option control gener checkpoint file realli directori amrcheck_fil prefix restart file text default chk amrcheck_int often level time step write restart file integ math default amrcheck_p often simul time write restart file real math default note amrcheck_p write checkpoint first timestep whose end time past integ multipl interv particular timestep modifi match interv wont get checkpoint exactli time request amrrestart name file directori restart text use set amrcheckpoint_files_output write checkpoint file default scale studi set amrcheckpoint_files_output test scale algorithm without io amrcheck_nfil parallel write checkpoint file integ mathgeq default see section refsecparallel_io detail parallel io amrcheck_nfil paramet amrcheckpoint_on_restart write checkpoint immedi restart default castrogrown_factor factor domain grown integ mathgeq default note specifi amrcheck_int amrcheck_p desir code print warn case unintent work would expect get checkpoint integ multipl amrcheck_int timestep integ multipl amrcheck_p simul time interv amrplotfile_on_restart amrcheckpoint_on_restart requir amrregrid_on_restart effect exampl amrcheck_fil chk_run amrcheck_int mean restart file realli directori start prefix chk_run gener everi level time step directori name chk_run chk_run chk_run etc instead specifi amrcheck_fil chk_run amrcheck_p restart file realli directori start prefix chk_run gener everi unit simul time directori name chk_run chk_run chk_run etc matht level step matht level step etc restart chk_run exampl set amrrestart chk_run _secplotfil plotfil output index amrplot_files_output amrplotfile_on_restart amrwrite_plotfile_with_checkpoint castro two level plotfil regular plotfil small plotfil idea behind distinct output small number variabl frequent small plotfil output larg number variabl less frequent help keep data size allow finegrain tempor analysi import quantiti gener control determin whether want output plotfil amrplot_files_output set output plotfil amrplotfile_on_restart set dump plotfil immedi restart amrwrite_plotfile_with_checkpoint alway output plotfil dump checkpoint file index amrplot_fil amrplot_p amrplot_int frequenc output name regular plotfil control amrplot_fil base name plotfil eg plt amrplot_p amount simul time plotfil output note amrplot_p write plotfil first timestep whose end time past integ multipl interv particular timestep modifi match interv wont get checkpoint exactli time request amrplot_int number timestep plotfil set reli simulationtimebas output index amrsmall_plot_fil amrsmall_plot_p amrsmall_plot_int similarli frequenc output name small plotfil control amrsmall_plot_fil base name small plotfil eg smallplt amrsmall_plot_p amount simul time small plotfil output amrsmall_plot_int number timestep small plotfil set reli simulationtimebas output addit output option control io done amrplot_nfil parallel write plotfil integ mathgeq default see softwar section detail parallel io amrplot_nfil paramet option amrderive_plot_var kept derive_lst castro_setupcpp feel free look see what note specifi amrplot_int amrplot_p desir code print warn case unintent work would expect get plotfil integ multipl amrplot_int timestep integ multipl amrplot_p simul time interv exampl amrplot_fil plt_run amrplot_int mean plot file realli directori start prefix plt_run gener everi level time step directori name plt_run plt_run plt_run etc instead specifi amrplot_fil plt_run amrplot_p restart file realli directori start prefix plt_run gener everi unit simul time directori name plt_run plt_run plt_run etc matht level step matht level step etc control what plotfil index amrplot_var amrderive_plot_var option set runtim control variabl appear regular plotfil amrplot_var control main state variabl appear plotfil default store specifi subset name eg amrplot_var densiti store subset amrderive_plot_var control deriv variabl store plotfil deriv variabl creat plotfil creat use infrastructur provid amrex regist variabl associ fortran routin deriv derive_ndf default deriv variabl store store deriv variabl castro know amrderive_plot_var subset explicitli list eg amrderive_plot_var entropi pressur output deriv variabl set none index amrsmall_plot_var small plotfil control list variabl amrsmall_plot_var list variabl includ small plotfil amrderive_small_plot_var list deriv variabl includ small plotfil plotfil variabl nativ variabl variabl come directli statedata either state_typ hydrodynam variabl reactions_typ nuclear energi gener quantiti phigrav_typ gravity_typ graviti quantiti rad_typ radiat quantiti variabl name descript unit densiti mass densiti mathrho mathgcc xmom xmomentum mathrho u mathrm gcm ymom ymomentum mathrho v mathrm gcm zmom zmomentum mathrho w mathrm gcm rho_e total energi densiti mathrm ergcm rho_e intern energi densiti mathrm ergcm temp temperatur mathrm k rho_x mass densiti speci x mathgcc x speci defin network omegadot_x creation rate speci x mathrm x speci mathomegadot_k dx_kdt defin network enuc nuclear energi gener rate gram mathrm ergg rho_enuc nuclear energi gener rate densiti mathrm ergcm phigrav gravit potenti mathrm ergg grav_x grav_i gravit acceler mathrm cm grav_z rmom radial momentum defin mathrm gcm hybrid_momentum lmom angular momentum maththeta defin mathrm gcm hybrid_momentum pmom zmomentum defin hybrid_momentum mathrm gcm shock shock flag zone shock defin shock rad rad rad radiat energi densiti multigroup radiat group variabl deriv variabl index castrodomain_is_plane_parallel variabl name descript deriv routin unit angular_momentum_x angular momentum volum x z dir derangmomx mathrm gcm angular_momentum_i comput mathrho ub time bf r_n derangmomi angular_momentum_z mathbf r distanc derangmomz center mathn either x z diff_coeff thermal diffus coeffici derdiffcoeff mathrm cm mathkthrho c_v diff_term mathnablacdotkthnabla derdiffterm mathrm ergcm divu mathnabla cdot ub derdivu mathrm eint_ specif intern energi comput dereint mathrm ergg conserv mathrho e state variabl math rho erho eint_ specif intern energi comput dereint mathrm ergg total energi momentum conserv state matherho efracrho ubrho entropi specif entropi math comput derentropi mathrm erggk math srho e x_k e comput mathrho e ertot total radiat energi densiti derertot multigroup radiat problem frcomx frcomi comov radiat flux radiationcpp frcomz frlabx frlabi labfram radiat flux radiationcpp frlabz gamma_ adiabat index dergamma mathdlog pdlog rho_ kineng kinet energi densiti derkineng mathrm ergcm mathk frac rho ub lambda radiat flux limit logden mathlog_ rho derlogten dimensionless assum mathrho cg machnumb fluid mach number mathubc_ dermachnumb maggrav gravit acceler magnitud dermaggrav mathrm cm magmom momentum densiti magnitud dermagmom mathrm gcm mathrho ub magvel veloc magnitud mathub dermagvel mathcm magvort vortic magnitud mathnablatimesub dermagvort mathrm pressur total pressur includ ion electron derpr mathrm dyncm radiat non radhydro problem radvel radial veloc measur respect derradialvel mathcm center vertic axi domain_is_plane_parallel set mathxu yv zwr circvel circumferenti veloc perpendicular derradialvel mathcm radvel domain_is_plane_parallel set xy plane soundspe sound speed dersoundspe mathcm stateerr thermal_cond thermal conduct mathkth dercond mathrm ergcmsk t_sound_t_enuc derenuctimescal uminusc xveloc math sound deruminusc mathcm speed uplusc xveloc sound speed deruplusc mathcm xq mass fraction speci q derspec mathx_k rho x_krho x_veloc fluid veloc dervel mathcm y_veloc mathub rho ubrho z_veloc problemspecif plotfil variabl variabl name descript unit analyt pi pioverp primarymask secondarymask terror texact inertial_angular_momentum_x inertial_angular_momentum_i inertial_angular_momentum_z inertial_momentum_x inertial_momentum_i inertial_momentum_z inertial_radial_momentum_x inertial_radial_momentum_i inertial_radial_momentum_z phieff phieffpm_p phieffpm_ tpert screen output sever option set much output written screen castro run amrv verbos amrcpp default castrov verbos castrocpp default gravityv verbos gravitycpp default diffusionv verbos diffusioncpp default mgv verbos multigrid solver graviti allow valu default amrgrid_log name file grid written text use set amrrun_log name file certain output written text use set amrrun_log_ters name file certain terser output written text use set castrodo_special_tag allow user set special flag base userspecifi criteria default castrodo_special_tag use exampl calcul bounc time core collaps simul bounc time defin first time maximum densiti domain exce userspecifi valu time print special file use diagnost exampl amrgrid_log grdlog amrrun_log runlog everi time code regrid print list grid relev level code write grid list file grdlog addit everi time step code print certain statement screen amrv step time dt plotfil file plt run_log option output statement runlog well terser output obtain via amrrun_log_ters runlogters file runlogters differ runlog contain line form number step taken simul time level time step file plot easili monitor time step integr diagnost index castrosum_interv integr diagnost castro calcul integr quantiti grid global quantiti output screen runtim file regular interv default capabl enabl one follow runtim paramet set castrosum_interv math often level time step comput print integr quantiti integ default integr quantiti includ total mass momentum energi domain everi castrosum_interv level step print statement form time mass e exampl castrosum_p often simul time output integr quantiti use altern castrosum_interv default output file creat amr_diagout includ timestep inform follow column timestep time dt finest level coars timestep walltim gravity_diagout problem poisson graviti includ gravit wave amplitud grid_diagout includ integr state data time mass x zmomentum x zangular momentum kinet energi intern energi kinet intern energi gravit potenti energi total energi includ gravit potenti energi species_diagout contain mass nuclear speci grid problem custom version diagnost addit inform _secparallel_io parallel io checkpoint file plotfil realli directori contain subdirectori one subdirectori level amr hierarchi fundament data structur readwrit disk multifab made multipl fab one fab per grid multipl multifab may written directori checkpoint file multifab cours share across cpu singl multifab may share across thousand cpu cpu write part multifab own disk dont write distinct file instead multifab written runtim configur number file mathn mathn set input file paramet amrcheckpoint_nfil amrplot_nfil default say multifab written disk across mathn file plu small amount data get written header file describ file laid mathn file happen mathn cpu open uniqu one mathn file multifab written seek end write data cpu wait barrier mathn write cpu finish repeat anoth mathn cpu data multifab written disk cpu pass data cpu write header file describ multifab laid disk also read multifab disk chunki manner open mathn file read time number mathn multifab written match number mathn multifab read disk number cpu run read multifab need match number cpu run multifab written disk think number mathn number independ io pathway underli parallel filesystem cours real parallel filesytem abl handl reason valu mathn valu forc mathn number cpu your run mean cpu write uniqu file creat larg number file lead inod issu checkpoint embiggen within castro distribut capabl grow checkpoint file calcul restart larger domain cover grid cell factor two four coarser exist coarsest level instruct castroutilconvertcheckpointreadm file includ upon restart exist data checkpoint file use fill region previou comput domain new region fill mean typic interpol model file star corner star_at_cent section consid case star featur interest center lower left corner domain eg model one quarter star octant star want grow domain high side direct eg upper right convert checkpoint file let say checkpoint file chk level refin real problem domain size mathp integ domain size mathd level input file creat might contain max_step amrmax_level amrn_cel geometryprob_lo geometryprob_hi p p amrref_ratio let suppos want grow domain factor cover new larger domain level factor coarser exist level grid first set dim gnumakefil type make utilconvertcheckpoint directori make execut embiggencpp code run embiggen code follow embiggendlinuxintelintelex checkinchk checkoutnewchk ref_ratio grown_factor star_at_cent execut may slightli differ name depend compil built creat new checkpoint directori call newchk repres simul one addit level refin coarser previou level grid factor ref_ratio case new domain factor grown_factor case larger previou domain note ref_ratio must accept valu castro grown_factor reason integ test need multipl restart grown checkpoint file abl restart calcul use newchk input file contain line like max_step amrrestart newchk amrmax_level amrn_cel geometryprob_lo geometryprob_hi p p castrogrown_factor castrostar_at_cent amrref_ratio import unlik earlier may set amrmax_level one greater need set high exampl could set amrmax_level would lose data finest refin level may set amrmax_level howev data new level averag new level restart must set amrn_cel grown_factor ref_ratio mathtim previou valu amrn_cel case amrn_cel must set amrprob_hi factor grown_factor greater previou valu amrprob_hi must insert valu ref_ratio use embiggen call first valu list amrref_ratio sinc refin ratio new level new level must set castrogrown_factor input file equal valu grown_factor use call embiggenex castro know big origin domain note run step origin level would equival step new level coarsen factor thu restart new checkpoint directori next step make sure keep track plotfil accordingli dont forget adjust max_denerr_lev compar variabl control number fine level want want level refin restart make sure max_denerr_lev etc set high enough want level refin new level would factor ref_ratio coarser previou level make sure adjust max_denerr_lev accordingli well star center domain star_at_cent let assum star featur interest center center domain cartesian coordin later consid case cylindr rz coordin star center left midpoint _convertingthecheckpointfil convert checkpoint file suppos want grow domain factor cover new larger domain level factor coarser exist level grid build embiggen execut type embiggendlinuxintelintelex checkinchk checkoutnewchk ref_ratio grown_factor star_at_cent note ref_ratio must still grown_factor case _restartingfromagrowncheckpointfil restart grown checkpoint file input file restart would look like max_step amrrestart newchk amrmax_level amrn_cel geometryprob_lo p p geometryprob_hi p p castrogrown_factor castrostar_at_cent amrref_ratio cylindr coordin case cylindr rz coordin star center left edg vertic midpoint domain embiggen procedur star_at_cent input file restart slightli differ geometryprob_lo modifi z rdirect consid origin input file look like max_step amrmax_level amrn_cel geometryprob_lo geometryprob_hi p p amrref_ratio input file restart would look like amrrestart newchk amrmax_level amrn_cel geometryprob_lo p geometryprob_hi p p castrogrown_factor castrostar_at_cent amrref_ratio result figur cornerpng data checkpoint file domain coarsen grown case use star_at_cent ref_ratio first grown exampl grown_factor second grown_factor figur level grid shown white level grid red level grid yellow grown figur level grid pink figur centerpng data checkpoint file domain coarsen grown case use star_at_cent ref_ratio first grown exampl grown_factor second grown_factor figur level grid shown white level grid red level grid yellow grown figur level grid pink microphys equat state standard castro eos castro written modular fashion eo network burn routin suppli user howev exampl present later use sever eo network routin come microphys distribut castro reli routin calcul equat state eo fluid well speci network defin compon fluid network option abil nuclear burn section main purpos defin speci eo calcul fluid properti depend composit electron fraction standard problem setup castro sedov blast wave use gamma_law eo repres gamma law ga equat state math p gamma rho e ga current assum monatom ideal runtim paramet invert eo eg use eos_input_r initi guess temperatur requir guess provid runtim paramet castrot_guess set sensibl valu problem vari depend eo use eo interfac paramet index eos_t eo two main routin interfac rest castro begin simul eos_init perform initi step save eo variabl mainli smallt temperatur floor smalld densiti floor whenev want call eo use eo eos_input eos_stat first argument specifi input eo option current avail store microphys interfaceseos_typeh alway combin two thermodynam quantiti exampl eos_input_rt mean call eo mathrho densiti matht temperatur expect eo return associ thermodynam quantiti intern energi math entropi math note real nonanalyt equat state mathrho matht speci independ variabl helmholtz eo eos_input_rt directli call eo obtain thermodynam variabl input eg eos_input_r newtonraphson iter perform find densiti temperatur correspond given input eos_stat variabl c struct eos_t store complet set thermodynam variabl call eo first fill variabl input exampl eos_t eos_stat eos_staterho stateijkurho eos_statet stateijkutemp eos_state stateijkueint stateijkurho int n n numspec n eos_statexnn stateijkufsn stateijkurho int n n numaux n eos_stateauxn stateijkufxn stateijkurho whenev eos_stat type initi thermodynam state variabl fill unphys number input correct argument match input quantiti eo call error mean good practic fill quantiti iter initi guess inde initi guess typic requir equat state iter variabl valu initi like converg usual prior valu temperatur densiti suffic avail use t_guess small_den microphys httpsgithubcomstarkillerastromicrophysics__ repositori collect microphys routin compat amrexastro code refer document repositori set inform equat state provid document also goe detail detail eo code case interest work case want develop eo requir thermodynam quantiti three input quantiti requir eo eos_input_r mathrho math mathx_k input eos_input_rt mathrho matht mathx_k input eos_input_rp mathrho mathp mathx_k input eos_t deriv type hold larg number thermodynam quantiti need basic castro oper main quantiti eo mode need suppli input eos_statet temperatur eos_statep total pressur eos_state specif energi eos_stategam first adiabat index mathgamma_ dlog p dlog rho _s addit eos_input_r mode also need suppli eos_statec adiabat sound speed eos_statedpdr_ deriv mathparti ppartial rho _e note specif intern energi math held constant eos_statedpd deriv mathparti p partial e _rho radiat hydro eos_input_rt model need suppli eos_statecv specif heat capac quantiti eg entropi might need deriv variabl option output plotfil composit deriv index eos_xderivs_t separ type eos_xderivs_t provid access deriv respect mass fraction eos_xderivsdhdxnumspec deriv specif enthalpi respect mass fraction constant matht mathp math xi_k e_x_k fracp_rho left fracprho e_rho right p_x_k eos_xderivsdpdxnumspec deriv pressur respect mass fraction math beginalign p_x_k left fracparti ppartial bara right _rho barz fracparti baraparti x_k left fracparti ppartial barz right _rho bara fracparti barzparti x_k nonumb fracbaraa_k left fracparti ppartial bara right _rho barz fracbaraa_k left z_k barz right left fracparti ppartial barz right _rho bara endalign eos_xderivsdedxnumspec deriv specif intern energi respect mass fraction math beginalign e_x_k left fracparti e partial bara right _rho barz fracparti baraparti x_k left fracparti eparti barz right _rho bara fracparti barzparti x_k nonumb fracbaraa_k left fracparti e partial bara right _rho barz fracbaraa_k left z_k barzright left fracparti eparti barz right _rho bara endalign see citemaestroiii appendix nuclear network index burn_t nuclear network serv two purpos defin fluid compon use equat state hydrodynam evolv compon nuclear burn step castro come general_nul network live network directori bare interfac nuclear reaction network reaction enabl auxiliari variabl accept contain sever set isotop exampl networksgeneral_nulltriple_alpha_plus_onet would describ isotop need repres tripl mathalpha reaction convert helium carbon well oxygen iron main interfac file networkf wrapper function actual network detail defin actual_networkf file automat gener work directori compil suppli number name speci auxiliari variabl well initi data mass number proton number bind energi burn frontend interfac networksburnerf accept differ deriv type call burn_t type like eos_t entri basic thermodynam quantiti use burn_type_modul type burn_t burn_stat burn_stat rho stateijkurho burn_stat stateijkutemp burn_stat e stateijkueint stateijkurho burn_stat xn stateijkufsufsnspec stateijkurho take input burn_t return output burn_t burn complet nuclear energi releas comput take differ burn_state_out e burn_state_in e speci chang comput analog normal oper castro integr occur time interv mathdelta mathdelta hydrodynam timestep interest use actual nuclear burn network download microphys httpsgithubcomstarkillerastromicrophysics__ repositori collect microphys routin compat amrex astro code refer document repositori set inform network provid document also goe detail detail network code case interest work case want develop network control burn number reactionsrel paramet set runtim input file reaction enabl set castrodo_react note turn reaction problem theyr requir help improv effici possibl set maximum minimum temperatur densiti allow reaction occur zone use paramet castroreact_t_min castroreact_t_max castroreact_rho_min castroreact_rho_max debug sever method typic use debug issu castro descript given use compil tool compil check recompil code debugmod set debug true gnumakefil invok make make debugtru creat execut bound check compil option enabl run sometim show issu check invalid float point except compil debug mode also initi uniniti variabl nan optim code done set test true gnumakefil captur nan use runtim paramet amrexfpe_trap_invalid code crash produc one backtrac file look file pinpoint fpe occur allow debug output inform backtrac file push backtrac stack describ refdebugging_backtrac make sure runtim option valid castro valid runtim option specifi input file run castroabort_on_invalid_param valgrind frequent run castro valgrind find illeg memori access valgrind document give detail use clangtidi index clangtidi run clangtidi httpsclangllvmorgextraclangtidy_ pull request use github action httpsgithubcomamrexastrocpplinteraction_ clangtidi analyz sourc code produc warn potenti bug offer suggest perform improv also run local requir clangtidi bear packag python script runclangtidypi download httpsgithubcomamrexastrocpplinteractionblobmainrunclangtidypy_ analysi perform first compil problem use bear packag run python script analyz sourc file within problem directori run codeblock bash bear make compllvm j use_ompfals use_mpifals debugtru python runclangtidypi headerfiltercastro ignorefilesamrexmicrophys j clangtidyreporttxt compil flag modifi suit problem analyz debug flag must set true headerfilt option python script tell script analyz header file contain given regex pattern ignorefil flag tell ignor sourc file contain given regex pattern j option tell script run given number process parallel output redirect text file thread sanit instrument code check nan c code check whether fab contain nan use contains_nan method codeblock c mfiter mfi true mfiisvalid mfi const box bx mftilebox oper smfi smficontains_nan amrexabort nan version contains_nan take box oper physic issu softwar design code structur castro built upon amrex c framework provid highlevel class manag adapt mesh refin simul includ core data structur deal key design pattern amrex overal memori manag parallel done c layer heavi comput work done fortran kernel amrex provid conveni data structur allow workflowhigh level object c commun fortran pointer data region appear multidimension array castro use structuredgrid approach hydrodynam work squarecub zone hold state variabl densiti momentum etc comput flux quantiti interfac zone finitevolum approach parallel achiev domain decomposit divid domain mani smaller box distribut across processor inform need boundari box messag exchang data held perimet ghost cell amrex manag decompost commun us addit amrex implement adapt mesh refin addit coars decomposit domain zone box refin rectangular region ad finergrid box top coarser grid call collect box resolut level castro use hybrid mpi openmp approach parallel mpi use commun across node comput openmp use within node loop subregion box differ thread code structur castro directori reflect divis c fortran diagnost variou analysi routin specif problem doc your read exec variou problem implement sort categori gravity_test test problem primarili exercis graviti solver hydro_test test problem hydrodynam without reaction radiation_test test problem primarili exercis radiat hydrodynam solver reacting_test test problem primarili exercis reaction hydro reaction coupl scf_test problem setup use selfconsist field initi scienc problem setup use scientif investig unit_test test problem exercis primarili singl modul extern use git submodul microphys amrex git submodul directori paper joss paper sourc sourc sourc code main directori code sourc mix c fortran organ topic diffus thermal diffus code driver main driver io runtim paramet support graviti selfgrav code hydro compress hydrodynam code mhd mhd solver code particl support particl problem templat code implement problem radiat implicit radiat solv code reaction nuclear reaction code rotat rotat code scf selfconsist field initi support sdc code specifi true sdc method sourc hydrodynam sourc term support util catchal addit thing may need convertcheckpoint tool convert checkpoint file larger domain major data structur follow data structur commonli encount work c portion castro amrex datastructur class amr main class drive whole simul highest level castro amrlevel castro class amrlevel virtual base class provid amrex store state data singl level amr hierarchi understand advanc data time import data manag amrlevel array statedata hold fluid quantiti etc box togeth make level castro class deriv amrlevel provid castrospecif routin evolv system equat like amrlevel one castro object level amr hierarchri lot member data castro class static member variablesthi mean share across instanc class case everi level data done particular valu runtim paramet also graviti diffus radiat object mean object cover level object instanti castro class float point data float point data c amrex framework declar real typedef either float doubl depend make variabl precis correspond type fortran provid amrex_fort_modul c_real typic renam rt use exampl declar paramet use amrex_fort_modul rt amrex_r realrt tol e_rt amrex_constants_modul provid common constant use code like zero third one etc note singl precis support castro yet complet particular lot support microphys updat box farraybox box simpli rectangular region space hold data amrex amr level global index space math lower left corner domain level mathn_x n_i n_z upper right corner domain domain mathn_x time n_i time n_z zone locat box level uniqu specifi respect global index space give index lowerleft upperright corner numreffigsoftindexspac show exampl three box level refin amrex provid data structur collect box togeth importantli boxarray gener use directli except boxarray grid defin part amrlevel class castro inherit grid use build new multifab give layout box current level _figsoftindexspac figur index_gridpng width three box compris singl level resolut domain mathtim zone note index amrex start math farraybox fab fortran array box data structur contain box locat space well pointer data buffer real float point data store onedimension array farraybox es associ box use reshap array multidimension array use fortran subroutin key part c amrex data structur data buffer sent fortran appear dim dimension array dim space compon note castro compli specif dimension multifab highest abstract level multifab mulitpl farraybox multifab contain array box es includ box own processor purpos commun array mpi rank specifi mpi processor own box array pointer farraybox own mpi processor note multifab collect box togeth make singl level data amr hierarchi multifab multipl compon like densiti temperatur well perimet ghost cell exchang data neighbor implement boundari condit reflect underli farraybox parallel amrex done distribut fab across processor processor know fab local loop box local processor mfiter use highlevel oper exist multifab add subtract multipli etc togeth scalar dont need write loop data directli castro multifab one main data structur interact c portion code _softsecstatedata statedata statedata class essenti hold pair multifab one old time one new time amrex know interpol time state get data intermedi point time main data care castro fluid state gravit potenti etc store statedata essenti data made statedata castro need store checkpoint plotfil andor want automat interpol refin amrlevel store array statedata c array call state index array use integ key defin via enum castroh state data regist amrex castro_setupcpp note differ statedata carri state array differ number compon ghost cell boundari condit etc main reason separ data separ statedata object collect togeth index array current statedata name castro carri state_typ num_stat hydrodynam compon make conserv hydrodynam state usual refer mathub note note includ radiat energi densiti access data use amrex array type form dataijkn n compon integ key use index compon defin sourcedriver_vari eg urho umx umi note regardless dimension alway carri around three veloc compon outofplan compon simpli advect allow rotat particular corioli forc affect state_typ multifab ghost cell default pure hydro singl ghost cell default radiat enabl option forc ghost cell set paramet castrostate_nghost runtim note predict hydrodynam state interfac requir ghost cell accomod creat separ multifab sborder live oldtim level necessari ghost cell describ later rad_typ store radiat energi densiti commonli denot mathe_r note ngroup componentsth number energi group use multigroup radiat hydrodynam approxim phigrav_typ simpli gravit potenti usual denot mathphi note gravity_typ gravit acceler alway compon regardless dimension consist choic alway carri veloc compon source_typ hold timer chang sourc term mathdsbdt num_stat state_typ variabl note make use oldtim quantiti fact never alloc farraybox oldtim source_typ statedata wast memori reactions_typ hold data nuclear reaction numspec compon speci creation rate usual denot mathomegadot_k note specif energi gener rate mathdote_mathrmnuc densiti mathrho dote_mathrmnuc store statedata access reaction term outsid advanc diagnost like flame speed estim reaction timestep limit particular need data store checkpoint continu timestep upon restart mag_type_x defin mhd store facecent xface xcompon magnet field mag_type_i defin mhd store facecent yface ycompon magnet field mag_type_z defin mhd store facecent zface zcompon magnet field simplified_sdc_react_typ use sdc timeadvanc algorithm store nqsrc term describ primit variabl chang timestep due reaction use predict interfac state primit variabl hydrodynam portion algorithm access multifab carri data interest interact statedata use one key instanc multifab s_new get_new_datastate_typ get pointer multifab contain hydrodynam state data new time mfiter interact fortran process loop box given level refin oper data link castro achiev threadlevel parallel openmp approach castro evolv consider sinc origin paper written modern approach call tile gear meet demand manycor processor nextgener supercomput full detail iter box call comput kernel given amrex document httpsamrexcodesgithubioamrexdocs_htmlbasicshtmlmfiterandtil practic detail work tile tile openmp c fortran modul except reaction initdata respons coder make sure routin within tile region safe use openmp particular note tile box nonoverlap union tile box complet cover valid region fab consid work nodecent multifab ugdnv cellcent multifab mfi tile base cellcent index space mathtim box tile tile box rang mathrightarrow mathrightarrow mfiugdnv tile base nodal indic tile box rang mathrightarrow mathrightarrow updat routin work tile need understand distinct indexspac entir box correspond memori layout indexspac tile c end pass sometim via bl_to_fortran macro lovect hivect entir box includ ghost cell use alloc array fortran doubl precis aa_la_h a_la_h tile use want loop a_l a_h instead need loop tile region indic tile region need pass fortran routin separ come mfitilebox mfigrowntilebox statement fortran initi array tile region entir box fortran array mean instead must alohilohilohi lo hi indexspac tile box return mfitilebox c pass fortran routin look r_old_ execgravity_testsdustcollapseprobdataf exampl declar threadpriv variablethi use sponge_ndf boundari fillpatch fillpatchiter amrex call act fill ghost cell fillpatch oper boundari grid two type first call finefin two grid level second type coarsefin need interpol coars grid fill fine grid ghost cell part fillpatch oper finefin fill straight copi valid region ghost cell coarsefin fill enabl statedata array theyr state data mean data know interpol anthropomorph sens type interpol use defin castro_setupcppsearch cell_cons_interp examplethat cell conserv interpol ie data cellbas oppos nodebas edgebas interpol averag fine valu creat equal coars valu came wouldnt case straight linear interpol exampl addit sinc statedata old new timelevel fill patch oper interpol intermedi time exampl illustr variou way fill ghost cell use data let consid follow scenario state data defin ghost cell want creat new multifab contain copi data ngrow ghost cell case sborder multifab hydrodynam state use kickoff hydrodynam advanc sborder declar castroh simpli code c multifab sborder alloc castroinitialize_do_adv code c sborderdefinegrid num_stat num_grow fab_alloc const real prev_tim statestate_typeprevtim expand_statesbord prev_tim num_grow note call defin tell amrex alreadi alloc data region farraybox part sborder actual fill ghost cell done castroexpand_st code c amrlevelfillpatchthi sborder num_grow prev_tim state_typ num_stat fill ng ghost cell multifab sborder time prev_tim use statedata part current castro object part note fillpatch take object refer first argument object contain relev statedata pointer indic final copi state_typ data compon num_stat _ result oper sborder num_grow ghost cell consist state_typ data old timelevel state data defin ngrow ghost cell want ensur ghost cell fill includ physic boundari valid data similar procedur shown main differ multifab target ghost cell fill pass refer statedata main thing need care need ensur time consist statedata time here exampl radiat portion code mgfldradsolvercpp code c real time castroget_state_datarad_typecurtim multifab s_new castroget_new_datastate_typ amrlevelfillpatchcastro s_new ngrow time state_typ s_newncomp exampl s_new pointer newtimelevel state_typ multifab oper use state_typ data fill ghost cell fill ngrow ghost cell newtimelevel state_typ data compon note exampl statedata live castro object work radiat object need make refer current castro object pointer done within castro object pointer simpli saw multifab deriv quantiti want fill ghost cell multifab fillboundari method fill ghost cell box level fill ghost cell coarsefin boundari physic boundari want loop fab state data fill ghost cell along way job fillpatchiteratorthi iter use loop grid fill ghostcel key thing keep mind fillpatchiter oper copi datath data disconnect origin sourc want updat data sourc need explicitli copi back also note fillpatchiter take multifab filledthi use get grid layout final way fillpatchiter implement commun done first iter box commenc exampl loop call ca_umdrv hydrodynam integr stuff start fillpatchiter fpithi s_new num_grow time state_typ strtcomp num_stat fpiisvalid fpi farraybox state fpi box bxfpivalidbox work state fab interior valid cell live bxlovect bxhivect fillpatchiter thing distribut grid processor make parallel work fill singl patch fpi num_grow ghost cell data type state_typ time time start compon strtcomp includ total num_stat compon gener one never assum ghostcel valid instead fill patch oper doubt sometim use fillpatchiter fill ghost cell multifab without explict look done fillpatchiter fpithiss_oldtimestate_typenum_st multifab state_old fpiget_mf oper state_old point intern multifab fillpatchiter get refer fpiget_mf avoid local copi note exampl see statedata fill physic boundari regist fill boundari defin advanc oper amrex get around use castro _softphys_bc physic boundari index boundari condit physic boundari condit specifi integ index _ input file use castrolo_bc castrohi_bc runtim paramet gener support boundari condit correspond integ key action take normal veloc transvers veloc gener scalar shown numreftablecastrobc definit specif action int_dir data taken grid interpol ext_dir data specifi edg face bndri hoextrap higher order extrapol edg bndri foextrap first order extrapol last cell interior reflect_even mathfn fn true reflect interior cell reflect_odd mathfn fn true reflect interior cell actual registr boundari condit action particular variabl done castro_setupcpp top defin array scalar_bc norm_vel_bc etc say kind bc use kind physic boundari boundari condit set function like set_scalar_bc use scalar_bc predefin array also specifi name fortran routin respons fill data eg hypfil routin discuss want specifi valu function like inflow boundari choos inflow boundari face domain need write implement code central hydrostat boundari condit implement wayse refcreatebc _tablecastrobc tabl physic boundari condit support castro name integ normal transvers scalar veloc veloc interior int_dir int_dir int_dir inflow ext_dir ext_dir ext_dir outflow foextrap foextrap foextrap symmetri reflect_odd reflect_even reflect_even slipwal reflect_odd reflect_even reflect_even noslipwal reflect_odd reflect_even reflect_even fluxregist fluxregist hold facecent data boundari box compos set multifab one face fluxregist store flux coarsefin interfac isus fluxcorrect step amrex concept larg number class help defin structur grid metadata associ variabl etc good way get sens look h file amrexsrc directori geometri class geometri object geom level part castro object inheret amrlevel parmpars class error estim graviti class singl graviti object graviti static class member castro object mean level refer graviti object within graviti object pointer amr object parent amrlevel parray leveldata graviti object get geometri inform level parent amr class main job graviti object provid potenti gravit acceler use hydrodynam sourc depend approxim use graviti could mean call amrex multigrid solver solv poisson equat fortran helper modul number modul make data avail fortran side castroor perform use task amrex_constants_modul provid doubl precis constant fortran paramet like zero half one fundamental_constants_modul provid cg valu mani physic constant meth_params_modul modul provid integ key use access state array conserv variabl urho umx mathldot primit variabl qrho qu mathldot well number scalar variabl also provid valu castroxxxx runtim paramet clariti continu document variabl name chang compar actual code integ valu defin bc_typesh _chdiffus diffus thermal diffus castro incorpor explicit thermal diffus energi equat term specif intern energi math appear math rho fracdedt p nabla cdot ub nabla cdot kth nabla mathkth thermal conduct unit mathmathrmergcmsk see similar thermal diffus equat consid special case constant conduct mathkth densiti assum ideal ga math c_v mathc_v specif heat constant volum final ignor hydrodynam mathub give math fracparti tpartial nabla mathd equiv kthrho c_v solv equat explicitli requir timestep limit math delta t_mathrmdiff le frac fracdelta xd implement ca_estdt_temp_diffus castrosourcedrivertimestepf support diffus must compil code set use_diffus true gnumakefil treat explicitli construct contribut evolut sourc term timecent achiev secondord accuraci time follow paramet affect diffus castrodiffuse_temp enabl thermal diffus default pure diffus problem hydrodynam run set castrodiffuse_temp castrodo_hydro complet setup thermal conduct must specifi interfac conduct subroutin actual_conductivityeos_st type eos_t intentinout eos_stat densiti temperatur mass fraction come eos_stat type eo call done castro call thermal_conduct assum entir state consist conduct fill eos_stat conduct index conductivity_dir two conduct routin provid castro default constant simpl constant thermal conduct select set conductivity_dir constant gnumakefil set valu conduct eg math add input file conductivityconst_conduct constant_opac simpl constant opac convert opac math kth frac sigma_b kappa_mathrmconst rho mathkappa_mathrmconst opac unit mathmathrmcmg select set conductivity_dir constant_opac gnumakefil set valu opac eg electron scatter set conductivityconst_opac input file index castrodiffusion_cutoff_dens castrodiffusion_cutoff_density_hi diffus approxim break surfac star densiti rapidli drop mean free path becom larg instanc use flux limit diffus modul castro evolv radiat field howev interest diffus interior use paramet castrodiffuse_cutoff_dens castrodiffuse_cutoff_density_hi specifi densiti diffus model implement code linearli scale conduct zero limit eg math kth kth cdot fracrho mathttcastrodiffuse_cutoff_densitymathttcastrodiffuse_cutoff_density_hi mathttcastrodiffuse_cutoff_dens simpl test problem set gaussian temperatur profil pure diffus provid diffusion_test _chradiat radiat introduct castro three radiat solver singlegroupsolv solver radiat pressr pure hydro plu radiat diffus applic medium optic thick pressur small sgfldsolver gray fluxlimit diffus radiat hydrodymam solver radiat pressur separ ga pressur pressur particip riemann solver mgfldsolver multigroup fluxlimit diffus radiat hydrodynam solver gray solver radiat pressur contribut pressur riemann solver number energi group use repres radiat field opac frequencydepend gray solver comov frame mode mix frame mode wherea mg solver use comov frame approach detail formul algorithm found seri castro paper get start get code castro radiat solver part main castro git repo alreadi castro code problem setup exercis radiat requir copi hypr librari hypr provid algebra multigrid solver use implicit radiat updat get copi httpsgithubcomhyprespacehypr minimum support releas version instal instruct describ recommend use autotool gnu make build hpc cluster typic want build compil your use build castro also want make sure option your use castro compat hypr option particular come use_mpi use_omp use_cuda exampl build hypr summit mpi cuda load gcc spectrummpi modul follow hypr src directori replac pathtohypreinstal target locat want hypr file instal hypre_cuda_sm cxxmpicxx ccmpicc fcmpifort configur prefixpathtohypreinstal withmpi withcuda enableunifiedmemori make instal build castro would build use_mpitru use_cudatru castro look hypr environ variabl hypre_dir point instal directori chose differ build radiat must set use_radtru microphys eo network opac eo castro provid sever type equat state eo includ gammalaw helmholtz use gammalaw eo set eos_dir gamma_law gnumakefil origin helmholtz eo stellar interior includ radiat contribut howev radiat hydrodynam calcul radit contribut taken eo radiat treat place use helmholtz eo use version microphys pure hydrodynam code interpret radiat preprocessor variabl disabl radiat portion eo eo put microphys also artifici eo use sever test case call eos_dir rad_power_law eo use pure radiationdiffus test ie castrodo_hydro defin specif heat power law math c_v mathrmconst rhom tn network radiat solver use network saw pure hydro noth need chang model reaction general_nul network use defin appropri composit problem opac commonli use opac setup math kappa_nu mathrmconst rhom tn nup label eqkappa mathkappa either planck rosseland absorpt coeffici mathrho densiti matht temperatur mathnu frequenc mathm mathn mathp constant gray solver mathp eqeqkappa suffici set opacity_dir rad_power_law gnumakefil see secopacpars__ instruct configur paramet use opac setup would prefer differ opac mechan need creat opac modul creat new directori microphysicsopac directori creat set subroutin other note mathkappa unit mathmathrmcm paper text may instead implicit densiti factor mathkappa yield unit mathmathrmcmmathrmg castro allow two temperatur differ radiat ga temperatur mathe_mathrmr ne t_mathrmga correspondingli castro care planck mean mathkappa_p rosseland mean mathkappa_r opacitiesthes differ weight set mathkappa_p delta x gg mathkappa_p realli larg two temperatur becom set mathkappa_p kappa_r see differ two temperatur optic thick medium would expect two temperatur differ _secopacpar opac paramet paramet describ opac includ planck opac form eqeqkappa follow paramet set coeffici expon set via opac namespac input file opacityconst_kappa_p must set posit use opacityconst_kappa_p opacitykappa_p_exp_m opacitykappa_p_exp_n opacitykappa_p_exp_p rosseland opac form eqeqkappa follow paramet set coeffici expon set via opac namespac input file opacityconst_kappa_r must set posit use opacityconst_kappa_r opacitykappa_r_exp_m opacitykappa_r_exp_n opacitykappa_r_exp_p scatter coeffici form eqeqkappa follow paramet set coeffici expon set via opac namespac input file opacityconst_scatt opacityscatter_exp_m opacityscatter_exp_n opacityscatter_exp_p sinc formula eqeqkappa nonphys singular must set floor practic prevent numer issu one floor opac appli planck rosseland opac also temperatur floor opacitykappa_floor opacityrad_temp_floor radiationdo_kappa_stm_emiss correct stimul emiss appli planck mean follow math kappa mathrmconst rhom tn nup left expleft frachnuk right right note unit opac mathmathrmcm gray solver total opac diffus coeffici sum kappa_r scatter wherea mg solver two possibl const_kappa_r greater total opac set kappa_r alon otherwis total opac sum kappa_p scatter radiat solver physic section list radiat relat paramet set input file import paramet radiationsolvertyp set gray solver mg solver castrodo_hydro usual want set set hydro turn calcul solv radiat diffus equat castrodo_radi calcul pure hydro paramet paramet default valu righthand side equal sign _secbothpar verbos io radiationv verbos radiationverbos verbos radiationplot_lambda save flux limit plotfil radiationplot_kappa_p save planck mean opac plotfil radiationplot_kappa_r save rosseland mean opac plotfil radiationplot_lab_ save lab frame radiat energi densiti plotfil flag ignor mixedfram gray solver use radiationplot_com_flux save comov frame radiat flux plotfil radiationplot_lab_flux save lab frame radiat flux plotfil _secfluxlimit flux limit closur radiationlimit possibl valu flux limit approxim limit levermor pomran bruenn limit larsen squar root limit minerbo limit radiationclosur possibl valu mathf lambda mathf scalar eddington factor mathlambda flux limit mathf frac mathf lambda mathf lambda lambda r mathr radiat knudsen number mathf frac frac fracfc mathf radiat flux math radiat energi densiti mathc speed light note behavior radi flux optic thin optic thick limit flux limit mathlambda lambdar math r fracnabla e_rchi_r e_r regardless limit chosen optic thick mathchi_r rightarrow infti mathr rightarrow mathlambda rightarrow radi flux becom math f_r fracclambdachi_r nabla e_r rightarrow frac fraccchi_r nabla e_r optic thin mathchi_r rightarrow mathr rightarrow infti mathlambda rightarrow r chi_r e_rnabla e_r radi flux becom math f_r fracclambdachi_r nabla e_r rightarrow fraccchi_rfracchi_r e_rnabla e_r nabla e_r c e_r see krumholz et al discuss boundari condit follow paramet radiat boundari diffus equat affect hydrodynam boundari radiationlo_bc set action take lower edg domain coordin direct possibl valu dirichlet specifi radiat energi densiti boundari gray radiat could mathe_r multigroup radiat castro store energi densiti mathmathrmergmathrmcm total radiat energi found simpli sum group want set radiat bc use planck function simpli multipli group widthse execradiation_testsradspheretoolsradbcf exampl neumann specifi radiat flux boundari gray radiat express given gray castro paper eq math f_r fracclambdakappa_r nabla e_r mathlambda flux limit note boundari repres incom flux vacuum like stellar irradi mathkappa rightarrow leav math f_r c e_r see secfluxlimiter__ case marshak vacuum specifi incid flux outsid vacuum differ neumann condit also flux come insid net flux across boundari differ incid flux sanchezpomran modifi form marshak boundari condit work fld like marshak condit mathlambda assum insid boundari optic thick radiationhi_bc see radiationlo_bc radiationlo_bcflag bcval use dimens otherwis subroutin rbndri radbndry_df call set boundari condit radiationhi_bcflag see radiationlo_bcflag radiationlo_bcv actual valu impos boundari condit type set radiationlo_bc paramet interpret differ depend boundari condit dirchlet dirichlet valu rad energi densiti neumann inward flux rad energi marshak incid flux sanchezpomran incid flux radiationhi_bcv see radiationlo_bcv converg gray solver one iter scheme wherea mg solver two iter inner iter embed insid outer iter follow iter gray solver also refer outer iter conveni paramet inner iter irrelev gray solver radiationmaxit maxim number outer iter step radiationminit minim number outer iter step radiationreltol e rel toler outer iter radiationabstol absolut toler outer iter radiationmaxinit maxim number inner iter step radiationmininit minim number inner iter step radiationrelintol e rel toler inner iter radiationabsintol absolut toler inner iter radiationconvergence_check_typ mg solver specifiy way check converg outer iter possibl valu check matht mathy_ residu equat mathrho e mathrho y_e check mathrho e check residu equat mathrho e mathrho y_e check matht mathy_ _secgraypar paramet gray solver radiationcomov use comov frame approach radiationer_lorentz_term mixedfram approach taken paramet decid whether lorentz transform term retain radiationdelta_temp use comput numer derivativa respect matht small number compar matht small radiationupdate_limit stop updat flux limit update_limit iter step radiationupdate_planck stop updat planck mean opac update_planck iter step radiationupdate_rosseland stop updat rosseland mean opac update_rosseland iter step group mg solver provid two method set group base upon logarithm space method must provid radiationngroup number group radiationlowestgrouphz frequenc lower bound first group addit paramet groupgrowfactor provid first method use otherwis second method use first way must also provid firstgroupwidthhz width first group width group set groupgrowfactor time width immedi preced group second way must provid highestgrouphz upper bound last group note lowestgrouphz first method second method howev comput groupintegr planck function lower bound first group upper bound last group assum mathinfti respect _secmgpar paramet mg solver radiationdelta_e_rat_dt_tol maxim allow rel chang math one time step radiationdelta_t_rat_dt_tol maxim allow rel chang matht one time step radiationdelta_ye_dt_tol maxim allow absolut chang mathy_ one tim estep radiationfspace_advection_typ possibl valu latter better radiationintegrate_planck integr planck function group first group lower bound integr assum matter group last group upper bound integr assum mathinfti radiationmatter_update_typ updat matter proabali best radiationacceler inner iter mg solver usual requir acceler scheme choic acceler local acceler gray acceler radiationskipaccelallow set skip acceler help radiationn_bisect bisect outer iter n_bisec iter step radiationuse_dkdt mathfracparti kappaparti retain jacobi matrix outer newton iter radiationupdate_opac stop updat opac update_opac outer iter step radiationinner_update_limit stop updat flux limit inner_update_limit inner iter step limit lag one outer iter limit lag one time step inner iter difficulti converg set paramet help sinc flux limit kludg justifi lag _sechypr linear system solver number choic linear system solver perform solver usual depend problem comput worth tri solver find one best problem comput radsolvelevel_solver_flag linear solver hypr use avail choic smg pfmg mathg amg use parcsr objecttyp gmre use parcsr objecttyp gmre use sstruct objecttyp gmre use amg precondition gmre use struct smgpfmg precondition amg use parcsr objecttyp pcg use parcsr objecttyp pcg use sstruct objecttyp gener rule smg stabl solver usual slowest asymmetri linear system come adapt mesh pfmg first choic note use pfmg set gmre use struct smgpfmg precondition work reason well problem radsolvemaxit default maxim number iter hypr radsolvereltol default e rel toler hypr radsolveabstol default absolut toler hypr radsolvev default verbos radsolveverbo default verbos habecverbos default verbos level_solver_flag math hmabecverbos default verbos level_solver_flag math output gray solver gray radiat solver radiat energi densiti store plotfil rad note quantiti unit mathmathrmergcm differ specifi intern energi ga mathmathrmergg _chhydro hydrodynam introduct hydrodynam scheme castro implement unsplit secondord godunov method characterist trace use timecent input state riemann solver hydrodynam routin use pure hydro radiat hydrodynam gener note regardless dimension alway carri around compon velocitymomentumthi allow rotat sourc easili radiat enabl via radiat discuss ga radiat quantiti separ gener appli temperatur pressur intern energi variou adiabat indic sound speed refer total valu one mean ga radiat contribut includ refer ga quantiti equat state would return continu continu use ga qualifi even solv radiat hydrodynam equat case still mean come equat state note equat state like helmeo includ radiat pressur contribut run without radiat hydrodynam enabl case still refer ga hydrodynam data structur within fortran routin implement hydrodynam sever main data structur hold state conserv state array gener begin u eg uin uout nvar compon state data array access use integ key defin numreftableconsint _tableconsint tabl integ variabl index conserv state array variabl quantiti note urho mathrho umx mathrho u umi mathrho v umz mathrho w ueden mathrho e ueint mathrho e comput quantiti use mathrho e rho e rho ub utemp matht comput quantiti use eo ufa mathrho a_ first advect quantiti uf mathrho x_ first speci ufx mathrho y_ first auxiliari variabl ushk shock flag use shock detect umr radial momentum hybrid_momentum defin uml angular momentum hybrid_momentum defin ump vertic momentum hybrid_momentum defin primit variabl state array gener simpli call q nq compon relat quantiti nqsrc number primit variabl sourc term nqsrc nq note radiat defin gashydro term present nqsrc numreftableprimlist give name primit variabl integ key access array note unless otherwis specifi quantiti without subscript ga tot subscript ga radiat _tableprimlist tabl primit state vector integ key variabl quantiti note qrho mathrho qu mathu qv mathv qw mathw qpre mathp qreint mathrho e qtemp matht qfa matha_ first advect quantiti qf mathx_ first speci qfx mathy_ first auxiliari variabl qptot mathp_mathrmtot total pressur ga radiat qreitot mathe_mathrmtot total specif intern energi ga radiat qrad mathe_r radiat energi ngroup auxiliari primit variabl array gener call qaux main differ regular primit variabl attempt reconstruct profil nqaux quantiti index integ key list numreftableqauxlist note unless otherwis specifi quantiti without subscript ga tot subscript ga radiat _tableqauxlist tabl integ variabl key access auxiliari primit state vector quax variabl quantiti note qgamc mathgamma_ first adiabat expon return eo qc mathc_ sound speed return eo qgamcg mathgamma_ includ radiat _mathrmtot compon defin radiat defin qcg mathc_ total sound speed _mathrmtot includ radiat defin radiat defin qlam mathlambda_f ngroup flux limit defin radiat defin interfac variabl timecent interfac state return riemann solver use discret nonconserv term equat array gener call q q q x z interfac respect ngdnv compon access integ key defin numreftablegdlist note unless otherwis specifi quantiti without subscript ga tot subscript ga radiat _tablegdlist tabl integ variabl key access godunov interfac state vector variabl quantiti note qgdrho mathrho qdu mathu qdv mathv qdw mathw qdpre mathp regardless whether radiat defin alway ga pressur qdlam mathlambda_f start index flux limiterther ngroup compon defin radiat defin qderad mathe_r start index radiat energyther ngroup compon defin radiat defin conserv form begin fulli compress equat conserv state vector mathub rho rho ub rho e rho a_k rho x_k rho y_k math beginalign fracparti rhoparti nabla cdot rho ub s_rm extrho fracparti rho ubparti nabla cdot rho ub ub nabla p rho gb sb_rm extrhoub fracparti rho eparti nabla cdot rho ub e p ub rho ub cdot gb sum_k rho q_k dotomega_k nablacdotkthnabla s_rm extrho e fracparti rho a_kparti nabla cdot rho ub a_k s_rm extrho a_k fracparti rho x_kpartial nabla cdot rho ub x_k rho dotomega_k s_rm extrho x_k fracparti rho y_kpartial nabla cdot rho ub y_k s_rm extrho y_klabeleqcompressibleequ endalign mathrho ub p mathkth densiti veloc temperatur pressur thermal conduct respect math e ub cdot ub total energi math repres intern energi addit mathx_k abund mathkrm th isotop associ product rate mathdotomega_k energi releas mathq_k mathgb gravit vector maths_rm extrho sb_rm extrhoub etc userspecifi sourc term matha_k advect quantiti ie tracer also carri around auxiliari variabl mathy_k userdefin evolut equat default treat advect quantiti meant defin network code also carri around matht mathrho e conserv state vector even though deriv conserv quantiti order element within mathub defin integ variabl arrayse numreftableconsint note regardless dimension problem alway carri compon veloc allow eg rotat advect compon veloc plane axisymmetr coordin alway initi veloc compon zero alway construct kinet energi three veloc compon nadv advect quantiti rang ufa ufanadv advect quantiti effect rest solut use tracer quantiti nspec speci defin network directori rang uf ufsnspec naux auxiliari variabl ufxufxnaux auxiliari variabl pass equat state routin along speci exampl auxiliari variabl electron fraction mathy_ core collaps simul number name auxiliari variabl defin network sourc term comput explicit sourc term variabl mathqb mathub primit variabl sourc term use construct timecent flux conserv variabl sourc use advanc solut neglect reaction sourc term sinc account step sourc term math sb_qbn leftbeginarrayc s_rho sb_ub s_p s_rho e s_a_k s_x_k s_y_k endarrayrightn leftbeginarrayc s_rm extrho gb fracrhosb_rm extrhoub fracrhofracparti ppartial es_rm extrho e fracparti ppartialrhos_rm extrho nablacdotkthnabla s_rm extrho e fracrhos_rm extrho a_k fracrhos_rm extrho x_k fracrhos_rm extrho y_k endarrayrightn math sb_ubn leftbeginarrayc sb_rhoub s_rho e s_rho a_k s_rho x_k s_rho y_k endarrayrightn leftbeginarrayc rho gb sb_rm extrhoub rho ub cdot gb nablacdotkthnabla s_rm extrho e s_rm extrho a_k s_rm extrho x_k s_rm extrho y_k endarrayrightn primit form castro use primit form fluid equat defin term state mathqb rho ub p rho e a_k x_k y_k construct interfac state input riemann problem primit variabl equat densiti veloc pressur math beginalign fracpartialrhoparti ubcdotnablarho rhonablacdotub s_rm extrho fracpartialubparti ubcdotnablaub fracrhonabla p gb fracrho sb_rm extrhoub ub s_rm extrho fracparti ppartial ubcdotnabla p rho cnablacdotub leftfracparti ppartial rhoright_exs_rm extrhononumb fracrhosum_kleftfracparti ppartial x_kright_rhoex_jjneq kleftrhodotomega_k s_rm extrho x_k x_ks_rm extrhorightnonumb fracrholeftfracparti ppartial eright_rhoxleftes_rm extrho sum_krho q_kdotomega_k nablacdotkthnabla rightnonumb quadqquadqquadqquad s_rm extrho e ubcdotleftsb_rm extrhoub fracubs_rm extrhorightbiggr endalign advect quantiti appear math beginalign fracparti a_kparti ubcdotnabla a_k fracrho s_rm extrho a_k a_k s_rm extrho fracparti x_kpartial ubcdotnabla x_k dotomega_k fracrho s_rm extrho x_k x_k s_rm extrho fracparti y_kpartial ubcdotnabla y_k fracrho s_rm extrho y_k y_k s_rm extrho endalign primit variabl deriv conserv state vector describ section seccomput primit variables__ access primit variabl state vector integ variabl key differ quantiti list numreftableprimlist intern energi temperatur augment system intern energi equat math beginalign fracpartialrho eparti ubcdotnablarho e rho epnablacdotub sum_k rho q_kdotomega_k nablacdotkthnabla s_rm extrho e nonumb ubcdotleftsb_rm extrhoubfracs_rm extrhoubright endalign two benefit first gener equat state carri around addit thermodynam quantiti allow us avoid equat state call particular riemann solver see eg citecolglaz second sometim case intern energi calcul math e_t equiv e frac mathbfv unreli two usual caus one high mach number flow kinet energi domin total ga energi make subtract numer unreli two use graviti sourc term indirectli alter valu intern energi obtain total energi provid reason intern energi defin thermodynam state implement dual energi formal enzo citebryan citebryan switch mathrho e mathrho e_t depend local state fluid defin paramet matheta_ matheta_ matheta_ correspond code paramet castrodual_energy_eta castrodual_energy_eta castrodual_energy_eta consid ratio mathe_t e ratio intern energi deriv total energi total energi paramet use follow matheta_ mathe_t eta_ e use mathe_t purpos calcul pressur hydrodynam updat otherwis use math intern energi equat eo call get pressur matheta_ end hydro advanc examin whether mathe_t eta_ e reset math equal mathe_t discard result intern energi equat otherwis keep math matheta_ similar matheta_ mathe_t eta_ e use mathe_t purpos nuclear reaction otherwis use math note version intern energi equat requir artifici viscos use hydrodynam code updat mathrho e use inform riemann solv calcul flux contain inform intrins shockcaptur part scheme code also carri around matht primit state vector primit variabl system full primit variabl form without advect auxiliari quantiti math fracpartialqbparti sum_d ab_dfracpartialqbparti x_d sb_qb exampl math leftbeginarrayc rho u v p rho e x_k endarrayright_t leftbeginarraycccccc u rho u fracrho u rho c u rho e p u u endarrayright leftbeginarrayc rho u v p rho e x_k endarrayright_x leftbeginarraycccccc v rho v v fracrho rho c v rho e p v v endarrayright leftbeginarrayc rho u v p rho e x_k endarrayright_i sb_qb eigenvalu math bf lambdaab_x ucuuuuuc qquad bf lambdaab_i vcvvvvvc right column eigenvector math rbab_x leftbeginarraycccccc fraccrho fraccrho c c h h endarrayright qquad rbab_i leftbeginarraycccccc fraccrho fraccrho c c h h endarrayright left row eigenvector normal mathrb_dcdotlb_d ib math lb_x leftbeginarraycccccc fracrhoc fracc fracc frachc fracrhoc fracc endarrayright qquad lb_i leftbeginarraycccccc fracrhoc fracc fracc frachc fracrhoc fracc endarrayright _secadvect step hydrodynam updat four major step hydrodynam updat convert primit variabl construct edg state solv riemann problem conserv updat index castrodo_hydro castroadd_ext_src castrodo_spong castronormalize_speci castrospherical_star castroshow_center_of_mass step varieti runtim paramet affect behavior addit gener runtim paramet hydrodynam castrodo_hydro timeadv fluid dynam equat must set castroadd_ext_src includ addit userspecifi sourc term default castrodo_spong call spong routin solut updat default see refsponge_sect detail spong castronormalize_speci enforc mathsum_i x_i default castrospherical_star use set boundari condit assum star spheric symmetr outer region default use castro averag valu given radiu cell insid domain defin radial function function use set valu outsid domain implement boundari condit castroshow_center_of_mass default index castrosmall_den castrosmall_temp castrosmall_pr sever floor impos thermodynam quantiti prevet unphys behavior castrosmall_den real default e castrosmall_temp real default e castrosmall_pr real default e _seccomput primit variabl comput primit variabl comput primtiv variabl conserv variabl mathrho rho e directli copi conserv state vector mathub a_k x_k y_k copi conserv state vector divid mathrho mathpt use eo first use eo ensur math smaller matherhot_rm smallx_k use eo comput mathpt ptrhoex_k also comput flatten coeffici mathchiin use edg state predict limit slope near strong shock use flatten procedur describ origin ppm paper citeppm flash paper citeflash flatten coeffici indic addit limit take place flatten coeffici mean effect drop order firstord godunov scheme convent opposit use flash paper cell comput flatten coeffici spatial direct choos minimum valu direct exampl comput flatten xdirect step defin mathzeta math zeta_i fracp_ip_imaxleftp_rm smallp_ip_iright defin mathtildechi math tildechi_i minleftmaxazeta_i bright matha mathb tunabl paramet essenti set mathtildechi_iazeta_ib constrain mathtildechi_i lie rang math either mathu_iu_i math fracp_ip_iminp_ip_i le c mathc tunabl paramet set mathtildechi_i defin mathchi math chi_i begincas maxtildechi_itildechi_i p_ip_i maxtildechi_itildechi_i textotherwis endcas follow runtim paramet affect behavior castrouse_flatten turn onoff flatten parabola near shock default edg state predict wish comput left right state primit variabl edg use input riemann problem sever reconstruct techniqu piecewis linear method follow descript citecolella classic ppm limit citeppm new ppm limit introduc citecolellasekora choic limit determin castroppm_typ new ppm limit modifi method citecolellasekora elimin sensit due roundoff error modif via person commun colella also use characterist trace corner coupl describ miller colella citemillercolella give full detail new ppm algorithm appear literatur summar develop miller colella ppm algorithm use comput timecent edg state extrapol basetim data space time edg state dualvalu ie face left state right state estim spatial extrapol onedimension ie transvers deriv ignor also use flatten procedur limit edg state valu miller colella algorithm describ later incorpor transvers term also describ modif requir equat addit characterist besid fluid veloc four step comput dualvalu edg state use math denot arbitrari scalar mathqb write equat simplic step comput maths_i maths_i spatial interpol math hi lo side face special limit respect begin interpol math edg use thorder interpol space math s_imyhalf fraclefts_is_iright fraclefts_is_iright maths_imyhalfs_is_is_imyhalf limit maths_imyhalf nonlinear combin approxim second deriv step follow defin math beginalign ds_imyhalf lefts_is_imyhalfs_iright ds_imyhalfl s_is_is_i ds_imyhalfr s_is_is_i endalign defin math textsignleftds_imyhalfright math ds_imyhalftextlim smaxleftminleftcsleftds_imyhalflrightcsleftds_imyhalfrrightsleftds_imyhalfrightrightright mathc use colella sekora limit valu maths_imyhalf math s_imyhalf fraclefts_is_iright fracds_imyhalftextlim implement updat implement colella sekora algorithm elimin sensit roundoff first need detect whether particular cell correspond extremum two test first test defin math alpha_ipm s_ipmmyhalf s_i mathalpha_ialpha_i ge extremum appli second test either mathalpha_ipm alpha_imp defin math beginalign ds_irm face s_i s_i ds_irm face s_i s_i endalign math ds_irm facemin minleftleftds_irm facerightleftds_irm facerightright math beginalign ds_irm cc s_i s_i ds_irm cc s_i s_i endalign math ds_irm ccmin minleftleftds_irm ccrightleftds_irm ccrightright mathds_irm facemin ge ds_irm ccmin set mathds_ipm ds_irm facepm otherwis set mathds_ipm ds_irm ccpm final extreumum mathds_ids_i le thu conclud extremum test remain limit depend whether extremum extremum modifi mathalpha_ipm first defin math beginalign ds_i alpha_ialpha_i ds_il s_is_is_i ds_ir s_is_is_i ds_ic s_is_is_i endalign defin math textsignleftds_iright math ds_itextlim maxleftminleftsds_icsleftds_ilrightcsleftds_irrightcsleftds_icrightrightright math alpha_ipm fracalpha_ipmds_itextlimmaxleftds_itim right extremum mathalpha_ipm alpha_imp defin math textsignalpha_imp math deltamathcali_textext fracalpha_ipmleftalpha_jalpha_jright math delta s_imp s_i mathsdeltamathcali_textext ge sdelta perform follow test mathsdelta alpha_imp ge time math alpha_ipm delta sleftdelta delta alpha_imprightmyhalf otherwis math alpha_ipm alpha_imp final maths_ipm s_i alpha_ipm step construct quadrat profil use maths_is_i maths_i math s_iix s_i xilefts_i s_i s_ixiright label quadrat interp math s_ s_i lefts_is_iright math xi fracx ihh le xi le step integr quadrat profil essenti comput averag valu swept quadrat profil across face assum profil move speed mathlambda_k defin follow integr mathsigma_k lambda_kdelta th math beginalign mathcalik_s_i fracsigma_k hint_imyhalfhsigma_k himyhalfhs_iixdx mathcalik_s_i fracsigma_k hint_imyhalfhimyhalfhsigma_k hs_iixdx endalign plug eqquadrat interp give math beginalign mathcalik_s_i s_i fracsigma_klefts_is_ileftfracsigma_krights_iright mathcalik_s_i s_i fracsigma_klefts_is_ileftfracsigma_krights_iright endalign step obtain edg state perform extrapol get left right edg state note includ explicit sourc term contribut math beginalign s_limyhalf s_i chi_isum_klambda_k ge lb_kcdotlefts_imathcalik_s_irightrb_k fracdts_in s_rimyhalf s_i chi_isum_klambda_k lb_kcdotlefts_imathcalik_s_irightrb_k fracdts_in endalign mathrb_k mathkrm th right column eigenvector mathrbab_d mathlb_k mathkrm th left row eigenvector lf mathlbab_d flatten coeffici mathchi_i order add transvers term spatial oper unsplit framework detail follow exactli given section miller colella except detail riemann solver given index castroppm_typ reconstruct interfac state follow appli castroppm_typ use piecewis linear vs ppm algorithm default valu standard piecewis parabol reconstruct castroppm_temp_fix variou attempt use temperatur reconstruct interfac state see refsecppm_temp_fix explan allow option interfac state correct inform transvers direct make secondord updat transvers direct involv separ riemann solv sometim updat interfac state transvers direct make state illpos sever paramet help fix castrotransverse_use_eo call equat state interfac use mathrho math mathx_k get interfac pressur result thermodynam consist interfac state castrotransverse_reset_dens transvers correct result neg densiti interfac reset interfac state valu transvers correct castrotransverse_reset_rho transvers updat oper conserv state usual construct interfac mathrho e transvers updat total energi kinet energi howev interfac mathrho e neg transverse_reset_rho explicitli discret equat evolut mathrho e includ transvers updat riemann problem castro three main option riemann solverth colella glaz solver citecolglaz solver use flash simpler solver describ unpublish manuscript colella glaz ferguson hllc solver first two twoshock approxim solver differ approxim thermodynam star region index castroriemann_speed_limit note riemann solver newtonian hydrodynam howev enforc interfac veloc exceed speed light colella glaz colella glaz ferguson solver excess speed usual sign low densiti region densiti reset flux limit kick behavior chang castroriemann_speed_limit paramet input edg state predict mathrho_lr u_lr v_lr p_lr mathrho e_lr mathv repres transvers veloc compon also comput mathgamma equiv dlog p dlog rho _s cell center copi edg directli get left right state mathgamma_lr also defin mathc_rm avg facecent valu averag neighbor cellcent valu mathc also comput mathrho_rm small p_rm small mathc_rm small use cellcent data step first defin mathrho c_rm small rho_rm smallc_rm small defin math rho c_lr maxleftrho c_rm smallleftgamma_lrp_lrrho_lrrightright defin star state math p maxleftp_rm smallfracleftrho c_l p_r rho c_r p_lright rho c_lrho c_ru_lu_rrho c_l rho c_rright math u fracleftrho c_l u_l rho c_r u_rright p_l p_rrho c_l rho c_r mathu ge defin mathrho_ u_ p_ rho e_ mathgamma_ left state otherwis defin right state set math rho_ maxrho_rm smallrho_ defin math c_ maxleftc_rm smallsqrtfracgamma_ p_rho_right math rho rho_ fracp p_c_ math rho e rho e_ p p_fracrho e_ p_rho_ c_ math c maxleftc_rm smallsqrtleftfracgamma_ prhorightright math beginalign c_rm c_ rm signuu_ c_rm c rm signuu c_rm shock fracc_rm c_rm endalign mathp p_ ge mathc_rm c_rm c_rm shock mathc_rm c_rm defin mathc_rm temp epsilon c_rm avg otherwis mathc_rm temp c_rm c_rm defin fraction math f halfleft fracc_rm c_rm inc_rm tempright constrain mathf lie rang mathfin get final godunov state transvers veloc upwind base mathu math v_rm gdnv begincas v_l u ge v_r rm otherwis endcas defin math beginalign rho_rm gdnv frho frho_ u_rm gdnv f u fu_ p_rm gdnv f p fp_ rho e_rm gdnv frho e frho e_ endalign final mathc_rm set mathrho_rm gdnvrho_ u_rm gdnvu_ p_rm gdnvp_ mathrho e_rm gdnvrho e_ mathc_rm ing set mathrho_rm gdnvrho u_rm gdnvu p_rm gdnvp mathrho e_rm gdnvrho e instead colella glaz solver use defin math gamma equiv fracprho e side interfac follow rest algorithm describ origin paper construct flux riemann solver follow paramet appli castroriemann_solv one follow valu colella glaz ferguson solver colella glaz solver hllc solver note use cartesian geometri reli pressur term part flux momentum equat default use solver base unpublish colella glaz ferguson manuscript also appear citepemb describ origin castro paper citecastro_i colella glaz solver iter two runtim paramet use control behavior castrocg_maxit number iter cg algorithm integ default castrocg_tol toler cg solver solv star state real default e castrocg_blend control happen root find cg solver fail nonlinear equat find pressur star region jump condit shock twoshock approximationth left right state link star region shock default root find algorithm secant method sometim fail option noth pressur iter print code abort failur revert origin guess pstar carri remaind riemann solv almost like drop cgf solver pstar use approxim switch bisect addit cg_maxit iter find root sometim work secant method fail castrohybrid_riemann switch hll riemann solver zone shock default elimin oddeven decoupl issu see oddeven problem note use hllc solver comput flux updat comput flux function primit variabl advanc solut math ubn ubn dtnablacdotfbnph dtsbn note sinc sourc term time center secondord method advect updat correct solut effect timecent sourc term _secppm_temp_fix temperatur fix index castroppm_temp_fix number experiment option improv behavior temperatur reconstruct interfac state predict option control castroppm_temp_fix take valu default methodtemperatur consid reconstruct characterist trace mathrho u p rho e parabol reconstruct matht give mathmathcali_kt_i deriv pressur intern energi ga portion via equat state math beginalign mathcali_kp_i pmathcali_krho_i mathcali_kt_i mathcali_krho e_i rho emathcali_krho_i mathcali_kt_i endalign remaind hydrodynam algorithm proce unchang enter riemann solver recomput thermodynam interfac ensur consist done take interfac valu mathrho math mathx_k comput correspond pressur mathp reset densiti reset need document density_reset_method _apphydroflux_limit flux limit multidimension hydrodynam simul often numer artifact result sharp densiti gradient somewhat common issu especi low resolut neg densiti occur result hydro updat castro contain prescript deal neg densiti reset neg densiti similar nearbi zone variou choic exist reset origin zone densiti updat reset linear combin densiti nearbi zone reset problemat strategi uniqu choic clearli better rest case addit specifi reset momenta case consequ desir improv situat limit flux neg densiti could occur reset would practic alway avoid solut implement positivitypreserv method citehu behavior control castrolimit_fluxes_on_small_den hydrodynam updat zone broken updat everi face zone flux cross face timestep central insight positivitypreserv method updat everi face positivitypreserv total updat must positivitypreserv well guarante posit preserv zone edg mathrm flux mathmathbffn_rm face modifi becom math mathbffn_rm rightarrow theta_rm mathbffn_rm theta_rm mathbfflf_rm labeleqlimited_flux math leq theta_rm leq scalar mathmathbfflf_rm laxfriedrich flux math mathbfflf_rm fracleftmathbffn_rm mathbffn_rm textcflfracdelta xdelta fracalphaleftmathbfun_rm mathbfun_rm irightright math textcfl cfl safeti factor method guarante preserv posit long mathtextcfl mathalpha scalar ensur multidimension correct mathalpha math math mathmathbff_rm flux materi evalu zone center mathrm use cellcent quantiti mathmathbfu scalar maththeta_rm chosen everi interfac calcul updat would obtain set densiti compon equal valu larger densiti floor castrosmall_den solv valu maththeta interfac make equal hold region densiti risk go neg maththeta approx origin hydrodynam updat recov discuss includ proof method descript multidimension effect test verif problem found citehu hybrid momentum castro implement hybrid momentum scheme citebyerli particular switch use cartesian momenta mathrho u mathrho v mathrho w cylindr momentum set mathrho v_r mathrho r v_phi mathrho v_z latter compon ident cartesian valu translat set momentum throughout code ultim conserv updat term cylindr momentum addit sourc term appear formul written citebyerli rotating_toru problem give good test problem origin citepapaloizoupringl problem initi toru constant specif angular momentum shown figur rotating_torus__densitypng alt rotat toru initi densiti initi densiti log scale rotating_toru problem math zone standard hydrodynam algorithm toru get disrupt spread disk figur rotating_torus__densitypng alt rotat toru normal hydro densiti log scale rotating_toru problem timestep use math zone notic initi toru becom disrupt disk hybrid momentum algorithm enabl set use_hybrid_momentum true gnumakefil enabl see toru remain intact figur rotating_torus_hybrid__densitypng alt rotat toru hybrid momentum densiti log scale rotating_toru problem timestep hybrid momentum algorithm use math zone angularmomentum preserv scheme see initi toru larg intact