---
title: 'workloopR: Analysis of work loops and other data from muscle physiology experiments in R'
tags:
  - R
  - muscle physiology
  - work loop
  - twitch
  - tetanus
  - ddf
authors:
  - name: Vikram B. Baliga
    orcid: 0000-0002-9367-8974
    affiliation: 1
  - name: Shreeram Senthivasan
    orcid: 0000-0002-7118-9547
    affiliation: 1
affiliations:
 - name: Department of Zoology, University of British Columbia, Vancouver, British Colombia, Canada V6T 1Z4
   index: 1
date: 30 October 2019
bibliography: paper.bib
---

# Summary

The work loop technique [@Josephson:1985] is used in studies of muscle physiology to determine the mechanical work and power output of a muscle. After isolating and attaching the muscle of interest to a servo motor, the motor induces cyclical oscillations of length change to the muscle. An example length change trace is shown in Figure \ref{example-workloop} (blue; one cycle out of several). As this occurs, the muscle is stimulated (grey shading) either directly or via its supplying nerve and the force that is generated is recorded (red trace). Because mechanical work is the product of force and distance, plotting force against length change for a particular cycle yields a "work loop". Work generated during the muscle's shortening phase is considered positive work, whereas work during lengthening is negative. Accordingly, the area enclosed within a work loop is the net work produced during that cycle.

![An example work loop analysis pipeline. (Left) Raw traces are shown for one length change cycle in blue. Stimulation is shown in grey shading and muscle force generation is shown in red. (Right) Net work is calculated as the difference between work in the (Middle) shortening and lengthening phases.\label{example-workloop}](images/fig1_workloop.png)

Work loop procedures have powerful experimental value and have been used to understand the characteristics of whole muscles, fiber bundles, and/or single muscle fibers from a wide variety of organisms. Using experimental parameters (e.g., length change amplitude, frequency of stimulation) that correspond to those shown by an organism *in vivo* can help explain muscle performance in the context of natural behavior. But since these experimental parameters do not need to be constrained to those shown during *in vivo* behaviors, the work loop technique affords the ability to explore a muscle's properties beyond (some) natural physiological constraints. @Ahn:2012 provides a review of the work loop technique's importance to the field of muscle physiology.

The ability to import and analyze data from work loop (or other muscle physiology ) experiments has been conspicuously absent from open-source environments. ``workloopR`` (pronounced "work looper") provides functions for the import, transformation, and analysis of muscle physiology experiments in R. As the package's title suggests, our initial motivation was to provide functions to analyze work loops to determine net work and power output from the time-course of length and force change. Over the course of developing the package, we expanded this goal to cover additional types of experiments that are often complementary to the work loop technique. Accordingly, there are three currently supported experiment types: work loop, simple twitch, and tetanus.

Importing data via functions within the package creates objects of class ``muscle_stim``, which we designed to essentially behave as ``data.frame``s but with unique properties that work nicely with ``workloopR``'s core functions. Several of our functions are designed to parse information stored in .ddf format (e.g., generated by Aurora Scientific's Dynamic Muscle Control and Analysis Software). Time-course data on muscle length change, force development, and stimulation pattern are then imported as a ``muscle_stim`` object and important metadata and protocol information (e.g., specifics of the stimulus train) are stored in the object's attributes. File formats other than .ddf are welcome, but need to be coerced into ``muscle_stim`` objects by the user using the ``as_muscle_stim()`` function.

Prior to analysis, data can be transformed or corrected. Should metadata have been recorded incorrectly, the gear ratio of the motor arm and/or the direction of the muscle's length change can be adjusted. Before analyzing work loop data, cycles within the work loop can be labeled (according to various definitions of what constitutes a "cycle"), which allows calculation of metrics on a per-cycle basis.

Core data analytical functions include ``analyze_workloop()`` for work loop files and ``isometric_timing()`` for twitch and tetanus trials. ``analyze_workloop()`` computes instantaneous velocity, net work, instantaneous power, and net power for work loop trials on a per-cycle basis. ``isometric_timing()`` provides summarization of kinetics, i.e. the timing and magnitude of force production at various points within the tetanus or twitch trial.

We also include functions for batch processing files (e.g., multiple files from a common experiment). These functions allow for the import, cycle selection, gear ratio correction, and ultimately work & power computation for all work loop trial files within a specified directory.  Our batch analytical pipeline also allows users to correct for potential degradation of the muscle (according to power & work output) over the course of the experiment.

Although we do not provide plotting functions, all ``muscle_stim`` or ``data.frame`` objects produced by our analytical functions are designed to be friendly to visualization via either base-R plotting or `tidyverse` functions.

Please see Figure \ref{flowchart} below for an overview of the ``workloopR`` package with recommended functions and vignettes.

![Flow chart of suggested analysis pipeline for various work loop and isometric studies.\label{flowchart}](images/fig2_flowchart.png)

# Acknowledgements

We thank Doug Altshuler, Jasmin Wong, and Jolan Theriault for help they provided throughout the course of this project. 

This work was funded by the U.S. Air Force Office of Scientific Research (under grant no. FA9550-16-1-0182, titled "Avian-inspired multifunctional morphing vehicles" monitored by B. L. Lee) and also by the Natural Sciences and Engineering Research Council of Canada (NSERC, RGPIN-2016-05381). 

# References
workloopR: Analysis of work loops and other data from muscle physiology experiments in R <img src="https://github.com/ropensci/workloopR/raw/master/images/workloopR_icon_300dpi.png" align="right" width="150px"/>
=======================================================================================

  <!-- badges: start -->
[![Project Status: Active – The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
[![R build status](https://github.com/ropensci/workloopR/workflows/R-CMD-check/badge.svg)](https://github.com/ropensci/workloopR/actions)
[![](https://badges.ropensci.org/326_status.svg)](https://github.com/ropensci/software-review/issues/326)
[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.3523384.svg)](https://doi.org/10.5281/zenodo.3523384)
[![DOI](https://joss.theoj.org/papers/10.21105/joss.01856/status.svg)](https://doi.org/10.21105/joss.01856)
[![CRAN status](https://www.r-pkg.org/badges/version/workloopR)](https://CRAN.R-project.org/package=workloopR)
  <!-- badges: end -->

Documentation website: https://docs.ropensci.org/workloopR/

Accompanying paper in Journal of Open Source Software: https://doi.org/10.21105/joss.01856



## Installation

You can install `workloopR` from CRAN via:

``` {r install_cran, eval = FALSE}
install.packages("workloopR")
```

Or to get the latest (developmental) version through GitHub, use:
``` r
#install.packages("devtools") # if devtools is not installed
devtools::install_github("ropensci/workloopR")
```

Please note that vignettes are not built by default. To build vignettes as well, please use the following code:
``` r
devtools::install_github("ropensci/workloopR", build_vignettes = TRUE)
```



## Overview

`workloopR` (pronounced "work looper") provides functions for the import, transformation, and analysis of muscle physiology experiments in R. As the package's title suggests, our initial motivation was to provide functions to analyze work loops. The work loop technique ([Josephson 1985](https://jeb.biologists.org/content/114/1/493)) is used in studies of muscle physiology to determine the mechanical work and power output of a muscle. Over the course of developing the package, we expanded this goal to also cover experiments that are often complementary to the work loop technique. There are three currently supported experiment types: work loop, simple twitch, and tetanus.

![Figure 1](https://github.com/ropensci/workloopR/raw/master/images/fig1_workloop.png)

For more on work loops, we recommend a great review paper by Ahn ([2012](https://dx.doi.org/10.1242/jeb.062752)) as well as [this](https://en.wikipedia.org/wiki/Work_loop) Wikipedia page.



## Example

`workloopR` offers the ability to import, transform, and then analyze a data file. Here is an example using a work loop file included within the package:

```r
library(workloopR)

## import the workloop.ddf file included in workloopR
wl_dat <- read_ddf(system.file("extdata", "workloop.ddf",
                               package = 'workloopR'),
                  phase_from_peak = TRUE)

## select cycles 3 through 5 using a peak-to-peak definition
wl_selected <- select_cycles(wl_dat, cycle_def = "p2p", keep_cycles = 3:5)

## apply a gear ratio correction, run the analysis function,
## and then get the full object
wl_analyzed <- analyze_workloop(wl_selected, GR = 2)
## for brevity, the print() method for this object produces a simple output
wl_analyzed
```
	File ID: workloop.ddf
	Cycles: 3 cycles kept out of 6
	Mean Work: 0.00308 J
	Mean Power: 0.08474 W
```r
## but see the structure for the full output, e.g.
#str(wl_analyzed)

## or run the analysis but get the simplified version
wl_analyzed_simple <- analyze_workloop(wl_selected, simplify = TRUE, GR = 2)
wl_analyzed_simple
```
	  Cycle        Work  Net_Power
	a     A 0.002785397 0.07639783
	b     B 0.003147250 0.08661014
	c     C 0.003305744 0.09122522



## Core features and recommended vignettes

*For an overview, please also see our ["Introduction to workloopR"](https://docs.ropensci.org//workloopR/articles/Introduction-to-workloopR.html) vignette*

**Data import**: Importing data creates objects of class `muscle_stim`, which we designed to essentially behave as `data.frame`s but with unique properties that work nicely with ``workloopR``'s core functions. Data that are stored in .ddf format (e.g., generated by Aurora Scientific's Dynamic Muscle Control and Analysis Software) are easily imported. Other file formats are welcome, but need to be constructed into `muscle_stim` objects by the user; please see the vignette ["Importing data from non .ddf sources"](https://docs.ropensci.org/workloopR/articles/non-ddf-sources.html).

- Example:

```R
## import the workloop.ddf file included in workloopR
wl_dat <- read_ddf(system.file("extdata", "workloop.ddf",
                               package = 'workloopR'),
                  phase_from_peak = TRUE)

## see how the muscle_stim object is organized
wl_dat
str(wl_dat)
names(attributes(wl_dat))
```


**Data transformations & corrections**: Prior to analyses, data can be transformed or corrected. Should data have been recorded incorrectly, the gear ratio of the motor arm and/or the direction of the muscle's length change can be adjusted. Before analyzing work loop data, cycles within the work loop can be labeled (according to various definitions of what constitutes a "cycle"), which allows calculation of metrics on a per-cycle basis.

- Example:

```R
## correct the gear ratio of the motor arm
## we'll use gear ratio = 2
## this multiples Force by 2 and divides Position by 2
wl_fixed <- fix_GR(wl_dat, GR = 2)
```


**Analyses**: Core data analytical functions include ``analyze_workloop()`` for work loop files and ``isometric_timing()`` for twitch and tetanus trials.

- ``analyze_workloop()`` computes instantaneous velocity, net work, instantaneous power, and net power for work loop trials on a per-cycle basis. See the ["Analyzing work loop experiments in workloopR"](https://docs.ropensci.org/workloopR/articles/Analyzing-workloops.html) vignette.

- ``isometric_timing()`` provides summarization of kinetics, i.e. the timing and magnitude of force production at various points within the tetanus or twitch trial. See the ["Working with isometric experiments in workloopR"](https://docs.ropensci.org/workloopR/articles/Calculating-twitch-kinetics.html) vignette.

- Example:

```R
## import the twitch.ddf file included in workloopR
twitch_dat <- read_ddf(system.file("extdata", "twitch.ddf",
                                   package = 'workloopR'))

## run isometric_timing() to get info on twitch kinetics
## we'll use different set points than the defaults
analyze_twitch <- isometric_timing(twitch_dat,
                                   rising = c(25, 50, 75),
                                   relaxing = c(75, 50, 25))
```


**Batch processing**: We also include functions for batch processing files (e.g., multiple files from a common experiment). These functions allow for the import, cycle selection, gear ratio correction, and ultimately work & power computation for all work loop trial files within a specified directory.  This also allows users to correct for potential degradation of the muscle (according to power & work output) over the course of the experiment. See the ["Batch processing"](https://docs.ropensci.org/articles/batch-processing.html) vignette

- Example:

```R
## batch read and analyze files included with workloopR
analyzed_wls <- read_analyze_wl_dir(system.file("extdata/wl_duration_trials",
                                                package = 'workloopR'),
                                    phase_from_peak = TRUE,
                                    cycle_def = "p2p", keep_cycles = 2:4,
                                    GR = 2)
```


**Plotting**: Although we do not provide plotting functions, all resultant objects are designed to be friendly to visualization via either base-R plotting or `tidyverse` functions. Please see the ["Plotting data in workloopR"](https://docs.ropensci.org/articles/Plotting-workloopR.html) vignette.



## Graphical overview

Recommended functions and vignettes:

![Figure 2](https://github.com/ropensci/workloopR/raw/master/images/fig2_flowchart.png)



## Citation

The preferred way to cite `workloopR` is:

Baliga VB and Senthivasan S. 2019. workloopR: Analysis of work loops and other data from muscle physiology experiments in R. *Journal of Open Source Software*, 4(43), 1856, https://doi.org/10.21105/joss.01856



## Issues/questions/requests

Feedback is welcome! Please feel free to get in touch with either Vikram ([@vbaliga](https://github.com/vbaliga)) or Shree ([@shreeramsenthi](https://github.com/shreeramsenthi)).

We are happy to take feature requests, especially those that involve data import from non-ddf file types. Please see our Issues page for [templates](https://github.com/ropensci/workloopR/issues/new/choose) that you can use.  

🐢



## License

GPL (>= 3) + file LICENSE


[![ropensci_footer](https://ropensci.org/public_images/ropensci_footer.png)](https://ropensci.org)

workloopR 1.1.2 (2019-11-01)
=========================

  * Accepted by the Journal of Open Source Software!! 
  See: https://doi.org/10.21105/joss.01856
  * All updates relate to adding JOSS paper info throughout the package
  * No updates to functions or other code


workloopR 1.1.1 (2019-10-31)
=========================

  * Add funding sources to `paper.md`
  * Small fixes to language or typos
  * Add Issues information to `README`


workloopR 1.1.0 (2019-10-29)
=========================
2019-10-29:
  * Accepted by rOpenSci!! 
  * Updated all links and documentation to work with transfer of repo to 
  https://github.com/ropensci/
  * No changes to code or documentation otherwise, hence no change to version
  of package
  

2019-10-24:
  * New version of package following one round of peer review at rOpenSci. See 
  this link for details of all changes: 
  https://github.com/ropensci/software-review/issues/326#issuecomment-545283640  
  * `read_wl.ddf()` and `read_twitch.ddf()` have been renamed to `read_wl_ddf()`
  and `read_twitch_ddf()`, respectively
  * Many changes to documentation including explicit linking of vignettes
  * Now out of a developmental phase, but awaiting further feedback from 
  rOpenSci editors and reviewers


workloopR 1.0.1.9000 (2019-10-17)
=========================

  * Developmental version: beginning to roll out changes as suggested by 
    peer reviewers at rOpenSci 
    (https://github.com/ropensci/software-review/issues/326)
  * Once all changes are implemented, version will be bumped (likely to 1.1.0)
  * Use with caution in the meantime


workloopR 1.0.1 (2019-08-05)
=========================
### DOCUMENTATION FIXES

  * Fixed typos and spelling mistakes via `spelling::spell_check_package()`
  * Fixed formatting errors in `README.md`
  * Accordingly, package pages created via `pkgdown` were regenerated 
  * Re-formatted `NEWS.md` to fit rOpenSci style guides


workloopR 1.0.0 (2019-07-22)
=========================

  * Prepped package for rOpenSci submission
  * Added a `NEWS.md` file to track changes to the package.
## Test environments
* local R installation, R 4.0.2
* windows-latest (release) on GitHub Actions
* macOS-latest (release) on GitHub Actions
* ubuntu-20.04 (release) on GitHub Actions
* ubuntu-20.04 (devel) on GitHub Actions

## R CMD check results

0 errors | 0 warnings | 0 notes
<!-- IF THIS INVOLVES AUTHENTICATION: DO NOT SHARE YOUR USERNAME/PASSWORD, OR API KEYS/TOKENS IN THIS ISSUE - MOST LIKELY THE MAINTAINER WILL HAVE THEIR OWN EQUIVALENT KEY -->

<!-- If you've updated a file in the man-roxygen directory, make sure to update the man/ files by running devtools::document() or similar as .Rd files should be affected by your change -->

<!--- Provide a general summary of your changes in the Title above -->

## Description
<!--- Describe your changes in detail -->

## Related Issue
<!--- if this closes an issue make sure include e.g., "fix #4"
or similar - or if just relates to an issue make sure to mention
it like "#4" -->

## Example
<!--- if introducing a new feature or changing behavior of existing
methods/functions, include an example if possible to do in brief form -->

<!--- Did you remember to include tests? Unless you're just changing
grammar, please include new tests for your change -->
# CONTRIBUTING #

### Fixing typos

Small typos or grammatical errors in documentation may be edited directly using
the GitHub web interface, so long as the changes are made in the _source_ file.

*  YES: you edit a roxygen comment in a `.R` file below `R/`.
*  NO: you edit an `.Rd` file below `man/`.

### Prerequisites

Before you make a substantial pull request, you should always file an issue and
make sure someone from the team agrees that it’s a problem. If you’ve found a
bug, create an associated issue and illustrate the bug with a minimal 
[reprex](https://www.tidyverse.org/help/#reprex).

### Pull request process

*  We recommend that you create a Git branch for each pull request (PR).  
*  Look at the Travis and AppVeyor build status before and after making changes.
The `README` should contain badges for any continuous integration services used
by the package.  
*  We recommend the tidyverse [style guide](http://style.tidyverse.org).
You can use the [styler](https://CRAN.R-project.org/package=styler) package to
apply these styles, but please don't restyle code that has nothing to do with 
your PR.  
*  We use [roxygen2](https://cran.r-project.org/package=roxygen2).  
*  We use [testthat](https://cran.r-project.org/package=testthat). Contributions
with test cases included are easier to accept.  
*  For user-facing changes, add a bullet to the top of `NEWS.md` below the
current development version header describing the changes made followed by your
GitHub username, and links to relevant issue(s)/PR(s).

### Code of Conduct

Please note that the workloopR project is released with a
[Contributor Code of Conduct](CODE_OF_CONDUCT.md). By contributing to this
project you agree to abide by its terms.

### See rOpenSci [contributing guide](https://devguide.ropensci.org/contributingguide.html)
for further details.

### Discussion forum

Check out our [discussion forum](https://discuss.ropensci.org) if

* you have a question, an use case, or otherwise not a bug or feature request for the software itself.
* you think your issue requires a longer form discussion.

### Prefer to Email? 

Email the person listed as maintainer in the `DESCRIPTION` file of this repo.

Though note that private discussions over email don't help others - of course email is totally warranted if it's a sensitive problem of any kind.

### Thanks for contributing!

This contributing guide is adapted from the tidyverse contributing guide available at https://raw.githubusercontent.com/r-lib/usethis/master/inst/templates/tidy-contributing.md 
<!-- IF THIS INVOLVES AUTHENTICATION: DO NOT SHARE YOUR USERNAME/PASSWORD, OR API KEYS/TOKENS IN THIS ISSUE - MOST LIKELY THE MAINTAINER WILL HAVE THEIR OWN EQUIVALENT KEY -->

<!-- If this issue relates to usage of the package, whether a question, bug or similar, along with your query, please paste your devtools::session_info() or sessionInfo() into the code block below, AND include a reproducible example (consider using a "reprex" https://cran.rstudio.com/web/packages/reprex/) If not, delete all this and proceed :) -->

<details> <summary><strong>Session Info</strong></summary>

```r

```
</details>
---
name: 'Feature request: general'
about: Suggest an idea that does not relate to new data import functions
title: ''
labels: enhancement
assignees: shreeramsenthi, vbaliga

---

**Is your feature request related to a problem? Please describe.**
A clear and concise description of what the problem is. Ex. I'm always frustrated when [...]

**Describe the solution you'd like**
A clear and concise description of what you want to happen.

**Describe alternatives you've considered**
A clear and concise description of any alternative solutions or features you've considered.

**Additional context**
Add any other context or screenshots about the feature request here.
---
name: Bug report
about: Create a report to help us improve
title: ''
labels: bug
assignees: shreeramsenthi, vbaliga

---

**Describe the bug**
A clear and concise description of what the bug is.

**To Reproduce**
Steps to reproduce the behavior:
1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error

**Expected behavior**
A clear and concise description of what you expected to happen.

**Screenshots**
If applicable, add screenshots to help explain your problem.

**Desktop (please complete the following information):**
 - OS: [e.g. iOS]
 - Browser [e.g. chrome, safari]
 - Version [e.g. 22]

**Smartphone (please complete the following information):**
 - Device: [e.g. iPhone6]
 - OS: [e.g. iOS8.1]
 - Browser [e.g. stock browser, safari]
 - Version [e.g. 22]

**Additional context**
Add any other context about the problem here.
---
name: 'Feature request: import function for file type'
about: Ask us about creating an import function for a specific file type
title: ''
labels: enhancement
assignees: shreeramsenthi, vbaliga

---

**Is your feature request related to a specific file type? Please describe.**
A clear and concise description of what the problem is. What is the file type and are the files created by a specific program or software suite?

**Can you provide an example file of the specified type?**
Data on public repositories are preferred. If that is not an option, please contact Vikram (GitHub: @vbaliga) directly.

**Describe the solution you'd like**
A clear and concise description of what you want to happen.

**Does as_muscle_stim() not work?**
Although we are very happy to create new functions for additional file types, we'd like to know if our current workaround does not work for you. Please provide a description of whether `as_muscle_stim()` can work or if it fails in this use case.

**Additional context**
Add any other context or screenshots about the feature request here.
