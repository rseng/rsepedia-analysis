# katex [![badge](https://ropensci.r-universe.dev/badges/katex)](https://ropensci.r-universe.dev)

> Rendering Math to HTML and MathML in R

Convert latex math expressions to HTML for use in markdown documents or 
package manual pages. The rendering is done in R using the V8 engine, which 
eliminates the need for embedding the MathJax library in the web pages. 

## Installation and documentation

Install directly from [r-universe](https://ropensci.r-universe.dev/):

```r
# Install from our universe
options(repos = c(
    ropensci = 'https://ropensci.r-universe.dev',
    CRAN = 'https://cloud.r-project.org'))
install.packages('katex')
```

Docs: https://docs.ropensci.org/katex/reference/katex.html
---
title: "Rending math to HTML in R using katex"
output: 
  html_document:
    mathjax: null
    theme: null
    highlight: haddock
#    self_contained: false
vignette: >
  %\VignetteIndexEntry{Rending math to HTML in R using katex}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = "")
library(katex)
```

This vignette demonstrates some example math rendered server-side in R using the katex package. Refer to the upstream [katex support table](https://katex.org/docs/support_table.html) for the full list of supported tex functions.

Example equations from: https://www.intmath.com/cg5/katex-mathjax-comparison.php

### Equation 1

```{r}
tex1 <- "\\frac{1}{\\Bigl(\\sqrt{\\phi \\sqrt{5}}-\\phi\\Bigr) e^{\\frac25 \\pi}} \\equiv 1+\\frac{e^{-2\\pi}} {1+\\frac{e^{-4\\pi}} {1+\\frac{e^{-6\\pi}} {1+\\frac{e^{-8\\pi}} {1+\\cdots} } } }"
katex_html(tex1, include_css = TRUE)
```

### Equation 2

```{r}
tex2 <- "\\left( \\sum_{k=1}^n a_k b_k \\right)^2 \\leq \\left( \\sum_{k=1}^n a_k^2 \\right) \\left( \\sum_{k=1}^n b_k^2 \\right)"
katex_html(tex2)
```

### Equation 3

```{r}
tex3 <- "1 +  \\frac{q^2}{(1-q)}+\\frac{q^6}{(1-q)(1-q^2)}+\\cdots = \\prod_{j=0}^{\\infty}\\frac{1}{(1-q^{5j+2})(1-q^{5j+3})}, \\text{ for }\\lvert q\\rvert < 1."
katex_html(tex3)
```

### Equation 4

```{r}
tex4 <- "\\int u \\frac{dv}{dx}\\,dx=uv-\\int \\frac{du}{dx}v\\,dx"
katex_html(tex4)
```

### Equation 5

```{r}
tex5 <- "S (\\omega)=\\frac{\\alpha g^2}{\\omega^5} \\,e ^{[-0.74\\bigl\\{\\frac{\\omega U_\\omega 19.5}{g}\\bigr\\}^{-4}]}"
katex_html(tex5)
```


### Equation 6

```{r}
tex6 <- "f(n) = \\begin{cases} \\frac{n}{2}, & \\text{if } n\\text{ is even} \\\\ 3n+1, & \\text{if } n\\text{ is odd} \\end{cases}"
katex_html(tex6)
```

### Equation 7

```{r}
tex7 <- "\\begin{aligned}
\\dot{x} & = \\sigma(y-x) \\\\ 
\\dot{y} & = \\rho x - y - xz \\\\ 
\\dot{z} & = -\\beta z + xy 
\\end{aligned}"
katex_html(tex7)
```

### Equation 8

```{r, eval = V8::engine_info()$version > 6}
tex8 <- "\\begin{pmatrix} 
a_{11} & a_{12} & a_{13}\\\\ 
a_{21} & a_{22} & a_{23}\\\\ 
a_{31} & a_{32} & a_{33} 
\\end{pmatrix}"
katex_html(tex8)
```

% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/katex.R
\name{katex}
\alias{katex}
\alias{katex_html}
\alias{katex_mathml}
\alias{example_math}
\title{Tex math rendering in R}
\usage{
katex_html(
  tex,
  displayMode = TRUE,
  ...,
  include_css = FALSE,
  preview = interactive()
)

katex_mathml(tex, displayMode = TRUE, ...)

example_math()
}
\arguments{
\item{tex}{input string with tex math expression.}

\item{displayMode}{render math in centered 2D layout, similar to \verb{$$} in tex.
Set to \code{FALSE} to render (non-centered) inline layout for use in text.
For pdf output, this corresponds to the \verb{\deqn{}} and \verb{\eqn{}} macros, see
\href{https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Mathematics}{WRE 2.6: Mathematics}}

\item{...}{additional html rendering options passed to
\href{https://katex.org/docs/options.html}{katex.render}}

\item{include_css}{adds the katex css file to the output.
This is only required once per html webpage. Set to \code{FALSE} if you include css
files into the your html head some other way.}

\item{preview}{open an HTML preview page showing the snipped in the browser}
}
\value{
a string with a html/mathml fragment
}
\description{
Converts tex-style math expressions to html and mathml for use in manual pages or
markdown documents.
The conversion is done in R using V8 ("server-side"), hence the resulting fragment can
be inserted into an HTML document without the need for a JavaScript library like MathJax.
Only the \href{https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css}{katex.css}
style file is required in the final html document.
Use \link{math_to_rd} for embedding math into R documentation (\code{.rd}) pages.
}
\details{
Refer to the upstream \href{https://katex.org/docs/support_table.html}{katex support table} for
the full list of supported tex functions that can be rendered to html using katex.

By default, \link{katex_html} returns a mix of HTML for visual rendering and includes
MathML for accessibility. To only get html, pass \code{output="html"} in the extra options,
see also the \href{https://katex.org/docs/options.html}{katex documentation}.
}
\examples{
# Basic examples
html <- katex_html(example_math())
mathml <- katex_mathml(example_math())

# Example from katex.org homepage:
macros <- list("\\\\f" = "#1f(#2)")
math <- "\\\\f\\\\relax{x} = \\\\int_{-\\\\infty}^\\\\infty \\\\f\\\\hat\\\\xi\\\\,e^{2 \\\\pi i \\\\xi x} \\\\,d\\\\xi"
html <- katex_html(math,  macros = macros)
mathml <- katex_mathml(math,  macros = macros)
}
\seealso{
Other katex: 
\code{\link{math_to_rd}()},
\code{\link{pandoc}}
}
\concept{katex}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pandoc.R
\name{pandoc}
\alias{pandoc}
\alias{render_math_in_html}
\title{Renders math in HTML document}
\usage{
render_math_in_html(
  input,
  output = NULL,
  ...,
  throwOnError = FALSE,
  include_css = TRUE
)
}
\arguments{
\item{input}{path to the html input file}

\item{output}{path to the output html file, or NULL to return as string}

\item{...}{additional html rendering options passed to
\href{https://katex.org/docs/options.html}{katex.render}}

\item{throwOnError}{should invalid math raise an error in R? See \href{https://katex.org/docs/options.html}{katex options}}

\item{include_css}{automatically inject the required katex css in the html head}
}
\description{
Reads an html file and substitutes elements of class \code{"math display"} and
\code{"math inline"} with rendered html math. This is mainly intended as a
post-processing step for pandoc, which generates such html for equations.
As a result the math can be displayed without the need for including the
mathjax library in the html document.
}
\seealso{
Other katex: 
\code{\link{katex}},
\code{\link{math_to_rd}()}
}
\concept{katex}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rd.R
\name{math_to_rd}
\alias{math_to_rd}
\title{Display math in R documentation}
\usage{
math_to_rd(tex, ascii = tex, displayMode = TRUE, ..., include_css = TRUE)
}
\arguments{
\item{tex}{input string with tex math expression.}

\item{ascii}{alternate text-only representation of the input math to show in
documentation rendered to plain text format.}

\item{displayMode}{render math in centered 2D layout, similar to \verb{$$} in tex.
Set to \code{FALSE} to render (non-centered) inline layout for use in text.
For pdf output, this corresponds to the \verb{\deqn{}} and \verb{\eqn{}} macros, see
\href{https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Mathematics}{WRE 2.6: Mathematics}}

\item{...}{additional html rendering options passed to
\href{https://katex.org/docs/options.html}{katex.render}}

\item{include_css}{adds the katex css file to the output.
This is only required once per html webpage. Set to \code{FALSE} if you include css
files into the your html head some other way.}
}
\value{
a string with an rd fragment to be included in R documentation
}
\description{
Helper function to insert tex math expressions into R documentation (\code{.rd}) files.
Uses Katex rendering for documentation in html format, and the appropriate latex
macros for documentation rendered in pdf or plain-text.
}
\details{
Use \code{math_to_rd()} inside \verb{\\Sexpr} to embed math in your R package documentation
pages. For example the code below can be inserted in your \code{rd} (or roxygen)
source code:\preformatted{\\Sexpr[results=rd, stage=build]\{
  katex::math_to_rd(katex::example_math())
\}
}

Which results in the following output:

\Sexpr[results=rd, stage=build]{
katex::math_to_rd(katex::example_math())
}

Optionally you can specify an alternate ascii representation that will be shown in
the plain-text format rendering of the documentation:\preformatted{\\Sexpr[results=rd, stage=build]\{
  katex::math_to_rd('E=MC^2', 'E=mc²')
\}
}

\Sexpr[results=rd, stage=build]{
katex::math_to_rd('E=MC^2', 'E=MC²')
}

If no ascii representation is given, the input tex in displayed verbatim into the
plain-text documentation.
}
\section{Note for Windows}{
On Windows, R versions before 4.1.2 had a \href{https://bugs.r-project.org/show_bug.cgi?id=18152}{bug}
which could lead to incorrect HTML encoding for \verb{\\Sexpr\{\}} output.
As a workaround, we automatically escape non-ascii html characters
on these versions of R. Linux and MacOS are unaffected.
}

\seealso{
Other katex: 
\code{\link{katex}},
\code{\link{pandoc}}
}
\concept{katex}
