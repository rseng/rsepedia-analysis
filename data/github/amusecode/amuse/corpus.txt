amus astrophys multipurpos softwar environ doihttpszenodoorgbadgedoizenodosvghttpsdoiorgzenodo pypi versionhttpsbadgefuryiopyamusesvghttpsbadgefuryiopyamus repositori contain amus softwar amus write script simul astrophys problem differ domain project websit wwwamusecodeorg document found httpsamusereadthedocsio get start short probabl bash pip instal amus get go linux mac compil code hdf mpi librari must instal hint quick instal fail pleas look option detail descript instal procedur document docinstal directori compil build amus sourc need work build environ amus build system need cc fortan compil recommend recent version gcc ubuntu setup environ root bash aptget instal buildessenti curl g gfortran gettext zlibgdev distribut similar packag packag group avail maco use homebrew macport packag manag requir appl develop tool xcode instal window machin amus instal window subsystem linux wsl instal eg ubuntu microsoft store recommend use wsl instal instruct see linux instal instruct python amus need python version instal prefer pip virtualenv may necessari updat pip recent version use python legaci support python avail amus releas python branch instal prerequisit follow librari need instal hdf version x mpi openmpi mpich follow need code fftw version gsl cmake version gmp version mpfr version installingbuild amus amus instal pip bash pip instal user amus build instal amus extens set code necessari also instal requir python packag numpi version hpi version mpipi version pytest version docutil version use pip must instal hand possibl instal minim framework bash pip instal user amuseframework includ code ad bash pip instal user amusecod name amus develop amus develop instal also handl pip execut root clone repositori bash pip instal e code need build bash python setuppi develop_build run test amus come larg set test run automat run test start pytest command main amus directori directori readm file live run test instal test bash pip instal user amusetest instal test whether instal full amus packag run automat test bash pytest pyarg v amusetestsuit also run test specif packag instal eg bash pytest pyarg amusetestsuitecodes_teststest_huayno may prefix mpiexec n oversubscrib pytest command contribut amus your interest contribut code amus excel report issu open issu report problem pleas tri provid minim code exampl reproduc issu also includ detail oper system compil python numpi amus version use contribut code contribut amus done via pull request github user fork amus repositoryhttpsgithubcomamusecodeamus open pull request open master branch branch pleas make sure includ follow code code ad test usual test ensur code previous fail work regress test test cover much possibl new function make sure doesnt break futur also return consist result platform sinc run test mani platformsconfigur checklist contribut code pull request new featur review see meet follow requir pull request amus maintain help make sure pull request meet requir inclus packag scientif qualiti applic submiss relev amus refer includ origin paper simul code code perform expect code test previous exist code domain code qualiti code compat python depend amus mpi python standard librari numpi compat reason prefer code also work older version numpi matplotlib etc addit depend handl appropi possibl factor addit depend make option code follow amus style guid httpwwwamusecodeorgdocreferencestyle_guidehtml test input function suffici test test except rais test expect perform sourc test document python setuppi test run without failur document inform need ad doc describ code licens code requir specif licens amus licens conflict code amus amus requir checkout pull request repeat exampl test asterisk astrophys visual amus base esight get start run code pleas add root directori project classpath bonsai optim version bonsai howev also contain fewer featur version contain stop condit individualdynam timestep run code make sure type follow consol otherwis code hangscrash ulimit unlimit amusedistribut distribut code amus project etic etic expans techniqu collisionless system gpu current cuda nbodi code use seri expans calcul gravit field see detail public meiron li b holleybockelmann k spurzem r apj httpadsabsharvardeduabsapjm what insid etic standalon program etic static librari etic modul amus prerequisit cuda mandatori hdf option boost option amus mandatori amus modul disabl hdf insert explan disabl boost insert explan compil standalon program make standalon build src static librari make librari build src amus modul make build top level directori whole etic directori place link insid amuse_dirsrcamusecommun use fileini selfexplanatori input file compil without boost fill relev variabl file noboostinc compil execut chang paramet requir recompil start simul etic fileini input file name accept known issu mex mex multipol expans method avail version thu scf selfconsist field method expans techniqu avail etic program heavili restructur mex routin longer compat hope fix hardcod launch configur least one cuda kernel variou reason seem brute forc search need find optim launch configur current hardcod primit search routin provid problem particl θ due use unstabl recurs relat calcul associ legendr polynomi particl narrow cone around zaxi consid accur mean give erron contribut gravit field also assign erron forc potenti size cone increas angular term expans partli solv current ugli fix consid particl cosθ monopol level bad monopol alway domin term error free number particl cone small transient ie come usual small number step somewhat better solut make arbitrari cutoff ldepend even better solut would use asymptot express associ legendr polynomi name issu report issu featur request bug report titl label assigne name bug report creat report help us improv titl label bug assigne describ bug clear concis descript bug reproduc step reproduc behavior expect behavior clear concis descript expect happen log applic add logfil help explain problem environ pleas complet follow inform os version eg maco high sierra ubuntu linux compil eg gcc addit context add context problem name featur request suggest featur improv amus titl label featur request assigne featur request relat problem pleas describ clear concis descript problem ex im alway frustrat describ solut youd like clear concis descript want happen describ altern youv consid clear concis descript altern solut featur youv consid addit context add context logfil featur request name question ask amuserel question titl label question assigne packag instal mameclot commun code amus packag instal astrophys multipurpos softwar environ amus packag instal gadget commun code amus packag instal mercuri commun code amus packag instal ph commun code amus packag instal capreol commun code amus packag instal mikkola commun code amus packag instal fi commun code amus packag instal athena commun code amus packag instal hermit commun code amus packag instal evtwin commun code amus packag instal secularmultipl commun code amus packag instal astrophys multipurpos softwar environ amus packag instal hop commun code amus packag instal huyano commun code amus packag instal sphray commun code amus packag instal phigrap commun code amus packag instal sse commun code amus packag instal fractalclust commun code amus packag instal kepler commun code amus packag instal twobodi commun code amus packag instal bse commun code amus packag instal brutu commun code amus packag instal smalln commun code amus packag instal simplex commun code amus packag instal petar commun code amus packag instal aarsethzar commun code amus packag instal framework astrophys multipurpos softwar environ amus packag instal bhtree commun code amus packag instal keplerorbit commun code amus packag instal halogen commun code amus packag instal mmam commun code amus packag instal fastkick commun code amus packag instal distribut commun code amus need distribut commun channel packag instal moss commun code amus packag instal seba commun code amus packag instal tutori astrophys multipurpos softwar environ amus packag instal galaxia commun code amus packag instal galact commun code amus packag instal mobs commun code amus amus document master file creat sphinxquickstart tue sep adapt file complet like least contain root toctre direct astrophys multipurpos softwar environ content toctre maxdepth installindex tutorialindex interactive_tutorialindex referenceindex designindex htmlonli exampl examplesindexhtml_ indic tabl refgenindex refmodindex refsearch plot amus matplotlib matplotlib httpsmatplotliborgindexhtml_ python plot librari capabl work mani graphic user interfac toolkit requir amus instal amus provid extend plot function plot made axi label made automat yield concern unit use matplotlib within amus extend plot function need follow import codeblock python amuseplot import nativ matplotlib plot function still avail native_plot namespac eg codeblock python native_plotsubplot matplotlib document httpsmatplotliborgcontentshtml_ instal matplotlib either use prepackag version instal sourc instal sourc instal prerequisit user directori make sure path set correct sourc found httpsgithubcommatplotlibmatplotlib_ instal instruct found httpsmatplotliborgusersinstallinghtml_ latex support latex support label enabl issu codeblock python latex_support command temporarili chang matplotlibrc set codeblock python rctext usetextru mathtext latex support flexibl rich featur might slow requir latex dvipng ghostscript instal use matplotlib builtin tex express parser mathtext instead subset tex markup usabl matplotlib text string place insid pair dollar sign see mathtext httpsmatplotliborgusersusetexhtml_ detail support function plot semilogx semilog loglog scatter hist xlabel ylabel exampl code literalinclud examplesapplicationstest_plotpi imag plotsplotpng width cm align left estim typic mass massiv star cluster tutori estim typic mass massiv star cluster salpet initi mass function imf tutori also illustr unit wont get way calcul first import numpi set seed random number gener rng random number use amus drawn rng seed cours necessari make result reproduc codeblock python import numpi numpyrandomse also need unit salpet imf gener easiest way import almost everyth amus toolbox codeblock python amuselab import import requir modul function manual clariti codeblock python amuseunit import unit amuseextsalpet import new_salpeter_mass_distribut calcul maximum stellar mass number_of_cluster_r realiz number_of_star star cluster salpet imf run solar mass slope default suppos maximum solar mass bit high tast set solar mass codeblock python number_of_star number_of_cluster_r maxmass unitsmsun rangenumber_of_cluster_r maxmassesappendmaxnew_salpeter_mass_distribut number_of_star mass_max unitsmsun note way initi maxmass solar mass unit forc vectorquant instead python list scalarquant alway recommend much faster make sure amus alway recogn quantiti want know mean mass maxmass vectorquant simpli use mean function vectorquant codeblock python print mean maxmassesmean mean msun work median standard deviat maxmass codeblock python print median maxmassesmedian print stddev maxmassesstd median msun stddev msun slightli slower give result use numpi function codeblock python print mean numpymean maxmass print median numpymedianmaxmass print stddev numpystdmaxmass mean msun median e kg stddev msun someth weird happen unit median mass result still correct unit convert si unit usual caus multipl quantiti amus tri simplifi result cancel exampl factor kg kg there need bother annoy easili fix codeblock python print median numpymedianmaxmassesin_unitsmsun median msun integr fortran code tutori creat amus interfac fortran code first defin legaci interfac implement code final build object orient interfac top legaci interfac legaci code interfac support method transfer valu code valu unit error handl provid interfac add error handl unit handl function legaci interfac defin subclass incodecomponentimplement object orient interfac graphviz digraph layer fontsiz rankdirlr node fontsiz shapebox stylefil fillcolorlightyellow legaci code legaci interfac object orient interfac script legaci code tutori simpl naiv implement find nearest neighbor particl two path defin interfac walk path manag particl amus python manag particl code c fortran first path make sens legaci code perform transform particl analys particl state store intern state function call data extern everi function code data everi particl send code expect multipl call code would incur high commun overhead better choos path second path make sens code alreadi manag particl grid want call multipl function code need send complet model code everi function call code first given data call made code evolv model perform reduct step data final updat data retriev code procedur suggest procedur creat new interfac follow legaci interfac start creat legaci interfac defin function interfac input output relev data incodecomponentimplement code depend legaci interfac code make class creat subclass incodecomponentimplement class defin method legaci interfac defin function paramet code interfac need defin unit paramet paramet return valu use errorcod defin properti function legaci interfac better describ properti code read variabl like current model time defin paramet function legaci interfac provid access paramet code unit default valu need defin paramet step defin set grid code usual handl object gridpoint attribut step gener interfac defin object interoper code increas start tutori assum work amus environ pleas ensur amus setup correctli run nosetest amus directori environ variabl simplifi work come section first defin environ variabl amuse_dir environ variabl must point root directori amus directori contain buildpi script codeblock bash export amuse_dirpath amus root directori c shell codeblock csh setenv amuse_dir path amus root directori build code want run test code check amus avail python path run follow code command line codeblock bash python c import amus traceback recent call last file string line modul importerror modul name amus code end importerror shown exampl pythonpath environ variabl must extend src directori amuse_dir use one follow command codeblock bash export pythonpathpythonpathamuse_dirsrc c shell codeblock csh setenv amuse_dir pythonpathamuse_dirsrc name project write code find nearest neighbor particl let call project nearestneighbor creat initi directori structur first need creat directori project put file help build code fastest method setup directori use buildpi script codeblock bash amuse_dirbuildpi typef modedir nearestneighbor script gener directori file need start project also gener small legaci code one function echo_int build test new modul cd nearestneighbor make amuse_diramusesh c interfac import nearestneighbor print nearestneighborecho_int ordereddictionaryint_out __result nosetest v ran test ok note buildpi script use gener rang file see file run script help paramet like amuse_dirbuildpi help legaci code normal legaci code alreadi exist task limit defin implement interfac amus script access code tutori implement legaci code legaci code integr interfac code put one directori legaci code put src directori place directori buildpi script creat src directori us put nearest neighbor algorithm directori go src directori creat codef file open file favorit editor copi past code literalinclud nearestneighborcodef languag fortran note algorithm unoptim nn order meant effici code readabl exampl continu also need alter makefil src directori codecc file includ build open editor makefil chang line codeobj testo codeobj testo codeo test code build coupl algorithm interfac even defin interfac new function legaci interfac directori src directori codeblock bash make nosetest ran test ok work test fail reason pleas check fortran code correct worker_cod exist directori path defin legaci interfac first defin legaci interfac call find_nearest_neighbor function python amus interact class function function scalar input output variabl variabl simpl noncomposit variabl like integ doubl precis exampl codeblock fortran function exampleinput output implicit none integ exampl doubl precis input output output input exampl end function function vector list input output variabl length variabl return valu scalar valu exampl codeblock fortran function exampleinput output n implicit none integ exampl n doubl precis inputn outputn n outputi inputi end exampl end function function dont follow pattern need defin convert function fortran provid interfac follow one two pattern support amus case find_nearest_neighbor compli pattern write code fortran convert function compliant interfac specifi function python ad find_nearest_neighbor method nearestneighborinterfac class interfacepi file open editor interfacespi file add follow method nearestneighborinterfac class codeblock python class nearestneighborinterfaceincodecomponentimplement legacy_funct def find_nearest_neighbor function legacyfunctionspecif functionmust_handle_array true functionaddparameternpoint dtypeint directionfunctionlength functionaddparameterx dtypefloat directionfunctionin functionaddparameteri dtypefloat directionfunctionin functionaddparameterz dtypefloat directionfunctionin functionaddparametern dtypeint directionfunctionout functionaddparametern dtypeint directionfunctionout functionaddparametern dtypeint directionfunctionout functionresult_typ int return function find_nearest_neighbor method specifi everi paramet fortran function result type paramet need defin name data type wether input output input output data use paramet amus know limit amount data type paramet float float int string also special paramet length direct paramet need function follow pattern fill length input array also must specifi function follow pattern set functionmust_handle_array true save file recompil code codeblock bash make clean make nosetest ran test ok work know find_nearest_neighbor method realli work let write test find open editor test_nearestneighborpi file add follow method nearestneighborinterfacetest class codeblock python def testself instanc nearestneighborinterfac x lenx z lenx n n n error instancefind_nearest_neighborsxyz selfassertequalserror selfassertequalsn selfassertequalsn selfassertequalsn instancestop test call find_nearest_neighbor method posit check nearest neighbor determin correctli let run test see everyth work codeblock bash nosetest ran test ok simpl interfac work index call could send data unit method also error check method let defin object orient interfac solv problem defin object orient interfac object orient interfac sit top legaci interfac decor interfac set unit handl state engin start creat object orient interfac inherit incodecomponentimplement write __init__ function build script ad class interfacepi file us open editor interfacepi make sure code file end file codeblock python class nearestneighborincodecomponentimplement def __init__self option incodecomponentimplementation__init__self nearestneighborinterfac option configur handler configur object orient interfac implement sever method object orient interfac implement sever handler handler provid support specif aspect interfac amus defin handler unit convers handler interfac set particl handler ensur method call right order etc handler gener need configur use handler configur use visitor pattern follow pseudocod show handler configur codeblock python class incodecomponentimplementationobject def configure_handlersself handler selfget_all_handl handlerconfigureself def define_converterself handler configur unit convert handler handlerset_nbody_convert def define_particle_setsself handler configur set particl handlerdefine_incode_particle_set handlerset_gett class handleconvertunitsabstracthandl def configureself interfac interfacedefine_converterself class handleparticlesabstracthandl def configureself interfac interfacedefine_particle_setsself configur handler option defin handler need interfac exampl need configur handlemethodswithunit handler defin unit error handl handleparticl defin particl set defin method unit first want add unit error handl find_nearest_neighbor creat define_method function nearestneighbor class open editor interfacepi add method class codeblock python def define_methodsself handler handleradd_method find_nearest_neighbor generic_unit_systemlength generic_unit_systemlength generic_unit_systemlength handlerindex handlerindex handlerindex handlererror_cod add_method call expect name function legaci interfac first next expect list unit input paramet list unit output paramet return valu function alway last item list output paramet specifi generic_unit_systemlength unit x z paramet output paramet indic errorcod errorcod handl amus interfac mean success mean rais except let write test see work open editor test_nearestneighborpi class add method codeblock python def testself instanc nearestneighbor x generic_unit_systemlength lenx generic_unit_systemlength z lenx generic_unit_systemlength n n n instancefind_nearest_neighborsxyz selfassertequalsn selfassertequalsn selfassertequalsn instancestop note test look lot like test defin unit need handl errorcod build test code codeblock bash make clean make nosetest ran test ok note although edit python code still need run make code check worker_cod execut date everi run detect updat broke code still demand code rebuilt defin particl set particl set amus handl python call inmemori commun code call incod case code handl particl need configur particl handler manag inmemori particl set open editor interfacepi add method nearestneighbor class codeblock python def define_particle_setsself object objectdefine_inmemory_setparticl that particl attribut class add remov delet particl set still miss connect particl nearest neighbor amus provid handler instead write method run find_nearest_neighbor function set indic particl set open editor interfacepi add method nearestneighbor class codeblock python def runself indic indic indic selffind_nearest_neighbor selfparticlesx selfparticlesi selfparticlesz selfparticlesneighbor listselfparticlesindic selfparticlesneighbor listselfparticlesindic selfparticlesneighbor listselfparticlesindic function get x z attribut particl set send find_nearest_neighbor method method return list indic need find particl indic fortran code indic start use python indic start need subtract array indic use find particl note particl set given sequenc delet addit particl chang order particl set therefor never good idea use th index particl set refer particl howev run method particl set chang find_nearest_neighbor call moment find particl set index use selfparticlesindic case save use index valid refer let write test see work open editor test_nearestneighborpi class add method codeblock python def testself instanc nearestneighbor particl datamodelparticl particlesx generic_unit_systemlength particlesi generic_unit_systemlength particlesz generic_unit_systemlength instanceparticlesadd_particlesparticl instancerun selfassertequalinstanceparticlesneighbor instanceparticl selfassertequalinstanceparticlesneighbor instanceparticl selfassertequalinstanceparticlesneighbor instanceparticl selfassertequalinstanceparticlesneighbor instanceparticl instancestop make run test codeblock bash make clean make nosetest ran test ok done defin object orient interfac legaci interfac look test code seem rather less complex rememb unit compat part amus make complex script easier let make plummer model find nearest neighbor model first make file follow content let call file plummerpi literalinclud nearestneighborplummerpi languag python run file python codeblock bash amuse_diramusesh plummerpi creat outputtxt file show file gnuplot codeblock gnuplot gnuplot splot outputtxt use vector nohead outputtxt use gnuplot zoom center gnuplot set xr gnuplot set yr gnuplot set zr gnuplot splot outputtxt use vector nohead outputtxt use imag nearestneighborplummerpng path defin legaci interfac defin code interfac user add updat delet particl start nearest neighbor find algorithm retriev id nearest neighbor defin interfac open interfacepi favorit editor replac content file literalinclud nearestneighbornnpi gener stub interfac code amuse_dirbuildpi typef modestub interfacepi nearestneighborinterfac interfacef gener interfacef replac origin file gener previou section implement interfacef file modul need add modul definit file ad modul nn line begin file end modul line end file open interfacef file appendprepend follow code codeblock fortran modul nn contain origin code end modul note need remov origin use nn line start file code build function yet make clean make note compil interfac code result lot warn unus dummi argument warn save ignor test broken echo_int function remov codeblock bash nosetest e error test nearestneighbortest_nearestneighbornearestneighborinterfacetest traceback recent call last file srcamusetestamusetestpi line run testmethod file nearestneighbortest_nearestneighborpi line test resulterror instanceecho_int attributeerror nearestneighborinterfac object attribut echo_int ran test fail error let creat work test call new_particl method open editor test_nearestneighborpi file replac test method codeblock python def testself instanc nearestneighborinterfac resulterror instancenew_particl selfassertequalserror selfassertequalsresult instancestop python code need rebuild code instead run test right save code unfortun run test still fail codeblock bash nosetest f fail test nearestneighbortest_nearestneighbornearestneighborinterfacetest traceback recent call last file srcamusetestamusetestpi line run testmethod file nearestneighbortest_nearestneighborpi line test selfassertequalsresult file srcamusetestamusetestpi line failunlessequ self_raise_exceptions_if_anyfailur first second msg file srcamusetestamusetestpi line _raise_exceptions_if_ani rais selffailureexceptionmsg err_fmt_stringformatfirst second arg assertionerror begin captur log legaci info start call nearestneighborinterfacenew_particl legaci info end call nearestneighborinterfacenew_particl end captur log ran test look close output test see result method except need edit fortran code make test work open editor interfacef go new_particl function codeblock fortran function new_particleindex_of_the_particl x z integ index_of_the_particl doubl precis x z index_of_the_particl new_particl end function note amus interfac function return errorcod return valu must pass argument function need rebuild code build run test codeblock bash make nosetest ran test ok test work real work legaci code fill stub implement algorithm match interfac defin creat need write glue code connect code interfac fill stub gener earlier open interfacef file favorit editor chang content literalinclud nearestneighborinterfacef languag fortran test code build tri legaci interfac directori make clean make test still fail need set maximum_number_of_particl alloc new particl let updat test open editor test_nearestneighborpi file updat test method codeblock python def testself instanc nearestneighborinterfac instanceset_maximum_number_of_particl instancecommit_paramet resulterror instancenew_particl selfassertequalserror selfassertequalsresult instancestop test succeed codeblock bash nosetest ran test ok let check functionali ad anoth test codeblock python def testself instanc nearestneighborinterfac instanceset_maximum_number_of_particl instancecommit_paramet resulterror instancenew_particl selfassertequalserror selfassertequalsresult resulterror instancenew_particl selfassertequalserror selfassertequalsresult resulterror instancenew_particl selfassertequalserror error instancedelete_particl selfassertequalserror resulterror instancenew_particl selfassertequalserror selfassertequalsresult instancestop test succeed codeblock bash nosetest ran test ok done everyth step legaci interfac legaci code access python script interfac friendli work think errorcod inform unit make interfac easier work start defin method properti paramet defin method object orient interfac also defin interfacepi continu open editor file write method nearestneighbor class editor seek code end file class nearestneighborincodecomponentimplement def __init__self option incodecomponentimplementation__init__self nearestneighborinterfac option start defin method implement define_method function like class nearestneighborincodecomponentimplement def __init__self option incodecomponentimplementation__init__self nearestneighborinterfac option def define_methodsself builder builderadd_method new_particl generic_unit_systemlength generic_unit_systemlength generic_unit_systemlength builderindex buildererror_cod builderadd_method delete_particl builderindex buildererror_cod builderadd_method get_stat builderindex generic_unit_systemlength generic_unit_systemlength generic_unit_systemlength buildererror_cod public_nam get_posit builderadd_method set_stat builderindex generic_unit_systemlength generic_unit_systemlength generic_unit_systemlength buildererror_cod public_nam set_posit builderadd_method run buildererror_cod builderadd_method get_close_neighbor builderindex builderlinkparticl builderlinkparticl builderlinkparticl buildererror_cod builderadd_method get_nearest_neighbor builderindex builderlinkparticl generic_unit_systemlength buildererror_cod builderadd_method get_number_of_particl builderno_unit buildererror_cod code defin method specifi interpret argument return valu get special object builder object provid us add_method function abl definit add_method function follow add_method name origin function legaci interfac list argument unit type list return valu public_nam name user class option everi argument return valu specifi unit special special argument definit descript buildererror_cod valu interpret errorcod zero mean error valu except rais valid one return valu builderno_unit valu unit exampl number item list builderindex valu interpret index object identifi builderlinkparticl valu interpret link object set given name test code build tri legaci interfac directori make clean make let add anoth test def testself instanc nearestneighbor instanceset_maximum_number_of_particl instancecommit_paramet result instancenew_particl generic_unit_systemlength generic_unit_systemlength generic_unit_systemlength selfassertequalsresult result instancenew_particl generic_unit_systemlength generic_unit_systemlength generic_unit_systemlength selfassertequalsresult xyz instanceget_posit selfassertequ generic_unit_systemlength x selfassertequ generic_unit_systemlength selfassertequ generic_unit_systemlength z instancestop run test codeblock bash nosetest ran test ok see script littl simpler support unit think errorcod script amus interpret errorcod rais right except need unit also automat convert right unit code script still easi manag id get code make code even easier handl continu defin set note skip defin paramet properti come back later tutori defin set made interfac littl easier still manag work script would like work object ad remov object code amus support defin set set capabl store specif attribut object set code capabl store x z posit object object amus call particl set contain particl call particleset shorter particl defin particl set implement define_particle_set function nearestneighbor class like class nearestneighborincodecomponentimplement def __init__self option incodecomponentimplementation__init__self nearestneighborinterfac option def define_methodsself builder def define_particle_setsself builder builderdefine_setparticl index_of_the_particl builderset_newparticl new_particl builderset_deleteparticl delete_particl builderadd_setterparticl set_posit builderadd_getterparticl get_posit builderadd_getterparticl get_close_neighbor namesneighbor neighbor neighbor that defin set call particl get builder object use defin set method name set first argument name name want amus code provid set call particl add_sett add_gett set_new set_delet function second argument name method defin previou step final set name attribut particl set name argument option legaci function given name attribut deriv name argument origin call exampl get_posit call specifi earlier paramet name x z name also use particl set test code build tri legaci interfac directori make clean make let add anoth test def testself instanc nearestneighbor instanceset_maximum_number_of_particl instancecommit_paramet particl datamodelparticl particlesx generic_unit_systemlength particlesi generic_unit_systemlength particlesz generic_unit_systemlength instanceparticlesadd_particlesparticl instancerun selfassertequalinstanceparticlesneighbor instanceparticl selfassertequalinstanceparticlesneighbor instanceparticl selfassertequalinstanceparticlesneighbor instanceparticl selfassertequalinstanceparticlesneighbor instanceparticl instancestop support particl set mean also interact part amus let make plummer model find nearest neighbor model first make file follow content let call file plummerpi literalinclud nearestneighborplummerpi languag python run file python codeblock bash amuse_diramusesh plummerpi creat outputtxt file show file gnuplot codeblock gnuplot gnuplot splot outputtxt use vector nohead outputtxt use gnuplot zoom center gnuplot set xr gnuplot set yr gnuplot set zr gnuplot splot outputtxt use vector nohead outputtxt use imag nearestneighborplummerpng use blender visualis amus result imag blenderjpeg width cm blender blender free open sourc content creation suit gpled specialis visualis content scriptabl python provid handi tool visualis amus data inform blender found httpswwwblenderorg start blender start blender command line assum environ variabl set amus make sure mpd run codeblock bash blender blender open press ctrlrightcursor three time open text panel next view text panel use text menu item open text file imag blenderopenscriptpng width align center way retriev script written go write new script use favourit editor finish load script use method describ note default blender place cube scene delet els obscur sun exampl script base sunearth test hermit start amus script add coupl line commun blender mark comment exampl amus blender api simplifi commun blender amus modul amuseextblend contain basic api exampl start import top regular stellar dynam import codeblock python amuseextblend import blender creat sphere eg sun segment ring radiu current scene type codeblock python sun blenderprimitivessphereseg ring radiu move rotat object use codeblock python xyz alpha sunloc x z sunrotz alpha hermit sunearth model blender visualis becom like literalinclud examplesapplicationstest_blenderpi path exampl code amusedirtrunkexamplesapplicationstest_blenderpi save file mynamepi open blender run type altp cursor editor imag blenderrunscriptpng width align center creat lowlevel interfac code tutori creat interfac code warn tutori use build script provid amus file directori need creat hand use tutori want get deeper understand build process work step involv creat low level interfac learn creat interfac code recommend docc_cod docfortran_cod work directori start make directori code directori subdirectori srcamusecommun directori also python packag need creat file __init__pi directori let open shell go amus root directori creat code directori codeblock bash cd srcamusecommun mkdir mycod cd mycod touch __init__pi pwd srcamusecommunitymycod ls __init__pi code creat interfac first need code exampl use simpl code calcul two number content codec file codeblock cpp includ codeh doubl sumdoubl x doubl return x int dividedoubl x doubl doubl result ifi return els result x return need access function anoth c file need defin header file content codeh file codeblock cpp doubl sumdoubl x doubl int dividedoubl x doubl doubl result interfac code defin interfac class code python interfac need inherit class codeinterfac codeblock python lineno amusecommun import class mycodecodeinterfac include_head codeh def __init__self codeinterface__init__self exampl first import name amusecommun modul line amusecommun modul defin typic class function need write legaci interfac line defin class inherit codeinterfac class use gener c file file need definit legaci function line specifi necessari includ file array string string convert includ statement build code build code take coupl step first gener c file compil code construct makefil autom build process codeblock make lineno ifndef amuse_dir amuse_dir endif code_gener amuse_dirbuildpi cxxflag wall g dtoolbox muse_include_dir ldflag lm muse_ld_flag obj codeo worker_cod cleanal clean rm worker_cod clean rm f pyc worker_codecc worker_codecc interfacepi code_gener typec interfacepi mycod worker_cod worker_codecc obj mpicxx cc obj cco g cxxflag c co g cxxflag c compound need convert space tab copi text new file let start make build worker_cod applic codeblock bash make clean make mpicxx worker_codecc codeo worker_cod ls worker_cod run code run code need start mpi daemon process mpd daemon process manag start child process codeblock bash mpd use amusesh tri interfac codeblock pycon amusecommunitymycod import interfac instanc interfacemycod instanc amusecommunitymycodeinterfacemycod object xfabfb del instanc defin method interfac class use creat instanc code creat instanc worker_cod applic start handl function call see applic run ps x grep worker_cod implement method defin sum method add definit mycod class codeblock python lineno amusecommun import class mycodecodeinterfac include_head codeh def __init__self codeinterface__init__self legacy_funct def sum function legacyfunctionspecif functionaddparameterx functionin functionaddparameteri functionin functionresult_typ return function new code start line line specifi decor decor convert follow function specif use call function gener c code line give function name function code function may argument line creat instanc legacyfunctionspecif class class method specifi intercas line specifi paramet function paramet name type direct type specifi singl charact type code follow type code defin type code c type fortran type int integ doubl doubl precis f float singl precis direct paramet inout line defin return type type code none default valu none specifi return valu void function let rebuild code codeblock bash make clean make mpicxx worker_codecc codeo worker_cod start amusesh simpl sum codeblock pycon amusecommunitymycod import interfac instanc interfacemycod instancesum del instanc see interfac correctli sum two number method paramet complet interfac defin divid function codeblock python lineno amusecommun import class mycodecodeinterfac include_head codeh def __init__self codeinterface__init__self legacy_funct def sum function legacyfunctionspecif functionaddparameterx functionin functionaddparameteri functionin functionresult_typ return function legacy_funct def divid function legacyfunctionspecif functionaddparameterx functionin functionaddparameteri functionin functionaddparameterresult functionout functionresult_typ return function line defin paramet result paramet python provid paramet argument function rebuild tri new function codeblock pycon amusecommunitymycod import interfac instanc interfacemycod result error instancedivid result error del instanc see function return two valu paramet also return valu function work array function call perform element array exampl codeblock pycon amusecommunitymycod import interfac instanc interfacemycod x_valu y_valu result x mapnon x_valu y_valu resultsappendinstancesumxi print result mpi messag pass overhead incur everi call method chang specifi function abl handl array codeblock python lineno amusecommun import class mycodecodeinterfac include_head codeh def __init__self codeinterface__init__self legacy_funct def sum function legacyfunctionspecif functionaddparameterx functionin functionaddparameteri functionin functionresult_typ functioncan_handle_array true return function line specifi function call array valu function call everi element array array send one mpi messag reduc overhead let rebuild code run exampl codeblock pycon amusecommunitymycod import interfac instanc interfacemycod x_valu y_valu result instancesumx_valu y_valu print result interfac commun code directori contain number code pleas look code see interfac defin _working_with_unit work unit amus framework provid unit handl librari librari use throughout amus framework interact code data unit even scale system unit quantiti basic data object quantiti quantiti made valu unit valu singl number scalar quantiti multidimension array vector quantiti quantiti creat bar oper quantiti use like number lot numpi function also work quantiti codeblock python amuseunitssi import amuseunitscor import named_unit weigth kg person print total weight person weigth total weight kg day named_unitday weight_loss kg day print weight loss weight_loss weight loss e kg print weight loss weight_lossas_quantity_inkgday weight loss kg work array vector quantiti use like python list take care put quantiti vector quantiti vector quantiti behav like numpi array like python list numer oper oper elementwis also initi numpi array codeblock python amuseunitsunit import msun mass msun rang massesappendi msun print mass mass mass msun note work array care must taken ensur vector quantiti creat array quantiti follow code creat array quantiti amuseunitsunit import msun mass rang massesappendi msun print mass mass mass quantiti msun quantiti msun integr c code tutori creat amus interfac c code first defin legaci interfac implement code final build object orient interfac top legaci interfac legaci code simpl naiv implement find nearest neighbor particl legaci code interfac support method transfer valu code valu unit error handl provid interfac add error handl unit handl function legaci interfac defin subclass incodecomponentimplement object orient interfac graphviz digraph layer fontsiz rankdirlr node fontsiz shapebox stylefil fillcolorlightyellow legaci code legaci interfac object orient interfac script legaci code tutori simpl naiv implement find nearest neighbor particl two path defin interfac walk path manag particl amus python manag particl code c fortran first path make sens legaci code perform transform particl analys particl state store intern state function call data extern everi function code data everi particl send code expect multipl call code would incur high commun overhead better choos path second path make sens code alreadi manag particl grid want call multipl function code need send complet model code everi function call code first given data call made code evolv model perform reduct step data final updat data retriev code procedur suggest procedur creat new interfac follow legaci interfac start creat legaci interfac defin function interfac input output relev data incodecomponentimplement code depend legaci interfac code make class creat subclass incodecomponentimplement class defin method legaci interfac defin function paramet code interfac need defin unit paramet paramet return valu use errorcod defin properti function legaci interfac better describ properti code read variabl like current model time defin paramet function legaci interfac provid access paramet code unit default valu need defin paramet step defin set grid code usual handl object gridpoint attribut step gener interfac defin object interoper code increas start tutori assum work amus develop build pleas ensur amus setup correctli run nosetest amus directori environ variabl simplifi work come section first defin environ variabl amuse_dir environ variabl must point root directori amus directori contain buildpi script codeblock bash export amuse_dirpath amus root directori c shell codeblock csh setenv amuse_dir path amus root directori build code want run test code check amus avail python path run follow code command line codeblock bash python c import amus traceback recent call last file string line modul importerror modul name amus code end importerror shown exampl pythonpath environ variabl must extend src directori amuse_dir use one follow command codeblock bash export pythonpathpythonpathamuse_dirsrc c shell codeblock csh setenv amuse_dir pythonpathamuse_dirsrc name project write code find nearest neighbor particl let call project nearestneighbor creat initi directori structur first need creat directori project put file help build code fastest method setup directori use buildpi script codeblock bash amuse_dirbuildpi typec modedir nearestneighbor script gener directori file need start project also gener small exampl legaci code one function echo_int build test new modul cd nearestneighbor make amuse_diramusesh c interfac import nearestneighbor print nearestneighborecho_int ordereddictionaryint_out __result nosetest v ran test ok note buildpi script use gener rang file see file run script help paramet like amuse_dirbuildpi help legaci code normal legaci code alreadi exist task limit defin implement interfac amus script access code tutori implement legaci code legaci code integr interfac code put one directori legaci code put src directori place directori buildpi script creat src directori us put nearest neighbor algorithm directori go src directori creat codecc file open file favorit editor copi past code literalinclud nearestneighborcodecc languag c note algorithm unoptim nn order meant effici code readabl exampl continu also need alter makefil src directori codecc file includ build open editor makefil chang line codeobj testo codeobj testo codeo test code build coupl algorithm interfac even defin interfac new function legaci interfac directori src directori codeblock bash make nosetest ran test ok work test fail reason pleas check c code correct worker_cod exist directori path defin legaci interfac first defin legaci interfac call find_nearest_neighbor function python amus interact class function function scalar input output variabl variabl simpl noncomposit variabl like int doubl exampl codeblock c int exampledoubl input doubl output output input return function vector list input output variabl length variabl return valu scalar valu exampl codeblock c int exampledoubl input doubl output int n forint n outputi inputi return function dont follow pattern need defin convert function c provid interfac follow one two pattern support amus case find_nearest_neighbor compli pattern write code c convert function compliant interfac specifi function python ad find_nearest_neighbor method nearestneighborinterfac class interfacepi file open editor interfacespi file add follow method nearestneighborinterfac class codeblock python class nearestneighborinterfaceincodecomponentimplement legacy_funct def find_nearest_neighbor function legacyfunctionspecif functionmust_handle_array true functionaddparamet npoint dtypeint directionfunctionlength functionaddparamet x dtypefloat directionfunctionin functionaddparamet dtypefloat directionfunctionin functionaddparamet z dtypefloat directionfunctionin functionaddparamet n dtypeint directionfunctionout functionaddparamet n dtypeint directionfunctionout functionaddparamet n dtypeint directionfunctionout functionresult_typ int return function find_nearest_neighbor method specifi everi paramet c function result type paramet need defin name data type whether input output input output data use paramet amus know limit amount data type paramet float float int string bool int also special paramet length direct paramet need function follow pattern fill length input array also must specifi function follow pattern set functionmust_handle_array true save file recompil code codeblock bash make clean make nosetest ran test ok work know find_nearest_neighbor method realli work let write test find open editor test_nearestneighborpi file add follow method nearestneighborinterfacetest class codeblock python def testself instanc nearestneighborinterfac x lenx z lenx n n n error instancefind_nearest_neighborsxyz selfassertequalserror selfassertequalsn selfassertequalsn selfassertequalsn instancestop test call find_nearest_neighbor method posit check nearest neighbor determin correctli let run test see everyth work codeblock bash nosetest ran test ok simpl interfac work index call could send data unit method also error check method let defin object orient interfac solv problem defin object orient interfac object orient interfac sit top legaci interfac decor interfac set unit handl state engin start creat object orient interfac inherit incodecomponentimplement write __init__ function build script ad class interfacepi file us open editor interfacepi make sure code file end file codeblock python class nearestneighborincodecomponentimplement def __init__self option incodecomponentimplementation__init__self nearestneighborinterfac option configur handler configur object orient interfac implement sever method object orient interfac implement sever handler handler provid support specif aspect interfac amus defin handler unit convers handler interfac set particl handler ensur method call right order etc handler gener need configur use handler configur use visitor pattern follow pseudocod show handler configur codeblock python class incodecomponentimplementationobject def configure_handlersself handler selfget_all_handl handlerconfigureself def define_converterself handler configur unit convert handler handlerset_nbody_convert def define_particle_setsself handler configur set particl handlerdefine_incode_particle_set handlerset_gett class handleconvertunitsabstracthandl def configureself interfac interfacedefine_converterself class handleparticlesabstracthandl def configureself interfac interfacedefine_particle_setsself configur handler option defin handler need interfac exampl need configur handlemethodswithunit handler defin unit error handl handleparticl defin particl set defin method unit first want add unit error handl find_nearest_neighbor creat define_method function nearestneighbor class open editor interfacepi add method class codeblock python def define_methodsself handler handleradd_method find_nearest_neighbor generic_unit_systemlength generic_unit_systemlength generic_unit_systemlength handlerindex handlerindex handlerindex handlererror_cod add_method call expect name function legaci interfac first next expect list unit input paramet list unit output paramet return valu function alway last item list output paramet specifi generic_unit_systemlength unit x z paramet output paramet indic errorcod errorcod handl amus interfac mean success mean rais except let write test see work open editor test_nearestneighborpi class add method codeblock python def testself instanc nearestneighbor x generic_unit_systemlength lenx generic_unit_systemlength z lenx generic_unit_systemlength n n n instancefind_nearest_neighborsxyz selfassertequalsn selfassertequalsn selfassertequalsn instancestop note test look lot like test defin unit need handl errorcod build test code codeblock bash make clean make nosetest ran test ok note although edit python code still need run make code check worker_cod execut date everi run detect updat broke code still demand code rebuilt defin particl set particl set amus handl python call inmemori legaci code call incod case code handl particl need configur particl handler manag inmemori particl set open editor interfacepi add method nearestneighbor class codeblock python def define_particle_setsself object objectdefine_inmemory_setparticl that particl attribut class add remov delet particl set still miss connect particl nearest neighbor amus provid handler instead write method run find_nearest_neighbor function set indic particl set open editor interfacepi add method nearestneighbor class codeblock python def runself indic indic indic selffind_nearest_neighbor selfparticlesx selfparticlesi selfparticlesz selfparticlesneighbor listselfparticlesindic selfparticlesneighbor listselfparticlesindic selfparticlesneighbor listselfparticlesindic function get x z attribut particl set send find_nearest_neighbor method method return list indic need find particl indic note particl set given sequenc delet addit particl chang order particl set therefor never good idea use index particl set refer particl howev run method particl set chang find_nearest_neighbor call moment find particl set index use selfparticlesindic case save use index valid refer let write test see work open editor test_nearestneighborpi class add method codeblock python def testself instanc nearestneighbor particl datamodelparticl particlesx generic_unit_systemlength particlesi generic_unit_systemlength particlesz generic_unit_systemlength instanceparticlesadd_particlesparticl instancerun selfassertequalinstanceparticlesneighbor instanceparticl selfassertequalinstanceparticlesneighbor instanceparticl selfassertequalinstanceparticlesneighbor instanceparticl selfassertequalinstanceparticlesneighbor instanceparticl instancestop make run test codeblock bash make clean make nosetest ran test ok done defin object orient interfac legaci interfac look test code seem rather less complex rememb unit compat part amus make complex script easier let make plummer model find nearest neighbor model first make file follow content let call file plummerpi literalinclud nearestneighborplummerpi languag python run file python codeblock bash amuse_diramusesh plummerpi creat outputtxt file show file gnuplot codeblock gnuplot gnuplot splot outputtxt use vector nohead outputtxt use gnuplot zoom center gnuplot set xr gnuplot set yr gnuplot set zr gnuplot splot outputtxt use vector nohead outputtxt use imag nearestneighborplummerpng path defin legaci interfac defin code interfac user add updat delet particl start nearest neighbor find algorithm retriev id nearest neighbor defin interfac open interfacepi favorit editor replac content file literalinclud nearestneighbornnpi gener stub interfac code amuse_dirbuildpi typec modestub interfacepi nearestneighborinterfac interfacecc gener interfacecc replac origin file gener previou section code build function yet make clean make note compil interfac code result lot warn unus dummi argument warn safe ignor test broken echo_int function remov codeblock bash nosetest e error test nearestneighbortest_nearestneighbornearestneighborinterfacetest traceback recent call last file srcamusetestamusetestpi line run testmethod file nearestneighbortest_nearestneighborpi line test resulterror instanceecho_int attributeerror nearestneighborinterfac object attribut echo_int ran test fail error let creat work test call new_particl method open editor test_nearestneighborpi file replac test method codeblock python def testself instanc nearestneighborinterfac resulterror instancenew_particl selfassertequalserror selfassertequalsresult instancestop python code need rebuild code instead run test right save code unfortun run test still fail codeblock bash nosetest f fail test nearestneighbortest_nearestneighbornearestneighborinterfacetest traceback recent call last file srcamusetestamusetestpi line run testmethod file nearestneighbortest_nearestneighborpi line test selfassertequalsresult file srcamusetestamusetestpi line failunlessequ self_raise_exceptions_if_anyfailur first second msg file srcamusetestamusetestpi line _raise_exceptions_if_ani rais selffailureexceptionmsg err_fmt_stringformatfirst second arg assertionerror begin captur log legaci info start call nearestneighborinterfacenew_particl legaci info end call nearestneighborinterfacenew_particl end captur log ran test look close output test see result method expect need edit c code make test work open editor interfacecc go new_particl function codeblock c int new_particleint index_of_the_particl doubl x doubl doubl z index_of_the_particl return note amus interfac function return errorcod return valu must pass argument function need rebuild code build run test codeblock bash make nosetest ran test ok test work real work legaci code fill stub implement algorithm match interfac defin creat need write glue code connect code interfac fill stub gener earlier open interfacecc file favorit editor chang content literalinclud nearestneighborinterfacecc languag c test code build tri legaci interfac directori codeblock bash make clean make nosetest ran test ok let check function ad anoth test codeblock python def testself instanc nearestneighborinterfac resulterror instancenew_particl selfassertequalserror selfassertequalsresult resulterror instancenew_particl selfassertequalserror selfassertequalsresult resulterror instancenew_particl selfassertequalserror error instancedelete_particl selfassertequalserror resulterror instancenew_particl selfassertequalserror selfassertequalsresult instancestop test succeed codeblock bash nosetest ran test ok done everyth step legaci interfac legaci code access python script interfac friendli work think errorcod inform unit make interfac easier work start defin method properti paramet defin method object orient interfac also defin interfacepi continu open editor file write method nearestneighbor class editor seek code end file class nearestneighborcodeinterfac def __init__self option codeinterface__init__self nearestneighborinterfac option start defin method implement define_method function like class nearestneighborcodeinterfac def __init__self option codeinterface__init__self nearestneighborinterfac option def define_methodsself builder builderadd_method new_particl generic_unit_systemlength generic_unit_systemlength generic_unit_systemlength builderindex buildererror_cod builderadd_method delete_particl builderindex buildererror_cod builderadd_method get_stat builderindex generic_unit_systemlength generic_unit_systemlength generic_unit_systemlength buildererror_cod public_nam get_posit builderadd_method set_stat builderindex generic_unit_systemlength generic_unit_systemlength generic_unit_systemlength buildererror_cod public_nam set_posit builderadd_method run buildererror_cod builderadd_method get_close_neighbor builderindex builderlinkparticl builderlinkparticl builderlinkparticl buildererror_cod builderadd_method get_nearest_neighbor builderindex builderlinkparticl generic_unit_systemlength buildererror_cod builderadd_method get_number_of_particl builderno_unit buildererror_cod code defin method specifi interpret argument return valu get special object builder object provid us add_method function abl definit add_method function follow add_method name origin function legaci interfac list argument unit type list return valu public_nam name user class option everi argument return valu specifi unit special special argument definit descript buildererror_cod valu interpret errorcod zero mean error valu except rais valid one return valu builderno_unit valu unit exampl number item list builderindex valu interpret index object identifi builderlinkparticl valu interpret link object set given name test code build tri legaci interfac directori make clean make let add anoth test codeblock python def testself instanc nearestneighbor instanceset_maximum_number_of_particl instancecommit_paramet result instancenew_particl generic_unit_systemlength generic_unit_systemlength generic_unit_systemlength selfassertequalsresult result instancenew_particl generic_unit_systemlength generic_unit_systemlength generic_unit_systemlength selfassertequalsresult xyz instanceget_posit selfassertequ generic_unit_systemlength x selfassertequ generic_unit_systemlength selfassertequ generic_unit_systemlength z instancestop run test codeblock bash nosetest ran test ok see script littl simpler support unit think errorcod script amus interpret errorcod rais right except need unit also automat convert right unit code script still easi manag id get code make code even easier handl continu defin set note skip defin paramet properti come back next tutori defin set made interfac littl easier still manag work script would like work object ad remov object code amus support defin set set capabl store specif attribut object set code capabl store x z posit object object amus call particl set contain particl call particleset shorter particl defin particl set implement define_particle_set function nearestneighbor class like class nearestneighborincodecomponentimplement def __init__self option incodecomponentimplementation__init__self nearestneighborinterfac option def define_methodsself builder def define_particle_setsself builder builderdefine_setparticl index_of_the_particl builderset_newparticl new_particl builderset_deleteparticl delete_particl builderadd_setterparticl set_posit builderadd_getterparticl get_posit builderadd_getterparticl get_close_neighbor namesneighbor neighbor neighbor that defin set call particl get builder object use defin set method name set first argument name name want amus code provid set call particl add_sett add_gett set_new set_delet function second argument name method defin previou step final set name attribut particl set name argument option legaci function given name attribut deriv name argument origin call exampl get_posit call specifi earlier paramet name x z name also use particl set test code build tri legaci interfac directori make clean make let add anoth test def testself instanc nearestneighbor instanceset_maximum_number_of_particl instancecommit_paramet particl datamodelparticl particlesx generic_unit_systemlength particlesi generic_unit_systemlength particlesz generic_unit_systemlength instanceparticlesadd_particlesparticl instancerun selfassertequalinstanceparticlesneighbor instanceparticl selfassertequalinstanceparticlesneighbor instanceparticl selfassertequalinstanceparticlesneighbor instanceparticl selfassertequalinstanceparticlesneighbor instanceparticl instancestop support particl set mean also interact part amus let make plummer model find nearest neighbor model first make file follow content let call file plummerpi literalinclud nearestneighborplummerpi languag python run file python codeblock bash amuse_diramusesh plummerpi creat outputtxt file show file gnuplot codeblock gnuplot gnuplot splot outputtxt use vector nohead outputtxt use gnuplot zoom center gnuplot set xr gnuplot set yr gnuplot set zr gnuplot splot outputtxt use vector nohead outputtxt use imag nearestneighborplummerpng _tutorialslabel tutori toctre maxdepth unit most_massive_from_salpet particle_set c_code fortran_cod gravitational_dynamics_cod legacy_cod plot grid_boundari document work particl set imag setspng width cm set subset particl children parent fundament data structur use amus particl set base attribut element set particl select made use select method return subset subset view scope set hold valu also possibl add structur set defin parentchild relationship particl set structur exist set properti mean respect particl outsid set select star plummer model tutori gener set star plummer model two subset star first subset contain star within certain radiu center mass plummer system second subset contain star plummer modul gener particl set form datamodelstarsn import start amus import python shell core modul contain set object unit nbody_system need correct assign properti particl need quantiti codeblock python amus import datamodel amuseunit import nbody_system amuseunit import unit amuseicplumm import new_plummer_spher import numpi model note quick way look set go make use gnuplot gnuplot instal gnuplotpi packag control gnuplot directli script instal gnuplotpi open shell easy_instal gnuplotpi let gener plummer model consist star codeblock python convert_nbodi nbody_systemnbody_to_si unitsmsun unitsparsec plummer new_plummer_spher convert_nbodi work new plummer particl set want keep set unchang copi data work set codeblock python star plummercopi note look star gnuplot plotter gnuplotgnuplot plottersplotplummerpositionvalue_inunitsparsec imag setsplummerpng select stage select subset base distanc individu star respect center mass parsec exampl need center mass cours codeblock python center_of_mass starscenter_of_mass select set codeblock python innerspher starsselectlambda r center_of_massrlength unitsparsecposit outerspher starsselectlambda r center_of_massrlength unitsparsecposit note look star gnuplot plotter gnuplotgnuplot plottersplotouterspherepositionvalue_inunitsparsec innerspherepositionvalue_inunitsparsec imag setsplummerpng achiev result anoth way use fact outerspher differ innerspher set star set codeblock python outersphere_alt starsdifferenceinnerspher use particl subtract oper codeblock python outersphere_alt star innerspher select subset verifi codeblock python outerspher doctestellipsi amusedatamodelparticlesparticlessubset object set oper result well check codeblock python hopefully_empti outerspheredifferenceoutersphere_alt hopefully_emptyis_empti true lenouterspher outersphere_alt true select criteria would expect select star check could someth like codeblock python leninnerspherelenouterspher true leninnerspherelenoutersphere_alt true leninnerspherelenoutersphere_alt true union innerspher outerspher set give star set check codeblock python like_star innersphereunionouterspher starsdifferencelike_starsis_empti true innerspher outersphere_alt starsis_empti true iter iter set put use check whether realli select right star outerspher codeblock python should_not_be_there_star star outerspher center_of_massstarpositionlengthunitsparsec should_not_be_there_star should_not_be_there_star index set like cando use code channel imag channelspng width cm align center imagin evalu star mpi bound legaci code want know happen star subset queri attribut de code set invok one mpi call ineffici mani queri copi entir set model howev cost one mpi call queri model set without mpi overhead copi data one exist set anoth set subset done via channel first defin simpl dummi legaci code object typic gd interfac method codeblock python class dummylegacycodeobject def __init__self selfparticl datamodelparticl def add_particlesself new_particl selfparticlesadd_particlesnew_particl def update_particlesself particl selfparticlescopy_values_of_attributes_tox z mass particl particl selfparticlescopi def evolveself selfparticlesposit instanti code use evolv expand plummer model add channel innerspher subset track chang codeblock python code dummylegacycod channel_to_innerspher codeparticlesnew_channel_toinnerspher codeadd_particlesstar codeevolv r_inner_init innersphereposit r_outer_init outersphereposit channel_to_innerspherecopi r_inner_fini innersphereposit r_outer_fini outersphereposit check chang look posit chang evolv see innerspher particl updat codeblock python numpyallr_inner_initr_inner_fini fals numpyallr_outer_initr_outer_fini true want updat particl model use codeblock python codeupdate_particlesstar check codeblock python r_outer_fini outersphereposit numpyallr_outer_init r_outer_fini fals particl hierarchi imag childrenpng width cm let us suppos zeroth star star child grandchild star belong plummer model codeblock python child_star datamodelparticl grandchild_star datamodelparticl child_starmass unitsmsun child_starposit unitsau child_starveloc unitsaud grandchild_starmass unitsmsun grandchild_starposit unitsau grandchild_starveloc unitsaud add child grandchild etc set plummer star first add set regular star codeblock python child_star_in_set starsadd_particlechild_star grandchild_star_in_set starsadd_particlegrandchild_star defin hierarchi codeblock python starsadd_childchild_star_in_set child_star_in_setadd_childgrandchild_star_in_set descend star form subset codeblock python starsdescend doctestellipsi amusedatamodelparticlessubset object starschildrenmassvalue_inunitsmsun array starsdescendentsmass quantity e kg method retreiv physic properti particl set particl set number function calcul physic properti appli set although might implement legaci code well use via particl set guarante applic particl multipl legaci code use furthermor particl set function provid uniform way calcul speed might downsid automodul amusedatamodelparticle_attribut autofunct center_of_mass noindex autofunct center_of_mass_veloc noindex autofunct kinetic_energi noindex autofunct potential_energi noindex autofunct particle_specific_kinetic_energi noindex autofunct particle_potenti noindex ad gravit dynam code previou tutori seen creat amus interfac c fortran code scratch tutori expand number addit featur implement simpl gravit dynam code tutori deal featur python interfac restrict legaci code exampl c concept describ easili appli interfac fortran code also assum work environ set previou exampl thu creat initi directori structur new code simplegrav follow termin command codeblock bash amuse_dirbuildpi typec modedir simplegrav legaci code exampl use simpl forward eulerian integr routin legaci code simpli function take initi condit set particl form seven dynam array integ contain number particl doubl precis scalar contain time step smooth length gravit constant output new particl posit veloc updat input array literalinclud simplegravsimplegravcc languag c note like previou tutori exampl algorithm mean particularli good fact forward eulerian integr might worst method integr gravit system due tendenc energi diverg use readabl exampl simpli put script src directori codecc chang makefil line codeobj testo codeobj testo codeo interfac templat order promot uniform among interfac make easier creat interfac number type code interfac templat class number function common type code alreadi defin found folder srcamusecommunityinterfac main amus github repositori gravit dynam one type code templat interfac defin gdpi use templat inherit codeblock python amusecommunityinterfacegd import gravitationaldynam amusecommunityinterfacegd import gravitationaldynamicsinterfac class simplegravinterfacecodeinterfac gravitationaldynamicsinterfac class simplegravgravitationaldynam legaci interfac contain legaci function defin gdpi includ ad delet particl get set particl properti mass posit veloc acceler radiu get set paramet smooth length begin time host function definit simplegravinterfac simpli codeblock python class simplegravinterfacecodeinterfac gravitationaldynamicsinterfac include_head worker_codeh def __init__ self keyword_argu codeinterface__init__self name_of_the_workersimplegrav_work keyword_argu note compil interfac inherit gravitationaldynamicsinterfac legaci function defin parent class commoncodeinterfac must defin c interfac simpli let return error valu object orient interfac similarli contain definit method properti particl set paramet state latter discuss later definit simpli codeblock python class simplegravgravitationaldynam def __init__self convert_nbodi none keyword_argu gravitationaldynamics__init__self simplegravinterfacekeyword_argu convert_nbodi keyword_argu note convert_nbodi keyword appear initi use handl convers unit legaci code objectori interfac gravit dynam interfac templat assum legaci code work dimensionless nbodi unit pass convert_nbodi instanc unit convers handl automat part left write function version c interfac mention must contain correspond function legaci function also note gravitationaldynamicsinterfac inherit yet anoth interfac commoncodeinterfac contain four legaci function defin gener function mostli concern code logist implement whether even necessari depend legaci code need simpli return case legaci code cleanup_cod actual function often call automat need state model discuss four function commoncod plu three similar function gravitationaldynam describ tabl definit descript initialize_cod code must execut code initi paramet set particl ad grid initi etc cleanup_cod code must execut code stop typic free memori alloc code commit_paramet initi must done depend paramet exampl alloc memori grid recommit_paramet similar commit_paramet commit_paramet call could redefinit grid commit_particl initi must done depend particl exampl construct tree kind set particl recommit_particl similar commit_particl commit_particl call could addit remov particl tree synchronize_model evolv particl time differ time follow code contain definit legaci function although nonessenti function return error valu literalinclud simplegravinterface_cc languag c properti paramet properti amus code readonli quantiti code contain inform often physic state code exampl includ current model time potenti kinet energi total system paramet amus code quantiti use intern work code exampl includ time step type evolut code metal stellar evolut code often alway writabl defin objectori interfac define_properti define_paramet function properti ad follow codeblock python def define_propertiesself handler handleradd_propertyget_properti public_nameproperty_nam get_properti legaci interfac function return singl valu public_nam option argument defin properti call given name paramet legaci function use properti access directli properti code object codeblock python graviti simplegrav the_current_tim gravitymodel_tim paramet ad follow codeblock python def define_parametersself handler handleradd_method_paramet get_paramet set_paramet paramet paramet default_valu some_unit is_vector bool must_set_before_get bool get_paramet set_paramet two legaci interfac function respect one output one input paramet name paramet code fourth paramet document string describ paramet signifi final three option paramet default_valu valu paramet set default is_vector true paramet vector fix length length defin number paramet getter setter scalar paramet one paramet must_set_before_get true paramet must set return case fals note method defin type paramet function purpos add_boolean_paramet paramet boolean instead integerfloat add_caching_paramet paramet set commit_paramet call add_array_paramet paramet array contrast normal paramet is_vectortru getter setter singl argument must abl handl array setter name addit function must pass specifi size array add_alias_paramet also avail add alia exist paramet follow form add_alias_parameteralias_paramet original_paramet paramet document paramet access paramet properti code object codeblock python graviti simplegrav param gravityparametersparamet note properti particl paramet three way commun data legaci code amus complex code necessarili similar code amus might nontrivi manner data commun rule thumb quantiti relat individu particl commun particl properti even conceptu closer paramet demonstr thin line stellar evolut code singl metal star paramet wherea differ star differ metal particl properti paramet properti hand appli system whole paramet alter legaci code wherea properti readonli simplegrav exampl introduc number paramet templat interfac one want time step settabl paramet note definit gdpi none setter function addit want abl set smooth length didact reason includ entir new paramet gravity_strength function scale magnitud gravit forc defin new legaci function set time step get set graviti strength other defin gdpi legaci interfac look follow codeblock python class simplegravinterfacecodeinterfac gravitationaldynamicsinterfac include_head worker_codeh def __init__ self keyword_argu codeinterface__init__self name_of_the_workersimplegrav_work keyword_argu legacy_funct def get_grav_fac function legacyfunctionspecif functionaddparametergrav_fac dtypefloat directionfunctionout functionresult_typ int return function legacy_funct def set_grav_fac function legacyfunctionspecif functionaddparametergrav_fac dtypefloat directionfunctionin functionresult_typ int return function legacy_funct def set_time_step function legacyfunctionspecif functionaddparametertime_step dtypefloat directionfunctionin functionresult_typ int return function objectori interfac overload define_method define_paramet function codeblock python def define_method self handler gravitationaldynamicsdefine_methodsself handler handleradd_method get_grav_fac handlerno_unit handlererror_cod handleradd_method set_grav_fac handlerno_unit handlererror_cod handleradd_method set_time_step nbody_systemtim handlererror_cod handleradd_method get_ep nbody_systemlength nbody_systemlength handlererror_cod handleradd_method set_ep nbody_systemlength nbody_systemlength handlererror_cod def define_paramet self handler gravitationaldynamicsdefine_parametersself handler handleradd_method_paramet get_grav_fac set_grav_fac gravity_strength constant factor g multipli default_valu handleradd_method_paramet get_time_step set_time_step time_step constant integr timestep default_valu nbody_systemtim handleradd_method_paramet get_ep set_ep epsilon_squar smooth paramet graviti calcul default_valu nbody_systemlength nbody_systemlength also call equival function gdpi still inherit templat interfac state model mani legaci code piec logist code must execut physic relev piec code exampl gravit tree code tree must construct particl ad system evolv necessarili evolv call order autom state model defin code defin function run state code also transit state function trigger transit particularli conveni function allow transit thu function associ trigger automat allow aforement tree code automat build tree definit particl set evolut system state code handl automat defin state model describ state code graph node state transit mediat interfac call state model code defin define_st interfac function call follow method handler argument set_initial_statest defin initi entri state given string label usual uniniti add_methodst method_nam defin given method allow state state state string string prepend indic method forbidden state state yet defin ad state model add_transitionst state method_nam is_autotru add transit state state state add state previous defin trigger call interfac function method_nam is_auto argument determin whether transit allow trigger automat method mention add_method allow state doesnt trigger transit state model detect interfac call need state chang tri hop state interfac call allow call transit ad is_autotru possibl dont nondefault argument state model built method state model code print interfacestate_machineto_table_str interfacestate_machineto_plantuml_str note function argument method string evalu later method low level code interfac class must defin need remot function ordinari class method note conveni use number sentinel method default anyth before_get_paramet before_set_paramet before_set_interface_paramet before_new_set_inst before_get_data_store_nam eg before_get_paramet call paramet retriev state model defin code parent class gravitationaldynam grandpar class commoncod code simpl enough need expand thu need defin complet exampl take look state model gravitationaldynam codeblock python def define_stateself handler commoncommoncodedefine_stateself handler handleradd_transitionend initi initialize_cod fals handleradd_transitioninitializededitcommit_paramet handleradd_methodedit new_particl handleradd_methodedit delete_particl handleradd_methodupd new_particl handleradd_methodupd delete_particl handleradd_transitionedit run commit_particl handleradd_transitionrun updat new_particl fals handleradd_transitionrun updat delete_particl fals handleradd_transitionupd run recommit_particl handleradd_transitionrun evolv evolve_model fals handleradd_methodevolv evolve_model handleradd_transitionevolvedrun synchronize_model note entri state defin commoncod shorten readabl let focu happen add particl evolv time see evolve_model allow evolv state mean state evolv new_particl allow edit updat state also transit run updat evolv run transit automat synchronize_model thu evolv add particl function synchronize_model automat call end updat state call evolve_model first go updat run automat call recommit_particl evolve_model lead us run back evolv literatur refer ad code amus cours want work recogn amus activ provid refer everi code use amus script end everi run script refer defin python interfac follow code snippet codeblock python class simplegravinterfacecodeinterfac literaturereferencesmixin gravitationaldynamicsinterfac simplegrav forward euler code dynam evolv newtonian graviti nbodi system alvarez etienn monthli notic astronom astrophys review letter z vol adam dougla hitchhik guid galaxi include_head worker_codeh def __init__ self keyword_argu codeinterface__init__self name_of_the_workersimplegrav_work keyword_argu literaturereferencesmixin__init__self upon finish script use simplegrav get follow warn codeblock homeamusesrcamusesupportliteraturepi amusewarn use follow code contain literatur refer simplegravinterfac alvarez etienn monthli notic astronom astrophys review letter z vol adam dougla hitchhik guid galaxi amus portegi zwart mcmillan slw astrophys recip art amus aa iop astronomi publish page araabookp portegi zwart et al multiphys simul use hierarch interchang softwar interfac comput physic commun cophcp pelupessi f et al astrophys multipurpos softwar environ astronomi astrophys aaap portegi zwart et al multiphys multiscal softwar environ model astrophys system new astronomi volum issu newap warningswarnprefix selfall_literature_references_str exceptionsamusewarn note denot entri literatur list set valu grid boundari highlight python note time write tutori septemb athena capreol hydrodynam code support user defin boundari amus specifi hydrodynam grid code handl boundari condit hydrodynam grid code defin number special grid cell end grid cell often call boundari ghost cell handl differ code flowvari cell evolv calcul cell user defin function support boundari condit code amus need provid least kind boundari condit period simul period repeat problem period boundari condit simul grid connect copi often implement copi data opposit site grid boundari cell reflect mirror grid variabl boundari cell often implement copi data cell connect boundari boundari cell outflow set deriv flow variabl respect direct boundari zero follow pictur show three boundari condit one dimension grid boundari cell imag boundariespng boundari condit defin set boundari paramet boundari grid code boundari defin xbound xaxi boundari left side grid often call inflow boundari xbound xaxi boundari right side grid often call outflow boundari ybound yaxi boundari bottom side grid often call inflow boundari ybound yaxi boundari top side grid often call outflow boundari zbound zaxi boundari front side grid often call inflow boundari zbound zaxi boundari back side grid often call outflow boundari imag boundariespng codeblock python amuselab import code athena codeparametersxbound period codeparametersybound reflect also set boundari per axi inflow outflow paramet x_ y_ z_boundary_condit paramet codeblock python amuselab import code athena instanceparametersx_boundary_condit periodicperiod instanceparametersy_boundary_condit periodicperiod instanceparametersz_boundary_condit periodicperiod custom boundari condit specifi custom boundari condit set boundari condit paramet interfac paramet set commit chang boundari valu fill correct boundari grid boundari grid overlap patch togeth form larger cuboid around grid cuboid xboundari condit n boundari cell x direct amount cell z direct grid yboundari condit n boundari cell direct x direct n number cell x direct grid z direct amount cell grid final zboundari condit n boundari cell z direct x direct n number cell x direct grid imag boundariespng get boundari grid specif boundari call get_boundary_grid code note fill return grid copi data memori grid set attribut grid one go set individu attribut yet implement requir method septemb en exampl fill boundari grid codeblock python amuselab import instanceathena instanceparametersmesh_s instanceparametersmesh_length generic_unit_systemlength instanceparametersx_boundary_condit interfac outflow request boundari grid shape x x x z athena cell boundari depth xbound_grid instanceget_boundary_gridxbound copi grid memori manipul easier memxbound xbound_gridcopi set cell grid valu memxboundrho densiti memxboundrhovx momentum memxboundrhovi momentum memxboundrhovz momentum memxboundenergi p instanceparametersgamma memxboundenergi memxboundrhovx memxboundrhovi memxboundrhovz memxboundrho copi data code correct boundari valu channel memxboundnew_channel_toxbound_grid channelcopi boundari grid connect grid specif way gener rule inflow boundari last cell boundari connect first cell grid gener rule outflow boundari first cell boundari connect last cell grid exampl xbound xbound left inflow boundari xaxi cell boundari cell x direct last cell boundari connect first cell grid ybound right outflow boundari xaxi cell boundari cell x direct first cell boundari connect last cell grid boundari grid correct x z posit match grid grid start cell size last grid cell leftth inflow boundari posit codeblock python amuselab import instanceathena instanceparametersmesh_s instanceparametersmesh_length generic_unit_systemlength instanceparametersx_boundary_condit interfac interfac request boundari grid side shape x x x z athena cell boundari depth xbound_grid instanceget_boundary_gridxbound xbound_grid instanceget_boundary_gridxbound print xbound_gridx print instancegridx print xbound_gridx interact tutori static descript interact tutori amus interact tutori alway deliv binari distribut start distribut codeblock sh amusetutori sourc distribut also run interact tutori need instal ipython notebook first ipythonnb_ instal ipython run notebook codeblock sh export pythonpathpwdsrcpythonpath cd docinteractive_tutori ipython notebook pylab inlin note need run ipython command interact tutori directori also need amus python path note ipython notebook code depend tornado pyzmq modul need instal instal ipython notebook toctre maxdepth loading_amus quantities_with_unit generic_unit collections_of_particl attributes_and_functions_on_particle_collect using_a_community_cod channel grid _ipythonnb httpipythonorgipythondocdevinteractivehtmlnotebookhtml architectur overview layer amus architectur base layer design three layer highest layer python script written singl problem set problem next layer contain amus code layer provid librari object function use python script last layer contain exist legaci code layer physic model implement layer build upon lower layer ad function eas use previou layer raw latex beginfigurehtp center graphviz digraph layer fontsiz node shapebox stylefil fillcolorlightyellow width subgraph cluster stylefil colorazur labeljustl labellay level label user script subgraph cluster stylefil colorazur labeljustl labellay level label amus librari subgraph cluster stylefil colorazur labeljustl labellay level label commun code level level level raw latex captionth layer amus endfigur layer differ role amus architectur user script layer code layer implement specif physic problem set problem layer contain exampl script script written user layer conceptu compar user interfac layer applic gui coupl two code happen layer help support class amus librari layer amus librari layer layer provid object orient interfac top legaci code also provid librari function unit handl data convers role layer gener specif one problem one physic domain commun code layer layer defin interfac commun code contain actual code provid process manag commun code function interfac code layer gener respect problem specif differ physic domain follow section contain detail explan layer start lowest layer highest detail work chapter refer manual commun code layer commun code layer contain actual applic function commun applic layer expos everi commun code set function function group one class per code amus framework code commun code design run separ applic amus framework code consist python script amus librari commun code consist origin codebas scientif code extend new main applic handl messag send python librari function call commun code send via messag pass framework actual run code raw latex beginfigurehtp center graphviz digraph layer fontsiz rankdirlr node fontsiz shapebox stylefil fillcolorlightyellow subgraph cluster stylefil colorazur labelappl python interfac messag pass framework subgraph cluster stylefil colorazur labelappl commun code python interfac messag pass framework commun code messag pass framework messag pass framework commun code messag pass framework python interfac raw latex captionth amus script commun code separ applic applic commun use messag pass framework endfigur number applic start machin run set dynam amus depend problem research run amus singl desktop comput mix environ cluster comput everi amus run start one python script script turn start number differ commun code separ applic complet run consist multipl applic run parallel sequenc manag one python script graphviz digraph multipl fontsiz rankdirlr node fontsizeshapebox stylefil fillcolorlightyellow subgraph cluster stylefil colorazur labelappl python script subgraph cluster stylefil colorazur labelappl run gpu gravit dynam subgraph cluster stylefil colorazur labelappl run cluster hydrodynam hydrodynam hydrodynam hydrodynam hydrodynam hydrodynam hydrodynam hydrodynam hydrodynam hydrodynam hydrodynam hydrodynam hydrodynam subgraph cluster stylefil colorazur labelappl stellar evolut subgraph cluster stylefil colorazur labelappl stellar evolut subgraph cluster stylefil colorazur labelappl stellar evolut subgraph cluster stylefil colorazur labelappl stellar evolut python script gravit dynam python script hydrodynam python script stellar evolut python script stellar evolut python script stellar evolut python script stellar evolut messag pass amus framework interact legaci code via messag pass framework function call python script translat messag messag send commun code use messag pass framework commun code wait messag event decod messag upon arriv perform request function result send back use similar messag imag message_passingpng amus librari layer librari layer respons provid object orient interfac commun code also provid extra function help write user script file input output common file format unit convers extra function use independ commun code everi commun code lowlevel interfac defin commun interfac layer objectori interfac lowlevel interfac defin set function objectori interfac use function combin model statetransit unit data set provid interfac easier use less error prone easier coupl code graphviz digraph amcode_ fontsiz compoundtru ranksep node fontsizeshapebox stylefil fillcolorlightyellow subgraph cluster stylefil colorazur labelobject orient interfac unit convers code interfac state except subgraph cluster stylefil colorazur labeldata model particl grid point legaci interfac code interfac commun code interfac ltailclust subgraph cluster stylefil colorazur labelsupport inputouput unit code interfac particleslheadclust ltailclust code interfac unitslheadclust ltailclust model commun code commun code everi modul physic domain model use templat templat consist attribut wrapper attribut provid common interfac subpart code exampl particl attribut provid interfac add updat remov particl code attribut combin sever function legaci interfac one object wrapper defin top commun function add function exist method exampl everi method unit argument return valu defin filter wrapper add function individu method attribut templat divid interfac object code number attribut attribut refer object implement specif subinterfac code exampl code paramet attribut attribut implement parameterset subinterfac parameterset subinterfac defin interact paramet code case paramet set queri set name use normal python attribut access templat code divid follow subinterfac paramet paramet influenc code work paramet usual set creat code paramet readwrit writeonli properti properti inform user state code current model time properti properti alway readonli particl set particl set provid common interfac set particl code code multipl particl set defin differ name exampl ga star dark matter grid grid provid access multidimension data code multipl grid defin hierarchi amr smr code wrapper wrapper decor method wrapper pre postprocess argument decid method safe call unit error code defin unit argument wrap method call argument convert number correct unit return valu convert quantiti number unit state state code determin function valid call code transfer one state anoth exampl code might give incorrect answer potenti energi request particl enter code state model rais error inform script writer problem implement implement objectori interfac base adaptor pattern commun code interfac class adapt creat class provid paramet particl setsgridpoint method unit properti unit state control unit convers incompat unit system function interfac code system raw latex beginfigurehtp center graphviz digraph amcode_ fontsiz compoundtru ranksep rankdirlr node fontsizeshapebox stylefil fillcolorlightyellow subgraph cluster stylefil colorazur labeladaptor labellocb labeljustr particl gridpoint paramet method unit properti unit state control unit convers incompat unit system commun code interfac commun code interfaceparticl gridpointslheadclust raw latex captiona legaci interfac adapt provid object orient interfac function endfigur user script final layer user script layer layer contain script written research specif problem set problem script alway written python use function provid two lower layer amus framework script dont need follow fix design imag user_script_sequencepng mpi interfac interfac amus python core legacycod base mpi framework choos mpi swig direct coupl method sever advantag mpi wellknown framework astrophys commun coupl method less well known like swig legaci code run python space memori usag name multipl instanc legaci code easili support swig fpi coupl multiprocess support taken account start project coupl much looser also disadvantag need defin protocol mpi handwork need coupl code framework like swig fpi gener interfac base applic code overhead everi call slower call disadvantag mitig creat librari handl coupl detail librari python c fortran version implement protocol gener hook connect legaci code overhead per call may import factor speed framework test develop first code possibl limit overhead send lot data per call exampl set properti lot star one call call lot method limit data compar send one method lot data coupl code design coupl code amus base provid set function everi commun code use devis differ coupl method coupl method fix chang per problem basi function gener amus librari defin three set function support coupl code particl gridpoint manipul properti particl gridpoint queri updat run provid direct method manipul data commun code code support remov ad particl run stop condit stop condit design interrupt code model evolut stop condit trigger code encount predefin state exampl particl escap bound box servic servic function ad code use model code provid data code exampl smooth particl hydrodynam code provid state model random point particl use creat grid particl model _designlabel design document toctre maxdepth introduct architectur coupl packag set mpi datamodel data store set datamodel amus data store set set store object valu attribut belong object object set attribut valu attribut graphviz digraph set fontsiz node shaperecord fontsizestylefil fillcolorlightyellow width struct labelset object object object n attribut valu valu valu na attribut b valu b valu b valu nb attribut z valu z valu z valu nz like relat databas model everi object set set store valu attribut object model like relat databas tabl set amus record object set column attribut object field valu attribut object graphviz digraph layer fontsiz node fontsizeshapebox stylefil fillcolorlightyellow width subgraph cluster fontsiz stylefil colorazur labeljustl labelamus model set object attribut valu set attribut fontsizelabeldefin object valu fontsizelabelha set object fontsizelabelcontain set valu fontsizelabelstor subgraph cluster fontsiz stylefil colorazur labeljustl labelrel databas model tabl record column field tabl column fontsizelabeldefin tabl record fontsizelabelstor record field fontsizelabelha object view object set store valu instead defer set provid attribut valu sens object pointer locat set compar relat databas model object like cursor use access valu attribut belong object store set graphviz digraph layer fontsiz node fontsiz shapebox stylefil fillcolorlightyellow width stylefil colorazur set object object set fontsizelabel pointer locat user ask object mass object queri set store valu return answer user imag objects_in_setpng object key object set identifi uniqu key object key seen object amus system object exist multipl set set object differ valu attribut differ attribut set differ version object exist set use storag model actual storag attribut valu set provid storag model set provid interfac script writer storag model manag data storag model must decid store data data store memori area script mememori area code file relat databas graphviz digraph layer fontsiz node fontsizeshapebox stylefil fillcolorlightyellow width subgraph cluster fontsiz stylefil colorazur labeljustl labelamus model set subgraph cluster fontsiz stylefil colorazur labeljustl labelstorag model memori code file databas set memori set code set file set databas select set datamodel provid subset handl select object set compar relat databas model subset like view subset store data data store origin set attribut updat subset attribut also updat origin data graphviz digraph set fontsiz node shaperecord fontsizestylefil fillcolorlightyellow width subgraph cluster fontsiz stylefil colorazur labeljustl labelsubset struct labelset object object subgraph cluster fontsiz stylefil colorazur labeljustl labelorigin set struct labelset object object object n attribut valu valu valu na attribut b valu b valu b valu nb attribut z valu z valu z valu nz structhere structtherew introduct document describ high level design amus develop period amus document work progress updat state latest idea design reflect current implement detail document found refer document amus amus combin exist astrophys numer code singl system goal develop toolbox perform numer astrophys experi toolbox provid standard way input output astrophys data support setup manag numer experi uniqu method coupl wide varieti physic code legaci set standard proven code code integr amus modul modul use standalon combin modul standard way ad new modul amus exampl show use modul possibl coupl modul document contain introduct howto refer document develop amus origin develop leiden observatori leiden observatori faculti leiden univers netherland fund provid nova grant imag logosuniversiteit_leiden_logopng imag logosstrw_logopng width cm imag logosnova_logojpg width cm python packag like larg python project amus sourcecod structur packag subpackag modul packag subpackag directori filesystem modul python file detail explan found modul httpdocspythonorgtutorialmoduleshtml chapter import packag name sourc code amus code commun code layer combin one packag packag name amus amus root packag amus code contain test file build system test system amus packag divid three subpackag amusesupport contain code amus code layer unit system data io model base class found packag amusecommun contain code commun code layer commun code found packag well support code gener script legaci code messag framework amuseext contain extra andor extens code exampl make initi data model one main function amus use includ codebas support code commun code interfac automodul amuserficor member messag protocol python commun code introduct implement interfac commun code base send messag messag encod mpi primit datatyp send code use mpi section describ overal oper interfac implement specifi messag format overal oper method call interfac requestrespons protocol everi method call messag send code messag decod code functionid argument code call function functionid use decod argument function complet result messag return contain result functionid call function process depict follow tabl python script code client server start function call encod argument send mpi messag receiv mpi messag decod messag handl set data evolv solut encod respons messag send respons messag receiv mpi respons messag decod respons messag return result script end function call messag format everi messag sent python script code format format consist header zero content array header contain functionid number call function number valu argument result per primit type one function call everi content array contain sent valu primit datatyp exampl content array integ valu argument function codeblockraw header function id number call number valu type number valu type n contentarray int int contentarray n doubl doubl messag header header sent mpi broadcast messag header consist array n integ integ specifi function integ specifi number call n integ specifi number argument type version interfac contain support type float int float string header integ long array specif integ given follow tabl messag header posit descript functionid number call number argumentsresult type float number argumentsresult type int number argumentsresult type float number argumentsresult type string content array argument sent mpi broadcast messag result sent mpi send messag argument result sent valu need function valu need type messag sent type encod content array sent argument result valu function valu must encod array differ primit type argument function normal sort type first argument may integ second doubl last integ messag format specifi fix sort float valu sent first integ type sent argument result valu encod follow fix scheme argument encod extract valu primit type order occur function definit done everi type exampl first argument function integ second doubl last integ two content array sent one two integ one singl doubl integ array first posit first argument second posit last argument doubl array first posit second doubl function int example_functionint id doubl x int type two content array sent intid type first argument last argument method integ doublex second argument method doubl argument encod order go left right c fortran function definit content array long number argument result primit type specif member content array given follow tabl content array posit descript first argument type x second argument type x n last argument type x multipl call function mpi messag signific overhead reduc overhead argument result number call method encod one set messag header contentarray creat array valu x rang rang z rang call function multipl time differ valu argument rang instanceadd_positionxi yi zi convert call function array argument instanceadd_positionx z encod argument call array follow strategi call singl valu valu first argument encod first valu second found argument type encod second etc content array format messag encod multipl call function posit descript first valu array first argument type x second valu array first argument type x last valu array first argument type x first valu array second argument type x second valu array second argument type x n last valu array last argument type x get valu mth valu nth argument type start count zero n first argument first valu argument valu array n len encod degrad case singl call len array contain one valu valu array n exampl tbd interfac specif toctre maxdepth introduction_interface_specif stellar_dynamics_interface_specif stellar_evolution_interface_specif hydrodynamics_interface_specif radiative_transfer_interface_specif datamodel introduct contain amus datamodel base object store contain contain store relev data object one work data contain whole individu object contain work individu object data retriev store contain object differ normal python object list list store refer object data store object amus contain amusedatamodel import particl amuseunit import unit star particl starsmass unitsmsun sun star sunmass unitsmsun print starsmass msun starsmass unitsmsun print sunmass msun python list amusedatamodel import particl sun particlemass unitsmsun star particlemass unitsmsun star sun star print starsmass access attribut list traceback recent call last attributeerror list object attribut mass set grid amus support two kind contain one contain kind implement one dimension set object add remov object set combin set differ way contain kind call particl individu object store call particl contain kind implement multidimension grid object chang shape grid object ad remov grid contain kind call grid individu object store contain call gridpoint particl amusedatamodel import particl amuseunit import unit star particl starsmass unitsmsun print starsmass msun grid amusedatamodel import grid amuseunit import unit field grid fielddens unitsg unitscm point field pointdens unitsg unitscm print fielddens g cm memori code file contain amus save data individu object differ kind store amus current implement kind store one kind store save data memori kind use default provid fastest way work contain anoth kind store save retriev data commun code use mpi messag commun data kind use default contain provid code primari way interact data insid run code last kind contain store retriev data hdf file kind use save load contain vari attribut memori contain support user defin set attribut contain object defin new attribut contain assign valu attribut code contain support predefin per code set attribut contain object defin new attribut contain also code may allow attribut set individu contain also set attribut individu exampl often set x posit particl must set x z posit one go ad attribut set object amusedatamodel import particl amuseunit import unit star particleskey add attribut assign name set starsmass unitsmsun sun star print sun particl mass msun sunradiu unitsrsun print sun particl mass msun radiu rsun object class differ kind particl gridpoint model implement subclass instead differ kind particl defin adhoc variabl name exampl planet star cloud_particl vari attribut star posit mass cloud_particl posit densiti allow model problem name attribut best fit model unfortun way work remov level self descript system mitig problem contain defin commun code exampl script follow convent describ convent later section chapter differ attribut name differ kind amusedatamodel import particl amuseunit import unit star planet share attribut radiu also attribut make sens specif kind popul planet luminos star star particleskey starsluminos unitslsun starsradiu unitsrsun planet particleskey planetsradiu unitskm planetspopul ident object contain uniqu ident two object contain ident particl contain ident provid uniqu bit key grid contain ident provid ndimension index grid object ident exist multipl contain object consid conceptu object amus differ contain provid differ inform object exampl star could live contain memori contain stellar evolut code contain stellar dynam code amus provid sever function link object transfer data differ set store inform object amusedatamodel import particl amuseunit import unit star particleskey starsluminos unitslsun bodi particleskey bodiesmass unitsmsun print bodi star conceptu object differ set true print bodi star object fals print bodi particl mass msun find corespond particl star print bodiesas_particle_in_setstar particl luminos lsun ownership object contain own contain contain control data lifecycl object particl key particl uniqu bit key key creat use random number gener chanc duplic key use bit integ finit low chanc duplic key determin gener birthday problem duplic key given n random integ drawn discret uniform distribut rang highest_integ probabl pnhighest_integ least two number import math number_of_bit highest_integ number_of_bit number_of_particl one million probabl mathexp number_of_particl number_of_particl highest_integ print probabl e also set probabl determin set size probabl percent number_of_particl mathsqrt highest_integ mathlog probabl print number_of_particl use larg set want load lot simul differ particl script probabl encount duplic may high check duplic set particl call has_dupl set also chang key gener better match problem set particl amus datamodel assum particl come set data particl store set automodul amusedatamodel autoclass abstractparticleset member automethod __add__ automethod __sub__ autoclass particl member autoclass particlessubset member autoclass particleswithunitsconvert member object autoclass particl member automethod __add__ automethod __sub__ method retreiv physic properti particl set automodul amusedatamodelparticle_attribut autofunct center_of_mass noindex autofunct center_of_mass_veloc noindex autofunct kinetic_energi noindex autofunct potential_energi noindex autofunct particle_specific_kinetic_energi noindex autofunct particle_potenti noindex implement graphviz digraph multipl fontsiz node fontsizeshapebox stylefil fillcolorlightyellow attributestorag abstractset abstractset abstractparticlesset abstractset abstractgrid abstractparticlesset particl abstractparticlesset particlessubset abstractparticlesset particlessuperset abstractgrid grid abstractgrid subgrid attributestorag inmemorystorag label implement attributestorag incodestorag graphviz digraph multipl fontsiz node fontsizeshapebox stylefil fillcolorlightyellow edg colordodgerblu fontcolordodgerblu particl attributestorag headlabel taillabellabel store grid attributestorag headlabel taillabel label store subgrid grid headlabel taillabel labelview colordodgerblu particlessubset particl headlabel taillabel labelview colordodgerblu particlessuperset particl headlabel taillabel labelview colordodgerblu graphviz digraph multipl fontsiz node fontsizeshapebox stylefil fillcolorlightyellow abstractset attributestorag headlabel taillabel label stored_attribut colordodgerblu fontcolordodgerblu abstractset derivedattribut headlabel taillabel label derived_attribut colordodgerblu fontcolordodgerblu derivedattribut calculatedattribu derivedattribut vectorattribut derivedattribut functionattribut derivedattribut domainattribut imag derived_attributespng autoclass amusedatamodelattributestorag member _cudasetuplabel set gpgpu cuda introduct provid help set generalpurpos comput graphic process unit gpgpu use cuda perform part calcul graphic card result signific speedup sever code amus support requir gpgpu phigrap use sapporo ph use sapporo octgrav bonsai higpu selfhelp script amus root directori selfhelp script found build test code mention fail wonder hope provid help suggest command line run bash script cuda_self_help codeblock sh amusexcuda_self_help stepbystep refcudacap refcuda_sdk refenvvar refconfigurewithcuda reftest _cudacap check comput cudacap nvidia graphic card first determin model gpu linux codeblock sh nvidiaset q gpu mac click appl menu click mac click info select graphicsdisplay content list check whether gpu model list among nvidia cudaen gpu httpswwwnvidiacomobjectcuda_gpus_ _cuda_sdk check instal cuda toolkit tk softwar develop kit sdk download instal cuda develop tool httpsdevelopernvidiacomcudadownloads_ _envvar set cuda_tk cuda_sdk environ variabl instal cuda tk sdk make sure environ variabl cuda_tk cuda_sdk set correctli shell bash need codeblock sh export cuda_tkpathtocuda_tk export cuda_sdkpathtocuda_sdk pathtocuda_tk hold directori name includ lib lib libcudartso locat pathtocuda_sdk hold directori name commoninc variou header file locat recommend add line bashrc file variabl set correctli session c shell need setenv edit cshrc file _configurewithcuda configur amus cuda enabl amus need configur option enablecuda see refconfigurationgpulabel _test test tri build exampl octgrav run nosetest amus root directori first reiniti mpd rememb origin environ codeblock sh mpdallexit mpd make octgravcod nosetest testcodes_teststest_octgravpi fail pleas contact us amusecod googl group httpgroupsgooglecomgroupamusecode_ irc amus channel ircfreenodenet support file format automodul amuseio introduct amus framework provid gener way read write set entiti entiti particl gascloud gridpoint amus provid function write set file function read set file function need name file format data file describ function first chapter function throw kind except describ next use write data set space separ text file amuseio import write_set_to_fil amusedatamodelcor import particl amuseunit import unit x particl xmass unitsmsun xradiu rang unitsrsun write_set_to_filex testcsvtxt attribute_typ unitsmsun unitsrsun autofunct write_set_to_fil autofunct read_set_from_fil autofunct get_options_for_format except autoclass unsupportedformatexcept autoclass cannotsaveexcept autoclass cannotloadexcept amus hdf file amus provid data format base hdf file hdf file storag provid support store particl set grid file also retain particl refer store multipl version set amusesupport import io amuseicplumm import new_plummer_model particl new_plummer_model iowrite_set_to_fil particl plummerhdf hdf ioread_set_from_fileplummerhdf hdf iooption hdf text file amus support read write text txt csv file specifi txt format enter txt space separ file csv comma separ file format amusesupport import io particl ioread_set_from_fil plummertxt txt attribute_typ unitsm unitsm unitskm attribute_nam x vx iowrite_set_to_fileparticl plummertxt txt iooption txt default text file store unit inform comment line header unfortun amus depend line read file read text file alway need specifi unit everi column file exampl read file particl posit posit store parsec particl ioread_set_from_fil positionstxt txt attribute_typ unitsparsec unitsparsec unitsparsec attribute_nam x z write text file need specifi unit dont specifi unit write_set_to_fil function default unit quantiti save reliabl reproduc suggest alway specifi unit name attribut save save text file particl iowrite_set_from_fil particl txt attribute_typ unitsparsec unitsparsec unitsparsec attribute_nam x z amus text file routin gener sinc version also specifi list vector quantiti instead particl set particl iowrite_set_from_fil none txt attribute_typ unitsparsec unitsparsec unitsparsec attribute_nam x z quantiti unitsparsec unitsparsec unitsparsec starlab amus support read write starlab dyn file specifi starlab format enter dyn starlab format amusesupport import io particl ioread_set_from_fileplummerdynstarlab iowrite_set_to_fileparticl outputdyn dyn starlab format support sevar option list use option ad addit keyword argument funcread_set_from_fil funcwrite_set_to_fil function exampl amusesupport import io particl ioread_set_from_fileplummerdynstarlab must_scal fals return_children fals iooption starlab unit valu star stellar properti section starlab file alway deriv si unit solar mass million year solar luminoc etc mass given de dynam section starlab file usual nbodi unit starlab tool set mass valu solar mass unit exampl makemass tool return mass solar mass unit read file need set dynamics_mass_unit codeblock bash makeplumm n plummerdyn cat plummerdyn makemass f x l u plummerdyn cat plummerdyn add_star q r plummerdyn cat plummerdyn scale plummerdyn cat plummerdyn kira plummerdyn plummerdyn plummerdyn plummerdyn file provid mass dynam properti scale nbodi unit plummerdyn plummerdyn file mass solar mass read file amus return particl si unit need amusesupport import io amuseunit import nbody_system unit convert nbody_systemnbody_to_si unitsmsun unitsparsec particl ioread_set_from_fileplummerdynstarlab nbody_to_si_convert convert particl ioread_set_from_fileplummerdynstarlab dynamics_mass_unit unitsmsun nbody_to_si_convert convert particl ioread_set_from_fileplummerdynstarlab dynamics_mass_unit unitsmsun nbody_to_si_convert convert particl ioread_set_from_fileplummerdynstarlab particl ioread_set_from_fileplummerdynstarlab note nbodi convert object need last file scale factor given file use plummerdyn plummerdyn plummerdyn also read nbodi unit follow exampl return particl dynam attribut mass radiu veloc acceler nbodi unit amusesupport import io particl ioread_set_from_fileplummerdynstarlab particl ioread_set_from_fileplummerdynstarlab must_scal fals particl ioread_set_from_fileplummerdynstarlab must_scal fals nemo amus support read write nemo tsf file specifi starlab format enter nemo tsf format amusesupport import io particl ioread_set_from_fileplummertsfnemo iowrite_set_to_fileparticl outputtsf tsf nemo format support sever option list use option ad addit keyword argument funcread_set_from_fil funcwrite_set_to_fil function exampl amusesupport import io amuseunit import nbody_system unit convert nbody_systemnbody_to_si unitsmsun unitsparsec particl ioread_set_from_fileplummernemotsf nbody_to_si_convert convert iooption nemo gadget amus support read write gadget file specifi gadget format enter gadget format amusesupport import io ga halo disk bulg star bndri ioread_set_from_fileplummerdatgadget iowrite_set_to_fileparticl outputdat gadget gadget file format reader return tupl ga halo disk bulg star boundari particl differ form reader return one set write_set_to_fil take particl set save halo particl tupl ga halo disk bulg star boundari particl gadget format support sever option list use option ad addit keyword argument funcread_set_from_fil funcwrite_set_to_fil function exampl read gadget file timestep inform amusesupport import io particl ioread_set_from_fileplummernemogadget has_timestep true iooption gadget sourc code manag commit code git repositori locat amus sourc code repositori found httpsgithubcomamusecodeamus radi transfer interfac definit date author version state ave tbd introduct tbd support code amus framework automodul amusesupportcor autoclass late member autoclass print_out member automethod __add__ autoclass ordereddictionari member quantiti unit introduct want abl use physic quantiti rather measur repres eg float integ comput order rais ambigu caus implicit choic unit serv purpos amus come quantiti class like particl set fundament data structur amus quantiti fundament variabl interact code data unit even scale system handl quantiti regard unit integr part mathemat descript variabl dc ipsen unit dimens dimensionless number mcgrawhil book compani ie state thing like au km codeblock python amuseunit import unit q unitsmsun q eunitskg q q true quantiti object basic convers abil differ unit belong dimens exist quantiti object convert one elabor convers facil like interfac natur unit code amus provid generic_unit_convert deriv nbody_system modul quantiti inheritancediagram amuseunitsquant automodul amuseunitsquant autoclass quantiti member autoclass scalarquant member autoclass vectorquant member automethod __getitem__ automethod __setitem__ autoclass nonnumericquant member unit inheritancediagram amuseunitscor automodul amuseunitscor member unit system convert amus framework give abil choos unit system model generic_unit_convert modul enabl work eg natur unit nbodi unit within amus implement make use dimensionspac vectorspac chosen unit form base detail descript method see eg maksymowicz american journal physic vol gener unit automodul amuseunitsgeneric_unit_system nbodi unit automodul amuseunitsnbody_system convert automodul amuseunitsgeneric_unit_convert autoclass convertbetweengenericandsiunit member use code conveni gravit dynam interfac work unitconvert convert unit use code prefer unit script user choic show two exampl first one use deriv gener unit convert nbody_system convert logic choic dynam nbodi code second one use gener unit convert directli exampl usag exampl codeblock python amusecommunityhermiteinterfac import hermit amuseunit import nbody_system amuseunit import constant unit convert_nbodi nbody_systemnbody_to_si unitsmsun e unitskm hermit hermiteconvert_nbodi usag exampl codeblock python amusecommunityhermiteinterfac import hermit amuseunit import generic_unit_convert gc amuseunit import constant unit convert gcconvertbetweengenericandsiunitsconstantsg unitsmsun unitsau hermit hermiteconvert exampl exampl found tutori refworking_with_unit automodul amusecommunityinterfacegd autoclass gravitationaldynam member __init__ run amus cartesiu supercomput cartesiu dutch nation supercomput inform eg obtain account see surfsara websit httpsuserinfosurfsaranlsystemscartesiu use amus cartesiu rel straightforward test method instal use amus use prerequisit though option eg use softwar preinstal machin also possibl gener descript instal prerequisit see refprerequisitelabel section obtain amus assum copi amus download amus folder user home instanc use git codeblock sh cd homeusernam git clone httpsgithubcomamusecodeamusegit environ set sinc use amus prerequisit softwar need set environ variabl make sure follow line present bashrc file codeblock sh file bashrc load java need code modul load javaoracl export prefixamuseprerequisit export pathprefixbinpath export ld_library_pathprefixlibld_library_path use gfortran export fcgfortran export fgfortran also make sure bashrc load bash_profil way enviro alway set correctli interact noninteract mode codeblock sh file bash_profil f bashrc bashrc fi note sure reconnect machin chang take effect instal amus prerequisit next instal prerequisit amus use amus suppli script codeblock sh creat directori prerequisit mkdir amuseprerequisit go docinstal directori cd amusedocinstal start instal script python installpythonsh download prerequisit packag installpi download instal prerequisit use hydra default mpi process manag may take installpi hydra instal option also instal matplotlib installpi matplotlib instal configur build amus configur build amus normal codeblock sh go amus directori cd amus configur amus configur mpiexecmpiexechydra build amus make option also instal code requir download file make download_cod test instal test amus instal run nosetest note run simul frontend cartesiu allow codeblock sh go amus directori cd amus mpiexechydra n nosetest v test run cartesiu node run cartesiu typic done submit slurm script see surfsar site info httpsuserinfosurfsaranlsystemscartesiususagebatchusag simpl exampl script run amus cartesiu codeblock sh binbash sbatch n sbatch n sbatch p short sbatch cd amus mpiexechydra n amusesh examplessyllabusgravity_simplepi submit use sbatch get statu use squeue cancel use scancel codeblock sh submit script sbatch examplescript list job current user squeue u user cancel job scancel cancel job current user scancel u user use multipl node also work specifi slurm mpi automat pickup spread worker node codeblock sh binbash sbatch n sbatch n sbatch p short sbatch cd amus note simpl exampl use singl worker mpiexechydra n amusesh examplessyllabusgravity_simplepi hydrodynam interfac definit introduct chapter describ common interfac hydrodynam grid base code particl base sph code see gravit dynam specif paramet paramet access function follow templat get_timestep set_timestep function paramet access function may retriev updat valu singl paramet paramet set commit_paramet function call give code opportun prepar model autoclass amusecommunityinterfacehydrohydrodynamicsinterfac member set_timestep get_timestep commit_paramet grid manag hydrodynam code work grid hierarchi grid follow method defin function setup queri grid autoclass amusecommunityinterfacehydrohydrodynamicsinterfac member get_index_range_inclus set_boundari setup_mesh get_position_of_index get_index_of_posit grid state grid point hydrodynam code well known minim state state defin densiti momentum densiti energi densiti state retriev updat follow function autoclass amusecommunityinterfacehydrohydrodynamicsinterfac member set_grid_st get_grid_st grid state extens mechan inform grid point transfer fill_grid_st get_grid_st function support properti like pressur mhd properti code defin get_ set_ function function must get set one scalar properti argument vector properti argument autoclass amusecommunityinterfacehydrohydrodynamicsinterfac member get_dens set_grid_dens get_momentum_dens set_grid_momentum_dens get_energy_dens set_grid_energy_dens model evolut hydrodynam code evolv properti grid cell time follow function need control evolut code autoclass amusecommunityinterfacehydrohydrodynamicsinterfac member initialize_grid evolv diagnost state code queri model calcul follow function use queri exact model time autoclass amusecommunityinterfacehydrohydrodynamicsinterfac member get_tim extern field hydrodynam code support extern acceler potenti field follow function use enter gravit potenti field autoclass amusecommunityinterfacehydrohydrodynamicsinterfac member set_has_external_gravitational_potenti get_has_external_gravitational_potenti get_index_range_for_potenti set_potenti get_potenti glossari glossari sort physic domain region space time object star ga cloud describ set physic model physic domain limit descript physic stellar system exampl graviti domain gravit forc taken account evolut star hydrodynam th interstellar medium modul interfac code amus also file contain python definit definit import main python program unit test automat test case part code exampl one defin unit test check result one method given specifi argument applic script combin modul multiphys simul run run physic model evolv want end state run end certain model time pass exampl one run script age million year evolv work develop physic model equat usual small step time taken new state system calcul previou state step identifi stage run evolv code take multipl step one evolv step step integr step forc calcul step datamodel singl represent model data differ physic code set collect identify object exampl star globular cluster everi valu set seen belong object grid collect identify locat region exampl box interstellar medium densiti molecular composit everi valu collect seen belongin specif locat xyz point code comput program solv approxim equat state physic domain code usual written fortran cc exampl sse code perform stellar evolut product code code use model stellar system describ publish articl toy code code limit accur easi use numer experi sph smooth particl hydrodynam comput method use simul fluid flow amr adapt mesh refin input output format binari star two star close orbit star cluster group star mean distanc star smaller mean distanc star galaxi disk two type star cluster exist globular cluster open cluster dens stellar system interstellar medium matter star galaxi interstellar cloud gener name accumul ga plasma dust denser region insterstellar medium molecular cloud type insterstellar cloud whose densiti size permit format molecul graviti domain hydrodynam star stellar evolut zam zero age main sequenc start main sequenc evolut star stabl stage format star collaps ga cloud main sequenc star star deriv energi convers hydrogen helium core star cluster metal proport star matter made chemic element hydrogen helium galaxi star core star envelop simplifi interfac function specif addit specif remot interfac function use legacy_funct decor simplifi method avail handl case interfac function describ simplifi interfac function specif exampl let start simpl exampl specif codeblock python legacy_funct def sum function legacyfunctionspecif functionaddparameterx functionin functionaddparameteri functionin functionaddparametersum functionout functionresult_typ functioncan_handle_array true return function convert codeblock python remote_functioncan_handle_arraytru def sumxdyd return sumd seen paramet specifi keywordvalu style can_handle_array must_handle_array suppli necessari keyword decor default integ return valu error code impli overridden see follow tabl list option paramet specif data type default valu default valu input boolean b bool true fals integ int int numpyintvalu long l int numpyintvalu float f float numpyfloatvalu doubl float float numpyfloatvalu string string string unit specif ad rememb paramet without default follow paramet default follow gener error codeblock python remote_functioncan_handle_arraytru def sumxyd return sumd exampl valid specif codeblock python remote_funct def initialize_cod pass remote_funct def get_tim return time unitss remote_functionmust_handle_arraytru def inout_sumxdyd sum return sum remote_funct def function_with_float_return return __result one limit type specif wont work gener dynam dont tri exampl gener bunch function base list paramet name bridg code automodul amusecouplebridg autoclass bridg member autoclass abstractcalculatefieldforcod member autoclass calculatefieldforcod member autoclass calculatefieldforcodesusingreiniti member autoclass calculatefieldforcodesusingremov member autoclass calculatefieldforparticl member autoclass gravitycodeinfield member distribut amus possibl run amus multipl machin simultan amus script alway run user local machin worker code send remot machin workstat cluster etc instal deploy worker one remot machin requir full instal amus machin code socket support need present done default avail code note older version fortran lack necessari featur support socket worker machin distribut code also need build distribut amus requir java develop kit jdk prefer oracl java version configur script tri locat jdk may need specifi hand detail see codeblock sh configur help build distribut amus run follow amus root codeblock sh make distributedcod check instal setup properli run test relat worker interfac codeblock sh cd amuse_dir nosetest v testcodes_teststestimplementationpi note distribut amus mostli test version mpi includ amus prerequisit get mpi error run remot parallel worker tri use installpi script includ amus instal prerequisit overview usag distribut amus design close usag code amus main differ contain resourc pilot job instead particl resourc descript machin capabl run job resourc distribut amus launch support process hub facilit commun coordin worker amus pilot process run resourc often within reserv resourc wait job run behalf amus consist multipl machin job worker process search suitabl pilot run gener user first defin resourc deploy pilot resourc final creat code make use machin offer pilot initi distribut amus code distribut amus initi like code amusecommunitydistributedinterfac import distributedamuseinterfac distributedamus amusecommunitydistributedinterfac import resourc resourc pilot pilot initi code print output code consol instanc distributedamuseredirectionnon paramet distribut amus support paramet adjust set paramet need set resourc pilot job made effect overview set debug boolean paramet default fals trueenabl output addit debug inform log code output distributedamuselog folder target machin use webinterface_port port simpl webinterfac avail monitor default port determin automat start_hub facilit commun across differ network instanc firewal hub default start resourc turn need instanc resourc within network worker_queue_timeout user respons make sure enough slot avail run worker end queue time worker wait give set use paramet worker_startup_timeout distribut code start amus worker run actual code take machin need paramet use increas time wait instanceparametersdebug true instanceparameterswebinterface_port instancecommit_paramet print instanceparameterswebinterface_port monitor distribut amus small buildin webinterfac monitor util function avail get url import webbrows webbrowseropeninstanceget_webinterface_url specifi resourc order use remot machin amus need inform resourc host name type machin usernam gain access etc specifi creat resourc distribut amus side effect commun hub also start frontend resourc resourc resourc resourcenam someresourc resourceloc usermachineexamplecom resourceschedul ssh resourceamuse_dir homeuseramus instanceresourcesadd_resourceresourc overview option name user chosen name resourc locat address resourc usual hostnam eg somehostsomedomaincom could also ip address amuse_dir locat amus remot machin eg homeuseramusesvn tmp_dir temporari file put remot machin gateway sometim machin reachabl directli due firewal use set provid intermedi resourc rout traffic via resourc alreadi creat scheduler_typ type schedul present remot machin default ssh use singl machin current support schedul type ssh sge slurm hub_queue_nam normal support process start front end howev also submit queue specifi hub_time_minut hub submit option denot time hub avail start pilot next step run job remot start socal pilot job resourc specifi previous pilot submit job resourc creat necessari commun channel main amus applic wait job start current mostli worker note pilot may start function avail wait creat pilot start pilot pilot pilotresource_nameloc pilotnode_count pilottim unitshour pilotslots_per_nod pilotlabelloc instancepilotsadd_pilotpilot print pilot print instancepilot print wait pilot instancewait_for_pilot overview option resource_nam name resourc start pilot queue_nam queue use run pilot cluster specif use case ssh node_count number node start pilot time time keep pilot activ slots_per_nod number worker start node usual number core could less memori limit factor worker multicor capabl label label attach pilot use start worker run worker specif pilot option addit option usual requir start job run remot worker start normal howev amus need signal use distribut code start instead normal process function avail enabl disabl print start worker use distribut code instanceuse_for_all_work print use distribut worker longer instanceuse_for_all_workersenablefals altern also explicitli enabl distribut code per worker print use distribut instanc distribut worker instanceuse_for_all_distributed_workersenabletru worker hermitechannel_typedistribut even pass instanc distribut code would like use rare case multipl distribut code worker hermitechannel_typedistribut distributed_instanceinst worker option section list relev worker option distribut amus new also support channel implement normal requir use option number_of_work number worker process start thu work normal case worker take slot pilot see label label pilot use default pilot enough free slot found use start worker use label explicit select done number_of_thread number thread use process use explicitli set omp_num_thread environ variabl worker channel_typ set distribut start worker use distribut code altern use use_for_all_work function describ set default distributed_inst refer distribut instanc use start worker rare case multipl distribut code dynamic_python_cod boolean option state code dynam python code py file worker directori copi remot machin start code label default worker start avail pilot enough slot avail howev sometim would like control worker start instanc special hardwar present machin concept label use within distribut amus get function label attach worker one paramet start worker see pilot exactli label specifi pilot start consid candid run worker name label complet user instanc say simul use number worker run cpu singl gpu worker follow code put cpu worker one machin singl gpu worker anoth cpu_pilot pilot cpu_pilotresource_namemachin cpu_pilotnode_count cpu_pilottim unitshour cpu_pilotslots_per_nod cpu_pilotlabelcpu instancepilotsadd_pilotcpu_pilot gpu_pilot pilot gpu_pilotresource_namemachin gpu_pilotnode_count gpu_pilottim unitshour gpu_pilotslots_per_nod gpu_pilotlabelgpu instancepilotsadd_pilotgpu_pilot worker hermitelabelcpu worker bonsailabelgpu start due lack slot worker bonsailabelgpu exampl amus contain number exampl distribut code see examplesappl gateway gateway use case connect problem machin firewal privat ip address instanc case lgm gateway start like resourc thu requir valid instal amus gateway resourc specifi gateway anoth resourc case ssh connect made via gateway make sure login gateway target machin without use password well local machin commonli encount problem initi setup problem distribut amus code solv check login machin plan use use ssh without use password see instanc set httpswwwthegeekstuffcomstepstoperformsshloginwithoutpasswordusingsshkeygensshcopyid configur java jdk version higher use configur check content configmk see java use version detect make sure make clean make case make chang also done machin amus configur properli everi machin run code implement test good way spot issu nosetest v testcodes_teststest__implementationpi set provid resourc correct usernam amus locat etc set correct mpiexec configur set normal use amus may notic misconfigur case help probabl best check output error normal worker output discard script use redirectnon see output worker lot error show output also debug paramet distribut amus enabl output pilot distributedamuselog folder home remot machin use addit inform print log local amus script set grid code automodul amusedatamodelincode_storag member undocmemb showinherit _optionslabel option automodul amusesupportopt introduct amus framework provid gener way handl option attribut class option attribut request class read valu configur file return default valu noth found file valu option store one configur file configur file locat amus framework search configur file follow locat first framework tri find file name amuserc current work directori second framework tri find hidden file name amuserc home directori last framework tri find file name amuserc amus instal directori file found option refer defaultvalu configur file format configur file format similar microsoft window ini file configur file consist section led section header follow name valu entri exampl channel redirectionnon debuggerxterm option valu valu option attribut determin four differ way attribut set instanc object channeldebugg ddd given creat object class channel messagechannneldebugg ddd given ini file channel debugg ddd set default valu option def debuggerself return ddd section lookup option set differ section determin valu option framework first search section class section option use autoclass option member autoclass optionalattribut member stellar dynam interfac definit introduct chapter describ common interfac stellar dynam code paramet graviti dynam code least one specifi paramet paramet need specifi per code basi paramet access function follow templat get_ep set_ep function paramet access function may retriev updat valu singl paramet paramet set initialize_cod function call give code opportun prepar model autoclass amusecommunityinterfacegdgravitationaldynamicsinterfac member get_ep set_ep initialize_cod object manag gravit dynam code work particl star black hole ga follow method defin function creat remov queri particl code current interfac handl differ type particl autoclass amusecommunityinterfacegdgravitationaldynamicsinterfac member new_particl delete_particl get_number_of_particl get_index_of_first_particl get_index_of_next_particl object state particl gravit dynam well known minim state state defin locat veloc mass radiu state retriev updat follow function autoclass amusecommunityinterfacegdgravitationaldynamicsinterfac member get_stat set_stat object state extens mechan inform particl transfer get_stat set_stat function support properti like acceler code defin get_ set_ function function must get set one scalar properti argument vector properti argument autoclass amusecommunityinterfacegdgravitationaldynamicsinterfac member get_mass set_mass get_posit set_posit set_acceler get_acceler get_potenti model evolut gravit dynam code evolv properti particl time follow function need control evolut code autoclass amusecommunityinterfacegdgravitationaldynamicsinterfac member commit_particl evolv diagnost state code queri model calcul follow function use queri exact model time total energi collid particl autoclass amusecommunityinterfacegdgravitationaldynamicsinterfac member get_tim get_kinetic_energi get_potential_energi get_indices_of_colliding_particl get_center_of_mass_veloc get_center_of_mass_posit get_total_mass get_total_radiu servic gravit dynam code provid servic code current calcul graviti given point specifi function autoclass amusecommunityinterfacegdgravitationaldynamicsinterfac member get_gravity_at_point amus style guid style guid cover sourc code written amus project sourc exist code integr amus follow guid exist code rewritten python code python code consist python style guid httpswwwpythonorgdevpepspep_ defin deviat python style guid list document maximum line length limit line maximum charact line may longer charact especi increas readabl need defin class long name superclass long name line charact ok exampl class needsalongnametodescribeitsfunct acomplicatednameforthesuperclass better class needsalongnametodescribeitsfunct acomplicatednameforthesuperclass class needsalongnametodescribeitsfunct acomplicatednameforthesuperclass name convent name class method code import howev spend much time name use long name use longer name shorter name determin quickli youv defin long name use may harder use lot refactor shorter name present use lot least class method describ better longer name use abbrevi name especi use first three four letter word exampl dir directori ref refer also remov vowel shorten name exampl tmp temp follow one letter variabl allow loop variabl use x name allow x exampl x star print xmass loop index variabl use rang name allow thu write loop loop need use longer name exampl iter everi item tabl do row rang column rang print tablerowcolumn name allow short loop maximum line longer loop need better name also loop row indic column indic use row column c c code c c code consist googl c style guid httpsgooglegithubiostyleguidecppguidehtml_ file name c file cc suffix name convent follow python style name function name function name lowercas underscor word fortran code fortran code written amus fortran follow code standard given fortran code standard commun atmospher model httpwwwcesmucareduworking_groupssoftwaredev_guidedev_guidenodehtml_ file name fortran file f suffix layout sourc code follow free form fortran use fix form fortran layout indent use indent highlight block structur code function examplearg real arg exampl exampl arg end function use charact indent code code data introduct framework contain two distinct level interact code take place first level interact directli code implement set function class second level built top first level abstract function call handl object dataset often multipl functioncal first level abstract singl statement assign queri second level first level first level direct interfac code chapter kind function support first level interfac code briefli describ function defin first level fall two categori handl scalar singl valu paramet handl vector list valu paramet function handl vector vector must length note everi function fit two categori usual possibl rewrit function creat interfac function fit one two categori support two categori keep commun layer simpler allow optim commun python cfortran code exampl use first level scalar vector amusecommunitycodesathenainterfac import athenainterfac creat instanc code start applic background handl request hydro athenainterfac set paramet need code function handl one scalar input paramet hydroset_gamma hydroset_courant_friedrichs_lewy_numb defin grid cell direct total length grid direct function handl multipl scalar input paramet hydrosetup_mesh setup boundari condit period reflect outflow hydroset_boundari periodicperiod periodicperiod periodicperiod let code work athena alloc grid function handl scalar input paramet scalar output paramet hydrocommit_paramet let print center posit one grid point print hydroget_position_of_index call far function handl scalar valu next call function handl vector valu let print center posit grid point one line print hydroget_position_of_indexrang previou exampl use function scalar paramet vector paramet function handl vector often also handl scalar framework take care necessari convers first level function actual python function function instanc special python class implement function call handl continu exampl let take look kind function first level print hydroget_position_of_index ask specificit first level function print hydroget_position_of_indexspecif ad unit first step defin first level function specifi unit outputparamet first level function introduct document specifi lowlevel interfac commin code interfac follow pattern pattern describ bellow pattern use keep interfac code consist code differ physic domain help learn function interfac later chapter defin specif interfac modul differ physic domain actual interfac code deriv interfac interfac specifi lowlevel interfac lowlevel interfac support unit handl data convers attribut function handl nextlevel interfac describ nextlevel_ data type exact size byte type valu sent python layer commun code import document specifi type argument return valu current amus support type describ follow tabl type name size fortran c byte type type int integ long float doubl precis doubl float real float string n char function templat function interfac follow templat function return error statu code result return function argument c argument need pointer valid memori locat autoclass amusecommunityinterfaceexampleexampleinterfac member example_funct error code gener form zero stand error neg valu indic error happen posit valu return function end special state ok function encount error special state error someth went wrong execut function state function encount expect special state exampl code detect collis two star function categori paramet code number paramet paramet domain specif paramet found code specif domain exampl smooth length gravit dynam paramet defin use specif code domain specif paramet defin domain specif interfac code support paramet implement specifi function paramet access function follow templat meth amusecommunityinterfaceexampleexampleinterfaceget_example_paramet methamusecommunityinterfaceexampleexampleinterfaceset_example_paramet function autoclass amusecommunityinterfaceexampleexampleinterfac member get_example_paramet set_example_paramet function use access set get paramet may retriev updat valu singl paramet function set two paramet one go support nextlevel interfac paramet set methamusecommunityinterfaceexampleexampleinterfaceinitialize_cod function call give code opportun prepar model autoclass amusecommunityinterfaceexampleexampleinterfac member initialize_cod object manag code work particl grid star black hole ga method object manag categori defin function creat remov queri particl gridpoint code code support object code respons manag object code need assign uniqu index particl particl refer function call major differ muse code user code respons assign uniqu id particl chang make implement code simpler allow code support creation new object simul exampl hydrocod add delet gridpoint evolut model object state particl physic domain well known minim state exampl gravit dynam domain state particl defin locat vector veloc vector mass radiu method object state categori provid way access state one function object state extens mechan inform particl transfer get_stat set_stat function code may support properti particl code defin get_ set_ function properti function follow pattern defin paramet categori function must either get set scalar properti argument vector properti argument model evolut main function code often evolv model time solv steadi state solut method control model evolut start stop model calcul belong model evolut categori time pattern defin function categori diagnost state code queri model calcul function categori follow get_nam pattern state code chang function call function categori function must either get scalar properti argument vector properti argument servic code provid servic code physic domain exampl gravit dynam code might provid function calcul graviti forc point method provid servic belong categori directori structur amus sourcecod separ directori src sourc code implement environ test applic exampl unittest support build system test system src directori code need run amus found one view code librari use creat applic numer astrophys experi code contain build block need interfac code import export data unit convers amus function test directori applic test code found directori tree contain script complet astrophys experi also unittest found unit test cover small part unit function amus exampl test check import file amus data format support directori support code build system found src directori directori src directori split commun contain sourc code exist astrophys applic glue code amus interfac class word directori contain implement interfac support contain amus gener code defin data represent inputoutput routin also provid gener unit handl code code interfac commun directori use function class provid function test directori directori test directori split unit_test unit test code test code use standard unit test framework includ python distribut unittest see python modul document inform httpdocspythonorglibraryunittesthtml applic contain sourc code publish applic exampl contain document exampl code support directori directori support directori split test script support test amus code build script use build system amus input output framework introduct read write file done subclass classfileformatprocessor class extend autoclass amuseiofileformatprocessor member autoclass amuseiofulltextfileformatprocessor member stop condit introduct code amus evolv model three loop inner outer loop script loop inner loop control code evolv model suffici small step limit error abl simul import physic outer loop invok inner loop condit met specifi amus script amus script script loop interact outer loop graphviz digraph layer fontsiz node fontsizeshapebox stylefil fillcolorlightyellow width subgraph cluster fontsiz stylefil colorazur labeljustl labelamus script script loop subgraph cluster fontsiz stylefil colorazur labeljustl labelcommun code outer loop inner loop script loop outer loopminlen outer loop inner loop script loop script loop dirback constraintfalseminlen headports tailportn outer loop outer loopdirback constraintfals headports tailportn inner loop inner loopdirback constraintfals headports tailportn amus outer loop alway limit model time everi funcevolve_model call one argument model time simul go beyond time time control return caller process shown follow code exampl codeblock c exampl outer loop void outer_loopdoubl end_tim whilemodel_tim end_tim inner_loop model_tim delta_time_for_this_step return model time often enough control loop situat call earlier break loop model time reach end time abl break outer loop end time reach framework support stop condit follow code exampl show condit might work c code codeblock c exampl outer loop stop condit void outer_loopdoubl end_tim int special_condition_was_met whilemodel_tim end_tim inner_loop check_if_special_conditions_are_met model_tim delta_time_for_this_step ifspecial_condition_was_met break return exampl code might abl detect collis two star user want handl event code would proceed end time collis long user way know collis handl imag stopping_conditions_collisionpng stop condit framework amus provid function use implement stop condit framework use simpl tabl code translat tabl object python script next section use framework describ final section implement framework commun code describ use stop condit interact stop condit code via attrstopping_condit attribut classcodeinterfac class attrstopping_condit attribut queri return classstoppingcondit object classstoppingcondit object attribut stop condit support amus attribut follow name collision_detect outer loop break two star connect pair_detect outer loop break two star pair possibl creat binari star escaper_detect outer loop break star escap simul longer gravit bound star timeout_detect outer loop break certain amount comput wallclock time elaps number_of_steps_detect outer loop break certain amount step iter reach note classcodeinterfac object provid object orient interfac code classstoppingcondit object provid string represent describ support condit state codeblock python amuselab import code hermit print codestopping_condit stop condit hermit object support condit collision_detect pair_detect timeout_detect enabl condit none set condit none codestop everi attribut user determin support enabl hit funcevolv loop codeblock python amuselab import code hermit print codestopping_conditionscollision_detectionis_support true print codestopping_conditionscollision_detectionis_en fals print codestopping_conditionscollision_detectionis_set fals codestop stop condit hit inner outer loop evalu user queri particl involv particl involv store column pair wise detect collect pair condit provid two column first column contain first particl pair second column contain second particl pair column queri methparticl method stop condit attribut method take one argument column index return particl subset involv particl pair particl particl codeblock python amuselab import code hermit sc codestopping_conditionscollision_detect scenabl codeevolve_model nbody_systemtim print scis_set true print scparticl pair scparticl scparticl codestop implement stop condit code support stop condit must implement classstoppingconditioninterfac interfac easili done inherit classstoppingconditioninterfac implement function defin interfac codeblock python class mycodeinterfacecodeinterfac stoppingconditioninterfac classstoppingconditioninterfac interfac model interfac simpl data model best describ two tabl defin stop condit tabl tabl list type stop condit support code enabl user type support enabl int int int read readwrit type type stop condit integ n defin framework support stop condit support otherwis need set implement enabl enabl user otherwis implement must provid mechan set unset field set stop condit tabl tabl row stop condit set outer inner loop evalu everi row list type condit set particl involv id last particl list must type particl particl particlen int int int int int type type stop condit integ n defin framework set code particlen index particl involv stop condit index last particl must autoclass amusesupportcodesstopping_conditionsstoppingconditioninterfac member interfac contain lot function implement might time consum task help implement interfac amus provid c librari tabl manag librari describ next section use stop condit librari stop condit tabl implement static c librari librari part amus distribut found libstopcond directori librari implement function classstoppingconditioninterfac interfac provid number function code implement actual set support stop condit librari implement stop condit detect routin implement per code basi function librari limit manag stop condit tabl librari control code stop condit set librari implement defin stop condit tabl three long integ integ use bitmap state individu bit use determin condit true fals individu bit test follow macro data collision_detection_bitmap data pair_detection_bitmap data escaper_detection_bitmap data timeout_detection_bitmap data number_of_steps_bitmap three variabl access directli fortran code stop condit librari special function fortran access three global variabl cvar long enabled_condit individu bit set user enabl stop condit access fortran codeblock fortran includ libstopcondstopcondinc integ is_stopping_condition_en integ is_collision_detection_en integ error error is_stopping_condition_enabledcollision_detect is_collision_detection_en cvar long set_condit individu bit set condit detect code cfuncset_stopping_condition_info fill bitmap access fortran codeblock fortran includ libstopcondstopcondinc integ is_stopping_condition_set integ is_collision_detection_set integ error error is_stopping_condition_setcollision_detect is_collision_detection_set cvar long supported_condit codeblock fortran set_supported_condit individu bit set support condit global must defin code code support collis detect timeout detect variabl defin c codeblock c set_support_for_conditioncollision_detect set_support_for_conditionpair_detect fortran codeblock fortran includ libstopcondstopcondinc set_support_for_conditioncollision_detect set_support_for_conditionpair_detect refer type stop condit librari defin follow macro data collision_detect data pair_detect data escaper_detect data timeout_detect data number_of_steps_detect follow four function use set reset stop condit cfunction int reset_stopping_condit reset stop condit need call enter outer_loop codeblock c void outer_loopdoubl end_tim reset_stopping_condit whilemodel_tim end_tim cfunction int next_index_for_stopping_condit reserv row stop condit tabl need call detect stop condit code fill stop condit inform codeblock c ifcollision_detection_bitmap enabled_condit int row next_index_for_stopping_condit set_stopping_condition_inforow collision_detect cfunction int set_stopping_condition_infoint index int type set type stop condit encount given row index use one predefin type macro type argument codeblock c set_stopping_condition_inforow collision_detect cfunction int set_stopping_condition_particle_indexint index int column_index int index_of_particl set id particl involv stop condit need stop condit particl codeblock c set_stopping_condition_inforow collision_detect set_stopping_condition_particle_indexstopping_index identi set_stopping_condition_particle_indexstopping_index identj stop condtion paramet timeout number step stop condit paramet base ie condit met outer loop took certain time reach certain number step iter paramet access follow procedur cfunction int set_stopping_condition_timeout_parameterdoubl valu set comput wallclock time paramet cfunction get_stopping_condition_timeout_parameterdoubl valu get comput wallclock time paramet cfunction int set_stopping_condition_number_of_steps_parameterint valu set number step paramet cfunction int get_stopping_condition_number_of_steps_parameterint valu get number step paramet mpi enabl code stop condit must distribut collect follow three function use manag mpi commun cfunction int mpi_setup_stopping_condit setup global mpi commun need call per code execut exampl funcinitialize_cod function cfunction int mpi_distribute_stopping_condit distribut state condit process know condit enabl user need call parallel code enter data distribut cfunction int mpi_collect_stopping_condit collect individu tabl set condit combin one tabl root process mpi rank need call end parallel part code procedur ad stop condit explain follow step add compil linker flag build script makefil use stopcond librari compil link step commun code must chang follow compil flag need ad iamuse_dirlibstopcond link step follow linker flag need lamuse_dirlibstopcond lstopcondmpi includ header file defin global name header file stopcondh header file need includ file refer stop condit codeblock c includ stopcondh code take care set cdatasupported_condit bitmap initi eg codeblock c set_support_for_conditioncollision_detect set_support_for_conditionpair_detect fortran includ stopcondinc subroutin requir constant codeblock fortran includ libstopcondstopcondinc set_support_for_conditioncollision_detect set_support_for_conditionpair_detect check condit enabl set condit found c codeblock c int is_collision_detection_en is_stopping_condition_enabledcollision_detect is_collision_detection_en ifis_collision_detection_en real sum_of_the_radii radius_of_stari radius_of_starj distance_between_star sum_of_the_radii int stopping_index next_index_for_stopping_condit set_stopping_condition_infostopping_index collision_detect set_stopping_condition_particle_index stopping_index identifier_of_stari set_stopping_condition_particle_index stopping_index identifier_of_starj fortran codeblock fortran includ libstopcondstopcondinc integeris_stopping_conditions_en integeris_collision_detection_en stopping_index integererror error is_stopping_condition_enabledcollision_detect is_collision_detection_en is_collision_detection_enabledeq there_is_a_collis stopping_index next_index_for_stopping_condit error set_stopping_condition_infostopping_index collision_detect endif endif break outer loop condit set cdataset_condit test codeblock c ifset_condit break codeblock fortran includ libstopcondstopcondinc integeris_any_condition_set is_any_condition_seteq exit end good exampl code implement stop condit hermit commun code code found srcamusecommunityhermit directori _referencelabel refer document toctre maxdepth quantities_and_unit particl particle_attribut bridg availablecod core_support legacy_support fileformat report stopping_condit from_codes_to_data ioframework option directorystructur incode_storag cudasetup simplified_function_interfac interface_specif messageprotocol distribut cartesiu slurm style_guid code_manag glossari particl attribut particl attribut defin pymodamusedatamodelparticle_attribut attribut access two way particl function import modul access particl first paramet usual call particl must given access function directli codeblock python amusedatamodelparticle_attribut import amuselab import new_plummer_spher particl new_plummer_spher print kinetic_eneryparticl access function attribut codeblock python amuselab import new_plummer_spher particl new_plummer_spher print particleskinetic_energi automodul amusedatamodelparticle_attribut member run amus slurm mani supercomput use slurm see httpsslurmschedmdcomdocumentationhtml jobsubmiss environ cartesiu supercomput exampl use slurm also leiden univers supercomput alic httpswikialiceuniversiteitleidennlindexphptitlealice_user_documentation_wiki_ga parallel amus script slurm oper via batch script written subsequ submit via slurm job schedul use simpl amus exampl code exampl codeblock sh cd amuse_direxamplestutorialparallel_amuse_scriptpi slurm batch script slurm script run code processor calld run_examplesh codeblock sh binbash sbatch eot binsh sbatch mem sbatch p cpushort sbatch n sbatch n export omp_num_thread export ompi_mca_rmaps_base_oversubscribey export ompi_mca_mpi_warn_on_fork export ompi_mca_rmaps_base_oversubscribey modul load amusefossapython modul load openmpigcc modul load matplotlibfossbpython mpiexec n python u parallel_amuse_scriptpi eot variou ingredi script identifi amount memori request queue call cpushort number node processor next block environ variabl set variou modul load final mpiexec command start python scrip processor run script call parallel_amuse_scriptpi run script slurm script gener start command line exampl codeblock sh sbatch run_examplesh output subsequ download via scp codeblock sh scp userremote_computer_addressfil report run autoclass amuseioreportt member stellar evolut interfac definit introduct chapter describ common interfac stellar evolut code current interfac stellar evolut code store state star specifi stellar evolut code get need state function interfac stateless yet describ paramet stellar evolut code least one specifi paramet paramet need specifi per code basi paramet access function follow templat get_metal set_metal function paramet access function may retriev updat valu singl paramet paramet set initialize_cod function call give code opportun prepar model autoclass amusecommunityinterfacesestellarevolut member get_metal set_metal initialize_cod object manag number stellar evolut code work star object follow method defin function creat remov queri particl code current interfac specifi queri function stellar evolut see stellar evolut possibl direct autoclass amusecommunityinterfacesestellarevolut member new_particl delete_star object state support properti like acceler code must defin get_ set_ function function must get set one scalar properti argument vector properti argument current get function specifi autoclass amusecommunityinterfacesestellarevolut member get_mass get_radiu get_luminos get_temperatur get_ag get_stellar_typ get_stellar_typ model evolut stellar evolut code evolv properti star time follow function need control evolut code autoclass amusecommunityinterfacesestellarevolut member commit_particl evolv diagnost state code queri model calcul current specif stellar evolut diagnost function defin servic stellar evolut code provid servic code current specif stellar evolut servic function defin _supportedcodeslabel current support commun code introduct note document uptod provid overview current support commun code amus along concis explan code work document serv initi guid find code highest applic specif astrophys problem support code sort accord astrophys domain refdynam refevolut refhydrodynam refradiativetransf _dynam stellar dynam bhtree_ hermite_ higpus_ huayno_ mercury_ mmc_ octgrav_ phigrape_ smalln_ twobody_ gener gener paramet method gravit dynam describ docreferencestellar_dynamics_interface_specif describ except specif code specif code comparison tabl note hold amus implement name approxim scheme timestep scheme cpu gpu grape languag stopcond parallel bhtree tree sharedfix n n cc cst n bonsai tree fi tree blockvari n n fortran n hermit direct sharedvari n n cc csopt higpu direct block time step n n cc gpu cluster huayno approx symplect yopencln c n gadget tree individu n n cc mercuri mv symplect n n fortran n octgrav tree share n n cc n rebound n phigrap direct blockvari g fortan cspt n sapporo smalln direct hermit th individu n n cc n order twobodi univers variabl none exact n n python n kepler eq stop condit code name stop condit c collis detect e escap detect number step detect box detect p pair detect timeout detect parallel follow sens amus use mpi commun code code use parallel calcul code gpu alreadi parallel howev tabl refer code design parallel set number parallel worker eg set worker hermit codeblock python instanc hermitenumber_of_work _bhtree bhtree nbodi integr modul implement barn hut tree code bh_ jun makino bhtreecod httpjunartcompsciorgsoftwaresctreeindexhtml_ specif paramet name default valu unit descript use_self_grav none flag usag self graviti true fals timestep time time step epsilon squar lengthlength smooth paramet graviti calcul ncrit_for_tre none maximum number p articl share interact list opening_angl none open angl theta build tree stopping_conditions_number_of_step none stopping_conditions_timeout second stopping_conditions_out_of_box_s length time time current simul time dt_dia time time interv diagnost output automodul amusecommunitybhtreeinterfac autoclass bhtree autoparametersattribut paramet exampl codeblock python amusecommunitybhtreeinterfac import bhtreeinterfac bhtree amuseunit import nbody_system instanc bhtreebhtreenbodi instanceparametersepsilon_squar nbody_systemlength bh barn j hut p natur _hermit hermit timesymmetr nbodi integr modul share variabl time step particl size chang time use hermit integr scheme hutmakino_ see also ac httpwwwartcompsciorg_ specif paramet name default valu unit descript pair factor none radiu factor pair detec tion dt_param none timestep scale factor epsilon squar lengthlength smooth paramet graviti calcul stopping_conditions_number_of_step none stopping_conditions_timeout second stopping_conditions_out_of_box_s length time time current simul time dt_dia time time interv diagnost output automodul amusecommunityhermiteinterfac autoclass hermit autoparametersattribut paramet hutmakino hut p makino j mcmillan apjl l _phigrap phigrap phigrap direct nbodi code optim run parallel grape cluster see harfst et al harfst_ detail amusean version capabl work platform well use interfac mimic grape hardwar sapporo sapporo librari mimic behaviour grape hardwar use gpu execut forc calcul gaburov_ sapporolight version sapporo without multithread support need c make easier integr fortran code bewar use one gpu devic per applic g librari mimic behavior grape use cpu lowest hw requir specif hardwar mode paramet amus tri build implement compil time phigrap interfac modul prefer mode select whith mode paramet mode_glib glib make work optim special hw requir mode_gpu gpu use sapporo cuda need mode_grap grape use grape hw mode_pg pg phantom grape optim x_ processor codeblock python amusecommunityphigrapeinterfac import phigrapeinterfac phigrap instanc phigrapephigrapenbodi phigrapeinterfacemode_gpu default mode_glib name default valu unit descript initialize_gpu_onc none set gpu must initi initi everi callnif want run multipl instanc code gpu paramet need default initial_timestep_paramet none paramet determin initi timestep timestep_paramet none epsilon squar lengthlength smooth paramet graviti calcul stopping_conditions_number_of_step none stopping_conditions_timeout second stopping_conditions_out_of_box_s length automodul amusecommunityphigrapeinterfac autoclass phigrap autoparametersattribut paramet codeblock python instancetimestep_paramet nbody_systemtim harfst harfst gualandri merritt spurzem r portegi zwart berczik p newastron gaburov gaburov e harfst portegi zwart newastron _twobodi twobodi semi analyt code base kepler bate_ particl set provid length one two one particl given mass assign particl origin phasecoordin assign particl useful specif paramet bate bate rr mueller dd white je fundament astrodynam dover _smalln smalln interfac kira smalln integr kepler modul starlab httpswwwsnsiasedustarlab need download starlab site make instal set starlab_install_path variabl equal instal directori typic someth like starlabusr starlab avail gnu gener public licenc version develop piet hut steve mcmillan jun makino simon portegi zwart starlab contributor dougla heggi kimberli engl peter teuben specif paramet name default valu unit descript epsilon squar lengthlength smooth paramet graviti calcul number_of_particl none method _octgrav octgrav treecod run gpu nvidia cuda architectur oct_ specif paramet name default valu unit descript opening_angl none open angl build tree timestep time constant timestep iter epsilon squar lengthlength smooth paramet graviti calcul stopping_conditions_number_of_step none stopping_conditions_timeout second stopping_conditions_out_of_box_s length automodul amusecommunityoctgravinterfac autoclass octgrav autoparametersattribut paramet oct gaburov e bedorf j portegi zwart gravit treecod graphic process unit implement cuda icc specif paramet name default valu unit descript opening_angl none open angl build tree timestep time constant timestep iter epsilon squar lengthlength smooth paramet graviti calcul stopping_conditions_number_of_step none stopping_conditions_timeout second stopping_conditions_out_of_box_s length _mercuri mercuri mercuri generalpurpos nbodi integr packag problem celesti mechan packag contain subroutin taken swift integr packag hflevison mjduncan icaru vol pp routin taken swift name begin drift orbel standard symplect mv algorithm describ jwidsom mholman astronom journal vol pp hybrid symplect algorithm describ jechamb monthli notic ra vol pp current mercuri interfac differ grav dyn interfac class call mercurywayward loos predic interfac standard work progress handl two kind particl centre_particl orbit centre_particl restrict contain one particl heaviest much heavier orbit origin phase space appart usual phase space coordin particl spin mercuri centr particl oblat paramet express moment orbit densiti furthermor mercuri use nbodi unit instead unit list tabl central particl mass msun radiu au oblat j j j au etc angluar msun au day momentum orbit mass msun densiti gcm posit x z au veloc vx vy vz auday celimit close hill radii encount unitsnon amus angluar lx ly lz msun au day momentum automodul amusecommunitymercuryinterfac autoclass mercurywayward autoparametersattribut paramet _huayno huayno hierarch splitup approxim symplect nbodi solver huayno inti pelupessi januari short descript huayno code solv astrophys nbodi problem use recurs hamiltonian split gener multipletimestep integr conserv momentum machin precis number differ integr avail code develop within amus environ make use gpu opencl version compil use use code graviti code within amus three paramet code smooth length squar ep timestep paramet eta paramet select integr timestep_paramet eta recommend valu eta epsilon_squar ep ep zero nonzero inttype_paramet inttyp possibl valu inttyp describ miscellan code assum g collis implement need rewrit workermp option use openmp parallel float point precis calcul chang set float doubl definit evolveh float set precis calcul doubl precis posit veloc reduct set eg float doubl long doubl __float advantag choos set doubl higher precis float recommend combin doubl long doubl amus interfac use doubl precis unlik integ type evolveh would need chang int abl hold particl number long abl hold interact count opencl oper compil worker_cl possibl offload forc timestep loop gpu implement base stdcl librari wwwbrowndeertechnologycom librari compil first makefil correspond directori point instal directori stdcl defin evolce_clh set appropi opencl configur clcontext stdgpu stdcpu nthread gpu cpu actual also work cpu fine blocksiz number particl store local memori good start guess evolve_kerncl contain opencl kernel precis calcul control float defin evolve_kerncl clfloat evolveh agre ie float cl_float doubl cl_doubl _mmc mont carlo giersz mnra giersz mnra giersz mnra specif paramet name descript irun initi sequenc random number nt total number f object sta rs binari ns number singl tar nb number f binari nt nsnb nss number star snss ntnb istart initi model ne restart ncor number star calcul central paramet nmin minimum number star calcul central paramet nz number star zone nzonc minimum number zone core nminzo minimum number star zone ntwo maximum index imodel initi model uniform isotrop plummer king iprint full diagnost inform diagnost info suppress ibf spitzer heggi formula threebodi binari interact field star use pmax interact probabl three fourbodi numer integr iexch exchang interact exchang binari field star interacion exchang interact binari field binari binari tcrit termin time unit cross time tcomp maximum comput time hour qe energi toler alphal powerlaw index initi mass function mass smaller break mass equal mass case alphah powerlaw index initi mass function mass greater break mass alphalalphah imf break brakem mass imf broken brakem smaller minimum mass bodyn break mass kroupa mass function brakem mo bodi maximum particl mass scale solar mass bodyn minimum particl mass scale solar mass fracb primordi binari fraction number nb fracbnt ns fracbnt nss fracbnt fracb primordi binari fracb dynam binari amin minimum semimajor axi binari sollar unit amin rr amin amin amax maximum semimajor axi binari sollar unit qvir virial ratio qvir equilibrium rbar tidal radiu pc halfmass radiu pc isol cluster scale rbar zmbar total mass cluster sollar mass scale zmbar w king model paramet bmin minimum valu sinbeta bmax maximum valu sinbeta tau time step complit cluster model gamma paramet coulomb logarithm standard valu xtid coefici front cluster tidal energi xtidsmtrtid rplum rtid rplumrsplum rsplum scale radiu plummer model dttp time step myr profil output dtte time step myr mloss call object dtte time step myr mloss call object tphi less tcrevo tphi greater tcrevo time step eqiual dtte tcrevo critic time time step mloss call chang dtte dtte xtau call mloss particlular object uptimeim olduptimeimtautscal xtau ytau multipl tau tau ytautau time greater tcrevo ybmin multipl bmin bmin ybminbmin time greater tcrevo zini initi metal solar z globular cluster z ngc z ikroupa initi binari paramet pick accord kroupa eigenevolut feed algorithm kroupa mnra initi binari paramet pick model hurley et al iflagn sn natal kik ns format sn natal kick singl ns format sn natal kick singl ns format ns format binari iflagbh sn natal kik bh format sn natal kick singl bh format sn natal kick singl bh format bh format binari nitesc iter tidal radiu induc mass loss due stellar evolut iter tidal radiu induc mass loss due stellar evolut automodul amusecommunitymmcinterfac autoclass mmc higpu higpu parallel direct nbodi code base th order hermit integr code develop capuzzodolcetta punzo spera dep physic sapienza univ di roma see astrowwwphysuniromaitdolcettahpccodeshigpushtml use time mpi openmp cuda librari fulli exploit capabl offer hybrid supercomput platform moreov implement use block time step individu time step abl deal stiff problem like highli collision gravit nbodi problem specif paramet name default valu unit descript eta_ none eta paramet determin star time step eta_ none eta paramet initi block ep length smooth paramet graviti calcul r_scale_galaxi length scale radiu analyt galaxi potenti mass_galaxi mass total mass analyt galaxi potenti r_core_plumm length core radiu analyt plummer potenti mass_plumm mass total mass analyt plummer potenti start_tim time initi simul time min_step none expon defi ne minimum time step allow star expon max_step none expon defi ne maximum time step allow star expon n_print none maximum number snapshot dt_print time time interv diagnost output n_gpu none number gpu per node gpu_nam geforc gtx none gpu use thread none number gpu thread per block output_path_nam test_r none path higpu sult output store inform paramet check readm file doc folder maximum perform gflop reach use differ singl gpu instal one time workstat equip cpu intel xeon x gb ecc ram memori mhz ubuntu lucid x_ motherboard supermicro xdtgqf tesla c tesla c tesla geforc gtx geforc gtx use code amp gpu download opencl version websit automodul amusecommunityhigpusinterfac autoclass higpu autoparametersattribut paramet _evolut stellar evolut bse_ evtwin_ mesa_ seba_ sse_ _sse sse stellar evolut perform rapid singlestar evolut sse algorithm packag analyt formula fit detail model pol et al cover phase evolut zeroag mainsequ includ remnant phase valid mass rang msun metal vari sse packag contain prescript mass loss stellar wind also follow evolut rotat angular momentum star full detail found sse paper comprehens analyt formula stellar evolut function mass metal hurley jr pol tout ca mnra min max unit mass msun metal fraction solar automodul amusecommunitysseinterfac autoclass sse autoparametersattribut paramet _bse bse binari evolut perform rapid binarystar evolut bse algorithm circular eccentr orbit synchron stellar rotat orbit motion owe tidal interact model detail angular momentum loss mechan gravit radiat magnet brake also model wind accret secondari may accret materi lost primari wind allow necessari adjust made orbit paramet event mass variat mass transfer also occur either star fill roch lobe may proceed nuclear thermal dynam timescal latter regim radiu primari increas respons massloss faster rate rochelob star star deep surfac convect zone degener star unstabl dynam timescal mass loss unless mass ratio system less critic valu outcom commonenvelop event primari giant star result merg format close binari direct merg primari white dwarf lowmass mainsequ star hand mass transfer nuclear thermal timescal assum steadi process prescript determin type rate mass transfer respons secondari accret outcom merger event place bse detail found bse paper evolut binari star effect tide binari popul hurley jr tout ca pol mnra comprehens analyt formula stellar evolut function mass metal hurley jr pol tout ca mnra min max unit mass msun metal fraction solar period eccentr automodul amusecommunitybseinterfac autoclass bse autoparametersattribut paramet _seba seba singlestar binari evolut perform rapid stellar evolut algorithm seba star evolv zeroag main sequenc remnant format beyond singl stellar evolut model analyt formula base fit detail singl star track differ metal hurley pol tout star parametris mass radiu luminos core mass etc function time initi mass mass loss wind substanti eg massiv star post mainsequ star includ furthermor seba packag contain algorithm rapid binari evolut calcul binari interact wind accret tidal interact angular momentum loss wind mass loss magnet brake gravit radiat taken account everi timestep appropri recip stabil rate mass transfer depend reaction mass chang stellar radii correspond roch lobe mass transfer take place dynam timescal donor star mass transfer becom quickli unstabl commonenvelop phase follow mass transfer occur stabl way seba model respons companion star possibl mass loss angular momentum loss everi timestep mass transfer ceas binari system donor star turn remnant heliumburn star without hydrogen envelop instead mass transfer lead merger binari star result stellar product estim subsequ evolut follow inform seba found paper relev paper popul synthesi highmass binari portegi zwart sf verbunt f p popul synthesi doubl white dwarf close detach system neleman g yungelson lr portegi zwart sf verbunt f n supernova type ia progenitor merg doubl white dwarf use new popul synthesi model toonen neleman g portegi zwart effect commonenvelop evolut visibl popul postcommonenvelop binari toonen neleman g min max unit mass msun metal fraction solar period eccentr automodul amusecommunitysebainterfac autoclass seba autoparametersattribut paramet _evtwin evtwin evtwin base peter eggleton stellar evolut code actual solv differenti equat appli interior star therefor accur also much slower analyt fitsbas sse_ seba_ algorithm explain binari yet support amus interfac evtwin neither workaround helium flash current solar metal relev paper evolut low mass star eggleton pp mnra composit chang stellar evolut eggleton pp mnra numer treatment doubl shell sourc star eggleton pp mnra approxim equat state stellar materi eggleton pp faulkner j flanneri bp aa possibl criterion envelop eject asymptot giant branch first giant branch star han z podsiadlowski p eggleton pp mnra approxim input physic stellar model pol tout ca eggleton pp han z mnra brake wind eggleton pp evolut binari multipl star system complet survey case binari evolut comparison observ algoltyp system nelson ca eggleton pp apj evolut cool algol eggleton pp kiselevaeggleton l apj thermohalin mix stancliff glebbeek izzard pol aa opal opac tabl eldridg tout mnra enhanc solver glebbeek pol hurley aa automodul amusecommunityevtwininterfac autoclass evtwin autoparametersattribut paramet _mesa mesa softwar project mesa modul experi stellar astrophys httpmesasourceforgenet_ aim provid stateoftheart robust effici open sourc modul usabl singli combin wide rang applic stellar astrophys sinc packag rather big mb download gb built commun code option instal automat set environ variabl do_install_mesa run make download instal amus interfac mesa creat evolv star use mesastar modul order metal havent use start model comput automat save mesasrcdatastar_datastarting_model directori pleas patient metal support even interest case z support stellar mass rang msun refer paxton bildsten dotter herwig lesaffr timm apj submit arxiv httpmesasourceforgenet_ automodul amusecommunitymesainterfac autoclass mesa autoparametersattribut paramet _hydrodynam hydrodynam athena_ grid code capreole_ grid code fi_ nbodysph code gadget_ nbodysph code _athena athena athena gridbas code astrophys hydrodynam athena solv magnetohydrodynam mhd well current support amus develop primarili studi interstellar medium star format accret flow current version athena v implement algorithm follow physic compress hydrodynam mhd ideal ga equat state arbitrari γ includ γ isotherm eo arbitrari number passiv scalar advect flow selfgrav andor static gravit potenti ohmic resist ambipolar diffus hall effect navierstok anisotrop braginskii viscos isotrop anisotrop thermal conduct opticallythin radi cool addit athena allow follow grid parallel option cartesian cylindr coordin static fix mesh refin shearingbox sourc term orbit advect algorithm mhd parallel use domain decomposit mpi varieti choic also avail numer algorithm differ riemann solver spatial reconstruct method relev refer gardin stone jcp jcp method gardin stone jcp jcp method stone et al apj method stone gardin newa van leer integr skinner ostrik apj cylindr integr stone gardin apj shear box method automodul amusecommunityathenainterfac autoclass athena autoparametersattribut paramet _capreol capreol capreol gridbas astrophys hydrodynam code develop garrelt mellema work one two dimens three spatial dimens program fortran parallel mpi hydrodynam reli roeeulderinkmellema rem solver approxim riemann solver arbitrari metric solv differ hydrodynam problem capreol run singl processor also massiv parallel system eg processor bluegenel refer capreol origin version mellema eulderink ick aa automodul amusecommunitycapreoleinterfac autoclass capreol autoparametersattribut paramet _fi fi fi parallel treesph code galaxi simul extens rewritten extend parallel develop code jeroen gerritsen roelof bottema goe back treesph relev refer hernquist katz apj gerritsen ick aa pelupessi van der werf ick aa pelupessi phd thesi leiden observatori automodul amusecommunityfiinterfac autoclass fi autoparametersattribut paramet _gadget gadget gadget comput gravit forc hierarch tree algorithm option combin particlemesh scheme longrang gravit forc current support amus interfac repres fluid mean smooth particl hydrodynam sph code use studi isol system simul includ cosmolog expans space without period boundari condit type simul gadget follow evolut self gravit collisionless nbodi system allow ga dynam option includ forc comput time step gadget fulli adapt dynam rang principl unlimit relev refer springel v mnra gadget springel v yoshida n white new astronomi gadget automodul amusecommunitygadgetinterfac autoclass gadget autoparametersattribut paramet _radiativetransf radi transfer simplex_ delaunay triangul base simplex simplex comput transport radiat irregular grid compos delaunay triangul particl set radiat transport along vertic triangul code consid particl base radi transfer code case particl sampl ga densiti absorb sourc radiat calcul time simplex scale linearli number particl moment code calcul transport ioniz radiat grey one frequenc approxim especi well suit coupl sph code specif particl set send simplex must attribut x pc ypc zpc rho amucm flux xion none care must taken particl set fit box_siz default hilbert_ord work particl distribut automodul amusecommunitysimplexinterfac autoclass simplex autoparametersattribut paramet refer paardekoop jp phd thesi univers leiden paardekoop jp kruip c j h ick v aa simplex ritzerveld j ick v phi rev e simplex work progress instal prerequisit full amus instal need instal depend instal via packag manag eg apt yum linux macport homebrew maco ubuntu choos openmpi mpich desir work amus pleas instal exampl choos gcc compil recent version gcc also work openmpi codeblock sh sudo aptget instal buildessenti gfortran pythondev libopenmpidev openmpibin libgsldev cmake libfftw libfftwdev libgmpdev libmpfr libmpfrdev libhdfserialdev hdftool libblasdev liblapackdev pythonvenv pythonpip git mpich codeblock sh sudo aptget instal buildessenti gfortran pythondev mpich libmpichdev libgsldev cmake libfftw libfftwdev libgmpdev libmpfr libmpfrdev libhdfserialdev hdftool libblasdev liblapackdev pythonvenv pythonpip git maco maco first need instal xcode via app store maco big sur later may add follow line bashrc zshrc profil codeblock sh export sdkrootlibrarydevelopercommandlinetoolssdksmacosxsdk section assum default maco instal big sur macport method homebrew also work choos openmpi mpich desir work amus pleas make sure set compil instal default greatli simplifi thing later exampl choos gcc compil version gcc also work openmpi codeblock sh sudo port instal gcc openmpigcc hdf gsl cmake gmp mpfr fftw gcc openbla lapack sudo port instal python sudo port select set mpi openmpigccfortran sudo port select set gcc mpgcc sudo port select set python python mpich codeblock sh sudo port instal gcc mpichgcc hdf gsl cmake gmp mpfr fftw gcc openbla lapack sudo port instal python sudo port select set mpi mpichgcc sudo port select set gcc mpgcc sudo port select set python python instal amus instal prerequisit instal amus option first creat virtual environ instal amus desir python packag ensur dont need root privileg amus environ isol systeminstal packag creat virtual environ desir directori codeblock sh python venv amuseenv environ creat activ codeblock sh amuseenvbinactiv may want make alia eg codeblock sh alia amuseenv virtualenvironmentsamuseenvbinactiv point prompt amuseenv front alway know your virtual environ use pip instal prerequisit python modul amus codeblock sh pip instal upgrad pip pip instal numpi docutil mpipi hpi wheel probabl youll want instal python modul codeblock sh pip instal scipi astropi jupyt panda seaborn matplotlib final instal amus done easiest via pip codeblock sh pip instal amuseframework pip instal amus requir subset amus instal individu packag codeblock sh pip instal amuseframework pip instal amusecommunity_code_nam reinstal note troubleshoot pip instal packag instal pip distribut sourc packag must compil librari instal local machin compil pip save binari packag version cach case problem amus instal use pip environ chang may necessari clean pip cach eg cachepip addit cach disabl use nocachedir option nobuildisol may also tri case virtualenv prerequisit build still fail noclean pip instal option preserv build directori debug purpos actual directori report verbos mode v develop build altern instal amus develop build allow modifi sourc code potenti also conveni encount issu instal specif code buildlog file root directori repositori contain error log instal process instal also handl pip execut root clone repositori codeblock sh pip instal e code need build codeblock sh python setuppi develop_build individu code build codeblock sh make codecod code name code lower case get start amus amus base python your new python youll find offici python document httpsdocspythonorg_ valuabl resourc like python basic two way use amus firstli directli via interact python command line codeblock sh python python default nov clang clang darwin type help copyright credit licens inform quit secondli write python script suppos wrote follow script myscriptpi save current work directori codeblock python amuseunitsunit import amuseunit import constant def convert_to_freqwavelength nanom function convert wavelength frequenc use speed light vacuum printth speed light vacuum constantsc printwavelength frequenc wavelength wavelength printwavelength constantscwavelengthas_quantity_ingigahz script execut amus interact command line codeblock python import myscript helpmyscript tell myscript exampl function convert wavelength frequenc myscriptconvert_to_freq speed light vacuum wavelength frequenc nm ghz nm ghz nm ghz nm ghz nm ghz amuseunitsunit import myscriptconvert_to_freq cm speed light vacuum wavelength frequenc cm ghz cm ghz cm ghz quit also run script directli termin prompt call python file name argument execut file need add follow line script tell script function call execut codeblock python __name__ __main__ convert_to_freq script execut directli termin prompt codeblock sh python myscriptpi speed light vacuum wavelength frequenc nm ghz nm ghz nm ghz nm ghz nm ghz exampl interact session exampl interact session amus show interfac typic gravit dynam legaci code work use barn hut tree code dynam sunearth system solv twobodi problem chosen simplic cours exactli tree code normal use first import necessari amus modul codeblock python amusecommunitybhtreeinterfac import bhtree amusedatamodel import particl amuseunit import nbody_system amuseunit import unit gravit dynam legaci code usual work nbodi httpsenwikipediaorgwikinbody_unit unit intern tell code convert natur unit specif system creat instanc legaci code class codeblock python convert_nbodi nbody_systemnbody_to_si unitsmsun e unitskm instanc bhtreeconvert_nbodi tell instanc chang one paramet initi codeblock python instanceparametersepsilon_squar unitsau creat two particl properti set sun earth hand bhtree instanc codeblock python star particl sun star sunmass unitsmsun sunposit unitsm sunveloc unitsm unitss sunradiu unitsrsun earth star earthmass e unitskg earthradiu unitskm earthposit unitsau earthveloc unitsm unitss instanceparticlesadd_particlesstar need setup channel copi valu code model python codeblock python channel instanceparticlesnew_channel_tostar model evolv specifi end time current valu particl retiev legaci code use copi channel codeblock python printearthposit printearthpositionin_unitsau au instanceevolve_model unitsyr printearthpositionin_unitsau outdat valu update_particl first au channelcopi printearthpositionin_unitsau au instanceevolve_model unitsyr channelcopi printearthpositionin_unitsau au alway good idea clean your finish codeblock python instancestop exampl script testexampl httpsgithubcomamusecodeamusetreemasterexampl subdirectori sever exampl script includ show differ legaci code use one exampl test_hrdiagram_clusterpi httpsgithubcomamusecodeamuseblobmasterexamplesapplicationstest_hrdiagram_clusterpi sever option argument exampl script execut amus command line well termin prompt latter case use h get list avail command line option codeblock python import test_hrdiagram_clust test_hrdiagram_clustersimulate_stellar_evolut evolut star simul myr use sse legaci code stellar evolut deriv set random mass follow salpet imf msun alpha initi particl start evolv evolv model success plot data done amuseunitsunit import test_hrdiagram_clustersimulate_stellar_evolutionend_tim myr evolut star simul myr codeblock python python test_hrdiagram_clusterpi h usag test_hrdiagram_clusterpi option script gener hr diagram evolv cluster star salpet mass distribut option h help show help messag exit python test_hrdiagram_clusterpi evolut star simul myr instead plot data script print unabl produc plot couldnt find matplotlib probabl mean matplotlib instal see subsect matplotlib_ matplotlib matplotlib python plot librari produc public qualiti figur mani amus exampl script use librari produc graphic output would like take advantag librari get httpsmatplotliborg httpsmatplotliborg instal python sitepackag directori work cours also possibl print requir output termin use favourit plot tool make figur instal suse linux instal opensus section assum normal desktop instal opensus packag avail default opensus packag repositori recommend add packman repositori list configur softwar repositori open yast go softwar repositori python opensus come python preinstal check python instal codeblock sh python version python fail error version pleas instal python firstth packag call python also need pythondevel develop packag instal sudo zypper instal pythondevel gcc default opensus instal fortran c compil suggest use gfortran g compil instal gcc gccc gccfortran packag instal sudo zypper instal gcc gccc gccfortran mpi packman repositori provid openmpi packag instal openmpi packag sudo zypper instal openmpi openmpidevel unfortun openmpi instal work box need set ld_library_path variabl edit configur file first set ld_library_path ld_library_path must set mpipi find openmpi librari set variabl must first find openmpi lib found execut mpicxx showmelink pthread lusrlibmpigccopenmpilib lmpi_cxx lmpi lopenrt lopenp ldl wlexportdynam lnsl lutil lm ldl need set ld_library_path variabl path l output exampl case usrlibmpigccopenmpilib may differ path system bit opensus version differ bash export ld_library_pathusrlibmpigccopenmpilib recommend add line bashrc file variabl set correctli session c shell need setenv edit cshrc file edit configur file seem default openmpi instal problem load ldap librari check instal problem python c mpipi import mpi print mpiget_vendor warn dat librari load failur libdaplscmso open share object file file directori get long list warn dat provid found need edit configur file turn ldap open editor root file etcopenmpimcaparamsconf add line bottom file btl udapl save file rerun python statement python c mpipi import mpi print mpiget_vendor open mpi hdf amus work hdf version packman repositori packag hdf version instal sudo zypper instal hdf hdfdevel fftw code amus need fftw fftw instal sudo zypper instal fftw fftwdevel gsl opensus newer gsl instal sudo zypper instal gsl gsldevel cmake cmake use build evtwin opensus cmake instal sudo zypper instal cmake gmp gmp requir adaptb opensus gmp instal sudo zypper instal gmpdevel mpfr mpfr requir adaptb opensus mpfr instal sudo zypper instal libmpfr mpfrdevel python packag fedora fedora come python packag numpi also need setuptool packag abl instal python packag instal sudo zypper instal pythonnumpi pythonsetuptool pythonsetuptoolsdevel python packag easy_instal nose mpipi hpi docutil instal easy_instal command sudo easy_instal nose sudo easy_instal mpipi sudo easy_instal hpi sudo easy_instal docutil instal fedora section assum basic instal fedora instal one prerequisit instal coupl command fedora mpich sudo yum instal make gcc gccc gccgfortran cmake zlibdevel mpich mpichdevel hdf hdfdevel fftw fftwdevel gsl gsldevel gmp gmpdevel mpfr mpfrdevel pythonnos numpi numpyfpi hpi pythonsetuptool pythonsetuptoolsdevel mpipympich pythonmatplotlib note line also instal matplotlib packag use plot amus need plot leav instal mpich need activ use modul command modul load mpimpichunam note recommend put modul activ script bashrc cshrc file openmpi sudo yum instal make gcc gccc gccgfortran cmake zlibdevel openmpi openmpidevel hdf hdfdevel fftw fftwdevel gsl gsldevel gmp gmpdevel mpfr mpfrdevel pythonnos numpi numpyfpi hpi pythonsetuptool pythonsetuptoolsdevel mpipyopenmpi pythonmatplotlib instal openmpi need activ use modul command modul load mpiopenmpiunam note fedora instal mpich openmpi modul command keep manag separ instal conflict exist chang implement need recompil amus commun code make clean make instal fedora section assum livecd instal fedora instal python fedora come python preinstal check python instal codeblock sh python version python fail error version pleas instal python firstth packag call python also need pythondevel develop packag instal sudo yum instal pythondevel gcc default fedora instal fortran c compil suggest use gfortran g compil instal gcc gccc gccgfortran packag instal sudo yum instal gcc gccc gccgfortran mpi fedora come packag mpich openmpi instal mpich sudo yum instal mpich mpichdevel prefer openmpi mpich instal openmpi fedora yum databas instal openmpi packag sudo yum instal openmpi openmpidevel hdf amus work hdf version fedora packag hdf version instal sudo yum instal hdf hdfdevel fftw fedora fftw instal sudo yum instal fftw fftwdevel gsl fedora gsl instal sudo yum instal gsl gsldevel cmake cmake use build evtwin fedora cmake instal sudo yum instal cmake gmp gmp requir adaptb fedora gmp instal sudo yum instal gmp mpfr mpfr requir adaptb fedora mpfr current includ gmp packag alreadi done mpfr instal sudo yum instal gmp python packag fedora fedora come python packag nose numpi also need setuptool packag abl instal mpipi hpi softwar instal sudo yum instal pythonnos numpi numpyfpi pythonsetuptool pythonsetuptoolsdevel python packag easy_instal mpipi hpi docutil instal easy_instal command sudo easy_instal mpipi sudo easy_instal hpi sudo easy_instal docutil instal ubuntu instal ubuntu date version section assum default ubuntu desktop instal prerequisit instal coupl command ubuntu choic make openmpi mpich openmpi sudo aptget instal buildessenti gfortran pythondev libopenmpidev openmpibin libgsldev cmake libfftw libfftwdev libgmpdev libmpfr libmpfrdev libhdfserialdev hdftool pythonnos pythonnumpi pythonsetuptool pythondocutil pythonhpi pythonsetuptool git sudo pip instal mpipi altern setuptool easy_instal deprec sudo easy_instal mpipi mpich sudo aptget instal buildessenti gfortran pythondev mpich libmpichdev libgsldev cmake libfftw libfftwdev libgmpdev libmpfr libmpfrdev libhdfserialdev hdftool pythonnos pythonnumpi pythonsetuptool pythondocutil pythonhpi pythonsetuptool git sudo pip instal mpipi altern setuptool easy_instal deprec sudo easy_instal mpipi note pleas make sure instal mpich openmpi togeth openmpi mpich instal strang error occur amus work see instal pleas remov instal one instal maco high sierra python section assum default maco instal macport instal instal prerequisit prerequisit essenti build amus commun code instal systemwid command choos openmpi mpich desir work amus pleas make sure set compil instal default greatli simplifi thing later openmpi sudo port instal gcc openmpigcc hdf gsl cmake gmp mpfr fftw gcc sudo port instal python pyvirtualenv sudo port select set mpi openmpigccfortran sudo port select set gcc mpgcc sudo port select set python python sudo port select set virtualenv virtualenv mpich sudo port instal gcc mpichgcc hdf gsl cmake gmp mpfr fftw gcc sudo port instal python pyvirtualenv sudo port select set mpi mpichgcc sudo port select set gcc mpgcc sudo port select set python python sudo port select set virtualenv virtualenv note pleas make sure instal mpich openmpi togeth instal strang error occur amus work instal pleas first remov instal one instal amus first creat virtual environ instal amus desir python packag ensur dont need root privileg amus environ isol systeminstal packag creat virtual environ desir directori python venv amuseenv environ creat activ amuseenvbinactiv may want make alia eg alia amuseenv virtualenvironmentsamuseenvbinactiv point prompt amuseenv front alway know your virtual environ use pip instal prerequisit python modul amus pip instal numpi nose docutil mpipi hpi probabl youll want instal python modul pip instal scipi astropi jupyt panda seaborn final instal amus first download amus prefer make git clone desir directori git clone httpsgithubcomamusecodeamusegit chang amus directori run configur enabl option gpu featur presentrequir cd amus configur enablecuda enablesapporo final build instal amus option download code desir export download_cod python setuppi instal note part current work python environ pleas skip option test setup success run take long time python setuppi test _prerequisitelabel instal prerequisit softwar toctre maxdepth installprerequisitesubuntu installprerequisitesosx installprerequisitesarch installprerequisitesfedora installprerequisitescento installprerequisitessus instal amus sever softwar packag must instal softwar packag instal manual two prepar instal script instal script instal python prerequisit user directori root access requir packag amus need python version numpi version hdf version x hpi version mpi openmpi mpich mpipi version nose version docutil version fftw version gsl cmake version gmp version mpfr version first two section compilers_ installation_scripts_ explain use two instal script instal amus last section manual_ specifi requir packag need version _compil compil build amus sourc need work build environ amus build system need c fortan compil pleas check first work build environ system ubuntu setup environ root codeblock sh aptget instal buildessenti curl g gfortran gettext zlibgdev fedora setup environ root codeblock sh yum groupinstal develop tool develop librari _installation_script instal script creat two instal script autom instal requir packag linux osx system script instal packag user directori one script download instal python script download instal librari python packag everyth instal user directori packag instal even version softwar alreadi instal system script download instal softwar user directori user directori must specifi prefix environ variabl run instal script must set prefix environ variabl updat path librari path shell bash need codeblock sh export prefixamuseprerequisit export pathprefixbinpath export ld_library_pathprefixlibld_library_path one script download build instal python system script written python download instal packag script found docinstal directori start instal codeblock sh open shell go docinstal directori set prefix path ld_library_path environ variabl export prefixamuseprerequisit export pathprefixbinpath export ld_library_pathprefixlibld_library_path start instal script python installpythonsh start instal script prerequisit packag installpi download installpi instal updat path variabl profil make sure prefixbin directori first entri path abl instal amus use instal script maco maco need instal xcode gfortran compil first xcode develop packag avail httpsdeveloperapplecomxcod app store standard xcode releas come gfortran compil go hpc mac os x site httphpcsourceforgenetindexphp_ recent gfortran compil compat xcode tool instal xcode gfortan follow step describ previou paragraph _manual manual instal prerequisit python python probabl alreadi instal system check version python codeblock sh python version python download python httpswwwpythonorg numpi check numpi instal system codeblock sh python c import numpi print numpyversionvers fail error version need instal numpi download numpi httpwwwnumpyorg hdf librari hdf data format specif hdf group provid c librari write access hdf file check hdf librari instal system codeblock sh hl v hl version fail error version need instal hdf librari download hdf httpswwwhdfgrouporg hpi access hdf file python use hpi librari check hpi librari instal system codeblock sh python c import hpi print hpyversionvers fail error version need instal hpi download hpi httpswwwhpyorg docutil check python docutil instal system codeblock sh python c import docutil print docutils__version__ fail error version need instal docutil download docutil httpdocutilssourceforgenet mpi instal mpi framework must mpi compat amus work mpich openmpi mpich mpich portabl implement mpi standard check mpich instal system codeblock sh mpdhelp follow mpd command avail usag specif one invok singl argument help mpd start mpd daemon mpdtrace show mpd ring mpdboot start ring daemon mpdringtest test long take fail error need instal mpich check openmpi support download mpich httpwwwmpichorg openmpi openmpi anoth portabl implement mpi standard check openmpi instal system codeblock sh mpicxx v fail error need instal mpich openmpi support exampl dopcument assum openmpi download openmpi httpswwwopenmpiorg mpipi access mpi python use mpipi softwar check mpipi librari instal system codeblock sh python c import mpipi print mpipy__version__ fail error version need instal mpipi find mpipi httpsmpipyreadthedocsio nose nose extens python test framework use unit test amus check nose instal system codeblock sh nosetest version nosetest version fail error version need instal nose download nose httpsomethingaboutorangecommrlprojectsnos fftw fftw c subroutin librari comput discret fourier transform check avail fftw system use fftwwisdom codeblock sh fftwwisdom version fftwwisdom tool fftw version download fftw librari httpwwwfftworg gsl gnu scientif librari gsl numer librari c c programm free softwar gnu gener public licens check avail gsl system use gslconfig codeblock sh gslconfig version download gsl httpwwwgnuorgsoftwaregsl cmake cmake crossplatform opensourc build system cmake use control softwar compil process use simpl platform compil independ configur file cmake gener nativ makefil workspac use compil environ choic cmake use build evtwin check whether cmake instal system codeblock sh cmake version cmake version download cmake httpscmakeorgdownload gmp gnu mp librari arbitrari precis arithmet ie bignum packag oper sign integ ration float point numer type gmp requir adaptb accur dynam arbitrari precis tjarda boekholt best way check whether right version gmp instal system depend packag manag use alway work note librari number match releas version codeblock sh locat libgmp usrliblibgmpso usrliblibgmpso usrliblibgmpso locat gmph usrincludegmph grep gnu_mp_vers usrincludegmph defin __gnu_mp_vers defin __gnu_mp_version_minor defin __gnu_mp_version_patchlevel download gmp httpsgmpliborg mpfr mpfr librari c librari multipleprecis floatingpoint comput correct round mpfr requir adaptb accur dynam arbitrari precis tjarda boekholt best way check whether right version mpfr instal system depend packag manag use alway work note librari number match releas version codeblock sh locat libmpfr usrliblibmpfrso usrliblibmpfrso usrliblibmpfrso locat mpfrh usrincludempfrh grep mpfr_version usrincludempfrh defin mpfr_version_major defin mpfr_version_minor defin mpfr_version_patchlevel download mpfr httpswwwmpfrorg author arjen van elteren vanelterenstrwleidenunivnl date _configurationlabel configur amus introduct amus configur script use two purpos run differ oper system set compil time option amus framework built linux aix os x system also run window amus configur run without mpi gpu cuda openmp document provid short overview configur option effect basic basic configur amus use mpi commun channel build gpu enabl code gpu enabl version use openmp avail configur script run configur get list option import environ variabl run configur help flag configur help import variabl configur script locat python execut python execut search path overrid set python environ variabl configur pythonpathtolibrariespython configur script look depend librari default locat system defin also directori prefix environ variabl instal prerequisit amus instal script see dochowtoinstallprerequisit configur script find packag instal librari prefixlib prefixlib search system path overrid prefix environ variabl configur prefixpathtolibrariesroot _configurationgpulabel gpu current code amus capabl use gpu base cuda run code need cuda librari driver instal run configur like configur enablecuda configur script look nvcc compil cuda librari well known path unfortun often find cuda tool specifi environ variabl configur option configur script find nvcc compil find wrong one specifi nvcc compil nvcc environ variabl configur enablecuda nvccpathtonvcc configur script also search nvcc compil cuda_tkbin directori configur enablecuda cuda_tkoptnvidia configur script look cuda cudart librari nvcclib nvcclib librari found overrid librari path configur enablecuda withcudalibdirpathtocudalib use withcudalibdir alway overrid local search path also work old version cuda usrlib final els fail edit configmk file configur finish import variabl file cuda_en valid valu ye nvcc absolut path nvcc execut cuda_tk directori cuda toolkit instal cuda_lib librari flag add link stage lpath lcuda lcudart pleas rememb configmk file overwritten everi time configur run sapporo librari version sapporo librari build cuda enabl sapporo librari implement grape api gpu hardwar amus ship two version sapporo librari older version sapporo_light run cuda devic maintain longer latest version sapporo run modern gpu hardwar version also run opencl devic still work progress default amus use older sapporo_light version enabl latest version configur enablecuda enablesapporo instal ubuntu version python section assum default ubuntu desktop instal instal prerequisit prerequisit essenti build amus commun code instal systemwid command choos openmpi mpich desir work amus openmpi sudo aptget instal buildessenti gfortran pythondev libopenmpidev openmpibin libgsldev cmake libfftw libfftwdev libgmpdev libmpfr libmpfrdev libhdfserialdev hdftool git mpich sudo aptget instal buildessenti gfortran pythondev mpich libmpichdev libgsldev cmake libfftw libfftwdev libgmpdev libmpfr libmpfrdev libhdfserialdev hdftool git note pleas make sure instal mpich openmpi togeth instal strang error occur amus work instal pleas first remov instal one instal amus first creat virtual environ instal amus desir python packag ensur dont need root privileg amus environ isol systeminstal packag creat virtual environ desir directori python venv amuseenv environ creat activ amuseenvbinactiv may want make alia eg alia amuseenv virtualenvironmentsamuseenvbinactiv point prompt amuseenv front alway know your virtual environ use pip instal prerequisit python modul amus pip instal numpi nose docutil mpipi hpi probabl youll want instal python modul pip instal scipi astropi jupyt panda seaborn final instal amus first download amus prefer make git clone desir directori git clone httpsgithubcomamusecodeamusegit chang amus directori run configur enabl option gpu featur presentrequir cd amus configur enablecuda enablesapporo final build instal amus option download code desir export download_cod python setuppi instal note part current work python environ pleas skip option test setup success run take long time python setuppi test instal maco high sierra python section assum default maco instal macport instal instal prerequisit prerequisit essenti build amus commun code instal systemwid command choos openmpi mpich desir work amus pleas make sure set compil instal default greatli simplifi thing later openmpi sudo port instal gcc openmpigcc hdf gsl cmake gmp mpfr fftw gcc sudo port instal python pyvirtualenv sudo port select set mpi openmpigccfortran sudo port select set gcc mpgcc sudo port select set python python sudo port select set virtualenv virtualenv mpich sudo port instal gcc mpichgcc hdf gsl cmake gmp mpfr fftw gcc sudo port instal python pyvirtualenv sudo port select set mpi mpichgcc sudo port select set gcc mpgcc sudo port select set python python sudo port select set virtualenv virtualenv note pleas make sure instal mpich openmpi togeth instal strang error occur amus work instal pleas first remov instal one instal amus first creat virtual environ instal amus desir python packag ensur dont need root privileg amus environ isol systeminstal packag creat virtual environ desir directori virtualenv amuseenv environ creat activ amuseenvbinactiv may want make alia eg alia amuseenv virtualenvironmentsamuseenvbinactiv point prompt amuseenv front alway know your virtual environ use pip instal prerequisit python modul amus pip instal numpi nose docutil mpipi hpi probabl youll want instal python modul pip instal scipi astropi jupyt panda seaborn final instal amus first download amus prefer make git clone desir directori git clone httpsgithubcomamusecodeamusegit chang amus directori run configur enabl option gpu featur presentrequir cd amus configur enablecuda enablesapporo final build instal amus option download code desir export download_cod python setuppi instal option test setup success run take long time python setuppi test instal maco instal maco macport section assum clean macport instal macport build system build packag sourc instal may take packag macport support differ variant variant built differ instal command specifi variant need amus test gcc version use gcc note want use differ fortran compil ifort better use installpi script docinstal directori note make sure recent macport instal run sudo port selfupd instal note unsur instal uninstal clear packag port uninstal pydocutil pynos pympipi pyhpi pynumpi hdf fftw gsl openmpi python make clean instal macport pleas remov macport directori read guid httpsguidemacportsorg one instal packag describ one go sudo port instal gcc sudo port instal python sudo port instal openmpigcc sudo port instal fftw gcc sudo port instal hdf gsl cmake gmp mpfr sudo port instal pynumpi pyhpi pynos pydocutil sudo port instal pympipi openmpi sudo port instal pymatplotlib make sure right macport compil python set default follow sudo port select set mpi openmpigccfortran sudo port select set gcc mpgcc sudo port select set python python sudo port select set nosetest nosetest instal need configur code follow line configur withfftwoptloc note withfftw option ensur fftw found optloc locat maco sometim incompat version fftw may instal usrinclud usrlocalinlud version may wrong processor type vs bit contain fortran api case compil fi fail case configur script pick want fftw directori edit configmk file point right version note prefix variabl make sure support librari commun code gsl gmp mpfr found optloc note pleas make sure compil variabl specifi like cc cxx cflag unless custom macport way variabl set like give compil error commun code exampl bhtree compil openmpicxx cxx command cxx variabl must compat openmpicxx openmpicxx show get command openmpicxx use gcc default macport use xcode compil compil support fortran macport gcc compil set need instal suggest instal gcc reliabl option codeblock sh sudo port instal gcc note instal differ version gcc need select differ variant packag select differ variant replac gcc gcc gcc version match gcc instal note applegcc version work support fortran python macport support sever python version differ variant instal python version codeblock sh sudo port instal python mpi macport provid packag mpich openmpi although probabl instal recommend suggest instal openmpi instal openmpi sudo port instal openmpi gcc hdf amus work hdf version higher macport come hdf version instal recent version sudo port instal hdf fftw macport come fftw fftw packag amus need fftw fftw instal sudo port instal fftw gcc gsl gsl use build gadget gsl instal sudo port instal gsl cmake cmake use build evtwin cmake instal sudo port instal cmake gmp gmp requir adaptb macport gmp instal sudo port instal gmp mpfr mpfr requir adaptb macport mpfr instal sudo port instal mpfr python packag point librari framework instal instal python packag depend instal librari sudo port instal pynumpi pyhpi pynos pydocutil instal openmpi mpi step need set openmpi variant pympipi sudo port instal pympipi openmpi matplotlib matplotlib requir highli recommend creat graphic instal sudo port instal pymatplotlib note macport instal compil non standard name make sure right macport compil python set default follow sudo port select set mpi openmpigccfortran sudo port select set gcc mpgcc sudo port select set python python sudo port select set nosetest nosetest altern use right compil specifi configur stage amus see output configur help list environ variabl set instal openmpi need specifi mpi compil like replac openmpicxx openmpicc openmpif instal compil configur mpicxxopenmpicxx mpiccopenmpicc mpifcopenmpif instal toctre maxdepth howtoinstallamus gettingstart obtain amus download go amusecod github httpsgithubcomamusecodeamuse_ page get start first step get amus work obtain amus sourc code advic even instal prerequisit softwar refprerequisitelabel follow instal instruct assum instal amus directori amus releas offici releas provid tarbal via httpsgithubcomamusecodeamusereleas tarbal obtain tarbal eg releasetargz download site unpack amus directori use codeblock sh tar xf releasetargz make amus subdirectori amusereleas refer amus root directori proceed read refprerequisitelabel section bleed edg current develop version avail via git repositori access issu follow command codeblock sh git clone httpsgithubcomamusecodeamusegit make amus root directori name amus instal ubuntu version python section assum default ubuntu desktop instal instal prerequisit prerequisit essenti build amus commun code instal systemwid command choos openmpi mpich desir work amus openmpi sudo aptget instal buildessenti gfortran pythondev libopenmpidev openmpibin libgsldev cmake libfftw libfftwdev libgmpdev libmpfr libmpfrdev libhdfserialdev hdftool git mpich sudo aptget instal buildessenti gfortran pythondev mpich libmpichdev libgsldev cmake libfftw libfftwdev libgmpdev libmpfr libmpfrdev libhdfserialdev hdftool git note pleas make sure instal mpich openmpi togeth instal strang error occur amus work instal pleas first remov instal one instal amus first creat virtual environ instal amus desir python packag ensur dont need root privileg amus environ isol systeminstal packag creat virtual environ desir directori virtualenv amuseenv environ creat activ amuseenvbinactiv may want make alia eg alia amuseenv virtualenvironmentsamuseenvbinactiv point prompt amuseenv front alway know your virtual environ use pip instal prerequisit python modul amus pip instal numpi nose docutil mpipi hpi probabl youll want instal python modul pip instal scipi astropi jupyt panda seaborn final instal amus first download amus prefer make git clone desir directori git clone httpsgithubcomamusecodeamusegit chang amus directori run configur enabl option gpu featur presentrequir cd amus configur enablecuda enablesapporo final build instal amus option download code desir export download_cod python setuppi instal option test setup success run take long time python setuppi test instal arch linux section assum default arch linux instal prerequisit instal coupl command arch linux instal prerequisit basedevel select member sudo pacman syu basedevel curl gccfortran gettext zlib instal python depend sudo pacman syu python pythonnumpi hdf docutil openmpi pythonmpipi pythonnos fftw gsl cmake gmp mpfr instal hpi first instal distribut run easy_instal sudo pacman syu pythondistribut sudo easy_instal hpi _document write document get start document amus gener restructur text use sphinx_ document gener tool sphinx version later requir might still run problem develop work sphinx sourc repositori mercuri base rapidli evolv project codeblock bash hg clone httpbitbucketorgbirkenfeldsphinx cd sphinx python setuppi instal _sphinx httpwwwsphinxdocorgenmast document sourc found filedoc directori trunk build amus document html format cd filedoc make html also pass pdflatex flag make build pdf pass argument show help inform output produc sphinx configur edit fileconfpi file locat filedoc organ amus document actual restructur text file kept filedocinstal filedocdesign filedoctutori main entri point filedocindexrst document suit built singl document order make effect use cross referenc want make navig amus document easi possibl addit file ad variou section includ base file name rst extens necessari tabl content instal redhat cento instal cento section assum minim cento instal prerequisit instal coupl command cento instal prerequisit basedevel select member sudo yum instal make gcc gccc gccgfortran cmake zlibdevel openmpi openmpidevel fftw fftwdevel gsl gsldevel gmp instal openmpi need activ use modul command modul load openmpiunam note recommend put openmpi modul activ script bashrc cshrc file instal python depend sudo yum instal pythondevel docutil pythonnos numpi numpyfpi pythondocutil instal hdf docutil first instal addit rpm forg document see httpwikicentosorgadditionalresourcesrepositoriesrpmforg instal rpm forg sudo yum instal hdf hdfdevel instal hpi sudo easy_instal hpi last need instal mpipi su modul load openmpiunam easy_instal mpipi note default cento sudo polici reset environ variabl therebi remov openmpi set last step use sudo easy_instal mpipi must instal root directli