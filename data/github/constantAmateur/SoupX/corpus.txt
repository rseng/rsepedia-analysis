soupx r packag estim remov cell free mrna contamin droplet base singl cell rnaseq data problem packag attempt solv droplet base singl cell rnaseq experi also captur ambient mrna present input solut along cell specif mrna interest contamin ubiquit vari huge experi although around seem reason common there way know advanc contamin experi although solid tumour lowviabl cell tend produc higher contamin fraction sourc contamin mrna lyse cell input solut profil contamin experi specif produc batch effect even decid dont want use soupx correct method whatev reason least want know contamin data note v onward soupx includ option automat estim contamin fraction anticip prefer way use method vast major user function autoestcont depend cluster inform provid use x data map cellrang load automat otherwis must provid explicitli user use setclust instal latest stabl releas instal cran usual way run r installpackagessoupx want use latest develop version instal run r devtoolsinstall_githubconstantamateursoupxrefdevel final want use percel contamin estim almost certainli wont need instal branch stan r devtoolsinstall_githubconstantamateursoupxrefstan encount error say multtest unavail pleas instal manual bioconductor r biocmanagerinstallmulttest quickstart decontamin one channel x data map cellrang run r sc loadxpathtoyourcellrangeroutsfold sc autoestcontsc adjustcountssc manual load decontamin data r sc soupchanneltable_of_dropletstable_of_count sc setclusterssccluster_label sc autoestcontsc adjustcountssc contain correct matrix use place origin tabl count downstream analys document methodolog implement packag explain detail paperhttpsdoiorggigasciencegiaa detail vignett provid packag view herehttpsrawcdngithackcomconstantamateursoupxbdfefdbbabcfeinstdocpbmctutorialhtml cite soupx use soupx work pleas cite young md behjati soupx remov ambient rna contamin dropletbas singlecel rna sequenc data gigasci volum issu decemb giaabiorxiv httpsdoiorggigasciencegiaa frequent ask question im get error autoestcont unrealist estim automat estim contamin implement autoestcont make assumpt suffici divers raw data identifi marker gene gene commonli use estim contamin data either extrem homogen ie one cell type exampl cell line number cell low hundr less assumpt unlik hold situat think hard realli want includ data sever limit your sure best approach probabl manual specifi contamin fraction line would expect similar experi data still look contamin didnt soupx work first thing check provid cluster inform either cluster run setclust adjustcount load automat loadx cluster inform allow far contamin identifi safe remov second thing consid contamin rate estim look plausibl estim contamin rate part method requir user input prone error gener contamin rate less low usual moder high cours experi may vari expect base fresh tissu experi x platform final note soupx design tri err side throw real count case import remov contamin sure youv retain true count particularli true overremov remov express truli express gene unless set overremov someth extrem describ situat may want tri manual increas contamin rate set setcontaminationfract see improv result cant find good set gene estim contamin fraction gener gene set work best set gene highli specif cell type present data low frequenc think hb gene erythrocyt ig gene bcell tpsbtpsab mast cell etc tri anyth esoter usual good idea least tri commonli success gene set particularli hb gene fail plotmarkerdistribut function use get inspir describ vignett yield noth suggest tri rang correct see effect downstream analysi experi experi somewher contamin estimatenonexpressingcel cant find cell use estim contamin point assum chosen set set gene use estim contamin default behaviour x data look cell strong evid endogen express gene set cell exclud cluster cell strong evid endogen express conserv behaviour design stop overestim contamin fraction sometim make estim difficult cluster least one cell look bad option reclust data produc cluster fewer cell per cluster prefer option requir work user part make criteria declar cell genuin express gene set less strict seldom work usual cell threshold lot case tweak valu maximumcontamin andor pcut yield usabl result set clustersfals forc estimatenonexpressingcel consid cell independ go worth make criteria exclud cell permiss decreas maximumcontamin much reason changelog v loadx requir version seuratreadx strip numer suffix v first cran version code one signific chang tweak reach cran compat correct algorithm made time faster parallel option longer need remov also includ minor tweak v addit autoestcont function automat estim contamin fraction without need specifi set gene use estim number tweak bug fix v bug fix v ad helper function integr metadata soupchannel object integr cluster inform estim contamin calcul adjust count make adjustcount routin parallel v review method focu simplif code function use autom select gene contamin estim remov misus cluster use guid select cell set gene express default set use global estim rho hierarch bay routin ad share inform cell user use cell specif estim see note detail v pass r cmd check without warn error ad extra vignett estim contamin correctli chang argument interpolatecellcontamin function made monoton decreas lowess default interpol method number plot improv v ad lowess smooth interpol made default modifi variou function allow singl channel process natur way minor bug fix v integr estimatesoup class construct save memori load mani channel ad function use tfidf quickli estim marker minor bug fix document updat v updat document modifi plot function return sourc datafram v fairli major overhaul data structur use packag compat previou version v bug fix plot routin licens copyright c genom research ltd author matthew young mysangeracuk program free softwar redistribut andor modifi term gnu gener public licens version publish free softwar foundat program distribut hope use without warranti without even impli warranti merchant fit particular purpos see gnu gener public licens detail httpwwwgnuorglicens test environ local os x instal r ubuntu travisci r winbuild devel releas r cmd check result error warn note resubmiss resubmiss version correct issu caus soupx archiv specif set lazydatacompress flag descript xz caus packag fail size check flag set remov exampl nonexport function titl soupx pbmc demonstr author matthew daniel young date r sysdat fig_width fig_height output pdf_document default html_document default vignett vignetteindexentrypbmc demonstr vignetteengineknitrrmarkdown vignetteencodingutf r global_opt includefals libraryknitr opts_chunksettidytru introduct get start specif exampl data set use r packag worth understand broad level problem packag aim solv goe cours best way read preprinthttpswwwbiorxivorgcontentv long promis cant bother want refresh ill tri recap main point droplet base singl cell rnaseq experi alway certain amount background mrna present dilut get distribut droplet cell sequenc along net effect produc background contamin repres express cell contain within droplet solut contain cell collect cell free mrna float input solut henceforth refer soup creat cell input solut lyse soup look differ input solut strongli resembl express pattern obtain sum individu cell aim packag provid way estim composit soup fraction umi deriv soup droplet produc correct count tabl soup base express remov method consist three part calcul profil soup estim cell specif contamin fraction infer correct express matrix previou version soupx estim contamin fraction step part caus difficulti user contamin fraction parametris rho code rho mean contamin rho mean umi droplet soup version onward autom routin estim contamin fraction provid suitabl circumst howev vignett still spend lot effort explain calcul contamin fraction manual still circumst manual estim rho prefer option import understand method work fail possibl run soupx without cluster inform get far better result basic cluster provid therefor strongli recommend provid cluster inform soupx use x data map cellrang default cluster produc cellrang automat load use result strongli sensit cluster use seurat default paramet also yield similar result quickstart x data map cellrang typic soupx work flow would r quick_start evalfals installpackagessoupx librarysoupx load data estim soup profil sc loadxpathtocellrangeroutsfold estim rho sc autoestcontsc clean data adjustcountssc would produc new matrix contamin read remov use downstream analysi place origin matrix note default adjustcount return noninteg count requir integ downstream process either pass round set roundtointtru run adjustcount get start instal packag like r packag simplest way use cran version run r install_cranevalfals installpackagessoupx want use latest experiment featur instal develop version github use devtoolshttpsdevtoolsrliborg install_github function follow r instal evalfals devtoolsinstall_githubconstantamateursoupxrefdevel instal load packag usual way r load librarysoupx pbmc dataset like everi singl cell tool go use one x pbmc data set demonstr use packag specif use pbmc datasethttpssupportxgenomicscomsinglecellgeneexpressiondatasetspbmck start point download rawhttpscfxgenomicscomsamplescellexppbmckpbmck_raw_gene_bc_matricestargz filteredhttpscfxgenomicscomsamplescellexppbmckpbmck_filtered_gene_bc_matricestargz cellrang output extract temporari folder follow r downloadevalfals tmpdir tempdirchecktru downloadfilehttpscfxgenomicscomsamplescellexppbmckpbmck_raw_gene_bc_matricestargzdestfilefilepathtmpdirtodtargz downloadfilehttpscfxgenomicscomsamplescellexppbmckpbmck_filtered_gene_bc_matricestargzdestfilefilepathtmpdirtoctargz untarfilepathtmpdirtodtargzexdirtmpdir untarfilepathtmpdirtoctargzexdirtmpdir load data soupx come conveni function load x data process use cellrang download data use get start run r load_dataevalfals sc loadxtmpdir load x data soupchannel object list special properti store inform associ singl x channel soupchannel object also creat manual suppli tabl droplet tabl count assum follow code download pbmc data could manual construct soupchannel run r load_data_manualevalfals toc seuratreadxfilepathtmpdirfiltered_gene_bc_matricesgrch tod seuratreadxfilepathtmpdirraw_gene_bc_matricesgrch sc soupchanneltodtoc avoid download includ larg data file vignett use preload process object pbmc_sc r load_sav datapbmc_sc sc pbmc_sc sc profil soup load data first thing estim express profil soup look like actual done us automat object construct function soupchannel call loadx usual default estim fine done explicitli set calcsoupprofilefals follow r estimatesoup evalfals sc soupchanneltodtoccalcsoupprofilefals sc estimatesoupsc note perform oper use presav pbmc_sc data tabl droplet drop soup profil gener save memori gener dont need full tabl droplet determin soup look like usual reason estimatesoup run automat want chang default paramet way calcul soup profil one case may want latter tabl count avail empti droplet case proceed run r estimatenodrop evaltru librarymatrix toc sctoc scnodrop soupchanneltoctoccalcsoupprofilefals calcul soup profil soupprof dataframerownam rownamestoc est rowsumstocsumtoc count rowsumstoc scnodrop setsoupprofilescnodropssoupprof case setsoupprofil command use instead estimatesoup directli add custom estim soup profil soupchannel object note load matrix librari help us manipul spars matrix toc ad extra meta data soupchannel object extra meta data essenti includ soupchannel object gener add meta data provid datafram row name equal column name toc build soupchannel object howev bit meta data essenti special load function essenti cluster inform without soupx still work wont abl automat estim contamin fraction correct step far less effect metadata associ pbmc dataset also bundl soupx use add cluster data run r set_clust datapbmc_metadata sc setclustersscsetnamespbmc_metadataclusterrownamespbmc_metadata also use abl visualis data provid kind dimens reduct data run r add_dr sc setdrscpbmc_metadatacolnamessctoccrdrd usual need use loadx function cellrang produc valu automat load visual saniti check often case realli want get rough sens whether express gene group gene set cell deriv soup stage alreadi enough inform proceed briefli discuss let start get gener overview pbmc data plot provid annot r plot_annot libraryggplot dd pbmc_metadatacolnamessctoc mid aggregatecbindrdrd annotationdataddfunmean gg ggplotddaesrdrd geom_pointaescolourannotations geom_labeldatamidsaeslabelannot ggtitlepbmc k annot guidescolour guide_legendoverridea listsiz plotgg soupx function gener tsne reduc dimens coordin us gener use someth els case run seurathttpssatijalaborgseurat standard way produc tsne map data see pbmc suppos interest express gene _igkc_ key compon immunoglobulin ie antibodi highli express bcell quickli visualis cell express _igkc_ extract count soupchannel object r plot_igkc ddigkc sctocigkc gg ggplotddaesrdrd geom_pointaescolourigkc plotgg wow know prior annot cell cluster bottom bcell express _igkc_ cluster right tcell popul taken face valu appear identifi scatter popul tcell produc antibodi start prepar natur paper get carri away though perhap worth check express _igkc_ scatter cell would expect chanc soup realli answer properli need know much contamin present cell focu next section get rough idea calcul mani count would expect _igkc_ cell assum cell contain noth soup function soupmarkermap allow visualis ratio observ count gene set gene expect valu let tri r sanity_check gg plotmarkermapscigkc plotgg need pass tsne coordin function store sc object ran setdr look result plot see cell bcell cluster reddish colour indic express far would expect chanc even cell noth background paradigm chang antibodi produc tcell fare well decidedli bluish hue indic complet plausibl express _igkc_ cell due contamin soup cell shown dot zero express _igkc_ made plot assum droplet contain noth background contamin obvious true nevertheless still use quick easi saniti check perform estim contamin fraction probabl difficult part use soupx accur estim level background contamin repres rho channel two way use automat autoestcont method manual provid list non express gene vignett demonstr method anticip automat method use circumst describ idea underpin approach identifi gene express cell data express observ gene cell must due contamin challeng part method understand includ lot detail success appli soupx depend understand detail key thing understand contamin fraction estim fraction data discard valu set low correct data potenti still highli contamin set high discard real data although good reason want time see section contamin fraction right ball park soupx remov contamin gener matter number percent note mode determin contamin fraction add entri titl fit soupchannel object contain detail final estim reach manual specifi contamin fraction worth consid simpli manual fix contamin fraction certain valu seem like bad thing intuit actual good reason might want contamin fraction set high true express remov data howev done way count specif subset cell ie good marker gene absolut last thing remov sensibl thing set high contamin fraction set experi confid vast major contamin remov even good estim contamin fraction may want set valu use artifici higher soupx design conserv sens err side retain true express cost let contamin creep test show well estim contamin fraction remov contamin ie soup reduc order magnitud applic suffici howev case complet remov contamin essenti worthwhil increas contamin fraction use soupx remov greater portion contamin experi indic ad extra remov soup get rid remov explicitli set contamin fraction done run r set_rho sc setcontaminationfractionsc set contamin fraction cell gene estim contamin fraction estim contamin fraction need set gene know express set cell measur much express observ infer contamin fraction need set gene know express cell certain type cell sourc express soup difficulti identifi set gene cell assum express note purpos set gene estim contamin fraction noth els gene play special role actual remov background associ count categor list gene remov anyth sort furthermor good set gene provid andor automat method fail reason consid set contamin fraction manual someth see result effect contamin rate around appropri mani dataset cours everi experi differ make concret let us consid exampl gene _hbb__hba_ haemoglobin gene express red blood cell nowher els _igkc_ antibodi gene produc b cell suppos estim contamin use two set gene hb gene _hbb_ _hba_ ig gene _igkc_ let look happen hypothet cell cell red blood cell express _hbb_ _hba_ express _igkc_ cell want use _igkc_ estim contamin fraction _hbb__hba_ cell bcell express _igkc_ _hbb_ _hba_ cell want use _hbb_ _hba_ estim contamin fraction _igkc_ cell endotheli cell express _hbb__hba_ _igkc_ want use three estim contamin fraction basic tri identifi cell set gene know cell express estim contamin fraction use express see obvious method doesnt know anyth biolog havent told what b cell rbc anyth els noth stop suppli inform cours give best result absent inform trick use express level gene cell identifi use gene estim contamin fraction best gene estim contamin fraction highli express cell use like hb ig gene confid observ low level express set gene cell due background contamin low level mrna product cell given set gene suspect may use function plotmarkerdistribut use visualis gene express distribut across cell continu exampl cell measur express _hbb_ _hba_ time wed expect droplet fill soup method use either gene calcul rho hand _igkc_ time valu wed get pure soup use cell _hbb__hba_ valu around time soup _igkc_ chart time wed expect soup method conclud cell express _igkc_ use _hbb__hba_ estim rho cell three around use estim rho prevent accident includ cell genuin express one estim gene soupx default exclud cluster even one gene evid express gene exampl soupx would use hb gene estim contamin rate cell cell belong cluster cell conserv behaviour prevent overestim contamin fraction cluster beyond scope soupx must suppli user x data map use cellrang soupx automat pull graph base cluster produc cellrang use default indic get accur estim group similar biolog function group togeth theyr either use exclud group paramet nonexpressedgenelist given list entri list group gene group biolog exampl would set like r gene nonexpressedgenelist listhbchbbhbaig cigkc exampl wed probabl want includ ig gene haemoglobin gene even theyr particularli highli express gener correl biolog r gene nonexpressedgenelist listhbchbbhbaig cigkcighgighg someth similar autom method estim contamin fraction use autom simpl run r auto_est sc autoestcontsc produc mysteri look plot two distribut red line understand plot need understand littl bit autoestcont basic idea tri aggreg evid mani plausibl estim rho assign true contamin fraction one occur often reason work incorrect estim prefer valu true estim cluster around valu solid curv show someth like frequenc differ estim rho red line indic peak give estim rho use default valu priorrho priorrhostddev probabl ignor dash line want detail explan happen first function tri identifi gene specif one cluster cell use quickmark determin specif specif base gene tfidf valu cluster specif see quickmark help thishttpsconstantamateurgithubioscd explan mean default tfidfmin demand gene reason specif get low number gene estim consid decreas valu list reduc keep gene highli express soup give accur estim rho highli express control soupquantil default valu sound strict practic mani gene tfidf tend pass gene use independ estim rho usual way cluster gene confid said express determin estimatenonexpressingcel use estim rho could creat histogram estim pick common valu would work reason well better consid estim uncertainti associ instead calcul posterior distribut contamin fraction geneclust pair determin best estim rho find peak averag across distribut shown solid curv plot posterior distribut calcul use poisson likelihood gamma distribut prior parametris mean priorrho standard deviat priorrhostddev dot line plot show prior distribut default paramet calibr fairli nonspecif slight prefer toward valu rho rang commonli seen fresh ie nuclear singl cell experi default valu place weak constraint seen set uniform prior r auto_est_unif_prior sc autoestcontscpriorrhostddev give answer two signific figur cours break thing start set strong badli motiv prior pleas dont manual way altern automat method manual specifi set gene use estim contamin fraction gene need certain express cell see section gene estim contamin fraction exampl may make clearer experi solid tissu studi red cell lysi buffer use obviou gene use purpos case bloodi solid tissu haemoglobin gene ubiquit contamin actual produc cell red blood cell context case skip next section proceed straight estim contamin pick soup specif gene howev time obviou advanc gene highli specif one popul cell case pbmc data solid tissu biopsi clear gene set use estim contamin gener user pick sensibl gene thing done aid select process firstli gene use express highli background check gene run r topsoupgen headscsoupprofileorderscsoupprofileestdecreasingtruen unfortun highli express gene case ubiquit express _rpl__rps_ gene mitochondri gene need criteria aid select process function plotmarkerdistribut use visualis distribut express rel would expect cell pure background across cell data set geneset provid function tri guess gene might use r infernonexpress plotmarkerdistributionsc plot show distribut log ratio observ count expect cell contain noth soup guess cell definit express gene made background contamin calcul red line show global estim ie assum contamin fraction cell contamin fraction use gene guess done use quickmark function find marker gene cluster see automat method section fail cluster provid note heurist set gene intend help develop biolog intuit absolut must use automat select set gene estim background contamin fraction reason function return list gene select top n gene list use estim contamin overestim contamin fraction note decis gene use estim contamin must made channel channel basi find bcell specif gene use estim contamin channel anoth channel tcell marker would use look plot observ two immunoglobulin gene constant region _igkc_ _ighm_ present give consist estim contamin fraction around log scale know reason assum immunoglobulin gene express bcell decid use express non bcell estim contamin fraction there reason use gene quickmark flag us let defin list constant immunoglobulin gene r iggen iggen cighaighaighgighgighgighgighdigheighm iglciglciglciglciglciglciglc igkc doesnt matter express data contribut estim estim nonexpress cell decid set gene estim contamin next need decid cell genuin express gene use estim contamin done follow r calculatenullmatrix usetoest estimatenonexpressingcellsscnonexpressedgenelist listigiggenesclustersfals produc matrix indic cell row use set gene column estim contamin notic function return warn cluster inform provid discuss soupx tri conserv prevent estim cell high express gene set iggen case cell fall cluster cluster inform given default exclud cell obvious suitabl visualis cell mark use estim r visnullmatrix plotmarkermapscgenesetiggenesusetoestusetoest youll notic set clustersfals stop soupx use cluster inform provid inform earlier ran setclust let see thing chang let cluster inform use r calcnullmatrixwithclust usetoest estimatenonexpressingcellsscnonexpressedgenelist listigiggen plotmarkermapscgenesetiggenesusetoestusetoest see set cell use estim iggen set decreas case make much differ gener better provid cluster conserv worth note one final thing specif nonexpressedgenelist seem odd specifi nonexpressedgenelist listigiggen instead nonexpressedgenelist iggen nonexpressedgenelist expect set gene biolog relat expect present present set eg ig gene hb gene calcul contamin fraction point hard work done estim contamin fraction need pass set gene cell use set gene calculatecontaminationfract r calccontamin sc calculatecontaminationfractionsclistigiggenesusetoestusetoest function modifi metadata tabl sc object add tabl give contamin fraction estim approach give contamin fraction close automat method r viewcont headscmetadata correct express profil calcul set contamin fraction cell would like use remov contamin origin count matrix estim contamin procedur made much robust provid cluster inform much power separ true express contamin express count aggreg cluster furthermor process redistribut correct count cluster level individu cell automat correct variat cell specif contamin rate see paper detail alreadi load cluster inform sc object setclust use default run r decontamin adjustcountssc recommend mode oper produc noninteg although still spars matrix origin count correct background express see help code paper detail done chang method paramet unless strong reason need integ count downstream analys set roundtointtru stochast round probabl equal fraction part number exampl cell correct count assign valu time time investig chang express proceed let look done get sens strongli decreas look fraction cell nonzero set zero correct r mostzero cntsoggi rowsumssctoc cntstrain rowsumsout mostzero tailsortcntsoggycntstrainedcntsoggyn mostzero notic number gene list highli specif marker one cell type group cell _cd__hladra_ antigen present cell _igkc_ bcell other came list potenti cell specif gene notic also presenc mitochondri gene _mtnd_ hand focu gene quantit differ r mostreduc tailsortrowsumssctocoutrowsumssctocn find gene associ metabol translat often case mitochondri gene repres background compar cell presum result soup gener distress cell visualis express distribut way back start quick visualis look ratio _igkc_ express pure soup distribut weve correct data see compar correct data function plotchangemap help us default plot fraction express cell deem soup remov r igkc_chang plotchangemapscoutigkc show us express heavili decreas area surpris observ interpret cell express gene chang quit dramat correct soup contamin explor plot varieti differ gene see chang exampl could look r change_plotsevalfals plotchangemapscoutlyz plotchangemapscoutcd plotchangemapscoutil plotchangemapscouttrac plotchangemapscoutsa plotchangemapscoutnkg plotchangemapscoutgnli plotchangemapscoutcd plotchangemapscoutcda gener chang tend largest gene highli express specif context integr downstream tool cours next thing youll want load correct express matrix downstream analysi tool analys data correct matrix use downstream analysi place uncorrect raw matrix use x data would like save final count format use dropletutilshttpsbioconductororgpackagesreleasebiochtmldropletutilshtml writexcount function like r writeoutevalfals dropletutilswritexcountsstrainedcountsout load seurat load seurat r packag need save output soupx disk singl channel simpli run standard seurat construct step output adjustcount r seuratevalfals libraryseurat srat createseuratobjectout multipl channel want process soupx load seurat need creat combin matrix cell channel assum sc list name experi eg sc listexperi scexpexperi scexp done run someth like r seuratmultievalfals libraryseurat srat list fornom namessc clean channel name nom tmp adjustcountsscsnom add experi name cell barcod make uniqu colnamestmp pastenom_colnamestmp store result sratnom tmp combin count matrici one matrix srat docallcbindsrat srat createseuratobjectsrat titl soupx pbmc demonstr author matthew daniel young date r sysdat fig_width fig_height output pdf_document default html_document default vignett vignetteindexentrypbmc demonstr vignetteengineknitrrmarkdown vignetteencodingutf r global_opt includefals libraryknitr opts_chunksettidytru introduct get start specif exampl data set use r packag worth understand broad level problem packag aim solv goe cours best way read preprinthttpswwwbiorxivorgcontentv long promis cant bother want refresh ill tri recap main point droplet base singl cell rnaseq experi alway certain amount background mrna present dilut get distribut droplet cell sequenc along net effect produc background contamin repres express cell contain within droplet solut contain cell collect cell free mrna float input solut henceforth refer soup creat cell input solut lyse soup look differ input solut strongli resembl express pattern obtain sum individu cell aim packag provid way estim composit soup fraction umi deriv soup droplet produc correct count tabl soup base express remov method consist three part calcul profil soup estim cell specif contamin fraction infer correct express matrix previou version soupx estim contamin fraction step part caus difficulti user contamin fraction parametris rho code rho mean contamin rho mean umi droplet soup version onward autom routin estim contamin fraction provid suitabl circumst howev vignett still spend lot effort explain calcul contamin fraction manual still circumst manual estim rho prefer option import understand method work fail possibl run soupx without cluster inform get far better result basic cluster provid therefor strongli recommend provid cluster inform soupx use x data map cellrang default cluster produc cellrang automat load use result strongli sensit cluster use seurat default paramet also yield similar result quickstart x data map cellrang typic soupx work flow would r quick_start evalfals installpackagessoupx librarysoupx load data estim soup profil sc loadxpathtocellrangeroutsfold estim rho sc autoestcontsc clean data adjustcountssc would produc new matrix contamin read remov use downstream analysi place origin matrix note default adjustcount return noninteg count requir integ downstream process either pass round set roundtointtru run adjustcount get start instal packag like r packag simplest way use cran version run r install_cranevalfals installpackagessoupx want use latest experiment featur instal develop version github use devtoolshttpsdevtoolsrliborg install_github function follow r instal evalfals devtoolsinstall_githubconstantamateursoupxrefdevel instal load packag usual way r load librarysoupx pbmc dataset like everi singl cell tool go use one x pbmc data set demonstr use packag specif use pbmc datasethttpssupportxgenomicscomsinglecellgeneexpressiondatasetspbmck start point download rawhttpscfxgenomicscomsamplescellexppbmckpbmck_raw_gene_bc_matricestargz filteredhttpscfxgenomicscomsamplescellexppbmckpbmck_filtered_gene_bc_matricestargz cellrang output extract temporari folder follow r downloadevalfals tmpdir tempdirchecktru downloadfilehttpscfxgenomicscomsamplescellexppbmckpbmck_raw_gene_bc_matricestargzdestfilefilepathtmpdirtodtargz downloadfilehttpscfxgenomicscomsamplescellexppbmckpbmck_filtered_gene_bc_matricestargzdestfilefilepathtmpdirtoctargz untarfilepathtmpdirtodtargzexdirtmpdir untarfilepathtmpdirtoctargzexdirtmpdir load data soupx come conveni function load x data process use cellrang download data use get start run r load_dataevalfals sc loadxtmpdir load x data soupchannel object list special properti store inform associ singl x channel soupchannel object also creat manual suppli tabl droplet tabl count assum follow code download pbmc data could manual construct soupchannel run r load_data_manualevalfals toc seuratreadxfilepathtmpdirfiltered_gene_bc_matricesgrch tod seuratreadxfilepathtmpdirraw_gene_bc_matricesgrch sc soupchanneltodtoc avoid download includ larg data file vignett use preload process object pbmc_sc r load_sav datapbmc_sc sc pbmc_sc sc profil soup load data first thing estim express profil soup look like actual done us automat object construct function soupchannel call loadx usual default estim fine done explicitli set calcsoupprofilefals follow r estimatesoup evalfals sc soupchanneltodtoccalcsoupprofilefals sc estimatesoupsc note perform oper use presav pbmc_sc data tabl droplet drop soup profil gener save memori gener dont need full tabl droplet determin soup look like usual reason estimatesoup run automat want chang default paramet way calcul soup profil one case may want latter tabl count avail empti droplet case proceed run r estimatenodrop evaltru librarymatrix toc sctoc scnodrop soupchanneltoctoccalcsoupprofilefals calcul soup profil soupprof dataframerownam rownamestoc est rowsumstocsumtoc count rowsumstoc scnodrop setsoupprofilescnodropssoupprof case setsoupprofil command use instead estimatesoup directli add custom estim soup profil soupchannel object note load matrix librari help us manipul spars matrix toc ad extra meta data soupchannel object extra meta data essenti includ soupchannel object gener add meta data provid datafram row name equal column name toc build soupchannel object howev bit meta data essenti special load function essenti cluster inform without soupx still work wont abl automat estim contamin fraction correct step far less effect metadata associ pbmc dataset also bundl soupx use add cluster data run r set_clust datapbmc_metadata sc setclustersscsetnamespbmc_metadataclusterrownamespbmc_metadata also use abl visualis data provid kind dimens reduct data run r add_dr sc setdrscpbmc_metadatacolnamessctoccrdrd usual need use loadx function cellrang produc valu automat load visual saniti check often case realli want get rough sens whether express gene group gene set cell deriv soup stage alreadi enough inform proceed briefli discuss let start get gener overview pbmc data plot provid annot r plot_annot libraryggplot dd pbmc_metadatacolnamessctoc mid aggregatecbindrdrd annotationdataddfunmean gg ggplotddaesrdrd geom_pointaescolourannotations geom_labeldatamidsaeslabelannot ggtitlepbmc k annot guidescolour guide_legendoverridea listsiz plotgg soupx function gener tsne reduc dimens coordin us gener use someth els case run seurathttpssatijalaborgseurat standard way produc tsne map data see pbmc suppos interest express gene _igkc_ key compon immunoglobulin ie antibodi highli express bcell quickli visualis cell express _igkc_ extract count soupchannel object r plot_igkc ddigkc sctocigkc gg ggplotddaesrdrd geom_pointaescolourigkc plotgg wow know prior annot cell cluster bottom bcell express _igkc_ cluster right tcell popul taken face valu appear identifi scatter popul tcell produc antibodi start prepar natur paper get carri away though perhap worth check express _igkc_ scatter cell would expect chanc soup realli answer properli need know much contamin present cell focu next section get rough idea calcul mani count would expect _igkc_ cell assum cell contain noth soup function soupmarkermap allow visualis ratio observ count gene set gene expect valu let tri r sanity_check gg plotmarkermapscigkc plotgg need pass tsne coordin function store sc object ran setdr look result plot see cell bcell cluster reddish colour indic express far would expect chanc even cell noth background paradigm chang antibodi produc tcell fare well decidedli bluish hue indic complet plausibl express _igkc_ cell due contamin soup cell shown dot zero express _igkc_ made plot assum droplet contain noth background contamin obvious true nevertheless still use quick easi saniti check perform estim contamin fraction probabl difficult part use soupx accur estim level background contamin repres rho channel two way use automat autoestcont method manual provid list non express gene vignett demonstr method anticip automat method use circumst describ idea underpin approach identifi gene express cell data express observ gene cell must due contamin challeng part method understand includ lot detail success appli soupx depend understand detail key thing understand contamin fraction estim fraction data discard valu set low correct data potenti still highli contamin set high discard real data although good reason want time see section contamin fraction right ball park soupx remov contamin gener matter number percent note mode determin contamin fraction add entri titl fit soupchannel object contain detail final estim reach manual specifi contamin fraction worth consid simpli manual fix contamin fraction certain valu seem like bad thing intuit actual good reason might want contamin fraction set high true express remov data howev done way count specif subset cell ie good marker gene absolut last thing remov sensibl thing set high contamin fraction set experi confid vast major contamin remov even good estim contamin fraction may want set valu use artifici higher soupx design conserv sens err side retain true express cost let contamin creep test show well estim contamin fraction remov contamin ie soup reduc order magnitud applic suffici howev case complet remov contamin essenti worthwhil increas contamin fraction use soupx remov greater portion contamin experi indic ad extra remov soup get rid remov explicitli set contamin fraction done run r set_rho sc setcontaminationfractionsc set contamin fraction cell gene estim contamin fraction estim contamin fraction need set gene know express set cell measur much express observ infer contamin fraction need set gene know express cell certain type cell sourc express soup difficulti identifi set gene cell assum express note purpos set gene estim contamin fraction noth els gene play special role actual remov background associ count categor list gene remov anyth sort furthermor good set gene provid andor automat method fail reason consid set contamin fraction manual someth see result effect contamin rate around appropri mani dataset cours everi experi differ make concret let us consid exampl gene _hbb__hba_ haemoglobin gene express red blood cell nowher els _igkc_ antibodi gene produc b cell suppos estim contamin use two set gene hb gene _hbb_ _hba_ ig gene _igkc_ let look happen hypothet cell cell red blood cell express _hbb_ _hba_ express _igkc_ cell want use _igkc_ estim contamin fraction _hbb__hba_ cell bcell express _igkc_ _hbb_ _hba_ cell want use _hbb_ _hba_ estim contamin fraction _igkc_ cell endotheli cell express _hbb__hba_ _igkc_ want use three estim contamin fraction basic tri identifi cell set gene know cell express estim contamin fraction use express see obvious method doesnt know anyth biolog havent told what b cell rbc anyth els noth stop suppli inform cours give best result absent inform trick use express level gene cell identifi use gene estim contamin fraction best gene estim contamin fraction highli express cell use like hb ig gene confid observ low level express set gene cell due background contamin low level mrna product cell given set gene suspect may use function plotmarkerdistribut use visualis gene express distribut across cell continu exampl cell measur express _hbb_ _hba_ time wed expect droplet fill soup method use either gene calcul rho hand _igkc_ time valu wed get pure soup use cell _hbb__hba_ valu around time soup _igkc_ chart time wed expect soup method conclud cell express _igkc_ use _hbb__hba_ estim rho cell three around use estim rho prevent accident includ cell genuin express one estim gene soupx default exclud cluster even one gene evid express gene exampl soupx would use hb gene estim contamin rate cell cell belong cluster cell conserv behaviour prevent overestim contamin fraction cluster beyond scope soupx must suppli user x data map use cellrang soupx automat pull graph base cluster produc cellrang use default indic get accur estim group similar biolog function group togeth theyr either use exclud group paramet nonexpressedgenelist given list entri list group gene group biolog exampl would set like r gene nonexpressedgenelist listhbchbbhbaig cigkc exampl wed probabl want includ ig gene haemoglobin gene even theyr particularli highli express gener correl biolog r gene nonexpressedgenelist listhbchbbhbaig cigkcighgighg someth similar autom method estim contamin fraction use autom simpl run r auto_est sc autoestcontsc produc mysteri look plot two distribut red line understand plot need understand littl bit autoestcont basic idea tri aggreg evid mani plausibl estim rho assign true contamin fraction one occur often reason work incorrect estim prefer valu true estim cluster around valu solid curv show someth like frequenc differ estim rho red line indic peak give estim rho use default valu priorrho priorrhostddev probabl ignor dash line want detail explan happen first function tri identifi gene specif one cluster cell use quickmark determin specif specif base gene tfidf valu cluster specif see quickmark help thishttpsconstantamateurgithubioscd explan mean default tfidfmin demand gene reason specif get low number gene estim consid decreas valu list reduc keep gene highli express soup give accur estim rho highli express control soupquantil default valu sound strict practic mani gene tfidf tend pass gene use independ estim rho usual way cluster gene confid said express determin estimatenonexpressingcel use estim rho could creat histogram estim pick common valu would work reason well better consid estim uncertainti associ instead calcul posterior distribut contamin fraction geneclust pair determin best estim rho find peak averag across distribut shown solid curv plot posterior distribut calcul use poisson likelihood gamma distribut prior parametris mean priorrho standard deviat priorrhostddev dot line plot show prior distribut default paramet calibr fairli nonspecif slight prefer toward valu rho rang commonli seen fresh ie nuclear singl cell experi default valu place weak constraint seen set uniform prior r auto_est_unif_prior sc autoestcontscpriorrhostddev give answer two signific figur cours break thing start set strong badli motiv prior pleas dont manual way altern automat method manual specifi set gene use estim contamin fraction gene need certain express cell see section gene estim contamin fraction exampl may make clearer experi solid tissu studi red cell lysi buffer use obviou gene use purpos case bloodi solid tissu haemoglobin gene ubiquit contamin actual produc cell red blood cell context case skip next section proceed straight estim contamin pick soup specif gene howev time obviou advanc gene highli specif one popul cell case pbmc data solid tissu biopsi clear gene set use estim contamin gener user pick sensibl gene thing done aid select process firstli gene use express highli background check gene run r topsoupgen headscsoupprofileorderscsoupprofileestdecreasingtruen unfortun highli express gene case ubiquit express _rpl__rps_ gene mitochondri gene need criteria aid select process function plotmarkerdistribut use visualis distribut express rel would expect cell pure background across cell data set geneset provid function tri guess gene might use r infernonexpress plotmarkerdistributionsc plot show distribut log ratio observ count expect cell contain noth soup guess cell definit express gene made background contamin calcul red line show global estim ie assum contamin fraction cell contamin fraction use gene guess done use quickmark function find marker gene cluster see automat method section fail cluster provid note heurist set gene intend help develop biolog intuit absolut must use automat select set gene estim background contamin fraction reason function return list gene select top n gene list use estim contamin overestim contamin fraction note decis gene use estim contamin must made channel channel basi find bcell specif gene use estim contamin channel anoth channel tcell marker would use look plot observ two immunoglobulin gene constant region _igkc_ _ighm_ present give consist estim contamin fraction around log scale know reason assum immunoglobulin gene express bcell decid use express non bcell estim contamin fraction there reason use gene quickmark flag us let defin list constant immunoglobulin gene r iggen iggen cighaighaighgighgighgighgighdigheighm iglciglciglciglciglciglciglc igkc doesnt matter express data contribut estim estim nonexpress cell decid set gene estim contamin next need decid cell genuin express gene use estim contamin done follow r calculatenullmatrix usetoest estimatenonexpressingcellsscnonexpressedgenelist listigiggenesclustersfals produc matrix indic cell row use set gene column estim contamin notic function return warn cluster inform provid discuss soupx tri conserv prevent estim cell high express gene set iggen case cell fall cluster cluster inform given default exclud cell obvious suitabl visualis cell mark use estim r visnullmatrix plotmarkermapscgenesetiggenesusetoestusetoest youll notic set clustersfals stop soupx use cluster inform provid inform earlier ran setclust let see thing chang let cluster inform use r calcnullmatrixwithclust usetoest estimatenonexpressingcellsscnonexpressedgenelist listigiggen plotmarkermapscgenesetiggenesusetoestusetoest see set cell use estim iggen set decreas case make much differ gener better provid cluster conserv worth note one final thing specif nonexpressedgenelist seem odd specifi nonexpressedgenelist listigiggen instead nonexpressedgenelist iggen nonexpressedgenelist expect set gene biolog relat expect present present set eg ig gene hb gene calcul contamin fraction point hard work done estim contamin fraction need pass set gene cell use set gene calculatecontaminationfract r calccontamin sc calculatecontaminationfractionsclistigiggenesusetoestusetoest function modifi metadata tabl sc object add tabl give contamin fraction estim approach give contamin fraction close automat method r viewcont headscmetadata correct express profil calcul set contamin fraction cell would like use remov contamin origin count matrix estim contamin procedur made much robust provid cluster inform much power separ true express contamin express count aggreg cluster furthermor process redistribut correct count cluster level individu cell automat correct variat cell specif contamin rate see paper detail alreadi load cluster inform sc object setclust use default run r decontamin adjustcountssc recommend mode oper produc noninteg although still spars matrix origin count correct background express see help code paper detail done chang method paramet unless strong reason need integ count downstream analys set roundtointtru stochast round probabl equal fraction part number exampl cell correct count assign valu time time investig chang express proceed let look done get sens strongli decreas look fraction cell nonzero set zero correct r mostzero cntsoggi rowsumssctoc cntstrain rowsumsout mostzero tailsortcntsoggycntstrainedcntsoggyn mostzero notic number gene list highli specif marker one cell type group cell _cd__hladra_ antigen present cell _igkc_ bcell other came list potenti cell specif gene notic also presenc mitochondri gene _mtnd_ hand focu gene quantit differ r mostreduc tailsortrowsumssctocoutrowsumssctocn find gene associ metabol translat often case mitochondri gene repres background compar cell presum result soup gener distress cell visualis express distribut way back start quick visualis look ratio _igkc_ express pure soup distribut weve correct data see compar correct data function plotchangemap help us default plot fraction express cell deem soup remov r igkc_chang plotchangemapscoutigkc show us express heavili decreas area surpris observ interpret cell express gene chang quit dramat correct soup contamin explor plot varieti differ gene see chang exampl could look r change_plotsevalfals plotchangemapscoutlyz plotchangemapscoutcd plotchangemapscoutil plotchangemapscouttrac plotchangemapscoutsa plotchangemapscoutnkg plotchangemapscoutgnli plotchangemapscoutcd plotchangemapscoutcda gener chang tend largest gene highli express specif context integr downstream tool cours next thing youll want load correct express matrix downstream analysi tool analys data correct matrix use downstream analysi place uncorrect raw matrix use x data would like save final count format use dropletutilshttpsbioconductororgpackagesreleasebiochtmldropletutilshtml writexcount function like r writeoutevalfals dropletutilswritexcountsstrainedcountsout load seurat load seurat r packag need save output soupx disk singl channel simpli run standard seurat construct step output adjustcount r seuratevalfals libraryseurat srat createseuratobjectout multipl channel want process soupx load seurat need creat combin matrix cell channel assum sc list name experi eg sc listexperi scexpexperi scexp done run someth like r seuratmultievalfals libraryseurat srat list fornom namessc clean channel name nom tmp adjustcountsscsnom add experi name cell barcod make uniqu colnamestmp pastenom_colnamestmp store result sratnom tmp combin count matrici one matrix srat docallcbindsrat srat createseuratobjectsrat gener roxygen edit hand pleas edit document restimatenonexpressingcellsr nameestimatenonexpressingcel aliasestimatenonexpressingcel titlecalcul cell genuin express particular gene set gene usag estimatenonexpressingcel sc nonexpressedgenelist cluster null maximumcontamin fdr argument itemsca soupchannel object itemnonexpressedgenelista list contain set gene use estim contamin fraction itemclustersa name vector indic cluster cell name cell id valu cluster id null attempt load scmetadataclust set fals cell consid individu itemmaximumcontaminationth maximum contamin fraction would reason expect lower valu set aggress cell exclud use estim itemfdra poisson test use identifi cell exclud fals discoveri rate use higher fdr aggress exclus valu matrix indic cell use estim contamin set gene typic pass codeusetoest paramet codelinkcalculatecontaminationfract codelinkplotmarkermap descript given list correl gene eg haemoglobin gene immunoglobulin gene etc make attempt estim cell genuin express gene set turn central idea cell genuin produc class mrna haemoglobin gene observ express gene must due ambient rna contamin identifi cell use observ level express gene estim level contamin detail ideal way would prior annot data indic cell instanc red blood cell genuin express haemoglobin gene express haemoglobin gene due contamin circumst need run function instead pass matrix encod cell haemoglobin express codelinkcalculatecontaminationfract via codeusetoest paramet function use conserv approach exclud cell think may express one gene set fals includ cell set nonexpress cell may erron inflat estim contamin wherea fail includ genuin nonexpress cell set signific effect end function exclud cluster cell cell deem genuin express gene set cluster data beyond scope packag perform user case x data map use cellrang load use codelinkloadx cellrang graph base cluster automat load use decid cell genuin express set gene poisson test use test whether observ express greater codemaximumcontamin time expect number count set gene cell assum deriv wholli background process made less conserv ie exclud fewer cellsclust either decreas valu maximum contamin user believ plausibl codemaximumcontamin make signific threshold test strict reduc codefdr exampl common gene list real world data genelist listhbchbbhba gene list appropri toy data genelist listcd cd ute estimatenonexpressingcellssctoygenelist seealso calculatecontaminationfract plotmarkermap gener roxygen edit hand pleas edit document rplotfunctionsr nameplotsoupcorrel aliasplotsoupcorrel titleplot correl express profil soup aggreg cell usag plotsoupcorrelationsc argument itemsca soupchannel object valu ggplot object contain plot descript calcul express profil aggreg count across cell plot log scale express profil soup gener roxygen edit hand pleas edit document rdatar doctypedata namesctoy aliassctoy titletoy soupchanel object format codesctoy codesoupchannel object usag datasctoy descript codelinksoupchannel object creat toy data use exampl detail toy data creat modifi version extrem reduc codeseurat codepbmc_smal dataset includ cluster tsne coordin flat estim contamin includ data gene cell use anyth test function repres real data way keyworddataset gener roxygen edit hand pleas edit document rdatar doctypedata namepbmc_metadata aliaspbmc_metadata titlepbmc k meta data format codepbmc_metadata datafram column rd rd cluster annot sourc urlhttpssupportxgenomicscomsinglecellgeneexpressiondatasetspbmck usag datapbmc_metadata descript collect bit meta data relat x pbmc k data detail data set pertain x demonstr pbmc k data includ metadata codedatafram name codepbmc_metadata codepbmc_metadata creat use seurat v calcul tsne represent data cluster cell command item item codesetse item codesrat createseuratobjectsctoc item codesrat normalizedatasrat item codesrat scaledatasrat item codesrat findvariablegenessrat item codesrat runpcasratpcscomput item codesrat runtsnesratdimsuseseq item codesrat findclusterssratdimsuseseqresolut item codepbmc_metadata asdataframesratdrtsnecellembed item codecolnamespbmc_metadata crdrd item codepbmc_metadataclust factorsratmetadatarownamespbmc_metadatar item codepbmc_metadataannot factorcbbt_cdt_cdt_cdt_cdnknkmnpmnpmnpascharacterpbmc_metadataclust keyworddataset gener roxygen edit hand pleas edit document rplotfunctionsr nameplotmarkerdistribut aliasplotmarkerdistribut titleplot distribut observ expect express marker gene usag plotmarkerdistribut sc nonexpressedgenelist maxcel tfidfmin argument itemsca soupchannel object itemnonexpressedgenelistwhich set gene use estim soup see codelinkcalculatecontaminationfract itemmaxcellsrandomli plot mani cell prevent overcrowd itemtfidfminminimum specif cutoff use find marker gene see codelinkquickmark itempass codelinkestimatenonexpressingcel valu ggplot object contain plot descript cell made pure background read express fraction would equal soup plot compar expect pure background observ express fraction cell group gene codenonexpressedgenelist group gene distribut ratio plot across cell valu significantli greater log scale obtain gene group genuin express cell assumpt cell pure background hold gene detail plot use diagnost assumpt list gene nonexpress cell type nonexpress cell ratio cluster around contamin fraction express cell elev use nonexpress gene set gene either strongli express express group gene show plot bimod distribut one mode contain cell express gene around contamin fraction channel anoth around valu valu equal greater nonlog scale express cell red line show global estim contamin group marker usual lower low mode distribut typic nonneglig number cell observ count henc infin log ratio codenonexpressedgenelist miss function tri find gene specif differ cluster often use estim contamin fraction meant heurist hope provid inspir class gene use estim contamin experi pleas blindli use top n gene found way estim contamin feed list gene codelinkcalculatecontaminationfract without manual consider filter overestim contamin often larg amount reason gene name return function exampl gg plotmarkerdistributionsctoylistcdcdltbltb gener roxygen edit hand pleas edit document radjustcountsr nameadjustcount aliasadjustcount titleremov background contamin count matrix usag adjustcount sc cluster null method csubtract souponli multinomi roundtoint fals verbos tol pcut argument itemsca soupchannel object itemclustersa vector cluster id name cellid null cluster autoload codesc fals cluster use see detail itemmethodmethod use correct see detail one multinomi souponli subtract itemroundtointshould result matrix round integ itemverboseinteg give level verbos silenc basic inform chatti debug itemtolallow deviat expect number soup count dont chang itempcutth pvalu cutoff use codemethodsouponli itempass expandclust valu modifi version tabl count background contamin remov descript level background contamin estim specifi channel calcul result correct count matrix background contamin remov detail essenti subtract mean expect background count gene redistribut unus count count unus subtract effect exampl subtract count gene zero count begin express data highli spars singl cell level highli recommend cluster inform provid allow subtract method share inform cell without group cell cluster difficult usual imposs tell differ count due background contamin count due endogen express ambigu remov cluster level count aggreg across cell inform propag back individu cell level provid accur remov contamin count provid cluster inform either set cluster soupchannel object codelinksetclust explicitli pass codeclust paramet coderoundtointtru function round result integ take floor connect valu round back probabl equal fraction part number codemethod paramet control remov count perform almost alway left default subtract iter subtract count gene describ souponli method use pvalu base estim procedur identifi gene confid identifi endogen express remov everyth els describ greater detail method either remov none express gene cell correct procedur much faster final multinomi method explicitli maximis multinomi likelihood cell method give essenti ident result subtract consider slower greater detail souponli method done sort gene within cell pvalu null expect soup fraction use poisson model gene definit endogen contribut end list p gene poor evid endogen cell express remov remov approxim numisrho molecul cutoff prevent remov gene numisrho cell achiev calcul separ pvalu total number count remov exceed numisrho use poisson model two pvalu combin use fisher method cutoff appli result combin pvalu calcul use chisquar distribut degre freedom exampl adjustcountssctoy return integ count adjustcountssctoyroundtointtru gener roxygen edit hand pleas edit document rutilsr nameexpandclust aliasexpandclust titleexpand soup count calcul cluster level cell level usag expandclustersclustsoupcnt cellobscnt cluster cellweight verbos argument itemclustsoupcntsmatrix gene row cluster column count number soup count geneclust combin itemcellobscntsmatrix gene row cell column give observ count itemclustersmap cell cluster itemcellweightsweight give cell distribut count would usual set number expect soup count cell itemverboseinteg give level verbos silenc basic inform chatti debug valu matrix gene row cell column give number soup count estim cell noninteg valu possibl descript given cluster cell soup count calcul cluster determin like alloc soup count cell level gener roxygen edit hand pleas edit document rsetpropertiesr namesetcontaminationfract aliassetcontaminationfract titlemanu set contamin fraction usag setcontaminationfractionsc contfrac forceaccept fals argument itemsca soupchannel object itemcontfracth contamin fraction either constant case valu use cell name vector case valu set cell itemforceaccepta warn error usual return extrem high contamin fraction set true turn messag proceed valu modifi soupchannel object contamin rho set descript manual specifi contamin fraction exampl sc loadxsystemfileextdatatoydatapackagesoupx sc setcontaminationfractionsc gener roxygen edit hand pleas edit document rquickmarkersr namequickmark aliasquickmark titleget top n marker cluster usag quickmarkerstoc cluster n fdr expresscut argument itemtoct count must spars matrix itemclustersvector length codencoltoc give cluster membership itemnnumb marker gene return per cluster itemfdrfals discov rate use itemexpresscutvalu gene consid express valu datafram top n marker pass hypergeometr test statist cluster descript use tfidf order get top n marker cluster cluster either top n gene pass hypergeometr test fdr specifi whichev list smallest detail term frequenc invers document frequenc use natur languag process identifi term specif document function use idea order gene within group predict group main advantag extrem fast give reason result gene express binaris cell cell either consid express gene replac count codetoc zerocut frequenc gene express within target group compar global frequenc calcul tfidf score also calcul multipl hypothesi correct pvalu base hypergeometr test extrem permiss exampl calcul marker cluster toy data mrk quickmarkerssctoytocsctoymetadataclust dontrun calcul marker seurat v object mrk quickmarkerssratassaysrnacountsratactiveid gener roxygen edit hand pleas edit document rsetpropertiesr namesetsoupprofil aliassetsoupprofil titleset soup profil usag setsoupprofilesc soupprofil argument itemsca soupchannel object itemsoupprofilea datafram column codeest contain fraction soup gene codecount contain total count gene row name correspond row name codesctoc valu updat soupchannel object soup profil set descript manual set updat soup profil soupchannel object exampl suppos tabl count avail toc seuratreadxsystemfileextdatatoydatafiltered_gene_bc_matricesgrch packagesoupx suppress calcul soup profil automat sc soupchanneltoctoccalcsoupprofilefals add manual rowsum matrixrowsum soupprof dataframerownam rownamestocestrowsumstocsumtoccountsrowsumstoc sc setsoupprofilescsoupprof gener roxygen edit hand pleas edit document rloadxr nameloadx aliasloadx titleload collect x dataset usag loadx datadir cellid null channelnam null readarg list includefeatur cgene express verbos true argument itemdatadirtop level cellrang output directori directori contain coderaw_gene_bc_matric folder itemcellidsbarcod droplet contain cell null use default cellrang set itemchannelnameth name channel store null set either codenamesdatadir codedatadir name set itemreadargsa list extra paramet pass codeseuratreadx itemincludefeaturesif multipl featur type present keep type mention collaps singl matrix itemverboseb verbos itemextra paramet pass codesoupchannel construct function valu soupchannel object contain count tabl x dataset descript load unfilt x data dataset identifi droplet cell use cellrang default exampl sc loadxsystemfileextdatatoydatapackagesoupx seealso soupchannel estimatesoup gener roxygen edit hand pleas edit document rutilsr namealloc aliasalloc titlealloc valu bucket subject weight constraint usag alloctgt bucketlim ws replengthbucketlim lengthbucketlim argument itemtgtvalu distribut bucket itembucketlimsth maximum valu bucket take must vector posit valu itemwsweight use bucket default valu make bucket equal like valu vector length codebucketlim contain valu distribut bucket descript alloc codetgt someth codelengthbucketlim differ bucket subject constraint bucket maximum valu codebucketlim exceed default count distribut equal bucket weight provid use codew redistribut prefer certain bucket other gener roxygen edit hand pleas edit document rpackag doctypepackag namesoupx aliassoupx titlesoupx profil quantifi remov ambient rna express droplet base rnaseq descript packag implement method describ ref first note nomenclatur soup use shorthand refer ambient rna contain input solut droplet base rnaseq experi end sequenc along cell endogen rna experi aim quantifi channel refer singl run input droplet base sequenc platform chromium x sequenc current channel per run instrument profil soup depend input solut minim unit soup estim subtract detail essenti step perform background correct decid gene express reason fraction cell soupx estim contamin fraction compar express nonexpress gene droplet contain cell soup defin empti droplet solid tissu set haemoglobin gene usual work well key properti gene easi identifi truli express ie express highli express highli specif certain cell type group cell type express level low confid express come soup low level express cell spikein rna best case scenario case spikein haemoglobin gene viabl estim user begin use linkplotmarkerdistribut function plot gene bimod distribut pattern express across cell consist high celltyp specif user select set gene use estim list one two high qualiti gene usual suffici obtain good estim averag contamin level channel gener roxygen edit hand pleas edit document rdatar doctypedata namepbmc_sc aliaspbmc_sc titlesoupchannel pbmc data format codepbmc_sc codesoupchannel object gene cell sourc urlhttpssupportxgenomicscomsinglecellgeneexpressiondatasetspbmck usag datapbmc_sc descript codelinksoupchannel creat x demonstr pbmc k data cell subsampl factor reduc file size packag detail codepbmc_sc creat run follow command item item codesetse item codetmpdir tempdirchecktru item codedownloadfilehttpcfxgenomicscomsamplescellexppbmckpbmck_raw_gene_bc_matricestargzdestfilefilepathtmpdirtodtargz item codedownloadfilehttpcfxgenomicscomsamplescellexppbmckpbmck_filtered_gene_bc_matricestargzdestfilefilepathtmpdirtoctargz item codeuntarfilepathtmpdirtodtargzexdirtmpdir item codeuntarfilepathtmpdirtoctargzexdirtmpdir item codelibrarysoupx item codepbmc_sc loadxtmpdircalcsoupprofilefals item codepbmc_sc soupchannelpbmc_sctodpbmc_sctocsamplencolpbmc_sctocroundncolpbmc_sctoc keyworddataset gener roxygen edit hand pleas edit document rclassfunctionsr namesoupchannel aliassoupchannel titleconstruct soupchannel object usag soupchanneltod toc metadata null calcsoupprofil true argument itemtodt droplet matrix column droplet row gene itemtoct count column codetod contain cell itemmetadatameta data pertain cell option must datafram rownam equal column name codetoc itemcalcsoupprofilebi default soup profil calcul use codelinkestimatesoup default valu want someth default set codefals call codelinkestimatesoup manual itemani name paramet store valu soupchannel object descript creat soupchannel object contain everyth relat soup estim singl channel exampl load droplet count tabl tod seuratreadxsystemfileextdatatoydataraw_gene_bc_matricesgrch packagesoupx toc seuratreadxsystemfileextdatatoydatafiltered_gene_bc_matricesgrch packagesoupx default calcul soup profil sc soupchanneltodtoc namessc suppress sc soupchanneltodtoccalcsoupprofilefals namessc seealso soupchannellist estimatesoup setsoupprofil setclust gener roxygen edit hand pleas edit document rcalculatecontaminationfractionr namecalculatecontaminationfract aliascalculatecontaminationfract titlecalcul contamin fraction usag calculatecontaminationfract sc nonexpressedgenelist usetoest verbos true forceaccept fals argument itemsca soupchannel object itemnonexpressedgenelista list contain set gene assum nonexpress subset cell see detail itemusetoesta boolean matrix dimens ncoltoc x lengthnonexpressedgenelist indic geneset assum nonexpress cell row name must correspond name codenonexpressedgenelist usual produc codelinkestimatenonexpressingcel itemverboseprint best estim itemforceacceptpass codelinksetcontaminationfract valu modifi version codesc estim contamin rho ad metadata tabl descript function comput contamin fraction use two userprovid bit inform firstli list set gene biolog assum absent least cell data set exampl might haemoglobin gene immunoglobulin gene express outsid erythroyct antibodi produc cell respect detail secondli function need know cell definit express gene set describ continu haemoglobin exampl erythrocyt produc haemoglobin mrna nonerythrocyt safe assum produc gene assumpt made express gene set cell mark nonexpressor gene set must deriv soup therefor level contamin present estim amount express gene seen cell often geneset user suppli base knowledg experi cell genuin express estim use codelinkestimatenonexpressingcel howev also suppli directli inform avail usual littl variat contamin fraction within channel littl power detect contamin accur singl cell level default mode oper simpli estim one valu contamin fraction appli cell channel global model fit simpl poisson glm aggreg count data across cell final note abl find reliabl set gene use contamin estim trust valu produc contamin fraction manual set user use codelinksetcontaminationfract exampl common gene list real world data genelist listhbchbbhba gene list appropri toy data genelist listcd cd ute estimatenonexpressingcellssctoygenelist sc calculatecontaminationfractionsctoygenelistut gener roxygen edit hand pleas edit document rutilsr nameinitprogbar aliasinitprogbar titlecr seurat style progress bar usag initprogbarmin max argument itemminminimum valu paramet itemmaxmaximum valu paramet itempass codelinktxtprogressbar valu txtprogressbar object use updat progress descript creat progress bar wont ruin log file show progress toward gener roxygen edit hand pleas edit document rclassfunctionsr nameprintsoupchannel aliasprintsoupchannel titleprint method soupchannel usag methodprintsoupchannelx argument itemxa soupchannel object itemcurr unus valu noth print messag consol descript print summari soupchannel object gener roxygen edit hand pleas edit document rsetpropertiesr namesetclust aliassetclust titleset cluster soupchannel usag setclusterssc cluster argument itemsca soupchannel object itemclustersa name vector entri cluster id name cellid name provid order assum match order codescmetadata valu updat soupchannel object cluster inform store descript add updat cluster inform metadata tabl soupchannel object exampl sc loadxsystemfileextdatatoydatapackagesoupx mdat readtablesystemfileextdatatoydatametadatatsvpackagesoupxsept sc setclustersscmdatr gener roxygen edit hand pleas edit document rautoestcontr nameautoestcont aliasautoestcont titleautomat calcul contamin fraction usag autoestcont sc topmark null tfidfmin soupquantil maxmark contaminationrang c rhomaxfdr priorrho priorrhostddev doplot true forceaccept fals verbos true argument itemscth soupchannel object itemtopmarkersa datafram give marker gene must sort decreas specif marker includ column gene contain gene name set null marker estim use codelinkquickmark itemtfidfminminimum valu tfidf accept marker gene itemsoupquantileonli use gene express quantil soup prevent inaccur estim due use gene poorli constrain contribut background itemmaxmarkersif heap good marker keep best codemaxmark itemcontaminationrangevector length constrain contamin fraction lie within rang must high end rang pass codelinkestimatenonexpressingcel codemaximumcontamin itemrhomaxfdrfals discoveri rate pass codelinkestimatenonexpressingcel test rho less codemaximumcontamin itempriorrhomod gamma distribut prior contamin fraction itempriorrhostddevstandard deviat gamma distribut prior contamin fraction itemdoplotcr plot show densiti estim itemforceacceptpass codelinksetcontaminationfract allow high contamin fraction use itemverboseb verbos valu modifi soupchannel object global contamin rate set inform estim also store slot codefit descript idea method gene highli express soup marker gene popul use estim background contamin marker gene identifi use tfidf method see codelinkquickmark contamin fraction calcul cluster level gene cluster aggress prune remov give implaus estim detail set marker gene filter includ tfidf valu greater codetfidfmin higher tfidf valu impli specif marker specif cutoff impli marker gene properti genefreqglob exptgenefreqinclust see codelinkquickmark may necessari decreas valu data set good marker set marker gene filter includ gene highli express soup control codesoupquantil paramet gene highli express soup provid precis estim contamin fraction prune implaus cluster base call codelinkestimatenonexpressingcel paramet codemaximumcontaminationmaxcontaminationrang coderhomaxfdr pass function default set calibr aggress prune anyth even weakest evid genuin express clustergen pair posterior distribut contamin fraction calcul base gamma prior control codepriorrho codepriorrhostddev posterior distribut aggreg produc final estim contamin fraction logic behind estim cluster truli estim contamin fraction cluster around true valu erron estim spread across rang without prefer valu probabl valu contamin fraction taken final global contamin fraction exampl use less specif marker sctoy autoestcontsctoytfidfmin allow larg contamin fraction alloc sctoy autoestcontsctoyforceaccepttru quiet sctoy autoestcontsctoyverbosefalsedoplotfals seealso quickmark gener roxygen edit hand pleas edit document restimatesoupr nameestimatesoup aliasestimatesoup titleget express profil soup usag estimatesoupsc souprang c keepdroplet fals argument itemsca codesoupchannel object itemsouprangedroplet total umi count rang exclud endpoint use estim soup itemkeepdropletsstor full tabl count droplet use lot space realli use estim soup profil therefor drop soup profil estim unless set codetru valu modifi version codesc extra codesoupprofil entri contain datafram soup profil confid limit gene descript usual call codelinksoupchannel rather directli user use empti droplet rang provid calcul express profil soup assumpt droplet contain background exampl load droplet count tabl tod seuratreadxsystemfileextdatatoydataraw_gene_bc_matricesgrch packagesoupx toc seuratreadxsystemfileextdatatoydatafiltered_gene_bc_matricesgrch packagesoupx suppress calcul soup profil automat load sc soupchanneltodtoccalcsoupprofilefals retain tabl droplet sc estimatesoupsckeepdropletstru use nondefault valu sc estimatesoupscsouprangec gener roxygen edit hand pleas edit document rplotfunctionsr nameplotmarkermap aliasplotmarkermap titleplot ratio observ expect count reduc dimens map usag plotmarkermap sc geneset dr ratlim c fdr usetoest null pointsiz pointshap pointstrok napoints argument itemscsoupchannel object itemgeneseta vector name gene aggreg plot evid itemdra datafram row name uniqu cell id ie channelname_barcod first two column give coordin cell reduc dimens represent data tri fetch automat miss itemratlimstrunc log ratio valu itemfdrfals discoveri rate statist test enrich background itemusetoesta vector usual obtain codelinkestimatenonexpressingcel use mark cell instead usual poisson test itempointsizes point itempointshapeshap point itempointstrokestrok size point itemnapointsizepoint size na valu ggplot contain plot descript given reduc dimension represent data umap tsne calcul howev would like provid way visualis like set gene soup deriv map given set gene function calcul mani count would expect droplet noth soup compar observ count done via log ratio two valu poisson test perform point statist signific enrich background fdr mark exampl gg plotmarkermapsctoycd gener roxygen edit hand pleas edit document rplotfunctionsr nameplotchangemap aliasplotchangemap titleplot map compar correctedraw express usag plotchangemap sc cleanedmatrix geneset dr datatyp csoupfrac binari count logdata fals pointsiz argument itemscsoupchannel object itemcleanedmatrixa clean matrix compar raw one usual output codelinkadjustcount itemgeneseta vector name gene aggreg plot evid itemdra datafram row name uniqu cell id ie channelname_barcod first two column give coordin cell reduc dimens represent data itemdatatypehow data repres binari set cell express count convert everyth count soupfrac plot fraction observ count identifi contamin ie oldnewold cell default itemlogdatashould log thing plot itempointsizes point valu ggplot contain plot descript given reduc dimension represent data umap tsne calcul howev would like provid way visualis express geneset chang soup correct exampl adjustcountssctoy gg plotchangemapsctoyoutsa gener roxygen edit hand pleas edit document rsetpropertiesr namesetdr aliassetdr titlemanu set dimens reduct channel usag setdrsc dr reductnam null argument itemsca soupchannel object itemdrth dimens reduct coordin eg tsne must datafram two column give two dimens reduct coordin datafram must either row name match row name scmetadata order order scmetadata itemreductnamewhat name reduct default column name provid valu modifi soupchannel object dimens reduct set descript manual specifi dimens reduct exampl sc loadxsystemfileextdatatoydatapackagesoupx mdat readtablesystemfileextdatatoydatametadatatsvpackagesoupxsept sc setdrscmdatctsne_tsne_