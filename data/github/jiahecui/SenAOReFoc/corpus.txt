user guid senaorefoc doihttpsjosstheojorgpapersjossstatussvghttpsdoiorgjoss introduct senaorefoc closedloop sensorbas adapt optic ao remot focus control softwar work deform mirror dm shackhartmann wavefront sensor shw provid userfriendli graphic user interfac gui modular widget arrang clear label help user navig differ softwar function interact messag also display gui user guidanc senaorefoc consist main unit shw initialis dm calibr unit zernik aberr input unit ao control data collect unit miscellan control unit remot focus unit softwar ran either debug mode perform function test without connect hardwar dm shw standard mode wellalign optic section microscop confoc multiphoton etc user control system paramet freeli access modifi separ configur file load upon softwar initialis paramet requir continu user input modifi gui paramet calcul run softwar well import result data group save separ hdf file read hdfview softwar autom ao perform characteris perform standard mode assess correct abil optic system adopt dm design larg stroke ie capabl larg deform closedloop ao correct remot focus function exploit hand dm exhibit insuffici stroke remot focus ignor remot focus unit closedloop ao correct function still fulli function without addit modif softwar closedloop ao correct perform use zonal method updat dm control voltag term raw slope valu modal method updat dm control voltag term orthogon zernik polynomi four submod tag two method standard closedloop ao correct closedloop ao correct consider obscur search block closedloop ao correct partial correct exclud defocu closedloop ao correct consider obscur search block partial correct exclud defocu remot focus perform scan focu axial predetermin axial rang step increment step number manual adjust toggl bar gui random access remot focus former also incorpor option whether perform closedloop ao correct remot focus depth softwar valid reflect confoc microscop howev also fulli compat fluoresc microscop system design closedloop configur script includ folder gener descript apppi set gui event handler display gui instanti devic dm shw ao_slopespi perform closedloop ao correct via direct slope zonal correct ao_zernikespi perform closedloop ao correct via zernik modal correct calibration_rfpi perform remot focus calibr use closedloop ao correct calibration_zernpi gener dm control matrix calibrationpi perform dm calibr centroid_acquisitionpi method centroid sh spot centroidingpi perform system aberr calibr configpi set configur file path configyaml configur file incorpor system static paramet pleas chang add need accord specif system conversionpi perform slope zernik convers data_collectionpi perform autom characteris microscop ao perform hdf_dsetpi method gener append data hdf dataset image_acquisitionpi method imag acquisit logpi method set event log mirrorpi perform dm initialis sb_geometrypi perform initialis search block geometri sb_positionpi perform reposit search block sensorpi perform shw initialis sh_acquisitionpi perform shw imag acquisit zernikepi gener zernik polynomi deriv instal instruct need follow opensourc softwar instal function modifi senaorefoc python httpswwwpythonorgdownload git httpswwwpythonorgdownload linuxmaco run bash git version follow instruct sourcecod editor visual studio code httpscodevisualstudiocom need opensourc hdfview softwar instal directli view data store hdf file hdfview httpsportalhdfgrouporgdisplaysupportdownloadhdfview instal creat local folder navig within folder command prompt clone sourcecod git repositori bash git clone httpsgithubcomjiahecuisenaorefocgit navig within senaorefoc folder set virtual environ option recommend window bash python venv venv linuxmaco bash python venv venv activ virtual environ window bash venvscriptsactiv linuxmaco bash sourc venvbinactiv instal packag depend bash pip instal r requirementstxt maco may need prior instal wheel modul includ numpi pysid qimagendarray click scipi hpi pyyaml use older oper system pysid hpi also oper current softwar instal project edit mode bash pip instal e current work exampl import hardwar api window oper system use maco linux pleas comment relev line mirrorpi sensorpi image_acquisitionpi proceed includ python alpaolib import asdk class mirror_alpaoasdkdm ximea import xiapi class sensor_ximeaxiapicamera img xiapiimag proceed ximea camera use linux correspond xiapi python bind requir instal use ximea sdk instal found httpswwwximeacomsupportwikiapisximea_linux_software_packag proceed alpao dm use linux python bind current requir sdk instal found httpalpaocomdownloadalpaosdk packag python version soon support follow releas final senaorefoc run standard mode avail hardwar devic dm shw window bash python sensorbasedaoapppi maco bash python sensorbasedaoapppi well debug mode absenc hardwar devic set dummi devic purpos test softwar function window bash python sensorbasedaoapppi maco bash python sensorbasedaoapppi detail descript perform function test debug mode without connect hardwar found softwar function test section exit softwar also exit virtual environ command prompt run bash deactiv softwar function test perform function test without hardwar leav paramet configyaml default run softwar debug mode perform follow test sequenc initialis sb search block region appear imageview search block across diamet messag box search block geometri initialis number search block within pupil posit sb white dot appear centr search block messag box need calibr dm yn click command prompt press keyboard messag box reposit search block use keyboard press arrow key centr sh spot search block press enter finish press key keyboard reposit search block press enter confirm messag box search block posit confirm calibr messag box dummi dm actuat coordin load sz conv messag box exit slope zernik convers process calibratez messag box exit zernik control matrix calibr process reset dm messag box dm reset success adjust remot focus toggl bar messag box focu posit xx um code coverag effect function test measur instal coveragepi command prompt bash pip instal coverag run softwar debug mode bash coverag run sourc sensorbasedaoapppi perform function test quit softwar run command prompt bash coverag report sensorbasedaoapppi one get report look like follow around code coverag would higher button test would differ execut differ function realiti mediaimagepngclassescaptionlightbox get start instal softwar pleas run senaorefoc debug mode perform function test accord procedur given softwar function test section run senaorefoc microscop system standard mode modifi softwar script pleas first read note develop section bottom document follow instruct accordingli check configyaml file incorpor system static paramet requir correctli function softwar modif made accord specif system new paramet ad need paramet comment current exampl work alpao dm custom shw ximea cmo camera particular paramet need modifi basic closedloop ao correct includ python camera sn xxxxxxxx exposur us frame_r hz sensor_width pixel sensor_height pixel sensor_diam mm ximea bin_factor ximea pixel_s um ximea dm sn xxxxxxxx exercis flag whether exercis dm upon initialis vol_min v neg voltag appli dm calibr vol_max v posit voltag appli dm calibr vol_bia neutral voltag dm actuat settling_tim dm membran settl time dm actuator_num alpao pitch um apertur mm relay mirror_odd flag whether odd number mirror dm lenslet relay_odd flag whether odd number relay dm lenslet lenslet lenslet_pitch um lenslet_focal_length um search_block pupil_diam_ mm diamet beam incid shw sys_calib sys_calib_mod mode flag system aberr calibr method load previou system aberr calibr profil perform new system aberr correct system aberr correct ao zern_gen flag gener zernik mode dm ao_zernikespi ao_slopespi iter gener loop_max_gen maximum number loop closedloop control gener zernik mode recon_coeff_num number zernik mode use wavefront reconstruct control_coeff_num number zernik mode control ao correct note dm exercis option may need set electromagnet mirror observ substanti thermal effect start process send random voltag within dm actuat press initialis sb paramet modifi procedur perform basic closedloop ao correct note microscop use reflect contrast perform scan small region scatter sampl avoid specular reflect lead doublepass effect caus error aberr measur fluoresc microscop fluoresc bead use sampl static beam dm calibr gui press initialis sb posit sb follow instruct messag box reposit search block area calibr sz conv calibratez system aberr calibr perform system aberr calibr anew make sure correspond mode flag left default configyaml python sys_calib sys_calib_mod mode flag system aberr calibr method load previou system aberr calibr profil perform new system aberr correct system aberr correct gui press calibratesi run closedloop ao correct zonal control strehl ratio given toler factor default maréchal criterion save final dm control voltag dm system flat file hdf file halt dm system flat file appli separ imag perform load previou dm system flat file chang correspond mode flag configyaml python sys_calib sys_calib_mod mode flag system aberr calibr method load previou system aberr calibr profil perform new system aberr correct system aberr correct gui press calibratesi automat load dm system flat file last calibr session halt dm system flat file appli ignor system aberr correct subsequ closedloop ao correct process chang correspond mode flag configyaml python sys_calib sys_calib_mod mode flag system aberr calibr method load previou system aberr calibr profil perform new system aberr correct system aberr correct gui press calibratesi save current centroid coordin refer centroid coordin converg closedloop ao correct closedloop ao correct closedloop ao correct perform without first gener zernik mode dm set correspond mode flag default valu configyaml python ao zern_gen flag gener zernik mode dm ao_zernikespi ao_slopespi iter gener closedloop ao correct perform use differ approach differ submod explain function document altern characteris purpos zernik mode first appli dm perform closedloop ao correct chang correspond mode flag configyaml python ao zern_gen flag gener zernik mode dm ao_zernikespi ao_slopespi iter gener function document shw initialis dm calibr unit initialis sb determin search block sb geometri given user inform paramet lenslet pitch actual diamet one lenslet dimens pixel size camera sensor well incid pupil diamet button also exercis dm membran gener user specifi number random pattern dm posit sb reposit sb region camera sensor concentr incid beam achiev two way depend whether dm requir recalibr user input need stage enter n keyboard enter user reposit sb region enter arrow keyboard shift entir sb region one pixel time display new locat central sh spot centr within correspond sb press enter keyboard user confirm new sb posit trigger process automat calcul new sb refer centroid coordin upon enter n sb dm calibr relat paramet last session automat load hdf file calibratesi perform system aberr calibr three mode mode automat load dm control voltag correct system aberr dm system flat file last calibr session onto dm mode run closedloop ao correct zonal control strehl ratio given toler factor save final dm control voltag dm system flat file hdf file mode design ignor system aberr correct small stroke dm save current centroid coordin refer converg closedloop ao correct calibr perform dm calibr retriev control matrix cm direct slope zonal control posit neg bia control voltag provid user sequenti appli dm actuat retriev x yslope valu use calcul dm influenc function matrix slope cm comput pseudoinvers sz conv calcul convers matrix raw slope valu zernik coeffici use calcul strehl ratio evalu imag qualiti zonal control acquir dm matrix cm modal control calibratez retriev cm modal control use result acquir calibr sz conv perform pseudoinvers dm matrix result singular valu decomposit first evalu identifi cutoff valu small singular valu usual select valu signific drop seen system mode valu remov pseudoinvers acquisit stabl zernik cm zernik aberr input unit zernik aberr input unit mainli use thorough characteris system ao perform specifi certain amount zernik mode gener dm membran zernik mode order accord osaansi standard piston remov mode start tip zernik mode spin box allow user specifi singl mode number amplitud given zernik valu spin box unit micron mode combin specifi zernik array edit box provid array coeffici correct mode order irrelev mode set zero mode maximum mode number control ao correct userdefin gener ao control data collect unit core softwar unit respons closedloop ao control autom data collect zernik modal direct slope zonal control perform differ mode discuss zernik ao perform basic closedloop modal ao control updat dm control voltag zernik cm obtain calibratez submod gener zernik aberr mode closedloop ao correct submod gener aberr specifi zernik aberr input unit dm membran perform closedloop ao correct latter submod especi use simpl characteris system ao perform zernik ao modifi version zernik ao take account miss illform spot obscur sb detect shw due arbitrarili shape pupil zernik ao modifi version zernik ao suppress correct zernik defocu refocus focal spot minimis slope ao perform basic closedloop zonal ao control updat dm control voltag direct slope cm obtain calibr submod describ zernik ao also appli slope ao modifi version slope ao fulfil purpos zernik ao slope ao modifi version slope ao fulfil purpos zernik ao zernik full slope full perform closedloop ao control take account obscur sb suppress zernik defocu time data collect design perform autom ao perform characteris microscop system though data collect process would benefit autom written beneath hood oper mode identifi uniqu mode flag configyaml determin softwar initialis exampl execut autom ao perform characteris real microscop system found exampl usag section miscellan control unit independ imag acquisit perform mode live acq continu acquir imag display gui userdefin frame rate exposur time termin click button second time burst acq acquir userdefin number frame burst mode automat termin singl acq acquir one imag reset dm reset actuat neutral posit camera exposur time spin box control exposur time shw given unit microsecond maximum loop spin box determin maximum number iter termin ao control loop remot focus unit remot focus unit control paramet procedur relev calibr execut remot focus use dm calibr trigger calibr dm control voltag remot focus calibr perform displac planar sampl increment step along optic axi compens displac use closedloop ao correct allow system aberr remot focus depth correct well detail remot focus calibr process pleas refer softwar perform step process proce along neg direct posit direct calibr determin within configur file prior softwar initialis import paramet includ number axial distanc increment step python rf_calib calib_step_num number step use one direct calibr remot focus calib_step_incr um axial increment step calibr remot focus calib_direct direct calibr neg posit messag display messag box inform user current calibr direct step number well provid user option confirm sampl move next calibr step save discard calibr voltag exit thread command enter via keyboard typic exampl interact command messag move sampl posit posit press confirm press save exit press discard exit softwar automat save calibr voltag hdf file reach maximum userdefin step number request arbitrari step interpol dm control voltag acquir calibr step remot focus voltag load upon softwar initialis scan focu control whether remot focus perform one depth multipl depth untick first spin box lefthandsid panel access other disabl tick otherwis true move perform remot focus one depth first retriev dm control voltag correspond specifi focu depth micron appli voltag dm move focu rel natur focal plane neg valu move toward zaxi posit one zaxi scan perform remot focus sequenti multipl depth appli differ set voltag dm membran scan focu depthwis step increment micron control displac interv consecut remot focus plane step number number plane access start depth micron depth start remot focus process rel natur focal plane depth paus time time focal spot remain stabl remot focus plane enter neg valu step increment micron permit remot focus zdirect ao correct type allow user choos whether appli ao correct remot focus plane type appli four option avail drop box zernik ao zernik full slope ao slope full featur discuss option applic remot focus process behind move scan default set none remot focus toggl bar permit random access differ remot focus plane imag simpli drag bar desir depth default set natur focal plane maxmin limit provid user accord remot focus calibr result chang minimum maximum valu rfslider widget qt design valu calcul depth um step increment um mediaimagepngclassescaptionlightbox exampl usag pleas refer metapap associ softwar arxiv exampl autom ao perform characteris real reflect confoc microscop note develop current softwar assum use electromagnet dm actuat displac linearli proport appli control voltag case devic driven linearli neg posit direct appli normalis control voltag img srchttpsrendergithubusercontentcomrendermathmathfracvv_textmax img srchttpsrendergithubusercontentcomrendermathmathv_textmax maximum control voltag howev electrostat dm use actuat displac would proport squar appli control voltag case order drive devic linearli normalis control voltag given img srchttpsrendergithubusercontentcomrendermathmathleftfracvv_textmaxright shw use current exampl custom built use ximea camera sensor interfac differ shw differ camera requir minor modif softwar two aspect sensor instanti imag acquisit former modifi sensorpi new class ad new sensor similar way given exampl sensorpi latter modifi image_acquisitionpi new imag instanc creat accord specif sensor api dm use current exampl alpao dm similar interfac differ dm requir modif softwar two aspect mirror instanti dm control command former modifi mirrorpi new class ad new dm similar way given exampl mirrorpi latter use new command replac applic python selfmirrorsendvoltag selfdevicesmirrorsendvoltag selfmirrorreset selfdevicesmirrorreset issu support issu problem found softwar pleas use issu tracker httpsgithubcomjiahecuisenaorefocissu make gener inquiri use softwar modifi softwar integr exist hardwar pleas email jiahecuiengoxacuk cite your use modifi version softwar work pleas cite joss paper associ softwar click link top readm file your perform remot focus use calibr procedur set softwar pleas also cite either httpsdoiorgbodadtha httpsdoiorgo licenc gnu gener public licens version httpsopensourceorglicensesgpl refer u bitenc softwar compens method achiev high stabil alpao deform mirror opt express httpsdoiorgo p artal marco r navarro r william odd aberr doublepass measur retin imag qualiti j opt soc httpsdoiorgjosaa b dong j booth wavefront control adapt microscopi use shackhartmann sensor arbitrarili shape pupil opt express httpsdoiorgo j ye w wang z gao z liu wang p benítez j c miñano q yuan modal wavefront estim slope numer orthogon transform method gener shape apertur opt express httpsdoiorgo j cui b dong j booth shackhartmann sens arbitrarili shape pupil zenodo httpsdoiorgzenodo j cui r turcott k hampson n j emptag j booth remotefocuss volumetr imag contactless labelfre neurosurg microscop biophoton congress c boudoux k maitland c hendon wojtkowski k quinn schanneklein n durr elson f cicho l oddershed v emiliani maragò nic chormaic n pégard gibb vinogradov niedr k samko devor peterka p blinder e buckley ed osa technic digest optic societi america paper dtha httpsdoiorgbodadtha j cui r turcott n j emptag j booth extend rang aberrationfre autofocus via remot focus sequencedepend learn opt express httpsdoiorgo u bitenc n bharmal j morri r myer assess stabil alpao deform mirror feedforward oper opt express httpsdoiorgo titl senaorefoc closedloop sensorbas adapt optic remot focus control softwar tag python sensorbas adapt optic remot focus dm shw author name jiah cuijiahecuiengoxacuk orcid affili name karen hampson affili name matthew wincott affili name martin j booth affili affili name depart engin scienc univers oxford park road oxford ox pj uk index date decemb bibliographi paperbib summari senaorefoc closedloop sensorbas adapt optic ao remotefocus control softwar work deform mirror dm shackhartmann wavefront sensor shw provid userfriendli graphic user interfac gui modular widget arrang clear label help user navig differ softwar function interact messag also display gui user guidanc senaorefoc consist five main unit shw initialis dm calibr unit zernik aberr input unit ao control data collect unit miscellan control unit remot focus unit shown autoreffiggui softwar run either debug mode perform function test without connect hardwar dm shw standard mode wellalign optic section microscop confoc multiphoton etc user control system paramet freeli access modifi separ configur file load upon softwar initialis paramet requir continu user input modifi gui paramet calcul run softwar well import result data group save separ hdf file read hdfview softwar autom ao perform characteris perform standard mode assess correct abil optic system adopt dm design larg stroke ie capabl larg deform closedloop ao correct remot focus function exploit hand dm exhibit insuffici stroke remot focus ignor remot focus unit closedloop ao correct function still fulli function without addit modif softwar closedloop ao correct perform use zonal method updat dm control voltag term raw slope valu modal method updat dm control voltag term orthogon zernik polynomi four submod tag two method standard closedloop ao correct closedloop ao correct consider obscur search block closedloop ao correct partial correct exclud defocu closedloop ao correct consider obscur search block partial correct exclud defocu remot focus perform scan focu axial predetermin axial rang step increment step number manual adjust toggl bar gui random access remot focus former also incorpor option whether perform closedloop ao correct remot focus depth graphic user interfac gui senaorefoc modular unit label red boxeslabelfigguimediaimagepng width statement need perform optic microscop degrad significantli presenc optic aberr develop due misalign optic system inhomogen refract index imag sampl result compromis imag resolut contrast adapt optic ao power techniqu correct optic aberr use reconfigur adapt devic deform mirror dm spatial light modul slm restor imag qualiti boothlightscienceappl crucial highqual imag superresolut deep imag remot focus axial scan techniqu recent introduc avoid slow movement sampl stage object len realtim applic jinatureneurosci use dm remot focus calibr perform closedloop ao correct simultan correct system aberr introduc beam diverg differ focus depth zurauskasbiomedicalopticsexpress sensorbas ao use dedic sensor measur wavefront plattjournalofrefractivesurgeri first introduc field astronomi becker sinc also wide adopt vision scienc porter godaraoptometryandvisionsci microscopi boothphilosophicaltransact jinaturemethod rang softwar serv differ astronom purpos introduc time includ simul ao system carbilletmonthlynoticesoftheroyalastronomicalsocieti conan control atmospher tomographi ahmadia fast control use gpu hardwar guyon microscopi commun softwar also openli avail ao model analysi townsonopticsexpress well gener ao control hallopticsexpress howev yet exist opensourc softwar serv purpos perform ao remot focus within singl packag despit techniqu wide adopt result time effort spent reimplement exist techniqu differ hardwar system senaorefoc aim fill gap make closedloop sensorbas ao fernandezopticslett remot focus easili access microscopi commun design open develop easi integr exist adapt optic microscop simpl userfriendli architectur function softwar also test differ oper system windowslinuxmaco sake gener softwar fulli oper window debug mode standard mode hardwar control linux maco function test debug mode pass system hardwar packag import pythonbind ximea camera python bind alpao dm compat linux system pythonbind alpao dm linux also compat follow releas howev note senaorefoc control softwar perform closedloop ao correct practic inevit depend state optic system final senaorefoc take care report issu field thermal effect electromagnet dm bitencopticsexpress obscur search block case sever distort pupil dongopticsexpress yeopticsexpress cuizenodo former case option provid exercis dm membran send routin set random control voltag actuat upon softwar initialis latter case control algorithm zonal modal method modifi compar standard case ensur orthogon control exampl usag four exampl given usag softwar first three autom ao perform characteris reflect confoc microscop describ cuibiophoton cuiopticsexpress last remot focus frozen mous skull report cuibiophoton exampl dynam rang shw first n zernik mode characteris gener correct closedloop use mode data collect autoreffigexamplea provid exampl characteris zernik mode excl tiptilt autoreffigexampleb provid exampl gener detect rm amplitud select oddeven zernik mode increment micromet paramet configyaml ao data_collect set follow python ao control_coeff_num number zernik mode control ao correct data_collect data_collect_mod mode flag data collect button detail function descript apppi loop_max_gen maximum number loop closedloop gener zernik mode mode incre_num number zernik mode amplitud gener mode incre_amp increment amplitud zernik mode mode run_num number time run mode characteris result system ao correct perform dynam rang shw zernik mode excl tiptilt gener detect rm amplitud oddeven zernik mode b c e increment micromet five test perform measurementlabelfigexamplemediaimagepng width exampl degre zernik mode coupl upon detect shw characteris individu gener amount mode dm construct heatmap detect zernik coeffici use mode data collect autoreffigexampl provid exampl heatmap correl coeffici detect gener mode valu micromet zernik mode excl tiptilt paramet configyaml data_collect set follow python data_collect data_collect_mod mode flag data collect button detail function descript apppi loop_max_gen maximum number loop closedloop gener zernik mode mode incre_num number zernik mode amplitud gener mode incre_amp increment amplitud zernik mode mode run_num number time run mode heatmap correl coeffici detect gener mode valu micromet zernik mode excl tiptiltlabelfigexamplemediaimagepng width exampl ensur system correct multipl zernik mode good stabil minim mode coupl differ combin odd even zernik mode gener correct closedloop use mode data collect autoreffigexampl provid exampl detect amplitud strehl ratio closedloop iter odd even zernik mode combin paramet configyaml data_collect set follow python data_collect data_collect_mod mode flag data collect button detail function descript apppi loop_max_gen maximum number loop closedloop gener zernik mode mode run_num number time run mode zernik array edit box set detect amplitud gener odd even zernik mode combin strehl ratio calcul use first zernik mode excl tiptilt closedloop iter test perform measur labelfigexamplemediaimagepng exampl voltag control dm actuat deform membran fine axial remot focus calibr accord procedur explain github repositoryhttpsgithubcomjiahecuisenaorefoc report cuibiophoton cuiopticsexpress calibr press direct optic axi piec white card displac micromet time press keyboard proceed closedloop ao correct interpol dm control voltag calibr step perform obtain micromet increment softwar remot focus capabl demonstr frozen mous skull cuibiophoton show notic differ resolut size field view compar standard translat sampl stage result also shown autoreffigexampl remot focus result within frozen mous skull stack imag acquir micromet axial step micromet depth rang top row result obtain scan sequenti multipl depth use precalibr dm control voltag bottom row comparison result obtain axial translat sampl stage b colourcod maximum intens project frame micromet interv scale bar micrometerslabelfigexamplemediaimagepng cite your use modifi version softwar work pleas cite paper your perform remot focus use calibr procedur set softwar pleas also cite either cuibiophoton cuiopticsexpress acknowledg thank chao test softwar function use differ oper system work support european research council project refer