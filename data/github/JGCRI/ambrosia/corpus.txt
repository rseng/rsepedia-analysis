linuxhttpsgithubcomjgcriambrosiaactionsworkflowsbuild_linuxymlbadgesvghttpsgithubcomjgcriambrosiaactionsworkflowsbuild_linuxyml osxhttpsgithubcomjgcriambrosiaactionsworkflowsbuild_osxymlbadgesvghttpsgithubcomjgcriambrosiaactionsworkflowsbuild_osxyml windowshttpsgithubcomjgcriambrosiaactionsworkflowsbuild_windowsymlbadgesvghttpsgithubcomjgcriambrosiaactionsworkflowsbuild_windowsyml codecovhttpscodecovioghjgcriambrosiabranchmastergraphbadgesvghttpscodecovioghjgcriambrosia doihttpszenodoorgbadgesvghttpszenodoorgbadgelatestdoi statushttpsjosstheojorgpapersbafbbfbddeefstatussvghttpsjosstheojorgpapersbafbbfbddeef ambrosia r packag calcul analyz food demand respons chang incom price summari ambrosia r packag develop calcul food demand stapl nonstapl commod respons chang level incom price ambrosia implement framework quantifi food demand establish edmond et al allow user explor estim differ variabl relat food demand system current ambrosia provid three main function calcul food demand given set paramet includ incom level price estim calibr paramet within given dataset note ambrosia use calcul paramet food demand model implement global chang analysi modelhttpwwwglobalchangeumdedugcam explor prepar raw data start paramet estim statement need audienc import motiv develop ambrosia function separ differ compon sophist food demand framework usabl r function easili parameter custom userthu tool enabl easi use futur develop also enabl easi modular code within system ambrosia develop help research explor question relat trend food demand empir sinc equat model ground peer review research code written r increas usabl tool use research interest analyz explor trend food demand comput model respons chang incom price easili implement time seri dataset reestim calibr paramet food demand model use custom data thu effect allow user calibr model custom data incorpor detail food demand model earth system econom model get start ambrosia ambrosia directli instal github repositori use r devtool packag r prompt run command r devtoolsinstall_githubjgcriambrosia build_vignett true user tutori exampl list exampl along user tutori describ differ featur ambrosia avail ambrosia_vignettehttpsjgcrigithubioambrosiaarticlesambrosia_vignettehtml load vignett exampl major function within ambrosia run follow command r vignetteambrosia_vignett exampl show user get estim demand use sampl paramet see tabl descript paramet r get sampl data set test_data dataframeyseq add sampl valu ps pn test_data mutatepspn test_data calcul food demand food_demand fooddmndtest_datap test_datapn test_datay code exampl use visual food demand stapl nonstapl follow simpl plot food demand stapl nonstapl chang incom constant pricesvignettesexample_png descript calibr paramet calibr paramet describ tabl valu latest version ambrosia tabl also contain accept rang paramet origin paramet calcul use markov chain mont carlo mcmc approach rang calcul joint confid interv rang paramet appera mont carlo sampl likelihood valu th percentileparamet tabl calibr basi nation level data food consumpt food consumpt price stapl nonstapl product paramet name descript unit valu rang paramet valu a_ scale term use deriv expenditur share stapl demand unitless a_n scale term use deriv expenditur share nonstapl demand unitless xi_ss price elast stapl good unit chang per capita demand stapl result unit increas price per person per day elast xi_cross cross price elast stapl nonstapl combin price elast use deriv substitut elast elast xi_nn price elast nonstapl good unit chang per capita demand nonstapl result unit increas price per person per day elast nu_n incom elast nonstapl good unit chang per capita demand nonstapl unit chang incom thousand usd elast lambda_ incom elast stapl good unit chang per capita demand stapl unit chang incom thousand usd elast k_ log incom level stapl demand anticip highest thousand usd psscl addit scale term use deriv expenditur share stapl appli price stapl pspm psscl ps price stapl pm price materi expenditur share stapl alpha_ unitless pnscl addit scale term use deriv expenditur share nonstapl appli price nonstapl pnpm pnscl pn price nonstapl pm price materi expenditur share nonstapl alpha_n unitless pm price materi everyth els economi food product per day simpl exampl equat deriv demand use calibr paramet describ simpl exampl quantiti demand stapl q_ nonstapl q_n thousand calori calcul use calibr paramet incom level thousand usd stapl price ps per calori per day nonstapl price pn per calori per day r stapl demand q_ a_ ps xi_ss pn xi_cross income_term_stapl income_term_stapl k_ lambda_ pn pnpm ps pspm nonstapl demand q_n a_n ps xi_cross pn xi_nn income_term_non_stapl income_term_non_stapl nu_n pn pnpm ps pspm contribut ambrosia welcom contribut ambrosia develop commun pleas contact us email id want collabor ambrosia github repositori access github repositoryhttpsgithubcomjgcriambrosia order report issu ambrosia pleas open issu mention github repositori inform contribut pleas contact kanishka narayan kanishkanarayanpnnlgov chri vernon chrisvernonpnnlgov avail oper system mac os x linux window program languag r depend dplyr nleqslv reshap ggplot cluster tidyr code repositori name github jgcriambrosia identifi httpsgithubcomjgcriambrosiatreev licens bsd claus titl ambrosia r packag calcul analyz food demand respons chang incom price author affili name kanishka narayan orcid affili name chri r vernon orcid affili name stephani waldhoff orcid affili name jame edmond orcid affili name ryna cui orchid date octob output word_docu default pdf_document fig_capt ye html_document df_print page bibliographi paperbib tag r gcam food affili index name joint global chang research institut pacif northwest nation laboratori colleg park md usa index name univers maryland summari ambrosia r packag develop calcul food demand stapl nonstapl commod respons chang level incom price ambrosia implement framework quantifi food demand establish edmondsglob allow user explor estim differ variabl relat food demand system current ambrosia provid three main function calcul food demand given set incom level price estim calibr paramet within given dataset note ambrosia use calcul calibr paramet food demand model implement global chang analysi model gcam calvingcam explor prepar raw data start calibr paramet estim statement need import motiv develop ambrosia function separ differ compon sophist food demand framework edmondsglob summar usabl r function easili parameter custom user thu ambrosia develop help research explor question relat trend food demand empir sinc equat model ground peer review research code written r increas usabl tool use research interest analyz explor trend food demand comput model respons chang incom price easili implement time seri dataset reestim calibr paramet food demand model use custom data thu effect allow user calibr model custom data incorpor detail food demand model earth system econom model ambrosia part ecosystem tool within global chang intersector model system gcim help user comput explor scienc polici question relat differ dimens humanearth system pnnl_ paramet calcul ambrosia util directli gcam calvingcam repres forecast food demand ambrosia ensur paramet use within gcam scientif empir sound also ensur reproduc paramet valid compli commit gcim fair guid principl scientif data manag wilkinsonfair code structur ensur paramet updat test effect chang underli data thu tool enabl easi use futur develop also enabl easi modular code within system section contain detail discuss differ function custom option avail within tool summari edmond et al framework edmondsglob model repres food demand model stapl nonstapl commod differ level price incom demand stapl describ increas incom lower eventu peak per person per capita begin declin higher incom rang approach demand nonstapl increas incom incom rang howev total stapl nonstapl demand satur high incom level edmondsglob approach use calibr paramet paramet fit use pool crosssectionaltimeseri observ bayesian markov chain mont carlo method mcmc hast framework repres demand three categori good stapl nonstapl n materi materi repres everyth economi stapl nonstapl food commod demand three categori chang chang incom price p respons price chang vari incom expenditur three good assum exhaust incom demand three categori repres mathemat stapl demand q_ a_sxh_sxw_se_ssxw_ne_snx nonstapl food demand q_n a_nxh_nxw_se_nsxw_ne_nnx materi demand q_m x w_sq_ w_nq_n w_i p_ip_m x yp_m a_i constant e_ij defin gener way e_ijxg_ijf_ixalpha_j g_ij constant j f_ix deltalnxh_ixdeltalnx h e constant h would incom elast x yp_m e_ij would cross price elast w_i p_ip_m follow function form chosen h_ h_n h_sx lambdaxkappalnx h_nx nux addit two scale paramet appli normal demand valu materi psscl stapl pnscl nonstapl paramet fit use weight least squar log likelihood function carrol describ lnl sigma_inw_iy_ihaty_isigma y_i ith data valu haty_i correspond model output w_i weight assign data point sinc paramet fit base region data region popul use weight appli paramet equat describ user gener estim demand stapl nonstapl commod thousand calori across differ incom level price main function custom ambrosia_vignettehttpsjgcrigithubioambrosiaarticlesambrosia_vignettehtml provid usabl exampl major function within code ambrosia packag easili load standard r packag instal github user calcul demand stapl nonstapl use fooddmnd function user pass dataset price stapl ps price nonstapl pn incom current incom proxi use ambrosia gdp per capita thousand usd addit dataset user must pass vector calibr paramet order function paramet code contain function call vecparam gener paramet structur use food demand function food demand function implement use equat describ user also calcul analyz price elast use function calcep elast calcul accord equat describ interact version food demand model launch user runapp function explor impact differ paramet one benefit use ambrosia user estim calibr paramet custom data set use loglikelihood maxim approach enabl ambrosia equip function createdatasetforparameterfit help user gener dataset appropri paramet estim user recreat train data use calcul paramet gcam use process_demand_datar script directori user complet paramet estim dataset return createdatasetforparameterfit call calculateambrosiaparam function function build edmondsglob approach maxim loglikelihood score use optim function note user also choos use differ method exampl mcmc maxim loglikelihood function first set function use mcsetup function code contain exampl mcmc implement c scriptscpp acknowledg research support us depart energi offic scienc part research multisector dynam earth environment system model program pacif northwest nation laboratori oper doe battel memori institut contract deacrl view opinion express paper author alon refer paper compil local use follow command pandoc papermd bibliographi paperbib paper_localpdf see httpspandocorginstallinghtml instal pandoc spacehold output vignett folder contain function use calcul train data use gener paramet valu gcam process_demand_datar use creat train dataset calcul current paramet gcam functionsr faostat_commod_matchingr contain variou helper function use clean fao data script use data process user intend recreat updat current paramet gcam exampl fit paramet use mcmc implement c code show use use rinsid run ambrosia c program one time use c markov chain mont carlo code model day weve switch rnativ mcmc packag someon realli want run model c easi rework exampl run new version use code user fit loglikelihood function ambrosia use run markov chain mont carlo paramet fit titl ambrosia user tutori author kanishka narayan date output rmarkdownhtml_vignett vignett vignetteindexentryambrosia user tutori vignetteengineknitrrmarkdown vignetteencodingutf r setup includefals knitropts_chunksetecho true introduct r load librari libraryambrosia librarydplyr libraryggplot libraryknitr part calcul food demand explor demand side variabl given set paramet section explain user set paramet structur ambrosia explor basic demand side variabl exampl calcul food demand demand thousand calori calcul differ level incom thousand usd per capita differ price stapl ps nonstapl pn per capita per day use paramet calcul exampl r get sampl data set test_data dataframeyseq add sampl valu ps pn test_data test_data mutatepspn calcul food demand food_demand fooddmndtest_datapstest_datapntest_datay exampl visual food demand demand along price incom elast calcul use fooddmnd function visual easili r add incom total demand data frame creat exampl creat plot food_demandtotal_demand food_demandqsfood_demandqn food_demandi seq creat plot g ggplot geom_linedatafood_demandaesx yy qscolor stapl demand geom_linedatafood_demandaesx yy qncolor non stapl demand xlabgdp per capita thousand usd ylabthousand calori plot plotg example_pngwidth height exampl visual budget share use function creat datafram estim demand level price incom also budget share share incom spent stapl nonstapl r renam budget share column budget_shar food_demand mutateshare_of_stapl alpha share_of_non_stapl alphan share_of_materi alpham add incom valu budget_sharesi seq creat plot gggplot geom_linedatabudget_sharesaesxyyshare_of_staplescolorstapl share geom_linedatabudget_sharesaesxyyshare_of_non_staplescolornon stapl share xlabgdp per capita thousand usd ylabperc incom plot plotg example_pngwidth height exampl calcul incom elast demand code iter solv budget share use broyden solver chang incom recalcul incom price elast chang budget sharesth user separ analyz incom elast use two function one stapl nonstapl within paramet structur temporari paramet structur gener exampl incom elast function gener within paramet structur store within object yfunc return elast given level incom set option paramet within function true would return incom term ie ela r note set second argument true function would return term yela oppos elast get paramet structur tmp_param vecparam incom elast stapl food_demandeta tmp_paramyfuncyfood_demandyfals incom elast nonstapl food_demandetan tmp_paramyfuncyfood_demandyfals creat data plot gggplot geom_linedatafood_demandaesxyyetascolorincom elast stapl geom_linedatafood_demandaesxyyetancolorincom elast nonstapl xlabgdp per capita thousand usd ylabelast valu plot plotg example_pngwidth height exampl calcul price elast similar incom elast user also calcul analyz price elast elast function calcep use recalcul price elast pass follow paramet differ budget share alpha incom elast calcul exampl matrix valu elast part paramet structur set exampl price elast calcul epsilion matrix price elast stapl nonstapl cross price elast r calcep return matrix elast matric elast staplesmatrix cross price elasticitiesmatrix non_stapl elasticitiesmatrix get stapl price incom elast food_demandstaple_price_elast calcepsfood_demandalpha food_demandalphan food_demandeta food_demandetan tmp_paramxi food_demandetan tmp_paramyfuncyfood_demandyfals get nonstapl price incom elast food_demandnon_staple_price_elast calcepsfood_demandalphasfood_demandalphanfood_demandetasfood_demandetantmp_paramxi food_demandetan tmp_paramyfuncyfood_demandyfals gggplot geom_linedatafood_demandaesxyystaple_price_elasticitycolorstapl price elast geom_linedatafood_demandaesxyynon_staple_price_elasticitycolornon stapl price elast xlabgdp per capita thousand usd ylabelast valu plot plotg example_pngwidth height part understand calibr paramet exampl get paramet mention document ambrosia gener estim food demand stapl nonstapl thousand calori given set price incom level addit price incom paramet ambrosia requir calibr paramet model paramet set use function vecparam order understand paramet unit rang calcul user call r vecparam use vecparam introduc new calibr paramet food demand function user would call r food_demand fooddmndtest_datapstest_datapntest_datay param vecparam user set paramet pass paramet vector directli vecparam set paramet individu user also directli call vecparam get default paramet structur default valu note current calibr paramet calcul basi nation level data food consumpt price effect calcul use new input thu allow user calibr model custom data r use sampl vector paramet original_param_vector c name paramet parameter_nam ca_ a_n xi_ss xi_cross xi_nn nu_n lambda_ k_ pm pssclpnscl creat datafram paramet parameter_data dataframeparameter_namesoriginal_param_vector return paramet structur tmp_param vecparamoriginal_param_vector return tabl paramet kableparameter_data colnam cparameter_namevalueformat pandoc section explain user calcul model paramet raw data way ambrosia calibr custom data set part run interact version model user also launch interact version ambrosia visual understand paramet use calcul output also test new paramet valu note use interact version requir shini librari instal user explor result chang main incom price paramet test impact new valu calibr paramet result exampl run interact version model note shinyi requir instal run app use function r runapp part recalcul calibr paramet basi new input data exampl get dataset paramet fit sampl train dataset one benefit use ambrosia user estim paramet custom data set use loglikelihood maxim approach enabl ambrosia equip function createdatasetforparameterfit help user gener dataset appropri paramet estim note user recreat train data use calcul paramet gcam use process_demand_datar script folder step function perform sampl dataset ensur user dataset contain column requir paramet estim filter anomali outlier use parameter cutoff valu select user step necessari sinc data food consumpt price often incomplet may lead unrealist high low valu consumpt price dataset function creat cluster observ dataset base incom level price stapl nonstapl step necessari econom data varianc requir likelihood function calcul within differ cluster code also check user specifi minimum number clustersif anomali within dataset cluster incorrect lead small number cluster cluster implement use divis analysi cluster algorithm diana cluster complet code calcul varianc varianc food demand stapl sigmaq_ nonstapl sigmaq_n note user chose lower limit varianc calcul default valu lower limit addit data frame function return csv file output call processed_data_for_mccsv store output folder use paramet estim exampl illustr use function raw dataset exampl illustr use function sampl dataset r load train data datatraining_data creat sampl dataset sample_data training_data filteryear c creat dataset paramet fit temp_data createdatasetforparameterfitdatasample_datamin_clust min_price_pd min_cal_fd outdirtempdir exampl analyz distribut varianc nonstapl dataset return function use paramet estim user also plot varianc stapl nonstapl ensur valid distribut data skew plot show varianc pregener data r load exampl processed_data dataprocessed_data_exampl creat plot use exampl load data gener exampl gggplot geom_histogramdataprocessed_data_exampleaesxsigqnbin xlabvari within cluster nonstapl ggtitledistribut varianc nonstapl select sampl dataset plot plotg example_pngwidth height exampl analyz distribut varianc stapl r load exampl processed_data dataprocessed_data_exampl creat plot use exampl load data gener exampl gggplot geom_histogramdataprocessed_data_exampleaesxsigqsbin xlabvari within cluster stapl ggtitledistribut varianc stapl select sampl dataset plot plotg example_pngwidth height exampl calcul actual paramet option optim final user complet paramet estim dataset return createdatasetforparameterfit call calculateambrosiaparam function ambrosia build edmond et al approach maxim loglikelihood score use optim function note user also choos use differ method exampl origin mcmc maxim loglikelihood function first set log likelihood function use mcsetup function follow step involv paramet estim function first loglikelihood function set data return function function calcul log likelihood score use weight least squar approach popul region weight valu return function maxim use optim user provid seed initi paramet begin optim process lowest possibl seed would lowest valu paramet default seed set origin paramet edmond et al user specifi optim method use default set bfg method user also run optim use method neldormead etc function return vector paramet use deriv estim food demand similar exampl function also print maxim valu loglikelihood function user verifi effici effect paramet estim warn calcul paramet take long time around minut depend upon machin max iter exampl set speed r load sampl data dataprocessed_data_exampl write temporari csv writecsvprocessed_data_exampleprocessed_data_for_mccsv calcul new paramet use save dataset new_paramet calculateambrosiaparamsdatadirprocessed_data_for_mccsv optim_method bfg original_param_vector c outdir tempdir max_iter exampl calcul actual paramet option set likelihood function use method calculateambrosiaparam use quickli calcul sampl paramet user also use approach calcul paramet sampl exampl user want creat sampl paramet use mcmc oppos optim approach ambrosia inbuilt function allow user set likelihood function maxim use method chosen user exampl show user set likelihood function r log likelihood function set use fit paramet either use maxim function approach like markov chain mont carlo load sampl data dataprocessed_data_exampl write temporari csv writecsvprocessed_data_exampleprocessed_data_for_mccsv set log likelihood function use save data note trace_param paramet use trace paramet valu fit process like mcmc calcul see part detail likelihood_funct mcsetupprocessed_data_for_mccsv trace_param fals exampl calcul log likelihood score base paramet vector calcul exampl log likelihood function calcul exampl r ifexistsnew_paramet printnew paramet calcul shown exampl load presav paramet new_paramet c calcul likelihood score use function calcul exampl likelihood_scor likelihood_functioncnew_paramet part explor data paramet fit process mcmc maxim process user calcul new paramet either use calculateambrosiaparam set log likelihood function use mcsetup maxim log likelihood use anoth method ambrosia also allow user explor result paramet fit exampl gener paramet data paramet data gener two way calculateambrosiaparam use calcul paramet valu user would set trace_param true gener data dat file warn calcul paramet take long time around minut depend upon machin max iter exampl set speed r new_paramet calculateambrosiaparamsdatadirprocessed_data_for_mccsv optim_method bfg original_param_vector c outdir tempdir trace_param true max_iter loglikelihood function set use mcsetup directli maxim use method trace_param paramet need set true fit process ensur dat file gener r likelihood_funct mcsetupprocessed_data_for_mccsv trace_param true use code user gener dat file track paramet sampl fit process along likelihood valu user read file assign paramet name gener densiti plot exampl read mcdata creat densiti plot r load exampl data datamc_data_exampl write temporari file exampl writetablemc_data_examplemc_data_exampledat read tabl nparam set sinc use mc_exampl readmcdatamc_data_exampledatvarnam namemcnparam creat densiti plot mcparamdensitymc_exampl example_pngwidth height exampl recreat maximum probabl densiti user also extract paramet yield highest log likehood score amongst sampl r load exampl data datamc_data_exampl write temporari file exampl writetablemc_data_examplemc_data_exampledat read tabl mc_exampl readmcdatamc_data_exampledatvarnam namemcnparam function return vector paramet yield highest log likelihood score ml_paramet mcparammlmc_exampl set loglikelihood function func_mc mcsetupprocessed_data_for_mccsv calcul probabl densityth valu probability_dens func_mccml_paramet gener roxygen edit hand pleas edit document rfooddemandplotsr namemakedemandplot aliasmakedemandplot titleplot stapl nonstapl total demand output model usag makedemandplotalldata xdata xlabel maxyv null argument itemalldatadata frame output return codelinkfooddmnd itemxdatavector valu xaxi itemxlabelcharact string use xaxi label itemmaxyvalmaximum valu display yaxi see detail valu plot food demand stapl nonstapl rel incom descript plot quantiti yaxi xaxi data pass separ vector input valu use model even principl variabl indirectli relat input valu gener roxygen edit hand pleas edit document rfooddemandr namelamksnuy aliaslamksnuy titleconvert lambda ks paramet nu usag lamksnuydf argument itemdfdata frame lambda ks paramet valu data frame convert valu descript stapl incom elast two formul paramet one use nu incom elast valu elast zero intuit incomplet theer valid model simpli express way model altern express term lambda ks paramet equat function allow easi convers latter represent former gener roxygen edit hand pleas edit document rfooddemandr nameprepareob aliasprepareob titleprepar observ use model usag prepareobsob argument itemobsdata frame observ data descript convert unit price renam column long wordi name make easier work gener roxygen edit hand pleas edit document rmcparanalysisr namereadmcdata aliasreadmcdata titleread mont carlo result file usag readmcdatafilenam varnam namemc argument itemfilenamenam file result store itemvarnamesnam variabl store file mc output format didnt column header omit default set name suppli valu tabl paramet name accord food demand model descript read mont carlo result file gener roxygen edit hand pleas edit document rfooddemandr namecalchicksactu aliascalchicksactu titlecalcul actual hick elast use slutski equat usag calchicksactualep alpha alphan alpham argument itemepselast valu calcul codelinkcalcelasactu itemalphasbudget fraction stapl itemalphanbudget fraction nonstapl itemalphambudget fraction materi valu datafram hick elast descript given actual price incom elast ie calcul use finit differ deriv comput correspond hick elast gener roxygen edit hand pleas edit document rfooddemandr namecomputebiascorrect aliascomputebiascorrect titlecomput region bia correct usag computebiascorrectionsparam obstrn argument itemparamsmodel paramet structur describ codelinkfooddmnd itemobstrndata frame train observ valu calcul bia correct valu descript comput region bia correct set paramet train set observ bia correct factor emphmultipli model data get bia correct model output gener roxygen edit hand pleas edit document rfooddemandmcr namemcsetup aliasmcsetup titlecr posterior logpdf function mont carlo sampl model paramet usag mcsetup obsdata_filenam logprior null logfil null chunksiz trace_param fals argument itemobsdata_filenamefil name oberv data itemlogprioropt function take paramet vector return log prior probabl densiti need support logposterior function option argument describ detail section itemlogfileopt file name log itemchunksizese detail descript chunk need itemtrace_paramset true gener data file dat file statist fit procedur valu function comput logposterior probabl densiti input vector paramet descript function return take vector paramet valu argument return log posterior pdf calcul compar data suppli observ data option second argument describ logpost function usabl mc sampler also work optim provid configur look maximum rather minimum detail observ data follow column ps pn qs qn sigq sigqn special provis process dataset produc gcam demand system employ nonlinear equat solver use solv budget fraction appear demand equat although structur system equat time actual independ other solver way know complex solver scale nonlinearli number equat break time dataset chunk modest size option second argument logposterior function produc function give number paramet set concaten singl vector capabl suppli make life easier back call function c code use sseavx instruct vector sampler sampler written r pretend argument doesnt exist sectiontodo item itemprovid exampl dataset observ data itemdispens chunk busi run solver loop think gener roxygen edit hand pleas edit document rfooddemandr doctypedata nametestdata aliastestdata aliasyv aliaspsv aliaspnv aliaspmv aliassampparam aliasx aliasx titlesampl valu demand model format object class codenumer length object class codenumer length object class codenumer length object class codenumer length object class codelist length object class codenumer length object class codenumer length usag yval psval pnval pmval sampparam x x descript variabl give exampl data structur use model well baselin price gdp paramet valu produc reason result yval logarithmicallyspac pcgdp valu psval evenli space ps valu pnval evenli space pn valu pmval evenli space pm valu sampparam exampl model paramet structur x mont carlo paramet vector vector encod model codesampparam use mont carlo version paramet formul stapl incom elast model x paramet use gener test data keyworddataset gener roxygen edit hand pleas edit document rmcparanalysisr namenamemc aliasnamemc titlereturn list name paramet model usag namemcnparam argument itemnparamnumb paramet legal valu either valu vector paramet name select version model descript support paramet version add tag end cover log likelihood column appen mont carlo code detail paramet version model canon version one publish paper gener roxygen edit hand pleas edit document rmcparanalysisr namemcparamdens aliasmcparamdens titlecr densiti plot mc variabl usag mcparamdensitymcdata argument itemmcdatadata frame mont carlo output valu densiti plot descript creat densiti plot mc variabl gener roxygen edit hand pleas edit document rfooddemandmcr namemcfooddmndbyyear aliasmcfooddmndbyyear titlecomput food demand year usag mcfooddmndbyyearobsdata x region null argument itemobsdatadata frame observ food demand itemxvector model paramet lambdak format itemregionsvector region includ comput null includ valu data frame result food demand year descript input paramet must mont carlo formul ie lambdak emphnot nuy format gener roxygen edit hand pleas edit document rfooddemandr namefooddmnd aliasfooddmnd titlecalcul food demand use edmond et al model usag fooddmndp pn param vecparam rgn null argument itempsvector stapl food price itempnvector nonstapl food price itemyvector per capita incom itemparamsmodel paramet structur see detail itemrgnopt name calcul provid region includ extra column output data frame descript edmond model divid food consumpt two categori emphstapl repres basic foodstuff emphnonstapl repres higherqu food demand stapl increas low incom eventu peak begin declin higher incom demand nonstapl increas incom incom rang howev total stapl nonstapl demand satur asymptot high incom sectionargu ps pn food price stapl food price nonstapl price intern dollar per dietari calori percapita gdp intern dollar ps pn may vector must length param structur describ itemxix array xi elast itemalead coeffici quantiti calcul itemyfunclength list function give yetay see note itempmpric materi loos speak paramet control valuabl food rel everyth els economi note dont need elast paramet materi compon calcul qm residu whatev portion household budget spent food definit spent materi sectionoutput return valu data frame follow element describ itemqsquant stapl food itemqnquant nonstapl food n itemqmquant materi quantiti repres aggreg everyth els besid food consum buy itemalphasbudget fraction itemalphanbudget fraction n itemalphambudget fraction demand stapl nonstapl food given thousand dietari calori per person per day unit materi demand unspecifi sectionincom elast function one function form use incom behavior etay eta blow yetay well behav therefor eta function need abl calcul etay yetay handl limit case gener roxygen edit hand pleas edit document rmcparanalysisr namemcparamitercount aliasmcparamitercount titleget iter count mont carlo dataset usag mcparamitercountnit nproc npset argument itemnitertot number iter mcpar loop itemnprocnumb processor alloc calcul itemnpsetnumb paramet set per processor valu iter count mcmc calcul descript necessari c mc code due limit way record output gener roxygen edit hand pleas edit document rfooddemandr namefooddmndbyyear aliasfooddmndbyyear titletabul food demand year model usag fooddmndbyyearobsdata param bc null region null argument itemobsdatat observ price incom itemparamsmodel paramet structur describ codelinkfooddmnd itembcvector region bia correct factor option omit bia correct appli itemregionregion appli analysi valu food demand year data frame descript tabul food demand year input model use observ price incom given region coderegion codenul region concaten result detail function intend gener model predict compar observ consumpt gener roxygen edit hand pleas edit document rfooddemandr namecalcelasactu aliascalcelasactu titlecalcul actual elast use numer deriv usag calcelasactualp pn param basedata null argument itempsstapl food price itempnnonstapl food price itemypercapita incom itemparamsmodel paramet see descript codelinkfooddmnd itembasedatamodel result base valu ps pn valu data frame elast descript given set price incom model parameterscalcul elast use numer deriv option pass model result base valu youv alreadi calcul detail input ps pn vector must length gener roxygen edit hand pleas edit document rmcparanalysisr namemcparamml aliasmcparamml titleget maximum aposteriori map paramet usag mcparammlmcdata argument itemmcdatadata frame mont carlo output valu vector paramet yield highest log likelihood descript map paramet produc largest posterior probabl densiti gener roxygen edit hand pleas edit document rcalculate_parametersr namecalculateambrosiaparam aliascalculateambrosiaparam titlecalcul paramet ambrosia use data calcul codelinkcreatedatasetforparameterfit maxim log likelihood usag calculateambrosiaparam optim_method bfg original_param_vector c datadir outputsprocessed_data_for_mccsv outdir teststestthattest_output max_iter print_progress fals trace_param fals argument itemoptim_methodth optim method use maxim log likelihood default set bfg itemoriginal_param_vectororigin paramet vector use start point optimizationthes paramet taken edmond et al itemdatadirdirectori data calcul codelinkcreatedatasetforparameterfit itemoutdirdirectori store output csv default set test_output folder itemmax_iterationsa maximum number iter pass optim larg meant test purposesdefault set bfg itemprint_progressa paramet allow user track progress function itemtrace_paramset true gener dat file paramet sampl log likelihhod valu paramet fit exercis eg mcmc valu vector paramet follow a_ scale term stapl commod a_n scale perm nonstapl commod xi_ss price elast stapl xi_cross cross price elast xi_nn price elast nonstapl nu_n incom elast nonstapl lambda_ incom elast stapl k_ incom level total demand begin satur pm scale paramet price materi everyth stapl nonstapl psscl price scale paramet stapl appli price stapl ps alpha stapl pnscl price scale paramet stapl appli price nonstapl pn alpha nonstapl descript calcul paramet ambrosia use data calcul codelinkcreatedatasetforparameterfit maxim log likelihood detail follow step involv paramet estim function first loglikelihood function set data next valu return loglikelihood function maxim use optim user provid seed initi paramet begin optim process lowest possibl seed would lowest valu paramet default seed set origin paramet edmond et al user specifi optim method use default set bfg method user also run optim use method neldormead final function return vector paramet use deriv estim food demand use codelinkfooddmnd function function also print maxim valu loglikelihood function user verifi effici effect paramet estim author kbn gener roxygen edit hand pleas edit document rfooddemandmcr doctypedata nameplohi aliasplohi titlerecommend paramet limit model format object class codematrix inherit codearray row column usag plohi descript model paramet outsid rang like produc model numer illbehav first row matrix recommend minimum valu second recommend maximum valu detail function talk paramet paramet version model paramet version use earli test deprec therefor recommend appli paramet version keyworddataset gener roxygen edit hand pleas edit document ruifcnsr nameguiwidget aliasguiwidget aliasximatrixinput aliasyinputbox aliascolumninputt aliasetaselector titleinput widget food demand gui app usag ximatrixinput yinputbox columninputt inputid defval min max step label cstapl a_ nonstapl a_n etaselectorid label etafi sel argument iteminputidscharact vector paramet identifi itemdefvalsvector default valu itemminminimum valu itemmaxmaximum valu itemstepslid step size itemlabelscharact vector label descript input widget food demand gui app sectionfunct item item codeximatrixinput input box xi matrix item codeyinputbox input box item codecolumninputt draw input grid input item codeetaselector draw selector widget eta keywordintern gener roxygen edit hand pleas edit document rfooddemandplotsr namemcmakebyyearplot aliasmcmakebyyearplot titlemak byyear plot set mont carlo result sampl distribut usag mcmakebyyearplot mcdata obsdata biascorrect null region null nsamp pltrgn null argument itemmcdatamont carlo result data itemobsdatadata frame observ food demand data itembiascorrectionregion bia correct factor default none itemregionvector region plot default itemnsampnumb sampl draw mont carlo distribut itempltrgnregion includ plot codenul includ valu byyear plot set mont carlo result sampl distribut descript make byyear plot set mont carlo result sampl distribut gener roxygen edit hand pleas edit document rfooddemandr namecalcq aliascalcq titlecalcul demand quantiti singl set input usag calcqp pn ep ysterm ynterm acoef psscl pnscl argument itempspric stapl food itempnpric nonstapl food itemypercapita incom itemepsmatrix marshal elast itemystermincom term demand equat stapl itemyntermincom term demand equat nonstapl itemacoeflead multipli paramet itempssclpric scale paramet stapl food product itempnsclpric scale paramet nonstapl food product valu quantiti stapl nonstapl qs qn descript helper function codemappli call codelinkfooddmnd gener roxygen edit hand pleas edit document rfooddemandplotsr namemakebyyearplot aliasmakebyyearplot titleplot model result year usag makebyyearplotbyyeardata pltrgn null argument itembyyeardataoutput codelinkfooddmndbyyear itempltrgnregion plot valu plot model result year descript plot model result year gener roxygen edit hand pleas edit document rfooddemandplotsr namemakebyincomeplot aliasmakebyincomeplot titleplot model result percapita incom usag makebyincomeplotobsdata param region null argument itemobsdatadata frame observ food demand data itemparamsmodel paramet structur itemregionregion includ plot valu plot model result incom level descript plot model result percapita incom gener roxygen edit hand pleas edit document rfooddemandr nameetaconst aliasetaconst aliaseta aliasetan titlegener incom elast function constant incom elast usag etaconstanteta etasnu mcmode fals etannu argument itemetavalu constant elast itemnuincom elast itemyvalu elast gener peak curv itemmcmodeif true treat first two paramet nu direct specif k lambda flag necessari becau nu intuit work complet specif paramet space valid model specifi term k lambda valu function suitabl use either codeeta codeetan food demand model descript function gener function use incom elast function stapl nonstapl food stapl nonstapl food function form given codeeta codeetan also constant elast function use test though formal part model design detail incom elast function follow signatur item itemcodefunctioni calcq percapita gdp calcq flag indic whether function calcluat incom quantiti term incom elast sectionfunct item item codeeta gener incom elast function stapl food item codeetan gener incom elast function nonstapl food gener roxygen edit hand pleas edit document rutilr namerunapp aliasrunapp titlelaunch interact gcam food demand model usag runapp descript interact model allow user adjust model paramet see affect model output run interact model must r shini packag instal gener roxygen edit hand pleas edit document rfooddemandmcr namevecparam aliasvecparam titleconvert vector paramet param structur usag vecparam x null a_ a_n xi_ss xi_cross xi_nn nu_n lambda_ k_ pm psscl pnscl argument itemxvector model paramet use statist formul null vector gener base default paramet valu paramet itema_sa scale term use deriv expenditur share stapl demand itema_na scale term use deriv expenditur share nonstapl demand itemxi_sspric elast stapl good unit chang per capita demand stapl result unit increas price per person per day itemxi_crosscross price elast stapl nonstapl combin price elast use deriv substitut elast itemxi_nnpric elast nonstapl good unit chang per capita demand nonstapl result unit increas price per person per day itemnu_nincom elast nonstapl good unit chang per capita demand nonstapl unit chang incom thousand usd itemlambda_sincom elast stapl good unit chang per capita demand stapl unit chang incom thousand usd itemk_sexpon incom level stapl demand anticip highest log term logk_ incom level thousand usdk_ lamda_ use conjunct deriv incom elast stapl itempmpric materi per capita per day basic price consum pay good economi other food rang base statist formul itempsscladdit scale term use deriv expenditur share stapl appli price stapl pspm psscl ps price stapl pm price materi expenditur share stapl alpha_ itempnscladdit scale term use deriv expenditur share nonstapl appli price nonstapl pnpm pnscl pn price nonstapl pm price materi expenditur share nonstapl alpha_n valu paramet structur suitabl use codelinkfooddmnd descript function allow user pass vector paramet ambrosia user set individu paramet valu describ pass direct vector paramet also look number paramet pass assum want constant incom elast stapl eta constant assum want use dynam incom elast stapl eta etaslambda k anyth els throw error tabl detail section provid descript paramet unit accept rang detail document provid explan paramet along accept rang paramet default paramet paramet valu yield maximum log likelihood valu du statist fit procedur rang paramet deriv filter rang paramet mcmc th percentil confid interv paramet independ note xi_cross use xi_sn xi_n forc equal paramet first next last eta_ paramet vector describ tabl belowtabularllll paramet name tab descript tab unit tab valu tab rang paramet valu base th percentil confid interv cr codea_ tab scale term use deriv expenditur share stapl demand tab unitless tab tab cr codea_n tab scale term use deriv expenditur share nonstapl demand tab unitless tab tab cr codexi_ss tab price elast stapl good unit chang per capita demand stapl result unit increas price codep per person per day tab elast tab tab cr codexi_cross tab cross price elast stapl nonstapl combin price elast use deriv substitut elast tab elast tab tab cr codexi_nn tab price elast nonstapl good unit chang per capita demand nonstapl result unit increas price codepn per person per day tab elast tab tab cr codenu_n tab incom elast nonstapl good unit chang per capita demand nonstapl unit chang incom codey thousand usd tab elast tab tab cr codelambda_ tab incom elast stapl good unit chang per capita demand stapl unit chang incom codey thousand usd tab elast tab tab cr codek_ tab expon incom level stapl demand anticip highest tab thousand usd tab tab cr codepm tab price materi everyth els economi food product tab per day tab tab cr codepsscl tab addit scale term use deriv expenditur share stapl appli price stapl codepscodepm codepsscl ps price stapl pm price materi expenditur share stapl codealpha_ tab unitless tab tab cr codepnscl tab addit scale term use deriv expenditur share nonstapl appli price nonstapl codepncodepm codepnscl pn price nonstapl pm price materi expenditur share nonstapl codealpha_n tab unitless tab tab cr gener roxygen edit hand pleas edit document rfooddemandr namecalcep aliascalcep titlecalcul expon demand equat usag calcepsalpha alphan eta etan xi argument itemalphasbudget fraction stapl food itemalphanbudget fraction nonstapl food itemetasincom elast stapl food itemetanincom elast nonstapl food itemximatrix hick elast valu matrix price elast xixi stapl nonstapl price elast rest cross elast descript approxim slutski equat inasmuch use expon directli instead solv expon produc valu elast gener roxygen edit hand pleas edit document ruifcnsr doctypedata nameguiconst aliasguiconst aliasxidefault aliaselasmin aliaselasmax aliaselasstep aliasetastep aliasspac titleconst use gui format object class codenumer length object class codenumer length object class codenumer length object class codenumer length object class codenumer length object class codehtml inherit codecharact length usag xidefault elasmin elasmax elasstep etastep spacer descript constant use gui xidefault default xi valu elasmin minimum elast slider bar elasmax maximum elast slider bar elasstep elast bar step size etastep eta slider bar step size spacer spacer label keyworddataset keywordintern gener roxygen edit hand pleas edit document rutilr namecalcpopweight aliascalcpopweight titlecalcul weight factor base popul usag calcpopweightinputdata argument iteminputdatadata frame food demand input data fao valu data frame input data popul weight column ad descript weight factor use give high popul region influenc model fit rel low popul region gener roxygen edit hand pleas edit document rfooddemandr namefooddmndbyincom aliasfooddmndbyincom titletabul food demand percapitaincom usag fooddmndbyincomeobsdata param region null argument itemobsdatadata frame observ price incom itemparamsmodel paramet structur see note codelinkfooddmnd itemregionnam singl region tabul codenul tabul region concaten tabl valu food demand per capita incom return data frame descript tabul stapl nonstapl demand function percapita gdp function use observ price comparison gener roxygen edit hand pleas edit document rcalculate_parametersr namecreatedatasetforparameterfit aliascreatedatasetforparameterfit titlecr dataset observ error log likelihood calcul use cluster usag createdatasetforparameterfit min_price_pd min_cal_fd min_clust lower_limit_sigma data null outdir teststestthattest_output print_progress fals argument itemmin_price_pdminimum price paid nonstapl itemmin_cal_fdminimum calori food demand model itemmin_clustersminimum number cluster gener cluster algoritm recommend lowewr paramet itemlower_limit_sigmalow limit sigma valu calcul itemdataa datafram datat raw data data contain follow name s_cal_pcap_day_th contain calori per capita per day stapl ns_cal_pcap_day_th contain calori per capita per day nonstapl gdp_pcap_thou contain gdp per capita s_usd_pcal price calori stapl per person per day ns_usd_pcal price calori nonstapl per person per day itemoutdirdirectori store output csv default set test_output folder itemprint_progressa paramet allow user track progress function valu datafram call processed_data_for_mc follow column sigqn observ error nonstapl sigq observ error stapl descript step function perform sampl dataset see detail detail step perform function ensur user dataset contain column requir paramet estim filter anomali outlier use parameter cutoff valu select user step necessari sinc data food consumpt price often incomplet may lead unrealist high low valu consumpt price dataset function creat cluster observ dataset base incom level price stapl nonstapl step necessari econom data observ error calcul within differ cluster code also check user specifi minimum number cluster anomali within dataset cluster incorrect lead small number cluster cluster implement use divis analysi cluster algorithm diana cluster complet code calcul observ error varianc food demand stapl nonstapl note user chose lower limit observ error calcul default valu lower limit author kbn gener roxygen edit hand pleas edit document rutilr nameassignsigmaq aliasassignsigmaq titleassign observ error observ demand quantiti usag assignsigmaqinputdata mingroup argument iteminputdatadata frame observ input itemmingroupminimum group size cluster valu datafram updat calcul observ error sigq sigqn column descript assign sigma observ error valu qs qn input data set cluster input ps pn take varianc qs qn cluster detail observ error estim cluster observ data demand model input valu ie price stapl nonstapl food calcul varianc observ cluster order work ensur enough observ cluster produc varianc least somewhat reliabl tradeoff larger make cluster better varianc estim less alik observ cluster actual mean varianc observ error actual differ demand tradeoff control codemingroup argument gener roxygen edit hand pleas edit document rutilr namerecursivepartit aliasrecursivepartit titlepartit input data cluster minimum number member usag recursivepartitioninputdata clustervar minmemb argument iteminputdatadata frame data cluster itemclustervarsvector name variabl use cluster itemminmembersdesir minimum number member per cluster valu list data frame one data frame cluster descript partit input data cluster given minimum number member per cluster turn kind hard structur produc cluster algorithm isnt conduc find cluster toosmal cluster split instead find dendrogram cut produc cluster larger minimum recurs partit cluster larg enough could split two detail purpos function allow us estim observ error histor food demand observ cluster observ similar input valu price gdp get someth approxim repeat measur similar situat set minimum number member per cluster allow us enough measur per group get resason estim varianc function return list data frame list item singl cluster irretriev scrambl order row recov origin order import includ id column gener roxygen edit hand pleas edit document rfooddemandr nameapplybiascorrect aliasapplybiascorrect titleappli bia correct model output usag applybiascorrectionsmod bc argument itemmoddata frame model output itembcvector region bia correct factor valu data frame bia correct valu descript appli bia correct model output gener roxygen edit hand pleas edit document rmcparanalysisr namemcparamcliptail aliasmcparamcliptail titlefilt mont carlo distribut quantil usag mcparamcliptailsmcdata qlo qhi argument itemmcdatadata frame mont carlo output itemqlolow quantil filter itemqhiupp quantil filter valu logic vector codetru row main bodi distribut codefals arent descript filter paramet simultan sampl outsid request quantil rang margin distribut paramet exclud detail logposterior column handl bit differ isnt filter high end low end purpos function trim valu far tail made plot scale imposs read gener roxygen edit hand pleas edit document rfooddemandr namemergetrntst aliasmergetrntst titlecr merg dataset train test data label accordingli usag methodmergetrntstobstrn obstst argument itemobstrndata frame observ train set itemobststdata frame observ test set valu merg datafram descript creat merg dataset train test data label accordingli gener roxygen edit hand pleas edit document rmcparanalysisr namemcparamsampl aliasmcparamsampl titlesampl mc result use bootstrap sampl usag mcparamsamplemcdata nsamp func null argument itemmcdatadata frame mont carlo output itemnsampnumb sampl draw itemfuncopt function appli sampl drawn mc distribut valu data frame list see detail descript option appli function sampl valu detail codefunc codenul return valu data frame sampl paramet valu otherwis return valu list data frame describ first element output codefunc second