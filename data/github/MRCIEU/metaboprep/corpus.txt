metabolit data prepar pipelin version david hugh laura corbin date june rd img srcinstfiguresmetabopreppng althex width packag read process untarget metabolit data save dataset tabdelimit format use elsewher provid use summari data form tabdelimit text file html report perform data filter data set use standard pipelin accord userdefin threshold instal metaboprep instal follow quick instal start r session instal metaboprep packag r devtoolsinstall_githubmrcieumetaboprep repo download copi follow file run_metaboprep_pipelin parameter_filetxt also download clone entir repo r git clone httpsgithubcommrcieumetaboprepgit altern download packag manual download copi depositori unzippack download place directori somewher sensibl start r session set work directori parent directori repo instal r packag r devtoolsinstallmetaboprep common instal error produc instal error depend packag experi instal depend packag manual biocmanag attempt instal metaboprep might repeat step r requirenamespacebiocmanag quietli true installpackagesbiocmanag biocmanagerinstallmissingpackagenam run metaboprep edit paramat parameter_filetxt file add space sign paramat file paramat file locat anywher move directori contain copi run_metaboprep_pipelin make sure r environ often necessari step work hpc exampl modul add languagesratlasgcc run metaboprep pipelin termin command line follow r rscript run_metaboprep_pipelin fullpathtoexample_dataexcelparameter_filetxt experienc issu geneart html report hpc report gener local machin follow move newli gener metaboprep project directori take form metaboprep_release_todaysd find r data object call reportdatardata save copi local open r session produc report function metaboprepgenerate_report r output_dir_path pastefullpathtodirofchoic rdfile pasteoutput_dir_path reportdatardata generate_report full_path__rdatafil rdfile dir__report output_dir_path exampl data exampl data set found folder example_data repositori simul data set metabolit sampl metabolon like v format excel file data set flat text tab delim version data set accompani paramet file help guid exampl exampl data includ data two hypothet mass spectrometri run mode platform neg po subset metabolit run simul neg run mode two batch second subset metabolit run simul po run mode three batch batch simul differ mean abund valu help illustr possibl batch effect normal procedur look flat text version exampl inform metabolit simul run mode platform found flat text file feature_datatxt column platform identifi sampl belong batch run mode would use column neg po flat text file sample_datatxt data prepar step brief imagesmetaboprep_workflowpng see wiki page detail synopsi pipelin herehttpsgithubcommrcieumetaboprepwikidetailedmetabopreppipelinestep gener outlin metaboprep read paramat file read data typic commerci provid excel file metabolit abund sampl annot featur annot write metabolit data sampl annot featur annot flat text file normal data data metabolon technolog runmod platform batch median normal data estim summari statist raw data set step b write summari stat file perfom data filter step c use paramet pass paramet file write data filter metaboprep data set file estim sumari statist filter data set step b write summari stat file gener html report print scatter plot histogram summari stat everi metabolit singl pdf b summari statist estim sampl summari statist sampl missing featur exclus xenobiot andor deriv variabl sampl total sum abund tsa deriv variabl exclud featur complet featur missing count mani time sampl outlier across featur featur analyz within sampl distribut outlier determin iqr median featur summari statist featur missing sampl exclus sampl extrem missing distribut statist shaprio wstatist normal raw distribut shaprio wstatist normal log distribut skew kutosi n sampl size varianc standard deviat coeffici variat mean median min max featur outli sampl count count outli sampl outlier determin iqr median featur sampl structur featurefeatur correl structur deriv variabl exclud includ featur least measur data set n missing allow n estim number independ featur tag representit featur featur cluster samplesampl correalt structur deriv variabl exclud principl compon pca deriv independ featur miss data imput median estiamt featur identifi pc outlier sd mean signific pc c data filter step data metabolon exclud retain step xenobiot metabolit anlaysi estim sampl missing exclud extrem sampl missing deriv variabl exclud estim featur missing exclud extrem featur missing reestim sampl missing exclud sampl user defin threshold unit miss deriv variabl exclud reestim featur missing exclud featur user defin threshold unit miss estim total sum abundancearea sum valu individu first ztransform distribut second shift mean distribut absolut minimum observ valu tsa sampl exclus use user defin threshold unit sd mean deriv variabl exclud ignor step set na paramet file identifi outlier valu featur use user defin threshold unit iqr median user defin outlier purpos deriv pc leave_b mean outlier valu left turn_na mean median imput pca winsor th quantil remain nonoutli valu build featurefeatur correl matrix filter data deriv step deriv variabl exclud includ featur must minimun observ n observ data set includ less individu identifi independ featur use data step user defin tree cut height retain featur least missing within cluster otherwis select first featur list estim princip compon use independ featur step pc outlier sampl exclus use user defin threshold unit sd mean data metabolon place xenobiot metabolit back filter data set note deriv variabl ratio percentang two featur alreadi present data set found nightingal data html report includ exampl figur provid illustr gener inform studi raw data summari sampl size missing imagesmissingness_matrixpng imagesmissingness_histpng tabl data filter exclus figur pca oulier exclus imagesoutlier_pcapng summari data filter data sampl size summari figur missing distribut featur dendrogram pca imagessummary_of_qc_datapng distribt shapiro wstatist imageswstatspng outlier summari batch effect featur missing influenc featur super_pathway categor function ms method lcm polar po late po earli neg imagesf_missingness_by_batchpng sampl missing influenc box_id storag box run_day day sampl process tech imagesmissingness_by_batchpng multivari analysi box_id run_day missing sampl total peakabund area influenc box_id storag box run_day day sampl process tech imagestsa_by_batchpng multivari analysi box_id run_day missing power analysi presenc vs absenc continu imagespower_vpng metaboprep data prepar summari report date r formatsystim b metaboprep report relat project r project platform r platform metaboprep r packag perform three oper provid assess summari statist raw metabolom data perform data filter metabolom data provid assess summari statist filter metabolom data particularli context batch variabl avail report provid descript inform raw filter metabolom data project r project r init echo fals knitropts_chunksetecho fals quotef commentna warningfals messagefals errorfals figaligncent test necessari packag requirenamespacemetaboprep quietli true stoppackag metaboprep need function work pleas instal call fals requirenamespacedendextend quietli true stoppackag dendextend need function work pleas instal call fals requirenamespacetidyvers quietli true stoppackag tidyvers need function work pleas instal call fals suppresspackagestartupmessageslibrarymetaboprep suppresspackagestartupmessageslibrarytidyvers suppresspackagestartupmessageslibrarydendextend r define_data raw data raw_datametabolite_data tibbleas_tibbleraw_datametabolite_data raw_datasample_data tibbleas_tibbleraw_datasample_data colnamesraw_datasample_data samid raw_datafeature_data tibbleas_tibbleraw_datafeature_data colnamesraw_datafeature_data featureid raw_datavarexp raw_datavarexp qc data qc_datametabolite_data tibbleas_tibbleqc_datametabolite_data qc_datasample_data tibbleas_tibbleqc_datasample_data colnamesqc_datasample_data samid qc_datafeature_data tibbleas_tibbleqc_datafeature_data colnamesqc_datafeature_data featureid qc_datavarexp qc_datavarexp data prepar workflow follow r png_fig outwidth px f systemfilermarkdown packagemetaboprep pic filepath f skeletonmetaboprep_workflowpng knitrinclude_graphicsp issu rais githubhttpsgithubcommrcieumetaboprepissu question relat metaboprep pipelin direct david hugh dahughesbristolacukmailtodahughesbristolacuk metaboprep publish journal determin cite summari raw data sampl size r project data set r sample_s figwidth figheight tout dataframedataset cnumber samplesnumb featur rawdata dimraw_datametabolite_data filtereddata dimqc_datametabolite_data ggpubrggtexttabletout row null theme ggpubrtthememblu missing missing evalu across sampl featur use originalraw data set visual structur missing raw data set r missingnessmatrix figwidth figheight echo falsewarningfals messagefals errorfals dev png namat qc_datametabolite_data namatisnanamat namatisnanamat namat asmatrixnamat namat reshapemeltnamat colnamesnamat cindividualsmetabolitesmissing pcol rcolorbrewerbrewerpaln name dark ggplotnamat aesmetabolit individu fill missing geom_til scale_fill_gradientlow white highpcol themelegendposit none axistextx element_blank figur legend missing structur across raw data tabl white cell depict miss data individu row metabolit column summari sampl featur missing r runmissing echo fals figwidth figheight warningfals messagefals errorfals r_mi missingnesssummydata raw_datametabolite_data p ggpubrggarrang r_mi r_mi r_mi r_mi ncol nrow label ca b c ggpubrannotate_figureptop past initi raw data set estim missing sampl featur n figur legend raw data distribut sampl missing sampl mean illustr red vertic line b distribut featur missing sampl mean illustr red vertic line c tabl sampl featur missing percentil tabl version plot b estim studi sampl size variou level featur missing data filter exclus summari r exclusion_t echo fals figwidth figheight warningfals messagefals errorfals temp dataframeexclus rownamesqcing_dataexclusion_data count qcing_dataexclusion_data ggpubrggtextt temp row null theme ggpubrtthememblu tabl legend six primari data filter exclus step made prepar data sampl missing exclud featur missing exclud xenobiot includ step sampl exclus base user defin threshold exclud featur exclus base user defin threshold exclud xenobiot includ step sampl totalpeakarea totalsumabund n standard deviat mean n defin user exclud sampl n standard deviat mean princip compon axi n defin user exclud metabolit featur reduct princip compon data reduct carri identifi list repres featur gener sampl princip compon analysi step reduc level intercorrel data ensur princip compon driven group correl featur r pca__ echo fals figwidth figheight warningfals messagefals errorfals data reduct info feature_count lengthqcing_datafeature_sumstatsk features_included_in_data_reduct length naomitqcing_datafeature_sumstatsk cluster_count length uniqueqcing_datafeature_sumstatsk number_of_rep_meatbolit sum qcing_datafeature_sumstatsindependent_features_binari temp datafram datareduct ctotal metabolit count metabolit includ data reduct number metabolit cluster number repres metabolit count cfeature_count features_included_in_data_reduct cluster_count number_of_rep_meatbolit ptabl ggpubrggtextt temp row null theme ggpubrtthememblu pca defin tibbl pc as_tibbleqcing_datapc defin color scheme pcol rcolorbrewerbrewerp set defin accelerationfactor accelerationfactor qcing_dataaccelerationfactor ifaccelerationfactor accelerationfactor ifaccelerationfactor accelerationfactor defin outlier omat outliermatrix pc accelerationfactor nsd pc_outlier_sd meansd true outlier applyomat sum outliersoutli pcsoutlier asfactor outlier cutoff applypc accelerationfactor functionx msd cmeanx narm true sdx narm true cutoff msd msdpc_outlier_sd returncutoff pcplot pc ggplot aesx pc pc geom_point aesfil outlier size shape scale_fill_manualvalu pcolc geom_vlinexintercept ccutoff cutoff color pcol geom_hlineyintercept ccutoff cutoff color pcol themelegendpositionbottom labstitl pasteprincip compon use number_of_rep_meatbolit repres metabolit subtitl past outlier pc_outlier_sd sd mean pc accelerationfactor gridextragridarrang grob listptabl pcplot width c ncol figur legend data reduct tabl left present number metabolit phase data reduct spearman correl distanc tree cut analysi right princip compon plot individu use representitv featur identifi data reduct analysi red vertic horizont line indic standard deviat sd cutoff identifi individu outlier plot red standard deviat cuttoff defin user summari filter data sampl size n number sampl data r nrowqc_datametabolite_data number featur data r ncolqc_datametabolite_data rel raw data r nrowraw_datametabolite_data nrowqc_datametabolite_data sampl filter given user criteria r ncolraw_datametabolite_data ncolqc_datametabolite_data featur filter given user criteria pleas review detail log file number featur sampl exclud r sample_overview echo fals figwidth figheight warningfals messagefals errorfals pcol rcolorbrewerbrewerp set missing qc_mi missingnesssummydata qc_datametabolite_data s_mis_plot qc_mi f_mis_plot qc_mi tpa tibbletibbletpa_completefeatur qc_datasample_datatpa_completefeatur tpa_plot qc_datasample_data ggplot ae tpa_completefeatur geom_histogram fill pcol bin geom_vlin xintercept medianqc_datasample_datatpa_completefeatur color pcol size labstitl pastetot abund samplesnat complet featur x theme_bw themeplottitl element_texthjust dendrogram dend qc_datafeature_tre asdendrogram creat vector color color tree label w qc_datafeature_dataindependent_features_binari pv_id ascharact unlist qc_datafeature_dataw n labelsdend bcol repblack lengthn w whichn pv_id bcolw pcol redefin element dendrogram dend dend setlabels_cex setlabels_col bcol setbranches_lwd setbranches_k_color valu bcol dend asggdenddend plot dendrogram tree_plot dend ggplot geom_hlineyintercept tree_cut_height color coral data reduc tabl feature_count lengthqc_datafeature_datak features_included_in_data_reduct length naomitqc_datafeature_datak cluster_count length uniqueqc_datafeature_datak number_of_rep_meatbolit sum qc_datafeature_dataindependent_features_binari temp datafram datareduct ctotal metabolit countmetabolit includ data reductionnumb metabolit clustersnumb repres metabolit count cfeature_countfeatures_included_in_data_reduct cluster_count number_of_rep_meatbolit ptabl ggpubrggtextt temp row null theme ggpubrtthememgreen scree plot plotqc_datavarexp pch bg pcol cex type b xlab pc number ylab varianc explain eigenvalu tibbletibbl dataframepc lengthqc_datavarexp varexp qc_datavarexp screeplot ggplotaesx pc varexp geom_linecolor grey geom_pointshap fill pcol size labstitl scree plot geom_vlinexintercept qc_dataaccelerationfactor color pcol geom_vlinexintercept unlist qc_datanparallel color pcol pc plot pc as_tibbleqc_datasample_data cpcpcpcpcpcpcpcpcpcpc pcscluster_k asfactor kmeanspc cluster defin color scheme pcol rcolorbrewerbrewerp set pcplot pc ggplot aesx pc pc geom_point size shape aesfil cluster_k scale_fill_manualvalu pcol lab titl pasteprincip compon use number_of_rep_meatbolit repres metabolit x pastepc varexp signifqc_datavarexp pastepc varexp signifqc_datavarexp fill pastekmeansnclust k plot data matrixc nrow byrow true gridextragridarrang grob lists_mis_plot f_mis_plot tpa_plot tree_plot ptabl screeplot pcplot layout_matrix height c figur legend filter data summari distribut sampl missing featur missing total abund sampl row two figur provid spearman correl distanc cluster dendrogram highlight metabolit use repres featur blue cluster tree cut height denot horizont line row three provid summari metabolit data reduct tabl scree plot varianc explain pc plot princip compon deriv repres metabolit scree plot also identifi number pc estim inform vertic line cattel scree test acceler factor red n r qc_dataaccelerationfactor parallel analysi green n r unlist qc_datanparallel individu pc plot cluster kmean k cluster use data pc pc kmean cluster color code strictli help provid visual major axe variat sampl popul structur among sampl r pcapairsplot echo fals figwidth figheight warningfals messagefals errorfals plotcolor pcolpcscluster_k pcapairs_bymoos asmatrixpc qc_datavarexp pcol plotcolor figur legend matrix pair plot top five princip compon includ demarc rd grey th orang th red standard deviat mean sampl color code summari pc plot use kmean analysi pc pc k number cluster set choic k robustli chosen choic simplic help aid visual variat sampl mobil across pc featur distribut estim normal wstatist raw log transform data r echof warningfals messagefals errorfals wstat qc_datafeature_dataw mani stat estim count lengthwstat nacount sumisnawstat remain_count count nacount normcount sumwstat narm true r shapirow echo fals figwidth figheight warningfals messagefals errorfals w wstat pcol rcolorbrewerbrewerp set w_log qc_datafeature_datalog_w plot parmfrow c oma c histw col pcol main pastedistribut w statist onnraw metabolit abund xlab w ylab frequenc cexmain ablinev col pcol mtext pastenormcount metabolit exhibit distributionsnthat may declar normal given wstat cex side outer true line adj col pcol log logmakesdistributionwors c sum w_log w narm true signif sum w_log w narm truelengthisnaw histw_log col pcol main pastedistribut w statist onnlog metabolit abund xlab w ylab frequenc cexmain mtext pastein logmakesdistributionwors instanc logmakesdistributionwors test metabolitesnth log data wstat raw data wstat cex side outer true line adj col pcol figur legend histogram plot shapiro wstatist raw left log transform right data distribut wstatist valu indic sampl distribut perfectli normal valu indic perfectli uniform pleas note log transform data may improv normal data analysi detail r count featur data r nacount featur exclud analysi variat observ n remain r remain_count metabolit featur total r normcount may consid normal distribut given shapiro wstatist outlier evalu number sampl featur outlier across data r outlier_summari echo fals figwidth figheight warningfals messagefals errorfals omat outliermatrixqc_datametabolite_data total_out_count sumomat sout applyomat functionx sumx narm true fout applyomat functionx sumx narm true sam_out_quantil c quantilesout prob c narm true signif meansout narm true digit quantilesout prob c narm true feat_out_quantil c quantilefout prob c narm true signif meanfout narm true digit quantilefout prob c narm true outval dataframequantil cminimum th median mean thmax sampl sam_out_quantil featur feat_out_quantil ggpubrggtextt outval row null theme ggpubrtthememblu tabl legend tabl report averag number outlier valu sampl featur data set minimum max quantil sampl featur distribut report well note outli sampl metabolitefeatur may extrem outli observ individu metabolitesfeatur account may want turn observ na winsor data maximum valu rank normal data place outlier top rank standard normal distribut turn observ na imput along miss data data set variat filter data avail variabl featur missing featur missing may influenc metabolit featur biolog pathway classif technolog methodolog figur provid illustr evalu proport featur missig product variabl avail raw data file r id_feat_batch_var variabl could use evalu featur effect possible_var colnamesqc_datafeature_data remov summari stat pool possibl w whichpossible_var feature_missing iflengthw possible_var possible_var cwlengthpossible_var number uniqu unit possibl variabl count_uniqu applyqc_datafeature_datapossible_var functionx length uniqu naomitx remov one class count sampl size r whichcount_uniqu count_uniqu nrowqc_datafeature_data count_uniqu iflengthr possible_var possible_varsr count_uniqu count_uniqu continu filter lengthpossible_var estim min mean max number valu within variabl features_per_unit appli qc_datafeature_datapossible_var functionx x tabl unlistx c minx medianx maxx namesout cminmedianmax features_per_unit asdatafram cbind count_uniqu features_per_unit filter class min variabl r whichfeatures_per_unitcount_uniqu features_per_unitmin iflengthr features_per_unit features_per_unitr filter median observ count k whichfeatures_per_unitmedian possible_var possible_varsk defin class_vari possible_var r iflengthclass_vari past featur level batch variabl identifi invari r featuremis_or echof figwidth figheight warningfals messagefals errorfals missing iter batch variabl iflengthclass_vari lengthclass_vari classmisplot lappli class_vari functionx variablebyfactor dep qc_datafeature_datafeature_missing indep unlist qc_datafeature_datax dep_nam featur missing indep_nam x orderfactor true violin fals returnout plot output gridextragridarrang grob classmisplot ncol r featuremis_ echof figwidth figheight warningfals messagefals errorfals missing iter batch variabl iflengthclass_vari classmisplot lappli class_vari functionx variablebyfactor dep qc_datafeature_datafeature_missing indep unlist qc_datafeature_datax dep_nam featur missing indep_nam x orderfactor true violin fals returnout plot output gridextragridarrang grob classmisplot ncol figur legend box plot illustr relationship featur variabl featur missing sampl missing figur provid illustr evalu proport sampl missig product sampl batch variabl provid supplier univari influenc batch effect sampl missing r id_sam_batch_var variabl could use evalu featur effect possible_var colnamesqc_datasample_data remov summari stat pool possibl w whichpossible_var sample_missing iflengthw possible_var possible_var cwlengthpossible_var number uniqu unit possibl variabl count_uniqu applyqc_datasample_datapossible_var functionx length uniqu naomitx remov one class count sampl size r whichcount_uniqu count_uniqu nrowqc_datasample_data count_uniqu iflengthr possible_var possible_varsr count_uniqu count_uniqu continu filter lengthpossible_var estim min mean max number valu within variabl features_per_unit appli qc_datasample_datapossible_var functionx x tabl unlistx c minx medianx maxx namesout cminmedianmax features_per_unit asdatafram cbind count_uniqu features_per_unit filter class min variabl r whichfeatures_per_unitcount_uniqu features_per_unitmin iflengthr features_per_unit features_per_unitr filter median observ count k whichfeatures_per_unitmedian possible_var possible_varsk defin batch_vari possible_var r iflengthbatch_vari past featur level batch variabl identifi invari r sample_missingness_ echof figwidth figheight warningfals messagefals errorfals missing iter batch variabl lengthbatch_vari lengthbatch_vari batchmisplot lappli batch_vari functionx variablebyfactor dep qc_datasample_datasample_missing indep unlist qc_datasample_datax dep_nam sampl missing orderfactor fals indep_nam x violin true returnout plot output gridextragridarrang grob batchmisplot ncol r sample_missingness_ echof figwidth figheight warningfals messagefals errorfals missing iter batch variabl lengthbatch_vari lengthbatch_vari batchmisplot lappli batch_vari functionx variablebyfactor dep qc_datasample_datasample_missing indep unlist qc_datasample_datax dep_nam sampl missing orderfactor fals indep_nam x violin true returnout plot output gridextragridarrang grob batchmisplot ncol r sample_missingness_ echof figwidth figheight warningfals messagefals errorfals missing iter batch variabl lengthbatch_vari batchmisplot lappli batch_vari functionx variablebyfactor dep qc_datasample_datasample_missing indep unlist qc_datasample_datax dep_nam sampl missing orderfactor fals indep_nam x violin true returnout plot output gridextragridarrang grob batchmisplot ncol figur legend box plot illustr relationship avail batch variabl sampl missing multivari evalu batch variabl r sample_missingness_multivatiaveanova echo fals figwidth figheight warningfals messagefals errorfals lengthbatch_vari covar asdatafram qc_datasample_data batch_vari fori ncolcovar covarsi asfactorcovarsi multivariateanovadep qc_datasample_datasample_missing indep_df covar els past sampl level batch variabl provid invari tabl legend typeii anova etasquar etasq estim estim percent variat explain independ variabl account variabl deriv sum squar multivari evalu batch variabl sampl missing presenc na would indic model inappropri total peak abund area ta sampl total peak abund area ta simpli sum abund measur across featur ta one measur use identifi unusu sampl given entir profil howev level missing sampl may influenc ta account evalu correl ta estim across featur pa measur use featur complet data missing determin batch effect measur impact ta relationship missing correl total abund ta complet featur missing r tpa_missing echof figwidth figheight warningfals messagefals errorfals cortest qc_datasample_datasample_missing qc_datasample_datatpa_completefeatur tpami qc_datasample_data ggplot aesx tpa_completefeatur sample_missing geom_point fill grey alpha size geom_smoothmethod loess color red size geom_smoothmethod lm color blue size labsx ta complet featur sampl missing titl past ta influenc missing nspearmanss cor roundaestim pvalu formatc apvalu format e digit figur legend relationship total peak area complet featur xaxi sampl missing yaxi univari evalu batch effect figur provid illustr evalu total abund complet featur product sampl batch variabl provid supplier r lengthbatch_vari past sampl level batch variabl provid invari r ta_by_batch echo fals figwidth figheight warningfals messagefals errorfals lengthbatch_vari lengthbatch_vari batchmisplot lappli batch_vari functionx variablebyfactor dep qc_datasample_datatpa_completefeatur indep unlist qc_datasample_datax dep_nam total peak area orderfactor fals indep_nam x violin true returnout plot output gridextragridarrang grob batchmisplot ncol r ta_by_batch_ echo fals figwidth figheight warningfals messagefals errorfals lengthbatch_vari lengthbatch_vari batchmisplot lappli batch_vari functionx variablebyfactor dep qc_datasample_datatpa_completefeatur indep unlist qc_datasample_datax dep_nam total peak area orderfactor fals indep_nam x violin true returnout plot output gridextragridarrang grob batchmisplot ncol r ta_by_batch_ echo fals figwidth figheight warningfals messagefals errorfals lengthbatch_vari batchmisplot lappli batch_vari functionx variablebyfactor dep qc_datasample_datatpa_completefeatur indep unlist qc_datasample_datax dep_nam total abund orderfactor fals indep_nam x violin true returnout plot output gridextragridarrang grob batchmisplot ncol figur legend violin plot illustr relationship total abund ta complet featur sampl batch variabl avail data multivari evalu batch variabl r sample_tpa_multivatiaveanova echo fals figwidth figheight warn fals messagefals errorfals lengthbatch_vari multivariateanovadep qc_datasample_datatpa_completefeatur indep_df qc_datasample_databatch_vari els past sampl level batch variabl provid invari tabl legend typeii anova etasquar etasq estim estim percent variat explain independ variabl account variabl deriv sum squar multivari evalu batch variabl total peakabund area complet featur power analysi explor casecontrol continu outcom data use filter data set analyt power analysi continu imbalanc presenceabs correl analysi r power_explor echof quotef commentna figwidth figheight warningfals messagefals errorfals run power analysi gener plot p runcontpowermakeplot mydata qc_datametabolite_data p runpaimbalancedpowermakeplot mydata qc_datametabolite_data ggpubrggarrangep p label ca b ncol nrow figur legend simul effect size standard trait sd illustr color figur figur provid estim power continu trait total sampl size xaxi estim power yaxi figur b provid estim power presenceabs binari trait imbalanc design estim power yaxi total sampl size set r nrowqc_datametabolite_data xaxi depict number individu present absent trait effect size illustr chosen run initi set simul identifi effect size would span broad rang power estim given sampl popul sampl size titl metaboprep metabolom data prepar report date r sysdat output pdf_document keep_md true number_sect true toc fals toc_depth space_betwee_paragraph true fig_capt true always_allow_html ye linkcit true param rdatafil na out_dir out_dir r setup includefals knitropts_chunksetecho true r args__vari includ fals warningfals messagefals errorfals librarymetaboprep librarytidyvers suppresspackagestartupmessageslibrarydendextend read r object rdata file pass paramat necessari argument qcd metabolit sampl data featur data dfd metabolit data dataout directori path project platform loadparamsrdatafil out_dir paramsout_dir r data__tibbl includ fals quotef commentna warningfals messagefals errorfals raw data raw_datametabolite_data tibbleas_tibbleraw_datametabolite_data raw_datasample_data tibbleas_tibbleraw_datasample_data colnamesraw_datasample_data samid raw_datafeature_data tibbleas_tibbleraw_datafeature_data colnamesraw_datafeature_data featureid raw_datavarexp raw_datavarexp qc data qc_datametabolite_data tibbleas_tibbleqc_datametabolite_data qc_datasample_data tibbleas_tibbleqc_datasample_data colnamesqc_datasample_data samid qc_datafeature_data tibbleas_tibbleqc_datafeature_data colnamesqc_datafeature_data featureid qc_datavarexp qc_datavarexp metaboprep report relat project r project platform r platform metaboprep r packag perform three oper provid assess summari statist raw metabolom data perform data filter metabolom data provid assess summari statist filter metabolom data particularli context batch variabl avail report provid descript inform raw filter metabolom data project r project data filter workflow follow r qcpipelineflowdiagram echofals outwidth f past libpath metaboprephelpfiguresmetaboprep_workflowpng knitrinclude_graph f issu rais githubhttpsgithubcommrcieumetaboprepissu question relat metaboprep pipelin direct david hugh dahughesbristolacukmailtodahughesbristolacuk metaboprep publish journal determin cite sampl size r project data set r sample_s echof quotef commentna figwidth figheight warningfals messagefals errorfals figaligncent tout dataframedataset cnumber samplesnumb featur rawdata dimraw_datametabolite_data filtereddata dimqc_datametabolite_data ggpubrggtexttabletout row null theme ggpubrtthememblu missing missing evalu across sampl featur use originalraw data set visual structur missing raw data set r missingnessmatrix figwidth figheight echo falsewarningfals messagefals errorfals dev png namat qc_datametabolite_data namatisnanamat namatisnanamat namat asmatrixnamat namat reshapemeltnamat colnamesnamat cindividualsmetabolitesmissing pcol rcolorbrewerbrewerpaln name dark ggplotnamat aesmetabolit individu fill missing geom_til scale_fill_gradientlow white highpcol themelegendposit none axistextx element_blank begincent textbffigur legend missing structur across raw data tabl white cell depict miss data individu row metabolit column endcent summari sampl featur missing r runmissing echo fals figwidth figheight warningfals messagefals errorfals r_mi missingnesssummydata raw_datametabolite_data p ggpubrggarrang r_mi r_mi r_mi r_mi ncol nrow label ca b c ggpubrannotate_figureptop past initi raw data set estim missing sampl featur n begincent textbffigur legend raw data distribut sampl missing sampl mean illustr red vertic line b distribut featur missing sampl mean illustr red vertic line c tabl sampl featur missing percentil tabl version plot b estim studi sampl size variou level featur missing endcent data filter exclus summari r exclusion_t echo fals figwidth figheight warningfals messagefals errorfals temp dataframeexclus rownamesqcing_dataexclusion_data count qcing_dataexclusion_data ggpubrggtextt temp row null theme ggpubrtthememblu begincent textbftabl legend six primari data filter exclus step made prepar data sampl missing exclud featur missing exclud xenobiot includ step sampl exclus base user defin threshold exclud featur exclus base user defin threshold exclud xenobiot includ step sampl totalpeakarea totalsumabund n standard deviat mean n defin user exclud sampl n standard deviat mean princip compon axi n defin user exclud endcent metabolit featur reduct princip compon data reduct carri identifi list repres featur gener sampl princip compon analysi step reduc level intercorrel data ensur princip compon driven group correl featur r pca__ echo fals figwidth figheight warningfals messagefals errorfals data reduct info feature_count lengthqcing_datafeature_sumstatsk features_included_in_data_reduct length naomitqcing_datafeature_sumstatsk cluster_count length uniqueqcing_datafeature_sumstatsk number_of_rep_meatbolit sum qcing_datafeature_sumstatsindependent_features_binari temp datafram datareduct ctotal metabolit countmetabolit includ data reductionnumb metabolit clustersnumb repres metabolit count cfeature_count features_included_in_data_reduct cluster_count number_of_rep_meatbolit ptabl ggpubrggtextt temp row null theme ggpubrtthememblu pca defin tibbl pc as_tibbleqcing_datapc defin color scheme pcol rcolorbrewerbrewerp set defin accelerationfactor accelerationfactor qcing_dataaccelerationfactor ifaccelerationfactor accelerationfactor ifaccelerationfactor accelerationfactor defin outlier omat outliermatrixpc accelerationfactor nsd pc_outlier_sd outlier applyomat sum outliersoutli pcsoutlier asfactor outlier cutoff applypc accelerationfactor functionx msd cmeanx narm true sdx narm true cutoff msd msdpc_outlier_sd returncutoff pcplot pc ggplot aesx pc pc geom_point aesfil outlier size shape scale_fill_manualvalu pcolc geom_vlinexintercept ccutoff cutoff color pcol geom_hlineyintercept ccutoff cutoff color pcol themelegendpositionbottom labstitl pasteprincip compon use number_of_rep_meatbolit repres metabolit subtitl past outlier pc_outlier_sd sd mean pc accelerationfactor gridextragridarrang grob listptabl pcplot width c ncol begincent textbffigur legend data reduct tabl left present number metabolit phase data reduct spearman correl distanc tree cut analysi right princip compon plot individu use representitv featur identifi data reduct analysi red vertic horizont line indic standard deviat sd cutoff identifi individu outlier plot red standard deviat cuttoff defin user endcent filter data n number sampl data r nrowqc_datametabolite_data number featur data r ncolqc_datametabolite_data rel raw data r nrowraw_datametabolite_data nrowqc_datametabolite_data sampl filter given user criteria r ncolraw_datametabolite_data ncolqc_datametabolite_data featur filter given user criteria pleas review detail log file number featur sampl exclud summari filter data r sample_overview echo fals figwidth figheight warningfals messagefals errorfals pcol rcolorbrewerbrewerp set missing qc_mi missingnesssummydata qc_datametabolite_data s_mis_plot qc_mi f_mis_plot qc_mi tpa tibbletibbletpa_completefeatur qc_datasample_datatpa_completefeatur tpa_plot qc_datasample_data ggplot ae tpa_completefeatur geom_histogram fill pcol bin geom_vlin xintercept medianqc_datasample_datatpa_completefeatur color pcol size labstitl pastetot abund samplesnat complet featur x theme_bw themeplottitl element_texthjust dendrogram dend qc_datafeature_tre asdendrogram creat vector color color tree label w qc_datafeature_dataindependent_features_binari pv_id ascharact unlist qc_datafeature_dataw n labelsdend bcol repblack lengthn w whichn pv_id bcolw pcol redefin element dendrogram dend dend setlabels_cex setlabels_col bcol setbranches_lwd setbranches_k_color valu bcol dend asggdenddend plot dendrogram tree_plot dend ggplot geom_hlineyintercept tree_cut_height color coral data reduc tabl feature_count lengthqc_datafeature_datak features_included_in_data_reduct length naomitqc_datafeature_datak cluster_count length uniqueqc_datafeature_datak number_of_rep_meatbolit sum qc_datafeature_dataindependent_features_binari temp datafram datareduct ctotal metabolit countmetabolit includ data reductionnumb metabolit clustersnumb repres metabolit count cfeature_countfeatures_included_in_data_reduct cluster_count number_of_rep_meatbolit ptabl ggpubrggtextt temp row null theme ggpubrtthememgreen scree plot tibbletibbl dataframepc lengthqc_datavarexp varexp qc_datavarexp screeplot ggplotaesx pc varexp geom_linecolor grey geom_pointshap fill pcol size labstitl scree plot geom_vlinexintercept qc_dataaccelerationfactor color pcol geom_vlinexintercept unlist qc_datanparallel color pcol pc plot pc as_tibbleqc_datasample_data cpcpcpcpcpcpcpcpcpcpc pcscluster_k asfactor kmeanspc cluster defin color scheme pcol rcolorbrewerbrewerp set pcplot pc ggplot aesx pc pc geom_point size shape aesfil cluster_k scale_fill_manualvalu pcol lab titl pasteprincip compon use number_of_rep_meatbolit repres metabolit x pastepc varexp signifqc_datavarexp pastepc varexp signifqc_datavarexp fill pastekmeansnclust k plot data matrixc nrow byrow true gridextragridarrang grob lists_mis_plot f_mis_plot tpa_plot tree_plot ptabl screeplot pcplot layout_matrix height c begincent textbffigur legend filter data summari distribut sampl missing featur missing total abund sampl row two figur provid spearman correl distanc cluster dendrogram highlight metabolit use repres featur blue cluster tree cut height denot horizont line row three provid summari metabolit data reduct tabl scree plot varianc explain pc plot princip compon deriv repres metabolit scree plot also identifi number pc estim inform vertic line cattel scree test acceler factor red n r qc_dataaccelerationfactor parallel analysi green n r unlist qc_datanparallel individu pc plot cluster kmean k cluster use data pc pc kmean cluster color code strictli help provid visual major axe variat sampl popul endcent structur among sampl top pc r pcapairsplot echo fals figwidth figheight warningfals messagefals errorfals plotcolor pcolpcscluster_k pcapairs_bymoos asmatrixpc qc_datavarexp pcol plotcolor begincent textbffigur legend matrix plot top five princip compon includ demarc rd grey th orang th red standard deviat mean sampl color code summari pc plot use kmean analysi pc pc k number cluster set choic k robustli chosen choic simplic help aid visual variat sampl mobil across pc endcent featur distribut estim normal wstatist raw log transform data r echof warningfals messagefals errorfals wstat qc_datafeature_dataw_stat_rawdata mani stat estim count lengthwstat nacount sumisnawstat remain_count count nacount wstat naomitwstat normcount sumwstat narm true r shapirow echo fals figwidth figheight warningfals messagefals errorfals w wstat pcol rcolorbrewerbrewerp set w_log qc_datafeature_dataw_stat_logdata plot parmfrow c oma c histw col pcol main pastedistribut w statist onnraw metabolit abund xlab w ylab frequenc cexmain ablinev col pcol mtext pastenormcount metabolit exhibit distributionsnthat may declar normal given wstat cex side outer true line adj col pcol log logmakesdistributionwors c sum w_log w narm true signif sum w_log w narm truelengthisnaw histw_log col pcol main pastedistribut w statist onnlog metabolit abund xlab w ylab frequenc cexmain mtext pastein logmakesdistributionwors instanc logmakesdistributionwors test metabolitesnth log data wstat raw data wstat cex side outer true line adj col pcol begincent textbffigur legend histogram plot shapiro wstatist raw left log transform right data distribut wstatist valu indic sampl distribut perfectli normal valu indic perfectli uniform pleas note log transform data may improv normal data endcent begincent textbfanalysi detail r count featur data r nacount featur exclud analysi variat observ n remain r remain_count metabolit featur total r normcount may consid normal distribut given shapiro wstatist endcent distribut pdf report written r past project _outlier_detection_pre_filteringpdf contain dotplot histogram distribut summari statist metabolit data set provid opportun visual inspect metabolit featur data distribut outlier evalu number sampl featur outlier across data r outlier echo fals figwidth figheight warningfals messagefals errorfals today sysdat today gsub_today outlier_filenam past out_dir project _outlier_detection_pre_filteringpdf feautur outlier summari outlier_summari outliersummarydtst qc_datametabolite_data pdf_filenam outlier_filenam nsd r outlier_summari echo fals figwidth figheight warningfals messagefals errorfals outlier_summari begincent textbftabl legend tabl report number point estim minimum median maximum number outli featur across sampl number outli sampl across featur endcent note outli sampl metabolitefeatur may extrem outli observ individu metabolitesfeatur account may want turn observ na winsor data maximum valu rank normal data place outlier top rank standard normal distribut turn observ na imput along miss data data set influenc batch variabl filter data filter data featur missing influenc possibl explanatori variabl featur missing may influenc metabolit featur biolog pathway classif technolog methodolog figur provid illustr evalu proport featur missig product variabl avail raw data file r featurebatchvari echo fals warningfals messagefals errorfals possible_batch_vari cpathplatform class batch match variabl w uniqu unlist sapplypossible_batch_vari functionx grepx tolow colnamesqc_datafeature_data iflengthw matched_vari colnamesqc_datafeature_dataw remov batch variabl invari sampl w appli qc_datafeature_datamatched_vari functionx lengthtablex iflengthw matched_vari matched_variablesw insur group size larger w appli qc_datafeature_datamatched_vari functionx sum tablex lengthtablex iflengthw matched_vari matched_variablesw insur number variabl larger w appli qc_datafeature_datamatched_vari functionx lengthtablex iflengthw matched_vari matched_variablesw defin class_vari class_vari matched_vari sub_pathway class_vari w whichclass_vari sub_pathway class_vari class_variablesw r featuremissing echof figwidth figheight warningfals messagefals errorfals missing iter batch variabl iflengthclass_vari classmisplot lappli class_vari functionx variablebyfactor dep qc_datafeature_datafeature_missing indep unlist qc_datafeature_datax dep_nam featur missing indep_nam x orderfactor true violin fals returnout plot output gridextragridarrang grob classmisplot ncol els past featur level batch variabl identifi invari begincent textbffigur legend box plot illustr relationship avail batch biolog variabl featur missing endcent filter data sampl missing influenc possibl explanatori variabl figur provid illustr evalu proport sampl missig product sampl batch variabl provid supplier univari influenc batch effect sampl missing r samplebatchvari echo fals warningfals messagefals errorfals possible_batch_vari cbox day prep date time type nmr buffer lmwm match variabl w possible_batch_vari colnamesqc_datasample_data w uniqu unlist sapplypossible_batch_vari functionx grepx tolow colnamesqc_datasample_data lengthw matched_vari possible_batch_variablesw matched_vari colnamesqc_datasample_dataw batch variabl variabl sampl w appli qc_datasample_datamatched_vari functionx length tablex matched_vari matched_variablesw insur group size larger w appli qc_datasample_datamatched_vari functionx sum tablex lengthtablex matched_vari matched_variablesw insur number variabl larger w appli qc_datasample_datamatched_vari functionx lengthtablex matched_vari matched_variablesw batch_vari matched_vari els batch_vari na case batch variabl variabl typic sampl size small done go iflengthbatch_vari batch_vari na r sample_missing echof figwidth figheight warningfals messagefals errorfals missing iter batch variabl isnabatch_vari batchmisplot lappli batch_vari functionx variablebyfactor dep qc_datasample_datasample_missing indep unlist qc_datasample_datax dep_nam sampl missing orderfactor fals indep_nam x violin true returnout plot output gridextragridarrang grob batchmisplot ncol els past sampl level batch variabl provid invari begincent textbffigur legend box plot illustr relationship avail batch variabl sampl missing endcent multivari evalu batch variabl r sample_missingness_multivatiaveanova echo fals figwidth figheight warningfals messagefals errorfals isnabatch_vari multivariateanovadep qc_datasample_datasample_missing indep_df qc_datasample_data batch_vari els past sampl level batch variabl provid invari begincent textbftabl legend typeii anova etasquar etasq estim estim percent variat explain independ variabl account variabl deriv sum squar multivari evalu batch variabl sampl missing endcent sampl total peakabund area tpa total peakabund area tpa simpli sum abund measur across featur tpa one measur use identifi unusu sampl given entir profil howev level missing sampl may influenc tpa account evalu correl tpa estim across featur tpa measur use featur complet data missing determin batch effect measur impact tpa relationship missing correl total peak area complet featur missing r tpa_missing echof figwidth figheight warningfals messagefals errorfals cortest qc_datasample_datasample_missing qc_datasample_datatpa_completefeatur tpami qc_datasample_data ggplot aesx tpa_completefeatur sample_missing geom_point fill grey alpha size geom_smoothmethod loess color red size geom_smoothmethod lm color blue size labsx tpa complet featur sampl missing titl past tpa influenc missing nspearmanss cor roundaestim pvalu formatc apvalu format e digit begincent textbffigur legend relationship total peak area complet featur xaxi sampl missing yaxi endcent univari evalu batch effect figur provid illustr evalu total peak area product sampl batch variabl provid supplier r tpasummari echo fals figwidth figheight warningfals messagefals errorfals isnabatch_vari batchmisplot lappli batch_vari functionx variablebyfactor dep qc_datasample_datatpa_completefeatur indep unlist qc_datasample_datax dep_nam total peak area orderfactor fals indep_nam x violin true returnout plot output gridextragridarrang grob batchmisplot ncol els past sampl level batch variabl provid invari begincent textbffigur legend violin plot illustr relationship total peak area tpa sampl batch variabl avail data endcent multivari evalu batch variabl r sample_tpa_multivatiaveanova echo fals figwidth figheight warn fals messagefals errorfals isnabatch_vari multivariateanovadep qc_datasample_datatpa_completefeatur indep_df qc_datasample_databatch_vari els past sampl level batch variabl provid invari begincent textbftabl legend typeii anova etasquar etasq estim estim percent variat explain independ variabl account variabl deriv sum squar multivari evalu batch variabl total peakabund area complet featur endcent power analysi explor casecontrol continu outcom data use filter data set analyt power analysi continu imbalanc presenceabs correl analysi r power_explor echof quotef commentna figwidth figheight warningfals messagefals errorfals run power analysi gener plot runpowermakeplotmydata metdata p runcontpowermakeplot mydata qc_datametabolite_data p runpaimbalancedpowermakeplot mydata qc_datametabolite_data gridextragridarrangep p nrow ggpubrggarrangep p label ca b ncol nrow begincent textbffigur legend simul effect size illustr color figur figur provid estim power continu trait total sampl size xaxi estim power yaxi figur b provid estim power presenceabs binari trait imbalanc design estim power yaxix total sampl size set r nrowqc_datametabolite_data xaxi depict number individu present absent trait effect size illustr chosen run initi set simul identifi effect size would span broad rang power estim given sampl popul sampl size endcent gener roxygen edit hand pleas edit document rsamplemissingnessr namesamplemissing aliassamplemissing titleestim sampl missing usag samplemissingnesswdata excludethesefeatur na argument itemwdataa numer matrix sampl row featur column itemexcludethesefeaturesa vector featur name ie column name exclud missing estim valu data frame missing estim sampl vector featur name also pass function second column missing estim also return provid missing estim sampl exclus featur provid descript function estim sampl missing matrix data provid option exclud certain column featur analysi xenobiot high missing rate metabolom data set exampl simul data setse ex_data sappli functionx rnorm rownamesex_data pasteind nrowex_data colnamesex_data pastevar ncolex_data add missing data ex_data sampl na estim missing mis_est samplemissingnessex_data mis_est_v samplemissingnessex_data excludethesefeatur var keywordmissing gener roxygen edit hand pleas edit document rpcandoutliersr namepcandoutli aliaspcandoutli titleprincip compon analysi usag pcandoutliersmetabolitedata indfeature_nam outlier true argument itemmetabolitedatath metabolit data matrix sampl row metabolit column itemindfeature_namesa vector independ featur name column name itemoutliersdefault true truefals binari flag would like outlier identifi valu list object length five data frame pc load vector varianc explain estim pc estim number inform top pc determin acceler factor analysi estim number inform top pc determin parrallel analysi data frame probablisit pc load descript function perform two princip compon analysi first miss data imput median second probablist pca run account missing subsequ deriv pc median imput pc data use identifi number inform signific pc acceler analysi parrallel analysi final number sampl outlier determin standard deviat mean top pc determin acceler factor analysi exampl defin covari matrix cmat matrix cmat c cmat c cmat c cmat c simul correl data multivari random normal setse massmvrnormn mu c sigma cmat setse massmvrnormn mu c sigma cmat simul random data sappli functionx rnorm defin data set ex_data cbindddd rownamesex_data pasteind nrowex_data colnamesex_data pastevar ncolex_data add missing ex_datasamplelengthex_data na add technic error two sampl applyex_data functionx meanx narm true ex_datac ex_data run pca ex_out pcandoutliersex_data indfeature_nam samplecolnamesex_data keywordpca keywordprobalist gener roxygen edit hand pleas edit document revalpowerbinaryimbalancedr nameevalpowerbinaryimbalanc aliasevalpowerbinaryimbalanc titleestim power binari variabl imbalanc design usag evalpowerbinaryimbalancedn_cas n_control effect alpha argument itemn_casea numer vector sampl size case itemn_controla numer vector sampl size control itemeffecta numer vector effect size itemalphaa numer vector signific threshold valu matrix paramat input power estim return matrix descript function allow estim power binari variabl given defin number case sampl control sampl effect size signific threshold exampl evalpowerbinaryimbalanc n_case n_control effect alpha evalpowerbinaryimbalanc n_case c n_control c effect alpha keywordmetabolom gener roxygen edit hand pleas edit document rfeaturetreeindependenc namefeaturetreeindepend aliasfeaturetreeindepend titleidentifi independ featur usag featuretreeindependencewdata argument itemwdatath metabolit data matrix sampl row metabolit column valu data frame k cluster group id binari identifi featur identifi independ featur descript function identifi independ featur use spearman rho dendrogram tree cut step featur return independ within kcluster featur least missing chosen random case missing tie exampl cmat matrix cmat c cmat c cmat c cmat c simul correl data multivari random normal setse ex_data massmvrnormn mu c sigma cmat defin data set rownamesex_data pasteind nrowex_data colnamesex_data pastevar ncolex_data run function df featuretreeindependenceex_data keywordfeatur keywordindependec gener roxygen edit hand pleas edit document rfindpaeffectsizessimr namefindpaeffectsizessim aliasfindpaeffectsizessim titleidentifi effect size usag findpaeffectsizessimmydata argument itemmydatayour metabolit data matrix sampl row valu vector effect size descript function estim appropri distribut effect size simul power analysi exampl ex_data sappli functionx rnorm findpaeffectsizessimex_data keywordanlysi keywordpow gener roxygen edit hand pleas edit document rsamplesumstatsr namesamplesumstat aliassamplesumstat titlesummari statist sampl usag samplesumstatswdata feature_names__exclud na outlier_udist argument itemwdatath metabolit data matrix sampl row metabolit column itemfeature_names__excludea vector featurecolumn name exclud missing estim itemoutlier_udistth interquartil rang unit distanc median call sampl outlier featur valu data frame summari statist descript function estim summari statist sampl matrix numer featur includ missing total peak area count number outli featur sampl exampl simul data setse ex_data sappli functionx rnorm rownamesex_data pasteind nrowex_data colnamesex_data pastevar ncolex_data add missing data ex_data sampl na run estim sampl summari statist samplesumstatsex_data keywordsampl keywordstatist keywordsummari gener roxygen edit hand pleas edit document rfeatureoutliersr namefeatureoutli aliasfeatureoutli titleoutli sampl count featur usag featureoutlierswdata nsd argument itemwdatath metabolit data matrix sampl row metabolit column itemnsdth number standard deviat mean outlier identifi default valu valu data frame sampl outlier count featur column matrix descript function take matrix data sampl row featur column count number outli sampl featur exampl ex_data sappli functionx rnorm samplelengthex_data ex_data ex_data run function fout featureoutliersex_data keywordfeatur keywordoutli gener roxygen edit hand pleas edit document rdatar doctypedata nameng_anno aliasng_anno titlenightingal health metabolom annot data set format data frame row variabl describ itemmetabolitemetabolit id itemrawlabelmetabolit name unit itemclassmetabolit annot class itemsubclassmetabolit annot subclass itemlabelmetabolit name unit itemlabelnounitsmetabolit name without unit itemderived_featuresa binari yesno indic metabolit variabl variabl deriv two featur data set sourc urlhttpnightingalehealthcom usag ng_anno descript dataset contain annot data nightingal health nmr metabolit lipid compil public resourc addit annot made keyworddataset gener roxygen edit hand pleas edit document rruncontpowermakeplotr nameruncontpowermakeplot aliasruncontpowermakeplot titlecontinu trait power analysi plot usag runcontpowermakeplotmydata argument itemmydatayour metabolit data matrix sampl row valu ggplot object descript function identifi inform distribut effect power estim given data total sampl size return summari plot exampl ex_data matrixna runcontpowermakeplot ex_data keywordanalysi keywordcontinu keywordplot keywordpow keywordtrait gener roxygen edit hand pleas edit document rgreedypairwisenfilterr namegreedypairwisenfilt aliasgreedypairwisenfilt titlegreedi select usag greedypairwisenfilterwdata minn argument itemwdatath metabolit data matrix sampl row metabolit column itemminnth minimum sampl size n pairwis comparison valu vector featur name descript function identifi featur less minimum number complet pairwis observ remov one greedi fashion need function instanc missing extrem two featur number pair observ may inform thu one remov analysi avoid analyt error base sampl size exampl setse ex_data sappli functionx rnorm defin data set rownamesex_data pasteind nrowex_data colnamesex_data pastevar ncolex_data add missing ex_data sampl na ex_data sampl na ex_data sampl na estim missing gener plot greedypairwisenfilterex_data keywordfeatur keywordselect gener roxygen edit hand pleas edit document rreadinmetabolonr namereadinmetabolon aliasreadinmetabolon titleread metabolon v metabolom data usag readinmetabolonfileprocess data_dir projectnam argument itemfileprocessth name xl file process itemdata_dirth full path directori hold metabolon excel file itemprojectnamea name project valu list object metabolit sampl annot featur annot data descript function read metabolon v format raw data excel file write metabolit sampl annot featur annot data flat text file also return list object data exampl readinmetabolonfileprocess metabolon_data_releasexl data_dir filesitsher projectnam amaz project keywordmetabolon keywordmetabolom gener roxygen edit hand pleas edit document rmissingnesssumr namemissingnesssum aliasmissingnesssum titlemissing summari plot usag missingnesssummydata argument itemmydatametabolit data matrix sampl row metabolit featur column valu list object length four vector sampl missingess vector featur missing tabl summar missing list ggplot plot sampl featur histogram distribut summari tabl descript function sumar sampl featur missing tabl summari plot exampl ex_data sappli functionx rnorm defin data set rownamesex_data pasteind nrowex_data colnamesex_data pastevar ncolex_data add missing ex_datasamplelengthex_data na estim missing gener plot ms missingnesssumex_data plot ggpubrggarrangeplotlist msplotsout ncol nrow keywordmetabolom keywordmissing keywordplot keywordsummari gener roxygen edit hand pleas edit document rfindconteffectsizessimr namefindconteffectsizessim aliasfindconteffectsizessim titleidentifi continuo trait effect size usag findconteffectsizessimmydata argument itemmydatayour metabolit data matrix sampl row valu vector effect size descript function estim appropri distribut effect size simul continu trait power analysi exampl ex_data sappli functionx rnorm findconteffectsizessimex_data keywordanalysi keywordpow gener roxygen edit hand pleas edit document rfeature_plotsr namefeature_plot aliasfeature_plot titlefeatur plot file usag feature_plotswdata outdir null nsd argument itemwdataa data frame featur ex metabolit protein abund level itemoutdiroutput directori path itemnsdnumb sd mean plot outlier line scatter plot histogram valu ggplot object descript function plot scatter plot histogram summari statist featur data frame pdf file exampl ex_data sappli functionx rnorm colnamesex_data pastevar ncolex_data feature_plotsex_data keywordmetabolom keywordpdf keywordsummari gener roxygen edit hand pleas edit document rperformmetaboliteqcr nameperformmetaboliteqc aliasperformmetaboliteqc titleperform metabolom qualiti control usag performmetaboliteqc wdata fmi smi tpa_out_sd outlier_udist outlier_treat leave_b winsorize_quantil tree_cut_height pc_out_sd feature_colnames__exclud na derived_colnames__exclud na argument itemwdatath metabolit data matrix sampl row metabolit column itemfmisdefault defin featur missing cutoff itemsmisdefault defin sampl missing cutoff itemtpa_out_sddefault defin number standard deviat mean sampl exclud total peak area pass na paramat exclud step itemoutlier_udistdefault defin number interquartil rang unit median defin valu outlier itemoutlier_treatmentdefault leave_b choic leave_b winsor turn_na defin treat outlier valu prior estim princip compon leave_b noth ourlier valu turn_na turn outlier na thu median imput purpos pca winsor turn na valu winsorize_quantil remain nonoutli valu featur itemwinsorize_quantileth quantil winzoris outlier valu outlier_treat paramet set winsor default maximum valu remain nonoutli valu featur itemtree_cut_heightth height cut featuremetabolit dendrogram identifi independ featur tree_cut_height absolutespearman rho intraclust correl itempc_out_sddefault defin number standard deviat mean sampl exclud principl compon na except paramat itemfeature_colnames__excludenam column exclud analysi xenobiot pass na paramet exclud step itemderived_colnames__excludenam column exclud sampl qc step includ independ featur identif use gener sampl pca valu list object wdata qcd data matrix featuresumstat list tabl data frame featur summari statist tree hclust object pca list pc data frame top pc binari outlier top pc sd mean varexp vector varianc explain pc estim number signific pc determin accelerationfactor acceler factor nsig_parrallel parrallel analysi final prob_pca top pc deriv probabilist pc analysi exclusion_data matrix exclus summari statist descript function wrapper function perform key qualiti control step metabolom data set exampl defin covari matrix cmat matrix cmat c cmat c cmat c cmat c simul correl data multivari random normal setse massmvrnormn mu c sigma cmat setse massmvrnormn mu c sigma cmat simul random data sappli functionx rnorm defin data set ex_data cbindddd rownamesex_data pasteind nrowex_data colnamesex_data pastevar ncolex_data add missing ex_datasamplelengthex_data na add technic error two sampl applyex_data functionx meanx narm true ex_datac ex_data run qualiti control example_qc performmetaboliteqcex_data filter data found dimexample_qcwdata example_qcwdata data frame summari statist head example_qcfeaturesumstatst hclust dendrogram plot plot example_qcfeaturesumstatstre hang ablineh col red lwd median imput pc sampl plot pcol cbluer asfactor example_qcpcapc pc__sd_outlier plotexample_qcpcapcspc example_qcpcapcspc pch cex bg pcol xlab past pc var exp roundexample_qcpcavarexp ylab past pc var exp roundexample_qcpcavarexp scree plot gener plot x lengthexample_qcpcavarexp example_qcpcavarexp type b pch cex bg blue xlab pc ylab varianc explain main scree plot ablinev example_qcpcaaccelerationfactor col red lwd ablinev example_qcpcansig_parrallel col green lwd probablist pc sampl plot plotexample_qcpcaprob_pca example_qcpcaprob_pca pch cex bg pcol xlab pc ylab pc summari exclus statist example_qcexclusion_data keywordcontrol keywordmetabolom keywordqu gener roxygen edit hand pleas edit document rfeaturesumstatsr namefeaturesumstat aliasfeaturesumstat titlefeatur summari statist usag featuresumstat wdata sammi na tree_cut_height outlier_udist feature_names__exclud na argument itemwdatath metabolit data matrix sampl row metabolit column itemsammisa vector sampl missing estim order match sampl row data matrix itemtree_cut_heighttre cut height height cut featuremetabolit dendrogram identifi independ featur tree_cut_height absolutespearman rho intraclust correl itemoutlier_udistth interquartil rang unit distanc median call sampl outlier featur itemfeature_names__excludea vector featuremetabolit name exclud tree build independ featur identif process valu list object length two data frame summari statist hclust object descript function estim featur statist sampl matrix metabolit featur exampl defin covari matrix cmat matrix cmat c cmat c cmat c cmat c simul correl data multivari random normal setse massmvrnormn mu c sigma cmat setse massmvrnormn mu c sigma cmat simul random data sappli functionx rnorm defin data set ex_data cbindddd rownamesex_data pasteind nrowex_data colnamesex_data pastevar ncolex_data add missing ex_datasamplelengthex_data na add technic error two sampl applyex_data functionx meanx narm true ex_datac ex_data run function fss featuresumstatsex_data featur summari tabl fsstabl plot dendrogram plotfsstre hang keywordmetabolom gener roxygen edit hand pleas edit document rrntransformr namerntransform aliasrntransform titlerank normal tranform usag rntransformi split_ti true argument itemya numer vector rank normal transform itemsplit_tiesa binari string true default fals indic tie valu rank randomli split give uniqu rank valu return numer vector length rank normal transform valu descript function rank normal transform vector data procedur built provid genabel pacakg exampl simul neg binomi distribut valu nb_data rnbinom mu size rank normal transform valu rnt_data rntransform nb_data split_ti true keywordnorm keywordrank keywordtransform gener roxygen edit hand pleas edit document rtotalpeakarear nametotalpeakarea aliastotalpeakarea titleestim total peak abund usag totalpeakareawdata feature_names__exclud na ztransform true argument itemwdatath metabolit data matrix sampl row metabolit column itemfeature_names__excludea vector featuremetabolit name exclud tree build independ featur identif process itemztransformshould featur data ztransform absolut valu minimum mean shift prior sum featur valu true fals valu data frame estim total peak abund total peak abund complet featur sampl descript function estim total peak abundancearea numer data matrix featur featur complet data exampl setse ex_data sappli functionx rnorm rownamesex_data pasteind nrowex_data ex_data sampl na tpa_est totalpeakareaex_data keywordabund keywordarea keywordlevel keywordpeak keywordtot gener roxygen edit hand pleas edit document revalpowerbinaryr nameevalpowerbinari aliasevalpowerbinari titleestim power binari variabl usag evalpowerbinaryn effect alpha argument itemna numer vector total studi sampl size case control defin n itemeffecta numer vector effect size itemalphaa numer vector signific threshold valu matrix paramet input estim power return matrix descript function allow estim power binari variabl given sampl size effect size signific threshold exampl evalpowerbinaryn effect seq alpha keywordbinari keywordestim keywordpow gener roxygen edit hand pleas edit document rfeaturemissingnessr namefeaturemissing aliasfeaturemissing titleestim featur missing usag featuremissingnesswdata argument itemwdatath metabolit data matrix sampl row metabolit column valu data frame percent missing featur descript function estim featur missingess step exclud poor sampl identifi sampl missing greater exampl ex_data sappli functionxrnorm ex_data samplelengthex_data na featuremissingnesswdata ex_data keywordfeatur keywordmissing gener roxygen edit hand pleas edit document rbatch_normalizationr namebatch_norm aliasbatch_norm titlemedian batch normal usag batch_norm wdata feature_data_sheet null sample_data_sheet null feature_runmode_col null batch_id null argument itemwdatath metabolit data frame sampl row metabolit column itemfeature_data_sheeta data frame contain featur annot data itemsample_data_sheeta data frame contain sampl annot data itemfeature_runmode_cola string identifi column name feature_data_sheet identifi run mode featur metabolit protein itembatch_idsa string vector length equal number sampl data set identifi batch sampl belong valu return wdata object pass function median normal given batch inform provid descript function median normal multivari data often process batch metabolom proteom data set exampl vector batch variabl defin data set sappli functionx rnorm sappli functionx rnorm ex_data rbinddd rownamesex_data pasteind nrowex_data colnamesex_data pastevar ncolex_data defin batch batch c repa repb normal batch norm_wdata batch_normalizationwdata ex_data batch_id batch keywordbatch keywordmetabolom keywordnorm keywordproteom gener roxygen edit hand pleas edit document routliersummaryr nameoutliersummari aliasoutliersummari titlefeatur summari plot usag outliersummarydtst pdf_filenam feature_distributionspdf nsd argument itemdtstnumer data frame itempdf_filenamenam pdf file itemnsdnumb sd consid outlier default valu print summari figur column data data frame pdf file descript function plot distribut identifiy outlier everi metabolit column data frame exampl defin covari matrix cmat matrix cmat c cmat c cmat c cmat c simul correl data multivari random normal setse massmvrnormn mu c sigma cmat setse massmvrnormn mu c sigma cmat simul random data sappli functionx rnorm defin data set ex_data cbindddd rownamesex_data pasteind nrowex_data colnamesex_data pastevar ncolex_data run function outliersummaryex_data keywordfeatur keywordmetabolom keywordplot keywordsummari gener roxygen edit hand pleas edit document rmaketr namemaketre aliasmaketre titlegener hclust dendrogram usag maketreewdata cor_method spearman hclust_method complet argument itemwdatath metabolit data matrix sampl row metabolit column itemcor_methodth correl method use function cor default spearman itemhclust_methodth dendrogram cluster method use construct tree default complet valu hclust object descript estim dendrogram feautr base correl coefficeint choic cluster method choic exampl cmat matrix cmat c cmat c cmat c cmat c simul correl data multivari random normal setse ex_data massmvrnormn mu c sigma cmat estiamt dendrogram tree maketreeex_data plot dendrogram plottre hang keyworddendrogram keywordhclust gener roxygen edit hand pleas edit document rmetbatchr namemetbatch aliasmetbatch titlebatch effect numer matrix usag metbatchwdata batch argument itemwdatath numer data matrix sampl row featur column itembatcha singl vector contain vector base batch variabl valu list object length two data frame summari statist number test featur b mean batch effect across featur c mean batch effect across associ bh fdr featur number associ bh fdr featur descript function estim effect categor batch variabl matrix featur univari linear model exampl sappli functionx rnorm sappli functionx rnorm ex_data rbindd sappli functionx rnorm ex_data cbindex_data lot c repa repb ex metbatchwdata ex_data batch lot keywordlinear keywordmetabolom keywordmodel keywordunivari gener roxygen edit hand pleas edit document rtree_and_independent_featuresr nametree_and_independent_featur aliastree_and_independent_featur titleidentifi independ featur numer matrix usag tree_and_independent_featur wdata minimum_samples tree_cut_height feature_names__exclud na argument itemwdatath metabolit data matrix sampl row metabolit column itemminimum_samplesizeth metabolit data matrix sampl row metabolit column itemtree_cut_heightth tree cut height valu spearman rho equival say featur rho independ itemfeature_names__excludea vector featuremetabolit name exclud analysi might featur heavili presentabs like xenobiot variabl deriv two variabl alreadi dataset valu list object hclust object independ featur data frame featur id kcluster identifi binari identifi independ featur descript function identifi independ featur use spearman rho correl distanc dendrogram tree cut step exampl defin covari matrix cmat matrix cmat c cmat c cmat c cmat c simul data multivari random normal setse ex_data massmvrnormn mu c sigma cmat rownamesex_data pasteind nrowex_data colnamesex_data pastevar ncolex_data run function identifi independ variabl tree cut height equival cluster variabl spearman rho tree_cut_height ind tree_and_independent_featuresex_data tree_cut_height keywordfeatur keywordindepend gener roxygen edit hand pleas edit document rfeaturedescrib namefeaturedescrib aliasfeaturedescrib titlesummari statist featur usag featuredescribewdata argument itemwdatath metabolit data matrix sampl row metabolit column valu data frame summari statist featur column matrix descript function allow describ metabolit featur use describ function psych packag well estim varianc dispers index coefic variat shapiro wstatist exampl ex_data sappli functionx rnorm featuredescribeex_data keywordfeatur keywordstatist keywordsummari gener roxygen edit hand pleas edit document ridoutliersr nameidoutli aliasidoutli titleidentifi outlier usag idoutliersx nsd argument itemxa vector numer valu itemnsdth number standard deviat mean outlier identifi default valu valu vector index sampl outlier descript given vector data identifi posit nsd standard deviat unit mean exampl ex_data rnbinom mu size idoutliersex_data nsd keywordoutli gener roxygen edit hand pleas edit document rpcapairs_bymoos namepcapairs_bymoos aliaspcapairs_bymoos titlepca pair plot usag pcapairs_bymoosemyload varexp pcol dodgerblu argument itemmyloadingsa matrix data frame pc load would like plot itemvarexpa vector varianc explain pc itempcolplot color dot background valu base r plot descript function gener upper triangl pca plot pair pc load provid exampl ex_data sappli functionxrnorm add extrem valu sampl ex_data ex_data sampl c ncolex_data replac true ex_data ex_data sampl c ncolex_data replac true plot pcapairs_bymoosemyload ex_data varexp repncolex_data ncolex_data pcol tomato keywordpca keywordmetabolom keywordpair keywordplot gener roxygen edit hand pleas edit document rsampleoutliersr namesampleoutli aliassampleoutli titleoutli featur count sampl usag sampleoutlierswdata nsd argument itemwdataa metabolit data matrix sampl row metabolit column itemnsdth number standard deviat mean outlier identifi default valu valu data frame outil count sampl descript function take matrix numer data count number outli featur sampl exampl sappli functionx rnorm sampleoutliersd nsd keywordmetabolom keywordoutli gener roxygen edit hand pleas edit document rmedian_imput namemedian_imput aliasmedian_imput titlemedian imput miss data usag median_imputewdata argument itemwdatath metabolit data matrix sampl row metabolit column valu matrix pass function na imput column median valu descript function imput featur column metabolom matrix median estim use pca exampl ex_data sappli functionx rnorm defin data set rownamesex_data pasteind nrowex_data colnamesex_data pastevar ncolex_data add missing ex_datasamplelengthex_data na estim missing gener plot imp_data median_imputeex_data keywordimput keywordmedian keywordmetabolom gener roxygen edit hand pleas edit document revalpowercontr nameevalpowercont aliasevalpowercont titleestim power continu variabl usag evalpowercontn n_coeff effect alpha argument itemnsampl size itemn_coeffdegre freedom numer itemeffecteffect size itemalphasignific level type error descript function estim power continu variabl given sampl size effect size signific threshold degre freedom exampl evalpowercontn n_coeff effect alpha keywordcontinu keywordpow gener roxygen edit hand pleas edit document routliermatrixr nameoutliermatrix aliasoutliermatrix titleidentifi outlier sampl index matrix usag outliermatrixdata nsd meansd fals argument itemdataa matrix numer valu sampl row featur column itemnsdth unit distanc sd iqr mean median estim respect outlier identifi default valu itemmeansdset true would like estim outlier use mean sd method set fals would like estim median inter quartil rang default fals valu matrix sampl outlier outlier descript given matrix data function return matrix structur valu indic outlier expans function idoutli appli column matrix exampl ex_data sappli functionx rnorm defin data set rownamesex_data pasteind nrowex_data colnamesex_data pastevar ncolex_data add technic error two sampl applyex_data functionx meanx narm true ex_datac ex_data omat outliermatrixex_data mani outlier identifi sumomat keywordindex keywordmatrix keywordoutli gener roxygen edit hand pleas edit document rgenerate_reportr namegenerate_report aliasgenerate_report titlegener metaboprep summari html report usag generate_report full_path__rdatafil reportdatardata dir__report path__rmd_templ filepathsystemfilermarkdown packag metaboprep metaboprep_report_vrmd argument itemfull_path__rdatafileful path rdatafil itemdir__reportdirectori place report itempath__rmd_templateful path html report templat valu write html report file html file written file descript function gener html report exampl keywordhtml keywordknit keywordreport gener roxygen edit hand pleas edit document rreadinnightingal namereadinnightingal aliasreadinnightingal titleread nightingal health metabolom data usag readinnightingalefileprocess data_dir projectnam argument itemfileprocessth name xl file process itemdata_dirth full path directori hold nightingal excel file itemprojectnamea name project valu list object metabolit sampl annot featur annot data descript function read nightingal raw data excel file write metabolit sampl annot featur annot data flat text file also return list object data exampl readinnightingalefileprocess nh_data_releasexl data_dir filesitsher projectnam amaz project keywordhealth keywordnigtingal keywordmeatbolom gener roxygen edit hand pleas edit document routliersr nameoutli aliasoutli titleidentifi outlier usag outliersx nsd argument itemxa numer vector data itemnsdth number sd unit mean use outlier cutoff valu list object length three vector sampl index indic outlier lower outlier cuttoff valu upper outlier cuttoff valu descript function identifi outlier vector data sd unit mean exampl ex_data rnbinom mu size outliersex_data keywordoutli gener roxygen edit hand pleas edit document rmultivariateanovar namemultivariateanova aliasmultivariateanova titlemultivari analysi usag multivariateanovadep indep_df argument itemdepa vector depend variabl itemindep_dfa data frame independ variabl valu ggplot tabl figur descript function perform multivari analysi dependentrespons numer independentexplanatori variabl exampl cmat matrix cmat c cmat c cmat c simul correl data multivari random normal setse ex_data massmvrnormn mu c sigma cmat colnamesex_data coutcomeagebmi multivariateanovadep ex_data indep_df ex_data keywordanova keywordmetabolom keywordmultivari gener roxygen edit hand pleas edit document rmakecormatrixr namemakecormatrix aliasmakecormatrix titlecorrel matrix usag makecormatrixwdata cor_method kendal minn varreturn cor argument itemwdatath metabolit data matrix sampl row metabolit column itemcor_methoddefault kendal correl method use function cortest itemminnsefault minimum number observ must avail pair perform analysi itemvarreturnsefault cor option pvalu flag indic estim return function valu matrix correl estim pvalu descript function estim correl matrix return wither correl estim pvalu exampl cmat matrix cmat c cmat c cmat c cmat c simul correl data multivari random normal setse ex_data massmvrnormn mu c sigma cmat return correl estim cor_mat makecormatrixex_data varreturn cor return pvalu cor_mat makecormatrixex_data varreturn pvalu keywordcorrel keywordmatrix gener roxygen edit hand pleas edit document rvariablebyfactorr namevariablebyfactor aliasvariablebyfactor titleggplot violin plot usag variablebyfactor dep indep dep_nam depend indep_nam independ orderfactor true violin true argument itemdepa vector depend variabl itemindepa vector independ variabl itemdep_namenam depend variabl itemindep_namenam independ variabl itemorderfactorord factor alphebet itemviolinbox plot violin plot violin true default valu ggplot object descript function perform univari linear analysi depend independ variabl gener viloin box plot illustr associ structur exampl x c rnorm rnorm asfactor c repa repb variablebyfactordep x indep dep_nam express indep_nam speci keywordggplot keywordmetabolom gener roxygen edit hand pleas edit document rrunpaimbalancedpowermakeplotr namerunpaimbalancedpowermakeplot aliasrunpaimbalancedpowermakeplot titlebinari trait imbalanc design power analysi plot usag runpaimbalancedpowermakeplotmydata argument itemmydataa numer data matrix sampl row featur column valu ggplot object descript function estim inform distribut effect power estim given data total sampl size distribut imbalanc sampl size return summari plot exampl ex_data matrixna runpaimbalancedpowermakeplot ex_data keywordanalysi keywordbinari keywordplot keywordpow keywordtrait gener roxygen edit hand pleas edit document rpcafactoranalysisr namepcafactoranalysi aliaspcafactoranalysi titlepca factor analysi annot enrich usag pcafactoranalysi metabolitedata pcload sigthreshold feature_anno feature_datasuper_pathway argument itemmetabolitedataa matrix data frame metabolit data itempcloadingsa matrix data frame pc load wish test itemsigthresholdspearman rho correl threshold declar associ numer variabl pc load itemfeature_annoa vector variabl annot perform hypergeomtr enrich valu list object length list object enrichment_t spearman correl matrix featur pc load descript function perform factor analysi numer data pc load deriv said data subsequ perform hypergeometrix enrich test ask certain class variabl enrich particular pc exampl defin covari matrix cmat matrix cmat c cmat c cmat c cmat c simul correl data multivari random normal setse massmvrnormn mu c sigma cmat setse massmvrnormn mu c sigma cmat simul random data sappli functionx rnorm ex_data cbindddd rownamesex_data pasteind nrowex_data colnamesex_data pastevar ncolex_data annot met_anno c repa repb repc pca pca prcompex_data center true scale true run pcafactoranalysi ex_out pcafactoranalysismetabolitedata ex_data pcload pcax sigthreshold feature_anno met_anno keywordpc keywordanalysi keywordenrich keywordexact keywordfactor keywordfish keywordhypergeometr keywordtest gener roxygen edit hand pleas edit document rsammissingnessexclusionr namesammissingnessexclus aliassammissingnessexclus titlesampl exlus missing total peak area usag sammissingnessexclusionmydata sdata fdata argument itemmydatametabolit data itemsdatasampl data itemfdatafeatur data valu data frame missing tpa exclus descript function provid missingn tpa estim along exlcus sd mean exampl sammissingnessexclus keywordmetabolom