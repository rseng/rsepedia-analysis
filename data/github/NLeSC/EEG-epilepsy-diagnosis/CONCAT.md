[![Build Status](https://travis-ci.org/NLeSC/EEG-epilepsy-diagnosis.svg?branch=master)](https://travis-ci.org/NLeSC/EEG-epilepsy-diagnosis)
[![codecov](https://codecov.io/gh/NLeSC/EEG-epilepsy-diagnosis/branch/master/graph/badge.svg)](https://codecov.io/gh/NLeSC/EEG-epilepsy-diagnosis)
[![DOI](https://zenodo.org/badge/56344151.svg)](https://zenodo.org/badge/latestdoi/56344151)

# EEG-epilepsy-diagnosis


R code to train a classifier for 14 channels EEG data to distinguish individuals with Epilepsy from Controls.

Please check folder 'demo' for how the code can be used. Documentation on all functions are in the folder 'man', to be compiled as pdf (not done yet)
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/create_confmatrix.R
\name{create_confmatrix}
\alias{create_confmatrix}
\title{Create confusion matrix}
\usage{
create_confmatrix(predicted, reference)
}
\arguments{
\item{predicted}{predicted class}

\item{reference}{reference class}
}
\value{
confmat confusion matrix
}
\description{
Creates an NxN confusion matrix for a binary classification and its reference values
}
\examples{
set.seed(21)
reference <- make.names(round(runif(n=10,min=0,max=0.8),digits=0))
set.seed(23)
predicted <- make.names(round(runif(n=10,min=0,max=0.8),digits=0))
confusionmatrix <- create_confmatrix(reference, predicted)
}
\author{
Vincent T van Hees
}
\name{data.labels}
\alias{data.labels}
\docType{data}
\title{
Example eeg data
}
\description{
Example labels for a dataset
}
\usage{data(data.labels)}
\format{
  The format is:
 chr "data.labels"
}
\source{
The data was extracted as a subset from an study 
}
\examples{
data(data.labels)
}
\keyword{datasets}\name{evaluatemodel}
\alias{evaluatemodel}
\title{Evaluate model on data}
\usage{
evaluatemodel(model,x,labels,proto_i,aggregateperid)
}
\arguments{
\item{model}{Model produced by caret function train}

\item{x}{Test data on which the model will be applied}

\item{labels}{Data labels}

\item{proto_i}{Protocol, 1 = eyes open, 2 = eyes closed, this is only used
for logging and not for the evaluation}

\item{aggregateperid}{Boolean to indicate whether features were aggregated
per participant (TRUE) or not (FALSE)}
}

\value{
\item{\code{proto_i}}{same as input}
\item{\code{test.acc}}{Test set accuracy}
\item{\code{test.kappa}}{Test set Cohen's kappa coeficient}
\item{\code{test.auc}}{Test set Area under the curve}
\item{\code{test.confmatrix}}{Test set confusion matrix}
\item{\code{test.sens}}{Test set sensitivity}
\item{\code{aggregateperid}}{same as input}
}
\description{
Evaluates a model on test dataset
}
\author{
Vincent T van Hees
}
\name{clean_emotiv}
\alias{clean_emotiv}
\title{Clean emotive EEG data}
\usage{
clean_emotiv(datadir, metadatafile,  outputdir, knownerrors, protocoltimes,
referencegroup, condition_start_closed, protocolvariable, outputdir_clean,
sf=128, gyrothreshold=30, mindur=4)
}
\arguments{
\item{datadir}{data directory}

\item{metadatafile}{file with meta}

\item{outputdir}{directory where output will be stored}

\item{knownerrors}{data frame with 3 columns for the person identifier,
start time and end time corresponding to the data that needs to be ignored
Time format is minute:seconds}

\item{protocoltimes}{vector of length 3 with start times of first and 
  second experiment and end time of last experiment}

\item{condition_start_closed}{protocol label corresponding to the protocol
  where the start was with eyes closed, e.g. "closed-3min-then-open-2min"}

\item{referencegroup}{diagnosis label corresponding to the reference group, e.g. "Control"}

\item{protocolvariable}{ Name of column in metadata that indicates the 
experimental protocol, e.g. "Eyes.condition"}

\item{outputdir_clean}{ Directory for storage of cleaned data}

\item{sf}{sample frequency}

\item{gyrothreshold}{threshold for gyroscope signal above which data is considered not clean}

\item{mindur}{required minimum duration (minutes) of the EEG time series}


}
\value{
matrix with overview of how much data was available per participant id
}
\description{
Loads EEG data and writes cleaned data to an output directory
}
\examples{
\dontrun{
datafile = "C:/myfolder/example.csv"
clean_emotiv(datadir = "C:/mydatafolder", metadatafile="C:/metadata.csv",
  outputdir="C:/output", sf=128, gyrothreshold=30, mindur=4,
  knownerrors=list(1,"1:10","1:20"), protocoltimes=c(60,180,300),
  referencegroup="Control", condition_start_closed="closed-3min-then-open-2min")
}
}
\author{
Vincent T van Hees
}

\name{train_model}
\alias{train_model}
\title{Train binary classifier}
\usage{
train_model(DATtrain,LABtrain,DATval,LABval,featuredict,classifier="rf")
}
\arguments{
\item{DATtrain}{Training feature values as produced by extract_features and split 
up by split_data}

\item{LABtrain}{Training labels as derived from split_data}

\item{DATval}{Validation feature values as produced by extract_features and split
up by split_data}

\item{LABval}{Validation labels as derived from split_data}

\item{featuredict}{Dataframe with all overview of all available combinations of wavelet
types, wavelet levels, extracted signal features, and aggregation type.}

\item{classifier}{type of classification model, defaul is "rf" for random forrest.
Alternative value could be "lg" for logistic regression}
}

\value{
\item{\code{result}}{classificiation performance in the validation set for each value
of the hyperparameter}
\item{\code{best_model}}{classification model as produced by caret function train}
\item{\code{fes}}{column indices of the DAT corresponding to the features used for the best model}
}
\description{
Loads EEG data and writes cleaned data to an output directory
}
\examples{
\dontrun{
  data(data.eeg)
  data(data.labels)
  RDL = reformat_DATLAB(data.eeg,data.labels,aggregateperid=TRUE)
  DAT = RDL$DAT
  LAB = RDL$LAB
  P = split_data(LAB,DAT,logfile = logfile,proto_i=1,split=c(2,2),
                 uselog = FALSE,logdur=10)
  LABval = P$LABval;LABtest=P$LABtest;LABtrain=P$LABtrain
  DATval=P$DATval;DATtest=P$DATtest;DATtrain=P$DATtrain
  featuredict = create_featuredict(DAT)
  mymodel = train_model(DATtrain,LABtrain,DATval,LABval,featuredict,classifier="rf")
}
}
\author{
Vincent T van Hees
}
\name{create_featuredict}
\alias{create_featuredict}
\title{Creates a dictionary (dataframe) of all features in the data}
\usage{
create_featuredict(DAT)
}
\arguments{
\item{DAT}{Dataframe DAT produced by extract_features}
}

\value{
\item{\code{featuredict}}{dataframe with columns for waveletype, feature, waveletlevel and aggregation per id indicator}
}
\description{
Creates a dataframe of all features in the data with one characteristic per column
}
\author{
Vincent T van Hees
}
\name{extract_features}
\alias{extract_features}
\title{Creates a dictionary (dataframe) of all features in the data}
\usage{
extract_features(cleandatadir,filtertypes,epochlength,fn,sf=128,n.levels=7)
}
\arguments{
\item{cleandatadir}{location of the csv-files with cleaned data per person}
\item{filtertypes}{wavelet filter types as expected by the mra function from the wavelets package, e.g. c("d2","d4")}
\item{epochlength}{duration of epoch (time window) in seconds}
\item{fn}{names of features to extract from wavelets, e.g. "sd" to extract the standardard. Underlying code
includes explorative work on other features}
\item{sf}{sample frequency in Hertz}
\item{n.levels}{number of wavelet levels to extract}
}

\value{
\item{DAT}{dataframe with features}
\item{LAB}{dataframe with labels}
}
\description{
Extracts features from raw EEG data using wavelets
}
\author{
Vincent T van Hees
}
\name{data.eeg}
\alias{data.eeg}
\docType{data}
\title{
Example eeg data
}
\description{
data.eeg is an example of signal features extracted from eeg data
}
\usage{data(data.eeg)}
\format{
  The format is:
 chr "data.eeg"
}
\source{
The data was extracted as a subset from an study 
}
\examples{
data(data.eeg)
}
\keyword{datasets}