NOTES FOR GITHUB DEVELOPERS
---------------------------

The official issue tracker for Slurm is at
  https://bugs.schedmd.com/

We welcome code contributions and patches, but **we do not accept Pull Requests
through GitHub at this time.** Please submit patches as attachments to new
bugs under the "C - Contributions" severity level.

TARGET RELEASES
---------------
Changes involving adding new functionality, functional changes to the command
line tools (either in adding new options, or changing the output formats), any
RPC protocol changes or state file format modifications, and similar work is
only considered for inclusion on the master branch (which will become the next
stable Slurm release).

Bug fixes themselves are considered for inclusion on the most recent stable
release, although may be deferred to the next major release at the reviewers'
discretion.

All contributed patches are subject to review by SchedMD.

CODING GUIDELINES
-----------------
Slurm loosely follows the Linux Kernel style guidelines
(https://www.kernel.org/doc/html/latest/process/coding-style.html).
If in doubt, please follow their example.

A brief overview, with some notable exceptions:
- Tabs not spaces, tabs are 8-spaces wide.
- Lines should be less than 80-characters wide.
- Except that error message and other log messages should not be broken up
  mid-sentence. They should be split on a format sequence, comma, or period
  instead. (This is to make it easier to grep for that string in the source
  code at a later point.)
- Use K&R style for braces.
- Slurm does use typedef's for certain types, ignore Chapter 5 of the kernel
  guidelines.
- Comments can be in either C-style `/* comment */` or C++ style  `// comment`
  formats. Follow the rest of Chapter 8's recommendations for multi-line
  comments though.

BUILD SYSTEM CHANGES
--------------------
Please submit changes to `Makefile.am`, but not to `Makefile.in`. We will
regenerate those files to minimize the differences in the commit. We want to
avoid noise generated by differences in libtool installations.

Changes to `configure.ac` or `auxdir/*` will take additional time to review -
Slurm is built on a wide variety of distributions and architectures, and even
minor differences can cause unintended consequences.

PATCH SUBMISSION
----------------
An entry in `NEWS` should describe the change or new functionality.

Please break patches up into logically separate chunks, while ensuring that
each patch can still be compiled. (Anticipate that a developer using `git
bisect` may pick any intermediate commit at some point.)

If you decided to reformat a file, please submit non-functional changes
(spelling corrections, formatting discrepancies) in a separate patch. This
makes reviewing substantially easier, and allows us to focus our attention on
the functional differences.

If you make an automated change (changing a function name, fixing a pervasive
spelling mistake), please send the command/regex used to generate the changes
along with the patch, or note it in the commit message.

While not required, we encourage use of `git format-patch` to generate the
patch. This ensures the relevant author line and commit message stay attached.
Plain `diff`'d output is also okay. In either case, please attach them to the
bug for us to review. Spelling corrections or documentation improvements can be
suggested without attaching the patch as long as you describe their location.

LEGAL
-----

We ask that a contributor licensing agreement be signed for all substantial
contributions. Please see https://slurm.schedmd.com/contributor.html for
details.
slurm-helper
============

Bunch of helper files for the Slurm resource manager

Vim syntax file
---------------

The Vim syntax file renders the Slurm batch submission scripts easier to read and to spot errors in the submission options.

As submission scripts are indeed shell scripts, and all Slurm options are actually Shell comments, it can be difficult to spot errors in the options.

This syntax file allows vim to understand the Slurm option and highlight them accordingly. Whenever possible, the syntax rules check the validity of the options and put in a special color what is not recognized as a valid option, or valid parameters values.

__Installation__

Under Linux or MacOS, simply copy the file in the directory

    .vim/after/syntax/sh/

or whatever shell other than ``sh`` you prefer.

For system wide use with bash put the file in

    /etc/bash_completion.d/

The syntax file is then read and applied on a Shell script after the usual syntax file has been processed.

__Known issues__

* Some regex needed to validate options or parameter values are not exactly correct, but should work in most cases.
* Any new option unknown to the syntax file will be spotted as an error.
* On a Debian system (Ubuntu) you may see messages like...
  _get_comp_words_by_ref: command not found
  after a tab.
  Based on http://askubuntu.com/questions/33440/tab-completion-doesnt-work-for-commands you need to alter your /etc/bash.bashrc to make this work correctly.

Bash completion
---------------

The Bash completion script offers <TAB> completion for Slurm commands.

At present the following Slurm commands are considered
* scontrol
* sreport

__Instalation__

Simply source the script in your .bashrc or .profile

__Examples__

    root@frontend:~ # squeue --<tab><tab>
    --account<account_list>  --iterate<seconds>       --qos<qos_list>          --usage
    --clusters<string>       --jobs<job_id_list>      --sort<sort_list>        --user<user_list>
    --format<fmtstring>      --nodes<hostlist>        --start                  --verbose
    --help                   --noheader               --state<state_list>      --version
    --hide                   --partition<part_list>   --steps                  
    root@frontend:~ # squeue --us<tab><tab>
    --usage  --user   
    root@frontend:~ # squeue --user <tab><tab>
    user1     user2     user3     user4 
    
    root@frontend:~ # scontrol <tab><tab>
    abort          errnumstr      pidinfo        requeue        setdebugflags  update
    cluster        help           ping           requeuehold    show           verbose
    completing     hold           quit           resume         shutdown       version
    create         listpids       reboot_nodes   schedloglevel  suspend        wait_job
    delete         notify         reconfigure    script         takeover
    details        oneliner       release        setdebug       uhold

    root@frontend:~ # scontrol update <tab><tab>
    jobid=            nodename=         partitionname=    reservationname=  step=
    root@frontend:~ # scontrol update nodename=<tab><tab>
    root@frontend:~ # scontrol update nodename=node<tab><tab>
    node01  node03  node05  node07  node09  node11  node13  node15  node17  node19  
    node02  node04  node06  node08  node10  node12  node14  node16  node18  node20  
    root@frontend:~ # scontrol update nodename=node12 
    features=<features>  reason=<reason>      weight=<weight>      
    gres=<gres>          state=<state>        
    root@frontend:~ # scontrol update nodename=node12 state=<tab><tab>
    alloc       down        fail        idle        mixed       power_up    
    allocated   drain       failing     maint       power_down  resume      
    root@frontend:~ # scontrol update nodename=node12 state=resume 
    
    root@frontend:~ # squeue --format "%<TAB><TAB>
    %a(Account)        %E(dependency)     %i(id)             %M(time)           %s(selecplugin)
    %A(NTasks)         %e(end)            %I(Ncores/socket)  %N(alloc_nodes)    %t(state)
    %b(gres)           %f(features)       %j(name)           %n(reqnodes)       %T(state)
    %c(mincpu)         %G(gID)            %k(comment)        %O(contiguous)     %U(uID)
    %C(Ncpus)          %g(group)          %l(limit)          %p(priority)       %u(user)
    %d(minTmp)         %H(Nsockets)       %L(timeleft)       %r(reason)         %v(reservation)
    %D(NNodes)         %h(shared)         %m(mem)            %R(reason)         %x(excnodes)
    
Cray System Management Support Files
====================================

The files in this directory are used to configure Slurm for Cray System
Management software starting with CLE 6.0. See the
*XC Series System Administration Guide* for background information about
Cray System Management.

Configuration Generator for Cray Systems
----------------------------------------

`slurmconfgen_smw.py` is a `slurm.conf` and `gres.conf` generator for
Cray systems that runs on the System Management Workstation (SMW).
It detects system hardware and creates a simple single-partition Slurm
configuration. After generation, customize the configuration files to
your needs.

Place the generated configuration files and other Slurm configuration in
the config set directory
`/var/opt/cray/imps/config/sets/<cfgset>/files/roles/simple_sync/classes/common/etc/opt/slurm/`.
They will be copied to every node at boot time.

Ansible Play
------------

`slurm_playbook.yaml` is an ansible play which configures the XC environment
for Slurm use. Customize the play to your needs and copy it to the config set
directory `/var/opt/cray/imps/config/sets/<cfgset>/ansible/` to be run at
boot time on every node.
See the *XC Series Ansible Play Writing Guide* for more detail.
