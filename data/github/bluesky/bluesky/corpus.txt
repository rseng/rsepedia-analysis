blueski experi specif orchestr engin build statushttpsimgshieldsiogithubworkflowstatusblueskyblueskyunittestshttpsgithubcomblueskyblueskyactionsqueryworkflowaunittestsbranchamast pypihttpsimgshieldsiopypivblueskyhttpspypiorgprojectblueski condaforgehttpsimgshieldsiocondavncondaforgeblueskyhttpsanacondaorgcondaforgeblueski blueski python packag experi specif orchestr engin specifi logic experi highlevel hardwareabstract way firstclass support adapt feedback analysi acquisit data emit stream fashion standard python data structur pauseresum robust error handl rich metadata captur built blueski documentationhttpblueskyprojectioblueski blueski project enabl experiment scienc labbench facil scale collect python librari codevelop independ use may adopt la cart blueski project documentationhttpblueskyprojectio provid gener summari issu titl expect behavior your describ bug tell us happen your suggest changeimprov tell us work current behavior describ bug tell us happen instead expect behavior suggest changeimprov explain differ current behavior possibl solut obligatori suggest fixreason bug idea implement addit chang step reproduc bug provid link live exampl unambigu set step reproduc bug includ code reproduc relev context issu affect tri accomplish provid context help us come solut use real world environ includ mani relev detail environ experienc bug contribut get start make sure github accounthttpsgithubcomsignupfre submit ticket issu assum one alreadi exist clearli describ issu includ step reproduc bug make sure fill earliest version know issu fork repositori github make chang creat topic branch want base work usual master branch target releas branch certain fix must branch quickli creat topic branch base master git checkout b fixmastermy_contribut master pleas avoid work directli master branch make commit logic unit check unnecessari whitespac git diff check commit make sure commit messag proper format see make sure ad necessari test chang run _all_ test assur noth els accident broken write commit messag commit messag clear follow basic rule exampl enh add function x blueskysubmodul first line commit messag start capit acronym option list indic type commit blank line text need line shouldnt longer charact commit relat ticket indic see see ticket close similar describ motiv chang natur bug bug fix detail enhanc also good includ commit messag messag understand without look code chang standard acronym start commit messag api incompat api chang bld chang relat build numpi bug bug fix ci continu integr dep deprec someth remov deprec object dev develop tool util doc document enh enhanc mnt mainten commit refactor typo etc rev revert earlier commit sti style fix whitespac pep tst addit modif test rel relat releas pull request push fork submit pull requesthttpshelpgithubcomarticlesusingpullrequest branch start convers point your wait us like least comment pull request within three busi day typic one busi day may suggest chang improv altern hint make integr chang easi happen faster keep pull request small dont forget unit test algorithm need document dont forget rst file dont take chang request chang code person provid gener summari chang titl descript describ chang detail motiv context chang requir problem solv fix open issu pleas link issu test pleas describ detail test chang includ detail test environ test ran see chang affect area code etc screenshot appropri contribut get start make sure github account submit ticket issu assum one alreadi exist clearli describ issu includ step reproduc bug make sure fill earliest version know issu fork repositori github make chang creat topic branch want base work usual master branch target releas branch certain fix must branch quickli creat topic branch base master git checkout b fixmastermy_contribut master pleas avoid work directli master branch make commit logic unit check unnecessari whitespac git diff check commit make sure commit messag proper format see make sure ad necessari test chang run _all_ test assur noth els accident broken write commit messag commit messag clear follow basic rule exampl codeblock enh add function x blueskysubmodul first line commit messag start capit acronym option list indic type commit blank line text need line shouldnt longer charact commit relat ticket indic see see ticket close similar describ motiv chang natur bug bug fix detail enhanc also good includ commit messag messag understand without look code chang standard acronym start commit messag api incompat api chang bld chang relat build project bug bug fix ci continu integr dep deprec someth remov deprec object dev develop tool util doc document enh enhanc mnt mainten commit refactor typo etc rev revert earlier commit sti style fix whitespac pep tst addit modif test rel relat releas pull request push fork submit pull request httpshelpgithubcomarticlesusingpullrequests_ point your wait us like least comment pull request within three busi day typic one busi day may suggest chang improv altern hint make integr chang easi happen faster keep pull request small dont forget unit test featur need document dont forget rst file dont take chang request chang code person releas releas blueski make pull request ad releas note api chang document filedocssourceapi_changesrst might help review chang sinc last releas httpsdocsgithubcomengithubadministeringarepositoryreleasingprojectsongithubcomparingreleases_ changelog merg mint new releas tag codevvers titl codeblueski vversion descript copi content api_chang blueski releas pypi via github action httpsgithubcomblueskyblueskyblobmastergithubworkflowspythonpublishyml_ condaforg bot make pr updat blueskyfeedstock httpsgithubcomcondaforgeblueskyfeedstock_ interrupt runengin safe interrupt resum plan get featur free _pausing_interact paus interact note look quick refresh paus resum abort interact skip refinteractive_pause_summari runengin execut plan captur sigint ctrlc paus ctrlc twice codeblock python rescandet motor transient scan id time persist uniqu scan id aeabddabf new stream primari seq_num time motor det c defer paus request runengin paus next checkpoint paus immedi hit ctrlc next second defer paus acknowledg continu checkpoint c paus runengineinterrupt traceback recent call last ipythoninputeedfb modul rescandet motor documentsreposblueskyblueskyrun_enginepi __call__self arg metadata_kw self_interrupt rais runengineinterruptedselfpause_msg none return tupleself_run_start_uid runengineinterrupt runengin enter paus state option chang state runengin reresum resum plan reabort perform cleanup kill plan mark exit_statsabort restop perform cleanup kill plan mark exit_statussuccess rehalt emerg stop perform cleanup stop return prompt user runengin ensur motor touch stop also perform devicespecif cleanup defin devic option paus method execut later resum runengin rewind plan recent refcheckpoint checkpoint last safe place restart paus soon ctrlc paus next refcheckpoint checkpoint typic next step step scan call defer paus avoid repeat work plan resum notic time ctrlc c hit current step allow complet execut paus codeblock python rescandet motor transient scan id time persist uniqu scan id cdbbbfbffbfbdf new stream primari seq_num time motor det ca defer paus request runengin paus next checkpoint paus immedi hit ctrlc next second defer paus acknowledg continu checkpoint paus runengineinterrupt traceback recent call last ipythoninputeedfb modul rescandet motor documentsreposblueskyblueskyrun_enginepi __call__self arg metadata_kw self_interrupt rais runengineinterruptedselfpause_msg none return tupleself_run_start_uid runengineinterrupt runengin enter paus state option chang state runengin reresum resum plan reabort perform cleanup kill plan mark exit_statsabort restop perform cleanup kill plan mark exit_statussuccess rehalt emerg stop perform cleanup stop paus paus runengin hold inform might need order resum later know paus state check time codeblock python restat paus paus anyth check read move motor etc allow execut new plan current one either resum termin option resum codeblock python reresum etc depend plan may rewind safe continu ensur data collect correctli abort allow plan perform final cleanup exampl plan move motor back start posit mark data abort fact note desir later analysi data collect point save regardless paus state codeblock python reabort abort efcdcabbdb stop restop function ident reabort differ abort run mark exit_statu abort instead exit_statu success may use distinct analysi halt abort stop allow plan perform cleanup alreadi mention exampl plan move motor back start posit end situat may wish prevent plan anyth want halt immedi skip cleanup use rehalt _interactive_pause_summari summari interact interrupt execut command outcom ctrlc paus soon ctrlc twice paus paus state command outcom reresum safe resum plan reabort perform cleanup mark abort restop perform cleanup mark success rehalt perform cleanup stop restat check paus idl _suspend autom suspens also use interrupt execut automat respons condit eg shutter close beam dump temperatur exceed limit use word suspens mean unplan paus initi agent run background agent suspend monitor condit detect problem suspend execut detect condit return normal give runengin permiss resum interv oper unattend ipython verbatim rescandet motor livetablemotor det seq_num time motor det suspendingto get prompt hit ctrlc paus scan suspend plan return prompt user like paus plan stop execut new instruct rewind recent checkpoint unlik paus plan resum execut automat condit return normal take manual control suspend plan paus hit ctrlc twice given prompt condit good may manual resum use reresum _installing_suspend instal suspend blueski includ sever suspend work ophyd signal monitor condit suspend execut also possibl write suspend scratch monitor anyth well start exampl exampl suspend plan beam current dip low defin suspend instal runengin plan automat suspend beam_curr signal goe resum exce codeblock python ophyd import epicssign blueskysuspend import suspendfloor beam_curr epicssignalpv string su suspendfloorbeam_curr resume_thresh reinstall_suspendersu follow exampl beam current dip middl take second data point later recov ipython verbatim remy_scan seq_num time theta sclr_chan suspendingto get prompt hit ctrlc paus scan notic plan suspend resum resum went back last checkpoint retook second data point cleanli see api document follow link tabl suspend type option includ wait period cleanup procedur run presuspend preresum builtin suspend autosummari toctre gener nosignatur blueskysuspenderssuspendboolhigh blueskysuspenderssuspendboollow blueskysuspenderssuspendfloor blueskysuspenderssuspendceil blueskysuspenderssuspendwhenoutsideband blueskysuspenderssuspendwhenchang _checkpoint checkpoint plan specifi sequenc refmessag msg granular instruct like read set messag option includ one checkpoint messag indic place safe resum interrupt exampl checkpoint place step funcblueskyplansscan experi resum exampl sampl may melt age incorpor funcblueskyplan_stubsclear_checkpoint plan make unresum paus suspens request plan abort instead note detail checkpoint allow legal creat checkpoint middl data point creat save checkpoint implicitli creat action safe replay stage devic ad monitor ad subscript _planned_paus plan paus paus typic done refinteract pausing_interact ctrlc also incorpor plan plan paus runengin requir user type reresum continu restop similar clean stop codeblock python import blueskyplan_stub bp def pausing_plan true yield some_plan printtyp reresum go restop stop yield bpscheckpoint mark resum yield bpspaus associ runengin interfac state runengin state machin defin phase oper allow transit illustr inspect via state properti state idl runengin wait instruct run runengin execut instruct paus runengin wait user input suspenderrel method automethod blueskyrun_enginerunengineinstall_suspend noindex automethod blueskyrun_enginerunengineremove_suspend noindex automethod blueskyrun_enginerunengineclear_suspend noindex runengin also suspend properti collect currentlyinstal suspend request method method call ctrlc press paus messag process also call userdefin agent see next exampl automethod blueskyrun_enginerunenginerequest_paus noindex method use pvsuspend class also call userdefin agent automethod blueskyrun_enginerunenginerequest_suspend noindex exampl request paus asyncio event loop sinc user control prompt call rerequest_paus must plan advanc exampl paus plan second codeblock python blueskyplan_stub import null def loop_forev silli plan true yield null import asyncio loop asyncioget_event_loop request paus second loopcall_lat rerequest_paus execut plan reloop_forev five second call_lat run plan paus observ runengin paus state restat pass true rerequest_paus request defer paus experiment record interrupt analysi stage use know run interrupt experiment featur creat special event stream record time natur interrupt warn experiment featur test yet wide use might chang remov futur activ featur set codeblock python rerecord_interrupt true mode runengin emit special event descriptor open new run name field descriptor interrupt singl data key codeblock python interrupt dtype string shape none sourc runengin time runengin paus suspend resum run event document descriptor creat data payload eventdatainterrupt paus suspend resum associ time note interruptionsresum process see action tri exampl codeblock python blueskyplan import count blueskypreprocessor import pchain blueskyplan_stub import paus ophydsim import det rerecord_interrupt true repchaincountdet paus countdet print runengin paus reresum text print dump screen look special interrupt event descriptor associ event translat direct pyepic code blueski code warn section still work progress interact block rewrit blueski plan somedeviceputconfig yield mvsomedevic config motormov yield mvmotor motorvelocityput yield mvmotorveloc currentmodul blueskyplan document primari design goal blueski enabl better research record rich metadata alongsid measur data use later analysi document document term python dictionari schema organ formal specifi httpsgithubcomnslsiieventmodel_ way creat runengin plan execut metadata data gener execut plan organ document doclat section callback describ outsid function subscrib stream document visual process save section provid outlin document aim give sens structur familiar use compon _run_overview overview run document belong run loos speak dataset execut refbuiltin preassembl plan preassembled_plan like funcscan funccount creat one run note fundament scope run intent vagu flexibl one plan might gener mani run one long run depend want organ data collect time analysi time tutori reftutorial_capture_data section explor document run run start document conta metadata known start run highlight time start time plan_nam eg scan count uid uniqu id identifi run scan_id humanfriendli integ scan id necessarili uniqu docmetadata captur execut time metadata plan user event document contain actual measur data time timestamp group read seq_num sequenc number count data dictionari read like temperatur posit timestamp dictionari individu timestamp read hardwar event descriptor document provid schema data event document list key event data give use inform unit precis also contain inform configur hardwar run stop document contain metadata known end run highlight time time run complet exit_statu success abort fail everi document time creation time separ uid identifi event document also descriptor field link event descriptor metadata event descriptor run stop document run_start field link run start thu document run link back run start document detail run start start document mark begin run compris everyth know start take data includ metadata provid user plan docnext section metadata builtin plan provid use metadata like name detector motor use userdefin plan may also see refthi section tutorial_plan_metadata tutori command codeblock python blueskyplan import scan ophydsim import det motor simul detector motor scan motor step take read det rescandet motor purposecalibr samplekryptonit gener start document like codeblock python start document purpos calibr sampl kryptonit detector det motor motor plan_nam scan plan_typ gener plan_arg detector det motor mover num start stop scan_id time uid randomlygener uniqu id note time given unix time second sinc softwar look data would cours translat humanread form event event record one measur associ time codeblock python event document data temperatur x_setpoint x_readback timestamp temperatur x_setpoint x_readback time seq_num uid randomlygener uniqu id descriptor refer descriptor document data analysi perspect read simultan actual occur separ time separ time individu read thrown away record timestamp overal event time often use run stop stop document mark end run contain metadata known run complet commonli use field time exit_statu codeblock python stop document exit_statu success fail abort reason runengin provid reason failur time uid randomlygener uniqu id start refer start document num_ev primari event descriptor state descriptor document provid schema data event document provid use inform key data configur hardwar layout descriptor detail take time cover defer doclat section event_descriptor currentmodul blueskyplan asynchron acquisit section encompass fli scan monitor gener handl data acquisit occur differ rate note want move two motor someth categori your luck dont need anyth complex present section read multidimension plan section docplan short fli acquisit high rate monitor acquisit irregular slow rate monitor guarante read captur ie monitor lossi suscept network glitch fli contract lossi correctli implement fli mean let hardwar take control cach data extern transfer data runengin end essenti data acquisit rate faster runengin python go note point refer runengin process messag rate ks includ time ad whatev messag codeblock python timeit remsgnul j rang loop best ms per loop monitor mean acquir read whenev new read avail devic natur updat rate exampl might monitor background condit eg beam current side execut primari logic plan document gener real time end like fli updat rate high monitor slow execut plan mention monitor also lossi network traffic high read may miss fli blueski view three step fli devic scan kickoff begin accumul data kickoff command complet acquisit success start complet step tell devic readi whenev readi devic collect told stop report readi immedi devic execut predetermin trajectori finish report readi collect final data accumul devic transfer runengin process like data fli one flyabl devic plan blueski provid preprocessor preprocessor avail wrapper funcfly_during_wrapp codeblock python ophydsim import det flyer flyer simul hardwar blueskyplan import count blueskypreprocessor import fly_during_wrapp refly_during_wrappercountdet num flyer flyer decor funcfly_during_decor codeblock python ophydsim import det flyer flyer simul hardwar blueskyplan import count blueskypreprocessor import fly_during_wrapp defin new plan futur use fly_and_count fly_during_decoratorfly flyercount refly_and_countdet altern use refsupplemental_data simpli append extend list flyer kick everi run codeblock python ophydsim import flyer flyer assum sd instanc supplementaldata set descript document link sdflyersextendfly flyer includ plan remov _async_monitor monitor monitor devic plan blueski provid preprocessor preprocessor avail wrapper funcmonitor_during_wrapp codeblock python ophydsim import det det blueskyplan import count blueskypreprocessor import monitor_during_wrapp record updat det count det time remonitor_during_wrappercountdet num det decor funcmonitor_during_decor codeblock python ophydsim import det det blueskyplan import count blueskypreprocessor import monitor_during_wrapp defin new plan futur use monitor_and_count monitor_during_decoratordetcount remonitor_and_countdet altern use refsupplemental_data simpli append extend list signal monitor codeblock python ophydsim import det assum sd instanc supplementaldata set descript document link sdmonitorsappenddet includ plan remov live visual process ipython python suppress okwarn blueski import runengin runengin _callback overview callback runengin execut plan organ metadata data document python dictionari organ docspecifi flexibl document way time new document creat runengin pass list function function anyth store data disk print line text screen add point plot even transfer data cluster immedi process function call callback subscrib callback live stream document come runengin think callback selfaddress stamp envelop tell runengin creat document send function process callback function run block fashion data acquisit continu return light task like simpl plot critic task like send data longterm storag medium behavior desir easi debug guarante critic error notic immedi heavi comput task anyth take second finish execut separ process server hold data acquisit blueski provid nice tool use case see refzmq_callback simplest work exampl exampl pass everi document print function print document gener data collect codeblock python blueskyplan import count ophydsim import det recountdet print print function blunt instrument dump much inform screen see reflivet livet refin option way invok callback interact simpl exampl pass second argument runengin callback function cb usag codeblock python replan cb work exampl codeblock python ophydsim import det motor blueskyplan import scan blueskycallback import livet det det rescandet motor livetabledet list callback cb cb also accept see reffilt addit option persist runengin keep list callback appli everi plan execut exampl callback save data databas typic invok way callback function cb usag codeblock python resubscribecb step usual perform startup file ie ipython profil automethod blueskyrun_enginerunenginesubscrib noindex automethod blueskyrun_enginerunengineunsubscrib noindex _subs_decor plan use subs_decor refplan preprocessor preprocessor attach callback plan subscrib everi time run exampl defin new plan plan add callback cb exist plan plan codeblock python blueskypreprocessor import subs_decor subs_decoratorcb def plan yield plan equival codeblock python plan subs_decoratorcbplan exampl defin variant scan includ tabl default codeblock python blueskyplan import scan blueskypreprocessor import subs_decor def my_scandetector motor start stop num per_stepnon mdnone plan take argument scan tabl livetablemotor listdetector subs_decoratort def inner yield scandetector motor start stop num per_stepper_step mdmd yield inner callback visual fit _livet livet data point collect ie event document gener row ad tabl demo ipython python blueskyplan import scan ophydsim import motor det blueskycallback import livet rescandet motor livetablemotor det pass empti list column show simpli time seq_num sequenc number codeblock python livet demo pass list devic like codeblock python livetablemotor intern livet obtain name field produc read motor ipython python listmotordescribekey gener case devic produc ten even hundr separ read use spell specif field rather whole devic codeblock python field motor quot devic motor livetablemotor fact almost callback includ refliveplot requir specif field accept devic may one field autoclass blueskycallbackslivet warn data tabl format accord type precis report control system see mani decim place adjust control system level epic typic prec field record _kicker asid make plot updat live note user work preconfigur setup probabl skip come back plot appear updat configur typic perform ipython profil startup script happen automat startup time make plot liveupd runengin execut plan run command ipython termin command codeblock python matplotlib qt blueskyutil import install_qt_kick install_qt_kick use jupyt notebook command codeblock python matplotlib notebook blueskyutil import install_nb_kick install_nb_kick runengin matplotlib technic matplotlib qt backend use event loop runengin take control event loop execut plan kicker function period kick qt event loop plot redraw runengin run matplotlib command standard setup noth blueski particular see relev section ipython document httpsipythonreadthedocsioenstableinteractivemagicshtmlhighlightmatplotlibmagicmatplotlib_ detail autofunct blueskyutilsinstall_kick autofunct blueskyutilsinstall_qt_kick autofunct blueskyutilsinstall_nb_kick _liveplot liveplot scalar data plot scalar exampl codeblock python blueskyplan import scan ophydsim import det motor blueskycallbacksmpl_plot import liveplot rescandet motor liveplotdet motor plot blueski import runengin blueskyplan import scan ophydsim import det motor blueskycallbacksmpl_plot import liveplot runengin rescandet motor liveplotdet motor custom style pass matplotlib line style keyword argument httpmatplotliborgapilines_apihtmlmodulematplotliblines_ liveplot pass axesplot exampl codeblock python rescandet motor liveplotdet motor markerx markers color plot blueski import runengin blueskyplan import scan ophydsim import det motor blueskycallbacksmpl_plot import liveplot runengin rescandet motor liveplotdet motor markerx markers color autoclass blueskycallbacksmpl_plottingliveplot live imag autoclass blueskycallbacksbrokerliveimag _liverast livegrid grid heat map plot scalar valu function two variabl regular grid exampl codeblock python blueskyplan import grid_scan ophydsim import det motor motor blueskycallbacksmpl_plot import livegrid regrid_scandet motor motor fals livegrid det plot blueski import runengin blueskyplan import grid_scan ophydsim import det motor motor blueskycallbacksmpl_plot import livegrid motordelay motordelay runengin regrid_scandet motor motor fals livegrid det autoclass blueskycallbacksmpl_plottinglivegrid livescatt scatter heat map plot scalar valu function two variabl unlik classblueskycallbacksmpl_plottinglivegrid assum regular grid exampl codeblock python blueskyplan import grid_scan ophydsim import det jittery_motor jittery_motor blueskycallbacksmpl_plot import livescatt jitteri exampl motor wont go exactli told go regrid_scandet jittery_motor jittery_motor fals livescatterjittery_motor jittery_motor det xlim ylim plot blueski import runengin blueskyplan import grid_scan ophydsim import det jittery_motor jittery_motor blueskycallbacksmpl_plot import livescatt runengin regrid_scandet jittery_motor jittery_motor fals livescatterjittery_motor jittery_motor det xlim ylim autoclass blueskycallbacksmpl_plottinglivescatt livefit perform nonlinear least squar best fit data userdefin model function function depend number independ variabl integr packag lmfit httpslmfitgithubiolmfitpymodelhtml_ provid nice interfac nl minim exampl fit gaussian detector read function motor posit first defin gaussian function creat lmfitmodel provid initi guess paramet codeblock python import numpi np import lmfit def gaussianx sigma x return anpexpx x sigma model lmfitmodelgaussian init_guess sigma lmfitparametersigma min x guess given plain number lmfitparamet object case sigma specifi constraint integr blueski need provid field depend variabl exampl noisy_det map name independ variabl function x correspond field data motor initi guess expect model defin codeblock python blueskyplan import scan ophydsim import motor noisy_det blueskycallback import livefit lf livefitmodel noisy_det x motor init_guess rescannoisy_det motor lf bestfit valu sigma x lfresultvalu fit result access result attribut callback exampl center gaussian lfresultvaluesx could use next step like codeblock python x lfresultvaluesx rescannoisy_det x x refer lmfit document httpslmfitgithubiolmfitpymodelhtmlthemodelresultclass_ result exampl use model two independ variabl x codeblock python ophydsim import motor motor det def gaussianx sigma x return anpexpx x sigma specifi name independ variabl model model lmfitmodelgaussian x init_guess sigma lmfitparametersigma min x lf livefitmodel det x motor motor init_guess scan mesh regrid_scandet motor motor fals lf default fit recomput everi time new data point avail see api document option fit commenc number accumul data point equal number free paramet model autoclass blueskycallbackslivefit livefitplot variat liveplot plot best fit curv livefit appli model function repeat exampl livefit ad plot codeblock python import numpi np import lmfit blueskyplan import scan ophydsim import motor noisy_det blueskycallback import livefit def gaussianx sigma x return anpexpx x sigma model lmfitmodelgaussian init_guess sigma lmfitparametersigma min x lf livefitmodel noisy_det x motor init_guess add plot blueskycallbacksmpl_plot import livefitplot lpf livefitplotlf colorr rescannoisy_det motor lfp notic didnt need subscrib lf directli lfp result lfresult plot import numpi np import lmfit blueskyplan import scan ophydsim import motor noisy_det blueskycallback import livefit blueskycallbacksmpl_plot import livefitplot blueski import runengin runengin def gaussianx sigma x return anpexpx x sigma model lmfitmodelgaussian init_guess sigma lmfitparametersigma min x lf livefitmodel noisy_det x motor init_guess lfp livefitplotlf colorr rescannoisy_det motor lfp use standard liveplot show data axe notic style independ codeblock python import matplotlibpyplot plt fig ax pltsubplot explitli creat figur axe use lfp livefitplotlf axax colorr lp liveplotnoisy_det motor axax markero linestylenon rescannoisy_det motor lp lfp plot import numpi np import lmfit blueskyplan import scan ophydsim import motor noisy_det blueskycallback import livefit blueskycallbacksmpl_plot import liveplot livefitplot blueski import runengin runengin def gaussianx sigma x return anpexpx x sigma model lmfitmodelgaussian init_guess sigma lmfitparametersigma min x import matplotlibpyplot plt fig ax pltsubplot lf livefitmodel noisy_det x motor init_guess lfp livefitplotlf axax colorr lp liveplotnoisy_det motor axax markero linestylenon rescannoisy_det motor lfp lp pltdraw autoclass blueskycallbacksmpl_plottinglivefitplot peakstat comput statist peaklik data exampl codeblock python blueskycallbacksfit import peakstat ophydsim import motor det blueskyplan import scan ps peakstatsmotor det rescandet motor ps attribut ps document contain variou peak statist also conveni function plot codeblock python blueskycallbacksmpl_plot import plot_peak_stat plot_peak_statsp plot blueski import runengin blueskycallbacksfit import peakstat blueskycallbacksmpl_plot import plot_peak_stat ophydsim import motor det blueskyplan import scan runengin ps peakstatsmotor det rescandet motor ps plot_peak_statsp autoclass blueskycallbacksfittingpeakstat autofunct blueskycallbacksmpl_plottingplot_peak_stat _best_effort_callback besteffort callback warn new experiment featur like chang futur releas way backwardcompat meant perman subscrib runengin like codeblock python onetim configur blueskycallbacksbest_effort import besteffortcallback bec besteffortcallback resubscribebec provid besteffort plot visual plan use hint key provid plan present see sourc code plan modblueskyplan exampl ipython python suppress blueskycallbacksbest_effort import besteffortcallback bec besteffortcallback resubscribebec ipython python ophydsim import det det blueskyplan import scan det det det rescandet motor automat print tabl show plot plot blueski import runengin blueskyplan import scan ophydsim import det motor blueskycallbacksbest_effort import besteffortcallback runengin bec besteffortcallback resubscribebec rescandet motor use method toggl part function currentmodul blueskycallbacksbest_effort autosummari toctre gener besteffortcallback besteffortcallbackenable_head besteffortcallbackdisable_head besteffortcallbackenable_t besteffortcallbackdisable_t besteffortcallbackenable_baselin besteffortcallbackdisable_baselin besteffortcallbackenable_plot besteffortcallbackdisable_plot blacklist plot certain stream use becnoplot_stream attribut list stream name blacklist set baselin default attribut becoverplot use control whether line plot subsequ run plot axe true default overplot occur name axe one plot next peak stat plot simpl peakfit perform background cours may may applic depend data shown default view fit annot plot click plot area press shiftp lowercas p shortcut pan plot access peakfit statist programmat use becpeak _hint hint besteffort callback aim print plot use inform without overwhelmingli comprehens use improv tune hint attribut devic avail hint metadata inject plan avail either avail besteffort callback still make best effort display someth use content hint affect data save content affect display automat besteffort callback tool opt look hint addit callback may still set live postfacto visual process specif thing without reli hint hint attribut properti devic dictionari key field map list field movabl devic motor temperatur control field expect compris independ axe devic motor read field x x_setpoint might provid hint field x indic one independ axi field x best represent valu readabl devic might report mani field like chan chan chan chan chan perhap coupl usual interest use hint might narrow field chan chan besteffort plot display overwhelm amount inform hint provid devic read runengin collat docev descriptor document event_descriptor plan gener know devic use depend independ variabl ie scan may provid inform via hint metadata key inject start document along rest metadata exampl codeblock python pattern dimens field stream_nam field stream_nam scan time dimens time primari onedimension scan dimens motorhintsfield primari twodimension scan dimens x_motorhintsfield primari y_motorhintsfield primari ndimension scan dimens motorhintsfield primari motor motor possibl adjust hint interact gener intend set startup file err side display inform need see rare need adjust plan may also hint data sampl regular rectangular grid via hint grid rectilinear use exampl decid whether visual data livegrid livescatt _export callback export export imag data tiff file first compos filenam templat templat includ metadata event data scan codeblock python templat includ scan id sequenc number filenam templat output_dirstartscan_id_eventseq_numtiff templat sort file directori base user scan id templat output_dirstartuserstartscan_ideventseq_numtiff complex templat includ actual measur filenam templat output_dirstartscan_id_startsample_name_ eventdatatemperature_eventseq_numtiff use python languag featur call format string notic insid curli bracket dont use quot around key name eventseq_num eventseq_num imag data point actual stack imag plane templat must also includ count imag plane stack note metadata come start document henc startscan_id review docdocu section detail creat callback export tiff use templat codeblock python blueskycallbacksbrok import livetiffexport export livetiffexporterimag templat final export imag run finish run wrap export post_run subscrib codeblock python blueskycallbacksbrok import post_run resubscribepost_runexport also possibl write tiff live henc name livetiffexport import disadvantag subscript process progress experi may intermitt slow data written disk circumst affect time experi may accept codeblock python resubscribeexport configur option avail given detail recommend use expens callback separ process autoclass blueskycallbacksbrokerlivetiffexport export data metadata hdf file stop document emit end everi run subscrib use cue load dataset via databrok export hdf file use suitcas httpsnslsiigithubiosuitcase_ work exampl codeblock python databrok import databrok db import suitcas def suitcase_as_callbacknam doc name stop return run_start_uid docrun_start header dbrun_start_uid filenam hformatrun_start_uid suitcaseexporthead filenam resubscribesuitcase_as_callback stop export metadata olog olog httpologgithubiosnapshot_ oper log electron logbook use callback automat gener log entri begin run python interfac olog straightforward boilerpl codeblock python functool import partial pyolog import simpleologcli blueskycallbacksolog import logbook_cb_factori set logbook configur blueski summari data acquisit scan type id etc logbook data acquisit list logbook name publish simple_olog_cli simpleologcli generic_logbook_func simple_olog_clientlog configured_logbook_func partialgeneric_logbook_func logbookslogbook cb logbook_cb_factoryconfigured_logbook_func resubscribecb start modul blueskycallbacksolog includ templat format data start document readabl log entri also write custom templat pass logbook_cb_factori may specifi custom templat simpl exampl see sourc code httpsgithubcomnslsiiblueskyblobmasterblueskycallbacksologpy_ complex exampl default templat codeblock python custom_templ log entri startplan_nam detector startdetector boilerpl set configured_logbook_func cb logbook_cb_factoryconfigured_logbook_func desc_templatecustom_templ may also specifi varieti differ templat suitabl differ kind plan callback use plan_nam field determin templat use codeblock python templat count plan motor count_templ plan name startplan_nam detector startdetector templat plan motor scan_templ plan name startplan_nam detector startdetector motor startmotor templat count count_templ scan scan_templ rel_scan scan_templ boilerpl set configured_logbook_func cb logbook_cb_factoryconfigured_logbook_func desc_dispatchtempl autofunct blueskycallbacksologlogbook_cb_factori verifi data save follow verifi document extern file run save disk access databrok print messag indic success failur note data collect machin abl access machin extern data save indic failur fals alarm codeblock python blueskycallbacksbrok import post_run verify_files_sav resubscribepost_runverify_files_sav _debugging_callback ignor callback except except rais process callback error interrupt data collect sometim good exampl callback save data encount error want know immedi rather continu think collect data fact lost mani situat visual firstpass data process usual better data collect proceed even callback fail decor may use wrap callback error encount convert log messag autofunct blueskycallbackscoremake_callback_saf autofunct blueskycallbackscoremake_class_saf also possibl configur runengin ignor callback except global featur recommend codeblock python reignore_callback_except fals versionchang blueski version septemb default valu chang true fals _filter filter document type four subscript callback receiv document start stop event descriptor addit subscript command codeblock python replan cb shorthand normal cb receiv certain document specifi document rout explicitli exampl codeblock python replan start cb replan cb cb start cb subs_decor present accept varieti input write custom callback function accept python dictionari argument use callback refer simpl exampl get start two simpl custom callback simpl exampl illustr concept usag first defin function take two argument name document type start stop event descriptor document dictionari callback ipython python def print_datanam doc printmeasur docdata tell runengin call function event document set subscript ipython python ophydsim import det blueskyplan import count recountdet event print_data time runengin gener new event document ie data point print_data call five kind subscript match four kind document plu subscript receiv document start descriptor event stop use stop subscript trigger automat endofrun activ exampl codeblock python def celebratenam doc noth input use signal run printth run finish let use print_data celebr codeblock python replan event print_data stop celebr use multipl document type task use one document type often need use one exampl livet use start kick creation fresh tabl use event see data use stop draw bottom border conveni pattern kind subscript class method document type codeblock python blueskycallback import callbackbas class mycallbackcallbackbas def startself doc printi got new start document someth def descriptorself doc printi got new descriptor document someth def eventself doc printi got new event document someth def stopself doc printi got new stop document someth base class callbackbas take care dispatch document correspond method applic need four may simpl omit method arent requir _zmq_callback subscript separ process host mq subscript process scan possibl slow data collect mitig make subscript run separ process main process runengin execut plan publish creat subscrib runengin serial document receiv send socket mq proxi rebroadcast document number process machin network process machin set remotedispatch connect proxi receiv document run callback would run local runengin process multipl publish runengin send document proxi remotedispatch filter document stream base byte prefix minim exampl start mq proxi use cli packag blueski requir two port argument codeblock bash blueskymqproxi altern start proxi use python api codeblock python blueskycallbackszmq import proxi proxi proxi proxystart start callback receiv document proxi simpl exampl print codeblock python blueskycallbackszmq import remotedispatch remotedispatcherlocalhost dsubscribeprint done subscrib thing readi use dstart run event loop forev describ kickers_ want use liveupd plot need instal kicker need instal event loop use remotedispatch like must done call dstart codeblock python blueskyutil import install_qt_kick install_qt_kickerloopdloop jupyt notebook replac install_qt_kick install_nb_kick machineprocess want collect data hook subscript publish document proxi codeblock python creat runengin instanc cours use exist one blueski import runengin msg runengin blueskycallbackszmq import publish publish publisherlocalhost resubscribepublish final execut plan runengin result callback remotedispatch print document gener plan publish remotedispatch api autoclass blueskycallbackszmqproxi autoclass blueskycallbackszmqpublish autoclass blueskycallbackszmqremotedispatch secondari event stream certain applic may desir interpret event document creat instead wait reach offlin storag order keep inform complet quarantin raw data classlivedispatch present complet uniqu stream subscrib use syntax runengin major applic classlivedispatch expect subclass creat implement onlin analysi secondari event stream display save offlin use callback would use display raw data exampl use streamz httpsstreamzreadthedocsioenlatest_ librari averag number event togeth callback configur look start document metadata initi time event receiv store streamz network new averag event emit correct number event cach import thing note analysi handl creat new data key descriptor sequenc number event id handl base livedispatch class codeblock python class averagestreamlivedispatch stream averag data point togeth def __init__self nnone selfn n selfin_nod none selfout_nod none selfaverag none super__init__ def startself doc creat stream see start document callback look averag key start document configur grab averag key selfn docgetaverag selfn defin node selfin_nod selfin_nod streamzsourcestream_nameinput selfaverag selfin_nodepartitionselfn def average_eventscach average_evt dict desc_id cachedescriptor check event came configur alldesc_id evtdescriptor evt cach rais exceptionth event bundl differ configur use last descriptor avoid string object data_key selfraw_descriptorsdesc_iddata_key key info data_keysitem inform nonnumb field drop infodtyp number array averag togeth average_evtkey npmeanevtdatakey evt cach axi return data average_evt descriptor desc_id selfout_nod selfaveragermapaverage_ev selfout_nodesinkselfprocess_ev superstartdoc def eventself doc send event stream selfin_nodeemitdoc def stopself doc delet stream run stop selfin_nod none selfout_nod none selfaverag none superstopdoc livedispatch api autoclass blueskycallbacksstreamlivedispatch member blueski interfac hardwar _hardware_interfac overview blueski interact hardwar highlevel abstract leav lowlevel detail commun separ concern blueski view devic sens detector read subset devic position also set ie written move short devic repres python object attribut method certain establish name taken pain make interfac slim possibl still gener enough address everi kind hardwar encount specif _status_obj_api statu object interfac statu object runengin use asynchron monitor compelet trigger set devic autoclass blueskyprotocolsstatu member undocmemb success fals statu mark done taken mean given exampl motor stuck never get go failedstatu except rais insid runengin addit statu object may option add watch function conform follow definit method watchfunc subscrib notif progress use progress bar paramet func callabl expect accept keyword argument name current initi target unit precis fraction time_elaps time_remain given call func may includ subset paramet depend statu object know progress fraction argument accept singl float repres fraction remain fraction zero indic complet fraction one indic progress start readabl devic interfac readabl devic autoclass blueskyprotocolsread member undocmemb movabl settabl devic interfac movabl devic extend interfac readabl devic follow addit method attribut autoclass blueskyprotocolsmov member showinherit attribut posit heurist describ current posit devic singl scalar oppos potenti multivalu descript provid read option blueski use posit attribut part ecosystem might develop encourag implement attribut possibl flyer interfac context mean flyer refer section docasync interfac flyabl devic separ interfac readabl settabl devic though overlap autoclass blueskyprotocolsfly member undocmemb option interfac addit interfac provid option behavior readabl movabl flyabl devic method describ either hook variou plansrunengin messag ignor present requir subset runengin messag latter case runengin may error tri use devic defin requir method autoclass blueskyprotocolsstag member autoclass blueskyprotocolssubscrib member autoclass blueskyprotocolspaus member autoclass blueskyprotocolsstopp member autoclass blueskyprotocolscheck member autoclass blueskyprotocolshint member implement real hardwar ophyd httpsnslsiigithubioophyd_ packag implement interfac wide varieti hardwar commun use epic httpwwwapsanlgovepics_ via python bind pyepic httpcarsuchicagoedusoftwarepythonpyepics_oth control system tango labview etc could integr blueski futur implement interfac simul hardwar toy test implement interfac includ modophydsim modul implement act simul hardwar use extens exampl demo test suit also use exercis analysi workflow run real experi api document _msg messag protocol note technic document optim user readabl overview plan sequenc atom oper describ data acquisit procedur oper repres blueskymsg messag object plan may implement simpl list messag codeblock python blueski import msg behold bore data acquisit ever conduct plan msgopen_run msgclose_run gener yield messag one time codeblock python def plan yield msgopen_run yield msgclose_run exampl equival sophist use second one power incorpor loop condit adapt logic gener python code crucial plan code must commun hardwar never put epicscaput plan rather oper repres msg object describ done make safe introspect plan errorcheck simul visual purpos without touch real hardwar exampl could print messag plan like codeblock python plan msgopen_run msgclose_run simpl plan simul msg plan printmsg msg five member access attribut command obj arg kwarg run command must one control list command obj object ie devic appli command applic arg kwarg argument command run userdefin run key run key use run engin associ messag one open run manag state open run rout run data separ set callback see document multirun plan execut plan docrunengin run_engin consum one messag time codeblock python def very_simple_run_engineplan msg plan process msg runengin registri use dispatch msg object base valu msgcommand exampl runengin receiv messag msgset motor runengin identifi command messag set look set command registri find map runengine_set pass msgset motor _set method insid _set call motorset actual commun hardwar occur updat intern cach use later exampl keep track fact motor may motion stop safe error occur illustr anoth import reason plan must alway yield messag interact hardwar absolut never commun hardwar directli call epicscaput insid plan prevent runengin know thu circumv facil put devic safe state event unexpect exit error standard set command regist default convent msg command name map coroutin method runengin name _name set runengine_set exampl user regist coroutin add custom command though rare necessari command involv commun hardwar exampl msgsleep none caus runengin sleep second none placehold object devic applic sleep command plan never commun hardwar directli also never employ long block call like timesleep instead sleep command map runengine_sleep integr runengin event loop sleep nonblock way allow runengin stay respons meantim watch user interrupt possibl collect data asynchron background command use control metadata io exampl msgopen_run msgclose_run delin scope one run keyword argument pass open_run messag interpret metadata encod runstart document follow comprehens overview builtin command _command command warn section document incomplet built command deepli tie state runengin instanc creat command tell run engin start collect result read creat event call twice without save drop except one open event go time reli heavili intern state run engin overridden user call return none back coroutin ignor part msg except command save pair creat bundl caus event document emit must call creat scan die rais illegalmessagesequ reli heavili intern state run engin mess call return none back coroutin ignor part msg except command read caus read call obj messag msgobjreadmsgarg msgkwarg anyth read creat save bundl singl event reli heavili intern state run engin mess return dictionari return read coroutin arg kwarg part messag pass read method null null messag ignor run engin exist make algebra work return none coroutin ignor valu msg except command set tell mover object move current mimic epicslik logic immedi motion stage unstag instruct runengin stageunstag object call objstageobjunstag expect messag object msgstage object msgunstag object result call staged_devic objectstag unstaged_devic objectunstag staged_devicesunstaged_devic list ophyddevic unstag statu object one may wonder return list devic oppos statu object set similar msg debat awhil oper perform stage suppos involv twiddl configur happen fast stage involv lengthi set call list object stage stage devic caus devic compon devic also stage children ad list along self return devicestag plan keep track stage like devices_stag yield msgstage devic would plan want know need avoid accident tri stage someth twice stage parent tri also stage child import avoid stage someth redundantli rais error trigger call objtrigg method cach return statu object cach return statu object sleep sleep event loop wait block progress everi object trigger set keyword argument groupgroup done expect messag object msgwait groupgroup group hashabl key wait_for instruct runengin wait asynciofutur object done allow extern arbitrari control runengin ex asynciofutur import futur futur futur futuredon give fals remsgwait_for lambda futur set futur done futureset_result futuredon give true input process input allow user input run exampl msginput none msginput none prompt custom prompt checkpoint instruct runengin creat checkpoint rewind point necessari clear_checkpoint clear set checkpoint rewind paus request run engin paus expect messag object msgpaus deferfals namenon callbacknon kickoff start flyscan object collect collect data cach flyer emit descriptor event document call objcollect method complet tell flyer stop collect whenev readi call method objcomplet given object flyer return statu object flyer respond command stop collect return finish statu object immedi flyer finish given cours finish whenev finish irrespect command issu configur configur object expect messag object msgconfigur object arg kwarg result call objectconfigurearg kwarg subscrib add subscript run start like subscript pass __call__ remov end runengin expect messag object msgsubscrib none callback_funct document_nam document_nam one start descriptor event stop callback_funct expect signatur fname document name one document_nam option document one document dictionari event model see docstr blueskyrun_enginedispatchersubscrib inform unsubscrib remov subscript call use multirun call subscript want run other expect messag object msgunsubscrib none token msgunsubscrib tokentoken token return valu runengine_subscrib open_run instruct runengin start new run expect messag object msgopen_run none kwarg kwarg addit metadata go runstart document close_run instruct runengin write runstop document expect messag object msgclose_run none exit_statusnon reasonnon exit_stat reason provid use valu stash drop drop bundl read without emit complet event document command abandon previou creat read command without emit event use drop known bad event eg beam keep event document stream clean safe start anoth creat read save sequenc drop must call creat scan die rais illegalmessagesequ call return none back coroutin ignor part msg except command monitor monitor signal emit event document asynchron descriptor document emit immedi closur defin emit event document associ descriptor separ thread process relat main bundl process createreadsav expect messag object msgmonitor obj kwarg msgmonitor obj nameeventstreamnam kwarg kwarg pass objsubscrib unmonitor stop monitor ie remov callback emit event document expect messag object msgunmonitor obj stop stop devic expect messag object msgstop obj amount call objstop regist custom command runengin taught new command regist use follow method automethod blueskyrun_enginerunengineregister_command noindex automethod blueskyrun_enginerunengineunregister_command noindex autoattribut blueskyrun_enginerunenginecommand noindex automethod blueskyrun_enginerunengineprint_command_registri noindex progress bar blueski provid progress bar addon exampl two motor move simulat make display like codeblock none mtr sdeg mtr sdeg display includ name devic motor temperatur control etc distanc degre etc travel far total distanc cover time elaps estim time remain rate determin empir progress bar reli devic report progress devic provid comprehens inform simpler progress bar shown list name devic wait report complet codeblock none mtr progress bar avail mtr complet time runengin wait hardwar progress bar notifi includ exampl wait motor move wait detector trigger blueski jargon progress bar notifi time runengin process wait command progress bar set default must attach runengin need done say startup file codeblock python blueskyutil import progressbarmanag rewaiting_hook progressbarmanag motion quick worth display progress bar default progress bar drawn second action complet progress bar never shown choos shorter longer delaysay secondsus paramet progressbarmanagerdelay_draw technic detail commun devic runengin progressbarmanag read watch method refstatus_obj_api waiting_hook docrun_engine_api implement progress bar make use tqdm httpsgithubcomtqdmtqdm_ love python packag make progress bar iter releas histori v fix chang use safeconfigpars configpars versioneerpi fix support python enhanc ad public call_returns_result properti implement humanread printabl represent peakstat document updat runengin docstr call_returns_result properti fix small mistak bpscan docstr ad document intend behavior fraction watch method statu object v fix fix python propag loop kwarg correctli enhanc ad option calcul deriv statist min max fwhm etc peakstat besteffortcallback ad readonli properti runenginedeferred_pause_request may use blueskyqueueserv httpsgithubcomblueskyblueskyqueueserver_ document unpin sphinx_rtd_them v fix updat test use databrokertemp instead sqlite databrok xfail test use remov api fix list_grid_scan metadata plan_pattern_arg fix descriptor flyer implement read_configur enhanc pass loop kwarg runengin runbundl runengin __call__ may return plan valu toggl new call_returns_result flag default behavior chang may chang futur releas ad enabl support python ad test matrix document updat toc link blueskyprojectio ad releas instruct fill readmemd ad descript long_descript field setuppi v fix fix miss log output cli zmq proxi depreci argument logfil funcblueskycommandlinezmq_proxystart_dispatch better behavior zmq remotedispatch receiv malform messag enhanc reorgan util subpackag api chang ad classblueskyutilsjupyternotebookprogressbar classblueskyutilspersistentdict inherit classcollectionsabcmutablemap new modul modblueskyprotocol design type check devic see pep v fix tweak layout plot produc besteffort callback show mani livegrid funcblueskysimulatorscheck_limit simul call objcheck_valu instead look objlimit document emit runengin log messag alway issu previous resourc datum document miss variou docstr fix match actual function signatur util funcblueskyutilsis_mov check object satifi expect interfac movabl object correctli treat stop method posit attribut option document expect interfac movabl object incomplet revis match realiti v fix classblueskyutilspersistentdict new method methblueskyutilspersistentdictreload methblueskyutilspersistentdictflush sync disk flush garbag collect system exit ensur valu mutat updat disk v fix livegrid livescatt fail updat enhanc expand class object consid moveabl includ expect attribut defin instanc attribut v fix allow use keynam still format livet address use loop argument deprec python ensur blueskyutil import background thread creat instanc blueskyutilsdefaultduringtask import time v fix incorrect implement funcblueskybundlersrunbundlercollect correct v fix miss implement detail funcblueskybundlersrunbundlercollect ad v ad plan funcblueskyplansgrid_scan funcblueskyplansrel_grid_scan accept new snake_ax paramet match funcblueskyplanslist_grid_scan funcblueskyplansrel_list_grid_scan use control axe follow backandforth snakelik trajectori code python default snake disabl grid_scanhwdet hwmotor hwmotor hwmotor snake explicit disabl grid_scanhwdet hwmotor hwmotor hwmotor snake_axesfals snake also disabl provid empti list motor grid_scanhwdet hwmotor hwmotor hwmotor snake_ax snake enabl motor except slowest hwmotor grid_scanhwdet hwmotor hwmotor hwmotor snake_axestru snake enabl hwmotor grid_scanhwdet hwmotor hwmotor hwmotor snake_axeshwmotor snake enabl hwmotor hwmotor grid_scanhwdet hwmotor hwmotor hwmotor snake_axeshwmotor hwmotor old harder read way specifi snake paramet interleav paramet still support backwardcompat code python grid_scanhwdet hwmotor hwmotor true hwmotor fals two stylesinterleav paramet vs new snake_ax parametercannot mix mix caus valueerror rais fix fix regress v accident broke usag per_step paramet scan plan funcblueskyplansfli return none mistak return run start uid plan modul v import chang releas complet rework blueski interact asyncio event loop resolv longrun issu blueski incompat tornado often trip user context use blueski jupyt notebook sever new featur fix includ new plan help error messag enumer event loop refactor previous classblueskyrun_enginerunengin repeatedli start stop asyncio event loop methblueskyrun_enginerunengine__call__ methblueskyrun_enginerunenginerequest_paus methblueskyrun_enginerunenginestop methblueskyrun_enginerunengineabort methblueskyrun_enginerunenginehalt methblueskyrun_enginerunengineresum work bad practic complic attempt integr event loop tool tornado tornado report self asyncio event loop attempt start anoth asyncio event loop insid task fail mean blueski run jupyt notebook fix continu run event loop background thread classblueskyrun_enginerunengin object manag interact creat task event loop first order user notic chang howev detail manag block user prompt suspend process messag plan radic differ one consequ run event loop background thread code plan callback execut thread well mean plan callback must threadsaf api chang install_qt_kick deprec previous run asyncio event loop main thread block return meant use matplotlib qt plot would effect frozen qt event loop given chanc run work around instal kicker task onto asyncio event loop would period spin qt event loop keep figur respons addit new data callback user interact run event loop background thread longer work qt event loop must run main thread instead use during_task block main thread run qt event loop directli during_task kwarg runengine__init__ need block main thread methblueskyrun_enginerunengine__call__ methblueskyrun_enginerunengineresum user suppli plan complet previous would call selflooprun_forev start asyncio event loop would stop event loop bottom runengine_run methblueskyrun_enginerunenginerequest_paus unblock main thread return control user termin must find altern way achiev effect classthreadingev classblueskyrun_enginerunengin set task runengine_run complet howev simpl wait event would caus qt window freez also want bake matplotlib qt depend directli classblueskyrun_enginerunengin ad hook set init time object expect implement method blockev runengin execut plan pass classthreadingev respons block event set function thing run qt event loop time requir signatur def blockev threadingev none return ev set default hook handl case matplotilb qt backend case matplotlib import wait_for msg expect callabl rather futur messag stash rerun plan interrupt would result reus coroutin pass alway broken due way stop event loop paus scan pass test instead directli pass valu pass funcasynciowait expect iter pass callabl signatur def fut_fac await must work multipl time persist dict use remd must threadsaf default remd ordinari dictionari dictlik object may use often conveni content dictionari persist session achiev formerli recommend use historydicthistorydict unfortun historydicthistorydict threadsaf compat blueski new concurr model recommend use classblueskyutilspersistentdict see refmd_persist instruct migrat exist metadata callback must threadsaf callback run background thread must threadsaf place like come context plot gener creat gui window almost gui framework insist interact main thread case qt provid classblueskycallbacksmpl_plottingqtawarecallback manag move qt work back main thread via qt signal plan must threadsaf plan execut background thread must threadsaf touch extern state similarli callback expect like place fail plot case address use threadsaf version callback featur ad support docmulti_run_plan ad better log conveni function manag easili see docdebug gener funcblueskyplanslist_scan work number motor one v funcblueskyplansscan gener way ad funcblueskyplanslist_grid_scan ad funcblueskyplan_stubsrd ad classblueskysuspenderssuspendwhenchang ad funcblueskycallbackscoremake_callback_saf funcblueskycallbackscoremake_class_saf ad per_shot paramet funcblueskyplanscount analog per_step paramet support plan scan accept kwarg funcblueskyplan_stubsmv funcblueskyplan_stubsmvr pass motor involv move notabl allow plan pass timeout paramet objset ad new builtin runengin command re_class send type runengin gener allow plan know consum usual runengin subclass nonrespons consum like list rais help error messag num paramet given funcblueskyplansscan whole number happen num mistaken mean step size report version blueski avail ophyd metadata add help error messag valu return call objread return none instead expect dict user tri start classblueskycallbackszmqremotedispatch stop rais help error messag bug fix state attribut runengin readonli properti alway besteffort callback assum runstart document includ scan_id option key commandlin util blueskymqproxi work window ipython integr updat compat ipython ad support adapt fli scan enabl collect messag option return event emit fix bug tqdmbase progress bar tqdm could hand valu consid invalid api chang remov attribut nnl classblueskycallbacksbest_effortpeakresult alway none never implement serv caus confus v bug fix releas fix bug result configur data relat fli scan ad descriptor v ad support python follow forwardcompat classblueskyutilspersistentdict classblueskycallbacksmpl_plottingqtawarecallback see gh mileston httpsgithubcomblueskyblueskymilestoneclosed_ complet list chang v support fix blueskyutilsregister_transform ipython v support maplotlib use deprec remov aspect adjust valu v releas remov depend old version jsonschema librari requir latest version eventmodel librari v releas fix compat matplotlib x least matplotlib x releas compat matplotlib plot callback blueski v releas blueski compat x x releas v releas contain bug fix document updat featur use iso delimit date scan bug fix pin jsonschema due deprec stop use deprec api matplotlib v releas includ mani document fix hand new featur especi around improv log featur log increas improv default handler ad blueski logger import time new conveni function funcblueskyset_handl address common case direct log output file blueskymqproxi script support v verbos option log everi start stop document receiv vvv verbos option log everi document everi type prefix messag sent classblueskycallbackszmqpublish set arbitrari byte previou version prefix hardcod encod combin hostnam process id python object id runengin instanc runengin includ humanread notnecessarilyuniqu scan_id key runstart document sourc scan_id pluggabl via new paramet scan_id_sourc see docrun_engine_api detail conveni function funcblueskyutilsts_msg_hook accept new paramet file direct output file instead standard possibl use callback requir matplotlib without import bug fix fix besteffortcallback handl integ data plot fix invalid escap sequenc produc warn python break chang signatur classblueskycallbackszmqremotedispatch chang nonbackwardcompat way paramet filter messag hostnam pid run_engine_id replac one new paramet prefix default valu runengineverbos true mean runenginelog disabl default deprec classblueskycallbackszmqpublish accept option runengin instanc publish subscrib automat paramet deprec user encourag subscrib publish runengin manual normal way resubscribepublish paramet may remov futur releas blueski v releas fix singl regress introduc v recommend user upgrad bug fix fix critic typo made classblueskycallbacksmpl_plottinglivegrid unus note x seri compat newer version matplotlib need version lower due api chang matplotlib x seri compat matplotlib version chang v featur ad abil control sens classblueskycallbacksmpl_plottinglivegrid ex posit goe right match coordin hutch learn specifi serial deseri zmq publish client promot inner function funcblueskyplan_stubsone_nd_step toplevel plan funcblueskyplan_stubsmove_per_step ad flag funcblueskyplansramp_plan control data point taken ramp start bug fix ensur order stabil funcblueskymagicsget_labeled_devic support version python fix typo dev requir build detail v bug fix fix showshop runengin bug flyer asset collect impact bug expect low flyer asset collect yet bug discov write first one fix packag issu certain import file notabl requirementstxt includ sourc tarbal made besteffortcallback swallow error relat matplotlib tight layout occur better show messi plot error v bug fix revis behavior magic integr ophyd experiment label featur import differ wa magic travers children label devic find subdevic position v bug fix fix race condit monitor signal could emit event document correspond event descriptor document address incompat upcom releas python v featur use ophyd v later emit resourc datum document runengin previous ophyd would insert document directli databas left consum partial inform exampl miss file path externallystor data guarante around synchron ophyd need interact databas directli inform flow runengin subscrib consum determinist order new msg command install_suspend remove_suspend allow plan temporarili add remov suspend runengin signal handl ie ctrlc captur configur runengin accept list context_manag enter exit run default one context manag handl ctrlc disabl ctrlc handl pass empti list instead also use inject custom behavior add new plan funcblueskyplansxx_scan funcblueskyplansspiral_square_plan funcblueskyplansrel_spiral_square_plan add conveni method review avail command methblueskyrun_enginerunenginecommand methblueskyrun_enginerunengineprint_command_registri add cross attribut peakstat bug fix resum suspend call resum devic present fix bec livegrid plot motor one step codepath livefit produc warn produc error instead break chang userdefin callback subscrib runengin stream must accept document name resourc datum bulk_datum necessarili heed content must fall receiv one deprec ipython magic alway mark experiment rework instead reli singleton list blueskymagicsposition blueskymagicsdetector magic scrape user namespac object implement _ophyd_labels_ interfac see docmag new usag magic revert old behavior singleton list nonempti produc warn old behavior remov futur releas v featur refresh document new doctutori section extend funcscan funcrel_scan handl multipl motor render funcinner_product_scan funcrelative_inner_product_scan redund new plan stub funcblueskyplan_stubsrepeat repeat anoth plan n time option interleav delay kind customiz version funcblueskyplanscount better valid userdefin per_step function inform error messag match bug fix fix axe orient classliverast make classbesteffortcallback display multimotor scan properli fix bug functs_msg_hook conflat month minut also includ subsecond precis avoid situat plan without hint caus classbesteffortcallback error instead best guess use behavior skip unfil externallystor data classlivet fix bug expect array data get uuid datum_id error deprec funcblueskyplan_stubscaching_repeat plan deprec incompat preprocessor remov futur releas blueski document previou releas rare ever use impact remov expect low v releas fix small bug v introduc one new featur api chang deprec expect affect mani user featur add new command classblueskyrun_enginerunengin drop jettison current activ event bundl without save use workflow gener mani read immedi categor use plan summarili discard add funcblueskyutilsinstall_kick dispatch automat funcblueskyutilsinstall_qt_kick funcblueskyutilsinstall_nb_kick depend current matplotlib backend bug fix fix hint funcblueskyplansinner_product_scan previous use default hint incorrect break chang deprec funcblueskyplanstune_centroid chang mean step_factor paramet factor reduc rang success iter enforc bound motion determin centroid pass separ classblueskypreprocessorssupplementaldata preprocessor insert instruct logic order first baselin read monitor flyer previous order revers suspend classblueskysuspenderssuspendinband renam classblueskysuspenderssuspendwhenoutsideband make mean clear behavior chang suspend valu exit given rang origin confus name issu warn suspend classblueskysuspenderssuspendoutband counterintuit suspend valu enter given rang deprec applic found unusu scenario user alway implement custom suspend handl v tag mark import releas blueski signifi conclus earli develop phase point intend project codevelop multipl facil x seri plan longtermsupport releas bug fix funcblueskyplan_stubsmv funcblueskyplan_stubsmvr work pseudoposition funcblueskypreprocessorsreset_positions_wrapp work pseudoposition plan given empti detector list count longer break classblueskycallbacksbest_effortbesteffortcallback v last releas contain major restructur gener cleanup break chang deprec modblueskyplan modul split modblueskyplan plan creat run funccount funcscan modblueskypreprocessor plan take plan motifi funcbaseline_wrapp modblueskyplan_stub small plan meant conveni build block creat custom plan functrigger_and_read modblueskyobject_plan modblueskycntx contain legaci api plan deprec previou releas remov futur releas runengin rais runengineinterrupt except interrupt eg paus option argument raise_if_interrupt remov modul modblueskycallbacksscientif remov peakstat move modblueskycallbacksfit funcplot_peak_stat move blueskycallbacksmpl_plot synthet hardwar object blueskyexampl reloc ophyd blueski sister packag aggress refactor close align behavior real hardwar reader mover class remov favor synsign synperiodicsign synaxi synsignalwithregistri featur add funcstub_wrapp funcstub_decor strip open_runclose_run stageunstag messag plan reus part larger plan manag scope run manual add functune_centroid plan iter find centroid singl peak allow devic coupl axe use ndimension scan plan add funccontingency_wrapp funccontingency_decor richer cleanup specif number event event stream record runstop document key num_ev make messag shown runengin paus configur via attribut runenginepause_msg bug fix fix order dimens funcgrid_scan hint show figur creat intern support neg direct adapt scan valid descriptor given event stream name consist data key correctli mark exit_statu field runstop metadata base termin method call abort stop halt livefitplot handl updat care intern chang modblueskycallback packag split modul shim import maintain backward compat except note section api chang matplotlib option depend import plottingrel callback avail intern chang runengin support ophyd new statu object api ad callback v bug fix fix critic funcbaseline_wrapp bug make funcplan_mut flexibl see docstr v small releas bug fix ui improv bug fix fix bug wherein besteffortcallback tri plot string float intend behavior skip warn featur includ inform header besteffortcallback includ offset column wa output v releas equival v number skip due packag problem v highlight automat besteffort visual peakfit avail plan includ userdefin one speclik api fulli remov use featur appli librari selfconsist way see next section detail instruct migrat improv tool stream document network live process visual differ process differ machin break chang modul implement loos dub speclik interfac blueskyspec_api blueskyglobal_st entir remov approach insuffic similar spec satisfi spec user confusingli inconsist rest blueski new approach retain good thing interfac make avail use plan consist includ user defin one user fulli utilitz speclik plan notic four differ gsdet use variabl detector instead codeblock python old altern longer support blueskyglobal_st import gs blueskyspec_api import ct gsdet list detector rect codeblock python blueskyplan import count det list detector recountdet notic use multipl list enabl easi task switch instead continu updat one global list like codeblock python old altern longer support gsdet list detector rect gsdetsremovesome_detector gsdetsappendsome_other_detector rect defin mani list want call whatev want codeblock python list detector list differ detector recountd recountd automat baselin read concurr monitor fli set uniformli plan formerli list devic read begin end run baselin read list signal concurr monitor list flyer run concurr configur like codeblock python old altern longer support blueskyspec_api import ct gsbaseline_devic list devic read start end gsmontior list signal monitor concurr gsflyer list flyabl devic gsdet list detector rect monitor fli baselin read ad formerli set affect behavior speclik plan ct ascan ignor counterpart count scan well userdefin plan desir scheme replac refsupplement data supplemental_data use global modifi plan includ userdefin one codeblock python blueskyplan import count onetim configur blueski import supplementaldata sd supplementaldata repreprocessorsappendsd interact use sdmonitor list signal monitor concurr sdflyer list flyabl devic sdbaselin list devic read start end det list detector recountdet monitor fli baselin read ad automat live visual peak analysi set uniformli plan formerli speclik plan ct ascan automat set suitabl tabl plot standard vanilla counterpart funcblueskyplanscount funcblueskyplansscan requir explicit detail instruct besteffort tabl plot made plan includ userdefin one invok simpl configur codeblock python blueskyplan import count onetim configur blueskycallbacksbest_effort import besteffortcallback bec besteffortcallback resubscribebec interact use det list detector recountdet num automat print tabl show plot use becdis becen temporarili toggl output peak anallysi comput automat besteffortcallback view keyboard shortcut peak statist formerli encapsul gsp organ differ plot simpl peakfit perform background cours may may applic depend data shown default view fit annot plot click plot area press shiftp lowercas p shortcut pan plot access peakfit statist programmat use becpeak conveni may alia like codeblock python peak becpeak insid peak access variou statist like codeblock python peakscom peakscen peaksmax peaksmin dictionari entri field fit exampl center mass peak statist field name ccd_stats_tot would access like peakscomccd_stats_tot function class modul blueskycallbacksbrok requir instanc broker pass argument use default singleton instanc via databrok import db deprec usag databrok plan preprocessor configure_count_time_wrapp configure_count_time_decor move blueskyplan blueskyspec_api revert chang made v mq pubsub integr class publish remotedispatch overhaul move modblueskycallbackszmqpub modblueskycallbackszmqsub modblueskycallbackszmq signatur chang match similar util pydata ecosystem see enhanc section inform modul blueskyqt_kick remov former content avaiabl blueskyutil modul origin deprec april issu warn chang sinc plan blueskyplansinput renam blueskyplansinput_plan avoid shadow builtin modul bulkimport plan previous undocu rare use impact chang user expect small deprec modul modblueskyplan_tool renam modblueskysimualtor new modul funcblueskyplan_toolsprint_summari renam funcblueskysimulatorssummarize_plan old name support releas warn remov futur releas objectorient plan count scan etc deprec remov futur releas document remov plan context manag run_context stage_context etc deprec remov futur releas never document wide use method methblueskydispatchersubscrib encapsul classblueskyrun_enginerunengin inherit classblueskycallbackszmqremotedispatch new signatur former signatur subscribenam func new signatur subscribefunc nameal mean argument unambigi must callabl string respect old order support indefeinit warn featur docprogress bar progressbar addon avail address new refsupplement data supplemental_data featur make easi set baselin read asynchron acquisit way appli automat plan new refbesteffort callback best_effort_callback set automat termin output plot plan includ userdefin one liveplot accept xtime set unix epoch start run also accept xseq_numa synonym xnone remain default new simul funcblueskysimulatorscheck_limit verifi plan tri move movabl devic outsid limit new plan funcblueskyplanmvr ad rel counterpart funcblueskyplanmv mq pubsub integr class classblueskycallbackszmqpublish classblueskycallbackszmqremotedispatch simplifi new class classblueskycallbackszmqproxi commandlin util blueskymqproxi ad streamlin configur metadata record mani builtin plan includ new item hint use besteffort callback produc use visual addit builtin exampl devic refa new hint attribut hint content may chang expand futur releas new featur explor docipython magic magic mimic spec api ad experiment may alter remov futur bug fix use fake sleep featur simul mover motor caus break requirementstxt fail declar blueski requir matplotlib v break chang move configure_count_time_wrapp configure_count_time_decor blueskyspec_api blueskyplan metadata report step scan use label num_step renam num_point gener consid less ambigu name separ num_inter one might mistakenli assum meant num_step also store v featur plan callback hung runengin block normal abil respond ctrlc paus possibl trigger halt emerg stop hammer ctrlc ten time bug fix fix bug fail cancel movement could caus futur execut runengin error fix bug plan_mut properli handl return valu one effect fix baseline_wrapp properli pass run uid fix bug livefit broke multivari fit minor fix exampl detector break chang keyboardinterrupt except captur run use caus runengin paus halt instead v featur nonlinear leastsquar minim callback livefit livefitplot ad runengineclear_suspend conveni method new runenginepreprocessor list modifi plan pass runengin ad runenginestate_hook monitor state chang akin msg_hook ad pause_for_debug option finalize_wrapp allow paus runengin perform cleanup make easier debug ad mani exampl make easier creat simul devic gener interest simul data interfac closer real devic implement ophyd ad mv conveni plan move multipl devic parallel ad option runenginemax_depth rais error runengin think call insid function bug fix monitor function complet broken pack configur wrong structur start seq_num instead regrett standard settl runengin coroutin longer mutat messag receiv fix race condit post_run callback fix bug sever callback caus work save document databrok also make call super play better multipl inherit user code break chang flag runengineignore_callback_except default fals plan complet relat fli scan previous waittru default although document indic fals default code chang match document call complet expect block updat keyword waittru complet chang api reader mover class defind simul devic blueski interfac expect stop method devic accept option success argument option undocu fig argument liveplot deprec remov futur releas ax argument ad addit axe use livegrid livescatt configur new option ax argument shortcut mash ctrlc three time quickli ran reabort remov chang default stream name monitor signal_name_monitor signal_namemonitor underscor vs dash impact chang minim note monitor function complet broken previou releas v featur muchexpand overhaul document add aspect argument livegrid add install_nb_kick get liveupd matplotlib figur notebook runengin run simul hardwar devic reader mover easili custom mock wider rang behavior test demo integr spec api mew global state attribut gsmonitor callback use databrok accept option broker instanc argument bug fix minor fix tilt comput spiral scan expost tilt option speclik api infinit count ct numnon spawn liveplot finalize_decor accept callabl eg gener function accept iter eg gener instanc restor gsflyer integr spec api accident remov break chang api simul hardwar exampl devic reader mover chang make gener remov register_md metadatastor integr v featur chang subscript factori handl make configur global state make peakstat configur global state add experiment util pass document network process separ process host use mq add monitor_during_wrapp correspond decor add stage_wrapp correspond decor builtin plan return run uid gener add new ramp_plan take data poll statu movement bug fix boost perform remov unneed sleep step messag process fix bug relat rewind prepar resum break chang remov planifi decor plan context manag experiment ultim prove problemat make difficult pass return valu cleanli remov lossi subscript featur render unnecessari util process document separ process see enhanc v bug fix make make_decor return proper decor origin implement return function could actual use decor v releas contain minor ux fix involv inform error report relat area detector plugin port configur v featur address situat plan rewind paus suspens interact badli devic three way temporarili turn rewind msg new rewind command special attribut devic trigger_and_read plan look special except devic rais paus method call three featur consid experiment like consolid futur usag test wild add new plan wrapper decor inject_md_wrapp run_wrapp rewindable_wrapp bug fix fix bug runengin put run state encount error start _run coroutin thu never switch back idl ensur plan close correctli fail close warn print allow plan run cleanup messag final runengin stop abort except rais give plan plan stack opportun handl handl carri specstyl tw pass paramet underli tweak plan silenc unneed suspend warn fix bug separ devic intern chang reduc unneed usag blueskyplanssingle_gen dont emit createsav messag read rework except handl main run engin event loop v break chang livet display data one event stream remov use global state attribut gscount_tim bug fix fix infinit count ctnumnon allow data key present differ event stream given data key appear per event make specstyl plan ct implement baselin read refer gsbaseline_det upon resum defer paus clear defer paus request make blueskyutilsregister_transform charact configur v featur plan reimplement simpl python gener instead custom python class old objectori plan maintain backcompat see plan document review new capabl break chang specstyl plan proper gener bound runengin v break chang move blueskyscientific_callback blueskycallbacksscientif blueskybroker_callback blueskycallbacksbrok remov blueskyregister_md whose usag replac import metadatastorecommand resubscribe_losslessal metadatastorecommandsinsert occurr argument block_group renam group consist affect trigger set messag wide use center plan remov may distribut separ futur call speclik plan return gener must pass runengin execut plan global runengin gsre conveni wrapper avail restor old behavior desir sinc usag render plan uncompos discourag time argument speclik plan keywordonli argument follow specialcas speclik scan remov hscan kscan lscan tscan dtscan hklscan hklmesh defin configur file desir locat easier custom describ method flyer return iter dict data key one descriptor document renam describe_collect avoid confus describ devic return dict data key one descriptor document obscur featur runenginerequest_paus remov involv remov option argument callback name v bug fix address seriou perform problem livet v break chang stage ultim parent root devic stage child make imposs leav devic partiallystag state v featur give everi event stream name use primari default record map devicesign name order data key eventdescriptor let liverast account snake trajectori bug fix peakstatscom scalar singleel array restor python compat v v v v break chang remov runenginepersistent_field field remd persist run default metadata field reserv overwritten user metadata field absolut requir metadata valid function usercustomiz default valid function behav previou version blueski longer manditori signatur runengin chang logbook argument keywordonli new keywordonli argument md_valid see docstr detail configur method readabl object take singl option argument dictionari object use configur howev see fit configur method alway new return valu tupl dict describ old new state old new objconfigurest remov method increment_scan_id callbacksbrokerpost_run api docstr brought agreement api chang expect callabl signatur foodoc_nam doc rather callabl take document document object start descriptor event stop method implement class deriv callbackbas use effect user code v v v v v initi releas util class function automodul blueskyutil msg autosummari nosignatur toctre gener msg persist metadata maintain perist set metadata python session includ dictionari ducktyp base zictfunc autosummari nosignatur toctre gener persistentdict persistentdictdirectori intern except defin number except subclass intern signal autosummari nosignatur toctre gener runenginecontrolexcept requestabort requeststop runengineinterrupt noreplayallow illegalmessagesequ failedpaus failedstatu invalidcommand planhalt rampfail progress bar use runengin display progress bar client objophydstatusmovestatuswatch api autosummari nosignatur toctre gener progressbar progressbarupd progressbardraw progressbarclear progressbarmanag task object encapsul runengin thread wait plan complet background thread autosummari nosignatur toctre gener duringtask duringtaskblock defaultduringtask runengin run loop note technic document optim user readabl document start simplifi version blueski runengin add complex step step commentari heart blueski runengine_run coroutin dispatch msg plan function actual carri request task core oper obscur layer except handl state manag clean runengin respons may refactor near futur document go discuss run loop document gener hardwar clean minim runengin minim runabl runengin code python time import sleep import datetim datetimedatetimenow blueski import msg function_map print lambda msg print ss formatnowtim msgobj sleep lambda msg sleepmsgarg def re_vplan msg plan func function_mapmsgcommand funcmsg welcome_plan msgprint hello msgsleep none msgprint world re_vwelcome_plan captur one key abstract blueski plan iter messag abstract mean plan experi need gener stream msg object runengin take care actual execut code adapt plan simpli stream command quit enough may want code gener stream messag awar return valu previou msg decid next sort thing support python use gener httpsdocspythonorgreferenceexpressionshtmlgeneratoriteratormethods__ suspend execut yield statement iter gener run next yield statement suspend yield valu code iter switch gener requir chang minim code python blueskyutil import ensure_gener def re_vplan plan ensure_generatorplan last_result none true tri msg plansendlast_result except stopiter gener indic done rais stopiter break func function_mapmsgcommand last_result funcmsg still work welcome_plan code python re_vmsgprint hello msgsleep none msgprint world also sophist thing like code python function_mapsum lambda msg summsgarg def adding_plana b yield msgprint formata b ret yield msgsum none b yield msgprint formata b ret yield msgprint thank ad give code python re_vadding_plan re_vadding_plan obvious overkil simpl addit enabl like adapt dscan chang step size base local slope except handl addit generatorsend insert valu gener also use generatorthrow rais except point gener paus gener handl except via tryexcept block gener run next yield throw return yield valu gener handl except rais differ except rerais throw want abl captur except rais pass back plan code python def re_vplan plan ensure_generatorplan last_result none _except none true tri _except none msg planthrow_except _except none els msg plansendlast_result except stopiter break tri func function_mapmsgcommand last_result funcmsg except except e _except e write plan handl except case report addit fail due typeerror code python def safe_adding_plana b yield msgprint formata b tri ret yield msgsum none b except typeerror yield msgprint add formata b els yield msgprint formata b ret final yield msgprint thank ad compar behavior adding_plan addingplan case succeed code python re_vsafe_adding_plan re_vadding_plan fail code python re_vsafe_adding_plana re_vadding_plana overkil simpl case mechan allow us write delta scan alway return motor origin posit shut shutter etc even plan fail cancel turn callabl class go want access intern state _run loop soon way maintain api write callabl class instead function code python class runengine_v def _sleepself msg sleepmsgarg def _printself msg print ss formatnowtim msgobj def _sumself msg return summsgarg def __init__self self_command_registri print self_print sum self_sum sleep self_sleep def __call__self plan self_runplan def _runself plan plan ensure_generatorplan last_result none _except none true tri _except none msg planthrow_except _except none els msg plansendlast_result except stopiter break tri func self_command_registrymsgcommand last_result funcmsg except except e _except e re_v runengine_v also pull function command dispatch class method almost trivial soon method alter intern state runengin asyncio integr far implement synchron function run straight plan howev beamlin need abl support asynchron function grace interrupt plan enabl use asyncio python standard librari new provid outer event loop point integr togeth two event loop loop process plan asyncio event loop manag multipl frame execut event loop may switch execut frame coroutin suspend yield statement thu chang method dispatch main _run method coroutin ad asynciocoroutin decor call dispatch function via yield rather direct function call also ad msg_hook attribut runengin super handi debug tool see exactli messag process runengin set callabl take singl msg input ex print code python import asyncio class runengine_v def __init__self loopnon map messag coro self_command_registri print self_print sum self_sum sleep self_sleep debug hook selfmsg_hook none bind specif loop loop none loop asyncioget_event_loop selfloop loop runengin keep track lot state flag cach defin comment good luck self_task none asynciotask associ call self_run def __call__self plan self_task selfloopcreate_taskself_runplan selflooprun_until_completeself_task self_taskdon self_taskcancel exc self_taskexcept exc none rais exc asynciocoroutin def _runself plan plan ensure_generatorplan last_result none _except none true tri yield asynciosleep loopselfloop _except none msg planthrow_except _except none els msg plansendlast_result except stopiter break selfmsg_hook selfmsg_hookmsg tri func self_command_registrymsgcommand last_result yield funcmsg except except e _except e asynciocoroutin def _sleepself msg yield asynciosleepmsgarg asynciocoroutin def _printself msg print ss formatnowtim msgobj asynciocoroutin def _sumself msg return summsgarg re_v runengine_v paus resum rewind ad abil pauseresumerewind scan add fair amount complex runengin must keep track stack plan rather singl plan cach msg go expos enough api control behavior code python collect import dequ import asyncio import datetim import functool blueskyutil import asyncinput failedpaus invalidcommand msg ensure_gener blueskyrun_engin import runenginestatemachin propertymachin super_state_machineerror import transitionerror class runengine_v state propertymachinerunenginestatemachin _uncacheable_command paus def __init__self loopnon map messag coro self_command_registri print self_print sum self_sum coro real sleep self_sleep checkpoint self_checkpoint clear_checkpoint self_clear_checkpoint rewind self_rewind paus self_paus input self_input null self_nul debug hook selfmsg_hook none bind specif loop loop none loop asyncioget_event_loop selfloop loop runengin keep track lot state flag cach defin comment good luck self_task none asynciotask associ call self_run self_deferred_pause_request fals paus next checkpoint self_msg_cach dequ histori process msg rewind self_rewindable_flag true allow replay msg self_plan none scan plan instanc __call__ self_plan_stack dequ stack gener work self_response_stack dequenon resp send plan self_interrupt fals true paus abort fail def __call__self plan first thing first wrong state rais selfstateis_idl rais runtimeerrorth runengin state selfstat self_clear_call_cach self_plan plan gen ensure_generatorplan self_plan_stackappendgen self_response_stackappendnon self_task selfloopcreate_taskself_run selflooprun_forev self_taskdon self_taskcancel exc self_taskexcept exc none rais exc def _clear_call_cacheself self_deferred_pause_request fals self_plan_stack dequ self_msg_cach dequ self_response_stack dequenon self_except none self_task none self_plan none self_interrupt fals properti def rewindableself return self_rewindable_flag rewindablesett def rewindableself v cur_stat self_rewindable_flag self_rewindable_flag boolv selfresum self_rewindable_flag cur_stat self_reset_checkpoint_st properti def resumableself ie plan progress rewound return self_msg_cach none asynciocoroutin def _runself pending_cancel_except none tri selfstat run true tri yield asynciosleep loopselfloop case stash except self_except none throw except current plan tri msg self_plan_stackthrow self_except except except e current plan handl mayb next plan would like tri self_plan_stackpop lenself_plan_stack self_except e continu plan left still unhandl except rerais exit infinit loop els rais clear stash except top plan handl els self_except none normal case clean oper els resp self_response_stackpop tri msg self_plan_stacksendresp exhaust top gener except stopiter pop dead gener go back top self_plan_stackpop lenself_plan_stack continu rerais get infinit loop els rais except come plan except except e pop dead plan stash except go top loop self_plan_stackpop lenself_plan_stack self_except e continu rerais get infinit loop els rais selfmsg_hook selfmsg_hookmsg messag cach rewind cach self_msg_cach none self_rewindable_flag msgcommand self_uncacheable_command checkpoint self_msg_cacheappendmsg tri look coroutin execut command tri coro self_command_registrymsgcommand replac keyerror local subclass go top loop except keyerror todo make smarter self_except invalidcommandmsgcommand continu tri final run command user ask tri one two place async except come via throw rais respons yield coromsg special case cancellederror let outer except block deal except asynciocancellederror rais except stash go top loop except except e self_except e continu normal use run cleanli stash respons go top loop els self_response_stackappendrespons continu except keyboardinterrupt happen extern code captur sigint overrid runengin rais instead properli call runengin handler see httpsgithubcomnslsiiblueskypul printan unknown extern librari improperli rais keyboardinterrupt intercept trigger hard paus instead selfloopcall_soonselfrequest_paus fals printpause_msg except asynciocancellederror e handl twice rais leav plan alon self_except e rais e case failedpaus requestabort coro rais error alreadi stash _except self_except none self_except e pending_cancel_except e except stopiter pass final selfloopstop selfstat idl task cancel pending_cancel_except none rais pending_cancel_except asynciocoroutin def _sleepself msg yield asynciosleepmsgarg asynciocoroutin def _printself msg datetimedatetimenow print ss formatnowtim msgobj asynciocoroutin def _sumself msg return summsgarg asynciocoroutin def _inputself msg process input msg expect msg msginput none msginput none prompt custom prompt prompt msgkwargsgetprompt async_input asyncinputselfloop async_input functoolspartialasync_input end flushtru return yield async_inputprompt asynciocoroutin def _pauseself msg request run engin paus expect messag object msgpaus deferfals namenon callbacknon see runenginerequest_paus docstr explan three keyword argument msg signatur selfrequest_pausemsgarg msgkwarg def request_pauseself deferfals command run engin paus function call paus messag also call thread call main thread run call sigint ie ctrlc current run checkpoint via clear_checkpoint messag caus run abort paramet defer bool option fals paus immedi process new messag true paus next checkpoint fals default defer self_deferred_pause_request true printdef paus acknowledg continu checkpoint return paus cancel defer paus previous request self_deferred_pause_request fals self_interrupt true printpaus selfstat paus selfresum resum paus abort scan printno checkpoint paus printabort run cleanup mark exit_statu abort self_except failedpaus self_taskcancel task self_failed_status_task taskcancel return stop accept new task event loop exist task still process selfloopstop def resumeself resum paus plan last checkpoint return uid list list header uid aka runstart uid run state machin captur whole pictur selfstateis_paus rais transitionerrorth runengin state resum paus state formatselfst self_interrupt fals new_plan self_rewind self_plan_stackappendnew_plan self_response_stackappendnon self_resume_event_loop return def _rewindself clean prepar resum paus suspens return new_plan gener new plan made messag messag cach new_plan ensure_generatorlistself_msg_cach self_msg_cach dequ need cancel open bundl eg creat paus happen checkpoint creat pair save return new_plan def _resume_event_loopself may call resum abort selfstat run self_last_sigint_tim none self_num_sigints_process self_taskdon return selflooprun_forev self_taskdon self_taskcancel exc self_taskexcept exc none rais exc asynciocoroutin def _checkpointself msg instruct runengin creat checkpoint rewind point necessari expect messag object msgcheckpoint yield self_reset_checkpoint_state_coro self_deferred_pause_request checkpoint done defer paus give _check_for_sign coroutin time look addit sigint would trigger abort yield asynciosleep loopselfloop selfrequest_pausedeferfals def _reset_checkpoint_stateself self_msg_cach none return self_msg_cach dequ _reset_checkpoint_state_coro asynciocoroutine_reset_checkpoint_st asynciocoroutin def _clear_checkpointself msg clear set checkpoint expect messag object msgclear_checkpoint clear messag cach self_msg_cach none clear stash self_teed_sequence_countersclear asynciocoroutin def _rewindableself msg set rewind state runengin expect messag object msgrewind none bool none rw_flag msgarg rw_flag none selfrewind rw_flag return selfrewind asynciocoroutin def _nullself msg noop messag mainli debug test pass re_v runengine_v re_vmsg_hook print def pausing_plan yield msgnull yield msgnull yield msgpaus yield msgnull stop abort halt suspend objecthardwar clean document creation emiss sigint intercept currentmodul blueskyplan record metadata captur use metadata main object blueski inform provid use blueski downstream data search analysi tool term metadata controversi term one scientist data anoth metadata classif context depend exact inform data one experi metadata differ experi done exact hardwar document model httpsblueskyprojectioeventmodeldatamodelhtml_ provid framework decid _where_ record particular piec inform thing know priori experi user sampl look user ask us thing principl know independ control system prime candid inclus start document httpsblueskyprojectioeventmodeldatamodelhtmlrunstartdocument_ downstream databrok provid tool rich search data inform includ better inform need nomin independ particular devic need consult control system exampl locat import unscan motor configur beam attenu valu fix cours experi good candid baselin devic either via supplement preprocessor httpsblueskyprojectioblueskytutorialhtmlbaselinereadingsandothersupplementaldata_ explicitli custom plan put read separ stream peer primari data principl valu could read control system put start document along priori inform howev sever draw back ever read valu drift data acquisit never know automat captur inform devic like data event includ thing like datatyp unit shape valu configur inform hardwar read third class inform call metadata configur inform piec hardwar thing like veloc motor integr time detector read embed descriptor httpsblueskyprojectioeventmodeldatamodelhtmleventdescriptor_ extract hardwar via read_configur httpsblueskyprojectioblueskyhardwarehtmlreadabledeviceread_configuration_ method hardwar expect valu chang cours experi read inform fall one categori expect chang experi treat data either explicit part experiment plan via refasync_monitor ad start document runengin mint start document includ structur data inform inject via sever mechan enter interact user execut time provid code plan automat infer enter user stash reus futur plan conflict sourc higher entri list win closer user inform origin higher prioriti interact one use suppos execut custom plan call plan codeblock python replan give arbitrari extra keyword argument interpret metadata codeblock python replan sample_ida purposecalibr operatordan refrun run_overview ie dataset gener plan includ custom metadata codeblock python sample_id purpos calibr oper dan plan gener one run run get metadata exampl plan gener three differ run codeblock python blueskyplan import count scan ophydsim det det motor simul detector motor def plan yield countdet yield scandet motor yield countdet execut codeblock python replan sample_ida purposecalibr operatordan run get copi sample_id purpos oper metadata plan revisit previou exampl codeblock python def plan yield countdet yield scandet motor yield countdet pass differ metadata run everi refbuiltin preassembl plan preassembled_plan accept paramet md use inject metadata appli plan codeblock python def plan yield countdet mdpurpos calibr one yield scandet motor mdpurpos good data two yield countdet mdpurpos saniti check three metadata pass combin metadata pass plan thu call codeblock python replan sample_ida operatordan gener three set metadata codeblock python one sample_id purpos calibr oper dan two sample_id purpos good data oper dan three sample_id purpos saniti check oper dan conflict keyword take preced codeblock python replan purposetest would overrid individu purpos metadata plan mark three purposetest defin plan best practic take keyword argument mdnone allow hardcod metadata overridden later codeblock python def plan mdnone md md handl default case put unpack md end mean win user call yield planmdpurpos bob overrid valu yield countdet mdpurpos calibr md yield scandet motor mdpurpos good data md yield countdet mdpurpos saniti check md consist refpreassembled_plan inject metadata via plan refer refthi section tutorial_plan_metadata tutori note builtin plan provid certain metadata automat custom plan requir provid nice pattern follow plan_nam eg scan detector list name detector motor list name motor plan_arg dict keyword argument pass plan plan_pattern function use creat trajectori plan_pattern_modul python modul plan_pattern defin plan_pattern_arg dict keyword argument pass plan_pattern creat trajectori plan_nam plan_arg togeth provid suffici inform recreat plan detector motor conveni key search later plan_pattern entri provid lowerlevel explicit inform trajectori pattern gener plan separ specif detector motor involv complex trajectori like spiral especi use simpl exampl patternrel metadata funcscan codeblock python plan_pattern linspac plan_pattern_modul numpi plan_pattern_arg dictstartstart stopstop numnum thu one recreat pattern trajectori like codeblock python numpylinspacedictstartstart stopstop numnum automat run runengin automat record time context start time time also record uid global uniqu id run plan_nam function class name plan eg count plan_typ eg python type plan eg gener last two overridden method first two overridden user note custom plan specifi plan_nam plan_typ runengin infer follow codeblock python plan_nam typeplan__name__ plan_typ getattrplan __name__ may less inform depend plan heurist provid inform default plan user provid interact repeat use time plan execut current content remd copi metadata run gener plan enter metadata reus plan add remd codeblock python remdproposal_id remdproject fli car remddimens view current content codeblock python remd delet key want stop use codeblock python del remdproject delet key use standard method appli dictionari python httpsdocspythonorglibrarystdtypeshtmltypesmapping_ warn gener recommend put devic read start document start document whowhatwhywhen thing know start commun hardwar especi critic put devic read remd dictionari valu remain chang track state hardwar result record outofd incorrect data particularli danger remd back persist data store see next section outofd read last across session scan_id integ runengin automat increment begin scan store remdscan_id warn clear key like codeblock python remdclear clear key reset scan_id next time plan execut runengin start scan_id set codeblock python remdscan_id reader may prefer reset scan id begin new experi other way wish maintain singl unbroken sequenc scan id forev technic standpoint fine duplic scan id run also randomlygener uid uniqu id global uniqu forev _md_persist persist session provid way save content metadata stash remd session eg exit reopen ipython gener remd attribut may anyth support dictionari interfac simplest plain python dictionari codeblock python remd persist metadata session blueski recommend classblueskyutilspersistentdict python dictionari sync directori file disk chang made remd sync file content remd persist session codeblock python blueskyutil import persistentdict remd persistentdictsomepathher blueski provid strong recommend path detail left local deploy blueski formerli recommend use classhistorydicthistorydict python dictionari back sqlite databas file approach prove problemat thread introduc blueski v longer recommend follow recommend migrat metadata historydicthistorydict classblueskyutilspersistentdict first updat configur make remd classblueskyutilspersistentdict shown migrat like codeblock python blueskyutil import get_histori old_md get_histori remdupdateold_md classblueskyutilspersistentdict object backport blueski v well avail x older move new system must run blueski v higher warn remd object also set runengin instanti codeblock python runengin equival runengin remd state refat start tutori tutorial_run_engine_setup use blueski user facil share configur may alreadi configur defin new result data loss arent sure safer use remd allow data type custom metadata keyword map string eg taskcalibr number eg attempt list tupl eg dimens nest dictionari eg dimensionswidth height requir field field uid time reserv document model set user current version blueski field univers requir blueski possibl specifi requir field local configur see refmd_valid nslsii facilitywid requir come soon special field arbitrari custom field allow invent name use certain field given special signific blueski document model either disallow requir certain type field owner group project option facilit searchabl blank must string nonstr like owner produc error interrupt scan execut immedi start similarli keyword sampl special signific must either string dictionari scan_id field expect integ automat increment run scan_id provid user stash persist metadata previou run default _md_valid valid addit custom metadata valid ad runengin exampl ensur run execut unless paramet sample_numb specifi defin function accept dictionari argument rais sample_numb found codeblock python def ensure_sample_numbermd sample_numb md rais valueerrory forgot sampl number appli function set codeblock python remd_valid ensure_sample_numb function execut immedi new run open appendix section cover python languag featur may new reader use blueski uniqu wherev possibl blueski _yield_from_prim primer yield yield brief primer python syntax yield yield featur core languag use extens python function return ipython python def f return f python gener like function multipl exit point call gener produc iter yield one valu time yield statement execut suspend ipython python def f yield yield exhaust gener ie get valu call list ipython python listf get one valu time call next ipython python f nextit nextit loop valu ipython python val f printval examin happen add print ipython python def verbose_f printbefor yield printbefor yield ipython python verbose_f nextit nextit notic execut suspend first yield statement second print run resum execut request second valu use featur gener express lazi execut gener deleg gener use yield syntax commonli use combin plan ipython python def double_f yield f yield f equival ipython python def double_f val f yield val val f yield val yield syntax succinct ipython python listdouble_f currentmodul blueskyplan plan plan blueski concept experiment procedur plan may iter object list tupl custom iter class commonli implement python gener technic discuss refer docmsg varieti preassembl plan provid like sandwich deli menu use preassembl plan assembl ingredi catalogu head refstub_plan note exampl follow assum runengin instanc name may alreadi configur user facil run blueski see refthi section tutori tutorial_run_engine_setup sort alreadi runengin quickli make one need _preassembled_plan preassembl plan summari tabl break plan categori show exampl figur summari notic name left column link detail api document autosummari toctre gener nosignatur count scan rel_scan list_scan rel_list_scan list_grid_scan rel_list_grid_scan log_scan rel_log_scan grid_scan rel_grid_scan scan_nd spiral spiral_fermat spiral_squar rel_spir rel_spiral_fermat rel_spiral_squar adaptive_scan rel_adaptive_scan tune_centroid tweak ramp_plan fli time seri count exampl codeblock python ophydsim import det blueskyplan import count singl read detector det recountdet five consecut read recountdet num five sequenti read separ second delay recountdet num delay variabl delay recountdet num delay take read forev interrupt eg ctrlc recountdet numnon codeblock python well use noisy_det exampl detector interest plot ophydsim import noisy_det recountnoisy_det num plot blueski import runengin blueskyplan import count ophydsim import noisy_det blueskycallbacksbest_effort import besteffortcallback bec besteffortcallback runengin resubscribebec recountnoisy_det num note doesnt funccount exposure_tim paramet modern ccd detector typic parametr exposur time multipl paramet acquir time acquir period num exposur scaler preset time auto count time one exposur time appli detector addit use multipl detector countdet det user would need provid separ exposur time detector gener case would grow wordi one option set timerel paramet separ step interact use codeblock python exampl detector might differ name number exposurerel parameterswhich point detexposure_timeset detacquire_periodset plan codeblock python exampl detector might differ name number exposurerel parameterswhich point yield blueskyplan_stubsmv detexposure_tim detacquire_period anoth write custom plan wrap funccount set exposur time plan encod detail blueski gener cant know codeblock python def count_with_timedetector num delay exposure_tim mdnone assum detector one exposur time compon call exposure_tim fulli specifi exposur detector detector yield blueskyplan_stubsmvdetectorexposure_tim exposure_tim yield blueskyplanscountdetector num delay mdmd autosummari toctre gener nosignatur count scan one dimens dimens might physic motor posit temperatur pseudoaxi plan exampl codeblock python ophydsim import det motor blueskyplan import scan rel_scan list_scan scan motor take equallyspac read det rescandet motor scan motor rel current posit rerel_scandet motor scan motor list userspecifi posit relist_scandet motor codeblock python rescandet motor plot blueski import runengin blueskyplan import scan ophydsim import det motor runengin blueskycallbacksbest_effort import besteffortcallback bec besteffortcallback resubscribebec rescandet motor note dont scan delay paramet may notic funccount delay paramet none scan intent common reason want delay scan allow motor settl temperatur control reach equilibrium better configur respect devic scan alway add appropri delay particular devic scan codeblock python motorsettle_tim temperature_controllersettle_tim mani case conveni robust type delay paramet everi invoc scan set appli thereaft blueski leav delay scan guid user toward approach like better fit one might occur first situat delay paramet realli right tool job cours alway possibl add delay paramet write custom plan one approach use refper_step hook per_step_hook codeblock python import blueskyplan import blueskyplan_stub def scan_with_delayarg delay kwarg accept normal scan paramet plu option delay def one_nd_step_with_delaydetector step pos_cach copi blueskyplan_stubsone_nd_step sleep ad motor stepkey yield blueskyplan_stubsmove_per_stepstep pos_cach yield blueskyplan_stubssleepdelay yield blueskyplan_stubstrigger_and_readlistdetector listmotor kwargssetdefaultper_step one_nd_step_with_delay yield blueskyplansscanarg kwarg autosummari toctre gener nosignatur scan rel_scan list_scan rel_list_scan log_scan rel_log_scan _multidimensional_scan multidimension scan see reftutorial_multiple_motor tutori introduct common case move multipl motor coordin ie move x along diagon grid key exampl reproduc see section link explan codeblock python ophydsim import det motor motor motor blueskyplan import scan grid_scan list_scan list_grid_scan rescandet motor scan motor motor scan motor step scan motor motor jointli point trajectori relist_scandet motor motor scan x x grid regrid_scandet motor snake paramet first motor motor fals motor fals scan grid abitrari space given specif posit relist_grid_scandet motor motor plan built generalpurpos plan funcblueskyplanscan_nd use special case jargon speak funcblueskyplansscanlik joint movement inner product trajectori funcblueskyplansgrid_scanlik movement outer product trajectori gener case move motor togeth inner product anoth motor motor outer product address use cycler notic happen add multipli cycler object ipython python cycler import cycler ophydsim import motor motor motor traj cyclermotor traj cyclermotor listtraj trajectori motor listtraj traj inner product trajectori listtraj traj outer product trajectori reproduc inner product outer product real power come combin like motor motor togeth mesh motor ipython python traj cyclermotor listtraj traj traj cycler refer cycler document httpmatplotliborgcycler_ build plan incorpor trajectori use gener ndimension scan plan funcscan_nd codeblock python rescan_nddet traj traj traj autosummari toctre gener nosignatur scan rel_scan grid_scan rel_grid_scan list_scan rel_list_scan list_grid_scan rel_list_grid_scan scan_nd spiral trajectori provid twodimension scan trace spiral trajectori simpl spiral plot includesourc blueskysimul import plot_raster_path ophydsim import motor motor det blueskyplan import spiral plan spiraldet motor motor x_start y_start x_rang y_rang dr nth plot_raster_pathplan motor motor probe_s fermat spiral plot includesourc blueskysimul import plot_raster_path ophydsim import motor motor det blueskyplan import spiral_fermat plan spiral_fermatdet motor motor x_start y_start x_rang y_rang dr factor tilt plot_raster_pathplan motor motor probe_s lw squar spiral plot includesourc blueskysimul import plot_raster_path ophydsim import motor motor det blueskyplan import spiral_squar plan spiral_squaredet motor motor x_center y_center x_rang y_rang x_num y_num plot_raster_pathplan motor motor probe_s autosummari toctre gener nosignatur spiral spiral_fermat spiral_squar rel_spir rel_spiral_fermat rel_spiral_squar adapt scan onedimens scan adapt step size tune move quickli flat region concentr read area high variat comput local slope aim target delta consecut point basic exampl power adapt plan logic codeblock python blueskyplan import adaptive_scan ophydsim import motor det readaptive_scandet det motor start stop min_step max_step target_delta backsteptru plot blueski import runengin blueskyplan import adaptive_scan blueskycallbacksbest_effort import besteffortcallback bec besteffortcallback ophydsim import motor det runengin resubscribebec readaptive_scandet det motor start stop min_step max_step target_delta backsteptru left right scan lengthen stride flat region first step past peak larg jump caus doubl back sampl dens peak peak flatten lengthen stride autosummari toctre gener nosignatur adaptive_scan rel_adaptive_scan misc autosummari toctre gener nosignatur tweak fli _stub_plan stub plan currentmodul blueskyplan_stub aforement ingredi remix piec preassembl plan made see reftutorial_custom_plan tutori practic introduct compon plan interact hardwar autosummari nosignatur toctre gener abs_set rel_set mv mvr trigger read rd stage unstag configur stop plan asynchron acquisit autosummari nosignatur toctre gener monitor unmonitor kickoff complet collect plan control runengin autosummari nosignatur toctre gener open_run close_run creat save drop paus deferred_paus checkpoint clear_checkpoint sleep input_plan subscrib unsubscrib install_suspend remove_suspend wait wait_for null combin often conveni autosummari toctre gener trigger_and_read one_d_step one_nd_step one_shot move_per_step special util autosummari toctre gener repeat repeat caching_repeat broadcast_msg _preprocessor plan preprocessor currentmodul blueskypreprocessor _supplemental_data supplement data plan preprocessor modifi plan content fli one common use preprocessor take baselin read group devic begin end run conveni appli plan execut runengin use classsupplementaldata autoclass supplementaldata member instal preprocessor runengin preprocessor modifi plan supplement alter instruct way everi time type resome_plan runengin silent chang some_plan sdsome_plan sd may insert extra instruct envis instruct flow some_plan sd final sd preprocessor opportun inspect instruct go modifi see fit get process runengin preprocessor wrapper decor preprocessor make arbirari modifc plan get quit deviou exampl funcrelative_set_wrapp rewrit posit rel initi posit codeblock python def rel_scandetector motor start stop num absolut scandetector motor start stop num rel relative_set_wrapperabsolut motor yield rel subtl remark power featur wrapper like funcrelative_set_wrapp oper gener instanc like scan correspond decor function like relative_set_decor oper gener function like funcscan codeblock python use decor modifi gener function def rel_scandetector motor start stop num relative_set_decoratormotor unfamiliar syntax see box def inner_relative_scan yield scandetector motor start stop num yield inner_relative_scan incident name inner_relative_scan intern variabl choos verbos name name f would work cours use descript name make debug easier navig gnarli deepli nest traceback help intern variabl clear name note decor syntax succinct way pass function anoth function codeblock python g def f pass f equival codeblock python gf builtin preprocessor currentmodul blueskypreprocessor follow function name something_wrapp oper gener instanc correspond function name something_decor oper gener function autosummari nosignatur toctre gener baseline_decor baseline_wrapp contingency_wrapp finalize_decor finalize_wrapp fly_during_decor fly_during_wrapp inject_md_decor inject_md_wrapp lazily_stage_decor lazily_stage_wrapp monitor_during_decor monitor_during_wrapp relative_set_decor relative_set_wrapp reset_positions_decor reset_positions_wrapp run_decor run_wrapp stage_decor stage_wrapp subs_decor subs_wrapp suspend_decor suspend_wrapp custom preprocessor preprocessor implement use funcmsg_mut alter messag place funcplan_mut insert messag plan remov messag easiest learn exampl studi implement builtin processor catalogu sourc plan modul httpsgithubcomnslsiiblueskyblobmasterblueskyplanspy_ _per_step_hook custom step scan per_step onedimension multidimension plan compos setup loop plan perform posit cleanup provid hook custom step enabl write variat exist plan without start scratch onedimension plan default inner loop codeblock python blueskyplan_stub import checkpoint abs_set trigger_and_read def one_d_stepdetector motor step inner loop step scan default function per_step param plan yield checkpoint yield abs_setmotor step waittru return yield trigger_and_readlistdetector motor userdefin function custom_step signatur use place codeblock python scandet motor per_stepcustom_step conveni could wrap definit new plan codeblock python def custom_scandetector motor start stop step mdnone yield scandet motor start stop step mdmd per_stepcustom_step multidimension plan default inner loop codeblock python blueskyutil import short_uid blueskyplan_stub import checkpoint abs_set wait trigger_and_read def one_nd_stepdetector step pos_cach inner loop ndimension step scan default function per_step param nd plan paramet detector iter devic read step dict map motor posit step pos_cach dict map motor lastset posit def move yield checkpoint grp short_uidset motor po stepitem po pos_cachemotor step move motor continu yield abs_setmotor po groupgrp pos_cachemotor po yield waitgroupgrp motor stepkey yield move yield trigger_and_readlistdetector listmotor likewis custom function signatur may pass per_step argument multidimension plan asynchron plan fli scan monitor see section docasync context term near end section exampl plan _plan_util plan util use util defin custom plan plan preprocessor autosummari toctre gener nosignatur pchain msg_mutat plan_mut single_gen make_decor currentmodul blueskyrun_engin runengin api document runengin autosummari nosignatur toctre gener runengin main user entri point tho runengin remy_plan autosummari nosignatur toctre gener runengine__call__ runengin maintain callback registri function receiv docdocu gener plan execut method add remov function registri autosummari nosignatur toctre gener runenginesubscrib runengineunsubscrib runengin paus state resum stop refvari way interactive_pause_summari use method autosummari nosignatur toctre gener runengineresum runengineabort runenginestop runenginehalt runengin suspend resum plan execut respons extern chang see refsuspend autosummari nosignatur toctre gener runengineinstall_suspend runengineremove_suspend runengineclear_suspend method use intern paus suspend runengin typic user accomplish ctrlc instal suspend respect special applicaiton call directli autosummari nosignatur toctre gener runenginerequest_paus runenginerequest_suspend method may use regist custom command supplement replac builtin command recogn runengin autosummari nosignatur toctre gener runengineregister_command runengineunregister_command method may use list command avail print summari autosummari nosignatur toctre gener runengineprint_command_registri runenginecommand runengineresult classrunengineresult return runengin creat call_returns_resulttru default current fals behavior optin chang optout futur classrunengineresult class encapsul use inform plan run includ ultim plan return valu run uid exit statu except autosummari nosignatur toctre gener runengineresult dispatch runengin encapsul classdispatch emit docdocu gener plan execut method methrunenginesubscrib methrunengineunsubscrib document alias correspond method runengin dispatch autosummari nosignatur toctre gener dispatch dispatchersubscrib dispatcherunsubscrib dispatcherunsubscribe_al dispatcherprocess runbundl runengin also creat runbundl instanc encapsul logic book keep gener event allow multipl run open gener directli work runbundl currentmodul blueskybundl autosummari nosignatur toctre gener runbundl coroutin open close run autosummari nosignatur toctre gener runbundleropen_run runbundlerclose_run coroutin open fill close drop event autosummari nosignatur toctre gener runbundlercr runbundlerread runbundlerdrop runbundlersav coroutin manag flyer autosummari nosignatur toctre gener runbundlerkickoff runbundlercomplet runbundlercollect runbundlerbackstop_collect coroutin chang devic configur autosummari nosignatur toctre gener runbundlerconfigur coroutin manag monitor autosummari nosignatur toctre gener runbundlermonitor runbundlersuspend_monitor runbundlerrestore_monitor runbundlerclear_monitor runbundlerunmonitor coroutin checkpoint manag autosummari nosignatur toctre gener runbundlerclear_checkpoint runbundlerreset_checkpoint_st runbundlerreset_checkpoint_state_coro runbundlerrewind coroutin record interrupt autosummari nosignatur toctre gener runbundlerrecord_interrupt multirun plan introduct section brief tutori multirun plan introduc blueski v tradit singlerun plan contain set instruct perform one run assign scan id uid multirun plan execut run engin multipl run perform part singl plan data run independ display save databas via databrok prior version blueski support sequenti execut multipl run within plan build larger plan creat sequenc smaller plan preassembl plan ship blueski standard practic blueski v number featur introduc allow plan nest run two run consid nest one outer run interrupt anoth inner run execut first run resum complet number level nest limit blueski interrupt initi plan simpli open anoth run close current execut run extern eg trigger suspend caus execut pre postplan tutori includ brief explan new blueski featur support multirun plan sever exampl demonstr implement plan contain sequenti nest recurs run definit run point view blueski run sequenc instruct messag control instrument equip start open_run end close_run messag may also appli term run block code gener sequenc messag data run bundl togeth via assign distinct scan id uid set document also gener run includ mandatori start stop document document process callback besteffortcallback save databas via databrok plan run may defin explicit enclos code bpsopen_run bpsclose_run stub codeblock python use bpsopen_run bpsclose_run stub defin run import blueskyplan_stub bp blueski import runengin runengin def sample_plan yield bpsopen_runmd md metadata ad start document code control execut scan yield bpsclose_run resample_plan use bpprun_decor insert open_run close_run control messag sequnc gener enclos code codeblock python use bpprun_decor defin run import blueskypreprocessor bpp blueski import runengin runengin bpprun_decoratormd md metadata ad start document def sample_plan code control execut scan resample_plan rule basic blueski plan requir current run scan close next scan open therefor follow code work codeblock python code work sinc first run close second one open import blueskyplan_stub bp blueski import runengin runengin def sample_plan yield bpsopen_runmd code control execut scan yield bpsclose_run close first run scan yield bpsopen_runmd open second run scan code control execut scan yield bpsclose_run resample_plan follow code fail codeblock python code fail sinc second run open first run close import blueskyplan_stub bp blueski import runengin runengin def sample_plan yield bpsopen_runmd open first run code control execut scan yield bpsopen_runmd open second run first one close code control execut scan yield bpsclose_run yield bpsclose_run resample_plan note preassembl plan blueskyplanscount blueskyplanslist_scan complet singlerun plan enclos open_run close_run messag therefor follow code fail well codeblock python code fail attempt start preassembl plan open run import blueskyplan_stub bp blueskyplan import count blueski import runengin runengin def sample_plan yield bpsopen_runmd start first run code control execut scan yield bppcountsom argument attempt run preassembl plan open run yield bpsclose_run resample_plan exampl situat preassembl plan call anoth open run preassembl plan includ suspend pre postplan suspend trigger current run interrupt close pre postplan attempt open anoth run mechan case nest run see result run engin fail reason two previou code exampl new multirun plan blueski featur allow implement nest plan well includ fullfeatur scan pre postplan blueski featur support multirun plan order handl simultan open run within plan run engin look run key attribut control messag decid scan current execut default valu run key none could manual set plan block code defin run run key valu may type strongli recommend manual assign run key humanread inform string new inner run open within outer run run key inner outer scan differ otherwis plan exectuion fail run key use run engin maintain state run independ open run includ run metadata scan id uid emit document metadata use rout document appropri callback document save use databrok metadata allow associ document run retriev run data databas run key assign block code use bppset_run_key_wrapp bppset_run_key_decor codeblock python import blueskypreprocessor bpp blueski import runengin use decor bppset_run_key_decoratorrun_key_example_ bpprun_decoratormd def sample_plan code control execut run resample_plan blueskyplan import scan ophydsim import hw det motor hwdet hwmotor use wrapper scandet motor s_wrap bppset_run_key_wrapp run_key_example_ res_wrap implement bppset_run_key_decor bppset_run_key_wrapp replac default valu none attribut run messag gener within enclos block userdefin run key bppset_run_key_decor bppset_run_key_wrapp primarili intend appli function contain run implement may also use block plan code exampl one may write plan simultan open multipl run execut parallel gener group messag run id open scan current recommend attempt develop risk plan sequenti run sequenti call multipl run support older version blueski need use multirun plan featur run overlap next run open previou run close run key still assign run need follow exampl two preassembl plan call sequenc run engin subscrib singl instanc besteffortcallback set display data specif run run open literalinclud examplesmulti_run_plans_sequentialpi ipython python suppress run multi_run_plans_sequenti ipython python replan_sequential_run plan nest run follow exampl illustr use bppset_run_key_decor implement two nest run outer run interrupt measur call inner run complet measur outer inner run assign differ run id run_ run_ note bppset_run_key_decor outer run overwrit run id inner scan despit fact gener insid enclos code sinc decor design replac run id attribut messag default valu none ie run id messag replac decor first time process decor multipl run open simultan run need subscrib instanc callback standard runengin subscript mechan provid capabl instead subscript perform via runrout code follow exampl demonstr use besteffortcallback monitor data multipl nest run literalinclud examplesmulti_run_plans_nestedpi output plan contain data two run run assign id uid tabl run print two separ instanc besteffortcallback data two tabl print order acquisit tabl inner run print gap tabl outer run ipython python suppress run multi_run_plans_nest ipython python resim_plan_out wrapper bppset_run_key_wrapp use instead decor exampl run sim_plan_inn previou exampl rewritten follow codeblock python def sim_plan_innernpt def f j rangenpt yield bpsmovhwmotor j hwmotor j yield bpstrigger_and_readhwmotor hwmotor hwdet f bpprun_wrapperf md return bppset_run_key_wrapperf run_ subscript callback via runrout provid flexibl subscrib run set callback follow exampl run_key ad start document metadata use distinguish two run function factori perform callback subscript literalinclud examplesmulti_run_plans_select_cbpi ipython python suppress run multi_run_plans_select_cb ipython python resim_plan_out case may necessari implement run could interrupt new instanc run start exampl suspend pre postplan may contain run take substanti time execut run may interrupt suspend repeatedli trigger caus anoth instanc pre postplan start first one still open state process similar recurs call run run includ instruct call recurs call possibl uniqu run key assign run time start follow exampl illustr dynam gener run key plan may practic purpos besid demonstr principl plan call recurs multipl time global counter n_call reach maximum valu n_calls_max uniqu run key gener call literalinclud examplesmulti_run_plans_recursivepi ipython python suppress run multi_run_plans_recurs ipython python resim_plan_recurs ident result achiev use bppset_run_key_wrapp codeblock python call counter maximum number call n_call n_calls_max def sim_plan_recursivenpt global n_call n_calls_max n_call increment counter n_call n_calls_max gener uniqu key run key gener algorithm must guarante execut run assign key never overlap time run_key frun_key_n_cal bpprun_decoratormd def plannpt j rangeintnpt yield bpsmovhwmotor j yield bpstrigger_and_readhwmotor hwdet differ paramet valu may pass recurs call plan yield sim_plan_recursivenpt j rangeintnpt npt yield bpsmovhwmotor j yield bpstrigger_and_readhwmotor hwdet yield bppset_run_key_wrapperplannpt run_key comparison spec spec httpswwwcertifcomcontentspec_ popular softwar packag instrument control data acquisit mani user synchrotron commun blueski origin know spec ask differenti motiv blueski answer question inform unbias way difficult welcom correct mani good featur spec incorpor blueski includ simpl command common experi use build block complex procedur easi hardwar configur interrupt handl ctrlc integr epic potenti instrument control system pseudomotor present virtual axe integr reciproc space transform code blueski also address certain limit spec fair spec benefit learn decad use stand shoulder modern opensourc commun blueski free opensourc aspect macro spec user commun opensourc core spec c sourc code close free blueski provid control consol output plot spec design larg area detector exist ingest area detector data possibl ad hoc blueski area detector higherdimension input integr natur spec write custom textbas format spec file blueski writein real time post factoto format spec simul mode blueski allow user incorpor much richer simul capabl version provid less spec box use python generalpurpos program languag give sever immedi advantag python check syntax automat python provid tool interact debug mani resourc learn python languag flexibl easi integr scientif python ecosystem blueski tri go spec regard complex custom procedur easier express autom suspens paus resum consist easier manag prevail model spec collect data step scan type scanssuch fli scan asynchron monitoringcan done ad hoc blueski support sever modal data acquisit equal eas blueski acquir multipl asynchron uncoordin stream data repres simpl doceventbas data model document easi build tool inspectsimul procedur run check safeti estim time complet visual behavior blueski librari work well interact also use programmat script librari user add arbitrari metadata rich semant includ larg array mask nest map blueski holist solut data acquisit manag user push live stream data directli data process analysi pipelin andor export file hand one major advantag spec blueski matur spec battleharden decad use mani facil larg user commun blueski young project remark syntax spec user immedi notic simpl blueski command verbos counterpart spec tradeoff made choos express generalpurpos languag singlepurpos command line interfac easi integr scientif librari come cost parenthes comma differ also due richer abstract requir captur complex modern hardwar simplest command made less ters interest command made much easier express cours user save time use tabcomplet access previou command arrow key event descriptor section docdocu gave overview four kind document present exampl run start event run stop defer detail discuss event descriptor recal exampl event document codeblock python event document shown refer data temperatur x_setpoint x_readback timestamp temperatur x_setpoint x_readback time seq_num uid randomlygener uniqu id descriptor refer descriptor document typic experi gener multipl event document data key exampl might ten sequenti read gener ten event document like one differ read timestamp ident data key event refer back descriptor metadata data key configur devic involv note got term data key eventdatakey exampl data key temperatur x_setpoint x_readback data key first descriptor provid metadata data key dtype number string array object dict shape none list dimens like x array sourc descript hardwar uniqu identifi epic process variabl option extern string specifi extern data larg imag array store arbitrari addit field allow precis unit runengin obtain inform devic see call devicedescrib codeblock python excerpt descriptor document data_key temperatur dtype number sourc descript string shape unit k precis x_setpoint dtype number sourc descript string shape unit mm precis x_readback dtype number sourc descript string shape unit mm precis object key object_key provid associ devic data key need given devic produc multipl data key exampl suppos x_readback x_setpoint data key exampl came devic motor name x codeblock python excerpt descriptor document object_key x x_setpoint x_readback temp_ctrl temperatur specif map devicenam listdevicedescrib configur complex devic often mani paramet need read anew everi data point configur mean dont typic chang middl run detector exposur time usual alway categori devic delin two provid two differ method runengin call deviceread return normal read consid configur deviceread_configur return read consid configur first time run runengin told read devic read devic configur also return valu devicedescribe_configur record configurationdevicenamedata_key return valu deviceread_configur collat configurationdevicenamedata configurationdevicenametimestamp exampl x one configur data key temp_ctrl happen provid configur inform codeblock python excerpt descriptor document configur x data offset timestamp offset data_key offset dtype number sourc descript string shape unit mm precis temp_ctrl data timestamp data_key hint experiment featur devic provid inform via hint attribut store see refhint codeblock python excerpt descriptor document hint x field x_readback temp_ctrl field temperatur complet sampl taken togeth exampl descriptor document look like codeblock python complet descriptor document data_key temperatur dtype number sourc descript string shape unit k precis x_setpoint dtype number sourc descript string shape unit mm precis x_readback dtype number sourc descript string shape unit mm precis object_key x x_setpoint x_readback temp_ctrl temperatur configur x data offset timestamp offset data_key offset dtype number sourc descript string shape unit mm precis temp_ctrl data timestamp data_key hint x field x_readback temp_ctrl field temperatur time uid randomlygener uniqu id run_start refer start document ipython magic experiment warn section cover experiment featur blueski may alter remov futur magic ipython interact python interpret design scientist includ featur call magic conveni command arent part python languag exampl histori magic ipython python b histori ipython document document complet list builtin magic httpsipythonreadthedocsioenstableinteractivemagicshtml_ defin custom magic httpsipythonreadthedocsioenstableconfigcustommagicshtml_ blueski magic bundl blueski ipython magic intend mainten task casual saniti check intent none magic save data use runengin plan use magic first regist ipython ipython python blueskymag import blueskymag get_ipythonregister_magicsblueskymag exampl well use simul hardwar ipython python ophydsim import motor motor move motor suppos want move motor interact use mov magic ipython python mov motor motor refer actual ophyd object equivan codeblock python blueskyplan_stub import mv remvmotor less type also movr magic rel move move multipl devic parallel like ipython python mov motor motor note magic chang version v onward previou method describ next section take read use ct post v may make use power magic count must label hardwar add label must give hardwar labelsmylabel keyword argument exampl initi five simul signal two motor shutter motor area detector point detector ipython python import numpi np ophydsim import synaxi synsign motor synaxisnamemotor labelsmotor scan_motor motor synaxisnamemotor labelsmotor scan_motor shutter_motor synaxisnameshutter_motor labelsmotor shutter_motor creat fake area detector return x array area_detector synsignalfunclambda nprandomrandom nameadet labelsdetector area_detector point_detector synsignalfunclambda nprandomrandom namepointdet labelsdetector point_detector detector motor proper label suppos want take quick read devic print result screen without save fanci process use ct magic ipython python ct area_detector name count list whitespac separ label case area_detector count run ct without argument look detector label default ipython python ct case count area detector point detector asid automag featur ipython ipython automag featur enabl ipython even let drop long mean unambigu ipython python ct ct ct variabl automag work ct magic still work ct worth recommend disabl automag use flag follow magic nonpython code list avail motor use wa post v final wa magic display list label devic ipython python wa scan_motor display motor use scan blank print label devic ipython python wa note possibl give devic one label thu possibl devic one list call wa user decid whether want overlap label comparison spec name magic order paramet take meant feel familiar user docspec comparisonwithspec must regist ipython use codeblock python blueskymag import blueskymag get_ipythonregister_magicsblueskymag take read use ct pre v previous could set default list detector use ct without paramet behaviour deprec use ipython python okwarn blueskymagicsdetector area_detector point_detector ct longer support list avail motor use wa pre v previous possibl suppli list motor featur also deprec use ipython python okwarn blueskymagicsposition motor motor wa magic plan invok mov funcblueskyplan_stubsmv movr funcblueskyplan_stubsmvr ct funcblueskyplanscount wa survey position tutori begin note nslsii deploy free public sandbox tri softwar browser use jupyt notebook need instal softwar skip rest section go httpstrynslsbnlgov httpstrynslsbnlgov_ need python newer shell termin osx command prompt window check current python version codeblock bash python version version less must updat recommend instal blueski virtual environ instal interfer exist python softwar codeblock bash python venv blueskytutori sourc blueskytutorialbinactiv altern conda httpscondaiodocsuserguideinstalldownloadhtml_ user creat conda environ codeblock bash conda creat n blueskytutori python conda activ blueskytutori instal latest version blueski ophyd also instal databrok unless plan skip section access save data want follow along visual exampl instal matplotlib pyqt final instal ipython python interpret design scientist scientist codeblock bash python pip instal upgrad blueski ophyd databrok matplotlib pyqt ipython pyepic altern conda user prefer conda packag use codeblock bash conda instal c nslsforg blueski ophyd databrok matplotlib pyqt ipython start ipython codeblock python ipython matplotlibqt flag matplotlibqt necessari liveupd plot work wish use blueski jupyt notebook instal kernel like codeblock python ipython kernel instal user nameblueskytutori displaynam python blueski may start jupyt environ alreadi instal instal environ alongsid blueski run codeblock python pip instal notebook jupyt notebook get lost confus want know friendli chat channel httpsgitterimnslsiidama_ file bug httpsgithubcomnslsiibugreportsissues_ let us know document could made clear _tutorial_run_engine_setup runengin blueski encod experiment procedur plan sequenc atom instruct runengin interpret plan let us focu logic experiment procedur handl import technic detail consist commun hardwar monitor interrupt organ metadata data coordin io ensur hardwar left safe state exit time separ executor runengin instruct set plan pay sever way see exampl follow note visit user facil run blueski skip section go straight refcommon_experi runengin alreadi configur ignor defin may overrid preconfigur default result data loss check type runengin alreadi configur get someth like ipython verbatim blueskyrun_enginerunengin xfdd skip rest section give nameerror youll need finish section creat runengin codeblock python blueski import runengin runengin ipython python suppress use later demo blueski import runengin runengin runengin readi use care visual save data first data acquisit runengin dispatch live stream metadata data one consum callback inlin data process visual longterm storag exampl consum includ liveupd plot curvefit algorithm databas messag queue file prefer format see doccallback detail prepar live visual start let use allpurpos classblueskycallbackbest_effortbesteffortcallback codeblock python blueskycallbacksbest_effort import besteffortcallback bec besteffortcallback send metadatadata captur besteffortcallback resubscribebec make plot updat live scan run blueskyutil import install_kick install_kick ipython python suppress use later demo blueskycallbacksbest_effort import besteffortcallback bec besteffortcallback resubscribebec classblueskycallbackbest_effortbesteffortcallback receiv metadatadata real time produc plot text best provid live feedback strike right balanc comprehens overwhelm tailor feedback custom particular experi may configur custom callback start read docdocu structur blueski organ metadata data captur experi tutori mani real experi classblueskycallbackbest_effortbesteffortcallback suffic prepar data storag _databroker_setup databrok httpsnslsiigithubio_ librari develop tandem blueski interfac searchabl storag metadata data gener blueski tutori spin databrok back temporari file codeblock python databrok import broker db brokernamedtemp insert metadatadata captur db resubscribedbinsert ipython python suppress use later demo databrok import broker db brokernamedtemp resubscribedbinsert warn exampl make temporari databas use import data data becom difficult access python exit variabl db delet run brokernamedtemp second time creat fresh separ temporari databas add progress bar option configur progress bar codeblock python blueskyutil import progressbarmanag rewaiting_hook progressbarmanag see docprogressbar detail configur let take data _common_experi common experi plan read detector begin simpl experi trigger read detector blueski call count term art inherit spectroscopi commun tutori assum access real detector motor exampl follow use simul hardwar ophyd httpsnslsiigithubioophyd_ librari develop tandem blueski reflat section tutorial_devic see look like configur real hardwar ophyd codeblock python ophydsim import det det two simul detector use runengin count detector codeblock python blueskyplan import count det det det list number detector recountdet demo ipython python suppress blueskyplan import count ophydsim import det det det det det ipython python recountdet key featur blueski detector could simpl photodiod complex ccd detail captur implement devic point view blueski detector python object certain method see funcblueskyplanscount option also view document ipython type count tri follow variat codeblock python five consecut read recountdet num five sequenti read separ second delay recountdet num delay variabl delay recountdet num delay funcblueskyplanscount function precis python gener function exampl plan sequenc instruct encod experiment procedur well get better sens design use continu briefli empow us introspect instruct execut check accuraci safeti estim durat etc interrupt rewind instruct safe point resum interact automat eg middl night reus gener set instruct differ hardwar modifi instruct programmat insert set baselin read taken automat everi experi warn notic enter plan doesnt anyth ipython python suppress blueskyplan import count ophydsim import det det det ipython python countdet num mean execut plan must use runengin ipython python recountdet num scan use funcblueskyplansscan scan motor ten equallyspac step wait arriv step trigger read detector det codeblock python ophydsim import det motor blueskyplan import scan det det one case could one rescandet motor ipython python suppress blueskyplan import scan ophydsim import det motor det det ipython python rescandet motor plot blueskyplan import scan ophydsim import det motor det det rescandet motor key featur blueski motor may movabl devic includ temperatur control sampl changer pseudoaxi point view blueski runengin object python certain method addit produc tabl plot classblueskycallbackbest_effortbesteffortcallback comput basic peak statist click plot area press shiftp peak visual data number center mass max etc avail dictionari stash becpeak updat end run cours peak statist applic may ignor featur use funcblueskyplansrel_scan scan rel current posit codeblock python blueskyplan import rel_scan rerel_scandet motor use funcblueskyplanslist_scan scan point arbitrari space codeblock python blueskyplan import list_scan point relist_scandet motor point complet list scan variat plan see docplan _tutorial_multiple_motor scan multipl motor togeth two differ thing might mean phrase scan multipl motor togeth case mean move n motor along line step move x motor along diagon case move n motor m_ x m_ x x m_n grid address next section spec user may recogn case analog ascan dscan arbitrari number dimens two well use plan use previou section alreadi import need codeblock python blueskyplan import scan rel_scan well use two new motor new detector coupl via simul simul gaussian peak center emphas motor could anyth set temperatur control pseudoaxi sampl changer codeblock python ophydsim import det motor motor det det one case could one plan funcblueskyplansscan funcblueskyplansrel_scan accept multipl motor codeblock python rescandet motor scan motor motor scan motor step line break intend make command easier visual pars technic meaning may take leav demo ipython python suppress blueskyplan import scan ophydsim import det motor motor det det ipython python rescandet motor scan motor motor scan motor step plot blueskyplan import scan ophydsim import det motor motor det det rescandet motor scan motor motor scan motor step work number motor two tri import motor ophydsim run motor scan move motor along arbitrari trajectori instead equallyspac point use funcblueskyplanslist_scan funcblueskyplansrel_list_scan codeblock python blueskyplan import list_scan scan motor motor jointli point trajectori relist_scandet motor motor demo ipython python suppress blueskyplan import list_scan ipython python relist_scandet motor motor plot blueskyplan import list_scan ophydsim import det motor motor det det relist_scandet motor motor scan multipl motor grid case scan n motor ndimension rectangular grid well use simul hardwar previou section codeblock python ophydsim import det motor motor det det one case could one well use new plan name funcblueskyplansgrid_scan codeblock python blueskyplan import grid_scan let start xx grid codeblock python regrid_scandet motor scan motor step motor scan motor step motor scan motor step order motor control grid travers slowest axi come first numpi user appreci consist numpi convent index multidimension array option paramet snake_ax use control motor trajectori snake back forth snakelik path usual effici suitabl certain hardwar disabl default enabl snake specif axe give list like snake_axesmotor sinc first slowest axi travers elig includ snake_ax conveni may use snake_axestru enabl snake except first axi plot blueskysimul import plot_raster_path ophydsim import motor motor det blueskyplan import grid_scan import matplotlibpyplot plt snake grid_scandet motor motor snake_axestru not_snak grid_scandet motor motor fig ax ax pltsubplot shareytru plot_raster_pathsnak motor motor probe_s axax plot_raster_pathnot_snak motor motor probe_s axax axset_titletru axset_titlefals axset_xlim axset_xlim demo ipython python suppress blueskyplan import grid_scan ophydsim import motor motor det det det ipython python regrid_scandet motor scan motor step motor scan motor step plot blueskyplan import grid_scan ophydsim import motor motor det det det regrid_scandet motor scan motor step motor scan motor step move motor along arbitrari trajectori instead equallyspac point use funcblueskyplanslist_grid_scan funcblueskyplansrel_list_grid_scan codeblock python blueskyplan import list_grid_scan relist_grid_scandet motor motor demo ipython python suppress blueskyplan import list_grid_scan ipython python relist_grid_scandet motor motor plot blueskyplan import list_grid_scan ophydsim import det motor motor det det relist_grid_scandet motor motor see refmultidimensional_scan handl special case includ combin funcblueskyplansscanlik funcblueskyplansgrid_scanlik movement gener docplan document includ exot trajectori spiral plan adapt logic effici peakfind asid access save data point natur wonder access save data point view blueski that realli blueski concern reason question well address typic scenario note section presum use databrok configur one refan earlier section tutori databroker_setup dont use databrok use blueski one conveni way captur metadata data gener runengin briefli access save data refer dataset run uniqu id return runengin collect time ipython python blueskyplan import count ophydsim import det uid recountdet num header dbuid altern perhap conveni access recenc ipython python header db mean run ago ie recent run note assum plan gener one run dataset typic simpl plan like funcblueskyplanscount gener case plan gener multipl run return multipl uid turn caus db return list header one codeblock python uid resome_plan header dbuid list header use metadata dictionari ipython python headerstart primari stream data access like ipython python headert return tabl pandasdatafram refer databrok tutori httpsnslsiigithubiodatabrokertutorialhtml_ _tutorial_simple_custom simpl custom save type partial suppos nearli alway use detector tire type countdet write custom variant funcblueskyplanscount use builtin function provid python funcfunctoolsparti codeblock python functool import partial blueskyplan import count ophydsim import det my_count partialcount det remy_count equival recountdet addit argument my_count pass count remy_countnum delay plan seri custom plan dispatch plan use python syntax yield see refappendix yield_from_prim want know exampl codeblock python blueskyplan import scan def coarse_and_finedetector motor start stop scan start stop step step yield scandetector motor start stop yield scandetector motor start stop recoarse_and_finedet motor plan introduc thu far import modblueskyplan gener data set run plan modblueskyplan_stub modul smaller oper use alon combin build custom plan funcblueskyplan_stubsmv plan move one devic wait arriv codeblock python blueskyplan_stub import mv ophydsim import motor motor move motor motor simultan wait arriv remvmotor motor combin funcblueskyplan_stubsmv funcblueskyplanscount one plan like codeblock python def move_then_count move motor motor posit count det yield mvmotor motor yield countdet remove_then_count import rememb yield follow plan noth plan insid defin never execut codeblock python wrong exampl def oop forgot yield mvmotor motor countdet much richer custom possibl well leav refa later section tutori tutorial_custom_plan see also complet list refplan stub stub_plan warn never put insid loop function alway call directli type user termin might tempt write script like codeblock python blueskyplan import scan ophydsim import motor det dont j printj step rescandet motor j function like codeblock python dont def bad_funct j printj step rescandet motor j instead codeblock python blueskyplan import scan ophydsim import motor det def good_plan j printj step yield scandet motor j remy_plan tri hide insid function someon later might use function insid anoth function enter exit runengin multipl time singl prompt lead unexpect behavior especi around handl interrupt error indulg music metaphor plan sheet music hardwar orchestra runengin conductor one conductor need run whole show start finish baselin read supplement data addit detector motor primari interest experi commonli use take snapshot baselin read hardwar inform typic use check consist time temperatur sampl mount roughli last week ideal wed like automat captur read devic futur experi without extra thought type per experi blueski provid specif solut configur note visit user facil run blueski may need configur skip next subsect refchoose_baseline_devic type sd check get someth like ipython verbatim sd supplementaldatabaselin monitor flyer skip configur begin littl runengin configur like reftutorial_run_engine_setup section resubscrib codeblock python blueskypreprocessor import supplementaldata sd supplementaldata repreprocessorsappendsd ipython python suppress blueskypreprocessor import supplementaldata sd supplementaldata repreprocessorsappendsd _choose_baseline_devic choos baselin devic well choos detectorsmotor want read automat begin end dataset run use share configur also might alreadi done check content sdbaselin alter ipython python sdbaselin current empti suppos want take baselin read three detector two motor well import hand simul devic purpos put list assign sdbaselin ipython python ophydsim import det det det motor motor sdbaselin det det det motor motor notic put mixtur detector motor list doesnt matter blueski movabl go read detector motor read use scan detector motor primari interest runengin automat take baselin read run demo ipython python ophydsim import det motor blueskyplan import scan rescandet motor clear updat list baselin detector time ipython python sdbaselin asid one place design blueski realli pay separ executor runengin instruct set plan easi appli global configur without updat everi plan individu access baselin data access data baselin scan might think baselin data miss ipython python header db headert look output execut scan notic line codeblock none new stream baselin new stream primari default headert give us primari data stream ipython python headertableprimari result headert access stream name ipython python headertablebaselin list stream name given run avail headerstream_nam refer databrok tutori httpsnslsiigithubiodatabrokertutorialhtml_ supplement data use sdbaselin also sdmonitor signal monitor asynchron run sdflyer devic flyscan run see refsupplemental_data detail _tutorial_pause_resume_suspend paus resum suspend interact paus resum sometim conveni paus data collect check thing either resum left quit runengin make possibl cleanli safe plan includ userdefin plan minim effort user cours experi system evolv time cant arbitrarili paus resum user know use featur applic take exampl step scan ten point codeblock python ophydsim import det motor blueskyplan import scan motordelay simul slow motor movement rescandet motor demo ipython verbatim rescandet motor transient scan id time persist uniqu scan id cdbbbfbffbfbdf new stream primari seq_num time motor det point decid hit ctrlc sigint runengin catch signal react like examin output piec piec codeblock none c defer paus requestedth runengin paus next checkpoint paus immedi hit ctrlc next second defer paus acknowledg continu checkpoint second later paus runengineinterrupt traceback recent call last ipythoninputeedfb modul rescandet motor snip detail runengineinterrupt runengin enter paus state option chang state runengin reresum resum plan reabort perform cleanup kill plan mark exit_statsabort restop perform cleanup kill plan mark exit_statussuccess rehalt emerg stop perform cleanup stop paus runengin immedi tell devic touch far stop devic defin mean stop method replac proper equip protect conveni leisur may paus think investig state hardwar detector exposur time turn verbos log see docdebug decid whether stop resum suppos decid resum runengin pick last checkpoint typic mean begin step scan plan may specifi checkpoint anywher like ipython verbatim reresum gener scan cdbbb scan num scan complet success go back read output hit ctrlc notic runengin didnt paus immedi finish current step scan first quot excerpt demo codeblock none c defer paus requestedth runengin paus next checkpoint paus immedi hit ctrlc next second defer paus acknowledg continu checkpoint second later paus observ hit ctrlc twice paus immedi without wait finish current step codeblock none rescandet motor transient scan id time persist uniqu scan id bfafafcb new stream primari seq_num time motor det cc paus resum runengin rewind last checkpoint begin fourth step scan repeat instruct need quot demo notic reresum one option decid continu quit three differ way codeblock none runengin enter paus state option chang state runengin reresum resum plan reabort perform cleanup kill plan mark exit_statsabort restop perform cleanup kill plan mark exit_statussuccess rehalt emerg stop perform cleanup stop abort stop almost thing record differ metadata experi end signal plan end earli still let specifi instruct clean exampl funcblueskyplansrel_scan move motor back start posit quit rare case worri plan cleanup procedur might danger halt halt circumv cleanup instruct tri execut rescandet motor paus exit variou way observ runengin wont let run new plan resolv paus plan use one method autom suspend resum runengin configur advanc automat paus resum respons extern signal distinguish automat pauseresum interact useriniti paus resum call behavior suspend detail see refsuspend _tutorial_metadata metadata user pass extra keyword argument interpret metadata codeblock python recountdet userdan moodskept recountdet userdan moodoptimist use search later codeblock python header dbuserdan header dbmoodskept metadata also ad persist ie appli futur run remov edit dictionari remd codeblock python remd remdus dan need specifi user everi time codeblock python recountdet automat includ userdan key temporarili overridden codeblock python recountdet usertom overrid set remd delet codeblock python del remdus addit userprovid metadata runengin devic plan captur metadata automat see docmetadata simul introspect plan refer plan sequenc instruct encod experiment procedur what insid plan realli blueski call atom instruct insid plan messag handl messag directli necessari debug unusu deep custom help see least move practic tool tri print everi messag coupl simpl plan codeblock python blueskyplan import count ophydsim import det msg count printmsg msg countdet printmsg see docmsg section blueski includ tool produc use humanread summari answer question plan ipython python blueskysimul import summarize_plan blueskyplan import count rel_scan ophydsim import det motor count detector time summarize_plancountdet step scan summarize_planrel_scandet motor possibl see docsimul _tutorial_devic devic theori notion devic serv two goal provid standard interfac hardwar sake gener code reus logic group individu signal composit devic read togeth unit configur coordin way provid humanread name group eye toward later data analysi blueski view world three differ kind devic use data acquisit devic read includ simpl point detector produc singl number larg ccd detector produc big array devic read set set motor physic move new posit set temperatur control impel gradual chang temperatur set exposur time detector promptli updat configur devic produc data rate high read real time instead buffer data extern separ hardwar softwar read blueski interact devic via docspecifi interfac hardwar devic repres python object certain method attribut name like read set method asynchron set allow concurr movement multipl devic implement ophyd httpsnslsiigithubioophyd_ python librari develop tandem blueski implement interfac devic speak epic httpwwwapsanlgovepics_ blueski tie ophyd epic specif python object may use long provid specifi method attribut blueski expect exampl experiment implement blueski interfac labview written see refhardwar interfac packag hardware_interface_packag exampl simul hardwar use tutori base purepython construct unconnect hardwar specif hardwar control protocol get flavor look like configur hardwar ophyd connect epic motor look like codeblock python ophyd import epicsmotor nano_top_x epicsmotorxfidesdifnanoaxtopxmtr namenano_top_x provid machineread address motor network xfidesdifnanoaxtopxmtr epic jargon pv process variabl humanread name nano_top_x use label data gener motor come time analyz data grate deal humanread label epicsmotor devic logic group mani signal import readback actual posit setpoint target posit signal summar thu detail arent import stage takeaway messag lot stuff keep track motor devic help group stuff us codeblock none nano_top_xsummari data key hint nano_top_x nano_top_x_user_setpoint read attr user_readback epicssignalro nano_top_x user_setpoint epicssign nano_top_x_user_setpoint config key nano_top_x_acceler nano_top_x_motor_egu nano_top_x_user_offset nano_top_x_user_offset_dir nano_top_x_veloc configur attr motor_egu epicssign nano_top_x_motor_egu veloc epicssign nano_top_x_veloc acceler epicssign nano_top_x_acceler user_offset epicssign nano_top_x_user_offset user_offset_dir epicssign nano_top_x_user_offset_dir unus attr offset_freeze_switch epicssign nano_top_x_offset_freeze_switch set_use_switch epicssign nano_top_x_set_use_switch motor_is_mov epicssignalro nano_top_x_motor_is_mov motor_done_mov epicssignalro nano_top_x_motor_done_mov high_limit_switch epicssign nano_top_x_high_limit_switch low_limit_switch epicssign nano_top_x_low_limit_switch direction_of_travel epicssign nano_top_x_direction_of_travel motor_stop epicssign nano_top_x_motor_stop home_forward epicssign nano_top_x_home_forward home_revers epicssign nano_top_x_home_revers _tutorial_custom_plan write custom plan mention reftutorial_simple_custom section preassembl plan funcblueskyplanscount funcblueskyplansscan built smaller plan stub mix match stub andor preassembl plan build custom plan mani plan stub conveni import whole modul work codeblock python import blueskyplan_stub bp move parallel write custom plan coordin motion multipl devic consid whether use case could address one builtin refmultidimensional_scan previous introduc funcblueskyplan_stubsmv plan move one devic wait arriv also funcblueskyplansmvr move rel current posit codeblock python ophydsim import motor motor move motor motor unit posit direct rel current posit wait arriv rebpsmvrmotor motor scenario requir lowlevel control wait occur employ funcblueskyplan_stubswait funcblueskyplan_stubsabs_set absolut set funcblueskyplan_stubsrel_set rel set scenario requir custom solut want set sever motor motion includ multipl fast motor one slow motor want wait fast motor arriv print messag wait slow motor arriv print second messag codeblock python def staggered_waitfast_motor slow_motor start motor fast slow move put fast_motor one group motor fast_motor yield bpsabs_setmotor groupa put slow motor separ group yield bpsabs_setslow_motor groupb wait fast motor printwait fast motor yield bpswaita printfast motor place wait slow one wait slow motor yield bpswaitb printslow motor place sleep time delay note need wait motor finish move temperatur finish equilibr shutter finish open insert delay plan isnt best way devic busi report accur done includ extra pad settl equilibr devic epicsmotor configur like motorsettle_tim time delay blueski special plan allow runengin continu busi sleep codeblock python def sleepy_planmotor posit step motor list posit second delay step posit posit yield bpsmvmotor posit yield bpssleep alway use plan never python builtin function functimesleep runengin use event loop concurr manag mani task assum none task block long good figur long second therefor never incorpor long block function call plan timesleep _tutorial_capture_data captur data ipython python suppress defin exampl use interact import blueskyplan_stub bp def one_run_one_eventdetector yield bpsopen_run yield bpstrigger_and_readdetector yield bpsclose_run def one_run_multi_eventsdetector num yield bpsopen_run rangenum yield bpstrigger_and_readdetector yield bpsclose_run def multi_runs_multi_eventsdetector num num_run rangenum_run yield one_run_multi_eventsdetector num plan gener data must includ instruct group read event ie row tabl group event run dataset given scan id best explain exampl codeblock python import blueskyplan_stub bp def one_run_one_eventdetector declar begin new run yield bpsopen_run trigger detector wait trigger complet read detector bundl read event ie one row tabl yield bpstrigger_and_readdetector declar end run yield bpsclose_run execut plan like ipython python reone_run_one_eventdet det observ one tabl one run one row one event two column column detector here plan funcblueskyplan_stubstrigger_and_read move insid loop codeblock python def one_run_multi_eventsdetector num yield bpsopen_run rangenum yield bpstrigger_and_readdetector yield bpsclose_run execut plan like ipython python reone_run_multi_eventsdet det observ one tabl one run three row three event two column column detector final add anoth loop reus one_run_multi_ev insid loop codeblock python def multi_runs_multi_eventsdetector num num_run rangenum_run yield one_run_multi_eventsdetector num ipython python remulti_runs_multi_eventsdet det num num_run observ two tabl two run three row three event two column column detector also notic return valu output runengin tupl two uniqu id one per run gener plan order focu scope event run left import detail address next section may necessari incorpor tri plan real devic stage unstag complex devic often requir preliminari setup use data collect move rest state state readi acquir data blueski accommod gener way allow everi devic implement option stage method correspond unstag method plan stage everi devic touch exactli unstag everi devic end devic stage method runengin skip revis simplest exampl one_run_one_ev codeblock python import blueskyplan_stub bp def one_run_one_eventdetector yield bpsopen_run yield bpstrigger_and_readdetector yield bpsclose_run incorpor stage like codeblock python def one_run_one_eventdetector stage everi devic det detector yield bpsstagedet yield bpsopen_run yield bpstrigger_and_readdetector yield bpsclose_run unstag everi devic det detector yield bpsunstagedet start get verbos point might want accept addit complex exchang breviti assur dont forget use plan match pair end plan equival codeblock python import blueskypreprocessor bpp def one_run_one_eventdetector bppstage_decoratordetector def inner yield bpsopen_run yield bpstrigger_and_readdetector yield bpsclose_run return yield inner funcblueskypreprocessorsstage_decor plan preprocessor plan consum anoth plan modifi instruct case add insert stage unstag messag supplant funcblueskyplan_stubsstag funcblueskyplan_stubsunstag trim verbos yet employ funcblueskypreprocessorsrun_decor supplant funcblueskyplan_stubsopen_run funcblueskyplan_stubsclose_run result codeblock python import blueskypreprocessor bpp def one_run_one_eventdetector bppstage_decoratordetector bpprun_decor def inner yield bpstrigger_and_readdetector return yield inner incident recal alreadi encount preprocessor tutori section baselin read classblueskypreprocessorssupplementaldata preprocessor _tutorial_plan_metadata add metadata make easier search data gener plan inspect done afterward includ metadata creat dictionari pass funcblueskypreprocessorsrun_decor verbos formul funcblueskyplan_stubsopen_run runengin combin metadata inform provid user shown refth earlier section metadata tutorial_metadata codeblock python def one_run_one_eventdetector md humanfriendli name detector devic use search detector detnam det detector python repr argument plan plan_arg detector listmaprepr detector name plan plan_nam one_run_one_ev bppstage_decoratordetector bpprun_decoratormd def inner yield bpstrigger_and_readdetector return yield inner warn valu metadata dictionari must string number listsarray dictionari metadata contain arbitrari python type downstream consum like databas know error polit allow user overrid metadata blueski preassembl plan funcblueskyplanscount funcblueskyplansscan etc provid option md argument purpos implement like codeblock python def one_run_one_eventdetector mdnone _md detector detnam det detector plan_arg detector listmaprepr detector plan_nam one_run_one_ev key exist md overwrit default _md _mdupdatemd bppstage_decoratordetector bpprun_decorator_md def inner yield bpstrigger_and_readdetector return yield inner add hint metadata metadata dictionari may option includ key name hint key special signific classblueskycallbackbest_effortbesteffortcallback potenti downstream consum use tri infer use way present data current solv two specif problem narrow potenti larg set read manag number import one fit tabl identifi dimension data scan grid nd grid depend independ paramet visual peakfit purpos devic address plan role devic option hint attribut valu like field answer question read produc name import one need plan help us plan sort devic employ independ axe measur depend variabl isnt clear look devic alon given movabl devic use axi detector depend context countmotor perfectli valid thing schema plan hint metadata codeblock python dimens field stream_nam field stream_nam exampl codeblock python scan x dimens x primari grid_scan x dimens x primari primari scan move x togeth along diagon dimens x primari scan temperatur repres c k unit dimens c k primari scan energi measur energi diffractomet posit dimens e dcm primari special case sequenc read independ axi time dimens time primari entri outer list repres one independ dimens dimens might repres multipl field either differ devic move coordin fashion plan x present fulli redund inform one devic c k coupl inform two subdevic e dcm second element entri stream name primari everi exampl correspond name pass funcblueskyplan_stubstrigger_and_read funcblueskyplan_stubscr insid plan default name primari put togeth plan ask devic use independ axe import field build list dimens like codeblock python dimens motorhintsfield primari must account fact hint option given devic might hint attribut even hint might contain field key interest pattern silent omit dimens hint necessari inform provid devic codeblock python def scan mdnone _md _mdupdatemd tri dimens motorhintsfield primari except attributeerror keyerror pass els _mdhintssetdefaultdimens dimens final use setdefault allow user overrid hint know better pass scan mdhint _tutorial_adapt adapt logic plan twoway commun possibl gener runengin exampl functrigger_and_read plan respond read use make onthefli decis whether continu stop codeblock python import blueskypreprocessor bpp import blueskyplan_stub bp ophydsim import det motor def conditional_breakthreshold set trigger read detector read intens threshold bppstage_decoratordet motor bpprun_decor def inner true yield bpsmvmotor read yield bpstrigger_and_readdet readingsdetvalu threshold break return yield inner ipython python suppress import blueskypreprocessor bpp import blueskyplan_stub bp blueski import msg ophydsim import det motor def conditional_breakthreshold def inner true yield bpsmvmotor read yield bpstrigger_and_readdet readingsdetvalu threshold break decor work ipython sphinx direct use wrapper instead return yield bppstage_wrapperbpprun_wrapperinn det motor demo ipython python reconditional_break import line exampl codeblock python read yield bpstrigger_and_readdet action proce like plan yield read messag runengin runengin read detector runengin send read back plan respons assign variabl read respons read format like codeblock python name valu valu timestamp timestamp detail technic descript messag respons see refmsg _tutorial_exception_handl plan cleanup except handl except rais runengin give plan opportun catch except either handl mere yield clean messag rerais except kill plan execut recal reftutorial_pause_resume_suspend gener idea codeblock python exampl illustr complet correct use finalize_wrapp instead read sourc code def plan_with_cleanup def main_plan stuff def cleanup_plan stuff tri yield main_plan final even except rais yield cleanup_plan except question may origin plan runengin attempt execut given command funcblueskypreprocessorsfinalize_wrapp preprocessor provid succinct fulli correct way appli gener pattern codeblock python import blueskypreprocessor bpp def plan_with_cleanup yield bppfinalize_wrappermain_plan cleanup_plan read refper_step_hook specifi checkpoint todo monitor todo fli scan todo refpaus plan planned_paus funcblueskyplansinput_plan todo go deeper funcblueskyplan_stubstrigger_and_read todo blueski data collect framework blueski librari experi control collect scientif data metadata emphas follow virtu live stream data avail inlin visual process rich metadata captur organ facilit reproduc searchabl experi gener seamlessli reus procedur complet differ hardwar interrupt recoveri experi rewind recov cleanli interrupt autom suspendresum experi run unattend automat suspend resum need pluggabl io export data live desir format databas customiz integr custom experiment procedur command get io interrupt featur free integr scientif python interfac natur numpi python scientif stack use document start doctutori good place start everyon give good overview project narr style read far need solv problem come back need chang section tutori add piec complex exchang deeper custom remain section document blueski behavior less narr style provid clear api document intermix exampl explan design intent index toctre caption user document maxdepth tutori plan document metadata callback statemachin simul progressbar event_descriptor async multi_run_plan debug run_engine_api util magic frompyepicstoblueski comparisonwithspec hardwareinterfac appendix toctre caption develop document maxdepth hardwar msg run_engin api_chang contribut toctre hidden caption data collect blueski httpsblueskyprojectioblueski ophyd httpsblueskyprojectioophyd toctre hidden caption data access manag databrok httpsblueskyprojectiodatabrok amostra httpsnslsiigithubioamostra datamux httpsnslsiigithubiodatamux suitcas httpsblueskyprojectiosuitcas toctre hidden caption github link nslsii repositori httpsgithubcomnslsii bug report httpsgithubcomnslsiibugreportsissu debug log versionchang blueski use python log framework complet rework follow python document best practic librari blueski use python log framework enabl sophist log manag common simpl case includ view log termin write file next section illustr streamlin copypast exampl user familiar framework need rout log multipl destin may wish skip ahead reflogger_api use snippet log warn recommend standard setup codeblock python blueski import config_bluesky_log config_bluesky_log display blueski log record warn level higher termin standard format tailor blueski maximum verbos runengin hang run slowli repeatedli encount error use know exactli plan problem occur follow runengin progress plan crank verbos log display messag plan runengin process give clear indic plan execut stuck codeblock python blueski import config_bluesky_log config_bluesky_loggingleveldebug log file direct log messag file instead termin standard codeblock python blueski import config_bluesky_log config_bluesky_loggingfiletmpblueskylog leveldebug import strongli recommend set level handler logger previou version blueski recommend adjust level logger relogsetleveldebug recommend avoid set level logger would affect handler downstream potenti inhibit part program collect record want collect _logger_api blueski loggingrel api logger name primari logger use blueski blueski logger blueski log record propag blueskyemit_docu log record emit whenev document emit log record contain full content document blueskyr record runengin infolevel note state chang debuglevel note messag plan process statu object complet blueskyremsg log record emit classblueskyutilsmsg process blueskyrest log record emit runengin state chang also modulelevel logger specif featur formatt autoclass blueskyloglogformatt global handler follow python recommend blueski instal handler import time provid function set basic use configur one line similar python pyfuncloggingbasicconfig addit optionsand scope blueski logger blueski classblueskyloglogformatt streamlin common use case without interf sophist use case recommend facil use blueski leav function user configur standard facilitymanag log handler separ describ next section autofunct blueskylogconfig_bluesky_log autofunct blueskylogget_handl advanc exampl flow log event inform logger handler illustr follow diagram imag httpsdocspythonorg_imageslogging_flowpng refer see python log howto httpsdocspythonorghowtologginghtmlloggingflow illustr exampl set two handler use python log framework directli ignor blueski conveni function suppos set handler aim file codeblock python import log file_handl loggingfilehandlerblueskylog anoth aim logstash httpswwwelasticcoproductslogstash_ codeblock python import logstash requir pythonlogstash packag logstash_handl logstashtcplogstashhandlerhost port version attach handler blueski logger log record creat blueski propag codeblock python logger logginggetloggerblueski loggeraddhandlerlogstash_handl loggeraddhandlerfile_filt set verbos handler suppos want maximum verbos file medium verbos logstash codeblock python logstash_handlersetlevelinfo file_handlersetleveldebug final ensur effect level logger least verbos verbos handlerin case debug default import level set ipython python verbatim logginggetlevelnameloggerlevel notset inherit level python default handler last resort pyobjlogginglastresort warn ipython python verbatim logginggetlevelnameloggergeteffectivelevel warn case set debug match verbos level handler ad codeblock python loggersetleveldebug make debuglevel record avail handler logstash handler set info filter debuglevel record global disabl gener log record certain verbos may help optim perform python provid pyfuncloggingdis _hardware_interface_packag hardwar interfac packag blueski librari provid direct support commun real hardwar instead defin highlevel abstract refblueski hardwar interfac hardware_interfac allow differ experimentalist use differ hardwar control system follow packag provid support real hardwar commun blueski ophyd_ epics_ integr blueski refer implement hardwar interfac instrbuilder_ lightweight packag focu scpi_ ophydtango_ tango_ integr blueski incomplet experiment earli work pycertifspec_ commun spec_ instrument yaqcbluesky_ yaq_ integr blueski importantli may mix hardwar interfac multipl differ packag within runengin pleas note packag develop maintain separ blueski maintain python packag provid hardwar commun function refblueski hardwar interfac hardware_interfac simpl set attribut method easili ad exist class pleas consid support interfac specif unlock full capabl blueski ecosystem support hardwar let us know add blueski support add list _instrbuild httpslucaskgithubioinstrbuilderbuildhtml _scpi httpsenwikipediaorgwikistandard_commands_for_programmable_instru _ophyd httpsblueskyprojectioophyd _epic httpsepicscontrolsorg _ophydtango httpsgithubcomblueskyophydtango _pycertifspec httpsgithubcomsebvpycertifspec _spec httpswwwcertifcomcontentspec _tango httpswwwtangocontrolsorg _yaqcblueski httpsgithubcomblueskyyaqcblueski _yaq httpsyaqfyi currentmodul blueskysimul simul error check blueski provid three differ approach simul plan without actual execut introspect plan pass simul instead runengin execut plan real runengin use simul hardwar object redefin runengin command chang mean approach straightforward common introspect recal plan yield messag describ done commun hardwar directli therefor easi use write simpl function iter plan summar analyz action autosummari toctre gener nosignatur summarize_plan plot_raster_path check_limit summar simul funcsummarize_plan print summari plan would execut runengin ipython python blueskysimul import summarize_plan ophydsim import det motor blueskyplan import scan summarize_planscandet motor see unabridg content plan simpli use builtin python function funclist note possibl summar plan adapt logic content determin dynam plan execut ipython python listscandet motor check limit ipython python suppress motorlimit suppos motor configur limit rang motion funccheck_limit simul verifi whether plan violat limit save discov part way long experi ipython python okexcept blueskysimul import check_limit check_limitsscandet motor problem check_limitsscandet motor rais error simul hardwar warn featur recent chang yet document custom runengin method runengin allow custom mean command like set read one could use featur creat dummi runengin instead actual read write hardwar mere report would done automethod blueskyrun_enginerunengineregister_command noindex automethod blueskyrun_enginerunengineunregister_command noindex