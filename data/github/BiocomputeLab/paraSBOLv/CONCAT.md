# paraSBOLv

A lightweight Python library designed to simplify the rendering of highly-customisable SBOL Visual glyphs and diagrams. To do this, `paraSBOLv` uses the [Parametric Scalable Vector Graphic (pSVG)](https://parametric-svg.js.org) format to enable the encoding of the shape geometry and allowed parametric variations for each glyph. The best way to learn how to use `paraSBOLv` is to dive into our [`gallery`](./gallery/) of examples which cover most of the capabilities present. In addition, all functions and classes are extensively documented in code to allow usage to be easily inferred.

![Example image generated by paraSBOLv](gallery/04_plot_gff/04_plot_gff.jpg?raw=true "Example image generated by paraSBOLv")


## Relationship to DNAplotlib

We are regularly asked about the relationship of `parasbolv` and another genetic design visualisation tool we have developed called [`dnaplotlib`](http://www.dnaplotlib.org). The major difference between the two packages is that `parasbolv` is designed to be lightweight, include minimal additional functionality, and be tailored to tool developers to provide them with low level access to the rendering of SBOL Visual glyphs and interactions. In contrast, `dnaplotlib` is designed to provide a much fuller and wider range of functionalities to both developers and biologists.

It should be noted that `dnaplotlib` version 2.0, which is currently under development, will completely replace its legacy rendering pipeline with `paraSBOLv`. This will not only simplify maintenance, but also allow access to new glyphs ratified by the SBOL community as they become available.

## Dependancies

`paraSBOLv` does not require any other dependancies when installed. However, internally it does make use of the [`svgpath2mpl`](https://github.com/nvictus/svgpath2mpl) package to handle the generation of `matplotlib` compatible paths from an SVG path string. Do check this package out if you'd like to know more about using SVG with `matplotlib`.

## Installation

The easiest way to start playing with `parasbolv` is to clone this repository and place the `parasbolv` directory into you `PYTHONPATH` environment variable. Once done, it should be possible to then:

```
import parasbolv as psv
```

## Documentation

Automatically generated documentation can be accessed at: [https://biocomputelab.github.io/paraSBOLv/index.html](https://biocomputelab.github.io/paraSBOLv/index.html)

## Tutorials

- [Getting started with paraSBOLv](tutorials/getting_started.md) - This provides a basic introduction to the `paraSBOLV` library and the core data types of functions available. It is recommended that this is used together with the [examples gallery](./gallery/).

- [Creating parametric SVG glyph files](creating_psvg_glyphs) - If you are looking to create new parametric glyphs to use with this library then this provides an overview of the core elements that need to be added. If you are creating a new glyph that you think others in the synthetic biology might find useful, please consider also submitting to the [SBOL Visual standard](https://sbolstandard.org).

## Tools

To inspire you to make your own tools, we created some simple plotting tools using paraSBOLv as a convenient foundation. 

**[genbank2sbolv](gallery/genbank2sbolv)** - visualises the coding regions within a GenBank file.

**[sbolv-cli](gallery/sbolv-cli)** - streamlined CLI version of paraSBOLv for rapid generation of designs from the command line.

## Support

If you use this tool to create diagrams or as a basis for new software please cite the following paper. Without citations that demonstrate use it becomes difficult to support this tool.

`Clark C.J., Scott-Brown J. & Gorochowski T.E. "paraSBOLv: a foundation for standard-compliant genetic design visualisation tools", Synthetic Biology, 2021`
# Getting started with paraSBOLv

`paraSBOLv` is a lightweight Python library designed to simplify the rendering of highly-customisable SBOL Visual glyphs and diagrams. To begin, it is necessary to import the following packages:

	import parasbolv as psv
	import matplotlib.pyplot as plt
	
`paraSBOLv` contains all the code to render SBOL Visual compliant glyphs corresponding to biological parts and `matplotlib` is used as a canvas on which to draw the design.
	
## Initialising a figure and axis for drawing

Once the necessary imports have been made, `Figure` and `Axes` objects are required by `paraSBOLv` to act as a canvas. A typical way to generate these is using:

    fig, ax = plt.subplots()

The `fig` and `ax` objects are then used for all future drawing commands.

## Initialising `GlyphRenderer`

Before drawing a biological design, a `GlyphRenderer` object must first be created.

    renderer = psv.GlyphRenderer()

By default the `GlyphRenderer` constructor will use the built-in set of parametric SVG glyphs. However, if you would like to create a renderer able to access your own glyphs the named `glyph_path` argument can be provided with the path to the directory containing the parametric SVG files to be used:

    renderer = psv.GlyphRenderer(glyph_path = 'path')

As the name suggests, a `GlyphRenderer` objects renders glyphs from parametric SVG files to an `matplotlib` axis.

## Drawing Glyphs

With a `renderer` object now initialised, it is now possible to draw glyphs using the `draw_glyph` method:
	
	bounds, end_point = renderer.draw_glyph(ax, 'GLYPH NAME', (0, 0) )

The return values from this method provide the `bounds` of the drawn glyph (i.e. the bounding box that spans the glyph) and the `end_point` of the glyph, which is the end of the baseline that can be used as a starting point for the next glyph, if a more complex design needs to be drawn.

For example, to draw a promoter glyph at position (0, 0) you would use:

	bounds, end_point = renderer.draw_glyph(ax, 'Promoter', (0, 0))

Be aware that in order to see the design you have drawn it may be necessary to tell `matplotlib` to `show` the current figure on the screen:

    plt.show()

or to save the figure to file:

    plt.save_fig

We can make use of the parameterised SVG files to customise each glyphs in many different ways. For example, say we wanted to draw a coding sequence glyph (CDS) that has been **widened** and **rotated** 90 degrees (Ï€/2), with a **blue colored face** and **red colored edges**. This can be achieved by using the following lines of code:

	user_parameters = { 'width' : 50 }
	
	user_style = {
		      'cds' : {
		  	       'facecolor': (0,0,1),
			       'edgecolor': (1,0,0)
		      }
	}
	
	bounds, end_point = renderer.draw_glyph(
					       ax,
					       'CDS',
					       (0,0),
					       user_parameters = user_parameters
					       user_style = user_style,
					       rotation = 3.14/2
	)

You will notice that two different dictionaries are sent to the `draw_glyph` function. The first, `user_parameters` holds parameter-value pairs for each parameter defined for the parametric SVG file. These tend to be parameters that affect the shape/geometry of the glyph. The second, `user_style`, captures standard `matplotlib` styling information for each path that makes up the glyph. In this example, a coding sequence glyph contains a single path called `cds`. The `user_style` dictionary has key-value pairs where each path name acts as a key with the value another dictionary containing standard `matplotlib` styling options (e.g. line widths and colors).

## Initialising a `Construct`

The easiest way to plot many glyphs in succession as a single design is using a `Construct` object. A `Construct` consists of a list of parts, where each part is represented by a [`named_tuple`](https://bit.ly/2Tu8IMK) like so:

	Part = namedtuple(
			  'part', ['glyph_type',
				   'orientation',
				   'user_parameters', 
				   'user_style']
	)

	part_example = Part(
			    'part_name',
			    'orientation', # forward or reverse
			    {user_parameters}, # Falsy object if there are none
			    {user_style} # Falsy object if there are none
	)
	
A part list is merely a standard list of these objects:

	part_list = [
	             cds_part,
	             promoter_part,
	             cds_part
	]

Finally, a construct can be created by passing (at least) a `GlyphRenderer` object and `part_list` to the constructor:

	construct = psv.Construct(part_list, renderer, fig=fig, ax=ax)

Note that `fig`and `ax` are keyword arguments; if excluded, `Construct` will generate them itself and hold them as attributes. The `draw` method of the `Construct` object can then be used to render the design,

	fig, ax, baseline_start, baseline_end, bounds = construct.draw()

By default, a backbone is not drawn for a design, but this can be easily added by using the `baseline_start` and `baseline_end` value:

    ax.plot([baseline_start[0], baseline_end[0]], [baseline_start[1], baseline_end[1]], color=(0,0,0), linewidth=1.5, zorder=0)

There are a number of additional options that can also be used when creating a construct to alter the start position, spacing between glyphs and the overall rotation: 

	construct = psv.Construct(
				  part_list,
				  renderer,
				  start_position = (9,6),
				  gapsize = 8,
				  rotation = 3.14/4,
	)

## Specifying interactions

Interactions between glyphs can be defined by passing an `interaction_list` to a construct. Interactions, like parts, are also defined as named tuples.

	Interaction = namedtuple(
				 'interaction', ['starting_glyph',
						 'ending_glyph',
						 'interaction_type', 
						 'interaction_parameters']
							  )

	interaction_example = Interaction(
					  part1,
					  part2,
					  'Interaction Name',
					  interaction_parameters,
						  )

They are then passed to the `Construct` constructor:

	interaction_list = [
			    interaction1,
			    interaction2
	] 

	construct = psv.Construct(
				  part_list,
				  renderer,
				  interaction_list = interaction_list
			   )

That covers the basics of using paraSBOLv. Please see the rest of the documentation for detailed information on other available options and the [gallery](../gallery/) for examples of paraSBOLv in use.# Creating parametric SVG files for new glyphs

To create a parametric SVG glyph that is compatible with `paraSBOLv` it is necessary to follow some basic guidelines. First, it should be noted that all parametric glyphs at their core are standard SVG files. These can be created using graphic design software or by hand-coding the paths making up the glyph.

Once you have a starting SVG file that you wish to parameterise it is necessary to add the `parametric` namespace to the XML file. This is done by adding the following attribute to the main `svg` tag:

    xmlns:parametric="https://parametric-svg.github.io/v0.2"
    
Next, there are three additional attributes that must also be added to this tag:

1. `glyphtype` - This is a unique name for the type of glyph.

2. `terms` - This is a comma separated list of terms that are generally connected to the SO Terms of the corresponding SBOL part. This may be used in the future to help connect, glyphs to parts in an SBOL data file. At present though it is not used.

3. `parametric:defaults` - This is a semi-colon separated list of key=value pairs where the keys are parameters used and their default values.

This results in a final `svg` tag that looks something like the following (taken from the CDS glyph):

    <svg xmlns="http://www.w3.org/2000/svg" xmlns:parametric="https://parametric-svg.github.io/v0.2" version="1.1" width="100" height="100" glyphtype="CDS" terms="SO:0000316" parametric:defaults="arrowbody_height=15;arrowhead_width=7;width=30;height=15">

Now that the file is able to include parametric attributes, it is useful to parameterise each of the core paths making up the glyph. This is done by adding a `parametric:d` attribute to each `path` tag with the hard-coded values of each path, edited to include parametric definitions based on the parameters defined in the core `svg` tags `parametric:defaults` attribute. To ensure new glyphs are consistent in their parameter use with expect all glyphs to use the minimal number of parameters possible and conform to the same naming of parameters where possible. For example, nearly all existing glyphs have parameters for the `width` and `height` used to appropriately scale the glyph. To give an example of what

    <path class="filled-path" d="M2,25 L2,17.5 L26,17.5 L26,17.5 L32,25 L26,32.5 L26,32.5 L2,32.5 Z" style="fill:rgb(230,230,230);fill-rule:nonzero;stroke:black;stroke-width:1pt;stroke-linejoin:miter;stroke-linecap:butt" />
   
is transformed into:

    <path class="filled-path" d="M2,25 L2,17.5 L26,17.5 L26,17.5 L32,25 L26,32.5 L26,32.5 L2,32.5 Z" parametric:d="M{0},{0} L{0},{-arrowbody_height/2} L{width - arrowhead_width},{-arrowbody_height/2} L{width - arrowhead_width},{-height/2} L{width},{0}  L{width - arrowhead_width},{height/2} L{width - arrowhead_width},{arrowbody_height/2} L{0},{arrowbody_height/2} Z" style="fill:rgb(230,230,230);fill-rule:nonzero;stroke:black;stroke-width:1pt;stroke-linejoin:miter;stroke-linecap:butt" />

In addition to parameterising the paths making up the glyph, some additional paths and bounding box should be provided to ensure that `paraSBOLv` knows where the baseline of a design is located and to capture the bounds of the glyph to avoid overlapping of visual content where possible. Again, these two elements should be parameterised such that their shape changes in accordance with the glyph and new parameters are supplied.

As an example, here are the `bounding-box` and `baseline` elements for the CDS glyph:

     <rect class="bounding-box" id="bounding-box" parametric:x="{0}" x="0" parametric:y="{-height/2}" y="14.5" parametric:width="{width}" width="34" parametric:height="{height}" height="21.0" style="fill:none;stroke:rgb(150,150,150);stroke-opacity:0.5;stroke-width:1pt;stroke-linecap:butt;stroke-linejoin:miter;stroke-dasharray:1.5,0.8" />

     <path class="baseline" id="baseline" parametric:d="M{0},{0} L{width},{0}" d="M0,25 L34,25" parametric:y="{0}" style="fill:none;stroke:black;stroke-width:1pt" />

And that is it! With these additional elements the glyph is now usable by `paraSBOLv`.

# More information

For more information regarding the parametric SVG format see: [http://parametric-svg.js.org](http://parametric-svg.js.org)# Gallery

This directory contains examples of the core functionality of `parasbolv`. All of the output visualisations are shown below. Click the links to be taken to the respective directory to see the source code that generated the example.

**Glyph sampler** [[code]](00_glyph_sampler/)

![Glyph sampler](00_glyph_sampler/00_glyph_sampler.jpg?raw=true "Glyph sampler")

**Basic plotting** [[code]](01_basic_plotting/)

![Basic plotting](01_basic_plotting/01_basic_plotting.jpg?raw=true "Basic plotting")

**Animated CDS** [[code]](02_animated_CDS/)

![Basic plotting](02_animated_CDS/02_animated_CDS.gif?raw=true "Animated CDS")

**Plot genetic constructs** [[code]](03_plot_constructs/)

![Plot genetic constructs](03_plot_constructs/03_plot_constructs.jpg?raw=true "Plot genetic constructs")

**Plot GFF file contents** [[code]](04_plot_gff/)

![Plot GFF file contents](04_plot_gff/04_plot_gff.jpg?raw=true "Plot GFF file contents")

**Labelling glyphs** [[code]](05_labelling_glyphs/)

![Labelling glyphs](05_labelling_glyphs/05_labelling_glyphs.jpg?raw=true "Labelling glyphs")

**Draw interations** [[code]](06_draw_interactions/)

![Draw interations](06_draw_interactions/06_draw_interactions.jpg?raw=true "Draw interations")# scripts

This directory holds several scripts used in the creation and clean-up of parametric SVG files used by `paraSBOLv`. As a user and developer, you don't need to worry about these.