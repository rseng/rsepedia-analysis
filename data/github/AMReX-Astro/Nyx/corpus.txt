citat use nyx appreci cite main code paper almgren et al httpsiopscienceioporgarticlex pdfhttpsiopscienceioporgarticlexpdf citat bibtex articlenyx author almgren bell jb lijewski mj lukic z van andel e titl nyx massiv parallel amr code comput cosmolog journal astrophys journal archiveprefix arxiv eprint keyword gravit hydrodynam method numer year month mar volum eid page doi x doihttpszenodoorgbadgedoizenodosvghttpsdoiorgzenodo doihttpsjosstheojorgpapersjossstatussvghttpsdoiorgjoss amrexhttpsamrexcodesgithubiobadgespoweredbyamrexredsvghttpsamrexcodesgithubio nyxhttpsgithubcomamrexastronyxblobdevelopmentutilbannerjpeg adapt mesh massivelyparallel cosmolog simul code nyx code solv equat compress hydrodynam adapt grid hierarchi coupl nbodi treatment dark matter ga dynam nyx use finit volum methodolog set eulerian grid dark matter repres discret particl move influenc graviti particl evolv via particlemesh method use cloudincel depositioninterpol scheme baryon dark matter contribut gravit field addit nyx includ physic need accur model intergalact medium optic thin limit assum ioniz equilibrium code calcul heat cool process primordialcomposit ga ioniz ultraviolet background radiat field addit physic capabl develop nyx run linux system gener particularli focu supercomput system nyx parallel mpi x x openmp multicor architectur cudahipdpc hybrid cpugpu architectur openmp regim nyx success run parallel concurr nersc coriknl cuda implement run gpu olcf summit inform nyx found main web pagehttpamrexastrogithubionyx onlin documentationhttpsamrexastrogithubionyxdocs_html standard depend compil code requir c compliant compil support mpi higher implement thread acceler use requir openmp higher cuda higher hipclang use nyx also need amrexhttpsgithubcomamrexcodesamrex exampl compil lyman alpha lya execut summit sh modul load gcc cuda git clone httpsgithubcomamrexcodesamrexgit git clone httpsgithubcomamrexastronyxgit cd nyxexeclya make j use_cudatru see get start sectionhttpsamrexastrogithubionyxdocs_htmlnyxgettingstartedhtml inform develop model pleas see contributingmd detail contribut amrex output nyx output certain global diagnost timestep plot file regular interv userspecifi redshift visual packag visithttpswcillnlgovsimulationcomputercodesvisit paraviewhttpswwwparavieworg ythttpytprojectorg amrvishttpsgithubcomamrexcodesamrvi builtin support amrex file format use nyx addit nyx interfac two postprocess suit reeber gimlet reeber use topolog method construct merg tree scalar field turn use find halo gimlet comput varieti quantiti relat lymanalpha forest scienc suit fulli mpiparallel run either situ intransit combin see friesen et al httpscompastrophyscosmolspringeropencomarticless licens nyx copyright c regent univers california lawrenc berkeley nation laboratori subject receipt requir approv us dept energi right reserv detail licens found licensetxtlicensetxt file question right use distribut softwar pleas contact berkeley lab innov partnership offic ipolblgov contact question comment suggest contact jean sexton jmsextonlblgov zarija lukic zarijalblgov develop model develop gener follow follow idea new featur merg develop branch use pull request pr nightli regress test use ensur answer chang chang expect bug fix question contribut new featur welcom bug report github issu suggest ask question github issu well contribut new featur potenti chang answer done via pull request pull request gener fork nyx target develop branch see detail process work gener squash commit upon merg clean histori pleas ensur pr titl first post descript sinc use squash commit messag pleas note follow choos make contribut code herebi grant nonexclus royaltyfre perpetu licens instal use modifi prepar deriv work incorpor comput softwar distribut sublicens enhanc deriv work thereof binari sourc code form first workday month soon thereaf make tag releas git workflow nyx use githttpsgitscmcom version control new git follow one tutori learn git bitbuckethttpswwwatlassiancomgittutorialslearngitwithbitbucketcloud git simpl guidehttprogerdudlergithubiogitguid make fork creat branch basic workflow fork main repo updat alreadi creat implement chang push new branch branch_nam fork creat pull request branch branch_nam fork branch develop main nyx repositori first let us setup local git repo make fork main upstream repositori nyx github pagehttpsgithubcomamrexastronyx press fork button execut clone fork local comput get address fork github page git clone branch develop httpsgithubcommygithubusernamenyxgit navig repo add new remot main nyx repo fetch cd nyx git remot add upstream httpsgithubcomamrexastronyx git remot seturl push upstream httpsgithubcommygithubusernamenyxgit git fetch upstream recommend set develop branch track upstream one instead fork git branch u upstreamdevelop free play fork addit inform visit github fork help pagehttpshelpgithubcomenarticlesforkarepo note redo setup everi time instead futur need updat develop branch fork git checkout develop git pull make sure develop branch git checkout develop nyx directori creat branch branch_nam branch name reflect piec code want add like new_kind_of_particl git checkout b branch_nam code want add file work git stage area git add file_i_cr and_file_i_modifi commit push chang period commit chang git commit char descript explain work commit messag quotat mark super import order follow develop identifi bug moment commit local repo push fork git push u origin branch_nam want synchron branch develop branch use develop modifi work branch_nam use git pull upstream develop fix conflict may occur merg branch pr local develop branch make local develop branch diverg match branch main repositori pr merg submit pull request pull request way effici visual chang made propos new featureimprovementfix nyx project right push chang banner appear github page fork branch_nam click compar pull request button prepar pr time commun chang write titl descript pr peopl review pr happi know featurefix propos made creat new class inherit anyth relev pr perform test imag etc press creat pull request navig pr highlight chang made pleas write larg pull request difficult timeconsum review much possibl split small target pr exampl find typo document open pull request fix typo want fix bug make small pull request fix bug want implement larg featur write helper function first test submit first pull request want implement featur sure split open issu plan ping amrex develop chime even work readi merg conveni creat pr use github tool visual chang case pleas make draft pr use dropdown menu next creat pull request button pull request made review potenti merg recommend alway creat new branch pull request per instruct pull request merg delet local pr branch git branch branch_nam delet remot one fork git push origin delet branch_nam gener speak want follow follow rule merg branch pr local develop branch track nyx develop branch otherwis local develop branch diverg nyx develop branch commit develop branch track nyx develop branch alway creat new branch base develop branch pull request unless go use git fix later accident commit develop branch fix follow git checkout b new_branch git checkout develop git reset head number commit accident commit develop git checkout local develop sync nyx develop recent commit save new_branch branch reason pr branch diverg nyx tri fix follow tri back code case thing might go wrong git fetch upstream assum upstream remot name offici amrex repo git checkout b xxx upstreamdevelop replac xxx whatev name like git branch develop git checkout b develop upstreamdevelop git checkout xxx git merg yyy yyy pr branch unclean histori git rebas upstreamdevelop see someth like editor pick dd commit messag pick cc commit messag b pick fjg commit messag c requir bit knowledg commit commit merg commit actual new howev see commit easi figur commit alreadi merg assum first two commit merg drop replac pick drop drop dd commit messag drop cc commit messag b pick fjg commit messag c save exit editor git log show clean histori base top develop branch also git diff yyyxxx make sure noth new drop goe well submit pr use xxx branch dont worri someth goe wrong rebas alway git rebas abort start titl nyx massiv parallel amr code comput cosmolog tag c cosmolog hydrodynam dark matter nbodi author name jean sexton orcid affili name zarija lukic affili name ann almgren orcid x affili name chri daley affili name brian friesen orcid affili name andrew myer orcid affili name weiqun zhang orcid affili affili name center comput scienc engin lawrenc berkeley nation laboratori index name comput cosmolog center lawrenc berkeley nation laboratori index name nation energi research scientif comput center nersc berkeley ca usa index date februari bibliographi paperbib summari nyx highli parallel adapt mesh finitevolum nbodi compress hydrodynam solver cosmolog simul use simul differ cosmolog scenario recent focu intergalact medium lyman alpha forest togeth nyx compress astrophys simul code castro castro low mach number code maestroex maestroex make amrexastrophys suit opensourc adapt mesh performanceport astrophys simul code exampl cosmolog simul research code includ enzo bryan enzopcello bordner norman rams teyssier art kravtsov flash fryxel cholla villasenor well gadget springel gasolin wadsley arepo weinberg gizmo hopkin swift schaller core hydrodynam solver nyx nyxpap base direct unsplit corner transport upwind method ctu piecewis parabol reconstruct ppm nyx sever mode coupl stiff heatingcool sourc term hydro simplest method tradit oper split approach use strang split strang achiev secondord accuraci time howev coupl break altern strang split base spectral defer correct sdc method aim prevent hydro stiff sourc term becom decoupl simplifi sdc method use ctu ppm hydro togeth iter scheme fulli coupl sourc term hydro still secondord accuraci time simple_sdc nyx set addit physic necessari model intergalact medium use heatingcool sourc term code follow abund six speci neutral ioniz hydrogen neutral twice ioniz helium free electron speci relev atom process ioniz recombin freefre transit model code heat cool sourc term calcul use subcycl approach order avoid run whole code short cool timescal cosmolog reioniz account via spatial uniform timevari ultraviolet background uvb radiat field input code list photoion photoh rate vari redshift nyx also capabl model flash reioniz well inhomogen reioniz onorb evolut baryon ga coupl nbodi treatment dark matter expand univers meshbas hydrodynam baryon ga evolut coupl graviti particlebas represent dark matter dark matter particl move movekickdrift algorithm movekickdrift poisson equat selfgrav baryon ga dark matter solv use geometr multigrid method nyx simul option model neutrino particl effect activ galact nuclei feedback nyx built amrex amrex adapt mesh refin amr librari written c amr level advanc timestep subcycl jump factor support level use mpi distribut amr grid across node use logic tile openmp divid grid across thread multicor cpu machin expos coarsegrain parallel cudahipdpc spread work across gpu thread gpubas machin finegrain parallel core physic run gpu shown scale well perform portabl use sourc code cpu gpu addit implement parallel loop abstract layer provid amrex abstract parallel loop accept argument rang indic bodi loop execut given index amrex backend dispatch work appropri eg one cell per gpu thread strategi similar way kokko kokko raja raja abstract model provid perform portabl c statement need number cosmolog simul code nyx offer uniqu featur origin motiv develop nyx build simul code base modern wellsupport amr librari boxlib evolv amrex use unsplit integr techniqu larg develop commun contribut amrex help nyx continu gain optim new architectur variou oper system present nyx mostli use model cosmolog evolut intergalact medium igm reservoir low densiti ga fill space galaxi differ physic effect rang natur dark matter differ reioniz scenario relat radiat starform galaxi set observ properti igm make power probe cosmolog astrophys order extract scientif insight confront observ igm usual lyman alpha forest simul model necess nyx step incom observ exampl dark energi spectroscop instrument desi highresolut spectrograph like one mount keck telescop notic reduc statist error measur commun need tool capabl produc model univers better accuraci observ nyx scalabl allow model repres cosmolog volum maintain resolut need resolv small fluctuat intergalact ga nyx includ physic allow simul differ cosmolog reioniz scenario enabl user produc mock univers varieti physic relev model main target highperform comput architectur massiv parallel simul need cosmolog astrophys research given target nyx comput optim focu larg simul hpc system although smaller simul run linux distribut maco use amrex build system support acknowledg work lbnl support us depart energi contract deacch nyx develop support exascal comput project scsc collabor effort us depart energi offic scienc nation nuclear secur administr refer exampl diagnosticanalysi tool simpl exampl open amrex plt file read manipul data meant start place build analysi tool user specif need particular exampl given ndimension data set program comput onedimension profil direct dir valu profil averag data nondir direct work multipl compon one time usag standalon applic built top amrex set compil valu gnumakefil variabl comp make execut sh make j run execut runtim paramet input file sh amrderivedlinuxgccgfortranmpiex input file input contain exampl sh infil plt dir ncomp scomp specifi runtim paramet via commandlin sh amrderivedlinuxgccgfortranmpiex infileplt dir ncomp scomp also set verbos via command line input file order get quit verbos output nyx zeldovich test case exec set run zeldovich problem creat initi condit gener initi condit compil run generate_zeldovich_icscpp may chang paramet file redshift initi caustic number particl box length number sheet determin perturb wavelength perturb offset sheet normal vector determin direct perturb hubbl rate make sure match cosmolog probin compil ic gener cd ic g generate_zeldovich_icscpp generate_zeldovich_icsex generate_zeldovich_icsex creat file zeldovich_particlesascii zeldovich_paramscsv csv file contain paramet use gener particl ascii file use analysi dont worri adjust param analysi script manual check initi condit might want check file quick head zeldovich_particlesascii make sure number particl first line fine particl format x z mass xdot ydot zdot good also run cd analysi python check_icspi test icszeldovich_particlesascii make sure sheet normal inde unit vector veloc perpendicular densiti box match critic matter densiti given cosmolog also plot particl distribut comov space project comov phase space check eye might make automat futur suffici run nyx compil nyx execut check make option buildgnumakefil run make build directori check input probin file make sure match condit set ic check prob_hi match size box h want run hopper run normal qsub pbs_hopper adjust howev mani core think run requir want run local use someth like mpirun np nyxddarwingccgfortranmpiex input analyz cd analysi python process_zeldovichpi make fig directori open particlesascii file directori begin plt analyz result plt ascii particl file plot phase space zeldovich predict project particl posit histogram veloc perpendicular normal close radi heat cool nyx provid capabl comput local heat cool effect due radiat motiv algorithm heat cool compon document rawlatexciteluk relev code locat sourceheatcool subdirectori code activ use_heatcooltru option gnumakefil mathemat heat cool describ singl ode cell integr per time step mathdelta ode exhibit sensit relationship quantiti temperatur free electron densiti consequ often requir sophist integr techniqu comput correctli nyx provid differ parallel strategi techniqu solv ode legaci reason integr scheme select via nyxheat_cool_typ input paramet one method use use_heatcoolfals ode solv select nyxheat_cool_typ method use use_heatcooltru vector cvode solv select nyxheat_cool_typ user note compil gnumak cvode must compil separ librari instruct compil cvode provid get start link extern cvode solver nyx one must set use_heatcooltru well use_sundialstru gnumakefil vector option use cvode treat group ode differ cell singl system coupl ode purpos approach enabl evalu multipl rhss simultan improv parallel perform approach lead signific perform gain ode integr among expens comput kernel nyx group cell integr togeth control tiles use cvode integr loop tile use entir box cell integr togeth cvode integr result system ode use adapt timestep control select timestep whole system set absolut toler requir ode integr cvode e scale initi valu cell independ variabl ode rel toler requir ode integr cvode e toler particular rel toler differ effect depend whether one integr singl ode time system ode simultan one mind numer differ aris observ fcompar tool amrex input flag affect cvode integr includ nyxuse_sundials_constraint nonzero requir intern energi problem evolv posit nyxuse_sundials_fus nonzero use sundialss gpu fuse oper mathemat equival reduc gpu kernel launch time overhead nyxsundials_alloc_typ differ vector memori alloc strategi affect execut built gpu nyxuse_typical_step nonzero set cvode adapt stepsiz select substep total cvode integr time dt old_max_step maximum entir problem domain strang case old maximum taken phase previou timestep nyxsundials_use_til control whether mfiter loop iter cvode integr use tile nyxsundials_tile_s control tile size mfiter loop iter cvode integr nyxhydro_tile_s control tile size mfiter loop iter hydro advanc make hydro_src sdc integr nyxsundials_reltol control rel toler given cvode integr nyxsundials_abstol control absolut toler factor multipli local intern energi set absolut toler vector cvode integr heatcooltest directori allow test cvode integr alon given data full step lya execut present assum tiles boxarray distribut map run note suppli filenam path must ensur directori structur exist addit cvode statist display nyxv input flag control test includ hctest_example_writ nonzero write relev data step includ input file use lya similar hctest_example_write_proc set write data box own processor number doesnt current read mode take smaller data set hctest_example_index repres part filenam typic denot step number unset default nstep hctest_example_read nonzero read relev data step use heatcooltest hctest_filename_input set name input file write unset hctestinputshctest_example_index hctest_filename_badmap set name boxarray distributionmap file write unset hctestbadmaphctest_example_index hctest_filename_chunk set name chunk data file prefix use unset hctestchunkhctest_example_index mfiindex use index box full filepath dark matter particl dark matter particl includ simul set nyxdo_dm_particl true input file dark matter particl present one option run without baryon build hydro capabl set no_hydrotru also possibl build no_hydrofals turn hydro runtim set nyxdo_hydro input file default use doubl precis mesh data singl precis particl set gnumakefil precis doubl use_single_precision_particl true recommend use singl precis mesh data test potenti degrad qualiti hydrodynam solv use singl precis mesh use precis float equat defin mathmathbf x_i mathbf u_i locat veloc particl mathi respect wish solv math beginalign fracd mathbf x_id fraca mathbf u_i fracd mathbf u_i mathbf g_iendalign mathmathbf g_i gravit forc evalu locat particl mathi ie mathmathbf g_i mathbf gmathbf x_it particl time step movekickdrift algorithm time step solv mathmathbf gn multilevel otherwis use mathmathbf gn previou step mathmathbf u_infrac fracanfrac mathbf un_i fracdelta mathbf gn_i mathmathbf x_in mathbf xn_i fracdelta tanfrac mathbf u_infrac solv mathmathbf gn use mathmathbf x_in mathmathbf u_in fracan anfrac mathbf unfrac_i fracdelta mathbf gn_i note end timestep mathbf x_in consist mathbf gn becasu advanc posit comput newtim graviti benefit perform one graviti solv per timestep singlelevel calcul hydro particl move comput g solv gravit vector follow assign mass particl onto grid form densiti mathrho_dm mass particl assum uniformli distribut cube side mathdelta x center call posit particl distribut mass particl cell grid proport volum intersect cell particl cube divid cell valu mathdelta x right hand side poisson solv unit densiti rather mass note comov densiti solv mathnabla phi frac pi ga rho_dm discret standard point laplacian point use multigrid gaussseidel redblack relax solv equat mathphi cell center comput normal compon mathbf g nabla phi cell face differenc adjac valu mathphi eg mathbf g g_x g_i g_z defin mathg_x cell face normal xdirect comput mathg_xifracjk phi_ijk phi_ijk delta x interpol compon mathbf g normal cell face onto particl posit use linear interpol normal direct output format checkpoint file particl posit veloc store binari file checkpoint directori format design read code restart rather diagnost note valu matha also written checkpoint directori separ ascii file call comoving_a contain singl valu particl data plot file particl posit veloc written binari file plotfil directori dark matter particl dm activ galact nuclei particl agn neutrino particl npc addit also visual particl locat repres grid multipl deriv quantiti repres particl includ particl variabl deriv variabl make written plotfil field grid ie amrderive_plot_var particle_count particle_mass_dens input file gener plotfil two variabl particle_count repres number particl grid cell particle_mass_dens densiti grid result particl name convent follow particl veloc grid particle_x_veloc particle_y_veloc particle_z_veloc deriv variabl particle_ repres quantiti dark matter particl contain similar variabl agn particl contain neutrino particl contain name agn_ neutrino_ note particl field written grid distinct densiti field plotfil baryon densiti grid note valu matha also written plotfil directori separ ascii file call comoving_a contain singl valu role cppcode languag c _secgrid_cr grid creation run nyx must specifi cppn_cell input file number cell span domain coordin direct level user often specifi cppmax_grid_s well default load balanc algorithm divid domain everi direct grid longer cppmax_grid_s direct specifi user cppmax_grid_s default coordin direct anoth popular input cppblocking_factor valu cppblocking_factor constrain grid creation grid must divis cppblocking_factor note domain level cppmax_grid_s must divis cppblocking_factor specifi user cppblocking_factor default coordin direct typic purpos cppblocking_factor ensur grid suffici coarsen good multigrid perform one default behavior awar boolean cpprefine_grid_layout default true overridden runtim cpprefine_grid_layout true number grid creat less number processor ngrid nproc grid subdivid ngrid nproc caveat subdivid grid achiev ngrid nproc would violat cppblocking_factor criterion addit grid creat number grid remain less number processor note cppn_cell must given three separ integ one coordin direct howev cppmax_grid_s cppblocking_factor specifi singl valu appli coordin direct separ valu direct cppmax_grid_s cppblocking_factor specifi multipl integ first integ appli level second level etc dont specifi mani integ level final valu use remain level differ valu cppmax_grid_s cppblocking_factor want coordin direct cppmax_grid_size_x cppmax_grid_size_i cppmax_grid_size_z cppblocking_factor_x cppblocking_factor_i cppblocking_factor_z must use dont specifi mani integ level final valu use remain level note cppmax_grid_s upper bound cppn_cell cppmax_grid_s typic one grid length one length grid creation process level proce follow use kdtree approach domain initi defin singl grid size cppn_cell cppn_cell greater cppmax_grid_s grid subdivid grid longer cppmax_grid_s cell side cppblocking_factor criterion ie length side grid divis cppblocking_factor direct satisfi process next cpprefine_grid_layout true processor grid level grid level divid ngrid nproc unless would violat cppblocking_factor criterion refin criteria dynam creation destruct grid level fundament part nyx capabl process describ detail amrex document summar key point regular interv set user amr level finest allow run invok regrid oper invok list error tag function travers field specif function deriv state level pass kernel set clear flag cell field function error tag quantiti identifi setup phase code state descriptor defin ie nyx_setupcpp function list add remov list cell tag refin final list tag cell sent grid gener routin use bergerrigoutso algorithm creat rectangular grid defin new finer level set level state data fill new grid copi possibl interpol coarser level fine data avail process complet exist amr level remov new one insert hierarchi time integr continu tradit amrex approach set control regrid process involv explicitli creat hard code number function directli nyx setup code consult sourc code amrex document precis done nyx provid limit capabl augment standard set error function base entir runtim data specifi input parmpars data follow exampl portion parmpars input file demonstr usag featur amrrefinement_ind denerr dengrad velgrad amrdenerrmax_level amrdenerrvalue_great amrdenerrfield_nam densiti amrdengradmax_level amrdengradadjacent_difference_great amrdengradfield_nam densiti amrvelgradmax_level amrvelgradadjacent_difference_great amrvelgradfield_nam x_veloc ad five new customnam criteria denerr cell densiti defin mesh greater dengrad cell densiti differ immedi neighbor velgrad cell x_veloc differ immedi neighbor first trigger amr level second level third level exampl specif deriv type overden rescal baryon ga densiti divid averag total densiti math beginalign mathttoverden fracrho_b overlinerho mathtttagging_basemathttlevel crcr endalign mathoverlinerho averag mathrhorho_brho_dm entir domain amrrefinement_ind densiti amrdensityvalue_great amrdensityfield_nam overden nyxtagging_bas note addit usercr criteria oper place defin default also note modifi restart code default new criteria take effect next schedul regrid oper altern user may restart amrregrid_on_restart order full alllevel regrid read checkpoint data advanc cell hydrodynam equat comov coordin conserv form solv equat ga dynam coordin system comov expand univers expans factor matha relat redshift mathz matha z continu equat written math labeleqden fracparti rho_bparti fraca nabla cdot rho_b bf u mathrho_b comov baryon densiti relat proper densiti mathrho_b rho_prop mathbf u proper peculiar baryon veloc momentum evolut equat express math beginalign fracparti rho_b bf uparti fraca left nabla cdot rho_b bf u bf u nabla p rho_b bf g bf s_rho bf u dota rho_b bf u right endalign equival math beginalign labeleqmomt fracparti rho_b bf uparti nabla cdot rho_b bf u bf u nabla p rho_b bf g bf s_rho bf u endalign pressur mathp appear evolut equat relat proper pressur mathp_prop mathp p_proper mathbf g nabla phi gravit acceler vector mathbf s_rho bf u repres extern forc term energi equat written math beginalign fracparti rho_b eparti fraca left nabla cdot rho_b bf u e p bf u rho_b bf u cdot bf g s_rho e dota gamma rho_b e rho_b bf u cdot bf u right endalign equival math beginalign labeleqenergi fracparti rho_b eparti left nabla cdot rho_b bf u e p bf u rho_b bf u cdot bf g s_rho e dota gamma rho_b e right endalign math e bf u cdot bf u total energi per unit mass math specif intern energi maths_rho e s_rho e bf u cdot bf s_rho bf u maths_rho e lambdah lambdac repres heat cool term respect addit mathbf s_rho e may includ extern forc term total energi exampl stochast forc applic write evolut equat intern energi math beginalign fracparti rho_b eparti fraca left nabla cdot rho_b bf u e p nabla cdot bf u dota gamma rho_b e s_rho e right endalign equival math beginalign fracparti rho_b eparti left nabla cdot rho_b bf u e p nabla cdot bf u s_rho e dota gamma rho_b e right endalign note gammalaw ga mathgamma write math beginalign fracparti rho_b eparti left nabla cdot rho_b bf u e p bf u rho_b bf u cdot bf g s_rho e right endalign math beginalign fracparti rho_b eparti left nabla cdot rho_b bf u e p nabla cdot bf u s_rho e right endalign work progress list work progress code piec relat effort alreadi github repo function finish yet thu fomal reles commun provid list complet clariti sourc code activ galact nuclei implment activ galact nuclei agn subgrid model base bondi accret ga onto blackhol feedback energi surround medium ongo develop mostli contain insid sourceagn folder massiv neutrino simul massiv neutrino particl implement nyx via separ particl contain test ongo unit convent nyx use cosmolog system unit base mpc math_odot km length mass veloc respect temperatur given degre kelvin unit time deriv veloc length unit input problem initi specifi consist unit output interpret unit mind equat state call intern convers cosmolog cg unit numreftableunit show common symbol name use throughout code document paper _tableunit tabl common quantiti unit name unit descript matht mpckm time mathrho math_odot mpc math mass densiti mathub km veloc vector mathp math_odot km math mpc math pressur mathgb km mpc gravit acceler math km math specif total energi math km math specif intern energi matht mathk temperatur numreftableconst list valu use physic constant cosmolog unit note mathomega_m mathomega_b mathomega_r mathh set input file refcomov list parameterslistofparamet full list constant convers factor set sourcedriverconstants_cosmoh _tableconst tabl physic constant valu constant cosmolog unit gravit constant mathg e mpc km math math_odot avogadro number mathn_a e math_odot boltzmann constant mathk_b e math_odot km math k hubbl constant mathh km mpc place dimension number use code trace riemann solv set three small number need consist data specifi set one larg number need consist data specifi specifi input file small_den small valu densiti small_press small valu pressur small_temp small valu temperatur large_temp larg valu temperatur place use code small_den enforce_minimum_dens call subroutin consup two choic floor routin enforce_minimum_density_floor densiti set small_den rho e rho e comput small_temp momenta set zero conserv routin enforce_minimum_density_con iter procedur use creat diffus flux adjust variabl conserv densiti greater small_den tracexi tracez tracexy_ppm tracez_ppm qxp maxqxpsmall_den qxm maxqxmsmall_den analog qypqym qzpqzm modifi primit densiti pressur insid trace underli state variabl riemannu set wsmall small_den csmall wl maxwsmal sqrtgaml pl rl wr maxwsmal sqrtgamr pr rr also set ro maxsmall_densro ro rl rr state chosen ustar rstar maxsmall_densrstar rstar ro pstarpocomath small_temp compute_new_temp mathrho e call nyx_eos_given_rt esmall_temp order comput new energi math energi use defin new math e ke come temperatur equal small_temp energi math reset reset_internal_energi math math ke call nyx_eos_given_rt esmall_temp order comput new energi math energi also use defin new math e ke large_temp compute_new_temp matht mathrmlarge_temp input flag nyxlocal_max_temp_dt set matht mathrmlarge_temp call nyx_eos_given_rt elarge_temp order comput new energi math energi use defin new math e ke come temperatur equal large_temp energi math reset small_pr tracexi tracez tracexy_ppm tracez_ppm qpre maxqpressmall_pr qxpqyp qypqym qzpqzm modifi primit densiti pressur insid trace underli state variabl riemannu set pstar maxsmall_prespstar pgdnv maxsmall_prespgdnv note pgdnv pressur explicitli use flux uflatten small_pr use keep denomin away zero everywher defin valu pressur face set valu least small_pr role cppcode languag c _secload_balanc load balanc process load balanc typic independ process grid creation input load balanc given set grid set weight assign grid singlelevel load balanc algorithm sequenti appli amr level independ result distribut map onto rank take account weight alreadi assign assign heaviest set grid least load rank option support amrex includ follow default sfc knapsack default weight grid knapsack algorithm number grid cell amrex support option pass array weight one per grid altern pass multifab weight per cell use comput weight per grid sfc enumer grid spacefil zmorton curv partit result order across rank way balanc load roundrobin sort grid assign rank roundrobin fashion specif fab own cpu n n total number mpi rank load balanc hydrodynam mesh nyx distributionmap default use sfc strategi set distributionmap use differ strategi control flag begin distributionmap distributionmappingstrategi knapsack sfc roundrobin distributionmappingverbos flag take effect whenev regrid oper call mesh typic either amrregrid_int reach multilevel simul amrregrid_on_restart load balanc dark matter particl nyx flag affect activ particl get distributionmap chang nyxload_balance_int nyxload_balance_start_z nyxload_balance_wgt_strategi nyxload_balance_wgt_nmax nyxload_balance_strategi knapsack sfc roundrobin wgt_strategi use either number cell number dark matter particl total count dark matter particl determin cost box equival cheaper load balanc default flag determin base redshift z begin affect calcul introduc addit commun penalti particl interact mesh data addit commun tradeoff balanc amount particl memori particl work rank strategi current implement work multilevel simul agn model nyx agn model supermass black hole smbh particl form halo halo defin connect mass enclos userdefin densiti isocontour order find halo use reeber packag describ section secreeber__ agn particl standard dark matter particl attribut posit veloc mass well two addit attribut store accret energi mass accret rate tabl paramet agn model probin file paramet fiduci valu explan mathm_rm h min math m_odot minimum halo mass smbh placement mathm_rm seed math m_odot seed mass smbh t_min matht_rm min math k minimum heat surround ga bondi_boost mathalpha bondi accret boost factor max_frac_remov mathf_rm max remov maximum fraction mass remov ga eps_rad mathepsilon_rm r radiat effici eps_coupl mathepsilonrm c coupl effici eps_kinet mathepsilon_rm kin kinet feedback effici frac_kinet mathf_rm kin fraction feedback energi kinet tabagn_param mathm_rm h min mathm_rm seed set probin file input file respect nyxmass_halo_min nyxmass_se creat agn particl halo halo threshold mass mathm_h geqslant m_rm h min alreadi host black hole particl seed black hole mass mathm_rm seed initi posit agn particl center cell densiti highest halo agn particl creat densiti cell reduc amount requir mass conserv veloc agn particl initi momentum conserv accret energi mass accret rate initi zero merg agn particl two agn particl merg condit obtain distanc mathl less mesh space mathh velocityitem differ veloc mathv_rm rel less circular veloc distanc mathl math v_rm rel sqrtgm_rm bhl mathm_rm bh mass massiv smbh pair mathg gravit constant criterion velocityitem velocityitem__ necessari order prevent agn particl merg flythrough encount two halo could lead agn particl quickli remov host halo due momentum conserv merger two agn particl implement less massiv one remov mass momentum transfer massiv one accret agn particl mass mathm_rm bh bondihoyl accret rate math dotm_rm b alpha frac pi g m_rm bh overlinerhooverlinec_ overlineu mathoverlinerho mathoverlinec_ mathoverlineu volum averag cloudincel stencil gass densiti squar sound speed squar veloc respect neighborhood particl maximum black hole accret rate eddington limit math dotm_rm edd frac pi g m_rm bh m_rm pepsilon_rm r sigma_rm c proton mass mathm_rm p thomson cross section mathsigma_rm speed light mathc mass accret rate smbh smaller two rate mathdotm_rm acc rm min dotm_rm b dotm_rm edd ga lose mass mathdotm_rm acc delta mathdelta length time step howev mathdotm_rm acc adjust downward necessari cloudincel stencil weight appli neighborhood particl fraction ga densiti remov cell stencil mathf_rm max remov mass agn particl increas mathepsilon_rm r dotm_rm acc delta mathdotm_rm acc delta amount ga mass remov grid accord cloudincel stencil weight neighborhood particl momentum transfer comput assum veloc ga unchang thu ga cell lose momentum proport mass loss particl gain sum ga momentum loss multipli mathepsilon_rm r feedback energi feedback energi store agn particl variabl mathe_rm agn accumul time releas fraction mathf_rm kin goe kinet energi rest thermal energi thermal feedback increment mathe_rm agn thermal feedback energi calcul mass accret rate math high energi delta e_rm thermal f_rm kin epsilon_rm c epsilon_rm r dotm_rm acc c delta kineticmomentum feedback increment mathe_rm agn kinet feedback energi math low energi delta e_rm kinet f_rm kin epsilon_rm kin dotm_rm acc c delta also need adjust energi densiti momentum densiti ga comput jet veloc math vecv_rm jet sqrtfrac delta e_rm kineticm_rm g vecn mathm_rm g total ga mass insid cloudincel local environ mathvecn randomli chosen unit vector add mathrho vecv momentum densiti mathvecp ga mathvecv_rm jet cdot vecp energi densiti weight cloudincel stencil particl releas feedback energi accumul energi releas math e_rm agn m_rm g overline labeleqe_agn mathoverline averag specif intern energi ga cloudincel stencil obtain equat state use temperatur matht_rm min averag densiti ga stencil mathm_rm g total ga mass insid cloudincel local environ _secreeb reeber packag reeber separ packag halo finder reeber paramet assign input file paramet definit accept valu default reeberhalo_int timestep halo finder call integ none reeberneg allow neg valu analysi fals true reeberhalo_density_var densiti variabl list densiti particle_mass_dens densiti reeberhalo_extrema_threshold extrema threshold halo real reeberhalo_component_threshold compon threshold halo real reeberabsolute_halo_threshold halo threshold absolut multipl mean absolut tablereeberinput graviti introduct order use graviti one must set nyxdo_grav input file see refgrav list parameterslistofparamet relev input flag poisson approxim nyx alway comput graviti solv poisson equat mesh hierarchi defin gravit vector set math mathbfgmathbfxt nabla phi math mathbfdelta phi frac pi ga rho overlinerho labeleqself graviti mathoverlinerho averag mathrho entir domain assum tripli period boundari condit mathat scale univers function time time integr strategi nyx use subcycl integr level differ timestep graviti algorithm need respect selfgrav comput via multigrid coarsefin interfac stencil use laplacian understand coarsefin interfac differ stencil use interior two type solv discuss amr composit solv multilevel solv start coars level usual level solv potenti level finest level level solv solv potenti particular level finer level ignor coarsefin interfac data coars level act dirichlet boundari condit currentlevelsolv briefli begin simul multilevel composit solv gravityno_composit also multilevel composit solv regrid oldtim graviti coars level defin base composit solv also level solv coars level use determin differ composit solv level solv store multifab hydro advanc coars level anoth level solv use level solv composit solv lag predictor much need add back level solv get effect newtim valu phi coars level that defin phi use newtim graviti fine grid timestep use strategi amr synchron step across level choos synchron gravit field across level gravityno_sync solv start coars grid adjust mismatch finegrid phi coarsegrid phi well mismatch finegrid densiti flux coarsegrid densiti flux add result sync solv phi coars fine level thu within graviti error toler get final result done full composit solv end timestep assum gravityno_sync gravityno_composit never full multilevel solv graviti level defin solv level time would appropri fine level cover essenti mass grid time hydrodynam sourc term use standard predictorcorrector formal updat momentum energi specif first updat equal mathdelta time mathbfsn mathmathbfsn valu sourc term oldtim usual call timelevel mathn end timestep corrector step subtract mathdelta time mathbfsn add mathdelta time mathbfsn end timestep sourc term properli time center role cppcode languag c grid load balanc nyx great deal flexibl come decompos comput domain individu rectangular grid distribut grid mpi rank grid differ size one grid per mpi rank differ strategi distribut grid mpi rank use phrase load balanc refer combin process grid creation recreat regrid distribut grid mpi rank see refsecgrid_cr grid creat ie cppboxarray cppmultifab built defin level see refsecload_balanc strategi amrex support distribut grid mpi rank ie defin cppdistributionmap cppmultifab level built run multicor machin openmp also control distribut work set size grid tile defin cppfabarray_mfitertile_s also specifi strategi assign tile openmp thread see amrex document tile toctre maxdepth gridcreat loadbalanc role cppcode languag c _insitu situ analysi nyx support situ visual use ascent leverag amrex sensei visual pipelin addit nyx support situ halo find use reeber use situ analysi tool subgrid model like agn develop insitu call control input flag exampl analysi happen start step step forth insituint insitustart addit request analysi specif redshift nyx adjust timestep reach redshift exactli nyxanalysis_z_valu ascent visual primari exampl function nyxexeclya compil ascent add gnumakefilesummit use_ascent_insitu true ascent_actionsyaml file determin code run ascent publish action ascent_actions_slicefileyaml file give exampl save slice data rather imag file simul run build ascent conduit machin configur see build ascent httpsascentreadthedocsioenlatestbuildingascenthtml_ inform use ascent amrexbas applic see amrex blueprint tutori httpsamrexcodesgithubioamrextutorials_htmlblueprint_tutorialhtml_ warpx ascent insitu document httpswarpxreadthedocsioenlatestvisualizationascenthtml_ sensei interfac see amrex document sensei httpsamrexcodesgithubioamrexdocs_htmlvisualizationhtmlsensei_ halo find find halo situ nyx run use reeber packag compil reeber add gnumakefil reeber true set locat boost librari boost_inlude_dir boost_rootincludeboost gnumak default diy_include_dir diyinclud reeber_ext_hom reeber note code separ repositori includ nyx distribut intend use situ halo find clone reeber github page httpsgithubcommrzvreeber_ follow instal instruct provid nyx input file one specifi time step interv halo finder field use use total densiti one specifi ga densiti particle_mass_dens threshold boundari extrema valu halo finder reeberhalo_int reeberneg reeberhalo_density_var densiti particle_mass_dens reeberhalo_extrema_threshold reeberhalo_component_threshold call reeber insitu analysi insitureeber_int _note instruct base reeber hash adafbdafceebcb diy hash ecabdebdabedbcc nyx hash cebfcacadefabab hydrodynam heatingcool split solv equat ga dynam coordin system comov expand univers expans factor matha relat redshift mathz matha z describ state ga mathoverlinebf u rho rho bf u rho e rho e write evolut ga math fracpartialoverlinebf uparti nablacdotbf f s_e s_g s_hc mathbf f rho bf u rho bf ubf u rho bf ue p bf u rho bf ue flux vector maths_ p nabla cdot bf u repres addit term evolut equat intern energi maths_g rho_b bf g rho bf ucdot bf g repres gravit sourc term maths_hc rho lambda_hc rho lambda_hc repres combin heat cool sourc term state mathoverlinebf u sourc term defin cell center flux defin cell face comput mathbf f use unsplit godunov method characterist trace full corner coupl track deriv variabl temperatur electron fraction ne base intern energi concentr differ isotop hydrogen helium depend newton solv heatingcool equat state close tie intern energi strang split origin split use nyx strang split halfstep heatingcool evolv full step hydrodynam term follow halfstep heatingcool algorithm classic strang split adapt includ graviti forc term math labeleqden fracparti rhoparti fraca nabla cdot rho bf u math beginalign labeleqmomt fracparti rho bf uparti nabla cdot rho bf ubf u nabla p rho bf g endalign math beginalign fracparti rho eparti left nabla cdot rho bf ue p bf u rho bf ucdot bf g rho lambda_hc right endalign math beginalign fracparti rho eparti left nabla cdot rho bf ue p nabla cdot bf u rho lambda_hc right endalign algorithm singl level refin begin comput time step mathdelta advanc matha mathtn mathtn tn delta rest time step compos follow step step comput mathphin mathbf gn use mathrho_bn mathrho_dmn mathrho_dmn comput particl mathbf x_in note singlelevel algorithm instead use mathbf g comput end previou step chang mathbf x_i mathrho sinc step interpol mathbf gn grid particl locat advanc particl veloc mathdelta particl posit mathdelta math beginalign bf u_infrac fracanfrac bf un_i fracdelta bf gn_i bf x_in bf xn_i fracdelta tanfrac bf u_infracendalign step advanc mathbf u mathfracdelta first strang advanc math integr sourc term time mathfracdelta math beginalign enast en int lambda_hc dtprime endalign updat mathrho enastrho enastrhonleftenastenright updat mathrho enastrho enastrhonleftenastenright step advanc mathbf u mathdelta advect term advanc solut use timecent flux maths_ explicit represent maths_g time mathtn math bf unast bf unast delta tanfrac delta ts_gn mathanfrac comput predict mathbf unast state ad advect updat term mathanfrac calcul maths_g appli correct mathbf unast enforc mathrho time small_dens step second strang step advanc math integr sourc term time mathfracdelta math beginalign en enast int lambda_hc dtprime endalign updat mathrho enrho enastrhonleftenenastright updat mathrho enrho enastrhonleftenenastright store ne temp base eos_ hc updat mathen step comput mathphin mathbf gn use mathrhon mathrho_dmn mathrho_dmn comput particl mathbf x_in use mathphin initi guess mathphin order reduc time spent multigrid reach specifi toler step correct mathbf u timecent sourc term replac math math fracu appropri timecent gravit sourc term math bf un bf un fracdelta s_gn s_gn step interpol mathbf gn grid particl locat updat particl veloc mathbf u_in math beginalign bf u_in fracan left left anfrac bf unfrac_i right fracdelta bf gn_i right endalign step post_ timestep reset compute_ new_ temp sync graviti sourc deferredcorrect split algorithm algorithm base version sdc introduc nonaka et al citenonaka math fracparti rhoparti fraca nabla cdot rho bf u math beginalign fracparti rho bf uparti nabla cdot rho bf ubf u nabla p rho bf g endalign math beginalign fracparti rho eparti left nabla cdot rho bf ue p bf u rho bf ucdot bf g rho lambda_hc right endalign math beginalign fracparti rho eparti left nabla cdot rho bf ue p nabla cdot bf u rho lambda_hc right endalign algorithm singl level refin begin comput time step mathdelta advanc matha mathtn mathtn tn delta rest time step compos follow step step comput mathphin mathbf gn use mathrhon mathrho_dmn mathrho_dmn comput particl mathbf x_in note singlelevel algorithm instead use mathbf g comput end previou step chang mathbf x_i mathrho sinc step interpol mathbf gn grid particl locat advanc particl veloc mathdelta particl posit mathdelta math beginalign bf u_infrac fracanfrac bf un_i fracdelta bf gn_i bf x_in bf xn_i fracdelta tanfrac bf u_infracendalign step construct advect updat term use mathi_r last timestep sourc math beginalign a_rho fracanablacdotrhobf u a_rho u nablacdotleftrho uurightnabla p a_rho e aleftnablacdotrhobf uepbf uright a_rho e fraca left nabla cdot rho_b bf ue p nabla cdot bf u rightendalign step updat momentum mathrho e math beginalign s_g rho g rhobf ucdotbf gendalign math unast un delta tanfrac delta ts_gn math leftrho erightnast leftrho erightn delta ta_rho en delta ts_g ad advect updat term matha_ast appropri compon mathbf unast calcul maths_g appli correct mathbf unast a_rho enforc mathrho time small_den step simultan solv heatingcool math beginalign rhonast rhonint_tntna_rhodtprim enast enint_tntn lefta_elambda_hcright dtprimeendalign matha_efracdelta tleftleftleftfracanrightleftleftanrightleftrho erightndelta ta_rho erighta_resetrightleftrhondelta ta_rhorightenright step defin math beginalign i_r_leftrho eright left leftanrightrhonastenastleftleftanrightrhonendelta ta_rho erightrightleftdelta tleftfracananrightright leftanrighta_resetleftdelta tleftfracananrightrightendalign step updat intern total energi use forc mathleftrho erightnastleftrho erightnast leftfracananright leftfracanright delta ti_r_rho e mathleftrho erightnastleftrho erightnast leftfracananright leftfracanright delta ti_r_rho e store ne temp base eos_ hc updat mathen step repeat step step comput mathphin mathbf gn use mathrhon mathrho_dmn mathrho_dmn comput particl mathbf x_in use mathphin initi guess mathphin order reduc time spent multigrid reach specifi toler step correct mathbf u timecent sourc term replac math math fracu appropri timecent gravit sourc term math bf un bf un fracdelta s_gn s_gn step interpol mathbf gn grid particl locat updat particl veloc mathbf u_in math beginalign bf u_in fracan left left anfrac bf unfrac_i right fracdelta bf gn_i right endalign step post_ timestep reset compute_ new_ temp sync graviti sourc _chapnightlytest nightli regress test follow regress test run nightli nyx plotfil gener night test compar benchmark plotfil use amrex cppfcompar util compar mesh data cppparticle_compar compar particl data result test found httpsccselblgovpubregressiontestingnyx test also run nvidia gpu result found httpsccselblgovpubgpuregressiontestingnyx number compiletim option chart summar regress test test compiletim option note use_grav amrex_use_particl macro use code sourc set true build system test no_hydro use_heatcool amrdens fals true dr_restart fals fals doublerarefact fals fals driventurbul fals fals driventurbulenceomp fals fals cpu lya fals true lyaadiabat fals fals lyaomp fals true cpu lya_neutrino fals true cpu minisb fals fals minisbppm fals fals minisbref fals fals minisbrefppm fals fals partlin fals fals partlinenbodi fals fals partlinenomesh true fals partline_restart fals fals partline_restartnbodi fals fals partline_restartnomesh true fals partmassnosub fals fals partmassnosubnbodi fals fals partmassnosubnomesh true fals partmasssub fals fals partmasssubnbodi fals fals partmasssubnbodi fals fals partmasssubnomesh true fals sedov fals fals sedovppm fals fals sod fals fals sodppm fals fals strongshocktub fals fals strongshocktubeppm fals fals nxnynz number cell coordin direct coarsest level npa number particl np number mpi rank number omp thread per rank singl number pure mpi test nx ny nz nl npa np test amrdens start chk dr_restart hydro restart doublerarefact hydro driventurbul turbul forc driventurbulenceomp turbul forc cpu omp lya includ hc lyaomp lya omp cpu lyaadiabat hc lya_neutrino lya omp cpu minisb small version sb minisbppm small version sb minisbref small version sb refin minisbrefppm small version sb refin partlin particleonli partlinenbodi particleonli partlinenomesh particleonli partline_restart particleonli partline_restartnbodi particleonli partline_restartnomesh particleonli partmassnosub particleonli partmassnosubnbodi particleonli partmassnosubnomesh particleonli partmasssub particleonli partmasssubnbodi particleonli partmasssubnomesh particleonli sedov hydro plm sedovppm hydro ppm sod hydro plm sodppm hydro ppm strongshocktub hydro plm strongshocktubeppm hydro ppm prefac nyx adapt mesh nbodyhydro code cosmolog simul massiv parallel comput coupl compress hydrodynam equat grid particl represen dark matter major capabl dimension unsplit ndorder hydrodynam adapt mesh refin subcycl jump x x level full poisson graviti tripli period boundari condit hybrid parallel strategi mpi x x openmp multicor architectur cudahipdpc hybrid cpugpu architectur nyx use eulerian grid hydrodynam solver incorpor adapt mesh refin amr approach amr use nest hierarchi logicallyrectangular grid simultan refin space time util amrex librari role cppcode languag c input toctre maxdepth nyx execut read runtim inform input file put command line section describ input specifi either input file command line valu specifi command line valu overrid valu specifi input file problem geometri list paramet paramet definit accept default valu geometryprob_lo physic real must set locat low corner domain geometryprob_hi physic real must set locat high corner domain geometrycoord_si coordin cartesian must set system rz spheric geometryis_period domain fals period true direct exampl usag geometryprob_lo defin low corner domain physic space geometryprob_hi e e e defin high corner domain eee physic space geometrycoord_si defin coordin system cartesian geometryis_period say domain period ydirect domain boundari condit _listofparamet list paramet paramet definit accept valu default nyxlo_bc boundari type low face must set nyxhi_bc boundari type high face must set tablebc note boundari type interior period symmetri inflow slip wall outflow slip wall note nyxlo_bc nyxhi_bc must consist geometryis_period domain period particular direct low high bc must set direct _examplesofusag exampl usag nyxlo_bc nyxhi_bc geometryis_period would defin problem inflow lowx direct outflow highx direct slip wall low high yface period zdirect resolut _listofparamet list paramet paramet definit accept default valu amrn_cel number cell integ must set direct coarsest level amrmax_level number integ must set level refin coarsest level amrref_ratio ratio coars must set fine grid space subsequ level amrregrid_int often integ must set regrid amrregrid_on_restart regrid immedi restart tableresinput note amrmax_level need set amrref_ratio amrregrid_int _examplesofusag exampl usag amrn_cel would defin domain cell xdirect cell ydirect cell zdirect coarsest level line appear input file final number ignor amrmax_level would allow maximum refin level addit coars level note addit level creat tag criteria cell flag need refin number refin level calcul must mathleq amrmax_level chang time need alway equal amrmax_level amrref_ratio would set factor refin level factor refin level note must least amrax_level valu amrref_ratio addit valu may appear line ignor amrregrid_int tell code regrid everi step thu exampl new level grid creat everi level time step new level grid creat everi level time step regrid overview detail regrid strategi describ section subsecgridgeneration__ first cover input paramet control grid describ later user defin fortran subroutin tag individu cell given level need refin list tag cell sent grid gener routin use bergerrigoutso algorithm creat rectangular grid contain tag cell _listofparamet list paramet paramet definit accept default valu amrregrid_fil name file text file read grid amrgrid_eff grid real effici coars level grid creat amrn_error_buf radiu integ addit tag around alreadi tag cell amrmax_grid_s maximum size integ grid direct amrmax_grid_s maximum size integ amrblocking_factor grid size must integ multipl amrrefine_grid_layout refin grid fals true processor math grid tablegriddinginput _note note amrn_error_buf amrmax_grid_s amrblocking_factor read singl valu assign everi level multipl valu one level amrmax_grid_s everi level must even amrblocking_factor everi level must power domain size amrn_cel must multipl amrblocking_factor level amrmax_grid_s must multipl amrblocking_factor everi level _examplesofusag exampl usag amrregrid_fil fixed_grid case list grid fine level contain file fixed_grid read grid procedur grid must violat amrmax_grid_s criterion rest grid procedur describ occur amrregrid_fil set amrgrid_eff grid creation process least cell grid level grid creation occur must tag cell note appli coarsen level grid actual made amrmax_grid_s impos amrmax_grid_s final grid longer cell side everi level amrmax_grid_s final grid longer cell side level cell side level cell side level amrblocking_factor dimens final grid multipl level amrblocking_factor dimens final grid multipl level multipl level multipl level grid larg enough coarsen multipl level vcycl essenti good multigrid perform simul use selfgrav _subsecgridgener grid creat grid algorithm proce order level domain initi defin n_cell specifi input file level greater grid creat use bergerrigoutsi cluster algorithm appli tag cell modifi ensur length new fine grid divis blocking_factor next grid list chop grid length longer max_grid_s note max_grid_s multipl blocking_factor long max_grid_s greater blocking_factor blocking_factor criterion still satisfi next refine_grid_layout processor grid level grid level divid order ensur processor fewer one grid level max_grid_s bl_spacedim direct multipl blocking_factor chop grid bl_spacedim direct none grid longer direct max_grid_s still fewer grid process repeat procedur bl_spacedim direct bl_spacedim direct necessari complet sweep coordin direct max_grid_s still fewer grid process repeat step max_grid_s simul time _listofparamet list paramet paramet definit accept default valu max_step maximum number level integ time step stop_tim final simul real time nyxfinal_a final valu real nyxfinal_z final valu z real tabletimeinput _note note control number time step limit maximum number level time step max_step final simul time stop_tim code stop whichev criterion come first note code reach stop_tim final time step shorten end exactli stop_tim pass run comov coordin also set final valu matha set nyxfinal_a final valu mathz set nyxfinal_z may specifi one valu matha mathz reach time step code stop end full coars time step note stop matha mathz exactli equal final valu rather stop matha greater mathz less valu _examplesofusag exampl usag max_step stop_tim end calcul either simul time reach number level step taken equal whichev come first time step nyxdo_hydro math typic code choos time step base cfl number dt cfl dx maxuc nyxdo_hydro math run dark matter particl use time step base veloc particl ie set mathdelta particl goe mathf delta coordin direct math leq f leq valu mathf current hardwir particlesh becom input paramet _listofparamet list paramet paramet definit accept default valu nyxcfl cfl number real hydro particlescfl cfl number real particl nyxinit_shrink factor real shrink initi time step nyxchange_max factor real time step grow subsequ step nyxfixed_dt level time real unus step set regardless cfl set nyxinitial_dt initi real unus level time set step regardless set nyxdt_cutoff time step real calcul abort nyxdt_binpow time step real chosen power half time comov time step nyxrelative_max max dadt real _change_a nyxabsolute_max a_newa_old real _change_a tabletimestepinput _examplesofusag exampl usag nyxcfl defin timestep dt cfl dx umax_hydro particlescfl defin timestep dt cfl dx umax_particl umax_particl maximum veloc particl domain nyxinit_shrink set initi time step would otherwis nyxchange_max allow time step increas case note time step shrink factor control extent grow nyxfixed_dt e set level time step e entir simul ignor timestep control note nyxinit_shrink mathneq first time step fact nyxinit_shrink nyxfixed_dt nyxinitial_dt e set initi level time step e regardless nyxcfl nyxfixed_dt time step grow subsequ step factor nyxchange_max step nyxdt_cutoff e tell code abort time step ever get e safeti mechan thing go nut dont burn entir comput alloc dont realiz code misbehav nyxdt_binpow set mathmathrmdtleftfracrightnmathrmdt_mathrmanmathrmdt_mathrmcflleftfracrightnmathrmdt_a mathmathrmdt_mathrmcfl determin restrict timestep nyxcfl particlescfl mathmathrmdt_mathrma determin relative_max_change_a absolute_max_change_a evolut mathfracdadt subcycl support number differ mode subcycl time amrsubcycling_mod math auto default code run equal refin space time word level mathn factor refin level mathn mathn take step half durat everi level mathn step amrsubcycling_mod math none code refin time level advanc togeth timestep dictat level strictest mathdt note ident deprec command amrnosub amrsubcycling_mod math manual code subcycl accord valu suppli subcycling_iter _listofparamet list paramet paramet definit accept default valu amrsub shall auto none auto cycling_mod subcycl manual amrsubcycli number must set g_iter cycl ref_ratio manual mode level _examplesofusag exampl usag amrsubcycling_mod math manual subcycl manual mode largest allow timestep amrsubcycling_iter take level timestep time requir take level timestep level step timestep level level step take timestep level level step amrsubcycling_iter altern form subcycl twice everi level except level restart capabl standard sort checkpoint restart capabl input file follow option control gener checkpoint file realli directori _listofparamet list paramet paramet definit accept default valu amrcheck_fil prefix string chk restart file amrcheck_int often integ level time math step write restart file amrcheck_p often real simul math time write restart file amrrestart name string use file set directori restart amrcheckpoint_files_output write checkpoint file amrcheck_nfil parallel integ write mathgeq checkpoint file amrcheckpoint_on_restart write checkpoint immedi restart _note note specifi either amrcheck_int amrcheck_p tri specifi note amrcheck_p use order hit exact time code may modifi time step slightli chang result ever slightli didnt set flag note amrplotfile_on_restart amrcheckpoint_on_restart take effect amrregrid_on_restart effect see softwar section detail parallel io amrcheck_nfil paramet scale studi set amrcheckpoint_files_output test scale algorithm without io _examplesofusag exampl usag amrcheck_fil chk_run amrcheck_int mean restart file realli directori start prefix chk_run gener everi level time step directori name chk_run chk_run chk_run etc instead specifi amrcheck_fil chk_run amrcheck_p restart file realli directori start prefix chk_run gener everi unit simul time directori name chk_run chk_run chk_run etc matht level step matht level step etc restart chk_runfor exampl set amrrestart chk_run _secplotfil control plotfil gener main output form plotfil realli directori follow option input file control gener plotfil _listofparamet list paramet paramet definit accept default valu amrplot_fil prefix string plt plotfil amrplot_int often integ level time math step write plot file amrplot_p often real math simul time write plot file amrplot_var name state none variabl list includ plotfil amrderive_plot_var name deriv none none variabl list includ plotfil amrplot_files_output write plot file amrplotfile_on_restart write plotfil immedi restart amrplot_nfil parallel integ write mathgeq plotfil nyxplot_rank plot true fals fals processor id plotfil fabformat write nativ ieee nativ plotfil doubl singl precis option amrderive_plot_var kept derive_lst nyx_setupcpp feel free look see what _note note specifi either amrplot_int amrplot_p tri specifi note amrplot_p use order hit exact time code may modifi time step slightli chang result ever slightli didnt set flag see softwar section detail parallel io amrplot_nfil paramet scale studi set amrplot_files_output test scale algorithm without io default plotfil written doubl precis nativ format want save space write singl precis set fabformat flag ieee _examplesofusag exampl usag amrplot_fil plt_run amrplot_int mean plot file realli directori start prefix plt_run gener everi level time step directori name plt_run plt_run plt_run etc instead specifi amrplot_fil plt_run amrplot_p restart file realli directori start prefix plt_run gener everi unit simul time directori name plt_run plt_run plt_run etc matht level step matht level step etc plotfil variabl nativ variabl variabl come directli statedata either state_typ hydrodynam variabl diageos_typ nuclear energi gener quantiti phigrav_typ gravity_typ graviti quantiti variabl name descript unit densiti baryon mass densiti mathrho math_odot mpc math xmom xmomentum mathrho u mathrm gkm ymom ymomentum mathrho v mathrm gkm zmom zmomentum mathrho w mathrm gkm rho_e total energi densiti mathrm ergkm rho_e intern energi densiti mathrm ergkm temp temperatur mathrm k ne number densiti electron dimensionless rho_x mass densiti speci x valid non dimensionless x h speci constant speci defin network phigrav gravit potenti mathrm ergg grav_x grav_i gravit acceler mathrm km grav_z deriv variabl variabl name descript deriv routin unit divu mathnabla cdot ub derdivu mathrm eint_ specif intern energi comput dereint mathrm ergg conserv mathrho e state variabl math rho erho eint_ specif intern energi comput dereint mathrm ergg total energi momentum conserv state matherho efracrho ubrho kineng kinet energi densiti derkineng mathrm ergkm mathk frac rho ub logden mathlog_ rho derlogden math_odot mpc math machnumb fluid mach number mathubc_ dermachnumb maggrav gravit acceler magnitud dermaggrav mathrm km magmom momentum densiti magnitud dermagmom mathrm gkm mathrho ub magvel veloc magnitud mathub dermagvel mathmathrmkm magvort vortic magnitud mathnablatimesub dermagvort mathrm pressur total pressur includ ion electron derpr mathrm dynkm soundspe sound speed dersoundspe mathmathrmkm h mass fraction speci h derspec x_veloc fluid veloc dervel mathmathrmkm y_veloc mathub rho ubrho z_veloc screen output _listofparamet list paramet paramet definit accept default valu amrv verbos amrcpp nyxv verbos nyxcpp gravityv verbos gravitycpp mgv verbos multigrid solver graviti particlesv verbos particlerel process amrgrid_log name string use file set grid written amrrun_log name string use file set certain output written amrrun_log_ters name string use file set certain terser output written amrsum_interv math often level time step comput integ print integr quantiti _examplesofusag exampl usag amrgrid_log grdlog everi time code regrid print list grid relev level code write grid list file grdlog amrrun_log runlog everi time step code print certain statement screen amrv step time dt plotfil file plt statement written runlog well amrrun_log_ters runlogters file runlogters differ runlog contain line form number step taken simul time level time step file plot easili monitor time step nyxsum_interv nyxsum_interv math code comput print certain integr quantiti total mass momentum energi domain everi nyxsum_interv level step exampl code print quantiti everi two coars time step print statement form time mass e exampl line comment comput print quanit graviti _listofparamet list paramet paramet definit accept default valu nyxdo_grav includ fals must set graviti true forc term gravityno_sync whether fals perform true sync solv gravityno_composit whether fals perform true composit solv _note note includ graviti must set nyxdo_grav input file physic _listofparamet list paramet paramet definit accept default valu nyxdo_hydro timeadv fals must set fluid true dynam equat nyxppm_typ use ppm plm ppm plm hydro ppm advanc nyxenforce_min_density_typ enforc floor floor rho greater con small_den nyxstrang_split use strang fals split true nyxsdc_split use sdc fals split true nyxstrang_grown_box use growntilebox fals avoid comm true nyxadd_ext_src includ fals addit true userspecifi sourc term nyxnghost_st set number ghost cell state variabl nyxuse_const_speci read h_speci he_speci nyxh_speci concentr math x h math nyxhe_speci concentr math x math cosmolog _listofparamet list paramet paramet definit accept default valu nyxcomoving_omm rel total math x must set mass densiti math nyxcomoving_omb rel baryon math x must set densiti math nyxcomoving_omr rel math x must set radiat densiti math nyxcomoving_h dimensionless math x must set hubbl paramet math nyxgamma dimensionless math x math factor relat math mathp rho e exampl usag nyxgamma chang mathgamma mathgamma law ga mathp gamma rho e reioniz model _listofparamet list paramet paramet definit accept default valu uvb_rates_fil name uvb string must set treecool file uvb_density_a densitydepend real heat uvb_density_b densiti depend real heat reionization_zhi_flash redshift math x flash h reion reionization_zheii_flash redshift math x flash reion inhomo_reion inhomogen reioniz inhomo_zhi_fil file string must set reioniz map use inhomo_grid size integ must set reioniz grid use reionization_t_zhi h reioniz real e heat input reionization_t_zheii reioniz real e heat input multigrid input follow input set directli amrex solver class set via nyx graviti routin must preced graviti input file descript type default v verbos graviti class int ml_tol rel toler multilevel solv real e sl_tol rel toler singlelevel solv real e delta_tol rel toler synchron solv real e mlmg_agglomer agglomer deep vcycl int mlmg_consolid consolid deep vcycl int dirichlet_bc use homogen dirichlet bc int graviti solv use test must preced mg input file descript type default v verbos multigrid solver int bottom_solv bottom solver string bicg option includ bicg smoother hypr etc max_fmg_it maximum number fcycl int continu vcycl multigrid solv number addit input use control multigrid solver see amrex multigrid documentation_ detail _amrex multigrid document httpsamrexcodesgithubioamrexdocs_htmllinearsolvers_chapterhtml memori optim _listofparamet list paramet paramet definit accept default valu nyxshrink_to_fit shrink particl fals vector save true memori nyxminimize_memori use less fals temporari scratch true memori hydro nyxload_balance_int often int never loadbal int particl nyxload_balance_start_z redshift start real loadbalanc particl nyxload_balance_wgt_stategi weight strategi loadbal particl nyxload_balance_wgt_nmax max rank int rank loadbal particl nyxload_balance_stategi dmap strategi knapsack sfc type particl sfc loadbalanc roundrobin initi condit coupl main way initi condit set nyx use ascii particl file use binari particl file use uniform particl setup use random particl setup use binari mesh file setup use analyt setup said unit section document unit mpc math_odot km particl veloc peculiar proper veloc start ascii file enabl option set nyxparticle_init_typ asciifil nyxascii_particle_fil particle_fil particle_fil userspecifi name file first line file long assum contain number particl line contain x z mass vx vy vz start binari file enabl option set nyxparticle_init_typ binaryfil nyxbinary_particle_fil particle_fil binari file header number long np total number particl file follow int dm number dimens int nx number extra field follow small header float number list particl x z mass vx vy vz main differ ascii binari format thu amount differ header exampl c code write nyxread binari file fwritenpart sizeoflong outfil fwritedm sizeofint outfil fwritenx sizeofint outfil fori inpart fwritexi sizeoffloat outfil fwriteyi sizeoffloat outfil fwritezi sizeoffloat outfil fwritemassi sizeoffloat outfil fwritevxi sizeoffloat outfil fwritevyi sizeoffloat outfil fwritevzi sizeoffloat outfil start binari meta file option allow read particl seri file rather singl file conveni larg simul enabl option set nyxparticle_init_typ binarymetafil nyxbinary_particle_fil particl file case particle_fil specifi ascii file specifi list file name full path file list assum binari read sequenti individu file read parallel order list sinc individu file read sequenti particl read redistribut across mpi rank set optim maximum number reader increas number particl per read amrnread amrnparts_per_read start plotfil checkpoint enabl option set nyxparticle_init_typ restart nyxrestart_particle_fil plot_fil case plot_fil contain particl directori dm test function mainli current default version_two_dot_zero_singl read sph particl initi singl particl speci assum baryon trace dark matter baryon densiti veloc set cicmap particl onto eulerian grid altern one initi baryon ga sph particl enabl option must set nyxdo_santa_barbara nyxinit_with_sph_particl sphtype particl read set sph_particle_fil userspecifi name file contain sph particl type sph_particle_fil must ascii binari binarymeta dark matter particl file specifi sph particl discard code grid data initi initi condit test purpos follow use code test purpos result meaning cosmolog simul random placement enabl option set nyxparticle_init_typ random number paramet set exampl nyxparticle_initrandom_count nyxparticle_initrandom_mass_tot nyxparticle_initrandom_ise nyxfix_random_se random placement particl per grid cell enabl option set nyxparticle_init_typ randompercel set mass per particl nyxparticle_initrandom_mass note increas number cell keep problem domain size total mass fix mass per particl must decreas proport altern set total mass particl simul caus nyx scale mass per particl fit number cell follow total mass nyxparticle_initrandom_mass amrn_cel nyxparticle_initrandom_mass nyxparticle_initrandom_mass_tot amrn_cel nyxparticle_initrandom_mass nyxparticle_initrandom_mass_tot amrn_cel nyxparticle_initrandom_mass amrn_cel nyxparticle_initrandom_mass nyxparticle_initrandom_mass_tot amrn_cel nyxparticle_initrandom_mass nyxparticle_initrandom_mass_tot amrn_cel uniform placement enabl option set nyxparticle_init_typ onepercel number paramet set exampl nyxparticle_inituniform_mass nyxparticle_inituniform_vx nyxparticle_inituniform_vi nyxparticle_inituniform_vz initi multifabbas setup enabl option set nyxparticle_init_typ cosmolog nyxdo_readin set directori name multifab restart state variabl nyxreadin_ics_fnam mf initi analyt problem setup enabl option set nyxdo_santa_barbara nyxinit_sb_vel differ execut directori probcpp setup customis prob input flag hydrotest directori probprob_typ correspond sod strongshocktub doublerarefact type test probprob_typ correspond sedov type test nyx document master file creat sphinxquickstart fri dec adapt file complet like least contain root toctre direct welcom nyx document toctre maxdepth caption nyx basic nyxprefac nyxcit nyxgettingstart nyxunit nyxinput ic refin managinggridhierarchy_chapt nyxgrav nyxequ nyxsplit nyxheatcool nyxforc particl insitu postprocess nightlytest debug develop toctre maxdepth caption content indic tabl refgenindex refmodindex refsearch stochast forc option appli stochast forc field see nyxexecdriventurbul exampl note nyxdo_forc must set input file extern forc term momentum equat eqmomt eqmomt__ given math bf s_rho ub rho_b mathbff acceler field mathmathbffmathbfxt comput invers fourier transform forc spectrum mathwidehatmathbffmathbfkt time evolut wave mode given ornsteinuhlenbeck process see rawlatexciteschmhilleschmidt detail sinc real space forc act larg scale mathl nonzero mode confin narrow window small wave number prescrib shape forc profil result flow reach statist stationari isotrop state rootmeansquar veloc order mathvlt integr time scale matht also known largeeddi turnov time usual set equal autocorrel time forc possibl vari forc field solenoid divergencefre weight paramet mathzeta dilat rotationfre mathzeta maintain nearli constant rootmeansquar mach number simpl model radi heat cool around given equilibrium temperatur matht_ appli energi equat eqenergi eqenergy__ math s_rho e s_rho e ub cdot bf s_rho ub fracalpha k_rm btt_mu m_rm hgamma rho_bubcdotmathbff paramet matht_ mathalpha correspond temp alpha respect probin file along rho mean densiti uniti default ga adiabat mathalpha becom nearli isotherm cool time scale given mathalpha chosen suffici short compar matht perform reason constant composit correspond constant molecular weight mathmu assum list paramet paramet definit accept default valu forcingse seed integ random number math gener forcingprofil shape plane forc band spectrum parabol forcingalpha ratio domain integ size mathx math integr length mathlxalpha forcingband_width band width real forc mathg spectrum rel mathl alpha forcingintgr_vel characterist real must set veloc math mathv forcingauto_corrl autocorrel real time unit math mathtlv forcingsoln_weight weight real mathzeta mathg solenoid rel mathl dilat mode tripl forcingalpha forcingband_width forcingintgr_vel forcingauto_corrl correspond three spatial dimens _chapgettingstartednew get start nyx sourc code current live github repositori httpsgithubcomamrexastronyxgit_ clone use git codeblock shell git clone httpsgithubcomamrexastronyxgit recurs note recommend git version x higher obtain sourc code follow section describ sourc code content compil run simpl simul visual simul result toctre maxdepth sourc directori overview getting_startedstructur build nyx gnu make getting_startedbuildinggmak build nyx cmake getting_startedbuildingcmak run code getting_startedrunningthecod compil nyx sundial getting_startednyxsundi addit detail compil nyx differ environ found amrex build document httpsamrexcodesgithubioamrexdocs_htmlbuildingamrex_chapterhtml_ container ubuntu build cmake run github action httpsgithubcomamrexastronyxactionsworkflowslinuxyml_ whose workflow file store nyxgithubworkflow citat use nyx appreci cite main code paper almgren j b bell mj lijewski z lukic e van andel nyx massiv parallel amr code comput cosmolog astrophys journal journalhttpsiopscienceioporgarticlex pdfhttpsiopscienceioporgarticlexpdf bibtex articlenyx author almgren bell jb lijewski mj lukic z van andel e titl nyx massiv parallel amr code comput cosmolog journal astrophys journal archiveprefix arxiv eprint keyword gravit hydrodynam method numer year month mar volum eid page doi x develop amrex librari led center comput scienc engin lawrenc berkeley nation laboratori nyx develop done collabor includ comput cosmolog center ccse nyx develop done public github repositoryanyon see updat done alway happi new develop part nyx team fork nyx git repositori github make chang issu pull request develop branch github repo level chang welcom includ document bug fix new test problem new solver todo describ developercontributorauthor list role cppcode languag c role fcode languag fortran _postprocess analyz output analysi visual purpos nyx output plotfil userdefin grid quantiti andor particl data file format nativ amrex framework also option use hdf output implement testingoptim phase visual sever visual tool use amrex plotfil specif visit paraview yt see amrex document httpsamrexcodesgithubioamrexdocs_htmlvisualization_chapterhtml_ guidanc use tool follow input control plotfil written descript type default amrplot_int frequenc plotfil output int plotfil written amrplotfile_on_restart write plotfil restart use plot_int bool fals amrplot_fil prefix use plotfil output string plt follow control variabl appear plotfil descript type default amrplot_var name state variabl plotfil string amrplot_dervive_plot_var name deriv variabl plotfil string nyx also easili interfac two postprocess suit reeber use halo find gimlet use calcul differ summari statist reeber reeber use topolog method construct merg tree scalar field tree effect parameterindepend contain complet descript field topolog context nyx field interest usual total matter densiti nyx queri merg tree userdefin runtim paramet order locat volumeaverag center dark matter halo tree queri number paramet find halo differ massdens threshold reeber publicli avail github httpsgithubcommrzvreeber_ gimlet gimlet comput varieti quantiti simul includ optic depth lymanalpha flux power spectra lineofsight well fulli probabl distribut function suit fulli mpiparallel run either situ intransit combin gimlet code yet publicli avail work releas nyx amrex provid capabl user execut arbitrari postprocess workflow utildiagnost provid simpl exampl open amrex plotfil read manipul data start place build analysi tool specif need role cppcode languag c _chapdebug debug debug art everyon favorit method offer tip found use compil debug mode eg cppmake debugtru gmake user cppcmake ddebug cmake user run cppamrexfpe_trap_invalid input file help debug mode mani compil debug flag turn cppmultifab initi signal nan cppamrexfpe_trap_invalid paramet result backtrac file float point except occur one examin file track origin issu sever way look data includ write cppmultifab disk highlight c vismfwriteconst fabarrayfarraybox mf const stdstring name examin amrvi section refsecamrvi amrex document also use cppprint_stat routin highlight c void print_stateconst multifab mf const intvect cell const int n output data singl cell want compar old new plotfil highlight c fcompar infil plt_run infil plt_run diffvar u_g print maximum absolut rel differ two plotfil variabl also creat new plotfil diff contain differ u_g case two plotfil cppfcompar execut built amrex go amrextoolsplotfil type make valgrind anoth use debug tool note run use one mpi process one tell valgrind output differ file differ process exampl highlight consol mpiexec n valgrind leakchecky trackoriginsy logfilevallogp nyxdex build nyx cmake cmake build twostep process first cmake invok creat configur file makefil chosen directori builddir next actual build perform invok make within builddir new cmake short tutori httpshsftraininggithubiohsftrainingcmakewebpage_ hep softwar foundat perfect place get start cmake build process nyx summar follow creat enter build directori highlight consol mkdir pathtobuilddir cd pathtobuilddir perform configur step highlight consol cmake nyx option depend option dcmake_build_typedebugreleaserelwithdebinfominsizerel pathtonyxrepo snippet nyx option indic one option custom build list reftabl tabnyxcmakeopt wherea dependeci option one cmake configur option nyx depend ie amrex cmake option httpsamrexcodesgithubioamrexdocs_htmlbuildingamrexhtmlbuildingwithcmake_ sundial option cmake_build_typ omit cmake_build_typereleas assum exampl enabl amrex profil capabl nyx configur follow code shell cmake nyx option damrex_tiny_profiley dcmake_build_typedebugreleaserelwithdebinfominsizerel build execut interest small version santa barbara problem exampl highlight consol cd pathtobuilddirnyxexecminisb make result execut nyx_minisb note nyx requir cmake higher raw latex begincent _tabnyxcmakeopt tabl nyx configur option option name descript possibl valu default valu cmake_cxx userdefin c flag valid c none _flag compil flag cmake_cuda userdefin cuda flag valid cuda none _flag compil flag build_shar build depend share noy _lib librari nyx_mpi enabl build mpi noy ye nyx_mpi_thread concurr mpi call noy ye _multipl multipl thread nyx_omp enabl build openmp noy nyx_gpu_ onnod acceler gpu none nonesycl backend backend cudahip nyx_hydro run baryon hydro solv noy ye field nyx_heatcool run h heat noy cool effect nyx_const_ dont evolv h treat noy speci constant nyx_cg evolv quantiti cg noy unit instead code unit raw latex endcent work git submodul default nyx cmake search system exist instal requir depend amrex alway requir sundial may requir depend configur option requir depend found system nyx cmake automat checkout build depend part build process end nyx cmake reli git submodul checkout amrex andor sundial git repositori follow focu amrex git submodul concept appli unchang sundial submodul well amrex submodul initi nyx cmake initi checkout commit submodul point instead amrex submodul alreadi manual initi custom commit check commit use nyx develop test may need build differ branch releas amrex subprojectsamrex directori git repo use standard git command either cd subprojectsamrex run git command amrex directori use git c subprojectsamrex nyx repo instanc build myamrexbranch branch amrex repo code shell git c subprojectsamrex checkout myamrexbranch git statu modifi subprojectsamrex new commit branch myamrexbranch use build nyx revert default version amrex submodul run git submodul updat code shell git submodul updat git statu noth commit work tree clean edit commit pull push amrex chang subprojectsamrex amrex develop outsid scope document run git statu toplevel nyx repo see whether amrex submodul new commit modifi file untrack file updat amrex submodul referenc nyx code shell git c subprojectsamrex checkout updated_amrex_commit_sha git add subprojectsamrex git commit updat amrex version updat amrex sha referenc nyx uncommit amrex chang untrack amrex file subprojectsamrex ad git add subprojectsamrex commit amrex repo chang directori subprojectsamrex run git command git add subprojectsamrex note updat amrex submodul refer coordin nyx develop _secbuildextern use exist instal requir depend may prefer build nyx amrex andor sundial instal alreadi present system unless instal locat standard system path need tell nyx cmake look code shell cmake dcmake_build_typedebugreleaserelwithdebinfominsizerel nyx option damrex_rootabsolutepathtoamrexinstalldir pathtonyxrepo exampl damrex_rootabsolutepathtoamrexinstalldir instruct cmake search absolutepathtoamrexinstalldir search system path avail amrex instal amrex_root also set environment variabl instead pass command line option similarli defin sundials_root variabl either via command line environ teach cmake look sundial choos one cmake_build_typ control level optim option dcmake_build_typereleas give default gmake note build nyx system default compil overwritten follow code shell cmake dcmake_cxx_compilerccompil dcmake_fortran_compilerfcompil option build platform use modul util use either command full path compil follow code shell cmake dcmake_cxx_compilercc dcmake_fortran_compilerftn option nyx use compil flag use build amrex unless cmake_fortran_flagscmake_cxx_flag explicitli provid environment variabl fflagscxxflag set gpu build nyx reli amrex gpu build infrastructur httpsamrexcodesgithubioamrexdocs_htmlgpuhtmlbuildingwithcmake_ target architectur build specifi via amrex configur option damrex_cuda_archtargetarchitectur defin environment variabl amrex_cuda_arch cap gpu architectur specifi cmake tri determin gpu support system build nyx cori nersc standard build cori cluster nersc first need loadunload modul requir build nyx code shell modul unload altd modul unload darshan modul load cmake default option cori haswel architectur intel compil want compil knight land knl architectur code shell modul swap craypehaswel craypemicknl use gnu compil code shell modul swap prgenvintel prgenvgnu nyx built note loadunload modul option could save bash_profileext gpu build compil gpu node cori first need purg modul wont work gpu node code shell modul purg need load follow modul code shell modul load cgpu gcc cuda openmpi cmake current need use openmpi mvapich seem work need use slurm request access gpu node code shell salloc n c c gpu gresgpu exclus reserv entir gpu node job note cant crosscompil gpu node log one build softwar final navig base nyx repositori compil gpu mode code shell cd nyx mkdir build cd build cmake dnyx_gpu_backendcuda damrex_cuda_archvolta dcmake_cxx_compilerg make j inform gpu node cori httpsdocsdevnerscgovcgpu_ build nyx summit olcf summit cluster olcf first need loadunload modul requir build nyx code shell modul load gcc modul load cmake build nyx gpu need load cuda modul code shell modul load cuda compil code shell cd nyx mdkir build cd build cmake dnyx_gpu_backendcuda damrex_cuda_archvolta dcmake_c_compilerwhich gcc dcmake_cxx_compilerwhich g dcmake_cuda_host_compilerwhich g dcmake_cuda_architectur make j inform summit cluster httpswwwolcfornlgovforuserssystemuserguidessummit_ note loadunload modul option could save profil run code nyx execut read runtim inform input file design command line valu specifi either input file command line valu specifi command line valu overrid valu specifi input file see input section detail paramet specifi runtim within build directori type executablenam inputsnam executablenam nyxdlinuxgnuex built nyx gnu make nyx_nameofbuilddirectori built nyx cmake inputsnam small test problem input minisb exampl inputsrt lya exampl execut directori input larger problem inputsrt inputsregtest regressiontest size problem note certain hpc system may want run directori separ compil build directori case copi execut input file build directori run directori scratch run start binary_particle_fil need absolut path inputsnam symlink run directori run heatingcool must access treecool_middl file run directori ascent insitu run need access ascent_actionsyaml notic run code gener directori look like plt plt etc chk chk etc plotfil checkpoint file plotfil use visual checkpoint file restart code see visual chapter visual plotfil _chapstructur directori overview directori descript cmake cmake modul file doc sourc code build document exec directori build gnu make sourc sourc file subproject directori git submodul cmake role cppcode languag c _sundial compil nyx sundial follow step describ compil nyx sundial support librari necessari nonadiabat heatingcool nyx run use_heatcooltru nyxexeclya directori order use sundial suggest use github mirror httpsgithubcomllnlsundi pick type parallel appropri architectur instal cuda openmp support binbash set e git clone httpsgithubcomllnlsundi cd sundial mkdir builddir instdir install_prefixpwdinstdir cd builddir cmake dcmake_install_prefixinstall_prefix dcmake_install_libdirlib dcmake_verbose_makefileboolon dcmake_c_compilerwhich gcc dcmake_cxx_compilerwhich g dcmake_cuda_host_compilerwhich g dexamples_install_pathinstall_prefixexampl dcmake_build_typereleas dcmake_cuda_flagsdsundials_debug_cuda_lasterror dsundials_build_package_fused_kernelson dcmake_c_flags_releaseo dndebug dcmake_cxx_flags_releaseo dndebug dcuda_enableon dmpi_enableoff dopenmp_enableon df_interface_enableoff dsundials_index_sizeint dcuda_archsm_ make j make instal j instal openmp cuda support binbash set e git clone httpsgithubcomllnlsundi cd sundial mkdir builddir instdir install_prefixpwdinstdir cd builddir cmake dcmake_install_prefixinstall_prefix dcmake_install_libdirlib dcmake_verbose_makefileboolon dcmake_c_compilerwhich gcc dcmake_cxx_compilerwhich g dcmake_cuda_host_compilerwhich g dexamples_install_pathinstall_prefixexampl dcmake_build_typereleas dcmake_c_flags_releaseo dndebug dcmake_cxx_flags_releaseo dndebug dcuda_enableoff dmpi_enableoff dopenmp_enableon df_interface_enableoff dsundials_index_sizeint make j make instal j instal hip support rocm binbash set e git clone httpsgithubcomllnlsundi cd sundial mkdir builddir instdir cd builddir cmake dcmake_install_prefixpwdinstdir dcmake_install_libdirlib dcmake_verbose_makefileboolon dcmake_c_compilerwhich clang dcmake_cxx_compilerwhich hipcc dexamples_install_pathpwdinstdirexampl dcmake_build_typereleas dcmake_c_flags_releaseo dcmake_cxx_flags_releaseo dcuda_enableoff dmpi_enableoff dopenmp_enableoff df_interface_enableoff denable_hipon dexamples_installoff make j make instal j instal sycl support binbash set e git clone httpsgithubcomllnlsundi cd sundial mkdir builddir instdir cd builddir cmake dcmake_install_prefixpwdinstdir dcmake_install_libdirlib dcmake_verbose_makefileboolon dcmake_cxx_compilerwhich dpcpp dcmake_cxx_standard dexamples_install_pathpwdinstdirexampl dcmake_build_typereleas dcmake_cxx_flags_releaseo dcuda_enableoff dmpi_enableoff dopenmp_enableoff df_interface_enableoff denable_syclon make j make instal j note give exampl gnu compil appropri parallel compil compil chosen need consist nyx gnumakefil variabl comp ensur match omp runtim librari use openmp nvector cuda_arch must set appropri valu gpu target detail instruct instal sundial differ flag version see sundial document httpscomputingllnlgovprojectssundialssundialssoftware_ gnumakefil applic use interfac sundial add use_sundi true sundials_rootinstall_prefix note one must defin sundials_lib_dir make variabl point locat librari instal instal install_prefixlib note default locat install_prefixlib overrid dcmake_install_libdirlib applic use sundial cvode time integr packag variabl use_cvode_lib true also ad gnumakefil applic applic use sundial arkod time integr packag variabl use_arkode_lib true ad note sundial also instal via spack spack instal sundialscudaopenmp build nyx gnu make nyx built top amrex framework must download amrex order build nyx gnu make raw latex vspacein clonefork amrex repositori git clone httpsgithubcomamrexcodesamrex want period updat amrex type git pull amrex directori note check amrex nyx get develop branch activ develop done branch monthli tag made version compat monthli tag amrex set environ variabl amrex_hom point local copi amrex repositori add bashrc export amrex_homepathtoamrex cshrc setenv amrex_hom pathtoamrex pathtoamrex full path amrex directori clonefork nyx repositori git clone httpsgithubcomamrexastronyx amrex develop nyx done develop branch work want latest sourc choos execut compil exampl minisb lya minisb small version santa barbara problem lya lymanmathalpha forest simul investig largescal structur format univers execut name lya amrdens amrzoom lya_neutrino nyx use complic model heatingcool requir also instal match sundial instal support ode solv instal standalon copi sundial see refcompil nyx sundial sundial directori check nyx chang directori build directori type small santabarbara problem cd nyxexecminisb lymanmathalpha problem cd nyxexeclya build directori edit gnumakefil set comp favorit compil eg gnu intel debug fals like comp gnu inform amrex gnu make setup found httpsamrexcodesgithubioamrexdocs_htmlbuildingamrexhtml_ execut work mpicuda set use_mpitru use_ompfals use_cudatru hip dpc build develop test compil use_hiptru use_dpcpptru respect note execut use_heatcooltru gnumakefil match sundial implement requir sundial built dsundials_build_package_fused_kernelson nyx built use_fusedtru flag use_fus tell nyx compil whether compil sundial fuse cuda kernel default assumpt noncuda nyx compil set use_fusedfals match sundial built without fuse cuda kernel start sundial version set use_sundials_sunmemorytru compil option sundial sunmemori amrex arena interfac gpu memori reus type make result execut look someth like nyxdlinuxgnuex mean version code made linux machin comp gnu note build use_mpi true gnumakefil name code someth like nyxdlinuxgnumpiex