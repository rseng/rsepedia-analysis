mpijax joss paper pypi version conda version test codecov document statu mpijax enabl zerocopi multihost commun jax httpsjaxreadthedocsio_ array even jit code gpu memori jax framework great perform scientif comput workload httpsgithubcomdionhaefnerpyhpcbenchmarks_ multihost capabl httpsjaxreadthedocsioenlatestjaxhtmljaxpmap_ still limit mpijax scale jaxbas simul entir cpu gpu cluster without ever leav jaxjit spirit differenti program mpijax also support differenti mpi oper instal mpijax avail pip conda code bash pip instal mpijax pip conda instal c condaforg mpijax conda use pip dont jax instal alreadi also need code bash pip instal jaxlib equival gpuenabl version see jax instal instruct httpsgithubcomgooglejaxinstallation_ case mpi instal detect correctli help instal mpipi separ httpsmpipyreadthedocsioenstableinstallhtml_ use preinstal mpipi must use nobuildisol instal mpijax code bash mpipi alreadi instal pip instal cython pip instal mpijax nobuildisol document includ advanc instal exampl httpsmpijaxreadthedocsioenlatestinstallationhtml_ exampl usag code python mpipi import mpi import jax import jaxnumpi jnp import mpijax comm mpicomm_world rank commget_rank jaxjit def fooarr arr arr rank arr_sum _ mpijaxallreducearr opmpisum commcomm return arr_sum jnpzero result fooa rank printresult run script process give code bash mpirun n python examplepi allreduc one exampl mpi primit use see support oper httpsmpijaxreadthedocsorgenlatestapihtml_ commun guidelin question featur request want report bug feel free open issu httpsgithubcommpijaxmpijaxissues_ welcom contribut kind pull request httpsgithubcommpijaxmpijaxpulls_ inform run test debug contribut guidelin pleas refer correspond document page httpsmpijaxreadthedocsorgenlatestdevelopershtml_ cite use mpijax work pleas consid cite follow articl articlempijax doi joss url httpsdoiorgjoss year publish open journal volum number page author dion h√§fner filippo vicentini titl mpijax zerocopi mpi commun jax array journal journal open sourc softwar test imag httpsgithubcommpijaxmpijaxworkflowstestsbadgesvg target httpsgithubcommpijaxmpijaxactionsquerybranchamast codecov imag httpscodecovioghmpijaxmpijaxbranchmastergraphbadgesvg target httpscodecovioghmpijaxmpijax pypi version imag httpsimgshieldsiopypivmpijax target httpspypiorgprojectmpijax conda version imag httpsimgshieldsiocondavncondaforgempijaxsvg target httpsanacondaorgcondaforgempijax document statu imag httpsreadthedocsorgprojectsmpijaxbadgeversionlatest target httpsmpijaxreadthedocsioenlatestbadgelatest joss paper imag httpsjosstheojorgpapersjossstatussvg target httpsdoiorgjoss demo applic shallowwat model show mpijax capabl includ full implement physic nonlinear shallowwat model httpsgithubcomdionhaefnershallowwater_ shallowwat model simul evolut sea surfac temperatur salin water vari depth nonlinear implement even capabl model turbul possibl solut look like raw html video width stylemargin em auto display block control sourc src_staticshallowwatermp typevideomp browser support video tag video demo script long includ downloaddownload examplesshallow_waterpi docse sourc shallowwatersourc run demo apart mpijax need addit requir run demo code bash pip instal matploblib tqdm run like code bash mpirun n python shallow_waterpi warningabslno gputpu found fall back cpu set tf_cpp_min_log_level rerun info warningabslno gputpu found fall back cpu set tf_cpp_min_log_level rerun info warningabslno gputpu found fall back cpu set tf_cpp_min_log_level rerun info warningabslno gputpu found fall back cpu set tf_cpp_min_log_level rerun info smodel day solut took execut demo process show result matplotlib anim benchmark use shallow water solver observ perform behav increas number mpi process switch gpu show benchmark result machin x intel xeon e v cpu x nvidia tesla p gpu note amort constant comput cost use jax mpi use x bigger domain follow benchmark array shape code bash cpu jax_platform_namecpu mpirun n python examplesshallow_waterpi benchmark smodel day solut took jax_platform_namecpu mpirun n python examplesshallow_waterpi benchmark smodel day solut took jax_platform_namecpu mpirun n python examplesshallow_waterpi benchmark smodel day solut took jax_platform_namecpu mpirun n python examplesshallow_waterpi benchmark smodel day solut took jax_platform_namecpu mpirun n python examplesshallow_waterpi benchmark smodel day solut took jax_platform_namecpu mpirun n python examplesshallow_waterpi benchmark smodel day solut took gpu jax_platform_namegpu mpirun n python examplesshallow_waterpi benchmark smodel day solut took jax_platform_namegpu mpijax_use_cuda_mpi mpirun n python examplesshallow_waterpi benchmark smodel day solut took jax_platform_namegpu mpijax_use_cuda_mpi mpirun n python examplesshallow_waterpi benchmark smodel day solut took use pure numpi model take minut execut process goe show effici jax kind workload develop guid develop instal instal mpijax edit mode along option depend test run code bash pip instal e dev repositori root run test use pytest test instal develop depend run test suit follow command code bash pytest mpirun np pytest warn execut pytest run test process mean larg part mpijax test reli commun differ process therefor alway make sure test also pass multipl process via mpirun contribut welcom code contribut chang document via pull request httpsgithubcommpijaxmpijaxpulls_ pr use precommit hook enforc common code format instal run code bash precommit instal repositori root chang valid automat commit note introduc new code pleas make sure cover test catch problem earli recommend run test suit local creat pr debug set environ variabl mpijax_debug enabl debug log everi time mpi primit call within jit function see messag like code bash mpijax_debug mpirun n python send_recvpi r mpi_send tag token fdabcfc r mpi_recv tag token fafac use debug deadlock mpi error usag exampl basic exampl global sum follow comput sum array sever process similar funcjaxlaxpsum use funcmpijaxallreduc code python mpipi import mpi import jax import jaxnumpi jnp import mpijax comm mpicomm_world rank commget_rank jaxjit def fooarr arr arr rank arr_sum _ mpijaxallreducearr opmpisum commcomm return arr_sum jnpzero result fooa rank printresult mpi librari suppli wrapper execut mpirun execut script sever process code bash mpirun n python mpijaxexamplepi result array full valu process add rank result process rank basic exampl send receiv mpijax cours also send receiv data without perform oper use funcmpijaxsend funcmpijaxrecv _example_ code python mpipi import mpi import jax import jaxnumpi jnp import mpijax comm mpicomm_world size commget_s rank commget_rank assert size make sure process jaxjit def fooarr arr arr rank note could also use mpijaxsendrecv rank send receiv token mpijaxsendarr dest commcomm other_arr token mpijaxrecvarr sourc commcomm tokentoken els receiv send other_arr token mpijaxrecvarr sourc commcomm token mpijaxsendarr dest commcomm tokentoken return other_arr jnpzero result fooa printfrrank result execut show process receiv data process code bash mpirun n python mpijaxexamplepi r r oper like correct order funcmpijaxsend funcmpijaxrecv call critic prevent program deadlock eg process wait data time mpijax enforc order execut token refth exampl code example_ see behavior eg follow line code python token mpijaxsendarr dest commcomm other_arr token mpijaxrecvarr sourc commcomm tokentoken first call funcmpijaxsend return token pass funcmpijaxrecv funcmpijaxrecv also return new token could pass subsequ commun primit natur jax use token enforc order option use correct token manag experi deadlock crash seealso inform token see reftoken instal basic instal start instal suitabl version jax jaxlib httpsgithubcomgooglejaxinstallation_ dont plan use mpijax gpu follow code bash pip instal jax jaxlib note much function need recent ad jax chang frequent therefor mpijax somewhat strict requir support version jax jaxlib prepar upgrad recommend use pip instal mpijax distribut also avail via conda work mpi mpipi mpijax instal conda code bash pip instal mpijax conda instal c condaforg mpijax instal via pip requir work instal mpi succeed dont alreadi mpi want get start quickli possibl tri conda bundl mpi librari rememb mix pip conda httpswwwanacondacomblogusingpipinacondaenvironment_ warn advis use conda instal hpc environ possibl chang mpi librari mpipi link familiar mpi principl abl get start right away howev recommend look docsharpbit make sure awar pitfal mpijax select mpi distribut mpijax use mpi distribut mpipi built mpipi instal instal automat instal mpijax warn mpipi alreadi instal must use nobuildisol instal mpijax code bash mpipi alreadi instal pip instal cython pip instal mpijax nobuildisol check mpi librari librari link run follow command prompt code bash python c import mpipi printmpipyget_config wish use specif mpi librari possibl use pip usual suffici specifi mpicc environ variabl instal mpipi seealso doubt pleas refer mpipi document httpsmpipyreadthedocsioenstableinstallhtml_ instal gpu support note use jax gpu make sure jaxlib built cuda support httpsgithubcomgooglejaxinstallation_ mpijax also support jax array store gpu memori build mpijax gpu extens need abl locat cuda header system detect automat set environ variabl envvarcuda_root instal mpijax cuda_rootusrlocalcuda pip instal mpijax suffici situat howev mpijax copi data gpu cpu back invok mpi bottleneck applic build mpi cuda support commun directli gpu memori requir rebuild entir stack mpi librari eg openmpi httpswwwopenmpiorgfaqcategorybuildcuda_ cuda support mpipi link cudaen mpi instal mpijax use correct mpipi instal seealso read refher gpuusag use zerocopi gpu commun instal includ readmerst toctre maxdepth caption content instal usag shallowwat sharpbit api develop indic tabl refgenindex refmodindex refsearch sharp bit read ahead pitfal counterintuit behavior sharp edg introduc order make work _token token manag compil behind jax xla awar fact mpi function call funcmpijaxsend funcmpijaxrecv must perform specif order jargon sideeffect therefor free reorder call reorder mpi call usual lead deadlock eg process end receiv send instead sendrec receivesend token jax way ensur xla reorder statement side effect inject fake data depend mean use proper token manag prevent reorder occur everi commun primit mpijax return token last return object pass subsequ primit within jit block like code python mpijaxsendarr commcomm new_arr _ mpijaxrecvarr commcomm instead token mpijaxsendarr commcomm new_arr token mpijaxrecvarr commcomm tokentoken function execut order sequenc token first last inplac oper jax jax array immut mean function modifi input argument therefor unlik mpipi oper like funcmpijaxrecv use first argument determin correct shape dtype output popul data mean code python recv_arr jnpzero mpijaxrecvrecv_arr commcomm recv_arr still contain instead need use return array funcmpijaxrecv code python instead recv_arr jnpzero recv_arr _ mpijaxrecvrecv_arr commcomm _gpuusag use cuda mpi mpijax abl commun data directli gpu memori docthi requir mpi jax mpijax built cuda support instal current detect whether mpi built cuda support therefor default mpijax read directli gpu memori instead copi cpu back certain underli mpi librari built cuda support set follow environ variabl code bash export mpijax_use_cuda_mpi data copi directli gpu gpu mpi librari cuda support receiv segment fault tri access gpu memori use mpijax mpipi warn use mpijax mpipi commun consid follow exampl one process send python data via mpipi jax data via mpijax process receiv code python import numpi np import jaxnumpi jnp mpipi import mpi import mpijax comm mpicomm_world rank commget_rank arr_np nprandomrand arr_jax jnpzero rank mpijaxsendarr_jax commcomm commsendarr_np els arr_jax mpijaxrecvarr_jax commcomm arr commrecvarr_np everyth lazili execut jax reli particular execut order specif dont know whether function mpijaxsend will execut commsend call worst case creat deadlock simplest solut therefor stick either mpipi mpijax use make sure use differ commun code python instead import numpi np import jaxnumpi jnp mpipi import mpi import mpijax comm mpicomm_world rank commget_rank creat new commun mpijax comm_jax commclon arr_np nprandomrand arr_jax jnpzero rank mpijaxsendarr_jax commcomm_jax commsendarr_np els arr_jax mpijaxrecvarr_jax commcomm_jax arr commrecvarr_np comm_jaxfre orphan fileexamplesshallow_waterpi literalinclud examplesshallow_waterpi languag python lineno downloaddownload sourc shallow_waterpi examplesshallow_waterpi util has_cuda_support autofunct mpijaxhas_cuda_support commun primit allgath autofunct mpijaxallgath allreduc autofunct mpijaxallreduc alltoal autofunct mpijaxalltoal barrier autofunct mpijaxbarri bcast autofunct mpijaxbcast gather autofunct mpijaxgath recv autofunct mpijaxrecv reduc autofunct mpijaxreduc scan autofunct mpijaxscan scatter autofunct mpijaxscatt send autofunct mpijaxsend sendrecv autofunct mpijaxsendrecv