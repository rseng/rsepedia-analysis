<a href="https://bokeh.org">
  <img src="https://static.bokeh.org/logos/logotype.svg" height="60" alt="Bokeh logotype" />
</a>

----

[Bokeh](https://bokeh.org) is an interactive visualization library for modern web browsers. It provides elegant, concise construction of versatile graphics, and affords high-performance interactivity over large or streaming datasets. Bokeh can help anyone who would like to quickly and easily make interactive plots, dashboards, and data applications.

<table>
<tr>
  <td>Latest Release</td>
  <td>
    <div>
    <img src="https://badge.fury.io/py/bokeh.svg" alt="pypi version" />
    </div>
    <div>
    <img src="https://badge.fury.io/js/%40bokeh%2Fbokehjs.svg" alt="npm version">
    </div>
    </a>
  </td>

  <td>Downloads</td>
  <td>
    <div>
    <a href="https://docs.bokeh.org/en/latest/docs/installation.html">
    <img src="https://pyviz.org/_static/cache/bokeh_conda_downloads_badge.svg"
         alt="Conda downloads per month" />
    </a>
    </div>
    <div>
    <a href="https://docs.bokeh.org/en/latest/docs/installation.html">
    <img src="https://img.shields.io/pypi/dm/bokeh?label=PyPI&style=flat"
         alt="PyPI downloads per month" />
    </a>
    </div>
  </td>
</tr>

<tr>
  <td>License</td>
  <td>
    <a href="https://github.com/bokeh/bokeh/blob/master/LICENSE.txt">
    <img src="https://img.shields.io/github/license/bokeh/bokeh.svg"
         alt="Bokeh license (BSD 3-clause)" />
    </a>
  </td>

  <td>People</td>
  <td>
    <img src="https://img.shields.io/github/contributors-anon/bokeh/bokeh"
         alt="GitHub contributors" />
  </td>
</tr>

<tr>
  <td>Sponsorship</td>
  <td>
    <a href="http://numfocus.org">
    <img src="https://img.shields.io/badge/powered%20by-NumFOCUS-black.svg?style=flat&colorA=5B5B5B&colorB=007D8A"
         alt="Powered by NumFOCUS" />
    </a>
  </td>

  <td>Live Tutorial</td>
  <td>
    <a href="https://mybinder.org/v2/gh/bokeh/bokeh-notebooks/master?filepath=tutorial%2F00%20-%20Introduction%20and%20Setup.ipynb">
    <img src="https://mybinder.org/badge_logo.svg"
         alt="Live Bokeh tutorial notebooks on MyBinder" />
    </a>
  </td>
</tr>

<tr>
  <td>Build Status</td>
  <td>
    <div>
    <a href="https://github.com/bokeh/bokeh/actions">
    <img src="https://github.com/bokeh/bokeh/workflows/Bokeh-CI/badge.svg?branch=master"
         alt="Current github actions build status" />
    </a>
    </div>
    <div>
    <a href="https://github.com/bokeh/bokeh/actions">
    <img src="https://github.com/bokeh/bokeh/workflows/BokehJS-CI/badge.svg?branch=master"
         alt="Current github actions build status" />
    </a>
    </div>
  </td>
  <td>Static Analysis</td>
  <td>
    <div>
      <a href="https://lgtm.com/projects/g/bokeh/bokeh/context:python">
      <img alt="Language grade: Python" src="https://img.shields.io/lgtm/grade/python/g/bokeh/bokeh.svg?"/>
      </a>
    </div>
    <div>
      <a href="https://lgtm.com/projects/g/bokeh/bokeh/context:javascript">
      <img alt="Language grade: JavaScript" src="https://img.shields.io/lgtm/grade/javascript/g/bokeh/bokeh.svg"/>
      </a>
    </div>
  </td>

</tr>

<tr>
    <td>Support</td>
  <td>
    <a href="https://discourse.bokeh.org">
    <img src="https://img.shields.io/discourse/https/discourse.bokeh.org/posts.svg"
         alt="Community Support on discourse.bokeh.org" />
    </a>
  </td>


  <td>Twitter</td>
  <td>
    <a href="https://twitter.com/bokeh">
    <img src="https://img.shields.io/twitter/follow/bokeh.svg?style=social&label=Follow"
         alt="Follow Bokeh on Twitter" />
    </a>

  </td>
</tr>

</table>

*If you like Bokeh and would like to support our mission, please consider [making a donation](https://numfocus.org/donate-to-bokeh).*

<p>
<table>
<tr>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/image.html">
  <img alt="colormapped image plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/image_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/anscombe.html">
  <img alt="anscombe plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/anscombe_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/stocks.html">
  <img alt="stocks plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/stocks_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/lorenz.html">
  <img alt="lorenz attractor plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/lorenz_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/candlestick.html">
  <img alt="candlestick plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/candlestick_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/color_scatter.html">
  <img alt="scatter plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/scatter_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/iris_splom.html">
  <img alt="SPLOM plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/splom_t.png" />
  </a>
  </td>

</tr>
<tr>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/iris.html">
  <img alt="iris dataset plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/iris_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/histogram.html">
  <img alt="histogram plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/histogram_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/periodic.html">
  <img alt="periodic table plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/periodic_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/texas.html">
  <img alt="choropleth plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/choropleth_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/burtin.html">
  <img alt="burtin antibiotic data plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/burtin_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/streamline.html">
  <img alt="streamline plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/streamline_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/image_rgba.html">
  <img alt="RGBA image plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/image_rgba_t.png" />
  </a>
  </td>

</tr>
<tr>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/brewer.html">
  <img alt="stacked bars plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/stacked_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/quiver.html">
  <img alt="quiver plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/quiver_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/elements.html">
  <img alt="elements data plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/elements_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/boxplot.html">
  <img alt="boxplot thumbnail" src="https://docs.bokeh.org/en/latest/_images/boxplot_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/categorical.html">
  <img alt="categorical plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/categorical_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/unemployment.html">
  <img alt="unemployment data plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/unemployment_t.png" />
  </a>
  </td>

  <td>
  <a href="https://docs.bokeh.org/en/latest/docs/gallery/les_mis.html">
  <img alt="Les Mis co-occurrence plot thumbnail" src="https://docs.bokeh.org/en/latest/_images/les_mis_t.png" />
  </a>
  </td>

</tr>
</table>
</p>

## Installation

The easiest way to install Bokeh is using the [Anaconda Python distribution](https://www.anaconda.com/what-is-anaconda/) and its included *Conda* package management system. To install Bokeh and its required dependencies, enter the following command at a Bash or Windows command prompt:

```
conda install bokeh
```

To install using pip, enter the following command at a Bash or Windows command prompt:
```
pip install bokeh
```

For more information, refer to the [installation documentation](https://docs.bokeh.org/en/latest/docs/first_steps/installation.html).

## Resources

Once Bokeh is installed, check out the [first steps guides](https://docs.bokeh.org/en/latest/docs/first_steps.html#first-steps-guides).

Visit the [full documentation site](https://docs.bokeh.org) to view the [User's Guide](https://docs.bokeh.org/en/dev/docs/user_guide.html) or [launch the Bokeh tutorial](https://mybinder.org/v2/gh/bokeh/bokeh-notebooks/master?filepath=tutorial%2F00%20-%20Introduction%20and%20Setup.ipynb) to learn about Bokeh in live Jupyter Notebooks.

Community support is available on the [Project Discourse](https://discourse.bokeh.org).

If you would like to contribute to Bokeh, please review the [Contributor Guide](https://docs.bokeh.org/en/latest/docs/dev_guide.html) and [request an invitation to the Bokeh Dev Slack workspace](https://slack-invite.bokeh.org/).

*Note: Everyone interacting in the Bokeh project's codebases, issue trackers and discussion forums is expected to follow the [Code of Conduct](https://github.com/bokeh/bokeh/blob/master/CODE_OF_CONDUCT.md).*

## Follow us

Follow us on Twitter [@bokeh](https://twitter.com/bokeh)

## Support

### Fiscal Support

The Bokeh project is grateful for [individual contributions](https://numfocus.org/donate-to-bokeh) sponsorship as well as support by the organizations and companies below:

<table align="center">
<tr>
  <td>
    <a href="https://www.numfocus.org/">
    <img src="https://static.bokeh.org/sponsor/numfocus.svg"
         alt="NumFocus Logo" width="200"/>
    </a>
  </td>
  <td>
    <a href="https://chanzuckerberg.com/">
    <img src="https://static.bokeh.org/sponsor/czi.svg"
         alt="CZI Logo" width="200"/>
    </a>
  </td>
  <td>
    <a href="https://www.quansight.com">
    <img src="https://static.bokeh.org/sponsor/quansight.png"
         alt="Quansight Logo" width="200"/>
    </a>
  </td>
 </tr>
<tr>
  <td colspan="2">
    <a href="https://www.blackstone.com/the-firm/">
    <img src="https://static.bokeh.org/sponsor/blackstone.png"
         alt="Blackstone Logo" width="400"/>
    </a>
  </td>
  <td>
    <a href="https://tidelift.com/">
    <img src="https://static.bokeh.org/sponsor/tidelift.svg"
         alt="TideLift Logo" width="200"/>
    </a>
  </td>
 </tr>
 <tr>
  <td>
    <a href="https://www.anaconda.com/">
    <img src="https://static.bokeh.org/sponsor/anaconda.png"
         alt="Anaconda Logo" width="200"/>
    </a>
  </td>
  <td>
    <a href="https://www.nvidia.com">
    <img src="https://static.bokeh.org/sponsor/nvidia.png"
         alt="NVidia Logo" width="200"/>
    </a>
  </td>
  <td>
    <a href="https://developer.nvidia.com/rapids">
    <img src="https://static.bokeh.org/sponsor/rapids.png"
         alt="Rapids Logo" width="200"/>
    </a>
  </td>
</tr>
</table>

If your company uses Bokeh and is able to sponsor the project, please contact <a href="info@bokeh.org">info@bokeh.org</a>

*Bokeh is a Sponsored Project of NumFOCUS, a 501(c)(3) nonprofit charity in the United States. NumFOCUS provides Bokeh with fiscal, legal, and administrative support to help ensure the health and sustainability of the project. Visit [numfocus.org](https://numfocus.org) for more information.*

*Donations to Bokeh are managed by NumFOCUS. For donors in the United States, your gift is tax-deductible to the extent provided by law. As with any donation, you should consult with your tax adviser about your particular tax situation.*

### In-kind Support

The Bokeh project is also grateful for the donation of services from the following companies:

* [Amazon Web Services](https://aws.amazon.com/)
* [GitGuardian](https://gitguardian.com/)
* [GitHub](https://github.com/)
* [Pingdom](https://www.pingdom.com/website-monitoring)
* [Slack](https://slack.com)
* [QuestionScout](https://www.questionscout.com/)
* [1Password](https://1password.com/)
# Security Policy

## Supported Versions

| Version | Supported          |
| ------- | ------------------ |
| 3.x     | :white_check_mark: |
| 2.4.x   | :white_check_mark: |
| < 2.4   | :x:                |

## Reporting a Vulnerability

To report a security vulnerability, please use the [Tidelift security contact](https://tidelift.com/security).
Tidelift will coordinate the fix and disclosure.
# Contributor Code of Conduct

## The Abridged Version

The Bokeh community has been fantastic since the project's start. A one-line summary
of this CoC is simply a reflection of the community values already evident in practice:

> Please be always kind and courteous. There's never a need to be mean or rude or disrespectful.

If you wish to bring something to the attention of the project team, please contact
[conduct@bokeh.org](mailto:conduct@bokeh.org)

## The Longer Version

However, for the sake of decreasing any ambiguity, the details of this CoC are laid out explicitly
here.

### Our Pledge

We pledge to take responsibility for our own actions. If someone has been harmed
or offended, we will listen carefully and respectfully, and work to right the
wrong. In the interest of fostering an open and welcoming environment, we as
contributors and maintainers pledge to making participation in our project and
our community a harassment-free experience for everyone, regardless of age, body
size, disability, ethnicity, gender identity and expression, level of experience,
nationality, personal appearance, race, religion, or sexual identity and
orientation.

### Our Standards

Examples of behavior that contributes to creating a positive environment
include:

* Using welcoming and inclusive language
* Being respectful of differing viewpoints and experiences
* Gracefully accepting constructive criticism
* Focusing on what is best for the community
* Showing empathy towards other community members

All of these serve to help the make the project better, but also serve to make
the experience of participating in the project better as well.

Examples of unacceptable behavior by participants include:

* Sexist, racist, and other exclusionary language.
* The use of sexualized language or imagery and unwelcome sexual attention or
  advances
* Trolling, insulting/derogatory comments, and personal or political attacks
* Public or private harassment or intimidation
* Publishing others' private information, such as a physical or electronic
  address, without explicit permission
* Other conduct which could reasonably be considered inappropriate in a
  professional setting

### Our Responsibilities

Project maintainers are responsible for clarifying the standards of acceptable
behavior and are expected to take appropriate and fair corrective action in
response to any instances of unacceptable behavior. Maintainers will seek input
from all parties following any reports in order to make final determinations,
and will encourage relevant individuals to right any harms committed to the
extent possible.

Project maintainers have the right and responsibility to remove, edit, or
reject comments, commits, code, wiki edits, issues, and other contributions
that are not aligned to this Code of Conduct, or to ban temporarily or
permanently any contributor for other behaviors that they deem inappropriate,
threatening, offensive, or otherwise harmful.

### Scope

This Code of Conduct applies both within project work spaces and in public spaces
when an individual is representing the project or its community. Examples of
representing a project or community include using an official project e-mail
address, posting via an official social media account, or acting as an appointed
representative at an online or offline event. Representation of a project may be
further defined and clarified by project maintainers.

### Enforcement

Instances of abusive, harassing, or otherwise unacceptable behavior may be
reported by contacting the project team at [conduct@bokeh.org](mailto:conduct@bokeh.org). All
reports will be reviewed by the [Conduct Sub-committee](https://github.com/bokeh/bokeh/wiki/BEP-4:-Project-Roles#conduct-sub-committee) and investigated and any appropriate measures
will be taken. The project team commits to maintaining confidentiality
with regard to the reporter of an incident. Further details of specific
enforcement policies may be posted separately.

Project maintainers who do not follow or enforce the Code of Conduct in good
faith will face temporary or permanent repercussions as determined by other
members of the project's leadership.

### Escalation

In the event it is necessary to make a report involving someone on the NumFocus committee itself, please use the general [NumFocus CoC reporting form](https://numfocus.org/code-of-conduct).

### Attribution

This Code of Conduct is adapted from the [Contributor Covenant][homepage], version 1.4,
available at [http://contributor-covenant.org/version/1/4][version]

[homepage]: http://contributor-covenant.org
[version]: http://contributor-covenant.org/version/1/4/

### Revisions

|Date| Change|
|------|---------------------------|
|2019-03-01 | Updated reporting email to conduct@bokeh.org |
|2020-05-03 | Link to conduct subcommittee and NF CoC form for escalation|
|2020-05-04 | Typos and minor word edits |
# Contributing to Bokeh

See the [Bokeh contributor guide](https://docs.bokeh.org/en/latest/docs/dev_guide.html)
for information about the various ways you can contribute to Bokeh:
https://docs.bokeh.org/en/latest/docs/dev_guide.html
All pull requests must have an associated issue in the issue tracker. If there
isn't one, please go open an issue describing the defect, deficiency or desired
feature. You can read more about our issue and PR processes in the
[wiki](https://github.com/bokeh/bokeh/wiki/BEP-1:-Issues-and-PRs-management).

- [ ] issues: fixes #xxxx
- [ ] tests added / passed
- [ ] release document entry (if new feature or API change)
---
name: Task (Dev Team only)
about: Tasks - for Dev Team members only
title: ""
labels: TRIAGE
assignees: ""

---

### Development Team members only

This template is for use only by [Development Team members (@bokeh/dev)](https://github.com/bokeh/bokeh/wiki/BEP-4:-Project-Roles#development-team) to quickly add issues for tasks (Dev Team members are still encouraged to use the regular issue templates, if possible).

If you want to report a bug or request a feature, please [go back](https://github.com/bokeh/bokeh/issues/new/choose) and click on "Bug report" or "Feature request".
# Bokeh Examples

## Examples in this repository

This directory contains many examples of different ways to use Bokeh. As Bokeh has been evolving
fast, it is important that you **ensure that the version of an example you're looking at matches
the version of Bokeh you are running**.

### [`app`](app/)

This directory contains examples of Bokeh Apps, which are simple and easy to create web applications for data visualization or exploration.

### [`custom`](custom/)

The content of this directory demonstrate how to add custom extensions to Bokeh. Check project's documentation [page](https://docs.bokeh.org/en/latest/docs/user_guide/extensions.html)

### [`embed`](embed/)

This directory includes examples that show how to embed Bokeh plots and widget in HTML documents.

### [`howto`](howto/)

The examples in this directory are mini-tutorials that demonstrate and explain
some  particular aspect of Bokeh capability (such as [linking and
brushing](http://www.infovis-wiki.net/index.php?title=Linking_and_Brushing)),
or walk through a particular example in additional detail.


### [`models`](models/)

This directory contains examples that use the lowest-level
[`bokeh.models`](https://docs.bokeh.org/en/latest/docs/reference/models.html)
interface. For more information about Bokeh models see [the concepts section of
the user_guide](https://docs.bokeh.org/en/latest/docs/user_guide/concepts.html)

### [`plotting`](plotting/)

This directory contains example using the
[`bokeh.plotting`](https://docs.bokeh.org/en/latest/docs/user_guide/plotting.html)
interface. There are three subdirectories illustrating output in three
different modes:

* `file` examples that output to static HTML files

* `notebook` examples that display inline in [Jupyter](http://jupyter.org) notebooks

* `server` examples that send output to a Bokeh server, using the python client library for the server

### [`webgl`](webgl/)

This directory contains examples that demonstrate the various glyphs that have
support for WebGL rendering. Most of these examples have a testing purpose, e.g.
to compare the appearance of the WebGL glyph with its regular appearance, or to
test another aspect of WebGL (e.g. blending of transparent glyphs).


## Other sources for examples

* There are many examples in the [Bokeh Gallery](https://docs.bokeh.org/en/latest/docs/gallery.html) on main documentation site https://docs.bokeh.org.

* The [Bokeh User's Guide](https://docs.bokeh.org/en/latest/docs/user_guide.html) has many plots with corresponding code samples throughout.

* Many examples of Bokeh being used with the [Jupyter](http://jupyter.org) notebook, including a set or tutorial notebooks, are collected in the [`bokeh-notebooks`](https://github.com/bokeh/bokeh-notebooks) repository. Live versions of these notebooks [can be run online on MyBinder](https://mybinder.org/v2/gh/bokeh/bokeh-notebooks/master?filepath=tutorial%2F00%20-%20Introduction%20and%20Setup.ipynb). These notebooks are also available statically rendered on the [Bokeh NBViewer page](http://nbviewer.jupyter.org/github/bokeh/bokeh-notebooks/blob/master/index.ipynb).
# Custom Extension Examples

The examples in the this directory all demonstrate how to add custom extensions
to Bokeh. There are some additional examples in other directories:

* app/surface3d

More detailed documentation on creating custom extensions can be found here:

https://docs.bokeh.org/en/latest/docs/user_guide/extensions.html
This example uses a custom extension, which requires compilation before
the example can be run. Issue ``bokeh build .`` to build the extension.
This directory contains examples that demonstrate how to embed Bokeh plots and widgets as
DOM elements of larger documents. Typically, this is accomplished using the [`bokeh.embed`](https://docs.bokeh.org/en/latest/docs/user_guide/embed.html) interface.
This example demonstrates usage of ``server_session`` to customize a Bokeh
app session before embedding in a web page. To run, first execute the this
command to start the Bokeh server:

    bokeh serve --port 5100 --allow-websocket-origin localhost:8080 --allow-websocket-origin 127.0.0.1:8080 bokeh_app.py

Then, in another execute the following command to start the Flask app:

    python serve.py

Now, navigate your browser to localhost:8080
To run this demo start the Bokeh server application:

    bokeh serve bokeh_server.py --allow-websocket-origin=127.0.0.1:5000

And then in a seprate window execute:

    python flask_server.py

Then navigate to http://127.0.0.1:5000
# Bokeh Plotting Examples

The example in this directory all use the [`bokeh.plotting`](https://docs.bokeh.org/en/latest/docs/user_guide/plotting.html)
interface. This interface is primarily centered around creating a reasonable default plot with
appropriate axes and tools, to which you can add different visual glyphs whose properties are
associated with your data. A simple, but typical complete example of this API looks like:

    from bokeh.plotting import figure, output_file, show

    p = figure()
    p.circle([1, 2, 3], [4, 5, 6], color="orange")

    output_file("foo.html")

    show(p)

The [`file`](/file)  subdirectory contains examples that output to static HTML files
# Bokeh Models Examples

This directory contains examples that use the lowest-level
[`bokeh.models`](https://docs.bokeh.org/en/latest/docs/user_guide/concepts.html#bokeh-models)
interface. This interface mirrors the models found in the BokehJS browser
library, and provides complete control over every aspect of constructing a
Bokeh document, at the expense of increased verbosity.

Most users will probably want to start off with the higher level
[`bokeh.plotting`](https://docs.bokeh.org/en/latest/docs/user_guide/plotting.html)
interface,and only selectively use the
[`bokeh.models`](https://docs.bokeh.org/en/latest/docs/user_guide/concepts.html#bokeh-models)
interface whenever a particular need arises.

#### Examples that use the server

Any examples in this directory whose filenames contain `_animate` or `_server` make use of the Bokeh
server, and you must first start the Bokeh server to view them. To start the server, execute:

    bokeh serve

in a separate command window or terminal.
The examples in this directory show off various kinds of interactions that are easily
possible using Bokeh, including:

* linked panning/zooming
* linked selection brushing
* hover tooltips
* controlling range bounds
* updating date from an AJAX data source
* using JS callbacks for range updates, widgets, etc.

as well as show more detailed walkthroughs of some specific examples.
# Bokeh Authentication Hooks

This example demonstrates the use of authentication hooks with the Bokeh server.
To run, execute the following command:

    bokeh serve --enable-xsrf-cookies --auth-module=auth.py  app.py
### `flask_embed.py`

Run with `python flask_embed.py` and open http://localhost:8000/ in a web browser.

### `flask_gunicorn_embed.py`

Run with `gunicorn -w 4 flask_gunicorn_embed:app`

A UNIX environment is required to run this script.

### `notebook_embed.ipynb`

requires [Jupyter Notebook](https://jupyter.org/).

### `standalone_embed.py`

Run with `python standalone_embed.py`.

On Windows, the `num_procs=4` argument must be removed from the Server initialisation call on line 34.

### `tornado_embed.py`

Run with `python tornado_embed.py`.

On Windows, the `num_procs=4` argument must be removed from the Server initialisation call on line 47.
Install django, panel and channels (pip only) and run:

```sh
./manage.py runserver 0.0.0.0:8000
```

then navigate to <http://127.0.0.1:8000/shape_viewer>, <http://127.0.0.1:8000/sea_surface>, or <http://127.0.0.1:8000/sea_surface_with_template>.
The examples in this directory illustrate the use of some tools that can assist in the
development of bokeh plots.  Currently this includes:

* a tool for constructing the directed graph of submodels of a bokeh model
and drawing that graph to illuminate the model structure. Run

```
$ python structure_graph.py
```

The [jupyter notebook](./ModelStructureExample.ipynb) illustrates this and gives a look
into some of the private methods that provide the information that builds the structure graph.
Examples in this directory show off bokeh's capability to integrate with Jupyer widgets
outside of JupyerLab or classical Notebook environments. All examples are bokeh server
examples, so you run them with `bokeh server app_name`, and then you have to navigate
to `http://localhost:5006/app_name`:

* `ipyvolume_camera.py` -- shows how to integrate a thridparty widget and manipulate it
with Bokeh's and IPyWidgets' controls.

* `ipyleaflet_tiles.py` -- IPyLeaflet and Bokeh's tile renderer side-by-side.
# Bokeh Applications

The examples in this directory all make use of the Bokeh server, to create data visualization web apps from simple
python scripts.

To run any of these examples, execute `bokeh serve --show` and the name of the script or directory that contains the
demo. For example,

    bokeh serve --show sliders.py

will run the "sliders" demo, and open it up in a new browser tab.

The demos container here are:

<table>

  <tr><td colspan="2">clustering</td></tr>
  <tr>
    <td><a href="https://github.com/bokeh/bokeh/tree/master/examples/app/clustering"><img src="https://docs.bokeh.org/static/clustering_t.png" width=400></img></a></td>
    <td>Demonstrates different <a href=http://scikit-learn.org/stable>scikit-learn</a> clustering algorithms on a few different data sets.</td>
  </tr>

  <tr><td colspan="2">crossfilter</td></tr>
  <tr>
    <td><a href="https://github.com/bokeh/bokeh/tree/master/examples/app/crossfilter"><img src="https://docs.bokeh.org/static/crossfilter_t.png" width=400></img></a></td>
    <td>Explore the "autompg" data set by selecting and highlighting different dimensions</td>
  </tr>

  <tr><td colspan="2">dash</td></tr>
  <tr>
    <td><a href="https://github.com/bokeh/bokeh/tree/master/examples/app/dash"><img src="https://docs.bokeh.org/static/dash_t.png" width=400></img></a></td>
    <td>Demonstrates use of custom Boostrap template with a Bokeh application</td>
  </tr>

  <tr><td colspan="2">export_csv</td></tr>
  <tr>
    <td><a href="https://github.com/bokeh/bokeh/tree/master/examples/app/export_csv"><img src="https://docs.bokeh.org/static/export_csv_t.png" width=400></img></a></td>
    <td>Query a data table and save the results to a CSV file</td>
  </tr>

  <tr><td colspan="2">fourier_animated</td></tr>
  <tr>
    <td><a href="https://github.com/bokeh/bokeh/tree/master/examples/app/fourier_animated.py"><img src="https://docs.bokeh.org/static/fourier_animated_t.png" width=400></img></a></td>
    <td>A continuously updating demonstration of Fourier synthesis using periodic callbacks</td>
  </tr>

  <tr><td colspan="2">gapminder</td></tr>
  <tr>
    <td><a href="https://github.com/bokeh/bokeh/tree/master/examples/app/gapminder"><img src="https://docs.bokeh.org/static/gapminder_t.png" width=400></img></a></td>
    <td>A reproduction of the famous Gapminder demo, with embedded video added using a custom page template</td>
  </tr>

  <tr><td colspan="2">movies</td></tr>
  <tr>
    <td><a href="https://github.com/bokeh/bokeh/tree/master/examples/app/movies"><img src="https://docs.bokeh.org/static/movies_t.png" width=400></img></a></td>
    <td>An interactive query tool for a set of IMDB data</td>
  </tr>

  <tr><td colspan="2">ohlc</td></tr>
  <tr>
    <td><a href="https://github.com/bokeh/bokeh/tree/master/examples/app/ohlc"><img src="https://docs.bokeh.org/static/ohlc_t.png" width=400></img></a></td>
    <td>A simulated streaming <a href=https://en.wikipedia.org/wiki/Open-high-low-close_chart>OHLC chart</a> with <a href=https://en.wikipedia.org/wiki/MACD>MACD indicator</a> and selectable moving averages using periodic callbacks and the efficient streaming API</td>
  </tr>

  <tr><td colspan="2">selection_histogram</td></tr>
  <tr>
    <td><a href="https://github.com/bokeh/bokeh/tree/master/examples/app/selection_histogram.py"><img src="https://docs.bokeh.org/static/selection_histogram_t.png" width=400></img></a></td>
    <td>Shows axis histograms for selected <em>and</em> unselected points in a scatter plot</td>
  </tr>

  <tr><td colspan="2">sliders</td></tr>
  <tr>
    <td><a href="https://github.com/bokeh/bokeh/tree/master/examples/app/sliders.py"><img src="https://docs.bokeh.org/static/sliders_t.png" width=400></img></a></td>
    <td>A basic demo that has sliders for controlling a plotted trigonometric function</td>
  </tr>

  <tr><td colspan="2">spectrogram</td></tr>
  <tr>
    <td><a href="https://github.com/bokeh/bokeh/tree/master/examples/app/spectrogram"><img src="https://docs.bokeh.org/static/spectrogram_t.png" width=400></img></a></td>
    <td>A live audio spectrogram that connects NumPy to interactive web visualizations</td>
  </tr>

  <tr><td colspan="2">stocks</td></tr>
  <tr>
    <td><a href="https://github.com/bokeh/bokeh/tree/master/examples/app/stocks"><img src="https://docs.bokeh.org/static/stocks_t.png" width=400></img></a></td>
    <td>Linked plots, summary statistics, and correlations for market data </td>
  </tr>

  <tr><td colspan="2">surface3d</td></tr>
  <tr>
    <td><a href="https://github.com/bokeh/bokeh/tree/master/examples/app/surface3d"><img src="https://docs.bokeh.org/static/surface3d_t.png" width=400></img></a></td>
    <td> An updating 3d plot that demonstrates using Bokeh custom extensions to wrap third-party JavaScript libraries</td>
  </tr>

  <tr><td colspan="2">weather</td></tr>
  <tr>
    <td><a href="https://github.com/bokeh/bokeh/tree/master/examples/app/weather"><img src="https://docs.bokeh.org/static/weather_t.png" width=400></img></a></td>
    <td> A basic demo with dropdown menus and weather data for various cities</td>
  </tr>

</table>
# Clustering Example

Create a clustering visualization app with the Bokeh server and
[scikit-learn](http://scikit-learn.org/stable/).

<img src="https://static.bokeh.org/clustering.png" width="80%"></img>

## Setting Up

This demo requires the scikit-learn package in order to run. To install
scikit-learn using conda, execute the command:

    conda install scikit-learn

To install using pip, execute the command:

    pip install scikit-learn

## Running

To view the app directly from a Bokeh server, navigate to the parent directory
[`examples/app`](https://github.com/bokeh/bokeh/tree/master/examples/app),
and execute the command:

    bokeh serve --show clustering
# Gapminder Example

Create an example that reproduces the famous "Gapminder" data visualization from
[Hans Rosling's TED Talk](https://www.ted.com/talks/hans_rosling_the_best_stats_you_ve_ever_seen).

<img src="https://static.bokeh.org/gapminder.png" width="80%"></img>

## Setting Up

This demo requires Bokeh sample data sets to be installed. From the command
line, execute following command:

    bokeh sampledata

All the necessary data files will be downloaded to a subfolder in your home
directory.

## Running

To view the app directly from a Bokeh server, navigate to the parent directory
[`examples/app`](https://github.com/bokeh/bokeh/tree/master/examples/app),
and execute the command:

    bokeh serve --show gapminder
# Surface3d Extension Example

Create an example that demonstrate the usage of Bokeh custom extensions, by
wrapping a simple JavaScript library for 3d plotting, and connecting it to
Python data sources.

<img src="https://static.bokeh.org/surface3d.png" width="80%"></img>

## Setting Up

No additional packages or steps are required to run this example.

## Running

To view the app directly from a Bokeh server, navigate to the parent directory
[`examples/app`](https://github.com/bokeh/bokeh/tree/master/examples/app),
and execute the command:

    bokeh serve --show surface3d
# Weather Examples

Create an example shows the daily record, average, and actual temperatures for
three cities (Austin, Boston, Seattle) in 2015. The default view includes a
discrete graph of the temperatures, but a smoothed representation can also be
chosen.

<img src="https://static.bokeh.org/weather.png" width="80%"></img>

## Setting Up

This demo requires the Pandas and Scipy packages in order to run. To install using
conda, execute the command:

    conda install pandas
    conda install scipy

To install using pip, execute the command:

    pip install pandas
    pip install scipy

## Running

To view the app directly from a Bokeh server, navigate to the parent directory
[`examples/app`](https://github.com/bokeh/bokeh/tree/master/examples/app),
and execute the command:

    bokeh serve --show weather
# CSV Export Example

Create an example that shows how data in a Bokeh `ColumnDataSource` can be
exported to a CSV file that users can download.

<img src="https://static.bokeh.org/export_csv.png" width="80%"></img>

## Setting Up

This demo requires the [Pandas](https://pandas.pydata.org) package in order to
run. To install Pandas using conda, execute the command:

    conda install pandas

To install using pip, execute the command:

    pip install pandas

## Running

To view the app directly from a Bokeh server, navigate to the parent directory
[`examples/app`](https://github.com/bokeh/bokeh/tree/master/examples/app),
and execute the command:

    bokeh serve --show export_csv
# Stocks Example

Create a simple stocks correlation dashboard.

<img src="https://static.bokeh.org/stocks.png" width="80%"></img><

## Setting Up

To run the stocks example, you first need to download a sample data file.
Execute the following command in this directory:

    python download_sample_data.py

## Running

To view the app directly from a Bokeh server, navigate to the parent directory
[`examples/app`](https://github.com/bokeh/bokeh/tree/master/examples/app),
and execute the command:

    bokeh serve --show stocks
# Crossfilter Example

Create a Bokeh application that shows how different facets of data in a
[Pandas](https://pandas.pydata.org) DataFrame can be plotted against one
another.

<img src="https://static.bokeh.org/crossfilter.png" width="80%"></img>

## Setting Up

This demo requires the [Pandas](https://pandas.pydata.org) package in order to
run. To install Pandas using conda, execute the command:

    conda install pandas

To install using pip, execute the command:

    pip install pandas

## Running

To view the app directly from a Bokeh server, navigate to the parent directory
[`examples/app`](https://github.com/bokeh/bokeh/tree/master/examples/app),
and execute the command:

    bokeh serve --show crossfilter
# Face Detection Example

Create an example that uses [OpenCV](https://opencv.org) and efficient Bokeh
streaming to perform face detection on live video input.

<img src="https://static.bokeh.org/faces.png" width="80%"></img>

## Setting Up

This demo requires the [OpenCV](https://opencv.org) package in order to run. To
install OpenCV using conda, execute the command:

    conda install opencv

## Running

To view the app directly from a Bokeh server, navigate to the parent directory
[`examples/app`](https://github.com/bokeh/bokeh/tree/master/examples/app),
and execute the command:

    bokeh serve --show faces
# Movies Example

Create an interactive query and visualization dashboard for a set of movie data.

*Inspired by the [Shiny Movie Explorer](https://shiny.rstudio.com/gallery/movie-explorer.html).*

<img src="https://static.bokeh.org/movies.png" width="80%"></img>

## Setting Up

This demo requires Bokeh sample data sets to be installed. From the command
line, execute following command:

    bokeh sampledata

All the necessary data files will be downloaded to a subfolder in your home
directory.

Additionally, this demo requires the [Pandas](http://pandas.pydata.org/) library
in order to run. To install Pandas using conda, execute the command:

    conda install pandas

To install using pip, execute the command:

    pip install pandas

## Running

To view the app directly from a Bokeh server, navigate to the parent directory
[`examples/app`](https://github.com/bokeh/bokeh/tree/master/examples/app), and
execute the command:

    bokeh serve --show movies
# Simple HDF5 Example

Create an app that can query and visualize
[HDF5](https://www.hdfgroup.org/solutions/hdf5/)
data files.

<img src="https://static.bokeh.org/simple_hdf5.png" width="80%"></img>

## Setting up

Before running this example, a sample data file must be generated. From the
command line, execute the following command:

    python create_hdf5.py

This demo requires the [h5py](https://www.h5py.org) library. From the command
line, execute the following command:

    conda install h5py

To install using pip, execute the command:

    pip install h5py

## Running

To view the app directly from a Bokeh server, navigate to the parent directory
[`examples/app`](https://github.com/bokeh/bokeh/tree/master/examples/app),
and execute the command:

    bokeh serve --show simple_hdf5
# OHLC Example

Create a streaming, updating [OHLC chart](https://en.wikipedia.org/wiki/Open-high-low-close_chart)
with [MACD indicator](https://en.wikipedia.org/wiki/MACD) from simulated market data.

<img src="https://static.bokeh.org/ohlc.png" width="80%"></img>

## Setting Up

No additional packages or steps are required to run this example.

## Running

To view the app directly from a Bokeh server, navigate to the parent directory
[`examples/app`](https://github.com/bokeh/bokeh/tree/master/examples/app),
and execute the command:

    bokeh serve --show ohlc
# Spectrogram Example

Create an example that uses efficient Bokeh streaming to show an updating
waterfall spectrogram of live audio data.

<img src="https://static.bokeh.org/spectrogram.png" width="80%"></img>

## Setting Up

This demo requires the [SciPy](https://www.scipy.org) package in order to run.
To install SciPy using conda, execute the command:

    conda install scipy

To install using pip, execute the command:

    pip install scipy

Optionally, in order to use live audio data from a microphone, the pyaudio
package must also be installed. To install pyaudio using conda, execute the
command:

    conda install pyaudio

If pyaudio is not installed, this example will use simulated audio data.

## Running

To view the app directly from a Bokeh server, navigate to the parent directory
[`examples/app`](https://github.com/bokeh/bokeh/tree/master/examples/app),
and execute the command:

    bokeh serve --show spectrogram
# Dashboard Example

Create a simple dashboard based on Bootstrap templates.

<img src="https://static.bokeh.org/dash.png" width="80%">

## Setting Up

No additional packages or steps are required to run this example.

## Running

To view the app directly from a Bokeh server, navigate to the parent directory
[`examples/app`](https://github.com/bokeh/bokeh/tree/master/examples/app),
and execute the command

    bokeh serve --show dash

## Licences

This example uses vendored code from the following projects:

* https://fontawesome.com/license

* https://getbootstrap.com/docs/3.3/getting-started/

* https://github.com/puikinsh/gentelella/blob/master/LICENSE.txt
# Bokeh WebGL examples

This directory contains examples that demonstrate the various glyphs that have
support for WebGL rendering. Most of these examples have a testing purpose, e.g.
to compare the appearance of the WebGL glyph with its regular appearance, or to
test another aspect of WebGL (e.g. blending of transparent glyphs).


### Examples meant for testing

* line_compare.py - to compare regular and webgl lines (stipling, joins, caps)
* marker_compare.py - to compare regular and webgl markers
* line10k.py - uses the webgl line glyph to plot a relatively large dataset
* scatter10k.py - uses the webgl circle glyph and selections
* iris_blend.py - to test color names and blending of semi-transparent glyphs


### Other WebGL examples in this directory

* clustering.py - a clustering example based on scikit-learn that produces
  a large amount of points (calculation takes a while)
BokehJS is a subproject of Bokeh. Please consult the CHANGELOG at

    https://github.com/bokeh/bokeh/blob/master/CHANGELOG

for full information.
<img src="http://i.imgur.com/TMKcgIV.png" width="35" height="35"> BokehJS
=========================================================================

BokehJS is a front-end JavaScript library for [Bokeh](http://github.com/bokeh/bokeh).

The architecture of the library facilitates easy manipulation of the components
and configuration of a plot from server-side code in python or other languages.
However, BokehJS can also be used directly as a standalone JavaScript library,
with plot data embedded directly into the page, retrieved via AJAX calls, or
supplied by a separate Bokeh Plot server.

Building
--------

Please refer to the [BokehJS section](https://docs.bokeh.org/en/latest/docs/dev_guide/bokehjs.html)
of the [Bokeh Contributor Guide](https://docs.bokeh.org/en/latest/docs/dev_guide.html)
for information about building, testing and demoing BokehJS.

Contributing
------------

We always appreciate feedback and value contributions.  The core developers are
working hard towards applying Bokeh and BokehJS towards some specific projects,
so the development priorities will tend to center around those tasks, until the
project reaches a point of stability.

Please join the discussion on the [Bokeh project Discourse](https://discourse.bokeh.org).
Please consult https://docs.bokeh.org/en/latest/docs/dev_guide.html for more
information about contributing to BokehJS.
.. rubric:: Details

{% if sampledata %}:Sampledata: {{ sampledata }}{% endif %}
{% if apis %}:Bokeh APIs: {{ apis }}{% endif %}
{% if refs %}:More info: {{ refs }}{% endif %}
{% if keywords %}:Keywords: {{ keywords }}{% endif %}
.. data:: {{ name }}
    :module: {{ module }}
    :annotation: = {{ objrepr }}
    {% if noindex %}:noindex:{% endif %}

    {% if doc %}{{ doc|indent(4) }}{% endif %}

    .. collapsible-code-block:: jinja
        :heading: Template: {{ filename }}

        {{ template_text|indent(8) }}
.. data:: {{ name }}
    :module: {{ module }}
    :annotation: = {{ shortrepr }}
    {% if noindex %}:noindex:{% endif %}

    {% for line in content %}
    {{ line }}
    {% endfor %}

    {% if fullrepr %}

    .. collapsible-code-block:: python
        :heading: See all values

        {% for line in fullrepr %}
        {{ line|indent(8) }}
        {% endfor %}

    {% endif %}
{% for name in names %}
* |{{ name }}|
{% endfor %}

{% for name in names %}
.. |{{ name }}| image:: /_images/gallery/{{ name }}.png
    :target: gallery/{{ name }}.html
    :class: gallery
{% endfor %}
Keyword Args:

{% for opt in opts %}
    {{ opt['name'] }} ({{ opt['type'] }}) : {{ opt['doc']|indent(8) }} (default: {{ opt['default']}})

{% endfor %}
:orphan:

.. index::
   single: examples; {{ filename }}

{{ filename }}
{{ '-' * filename|length }}

.. bokeh-plot:: {{ source_path }}
    :process-docstring:
    :source-position: below
.. attribute:: {{ name }}
    :module: {{ module }}
    :annotation: = {{ default }}

    :Type: {{ type_info }}
    {% if doc %}

    {{ doc|indent(4) }}
    {% endif %}
{{ name }}
{{ "~" * name|length }}

.. autoclass::  {{ module_name }}.{{ name }}
    :members:
    :show-inheritance:
    :inherited-members:
    :exclude-members: js_event_callbacks, js_property_callbacks, subscribed_events

    .. _{{ name }}.json:

    .. collapsible-code-block:: javascript
        :heading: JSON Prototype

        {{ model_json|indent(8) }}

    .. autoclasstoc::
{% for setting in settings %}

``{{ setting['name'] }}``
{{ "''''" +  "'" * setting['name']|length }}

:**Type**: {{ setting['type'] }}
:**Env var**: ``{{ setting['env_var'] }}``
:**Default**: {{ setting['default'] }}
:**Dev Default**: {{ setting['dev_default'] }}

{{ setting['help'] }}

{% endfor %}
:notoc:

.. _about:

Bokeh documentation
===================

Bokeh is a Python library for creating interactive visualizations for modern
web browsers. It helps you build beautiful graphics, ranging from simple plots
to complex dashboards with streaming datasets. With Bokeh, you can create
JavaScript-powered visualizations without writing any JavaScript yourself.

.. raw:: html

    <form class="bd-search align-items-center" action="search.html" method="get">
      <input type="search" class="form-control search-front-page" name="q" id="search-input" placeholder="&#128269; Search the docs ..." aria-label="Search the docs ..." autocomplete="off">
    </form>

Finding the right documentation resources
-----------------------------------------

Bokeh's documentation consists of several components:

.. panels::
    :container: container-fluid pb-3
    :column: col-lg-4 col-md-4 col-sm-12 col-xs-12 p-2

    :header: bg-bokeh-one

    If you are new to Bokeh
    ^^^^^^^^^^^^^^^^^^^^^^^

    Follow these guides to get started:

    * :ref:`first_steps`: simple tutorials that walk you through installing Bokeh and creating your first visualizations.

    * :ref:`userguide`: explanations of all key functionalities of Bokeh and how to use them. Includes several standalone examples.

    ---
    :header: bg-bokeh-two
    If you have some basic knowledge of Bokeh
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    Learn more by exploring examples:

    * :ref:`gallery`: a collection of examples with source code.

    * `Interactive tutorial notebooks`_: a collection of interactive notebooks to experiment with all elements of Bokeh.

    * :ref:`userguide`: explanations of all key functionalities of Bokeh and how to use them, including examples.

    ---
    :header: bg-bokeh-three
    If you need more advanced information
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    Get to know every aspect of Bokeh:

    * :ref:`Reference guide <refguide>`: detailed information about all of Bokeh's components.

    * :ref:`Contributor guide <contributor_guide>`: information on the various ways you can contribute to the Bokeh project.

Connecting with the Bokeh community
-----------------------------------

There are various ways to get in touch with the `Bokeh community`_:

* The `Bokeh Discourse`_ is the best place to ask usage questions and is a
  great way to get feedback from other users on how to approach a problem.
* Questions involving pandas or other libraries may find a wider audience by
  posting with the `"bokeh" tag on Stack Overflow`_.
* If you think you've found a bug, or would like to request a feature, please
  report an issue at `Bokeh's GitHub repository`_.

You can also find more information about Bokeh on `Twitter`_, `Medium`_, and
`LinkedIn`_.


.. panels::
    :body: bokeh-examples
    :container: container-fluid pb-3 examples-container
    :column: col-lg-1 col-md-1 col-sm-2 col-xs-4 p-2

    .. image:: /_images/thumbs/image_t.png
       :target: docs/gallery/image.html
       :alt: Thumbnail for image example
    ---
    .. image:: /_images/thumbs/anscombe_t.png
       :target: docs/gallery/anscombe.html
       :alt: Thumbnail for Anscombe's quartet example
    ---
    .. image:: /_images/thumbs/stocks_t.png
       :target: docs/gallery/stocks.html
       :alt: Thumbnail for stocks example
    ---
    .. image:: /_images/thumbs/lorenz_t.png
       :target: docs/gallery/lorenz.html
       :alt: Thumbnail for Lorenz attractor example
    ---
    .. image:: /_images/thumbs/candlestick_t.png
       :target: docs/gallery/candlestick.html
       :alt: Thumbnail for candlestick example
    ---
    .. image:: /_images/thumbs/scatter_t.png
       :target: docs/gallery/color_scatter.html
       :alt: Thumbnail for color scatter example
    ---
    .. image:: /_images/thumbs/les_mis_t.png
       :target: docs/gallery/les_mis.html
       :alt: Thumbnail for Les Mis occurrences example
    ---
    .. image:: /_images/thumbs/histogram_t.png
       :target: docs/gallery/histogram.html
       :alt: Thumbnail for histogram example
    ---
    .. image:: /_images/thumbs/iris_t.png
       :target: docs/gallery/iris.html
       :alt: Thumbnail for iris morphology example
    ---
    .. image:: /_images/thumbs/choropleth_t.png
       :target: docs/gallery/texas.html
       :alt: Thumbnail for choropleth example
    ---
    .. image:: /_images/thumbs/splom_t.png
       :target: docs/gallery/iris_splom.html
       :alt: Thumbnail for iris example
    ---
    .. image:: /_images/thumbs/burtin_t.png
       :target: docs/gallery/burtin.html
       :alt: Thumbnail for Burtin example


.. toctree::
    :maxdepth: 3
    :hidden:

    docs/first_steps
    docs/user_guide
    docs/gallery
    docs/reference
    docs/dev_guide
    docs/releases

.. _Interactive tutorial notebooks: https://mybinder.org/v2/gh/bokeh/bokeh-notebooks/master?filepath=tutorial%2F00%20-%20Introduction%20and%20Setup.ipynb
.. _Bokeh community: https://bokeh.org/community/
.. _Bokeh Discourse: https://discourse.bokeh.org
.. _`"bokeh" tag on Stack Overflow`: https://stackoverflow.com/questions/tagged/bokeh
.. _`Bokeh's GitHub repository`: https://github.com/bokeh/bokeh
.. _Twitter: https://twitter.com/bokeh
.. _Medium: https://medium.com/bokeh
.. _LinkedIn: https://www.linkedin.com/company/project-bokeh/
.. _refguide:

Reference
#########

.. toctree::
    :maxdepth: 2
    :hidden:
    :glob:

    reference/bokeh
    reference/*

This section provides the complete public API reference for Bokeh,
auto-generated from the docstrings in the project source code.

The full list of sections for all the modules in Bokeh is accessible from
the sidebar to the left. Listed below are a few selected sections that may
be especially useful.

:ref:`bokeh.models`
    Everything that comprises a Bokeh plot or application---tools, controls,
    glyphs, data sources---is a :ref:`Bokeh Model <bokeh.model>`. Bokeh
    models are configured by setting values their various properties.
    This large section has a reference for every Bokeh model, including
    information about every property of each model.

:ref:`bokeh.plotting`
    The |bokeh.plotting| API is centered around the |figure| command and the
    associated glyph functions such as
    :func:`~bokeh.plotting.figure.circle`,
    :func:`~bokeh.plotting.figure.wedge`, etc.
    This section has detailed information on these elements.

:ref:`bokeh.layouts`
    The simplest way to combine multiple Bokeh plots and controls in a
    single document is to use the layout functions such as
    :func:`~bokeh.layouts.row`, :func:`~bokeh.layouts.column`, etc.
    from the ``bokeh.layouts`` module.

:ref:`bokeh.io`
    Functions for controlling where and how Bokeh documents are saved
    or shown, such as |output_file| and |output_notebook|, are in this module.

:ref:`bokeh.palettes`
    This section provides visual representations of all the palettes
    built into Bokeh.

:ref:`bokeh.settings`
    All Bokeh-related environment variables, which can be used to control
    things like resources, minification, and log levels, are documented here.
.. _userguide:

User guide
##########

.. toctree::
    :maxdepth: 2
    :hidden:

    user_guide/concepts
    user_guide/plotting
    user_guide/data
    user_guide/layout
    user_guide/categorical
    user_guide/graph
    user_guide/geo
    user_guide/tools
    user_guide/styling
    user_guide/annotations
    user_guide/interaction
    user_guide/server
    user_guide/jupyter
    user_guide/export
    user_guide/embed
    user_guide/cli
    user_guide/extensions
    user_guide/webgl
    user_guide/compat
    user_guide/bokehjs

In this user guide, you will find detailed descriptions and examples that
describe many common tasks that you can accomplish with Bokeh. To get started
with Bokeh, you should first completed the steps described in
:ref:`first_steps_installing`.

.. tip::
    See the :ref:`first_steps_overview` for quick tutorials that walk you
    through Bokeh's basic functionalities and concepts. This is the easiest
    and quickest way to get going with Bokeh.

This user guide is arranged by topic:

:ref:`userguide_concepts`
    Learn important foundational concepts about how Bokeh is organized.

:ref:`userguide_plotting`
    Make different kinds of plots using the simple but flexible glyph
    methods from the |bokeh.plotting| interface.

:ref:`userguide_data`
    Provide data or subsets of data for plots and tables and share data
    between plots.

:ref:`userguide_layout`
    Combine multiple plots and widgets into specified layouts.

:ref:`userguide_categorical`
    Handle categorical data with a variety of different techniques such
    as bar charts, categorical heatmaps, visual dodging, and jitter.

:ref:`userguide_graph`
    Create network graph visualizations with configurable node and edge interactions.

:ref:`userguide_geo`
    Working with geographical data---Google Maps, GeoJSON, Tile Rendering.

:ref:`userguide_tools`
    Make interactive tools (like pan, zoom, select, and others) available
    on your plots.

:ref:`userguide_styling`
    Customize every visual aspect of Bokeh plots---axes, grids, labels,
    glyphs, and more.

:ref:`userguide_annotations`
    Add informational annotations, such as labels, arrows, and legends to
    plots.

:ref:`userguide_interaction`
    Create more sophisticated interactions including widgets or linked
    panning and selection.

:ref:`userguide_server`
    Deploy the Bokeh Server to build and publish sophisticated data
    applications.

:ref:`userguide_jupyter`
    Integrate with the Jupyter ecosystem.

:ref:`userguide_export`
    Learn how to export Bokeh layouts as PNGs and SVGs.

:ref:`userguide_embed`
    Embed static or server-based Bokeh plots and widgets into HTML documents
    in a variety of ways.

:ref:`userguide_cli`
    Use Bokeh's capabilities from the command line with the ``bokeh``
    command.

:ref:`userguide_extensions`
    Add new capability to Bokeh with custom user extensions.

:ref:`userguide_webgl`
    Improve performance for large datasets by using WebGL.

:ref:`userguide_compat`
    Use Bokeh together with libraries such as `Datashader`_ and  `HoloViews`_.

:ref:`userguide_bokehjs`
    Create plots in JavaScript by using BokehJS directly.

The user guide contains a lot of examples. They are as minimal as possible and
usually focus on highlighting one functionality or concept each. You can copy
and paste those examples into your own development environment. With only a
handful of exceptions, you will need no external libraries to run the examples.

.. _Datashader: http://datashader.readthedocs.io
.. _HoloViews: http://holoviews.org
.. _gallery:

Gallery
#######

See the sections below for examples of using Bokeh in different ways.

.. contents::
    :local:
    :depth: 1

.. _gallery_server_examples:

Server App Examples
===================

The examples linked below all show off usage of the Bokeh server. The
Bokeh server provides a place where interesting things can happen---data
can be updated to in turn update the plot, and UI and selection events
can be processed to trigger more visual updates.

.. raw:: html

    <div class="container">
      <div class="row">

        <div class="col-lg-3 col-md-6 col-sm-6">
          <a target="_blank" href="//demo.bokeh.org/movies">
          <img src="https://static.bokeh.org/movies_t.png" class="img-responsive img-thumbnail">
          </a>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6">
          <p>An interactive query tool for a set of IMDB data</p>
          <p><em>Source code: </em><a target="_blank" href="https://github.com/bokeh/bokeh/blob/master/examples/app/movies">movies</a></p>
        </div>

        <div class="col-lg-3 col-md-6 col-sm-6">
          <a target="_blank" href="//demo.bokeh.org/selection_histogram">
            <img src="https://static.bokeh.org/selection_histogram_t.png" class="img-responsive img-thumbnail">
          </a>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6">
          <p>Shows axis histograms for selected <em>and</em> non-selected points in a scatter plot</p>
          <p><em>Source code: </em><a target="_blank" href="https://github.com/bokeh/bokeh/blob/master/examples/app/selection_histogram.py">selection_histogram</a></p>
        </div>


        <div class="col-lg-3 col-md-6 col-sm-6">
          <a target="_blank" href="//demo.bokeh.org/weather">
            <img src="https://static.bokeh.org/weather_t.png" class="img-responsive img-thumbnail">
          </a>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6">
          <p>Interactive weather statistics for three cities</p>
          <p><em>Source code: </em><a target="_blank" href="https://github.com/bokeh/bokeh/tree/master/examples/app/weather">weather</a></p>
        </div>

        <div class="col-lg-3 col-md-6 col-sm-6">
          <a target="_blank" href="//demo.bokeh.org/sliders">
            <img src="https://static.bokeh.org/sliders_t.png" class="img-responsive img-thumbnail"></img>
          </a>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6">
          <p>A basic demo that has sliders for controlling a plotted trigonometric function</p>
          <p><em>Source code: </em><a target="_blank" href="https://github.com/bokeh/bokeh/blob/master/examples/app/sliders.py">sliders.py</a></p>
        </div>

        <div class="col-lg-3 col-md-6 col-sm-6">
          <a target="_blank" href="//demo.bokeh.org/crossfilter">
            <img src="https://static.bokeh.org/crossfilter_t.png" class="img-responsive img-thumbnail">
          </a>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6">
          <p>Explore the "autompg" data set by selecting and highlighting different dimensions</p>
          <p><em>Source code: </em><a target="_blank" href="https://github.com/bokeh/bokeh/blob/master/examples/app/crossfilter">crossfilter</a></p>
        </div>

        <div class="col-lg-3 col-md-6 col-sm-6">
          <a target="_blank" href="//demo.bokeh.org/gapminder">
            <img src="https://static.bokeh.org/gapminder_t.png" class="img-responsive img-thumbnail"></img>
          </a>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6">
          <p>A reproduction of the famous Gapminder demo, with embedded video added using a custom page template</p>
          <p><em>Source code: </em><a target="_blank" href="https://github.com/bokeh/bokeh/blob/master/examples/app/gapminder">gapminder</a></p>
        </div>

        <div class="col-lg-3 col-md-6 col-sm-6">
          <a target="_blank" href="//demo.bokeh.org/stocks">
            <img src="https://static.bokeh.org/stocks_t.png" class="img-responsive img-thumbnail"></img>
          </a>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6">
          <p>Linked plots, summary statistics, and correlations for market data</p>
          <p><em>Source code: </em><a target="_blank" href="https://github.com/bokeh/bokeh/tree/master/examples/app/stocks">stocks</a></p>
        </div>

        <div class="col-lg-3 col-md-6 col-sm-6">
          <a target="_blank" href="//demo.bokeh.org/surface3d">
            <img src="https://static.bokeh.org/surface3d_t.png" class="img-responsive img-thumbnail"></img>
          </a>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6">
          <p>An updating 3d plot that demonstrates using Bokeh custom extensions to wrap third-party JavaScript libraries</p>
          <p><em>Source code: </em><a target="_blank" href="https://github.com/bokeh/bokeh/blob/master/examples/app/surface3d">surface3d</a></p>
        </div>

        <div class="col-lg-3 col-md-6 col-sm-6">
          <a target="_blank" href="//demo.bokeh.org/export_csv">
            <img src="https://static.bokeh.org/export_csv_t.png" class="img-responsive img-thumbnail">
          </a>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6">
          <p>Explore the "autompg" data set by selecting and highlighting different dimensions</p>
          <p><em>Source code: </em><a target="_blank" href="https://github.com/bokeh/bokeh/blob/master/examples/app/export_csv">export_csv</a></p>
        </div>

      <div>
    </div>

.. _gallery_notebook_examples:

Notebook Examples
=================

The best place to immediately experiment with Bokeh in notebooks is in the
`live tutorial notebooks`_ hosted online by MyBinder.


.. _gallery_static_examples:

Standalone Examples
===================

All of the examples below are located in the :bokeh-tree:`examples`
subdirectory of your Bokeh checkout. By "standalone" we mean that
these examples make no use of the Bokeh server. These plots still
have many interactive tools and features, including linked panning
and brushing, and hover inspectors.

Click on an image below to see its code and interact with the live
plot.

.. cssclass:: gallery clearfix

.. bokeh-gallery:: gallery.json

.. _live tutorial notebooks: https://mybinder.org/v2/gh/bokeh/bokeh-notebooks/master?filepath=tutorial%2F00%20-%20Introduction%20and%20Setup.ipynb
.. _releases:

.. currently, in order to limit the max toc depth to 1 in the right hand side
.. menu, there is a bit of JavaScript in the layout.html to remove the toc-h3
.. elements just on this page.

Releases
########

.. bokeh-releases::
.. _contributor_guide:

Contribute
##########

.. toctree::
    :maxdepth: 2
    :hidden:

    dev_guide/setup
    dev_guide/creating_issues
    dev_guide/pull_requests
    dev_guide/documentation
    dev_guide/testing
    dev_guide/writing_tests
    dev_guide/python
    dev_guide/bokehjs
    dev_guide/server

Bokeh is an open source project and only exists because of contributors like
you. Bokeh is made possible by a diverse group of software developers, testers,
writers, outreach experts, and much more. And we always love having new people
help us make Bokeh a better tool for everyone!

In this contributor guide, you will find all information you need to join the
growing team of Bokeh contributors. This includes information on how to
:ref:`contribute to Bokeh's code and documentation <contributor_guide_start>`,
:ref:`help out with community support <contributor_guide_community_support>`,
or :ref:`support Bokeh with a donation <contributor_guide_donate>`.

.. note::
    Everyone active in the Bokeh project's codebases, issue trackers, and
    discussion forums is expected to follow the `Code of Conduct`_.

.. _contributor_guide_start:

Where to start
--------------

To work with Bokeh's code and documentation, you first need to
:ref:`set up a development environment <contributor_guide_setup>`.

You can then contribute to Bokeh's codebase in many ways:

.. panels::
    :header: bg-bokeh-one

    Bokeh's Python codebase
    ^^^^^^^^^^^^^^^^^^^^^^^
    If you would like to help with Bokeh's Python code:

    * :ref:`contributor_guide_python`
    * :ref:`contributor_guide_testing`
    * :ref:`contributor_guide_writing_tests`
    * :ref:`contributor_guide_issues`
    * :ref:`contributor_guide_pull_requests`

    ---
    :header: bg-bokeh-two

    BokehJS (TypeScript)
    ^^^^^^^^^^^^^^^^^^^^
    If you would like to help with anything related to :term:`BokehJS`:

    * :ref:`contributor_guide_bokehjs`
    * :ref:`contributor_guide_testing`
    * :ref:`contributor_guide_writing_tests`
    * :ref:`contributor_guide_issues`
    * :ref:`contributor_guide_pull_requests`
    ---
    :header: bg-bokeh-three

    Bokeh Server
    ^^^^^^^^^^^^
    If you would like to help with the :term:`Server` component of Bokeh:

    * :ref:`contributor_guide_server`
    * :ref:`contributor_guide_testing`
    * :ref:`contributor_guide_writing_tests`
    * :ref:`contributor_guide_issues`
    * :ref:`contributor_guide_pull_requests`
    ---
    :header: bg-bokeh-four

    Bokeh documentation
    ^^^^^^^^^^^^^^^^^^^
    If you would like to help improving :ref:`Bokeh's documentation <about>`:

    * :ref:`contributor_guide_documentation`
    * :ref:`contributor_guide_issues`
    * :ref:`contributor_guide_pull_requests`


.. _contributor_guide_resources:

Additional resources
--------------------

In addition to this :ref:`contributor guide <contributor_guide_start>`, there
are many more resources available to help you get started quickly:

Bokeh Slack
    The Bokeh Slack is a workspace for all contributors and the best way to get
    a quick response from experienced contributors and maintainers. Please
    `request an invitation`_!

GitHub wiki and BEPs
    The `wiki on Bokeh's GitHub repository`_ contains the Bokeh
    Enhancement Proposals (BEPs). BEPs are the central governance and policy
    documents for Bokeh. This includes details about the contribution processes,
    especially in `BEP 1: Issues and PRs management`_ and
    `BEP 6: Branching Strategy`_.

GitHub Discussions
    The `discussion section of Bokeh's GitHub repository`_ is a
    place to    talk about details of implementations as well as proposed
    features and ideas for Bokeh.

Bokeh roadmap
    The `Bokeh roadmap`_ contains goals for Bokeh as a tool and as a
    community.

Github repository
    The source code for Bokeh, the bokeh.org website, and many other aspects of
    Bokeh are hosted on https://github.com/bokeh. A good way to get started is
    to look through open issues in our `issue tracker`_.

Bokeh's documentation
    For an overview of Bokeh's various documentation resources, see
    :ref:`docs.bokeh.org <about>`.

Bokeh's Discourse
    User support for Bokeh is provided by volunteers on the
    `Bokeh Discourse server`_. See
    `the community section of Bokeh's website`_ for more information on Bokeh's
    community resources.

.. _contributor_guide_more_ways:

More ways to contribute
------------------------

In addition to improving Bokeh's codebase and documentation, there are many
other ways to contribute to Bokeh:

.. _contributor_guide_donate:

Donate to Bokeh
^^^^^^^^^^^^^^^

Consider making a `donation to Bokeh`_. Your generous gift will help the project
pay for developer time, additional professional services, travel, workshops, and
other important needs.

*Bokeh is a Sponsored Project of NumFOCUS, a 501(c)(3) nonprofit charity in the
United States. NumFOCUS provides Bokeh with fiscal, legal, and administrative
support to help ensure the health and sustainability of the project. Visit*
https://numfocus.org/ *for more information.*

*Donations to Bokeh are managed by NumFOCUS. For donors in the United States,
your gift is tax-deductible to the extent provided by law. As with any donation,
you should consult with your tax adviser about your particular tax situation.*

If your company uses Bokeh and is able to sponsor the project financially or
through in-kind support, please get in touch with us at info@bokeh.org.

For more information on fiscal and in-kind donations, see the `Support`_ section
in Bokeh's `GitHub repository`_.

.. _contributor_guide_examples:

Add examples
^^^^^^^^^^^^

If you or your organization are using Bokeh and are willing to share some
examples of what you are working on, consider adding them to the
`Bokeh Showcase`_. You can also add new examples to
:ref:`Bokeh's gallery <gallery>` with a :ref:`pull request
<contributor_guide_pull_requests>` to the :bokeh-tree:`examples` folder.

.. _contributor_guide_community_support:

Help with community support
^^^^^^^^^^^^^^^^^^^^^^^^^^^

All user support for Bokeh is provided by volunteers. While support questions
are discussed in various places, such as `Stack Overflow`_, the central location
for all user support questions is the `Bokeh Discourse server`_. Feel free to
answer user questions that you can help with. All interactions on Bokeh's
Discourse must follow Bokeh's `Code of Conduct`_.

.. _contributor_guide_bindings:

Contribute to language bindings
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

:term:`BokehJS` accepts an object graph represented by declarative bits of JSON.
This means that any language that can generate JSON can also generate Bokeh
plots for display in a browser.

There are currently three known bindings that expose Bokeh to languages other
than Python:

* `rbokeh <bokeh_r_>`_ adds support for Bokeh to the R language. It
  was started by `@hafen <hafen_>`_.
* `bokeh.jl <bokeh_jl_>`_ brings Bokeh to Julia users. It was originally created
  by `@samuelcolvin <samuelcolvin_>`_.
* `bokeh-scala <bokeh_scala_>`_ exposes Bokeh in the Scala language. The
  project was created by the Bokeh core dev team member `@mattpap <mattpap_>`_.

The low-level object interface in Python mirrors the JSON schema exactly.
Therefore, the best, most authoritative source of information for anyone
writing bindings for Bokeh are the reference guide sections for the
:ref:`bokeh.core.properties` and |bokeh.models|.

Another resource for working on bindings is Bokeh's
:bokeh-tree:`scripts/spec.py` script. This Python script generates a JSON
description of every model and property in Bokeh,
including types, defaults, and
:ref:`help strings <contributor_guide_documentation_edit_properties_help>` for
each. You can use this information as a basis for creating new low-level
bindings or checking existing bindings for completeness, for example.

If you would like to start working on a new binding or have a new binding added
to this list, please contact the Bokeh core team through `Slack`_.

.. _contributor_guide_vulnerability:

Report a vulnerability
^^^^^^^^^^^^^^^^^^^^^^

To report a security vulnerability, please use the `Tidelift security contact`_.
Tidelift will coordinate the fix and disclosure.

.. _contributor_guide_spread_the_word:

Spread the word
^^^^^^^^^^^^^^^

Finally, as an open source project, Bokeh relies on word-of-mouth to reach new
users. If you enjoy using Bokeh or are already contributing to Bokeh, please
tell your friends and the people you work with about Bokeh.

Bokeh is also on `Twitter`_ and `LinkedIn`_. Please follow those accounts for
updates and news about Bokeh. And we always appreciate it if you tag Bokeh's
accounts when you talk about anything that you made with Bokeh!


.. _Code of Conduct: https://github.com/bokeh/bokeh/blob/master/CODE_OF_CONDUCT.md
.. _request an invitation: https://slack-invite.bokeh.org/
.. _wiki on Bokeh's GitHub repository: https://github.com/bokeh/bokeh/wiki
.. _Bokeh Enhancement Proposals: https://github.com/bokeh/bokeh/wiki
.. _`BEP 1: Issues and PRs management`: https://github.com/bokeh/bokeh/wiki/BEP-1:-Issues-and-PRs-management
.. _`BEP 6: Branching Strategy`: https://github.com/bokeh/bokeh/wiki/BEP-6:-Branching-Strategy
.. _discussion section of Bokeh's GitHub repository: https://github.com/bokeh/bokeh/discussions
.. _Bokeh roadmap: https://bokeh.org/roadmap/
.. _issue tracker: https://github.com/bokeh/bokeh/issues
.. _Slack: https://slack-invite.bokeh.org/
.. _donation to Bokeh: https://numfocus.org/donate-to-bokeh
.. _numfocus.org: https://numfocus.org/
.. _Support: https://github.com/bokeh/bokeh#support
.. _GitHub repository: https://github.com/bokeh/bokeh
.. _Bokeh Discourse server: https://discourse.bokeh.org/
.. _the community section of Bokeh's website: https://bokeh.org/community/
.. _Bokeh Showcase: https://discourse.bokeh.org/c/showcase/
.. _Bokeh's gallery: http://docs.bokeh.org/en/latest/docs/gallery.html
.. _Stack Overflow: https://stackoverflow.com/questions/tagged/bokeh
.. _bokeh_r: http://hafen.github.io/rbokeh/
.. _hafen: https://github.com/hafen
.. _bokeh_jl: https://github.com/bokeh/Bokeh.jl
.. _samuelcolvin: https://github.com/samuelcolvin
.. _bokeh_scala: https://github.com/bokeh/bokeh-scala
.. _mattpap: https://github.com/mattpap
.. _Tidelift security contact: https://tidelift.com/security
.. _Twitter: https://twitter.com/bokeh
.. _LinkedIn: https://www.linkedin.com/company/project-bokeh/
:orphan:
.. _first_steps:

First steps
###########

.. toctree::
    :maxdepth: 2
    :hidden:
    :glob:

    first_steps/installation
    first_steps/*

.. _first_steps_installing:

Installing Bokeh
----------------

Bokeh is officially supported and tested on Python 3.8 and above (CPython).

You can install Bokeh with either ``conda`` or ``pip``:

.. panels::
    :container: container-fluid pb-3
    :column: col-lg-6 col-md-6 col-sm-12 col-xs-12 p-2

    :header: bg-bokeh-one

    Installing with ``conda``
    ^^^^^^^^^^^^^^^^^^^^^^^^^

    Use this command to install Bokeh:

    .. code-block:: sh

        conda install bokeh

    Conda requires either `Anaconda`_ or `Miniconda`_ to be installed on your
    system.

    ---
    :header: bg-bokeh-two

    Installing with ``pip``
    ^^^^^^^^^^^^^^^^^^^^^^^

    Use this command to install Bokeh:

    .. code-block:: sh

        pip install bokeh

For more detailed information on installing and potential problems you might
encounter, go to the :ref:`installation` section.

.. _`first_steps_overview`:

First steps guides
------------------

Follow these guides to quickly learn about the most important features and
capabilities of Bokeh.

The first steps guides are for anybody who is new to Bokeh. The only
prerequisites for using these guides are a basic understanding of Python and a
working :ref:`installation<first_steps_installing>` of Bokeh.

The first steps guides include lots of examples that you can copy to your
development environment. There are also many links to the more in-depth
resources of the |user guide| and |reference guide| in case you want to learn
more about any of the topics covered in the first steps guides.

.. panels::
    :container: container-fluid pb-3
    :column: col-lg-4 col-md-6 col-sm-12 col-xs-12 p-2

    :header: bg-bokeh-one

    Creating a simple line chart plot
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    .. image:: /_images/first_steps_1.png
        :align: center
        :alt: A line chart

    +++

    .. link-button:: first_steps/first_steps_1
        :text: Go to section 1
        :type: ref
        :classes: btn-info btn-block stretched-link

    ---
    :header: bg-bokeh-two

    Adding and customizing renderers
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    .. image:: /_images/first_steps_2.png
        :align: center
        :alt: Several glyphs in one chart

    +++

    .. link-button:: first_steps/first_steps_2
        :text: Go to section 2
        :type: ref
        :classes: btn-info btn-block stretched-link

    ---
    :header: bg-bokeh-three

    Adding legends, text, and annotations
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    .. image:: /_images/first_steps_3.png
        :align: center
        :alt: A chart with a legend

    +++

    .. link-button:: first_steps/first_steps_3
        :text: Go to section 3
        :type: ref
        :classes: btn-info btn-block stretched-link

    ---
    :header: bg-bokeh-four

    Customizing your plot
    ^^^^^^^^^^^^^^^^^^^^^

    .. image:: /_images/first_steps_4.png
        :align: center
        :alt: A chart with a tootip

    +++

    .. link-button:: first_steps/first_steps_4
        :text: Go to section 4
        :type: ref
        :classes: btn-info btn-block stretched-link

    ---
    :header: bg-bokeh-five

    Vectorizing glyph properties
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    .. image:: /_images/first_steps_5.png
        :align: center
        :alt: A chart with different colors

    +++

    .. link-button:: first_steps/first_steps_5
        :text: Go to section 5
        :type: ref
        :classes: btn-info btn-block stretched-link
    ---
    :header: bg-bokeh-six

    Combining plots
    ^^^^^^^

    .. image:: /_images/first_steps_6.png
        :align: center
        :alt: Three charts combined into one element

    +++

    .. link-button:: first_steps/first_steps_6
        :text: Go to section 6
        :type: ref
        :classes: btn-info btn-block stretched-link

    ---
    :header: bg-bokeh-seven

    Displaying and exporting
    ^^^^^^^^^^^^^^^^^^^^^^^^

    .. image:: /_images/first_steps_7.png
        :align: center
        :alt: Screenshot of a Bokeh plot in a Jupyter notebook

    +++

    .. link-button:: first_steps/first_steps_7
        :text: Go to section 7
        :type: ref
        :classes: btn-info btn-block stretched-link
    ---
    :header: bg-bokeh-one

    Providing and filtering data
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    .. image:: /_images/first_steps_8.png
        :align: center
        :alt: Two charts with different subsets of data

    +++

    .. link-button:: first_steps/first_steps_8
        :text: Go to section 8
        :type: ref
        :classes: btn-info btn-block stretched-link

    ---
    :header: bg-bokeh-two

    Using widgets
    ^^^^^^^^^^^^^

    .. image:: /_images/first_steps_9.png
        :align: center
        :alt: Screenshot of a Bokeh server app

    +++

    .. link-button:: first_steps/first_steps_9
        :text: Go to section 9
        :type: ref
        :classes: btn-info btn-block stretched-link

.. _Anaconda: https://www.anaconda.com/products/individual#Downloads
.. _Miniconda: https://docs.conda.io/en/latest/miniconda.html
.. _release-0-7-1:

0.7.1
=====

Bokeh ``0.7.1`` (Jan 2015) focused on stability, bug fixes, improved
documentation and better examples.

* Several bokeh.charts bug fixes and enhancements, such as configurable tools
* Docs improvements, in particular, documenting json for bokeh.models
* Mpl compatibility improved, now returning the plot object
* A lot of encoding fixes, including fixes in some of our sample data
* Faster runs in TravisCI using the new docker-based containerized infrastructure
* New and improved examples, such as the Interactive Image Processing with Numba and Bokeh notebook
.. _release-0-12-2:

0.12.2
======

Bokeh version 0.12.2 (Sept 2016) is aminor update that adds a few "small in
footprint, but big in impact" features and several bug fixes including:

* Client-side color mapping support for all glyphs
* New color bar annotation
* Support for loading external resources in custom models
  - Check out the new LaTeX example at: `LaTeX`_
* Hit-testing support for MultiLine glyphs
* Improved hover tooltip default styling
* Addition of the Brewer qualitative color palettes
* Fix intermittent issues with BokehJS loading in Jupyter Notebooks
* Split of the Bokeh JS API into a stand-alone bundle
* Many small bug fixes

.. _release-0-12-2-migration:

`Migration Guide <releases.html#release-0-12-2-migration>`__
------------------------------------------------------------

Jupyter Notebook output changes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

As part of the changes to ensure that the BokehJS client library has loaded
before attempting to render plots in the notebook, a new ``notebook_handle``
argument was added to the ``bokeh.io.show`` method. When set to ``True`` (with
``output_notebook`` enabled), the ``show`` method will return a handle that
can be used with ``push_notebook``.

For users who rely on the notebook handles to update plots out of their render
order, you'll have to add ``notebook_handle=True`` to your ``show`` invocations
like below:

.. code-block:: python

    from bokeh.plotting import figure
    from bokeh.io import output_notebook, push_notebook, show
    output_notebook()
    plot = figure()
    plot.circle([1,2,3], [4,6,5])
    handle = show(plot, notebook_handle=True)
    # Update the plot title in the earlier cell
    plot.title = "New Title"
    push_notebook(handle=handle)

BokehJS API Changes
~~~~~~~~~~~~~~~~~~~

In order to shrink the size of the main BokehJS library and reduce pageload
times, the Bokeh JS API has been separated into it's own bokeh-api(.min).js
bundle. For users requiring the JS API, it will be necessary to add the new
resource to their HTML templates.

.. _LaTeX: https://docs.bokeh.org/en/latest/docs/user_guide/extensions.html#examples
.. _release-2-3-2:

2.3.2
=====

Bokeh Version ``2.3.2`` (May 2021) is a patch-release that fixes bugs that
affects downstream projects:

* SelectionGeometry event is slow compared to js equivalent(:bokeh-issue:`11169`)
* Forward slash is changed to %2F in link (:bokeh-issue:`11182`)
* Cannot clear active of RadiGroup (:bokeh-issue:`11203`)

As well as other very minor docs, build, and bugfix updates.

For full details see the :bokeh-tree:`CHANGELOG`.
.. _release-0-12-1:

0.12.1
======

Bokeh Version ``0.12.1`` (Jul 2016) is a minor, incremental update that adds
a few new small features and fixes several bugs. Some of the highlights include:

* Add ``.patch`` method to ``ColumnDataSource`` for efficient partial updates.
* Add ``.visible`` property to all glyphs for easy on/off capability.
* Add qualitative Brewer colormapps to ``bokeh.palettes``.
* Add new ``VBar`` and ``HBar`` glyph types.
* Update BokehJS to use use RBush 2.0.1 for more efficient spatial indexing.
* Restore ``ResizeTool`` functionality for simple layouts.
* Fix Windows support for conda build, docs build, and running unit tests.
* Fix a bug in the HTML template for ``autoload_server`` causing incorrect layouts.
* Fix a bug in the toolbar CSS, causing it to interfere with hit testing and selection.
* Fix WebGL support for Safari, and WebGL bug affecting line thickness.
* Fix intermittent issues with BokehJS loading in Jupyter notebooks.
.. _release-0-5-2:

0.5.2
=====

Bokeh ``0.5.2`` (Aug 2014) is an incremental update:

* New Layout system
* Improved automate testing infrastructure
* AR testing, server-side downsample fixes and ISO Contours
* New "dashboard-like" example: examples/app/applet/stock_example.py
.. _release-1-0-2:

1.0.2
=====

Bokeh Version ``1.0.2`` (November 2018) is a micro bugfix and feature release.

Some of the highlights include:

* Expose configurable ``DataTable`` row height (:bokeh-issue:`8411`)
* Fix issue with legends and empty scatter glyphs (:bokeh-issue:`8395`)

For full details see the :bokeh-tree:`CHANGELOG`.
.. _release-0-11-0:

0.11.0
======

Bokeh Version ``0.11.0`` (Jan 2016) is a large release with many new improvements

* New Tornado and websocket-based Bokeh Server

  - ``bokeh`` command line tool for creating applications
  - expanded docs including deployment guidance
  - video demonstrations and tutorials
  - supports async, periodic, timeout and model event callbacks
  - python client API

* User-Defined Models allowing anyone to extend Bokeh
* GeoJSON data source and map tiles renderer
* WebGL support for rendering lines
* Python -> JS compilation for CustomJS callbacks (Py3 only for now)
* New general push_notebook() based on Jupyter comms
* Updates to charts

  - all legacy charts converted
  - more examples and expanded docs

* UX improvements

  - configurable and "auto" range bounds
  - wheel zoom scroll capture turned off by default
  - hover policy for glyphs
  - responsive improvements

* Known issues

  - annulus glyph does not render correctly on IE and Edge

* many small bug fixes

.. _release-0-11-0-migration:

`Migration Guide <releases.html#release-0-11-0-migration>`__
------------------------------------------------------------

Known Issues
~~~~~~~~~~~~

Server output in the Jupyter notebook with output_server is currently not
functioning correctly, and will be fixed in a follow on 0.11.1 release
shortly. However, new notebook comms can enable many of the same kinds
of interactions and notebook-based apps without a Bokeh server.

The Image glyph does not currently work with the Bokeh server, and will be
fixed in a follow on 0.11.1 release shortly.

Deprecations
~~~~~~~~~~~~

The previous Flask-based ``bokeh-server`` has been completely removed and
replaced with the new ``bokeh serve`` based on Tornado and a websocket
protocol. If you require to use ``bokeh-server`` you will have to remain on
Bokeh version ``0.10.0`` or lower.

All "old-style" charts in ``bokeh._legacy_charts`` have been updated to use
the more consistent and powerful ``bokeh.charts`` interface, and
``bokeh._legacy_charts`` has been removed.

Bokeh deprecation warnings, which are not enabled by default python, have
now been unconditionally enabled and are always displayed.

``ColumnDataSource.push_notebook()`` has been deprecated (but still works)
in favor of the more general ``bokeh.io.push_notebook()`` base on Jupyter
notebook websocket comms.

The following modules have been deprecated (but still work), with
new counterparts as described in this table:

========================== ==============================
Old location               New location
========================== ==============================
``bokeh.browserlib``       ``bokeh.util.browser``
``bokeh.properties``       ``bokeh.core.properties``
``bokeh.mixins``           ``bokeh.core.property_mixins``
``bokeh.plotting_helpers`` ``bokeh.plotting.helpers``
``bokeh.templates``        ``bokeh.core.templates``
========================== ==============================

Additionally, the following modules that should not be of interest to
general users have been moved immediately, without deprecation:

========================== ==============================
Old location               New location
========================== ==============================
``bokeh._json_encoder``    ``bokeh.core.json_encoder``
``bokeh.compat``           ``bokeh.core.compat``
``bokeh.enums``            ``bokeh.core.enums``
``bokeh.query``            ``bokeh.core.query``
``bokeh.state``            ``bokeh.core.state``
``bokeh.validation``       ``bokeh.core.validation``
========================== ==============================

If you have been using ``file_html`` and manually passing in
``js_resources`` or ``css_resources``, your call will no longer
work. You can still do this, but you pass a tuple to the ``resources``
argument.

Before:

  ``html = file_html(layout, None, title=title, template=template, js_resources=js_resources, css_resources=css_resources)``

v0.11:

  ``html = file_html(layout, resources=(js_resources, css_resources), title=title, template=template)``

Note you can pass ``None`` in place of either ``js_resources`` or ``css_resources``.
.. _release-0-4-0:

0.4.0
=====

Bokeh ``0.4.4`` (Feb 2014) is an incremental release with several important
new pieces of work:

* Preliminary work on Matplotlib support: convert MPL figures to Bokeh plots
* Tool improvements:

  - "always on" pan tool and wheel zoom tool
  - box zoom tool
  - viewport reset tool

* Enhanced datetime axis, with better performance and nicer ticking
* Expanded testing, including TravisCI integrations and static image output using PhantomJS
* RGBA and color mapped image plots now available from Python
* Python 3 support!
* Vastly improved documentation for glyphs, with inline examples and JSFiddle integration
.. _release-0-12-4:

0.12.4
======

Bokeh Version ``0.12.4`` (Jan 2017) is an incremental update that adds a few
important features and fixes several bugs. Some of the highlights include:

* Efficient binary array protocol. (:bokeh-issue:`2204`)
* A general mechanism to add ``CustomJS`` callbacks to any property. (:bokeh-issue:`5498`)
* Several fixes to log plots. (:bokeh-issue:`2789`, :bokeh-issue:`3834`, :bokeh-issue:`5389`, :bokeh-issue:`5549`, :bokeh-issue:`5576`)
* Fixes related to custom extensions. (:bokeh-issue:`5315`, :bokeh-issue:`5590`)
* Guidance and examples for embedding a Bokeh server directly in standalone scripts, Jupyter notebooks, and Tornado and Flask applications.
* Support for read-only (client-side) properties, e.g. plot inner dimensions (:bokeh-issue:`5199`)
* Improved documentation for the :ref:`bokeh.palettes` module. (:bokeh-issue:`5619`)
* Major refactor of ``bokeh.core`` including expanded documentation and tests (:bokeh-issue:`5626`, :bokeh-issue:`5627`)

Many other small bugfixes and docs additions. For full details see the :bokeh-tree:`CHANGELOG`.

.. _release-0-12-4-migration:

`Migration Guide <releases.html#release-0-12-4-migration>`__
------------------------------------------------------------

As the project approaches a 1.0 release, it is necessary to make some changes
to bring interfaces and functionality up to a point that can be maintained
long-term. We try to limit such changes as much as possible, and have a
period of deprecation.

Broken Dialog Removed
~~~~~~~~~~~~~~~~~~~~~

The ``Dialog`` widget has been broken for some time. Due to lack of user
reports about it, and because custom extensions now provide a path for users
to integrate third party JS dialog libraries, this widget has been removed
immediately.

Custom Extension Import/Export
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

BokehJS is making a slow migration to TypeScript to support long-term stability
and maintainability.
This necessitates some short term changes for writing custom extensions.

JavaScript extension code with ``requires`` and ``module.exports``, such as:

.. code-block:: python

    Model = require "model"

    class DateGapTickFormatter extends TickFormatter
        # implementation here

    module.exports =
        Model: DateGapTickFormatter

should be re-written as:

.. code-block:: python

    import {Model} from "model"

    export class DateGapTickFormatter extends TickFormatter
        # implementation here

Legend Locations
~~~~~~~~~~~~~~~~

To improve consistency, the following locations names have changed:

================= =================
old location name new location name
================= =================
``left_center``   ``center_left``
``right_center``  ``center_right``
================= =================

The old location names will continue to work for some time with a
deprecation warning.

App Current Directory
~~~~~~~~~~~~~~~~~~~~~

Directory style apps no longer ``chdir`` into the app directory. The module
attribute ``__file__`` should be used to construct any file paths relative
to ``main.py`` for use with ``open``, etc.

Window Titles
~~~~~~~~~~~~~

Bokeh apps embedded with ``autoload_server`` will no longer set the browser
window title.

Positional Argument Order For ``hbar``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In order to provide much improved interactive help (true function signatures
and rich auto-generated docstrings) the order of the ``left`` and ``right``
parameters to ``hbar`` had to be swapped (cannot have non-default args after
a default arg). The new function signature is:

.. code-block:: python

    p.hbar(y, height, right, left=0, **kwargs)

Old ``bokeh-server`` Command Removed
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Since 0.11, the old ``bokeh-server`` command remained and only printed a
message directing to information about using ``bokeh serve``. It has been
removed completely.

Cruft ``auto`` Functions removed
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The following functions in ``bokeh.io`` were long unused and have been
removed: ``autoadd``, ``autopush``, and ``autosave``.

Eco Templates No Longer Supported
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

BokehJS has migrated to using ``.tsx`` templates. Provisional support for
including ``.eco`` templates has been removed from both BokehJS and the
Bokeh Python library.

Base64 serialisation and Python 3.3
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The addition a binary protocol that uses a base 64 encoding for NumPy arrays
means that Bokeh will *not* function with NumPy arrays on Python 3.3, due to a
bug in Python. A possible workaround is to convert all arrays to plain python
lists. As a reminder, Bokeh official support includes Python 2.7 and 3.4+ only.

BokehJS BackboneView ``$`` Removed
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In part of a longer effort to remove the JQuery dependency from BokehJS
entirely, the ``$`` attribute that BokehJS added to ``BackboneView``
has been removed. Use e.g., ``@$el.find`` instead.

Additionally, use of ``Bokeh.$`` and ``Bokeh._``

Refactor of ``bokeh.core``
~~~~~~~~~~~~~~~~~~~~~~~~~~

It is expected that all of these these changes should be below the level
that standard users will ever be exposed to. These changes are listed here
for completeness.

The overly large ``bokeh.core.properties`` module has been split up. This
improves maintainability and allows the contents of ``bokeh.core.properties``
to limited to things of that might be useful to users writing custom models.
The new file structure:

* ``bokeh.core.has_props``
* ``bokeh.core.properties``
* ``bokeh.core.property.bases``
* ``bokeh.core.property.containers``
* ``bokeh.core.property.descriptors``
* ``bokeh.core.property.descriptor_factory``
* ``bokeh.core.property.override``

The following class names have been changed to improve intent and clarity
(i.e. only things that are actually Python descriptors are named "Descriptor"):

=================================== ===============================
old class name                      new class name
=================================== ===============================
``PropertyFactory``                 ``PropertyDescriptorFactory``
``PropertyDescriptor``              ``Property``
``ParameterizedPropertyDescriptor`` ``ParameterizedProperty``
``BasicProperty``                   ``BasicPropertyDescriptor``
``DataSpecProperty``                ``DataSpecPropertyDescriptor``
``UnitsSpecProperty``               ``UnitsSpecPropertyDescriptor``
=================================== ===============================

The following unused and non-useful properties were removed in this effort:
``Align``, ``Event``, ``Function``, and ``This``.

The default value for the ``owner`` parameter of the ``__get__`` method
on property descriptors was an unnecessary change to the standard Python
descriptor protocol, and has been removed.

Additionally, the ``HasProps.set`` method has been removed. The name caused
problems with the Sphinx docs build, and it was an unnecessary duplicate of
``HasProps.update`` (which should be used instead).

.. _project roadmap: https://bokeh.org/roadmap
.. _release-0-12-5:

0.12.5
======

Bokeh Version ``0.12.5`` (Mar 2017) is an incremental update that adds a few
important features and fixes several bugs. Some of the highlights include:

* New general capability for Python/JS events (:bokeh-issue:`3210`,
  :bokeh-issue:`3748`, :bokeh-issue:`5278`)
* Bokeh apps easily viewable inline in Jupyter Notebooks (:bokeh-issue:`3461`)
* Confusing ``--host`` parameter no longer necessary (:bokeh-issue:`5692`)
* Interactive legends can now control glyph visibility (:bokeh-issue:`2274`,
  :bokeh-issue:`3715`)
* Many fixes and improvements to ``GMapPlot`` including a new ``gmap``
  function for creating Google Maps plots easily (:bokeh-issue:`2822`,
  :bokeh-issue:`2940`, :bokeh-issue:`3737`, :bokeh-issue:`4835`,
  :bokeh-issue:`5592`, :bokeh-issue:`5826`, :bokeh-issue:`5845`)
* ``CustomJSTransform`` now available for CDS columns (:bokeh-issue:`5015`)
* Sophisticated "pivot" example app contributed (:bokeh-issue:`5894`)
* Themes now work with ``components`` and in Jupyter notebooks
  (:bokeh-issue:`4722`, :bokeh-issue:`4952`, )

Many other bugfixes and docs additions are also included. For full details
see the :bokeh-tree:`CHANGELOG`.

.. _release-0-12-5-migration:

`Migration Guide <releases.html#release-0-12-5-migration>`__
------------------------------------------------------------

Known Issues
~~~~~~~~~~~~

The ClientSession APIs defined in `bokeh.client.session`, such as
`push_session`, don't currently support the new `on_event` interface for
UI event callbacks in Bokeh Server application. You may track the issue on
GitHub (:bokeh-issue:`6092`).

As the project approaches a 1.0 release, it is necessary to make some changes
to bring interfaces and functionality up to a point that can be maintained
long-term. We try to limit such changes as much as possible, and have a
period of deprecation.

New Deprecations
~~~~~~~~~~~~~~~~

**MPL COMPATIBILITY IS DEPRECATED**

Bokeh's MPL compatibility was implemented using a third-party library that
only exposes a small fraction of all Matplotlib functionality, and is
now no longer being actively maintained. The Bokeh team unfortunately does
not have the resources to continue supporting this functionality, which
was never more than *extremely* limited in capability, and often produced
substandard results. Accordingly, in order to support the long term health
of the project, it has been decided to remove all MPL compatibility support
on the occasion of a 1.0 release. Any code that currently uses ``to_bokeh``
will continue to work with a deprecation warning until that time.

The ``bokeh.embed.standalone_html_page_for_models`` method has been deprecated
in place of ``bokeh.embed.file_html``. For details see :bokeh-pull:`5978`.

The ``validate`` keyword argument to ``bokeh.io.save`` has been deprecated.
Future usage of ``bokeh.io.save`` will always validate the document before
outputting a file.

Deprecations removed
~~~~~~~~~~~~~~~~~~~~

All previous deprecations up to ``0.12.0`` have be removed. Below is the
complete list of removals.

Modules and functions and classes that have been removed:

============================ ========================== ===================================
Functions Removed            Modules Removed            Classes Removed
============================ ========================== ===================================
``bokeh.embed.components``   ``bokeh.browserlib``       ``bokeh.core.properties.TitleProp``
``bokeh.charts.hplot``       ``bokeh.mixins``           ``bokeh.models.layouts.GridPlot``
``bokeh.charts.vplot``       ``bokeh.plotting_helpers`` ``bokeh.models.layouts.VBoxForm``
``bokeh.io.hplot``           ``bokeh.properties``
``bokeh.io.vplot``           ``bokeh.templates``
``bokeh.io.vform``
``bokeh.plotting.hplot``
``bokeh.plotting.vplot``
============================ ========================== ===================================

The methods ``bokeh.document.add`` and ``push_notebook`` of
``ColumnDataSource`` have been removed.

The ``bokeh.io.output_server`` function has been also been removed.
Additionally, ``bokeh.io.push`` and other supporting functions or
properties that are useless without ``output_server`` have been
removed. This includes any transitive imports of these functions
from other modules.

Additionally, the property ``bokeh.charts.builder.Builder.sort_legend`` was
removed, as well as the following properties of ``Plot``

* ``border_fill``
* ``background_fill``
* ``logo``
* ``responsive``
* ``title_text_align``
* ``title_text_alpha``
* ``title_text_baseline``
* ``title_text_color``
* ``title_text_font``
* ``title_text_font_size``

Host Parameter Obsoleted
~~~~~~~~~~~~~~~~~~~~~~~~
The ``--host`` parameter is now unnecessary. For compatibility, supplying
it will currently cause a warning to be displayed, but it will otherwise
be ignored, and apps will run as normal. In a future release, supplying it
will result in an error.

The ``--host`` parameter for the Bokeh server was confusing and difficult to
explain. As long as the Bokeh server relied on the HTTP "host" header to
provide URLs to resources, the ``--host`` parameter was a necessary precaution
against certain kinds of HTTP spoofing attacks. However, the Bokeh server
has been updated to no longer require the use of the "host" header (and this
is maintained under test). Accordingly, there is no need to have any check
on the value of the "host" header, and so ``--host`` is no longer needed.

Document and Model Refactoring
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In order that ``document.py`` and ``models.py`` only contain things that might
be of usual interest to users, some changes and rearrangements were made.

The ``abstract`` class decorator was moved from ``models.py`` to
``has_props.py``. The class decorator now also adds an admonition to the
docstring of any class marked abstract that it is not useful to instantiate
directly.

The metaclass ``Viewable`` has been renamed to ``MetaModel``.

The ``document.py`` module has been split up, and parts that would not be of
normal interest to most users have been moved to better locations.

These changes are not expected to impact user code in any way. For complete
details see :bokeh-pull:`5786`.

JQuery and underscore.js removed from BokehJS
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

JQuery has been removed as a build dependency of BokehJS. The variable
`Bokeh.$` is no longer available. If you require JQuery (i.e. for a custom
extension or when using the JavaScript API) you will need to provide it
explicitly.

underscore.js has been removed as a build dependency of BokehJS. The variable
`Bokeh._` is no longer available. If you require underscore.js (i.e. for a
custom extension or when using the JavaScript API) you will need to provide it
explicitly.

Both of these removals together result in a ~10% reduction in the size of
the minified BokehJS library.

Default tooltip position for lines changed to nearest point
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When showing tooltips for lines, the new default is to label the nearest point,
instead of the previous point, which used to be the default.

HTTP Request information for apps limited to query arguments
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The ``request`` previously attribute was added to session contexts as a way to
expose HTTP query parameters. It was discovered that providing the entire
request is not compatible with the usage of ``--num-procs``. A method was
found to satisfy the original feature request for query arguments, together
with ``--num-procs`` (but *only* for query arguments). Accordingly the only
attribute that can now be accessed on ``request`` is ``.arguments``, e.g.:

.. code-block:: python

    curdoc().session_context.request.arguments

Attempting to access any other attribute on ``request`` will result in an
error.

.. _project roadmap: https://bokeh.org/roadmap

Default save file
~~~~~~~~~~~~~~~~~

If user-specified or default destination cannot be written to, a temporary
file is generated instead. This mostly affects using ``output_file`` in an
interactive session which formerly could result in a ``PermissionError``.
For details see :bokeh-pull:`5942`.

The ``bokeh.io.save`` method will now only accept a ``LayoutDOM`` object and
no longer a ``Document`` object for its ``obj`` argument. This aligns the
``bokeh.io.save`` argument types with ``bokeh.io.show``.

Reorganization of bokeh's examples
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Low-level examples, located under ``examples/models``, were split into ``file``
and ``server`` examples and are available under ``examples/models/file`` and
``examples/models/server`` respectively (similarly to plotting examples).

Enabling WebGL via URL parameters disallowed
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Previously it was possible to enable WebGL with ``?webgl=1`` URL parameter.
With addition of a separate ``bokeh-gl`` bundle, this usage is no longer
supportable. WebGL rendering is still configurable using the ``Plot.webgl``
property.
.. _release-0-12-15:

0.12.15
=======

Bokeh Version ``0.12.15`` (Mar 2018) is an incremental update that adds a few
important features and fixes several bugs. Some of the highlights
include:

* Addressed several WebGL bugs (:bokeh-issue:`6867`, :bokeh-issue:`7087`, :bokeh-issue:`7211`, :bokeh-issue:`7681`)

* Switched to Chrome headless for CI image tests, will support better WebGL testing (:bokeh-issue:`6594`)

* Updated data source selections to be proper Bokeh models (:bokeh-issue:`6845`)

* Fixed memory leaks with certain kinds of Bokeh server usage (:bokeh-issue:`7468`)

* Added new glyphs for hexagon markers and hex tiles, and a new ``hexbin`` method :bokeh-issue:`7638`, (:bokeh-issue:`4786`)

* Completed BokehJS port to TypeScript (:bokeh-issue:`6481`)

Many other small bugfixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`.

Additionally, we are pleased to announce `Bokeh joins NumFOCUS Sponsored Projects`_.

.. _Bokeh joins NumFOCUS Sponsored Projects: https://www.numfocus.org/blog/bokeh-joins-sponsored-projects/).

.. _release-0-12-15-migration:

`Migration Guide <releases.html#release-0-12-15-migration>`__
-------------------------------------------------------------

DataTable
~~~~~~~~~

The mis-named property ``DataTable.row_header`` has been deprecated. This
property confusingly controlled the presence of an index column in a
DataTable. Now, use the ``index_position`` property to specify where
an index column should be located in the table (use ``None`` to suppress
the index column).

Additionally, new properties ``index_header`` and ``index_width`` are
now available to further customize the index column appearance.

Selections
~~~~~~~~~~

The handling of selections has needed attention in Bokeh for some time.
This release adds a new Bokeh model :class:`~bokeh.models.selections.Selection`
to represent selections on data sources. Having a proper Bokeh model makes
selections simpler to use and to synchronize in apps than the previous
"bare dict" that represented selections.

The new :class:`~bokeh.models.selections.Selection` model is found in
the same location on data sources, i.e. ``source.selected``. It has the
following properties:

.. code-block:: python

    .indices            # which scatter typer indices have been hit
                        # previously selected["1d"].indices

    .line_indices       # which point(s) on a line have been hit
                        # previously selected["0d"].indices

    .multiline_indices  # which points on which line of a MultiLine
                        # previously selected["2d"].indices

In the near future, a property ``image_indices`` will be added to support
hit testing of image glyphs.

All code should update to use these new properties. For now *read only*
access to things like ``selected['1d'].indices`` will continue to function
as before for compatibility. However, programmatically *setting* selections
must now go through the mode properties, i.e. ``.indices``, ``.line_indices``,
etc.

Grid Bounds
~~~~~~~~~~~

Grids now automatically defer to any existing axis bounds when their
own bounds are set to `"auto"`. Previously grids used always used the full
range bounds. This change makes it simpler to have axes and grids both
use a consistent set of bounds.

Minor Ticks
~~~~~~~~~~~

Minor ticks are no longer displayed outside explicitly set axis bounds.
Previously minor ticks would display one extra "major tick" distance outside
explicit range bounds.

NO_DATA_RENDERERS
~~~~~~~~~~~~~~~~~

This validation warning resulted in false or irrelevant warnings in many
reasonable configurations, and has been removed.

Document and ServerContext callbacks
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

All `Document` and `ServerContext` methods that add callbacks can now add
the same callback multiple times.
Methods that remove callbacks now receive the value returned from a previous
method call that added the callback. Example:

.. code-block:: python

    # Was
    doc.add_next_tick_callback(my_cb)
    doc.remove_next_tick_callback(my_cb)

    # Now
    cb_id = doc.add_next_tick_callback(my_cb)
    doc.remove_next_tick_callback(cb_id)

Sphinx Version
~~~~~~~~~~~~~~

The `bokeh.sphinxext` Sphinx extension has been updated to work with current
versions. Sphinx >= 1.6 is now required to use the extension.

.. _project roadmap: https://bokeh.org/roadmap
.. _release-0-4-1:

0.4.1
=====

Bokeh ``0.4.1`` (Feb 2014) is a minor release:

* Improved MPL interface, LineCollection plus examples
* Scala interface
* Categorical axes and ranges
* Hover tool
* Improved pan/zoom tool interactions
.. _release-1-3-4:

1.3.4
=====

Bokeh Version ``1.3.4`` (Aug 2019) is a micro-release to test changes to
build and release automation.
.. _release-0-12-11:

0.12.11
=======

Bokeh Version ``0.12.11`` (Nov 2017) is an incremental update that adds a few
important features and fixes several bugs. Some of the highlights include:

* ``Step`` glyph for step lines added (:bokeh-issue:`3644`)

* Level-of-Detail works with linked plots (:bokeh-issue:`5937`)

* Bokeh applications in notebooks made simpler to create (:bokeh-issue:`6565`)

Many other small bugfixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`.

.. _release-0-12-11-migration:

`Migration Guide <releases.html#release-0-12-11-migration>`__
-------------------------------------------------------------

BokehJS Changes
~~~~~~~~~~~~~~~

To help with the eventual migration to TypeScript, we have switched to the new
CoffeeScript compiler. This should be completely transparent to standard users
but custom extensions may need small changes in some specific cases, for example,
the "Ion Range Slider" required the following change:

.. code-block:: none

    -      onChange: @slide,
    -      onFinish: @slidestop
    +      onChange: (data) => @slide(data),
    +      onFinish: (data) => @slidestop(data),

Shorthand initialization syntax for `Range1d(start, end)` in bokehjs was
removed due to technical difficulties. Use full `new Range1d({start, end})`
syntax instead. The short syntax may be restored at some point as a part of
`bokeh-api` package.

The coordinate system of canvas layout and related infrastructure (positioning,
hit testing, etc.) is new "screen", where the origin is left-top corner of the
canvas. This change shouldn't affect users, however it affects custom model
developers. Follow updated examples for new development patterns.

.. _project roadmap: https://bokeh.org/roadmap
.. _release-0-12-9:

0.12.9
======

Bokeh Version ``0.12.9`` (Sep 2017) is an incremental update that adds a few
important features and fixes several bugs. Some of the highlights include:

* JupyterLab integration with the `jupyterlab_bokeh`_ extension
* Efficient binary transport for sending arrays to clients
* Improvements to new Graph/Network capability

Many other small bugfixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`.

.. _release-0-12-9-migration:

`Migration Guide <releases.html#release-0-12-9-migration>`__
------------------------------------------------------------

Deprecated ``bokeh.charts`` support removed
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The ``bokeh.charts`` module, which was simply a compatibility shim to load the
separate ``bkcharts`` package, has been removed. Additionally, Bokeh itself no
longer lists ``bkcharts`` as a dependency. In order to continue using
``bkcharts`` code, the ``bkcharts`` package must be installed separately.

Deprecated MPL compatibility removed
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The ``bokeh.mpl`` module and all supporting code in ``bokeh.core.compat`` has
been removed. Bokeh no longer offers or attempts any automatic MPL conversion.

Table Date Formatter Changes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A regression in ``0.12.7`` caused the ``DateFormatter`` to stop functioning.
The problem has been fixed, however instead of the previously accepted JQuery
style formats, the``format`` property now only accepts

* standard `strftime`_ format strings (making it consistent with
  ``DatetimeTickFormatter``)
* any of the following additional predefined formats names:

  ================================================ ================== ===================
  Format name(s)                                   Format string      Example Output
  ================================================ ================== ===================
  ``ATOM`` / ``W3C`` / ``RFC-3339`` / ``ISO-8601`` ``"%Y-%m-%d"``     2014-03-01
  ``COOKIE``                                       ``"%a, %d %b %Y"`` Sat, 01 Mar 2014
  ``RFC-850``                                      ``"%A, %d-%b-%y"`` Saturday, 01-Mar-14
  ``RFC-1123`` / ``RFC-2822``                      ``"%a, %e %b %Y"`` Sat, 1 Mar 2014
  ``RSS`` / ``RFC-822`` / ``RFC-1036``             ``"%a, %e %b %y"`` Sat, 1 Mar 14
  ``TIMESTAMP``                                    (ms since epoch)   1393632000000
  ================================================ ================== ===================

  Note that the previously available format name ``TICKS`` is no longer
  supported.

Old Testing Functions Removed
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The functions ``bokeh.test`` and ``bokeh.util.testing.runtests`` have been
removed immediately. Tests should be run as described in the `testing section`_
of the Developer's Guide.

The function ``bokeh.util.testing.print_versions`` has been removed
immediately. The ``bokeh info`` command (or ``python -m bokeh info``) should be
used instead.

Refactor of ``bokeh.client`` and ``bokeh.document``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The ``bokeh.client`` and ``bokeh.document`` packages were refactored, to make
maintenance and testing simpler, and to improve overall code quality. No
commonly used or demonstrated public APIs were affected, (no example code
required any changes). The other files that were moved or changed are not
expected to impact user code.

End of Official Support for Python 3.4
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting with this release, Bokeh is no longer continuously tested against
Python 3.4. Use of Bokeh with Python 3.4 will very likely still work, but
there are no longer any guarantees backed by CI testing.

.. _jupyterlab_bokeh: https://github.com/bokeh/jupyterlab_bokeh
.. _project roadmap: https://bokeh.org/roadmap
.. _strftime: http://man7.org/linux/man-pages/man3/strftime.3.html
.. _testing section: http://docs.bokeh.org/en/latest/docs/dev_guide/testing.html
.. _release-0-11-1:

0.11.1
======

Bokeh version ``0.11.1`` (Feb 2016) focuses on providing bug fixes, small
features, and documentation improvements. Highlights include:

* settings and documentation for Bokeh server behind an SSL terminated proxy
* bugfixes:

  - MultiSelect works
  - Oval legend renders correctly
  - Plot title orientation setting works
  - Annulus glyph works on IE/Edge

* features:

  - preview of new streaming API in OHLC demo
  - undo/redo tool add, reset tool now resets plot size
  - "bokeh static" and "bokeh sampledata" commands
  - can now create Bokeh apps directly from Jupyter Notebooks
  - headers and content type now configurable on AjaxDataSource

Additionally some internal work has started to refactor and clean up BokehJS
to bring the class and file structure into closer alignment with the Bokeh
python library.

.. _release-0-11-1-migration:

`Migration Guide <releases.html#release-0-11-1-migration>`__
------------------------------------------------------------

* Range update callbacks now return the range object as cb_obj (not the plot)
* Layouts (HBox, VBox, VBoxForm) have been moved from bokeh.models.widgets to
  bokeh.models.layouts, but continue to be importable from bokeh.models
* BlazeDataSource has been removed; it will be maintained by the Blaze team
  in the future.
* The broken BokehJS API has been removed. We are actively seeking a
  champion/maintainer for a new BokehJS API.
.. _release-0-8-2:

0.8.2
=====

Bokeh ``0.8.2`` (Mar 2015) is a quick release focused on some refactoring,
bug fixes and improved documentation.

* Collect implicit interfaces into a single bokeh.io module
* Fixed notebook css issues
* Update notebooks to be compatible with IPython 3.0
* Easy bokeh applet generation using the simpleapp module
* Develop installation enhancements
* A new User guide intro and some other docs styling enhancements
* Some other minor examples bugfixes
.. _release-2-2-2:

2.2.2
=====

Bokeh Version ``2.2.2`` (Oct 2020) is a patch-release that fixes a bug that
affects downstream projects:

* Selectively update data when CDSView changes (:bokeh-issue:`10521`)

For full details see the :bokeh-tree:`CHANGELOG`.
.. _release-0-4-4:

0.4.4
=====

Bokeh ``0.4.4`` (Apr 2014) is a minor release:

* Improved MPL interface, subplots, styling plus more examples
* TravisCI testing integration
* Tool enhancements, constrained pan/zoom, more hover glyphs
* Server remote data and downsampling examples
* Initial work for Bokeh "app" concept
.. _release-0-7-0:

0.7.0
=====

Bokeh ``0.7.0`` (Dec 2014) focused on new features and capability, particularly
arounduser interface and experience:

* IPython widgets and animations without a Bokeh server
* Touch UI working for tools on mobile devices
* Vastly improved linked data table
* More new (and improving) bokeh.charts (high level charting interface)
* Color mappers on the python side
* Improved toolbar
* Many new tools: lasso, poly, and point selection, crosshair inspector

.. _release-0-7-0-migration:

`Migration Guide <releases.html#release-0-7-0-migration>`__
-----------------------------------------------------------

Additionally, note that the "implicit" plotting interface of plotting.py
has been deprecated, and will be removed in Bokeh 0.8. In a nutshell,
code such as:

.. code-block:: python

    figure()
    hold()
    line()
    circle()
    show()

Should be replaced with the more explicit code:

.. code-block:: python

    p = figure()
    p.line()
    p.circle()
    show(p)
.. _release-0-12-13:

0.12.13
=======

Bokeh Version ``0.12.13`` (Dec 2017) is a targeted bugfix release that
addresses two issues:

* ``push_notebook`` regression in ``0.12.11``
* Windows package install failures due to reserved "aux" filename

For full details see the :bokeh-tree:`CHANGELOG`.

.. _release-0-12-13-migration:

`Migration Guide <releases.html#release-0-12-13-migration>`__
-------------------------------------------------------------

BokehJS Changes
~~~~~~~~~~~~~~~

BokehJS doesn't require custom styles to make "responsive" layout modes work
anymore. This means that there are no additional styles added a page, like
margins. This results in margins working differently and now default to browser
defaults. If you want to restore the previous behavior, then add the following
to your HTML:

.. code-block:: html

    <style>
      html {
        width: 100%;
        height: 100%;
      }
      body {
        width: 90%;
        height: 100%;
        margin: auto;
      }
    </style>
.. _release-2-0-1:

2.0.1
=====

Bokeh Version ``2.0.1`` (April 2020) is a micro-release that fixes some bugs and
improves some small features. Highlights include:

* Addressing a Cross-Origin Resource Sharing (CORS) issue seen in Chrome and
  Chromium-based browsers :bokeh-issue:`9773`.
* Adding multi-file support for FileInput widgets :bokeh-issue:`9727`
* Bokeh server can now serve custom extension code :bokeh-issue:`9799`
* A handful of documentation clarifications, corrections, and expansions

And several other bug fixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`.
.. _release-0-5-1:

0.5.1
=====

Bokeh ``0.5.1`` (Jul 2014) is an incremental update:

* Hover activated by default
* Boxplot in bokeh.charts
* Better messages when you forgot to start the bokeh-server
* Fixed some packaging bugs
* Fixed NBviewer rendering
* Fixed some Unicodeencodeerror
.. _release-0-12-16:

0.12.16
=======

Bokeh Version ``0.12.16`` (May 2018) is an incremental update that adds a few
new features and fixes several bugs. Some of the highlights include:

* Hover tools now work with image glyphs (:bokeh-issue:`3886`)

* BokehJS exposes a public ``reset`` method for Plots (:bokeh-issue:`5071`)

* Categorical tick labels at all levels may be rotates (:bokeh-issue`7643`)

* New ``CustomJSHover`` for highly customized tooltip fields (:bokeh-issue:`7647`)

* Axes may now have fixed positions inside plots (:bokeh-issue:`113`)

* Small zoom tool enhancements (:bokeh-issue:`3126`, :bokeh-issue:`3125`, :bokeh-issue:`2427`)

* ``MultiLine`` and ``Patches`` now function with categorical ranges (:bokeh-issue:`7462`)

And several other bug fixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`.

.. _release-0-12-16-migration:

`Migration Guide <releases.html#release-0-12-16-migration>`__
-------------------------------------------------------------

NOTE: the 0.12.x series is the last planned release series before a version
1.0 release. For more information see the `project roadmap`_.

Deprecations Removed
~~~~~~~~~~~~~~~~~~~~

The following functions, arguments, or features have were previously deprecated
with warnings and instructions for new usage, and have now been permanently
removed:

* ``--host`` argument to ``bokeh serve``
* ``responsive`` argument to plots and layout functions
* ``Plot.toolbar_sticky`` property
* ``Tool.plot`` property
* ``bokeh.sampledata.population.load_population`` function
* ``bokeh.util.notebook`` module

Release History
~~~~~~~~~~~~~~~

To support publishing all release information on one page, the
``bokeh_index_toctree`` module and contents have been immediately moved to
``bokeh_releases``. Since this facility had no use outside building
official Bokeh documentation, no deprecation was given.

CDS ``column_names`` property
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

``ColumnDataSource`` models had a Bokeh property ``column_names`` for specifying
the list of column names in ``source.data``. This information was duplicative
and had to be explicitly maintained in a fragile way. It has been replaced by
read-only properties in both Python and JavaScript that always accurately
report the current column names automatically. Setting ``column_names`` is
no longer supported, however as this possibility has never been officially
documented or demonstrated, it is not expected to affect any standard usage.

Tools ``renderers`` property
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Previously the default value, an empty list, corresponded to automatically
choosing all available renderers for hit testing. Now, a new default value
``"auto"`` is used for that, so that an empty list can mean "hit test no
renderers". A value of ``None`` may also be used to indicate no hit testing
should occur. Since there is typically no reason to explicitly set a property
to its default value, it is not expected that this change impacts any standard
usage.

bokehjs' source directory renamed
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To finalize the rewrite of bokehjs in TypeScript, the source directory was
renamed from ``src/coffee`` to ``src/lib``. This change affects only bokehjs'
contributors or other advanced users (e.g. when repackaging bokehjs with
Webpack or other JavaScript module bundler).

``BOKEH_DOCS_MISSING_API_KEY_OK`` environment variable
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

This environment variable is no longer used by Bokeh. Previously, the
``bokeh.sphinxext`` plot directive would always fail by default if a
``GOOGLE_API_KEY`` environment variable was not defined, and this environment
variable could be set to override that default behavior. Now, builds will
succeed by default, even witout a Google API key defined (but Google Maps plots
will not fully render). To require an API be defined (i.e. to restore the
previous behavior) you can now set ``bokeh_missing_google_api_key_ok = False``
in the Sphinx config file.

.. _project roadmap: https://bokeh.org/roadmap
.. _release-1-0-4:

1.0.4
=====

Bokeh Version ``1.0.4`` (January 2019) primarily addresses a security issue
regarding ``yaml.load`` (:bokeh-issue:`8541`).

For full details see the :bokeh-tree:`CHANGELOG`.
.. _release-1-2-0:

1.2.0
=====

Bokeh Version ``1.2.0`` (May 2019) is a point release that adds some
interesting new features:


* Styling options for fill patterns / hatching :bokeh-issue:`6135`
* Built-in support for stacked areas and lines :bokeh-issue:`8848`
* New `title` property for `Legend` :bokeh-issue:`6769`
* Slider `callback_policy` now works for Bokeh Apps :bokeh-issue:`4540`

And several other bug fixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`.

.. _release-1-2-0-migration:

`Migration Guide <releases.html#release-1-2-0-migration>`__
-----------------------------------------------------------

New in 1.2
~~~~~~~~~~

Discourse Site
''''''''''''''

*The Google Groups mailing list has been retired*. In it's place, there is now
a `Discourse site for community discussions`_.
All of the old content from the mailing list has been imported into the Discourse,
and is searchable.

Callback Policy
'''''''''''''''

Sliders add a ``value_throttled`` property that is updated (and triggers JS
and Python callbacks) only according to the ``callback_policy``:

.. code-block:: python

    slider.callback_policy = "mouseup"

    # both of these will respect the callback policy now
    slider.js_on_change('value_throttled', ...)
    slider.on_change('value_throttled', ...)

The callbacks above will only execute when the user releases the mouse
after adjusting a slider.

Note that the `value` property can also still be used to trigger callbacks
&mdash;they will execute unconditionally on every movement.

The old-style `callback` property still works for JS callbacks, but will be
removed in Bokeh 2.0 in the near future. The general `js_on_change` and `on_change`
mothods should be used going forward.

Stacked Areas and Lines
'''''''''''''''''''''''

New ``varea`` and ``harea`` methods add support for single directed areas
(filled regions between two series that share a common index). Also added:

* ``varea_stack``
* ``harea_stack``

for stacking directed areas, and

* ``vline_stack``
* ``hline_stack``

for stacking lines.

For example:

.. code-block:: python

    colnames = ['y0', 'y1', 'y2', 'y3', 'y4', 'y5', 'y6']

    p.varea_stack(colnames, x='index', color=colors, source=df,
                legend=[value(x) for x in colnames])

    p.vline_stack(colnames, x='index', color="black", source=df)

Legend Titles
'''''''''''''

Legends now support displaying a title:

.. code-block:: python

    p.legend.title = "Things"

.. _Discourse site for community discussions: https://discourse.bokeh.org
.. _release-2-3-1:

2.3.1
=====

Bokeh Version ``2.3.1`` (April 2021) is a patch-release that fixes bugs that
affects downstream projects:

* Bugs causing excessive data transfer (:bokeh-issue:`10822`, :bokeh-issue:`11026`, :bokeh-issue:`11029`)
* Minor layout regression (:bokeh-issue:`11057`)
* Log axis exponent render issue (:bokeh-issue:`11006`)

As well as other very minor docs, build, and bugfix updates.

For full details see the :bokeh-tree:`CHANGELOG`.

.. _release-2-3-1-migration:

`Migration Guide <releases.html#release-2-3-1-migration>`__
-----------------------------------------------------------

HSL class deprecated
~~~~~~~~~~~~~~~~~~~~

The class ``bokeh.colors.HSL`` is deprecated and will be removed in a future
release. Use the ``RGB`` class, RGB(a) strings, or named colors instead.
.. _release-1-0-3:

1.0.3
=====

Bokeh Version ``1.0.3`` (December 2018) is a micro bugfix and feature release.

Some of the highlights include:

* Enable Copy-and-Paste from ``DataTable`` (:bokeh-issue:`7762`)
* Add a Multi-line ``TextAreaInput`` widget (:bokeh-issue:`2828`)

For full details see the :bokeh-tree:`CHANGELOG`.
.. _release-0-8-0:

0.8.0
=====

Bokeh ``0.8.0`` (Feb 2015) includes many major new features:

* New and updated language bindings: R, JavaScript, Julia, Scala, and Lua now available
* Better bokeh-server experience:

  - live gallery for server apps and examples!
  - new "publish" mode Bokeh plots and apps
  - docs and advice for real-world deployments

* Simpler and more easily extensible charts architecture, with new Horizon chart
* Dramatic build and documentation improvements:

  - 100% complete reference guide
  - full docs and BokehJS version deployed for every "dev" build and RC
  - sphinx extensions for easy inline plots

* Shaded grid bands, configurable hover tool, and pan/zoom for categorical plots
* Improved and more robust crossfilter
* AjaxDataSource for clients to stream data without a Bokeh server

In addition, many bugfixes and small features, both old and new --- over 100
issues --- were closed for this release! Additionally several new contributors
helped out in a big way. Special thanks to Sarah Bird, Mathieu Drapeau,
Samantha Hughes, and Nick Roth.
.. _release-2-4-1:

2.4.1
=====

Bokeh Version ``2.4.1`` (Oct 2021) is a patch-release that fixes a number of minor bugs/regressions and build issues.

* Support full text search for MultiChoice and auto complete input (:bokeh-issue:`10525`)
* Reduce Tornado imports (:bokeh-issue:`11618`)
* Fix regression causing slow Hover tool rendering (:bokeh-issue:`11629`)
* RangesUpdate not emitted when using xwheel_pan (:bokeh-issue:`11633`)
* Actually fix clipping in SVG <text> nodes (:bokeh-issue:`11644`)
* bokeh init creates a package.json which refers to the deprecated Bokeh JS node package (:bokeh-issue:`11645`)
* Using band_hatch_pattern with images doesn't work (:bokeh-issue:`11646`)
* Update bokehjs' dependencies (:bokeh-issue:`11652`)
* Support "pip install" from sdist (:bokeh-issue:`11658`)
* Issue with line rendering when selecting indices (:bokeh-issue:`11661`)
* Fix WebGL marker count change (:bokeh-issue:`11686`)

As well as other very minor docs, build, and bugfix updates.

For full details see the :bokeh-tree:`CHANGELOG`.
.. _release-1-3-1:

1.3.1
=====

Bokeh Version ``1.3.1`` (Jul 2019) is a hotfix micro-release to fix
:bokeh-issue:`9123`.
.. _release-0-12-10:

0.12.10
=======

Bokeh Version ``0.12.10`` (Oct 2017) is an incremental update that adds a few
important features and fixes several bugs. For full details see the
:bokeh-tree:`CHANGELOG`.

.. _release-0-12-10-migration:

`Migration Guide <releases.html#release-0-12-10-migration>`__
-------------------------------------------------------------

Deprecations Removed
~~~~~~~~~~~~~~~~~~~~

The following previous deprecations have been removed:

* ``app_path`` from functions in ``bokeh.client.session`` and ``bokeh.embed``
* ``standalone_html_page_for_models`` from ``bokeh.embed``
* ``'patch'`` and ``'stream'`` event names (use ``'patching'`` and ``'streaming'``)
* ``webgl``, ``x_mapper_type``, ``y_mapper_type``, and ``tool_events`` from ``Plot``
* Glyphs methods now only accept either all sequence literals, OR all column names
* ``ResizeTool`` (previously made a no-op) has been removed

New Deprecations
~~~~~~~~~~~~~~~~

The boolean ``responsive`` parameter to ``figure`` and ``bokeh.layouts`` has
been deprecated. The ``sizing_mode`` enum should be used instead. Use
``sizing_mode='fixed'`` for ``responsive=False`` and
``sizing_mode='scale_width'`` for ``responsive=True`` instead.

The function ``bokeh.sampledata.population.load_population`` has been
deprecated. Use the attribute ``bokeh.sampledata.population.data`` instead.

Code Moves
~~~~~~~~~~

The module ``bokeh.util.notebook`` has been deprecated. The functions it
contains have been moved to ``bokeh.io.notebook``.

The function ``bokeh.io.set_curdoc`` is now ``bokeh.io.doc.set_curdoc``.

Named color *objects* now live in ``bokeh.colors.named`` instead of directly in
``bokeh.colors``. Additionally color utilities such as ``NamedColor`` have been
moved inside the package, and marked as internal API. Using string names for
colors works exactly as before.

Dead Code Removal
~~~~~~~~~~~~~~~~~

The following unused code was removed immediately:

* ``Aggregation`` from ``bokeh.core.enums``
* PyPy detection functions from ``bokeh.util``
* Zeppelin related code (support should come from external notebook hook)

Additionally the attribute ``bokeh.__base_version__`` was removed. Computing
it at all times made importing Bokeh take substantial fractions of a second
longer than necessary. It is not expected this change should affect any
users, but if you need this value, the ``bokeh.util.version.base_version``
function can be used.

.. _project roadmap: https://bokeh.org/roadmap
.. _release-2-3-0:

2.3.0
=====

Bokeh Version ``2.3.0`` (February 2021) is a new minor-release level that
brings many updates. Some of the new feature work includes:

* Multi-line axis and tick labels are now possible (:bokeh-issue:`8169`)
* Log axes display using superscripts (:bokeh-issue:`8954`)
* ``DataModel`` base class to define custom "properties-only" Bokeh subclasses
  added (:bokeh-issue:`3674`)
* Colorbar supports "eqhist" and categorical color mappings
  (:bokeh-issue:`5618`,  :bokeh-issue:`10493`)
* "Edges Only" inspection policy added for graphs (:bokeh-issue:`10637`)
* Hatch patterns can be used with all fill-able glyphs and annotations
  (:bokeh-issue:`10824`)
* New "star" markers added (:bokeh-issue:`10836`)
* Arrowheads and line-dash patterns can be vectorized
  (:bokeh-issue:`6835`, :bokeh-issue:`10203`)
* Tornado websocket compression options added (:bokeh-issue:`10798`)

Important bug-fixes include:

* A major bug with datetime precision causing several regressions was fixed
  (:bokeh-issue:`10738`)
* SVG export no longer flips images (:bokeh-issue:`10725`)
* ``LabelSet`` and ``Whisker`` now work for categorical ranges
  (:bokeh-issue:`10454`, :bokeh-issue:`10575`)
* ``MultiLine`` hover fixed (:bokeh-issue:`10458`)
* ``MultiChoice`` and ``MulitSelect`` disabling now works
  (:bokeh-issue:`10452`, :bokeh-issue:`10507`)
* Date sliders can use a ``TickFormatter`` (:bokeh-issue:`10458`)

The documentation has also received renewed attention:

* New `First steps <https://docs.bokeh.org/en/latest/docs/first_steps.html>`_
  sections
* Documentation updated to reflect
  `new style guidelines <https://docs.bokeh.org/en/latest/docs/dev_guide/documentation.html#documentation-style-guidelines>`_
* Basic OpenGraph metadata has been added to docs pages
* New landing page on `docs.bokeh.org <https://docs.bokeh.org>`_

As well as many other small issues were closed. For full details, see the
:bokeh-tree:`CHANGELOG`.

Please note that the next release level (2.4) will drop support for Python 3.6,
and also be the final release level to support IE and other legacy browsers.

.. _release-2-3-0-migration:

`Migration Guide <releases.html#release-2-3-0-migration>`__
-----------------------------------------------------------

Properties are non-nullable by default
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Previously, all properties accepted ``None`` (``null`` in BokehJS) as a value.
As of this release, ``None`` is only accepted by properties explicitly marked
as nullable, e.g.``Nullable(Int)`` accepts integers and ``None``. All current
models and their properties were adjusted as needed, so there will be no
difference from users' perspective. However, custom extensions may require
updates if they relied on the old behavior.

Primitive and derived properties have default values
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Some properties did not have sensible intrinsic default values (``Int``
defaulted to ``None``, for example). Now all properties have default values,
such as ``0`` for ``Int``, or ``""`` for ``String``. You can remove a default
value by marking a property as non-nullable, e.g. ``NonNullable(Int)``. In this
case, a user is required to set a property value. An attempt to retrieve the
value of a non-nullable property before it is set will raise an
``UnsetValueException``.

Use ``Readonly()`` to indicate readonly properties
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The old syntax, e.g. ``Int(readonly=True)``, is still accepted, but will be
removed in the future. Use ``Readonly(Int)`` instead.

``ArrowHead`` is not an annotation anymore
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

``ArrowHead`` no longer inherits from the ``Annotation`` base class. This will
pave the way for vectorizable arrowheads.

Four of Bokeh's base models are renamed
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Certain base models were renamed to unify naming convention with BokehJS:

+---------------+-------------------+
| Old name      | New name          |
+===============+===================+
| ``WebSource`` | ``WebDataSource`` |
+---------------+-------------------+
| ``Action``    | ``ActionTool``    |
+---------------+-------------------+
| ``Gesture``   | ``GestureTool``   |
+---------------+-------------------+
| ``Inspect``   | ``InspectTool``   |
+---------------+-------------------+

Old names are retained for compatibility but are deprecated and will be removed
in Bokeh 3.0.

``names`` properties were deprecated
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

``DataRange.names``, ``SelectTool.names``, and ``HoverTool.names`` are
deprecated and will be removed in Bokeh 3.0. Use the ``renderers`` properties
instead, possibly in combination with ``plot.select(name="renderer name")``.

BokehJS visuals have different semantics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Previously ``Line``, ``Fill``, ``Text``, and ``Hatch`` visuals were used across
primitive, scalar, and vector properties. Those are now split into more specific
versions, e.g. ``Line``, ``LineScalar``, and ``LineVector``. This should only
affect custom extensions that use visuals.

Marker models are deprecated
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Marker models like ``Asterisk``, ``CircleX``, ``X``, etc. are deprecated. Use
the ``Scatter`` glyph with a marker type instead, e.g. replace ``Asterisk()``
with ``Scatter(marker="asterisk")``. Marker methods on ``figure`` will default
to use ``Scatter`` glyph. Marker models were removed from BokehJS.

Tooltip deprecations
~~~~~~~~~~~~~~~~~~~~

``EditTool.custom_tooltip``, ``HelpTool.help_tooltip`` and
``CustomAction.action_tooltip`` were deprecated Use ``Tool.description``, which
can also be used with all other types tools, instead.

New ``"auto"`` defaults for color bar properties
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

``ColorBar`` properties ``orientation``, ``ticker``, and ``formatter`` now
default to ``"auto"``. Previously, these properties had concrete defaults
(``"vertical"``, ``BasicTicker()`` and ``BasicTickFormatter()`` respectively).
In most cases, this will not affect user code. However, if you relied on setting
e.g. ``color_bar.ticker.base = 60``, then the code will need to be replaced with
``color_bar.ticker = BasicTicker(base=60)``.

``CartesianFrame`` is not a layout anymore
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

This only affects extension creators. ``CartesianFrame`` is now responsible only
for maintaining the coordinate system of a plot. Use the ``layout.center_panel``
of a plot to access any layout-related capability. Note you can still use
``CartesianFrame.bbox``, so most code doesn't have to change.

figure sizing fixed in BokehJS
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Previously, setting ``plot.frame_width`` while using ``sizing_mode:'fixed'``
did not resize the canvas as expected; the figure would only resize after changing
``plot.width`` or ``plot.plot_width``. This behavior has been fixed and now setting
``plot.width`` to trigger the resize is no longer needed.
.. _release-0-2-0:

0.2.0
=====

Bokeh ``0.2.0`` (Oct 2013) is a minor release:

* bokeh.plotting interface for schematized plotting, that wraps the low-level interface
* Performance improvements in BokehJS
* Fixed rendering glitches for HiDPI/Retina displays
* Greatly improved Python interface architecture
* Many more examples, much improved docs
.. _release-0-12-14:

0.12.14
=======

Bokeh Version ``0.12.14`` (Feb 2018) is an incremental update that adds a few
important features and fixes several bugs. Some of the highlights
include:

* Addition of several tools to draw and edit point, rect, multi-line
  and patches glyphs (:bokeh-issue:`6370`) by modifying the underlying
  ColumnDataSource.

Many other small bugfixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`.

.. _release-0-12-14-migration:

`Migration Guide <releases.html#release-0-12-14-migration>`__
-------------------------------------------------------------

Deprecations Removed
~~~~~~~~~~~~~~~~~~~~

The following deprecated features have been removed in this release:

* `DynamicImageRenderer` (consider GeoViews_ instead)
* BokehJS support for `*.tsx` templates (not typically user-facing)
* `autoload_server` (use `server_document` or `server_session` instead)

New Runtime Dependency
~~~~~~~~~~~~~~~~~~~~~~

The package ``packaging``, available via both conda and pip, was added as a
new runtime dependency.

Mapping of Unknown Categorical Factors
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Previously, data (e.g in a CDS column) referring to a categorical factor that
did not exist in the relevant ``FactorRange``, would cause an error in the
browser. Now, any such attempted mappings will silently return ``NaN``. Any
data points with these factors as coordinates will not render.

The practical motivation for this change is that updating a ``FactorRange``
to have a new set of factors could result in an inconsistency triggering the
error condition, causing plots to fail to render. With this change, the use-case
of updating factor ranges should work more smoothly, however there will be no
immediate indication of problems in case "bad" factors are included accidentally
in data other than the data points not being rendered.

Change To Text Glyph Legend
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Previously Text Glyphs added to legends would always unconditionally render
the word "text" as the visual symbol, which was not useful. Now, text glyphs
render an empty space in legends. This is helpful when it is desired to use
an interactive legend mute or hide both a primary glyph, as well as some
associated text that goes with it. For more discussion, see :bokeh-issue:`7337`.

MercatorTileSource change
~~~~~~~~~~~~~~~~~~~~~~~~~

`MercatorTileSource` models previously snapped to the closest zoom
level resulting in user supplied axis ranges to be largely
ignored. The default behavior has now been changed from snapping to
the closest zoom level to simply maintaining the correct aspect ratio,
while keeping the user defined bounds contained within the axis
ranges.

The old behavior may be restored by setting enabling the `snap_to_zoom`
property.

Defining views' CSS classes
~~~~~~~~~~~~~~~~~~~~~~~~~~~

This was previously done through `MyView.prototype.className`, which didn't
respect class structure, so it was often necessary to duplicate CSS rules in
sub-views. The new approach is to override `css_classes()` method, e.g.:

.. code-block:: typescript

    class MyView extends MyOtherView {
        css_classes() {
            return super.css_classes().concat("my-view")
        }
    }

This change affects only creators of custom extensions.

``HasProps.initialize()``
~~~~~~~~~~~~~~~~~~~~~~~~~

Previously ``HasProps.initialize()`` took `attrs` and `options` as its arguments.
This was nearly never used and so it was removed. The preferred way to configure
values of attributes is to use bokehjs' properties system. This change affects
only creators of custom extensions.

.. _GeoViews: http://geo.holoviews.org
.. _project roadmap: https://bokeh.org/roadmap
.. _release-0-9-2:

0.9.2
=====

Bokeh ``0.9.2`` (Jul 2015) provides several bugfixes. Additionally, the MPL
compatibility layer was updated.

* Several nan-related fixes including the slow rendering of plots
* Removed some unused dependencies
* Fixes in our automated release process
* Fixed the patchs vanishing on selection
* More control over ticks and gridlines
* MPL compatibility updated
* Several examples updated
.. _release-0-12-6:

0.12.6
======

Bokeh Version ``0.12.6`` (Jun 2017) is an incremental update that adds a few
important features and fixes several bugs. Some of the highlights include:

* Headless, programmatic export of SVG and PNG images (:bokeh-issue:`538`)
* New annotations ``Band`` and ``Whisker`` for displaying error estimates
  (:bokeh-issue:`2352`)
* Fine-grained sub-element patching for images and other "multi" glyphs
  (:bokeh-issue:`6285`)
* Hover hit-testing extended to segments and all markers (:bokeh-issue:`5907`,
  :bokeh-issue:`5907`)
* Fixes for sorting and selecting from DataTables (:bokeh-issue:`3564`,
  :bokeh-issue:`6115`)
* Large cleanup and refactor of the layout system (:bokeh-issue:`4764`,
  :bokeh-issue:`4810`, :bokeh-issue:`5131`, :bokeh-issue:`5518`,
  :bokeh-issue:`6213`, :bokeh-issue:`6287`)
* Improved formatting options for hover tool fields and axis tick labels
  (:bokeh-issue:`1239`, :bokeh-issue:`1671`, :bokeh-issue:`2595`,
  :bokeh-issue:`6079`)

Many other bugfixes and docs additions are also included. For full details
see the :bokeh-tree:`CHANGELOG`.

.. _release-0-12-6-migration:

`Migration Guide <releases.html#release-0-12-6-migration>`__
------------------------------------------------------------

As the project approaches a 1.0 release, it is necessary to make some changes
to bring interfaces and functionality up to a point that can be maintained
long-term. We try to limit such changes as much as possible, and have a
period of deprecation.

New deprecations
~~~~~~~~~~~~~~~~

The ``Plot.webgl`` property has been deprecated in place of a new property
``Plot.output_backend`` in order to avoid conflicts between WebGL and a new
SVG backend. If you are using ``plot.webgl = True``, you should switch to
setting ``plot.output_backend = "webgl"`` for the future.

Old deprecations removed
~~~~~~~~~~~~~~~~~~~~~~~~

All previous deprecations up to ``0.12.3`` have be removed. Below is the
complete list of removals.

* Deprecated ``Button.type`` property has been removed.
* Deprecated ``Legend`` properties: ``legends``, ``legend_margin``,
  ``legend_padding``, ``legend_spacing`` have been removed.
* Deprecated ``DatetimeTickFormatter.formats`` property has been removed.
* ``Tool`` dimensions may not only be specified with enum values.

New models for Scales
~~~~~~~~~~~~~~~~~~~~~

The following BokehJS classes have been moved and renamed:

============================== ==============================
Old                            New
============================== ==============================
``mappers/LinearMapper``       ``scales/LinearScale``
``mappers/LogMapper``          ``scales/LogScale``
``mappers/CategoricalMapper``  ``scales/CategoricalScale``
============================== ==============================

Previously, these Mapper classes were internal implementation details.
The new Scale classes are first-class Bokeh models and are accessible from
Python. This was done to facilitate future work supporting custom,
user-defined scales.

There is a new Plot validation check to ensure that Scales and Ranges on a
dimension are compatible. By default, ``Plot`` models are configured with
``LinearScale`` models which (along with ``LogScale`` models) are compatible
with ``Range1d`` and ``DataRange1d`` range models.

One inevitable breaking change is that users employing a ``FactorRange`` in
the ``bokeh.model`` API will have to specify a ``CategoricalScale`` on the same
dimension. For example:

.. code-block:: python

    plot = Plot()
    plot.x_range = DataRange1d()
    plot.y_range = FactorRange(["Mon", "Tues", "Wed", "Thurs", "Fri"])
    plot.y_scale = CategoricalScale()

The ``bokeh.plotting.figure`` function should this range and scale
compatibility handling automagically in most cases.

As part of this work, some BokehJS attributes were renamed to be consistent
with the new terminology:

============================== ==============================
Old                            New
============================== ==============================
``CartesianFrame.x_mappers``   ``CartesianFrame.xscales``
``CartesianFrame.y_mappers``   ``CartesianFrame.yscales``
``GlyphRenderer.xmapper``      ``GlyphRenderer.xscale``
``GlyphRenderer.ymapper``      ``GlyphRenderer.yscale``
============================== ==============================

Since these attributes may be present in user code (e.g CustomJS callbacks
or extensions), the old names will continue to work for some time, with a
deprecation warning in the JS console.

New signaling API
~~~~~~~~~~~~~~~~~

Previously BokehJS used Backbone events for communication between models.
As part of an ongoing migration to TypeScript, the Backbone dependency was
removed, and the relevant portion replaces with a minimal, type-safe API
for signaling.

This change primarily affects contributors working on BokehJS and writers of
extensions.

===================================== ==============================================
Old                                   New
===================================== ==============================================
``@listenTo(obj, 'change', fn)``      ``@connect(obj.change, fn)``
``@listenTo(obj, 'change:attr', fn)`` ``@connect(obj.properties.attr.change, fn)``
``obj.trigger('change', arg)``        ``obj.change.emit(arg)``
``obj.trigger('change:attr', arg)``   ``obj.properties.attr.change.emit(arg)``
===================================== ==============================================

Python Datetime handling
~~~~~~~~~~~~~~~~~~~~~~~~

Bokeh has not handled Python datetime values consistently with NumPy
``datetime64``. Bokeh aims to treat all datetime values "as-is", but in some
cases a local timezone conversion could affect Python datetime values. This
has been corrected. In case there is code that depends on the erroneous
behavior, please note that the new behavior is effective immediately and is
now maintained under test to be consistent with NumPy values. See the issue
:bokeh-issue:`5499` for more details.

Layout API and behaviour changes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Layout was previously handled on document level and there was one solver per
document. This was changed to one solver per root, so document isn't anymore
responsible for any layout related stuff. All logic and APIs were moved to
views, specifically to ``LayoutDOM``. For example, if your code relied on
``document.resize(width, height)``, then you should use ``view.resize(width, height)``,
where ``view`` is an associated view of any of ``document``'s root models.
Views can be obtained through ``Bokeh.index``. To resize all roots use

.. code-block:: javascript

    for (var key in Bokeh.index) {
        Bokeh.index[key].resize(width, height);
    }

.. _project roadmap: https://bokeh.org/roadmap
.. _release-0-10-0:

0.10.0
======

Bokeh ``0.10.0`` (Sep 2015) provides several new features such as WebGL support,
a new refactored and more powerful chart interface and responsive plots. Also
bugfixes and enhancements in our documentation, testing and build machinery,
and examples.

* Initial webgl support (check our new examples: maps city, iris blend, scatter 10K, clustering.py)
* New charts interface supporting aggregation (see our new Bars, BoxPlot, Histogram and Scatter examples)
* Responsive plots
* Lower-level jsresources & cssresources (allow more subtle uses of resources)
* Several test machinery fixes
* Several build machinery enhancements
* More pytest-related fixes and enhancements
* More docs fixes and enhancements
* Now the glyph methods return the glyph renderer (not the plot)
* Gmap points moves consistently
* Added alpha control for imageurl objects
* Removed python33 testing and packaging
* Removed multiuserblazeserver

.. _release-0-10-0-migration:

`Migration Guide <releases.html#release-0-10-0-migration>`__
------------------------------------------------------------

This release introduced a new, often requested style of chart interface that
is centered around Pandas DataFrames.  All of "old style" charts in the
``bokeh.charts`` interface have been moved to ``bokeh._legacy_charts``,
which  will eventually be removed, when all charts have been updated.
To continue to use the old charts, replace``bokeh.charts`` with
``bokeh._legacy_charts``, e.g.:

.. code-block:: python

    from bokeh.charts import Area

becomes

.. code-block:: python

    from bokeh._legacy_charts import Area
.. _release-0-12-7:

0.12.7
======

Bokeh Version ``0.12.7`` (Aug 2017) is an incremental update that adds a few
important features and fixes several bugs. Some of the highlights include:

* Support graphs/trees/networks (:bokeh-issue:`187`) including configurable
  and extendable policies for highlighting and selection.
* Filterable/Sliceable CDS views (:bokeh-issue:`4070`)
* Pass HTTP request args to embedded sessions (:bokeh-issue:`5992`)
* New :class:`~bokeh.models.expressions.Expression` models for client-side
  computations, including :class:`~bokeh.models.expressions.Stack`, for
  stacking CDS columns.
* New module :ref:`bokeh.transform` with helper functions for simplifying
  ``DataSpec`` expressions, including  :func:`~bokeh.transform.jitter`,
  :func:`~bokeh.transform.dodge`, :func:`~bokeh.transform.factor_cmap`, etc.
* Added :func:`~bokeh.plotting.figure.hbar_stack` and
  :func:`~bokeh.plotting.figure.vbar_stack` to greatly simplify
  creation of stacked bar charts.
* Improvements for using Bokeh with Categorical data:

  - Support multi-level categories and hierarchical axes
  - Arbitrary limits on category names (e.g. no ``':'``) have been lifted
  - Optional Pandas integration creates CDS from directly from ``GroupBy``
    objects
  - Categorical Bar, Heatmap and Scatter plots easier to create with stable
    ``bokeh.plotting`` APIs
  - New User's Guide chapter :ref:`userguide_categorical`

 Many other small bugfixes and docs additions. For full details see the
 :bokeh-tree:`CHANGELOG`.

.. _release-0-12-7-migration:

`Migration Guide <releases.html#release-0-12-7-migration>`__
------------------------------------------------------------

Breakage Related to Categoricals Overhaul
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Bokeh support for Categorical data has needed attention for some time.
The release brings improvements that *dramatically* improve the user
experience when using categorical data with Bokeh. For details and
examples, see the new User's Guide chapter :ref:`userguide_categorical`.

At this point we endeavor to minimize breakage, and to provide managed
deprecation cycles when things must change. However, in this instance,
some minor *immediate* breaking changes were unavoidable:

* ``min_interval`` and ``max_interval`` on ``FactorRange`` are now
  given in synthetic coordinate units.

* ``bounds`` on ``FactorRange`` are now given in synthetic coordinate
  units.

New Embed Functions for Bokeh Applications
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Two new embed functions similar to ``autoload_server`` are added, that have
simpler APIs and are more focused:

* :func:`bokeh.embed.server_document` for embedding new sessions for entire
  Bokeh documents in HTML pages. (More common)

* :func:`bokeh.embed.server_session` for embedding existing sessions for
  specified Bokeh models in HTML pages (Less common)

Additionally, with these new methods one may choose to not load the JS/CSS
resource files by passing ``resources="none"`` as a parameter.

Deprecations Removed
~~~~~~~~~~~~~~~~~~~~

The following previously deprecated modules or features have been removed:

* ``bokeh.icons`` module

* Legacy anchor and legend locations ``left_center`` and ``right_center``

* ``ImageRGBA.rows`` and ``ImageRGBA.cols`` properties

* ``HBox`` and ``VBox`` in ``bokeh.layouts``

* ``validate`` keyword argument for ``bokeh.io.save``

New Deprecations
~~~~~~~~~~~~~~~~

``bokeh.embed.autoload_server`` has been deprecated and replaced with the
two simpler functions :func:`~bokeh.embed.server_document` and
:func:`~bokeh.embed.server_session` described above.

``bokeh.models.tools.tool_events`` has been deprecated. Users should instead
use the ``SelectionGeometry`` event present on ``Plot`` or ``figure``.

``DynamicImageRenderer`` and ``Plot.add_dynamic_image`` have been deprecated.
For GIS-related use-cases built on top of Bokeh, consider using
GeoViews_, or creating a `Custom Extension`_.

``ResizeTool`` is deprecated and also *immediately* is a NO-OP on the Python
side. ``ResizeTool`` has been removed from BokehJS entirely.

BokehJS Widgets Bundle Split
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The `bokeh-widgets` bundle was split into ``bokeh-widgets`` and
``bokeh-tables``. This is to reduce the weight of the main widgets' bundle.
Bokeh includes ``bokeh-tables`` automatically when necessary, so this change
should be transparent for most users. However, users of custom templates or
other advanced embedding scenarios (including the use of ``components``) may
be affected. In short, if your application is responsible for loading Bokeh
resources, then it should take care of loading the ``bokeh-tables`` as well.

TapTool Callback Calling Convention
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The TapTool strayed from usual callback calling convention by passing a glyph
data source as ``cb_obj``. This has been rectified, and now the tool follows the
usual convention: the tool itself is passed as ``cb_obj`` and the data source is
passed as part of the optional ``cb_data``. Existing usage of ``OpenURL`` is
unaffected by this change, but any ``CustomJS`` callbacks used with the tap tool
will need to be updated to reflect this change.

DataTable Selection Highlighting Signal
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The DataTable now responds to the signal ``source.change.emit()``, instead of
``source.properties.selected.change.emit()``, to visually highlight the rows in the
DataTable that are part of the selection. If you have used
``source.properties.selected.change.emit()`` in CustomJS code, you will need to
change it to ``source.change.emit()``.

The DataTable responds automatically to changes in its data source's ``selected``
property. However, because of Bokeh's change detection machinery, only a replacement
of the ``selected`` property causes a change signal to be emitted, and not a partial update
(e.g. ``source.selected['1d']['indices'] = [1, 2]``). If you use a partial update in CustomJS
code, you will need to emit the change signal yourself:

.. code-block:: python

    customjs = CustomJS(args=dict(source=source), code="""
        source['selected']['1d'].indices = [1, 2]
        source.change.emit();
    """)

Refactoring of ``bokeh.server`` contents
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The ``bokeh.server`` module was refactored in order to be easier to document
and maintain, as well as simpler for user's to use in more sophisticated use
cases. These changes are not expected to impact standard usage of Bokeh in any
way:

* All protocol-related code was moved to a new module ``bokeh.protocol``

* The ``Server`` class was split into ``Server`` (no API changes) and a new
  ``BaseServer`` that can be used when explicit coordination of low level
  Tornado components is required.

* Missing sections added to reference guide, and docsctring coverage greatly
  expanded.

* Old cruft code to handle Tornado < 4.3 (which is no longer supported) was
  removed.

.. _Custom Extension: https://docs.bokeh.org/en/latest/docs/user_guide/extensions.html
.. _GeoViews: http://geo.holoviews.org
.. _project roadmap: https://bokeh.org/roadmap
.. _release-2-0-0:

2.0.0
=====

Bokeh Version ``2.0.0`` (March 2020) is a major milestone of the Bokeh project.
This release cycle closed more than 180 issues. Highlights include:

* New, modern  ``MultiChoice`` widget added :bokeh-issue:`9532`
* BokehJS CDN resources are loaded with `SRI hashes`_ enabled :bokeh-issue:`8937`
* New ``DatePicker`` implementation with more features :bokeh-issue:`9509`, :bokeh-issue:`9494`, :bokeh-issue:`6728`, :bokeh-issue:`8917`
* Package relative imports work in directory-style Bokeh apps :bokeh-issue:`9545`
* App sessions now use an expirable token that is not visible in query arguments :bokeh-issue:`3458`
* Full HTTP header and cookies can be accessed by Bokeh app code :bokeh-issue:`9505`
* Reference documentation show inherited properties on all Bokeh models :bokeh-issue:`4966`
* IPyWidgets can be used in Bokeh applications, and Bokeh content can be put in IPyWidgets :bokeh-issue:`9590`
* Added tile providers for ESRI and OSM :bokeh-issue:`9560`

And several other bug fixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`.

.. _release-2-0-0-migration:

`Migration Guide <releases.html#release-2-0-0-migration>`__
-----------------------------------------------------------

Minimum Package Versions
~~~~~~~~~~~~~~~~~~~~~~~~

This release raises the minimum version for some packages

* Bokeh now requires Python 3.6 or higher.
* Bokeh now requires Numpy 1.11.3 or higher.
* The Bokeh server now requires Tornado 5.0 or higher.

Server Lifecycle Hooks
~~~~~~~~~~~~~~~~~~~~~~

Server lifecycle hooks should now goin in a file named ``app_hooks.py``, which
is also where new request hooks are to be defined. The previous module name
``server_lifecycle.py`` will continue to function, but is deprecated.

HoverTool Formatters Specification
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Previously, the ``formatters`` property accepted a CDS column name. For example
a formatter for a tooltip for ``"@foo`` could be specified with just ``"foo"``:

.. code-block:: python

    hover_tool.formatters = { "foo": "datetime"}   # BAD

Now, the full matching tooltip specification, including the ``"@"``, should
be used:

.. code-block:: python

    hover_tool.formatters = { "@foo": "datetime"}   # GOOD

This allows tooltip formatters to be used uniformly with both columns, as well
as "special variables", e.g. ``"$x"``.

Bokeh Sphinx Extension
~~~~~~~~~~~~~~~~~~~~~~

The obsolete Sphinx configuration parameters ``bokeh_plot_use_relative_paths``
and ``bokeh_plot_pyfile_include_dirs`` have been removed. The unused
``PLOT_PAGE`` template has also been removed.

PhantomJS usage retired
~~~~~~~~~~~~~~~~~~~~~~~

The deprecated and unsupported PhantomJS dependency is no longer used for
exporting Bokeh content. Bokeh will use Chromedriver by default, but can also
be configured to use Geckodriver.

"Use Strict" for CustomJS
~~~~~~~~~~~~~~~~~~~~~~~~~

The ``use_strict`` property has been removed from all models that it had been
on previously. All JavaScript code, e.g. for ``CustomJS`` will always be rendered
with ``"use_strict"`` added.

``require()`` in CustomJS
~~~~~~~~~~~~~~~~~~~~~~~~~

The ``require()`` function s not available from ``CustomJS`` anymore. It exposed
the underlying module system, which should not be used by general users. Use
APIs exposed on ``Bokeh`` object or (as a last resort), use ``Bokeh.require()``.

Bokeh Protocol Versioning
~~~~~~~~~~~~~~~~~~~~~~~~~

Bokeh wire protocol messages no longer express any revision, and URLs for
server sessions no longer specify ``"bokeh-protocol-version"``. It is assumed
any client and server communicating are the same release version (which has
always been true in any usage scenario).

Selection Dicts
~~~~~~~~~~~~~~~

The obsolete old-style selection dictionaries, i.e. ``selected['1d']`` have
been removed. Use ``selected.indices``, etc. only.

Immutable Palettes
~~~~~~~~~~~~~~~~~~

Previously, Bokeh used a complicated copy-on-access scheme to return palettes
as lists. The necessary "module hack" could confuse IDEs, complicated the docs
build process, and sometimes lead to unexpected behavior. All palettes are now
tuples, which is a simpler solution to the problem of mutable module attributes.

The main difference is that palettes can no longer be modified in place,
including reversing the palette. To reverse a palette, do:

.. code-block:: python

    list(reverse(pal))

Tile Providers
~~~~~~~~~~~~~~

The named tile properties in ``tile_providers.py``, e.g ``CARTODBPOSITRON`` now
return then vendor id for that tile provider. This is can be passed to the
``get_provider`` method directly to return a new ``TileProvider`` instance.

ColumnDataSource Properties
~~~~~~~~~~~~~~~~~~~~~~~~~~~

The ``ColumnDataSource.selected`` property is now read-only.

The ``ColumnDataSource.data`` property can only be set from plain Python dicts.
Attempting to set from another CDS, i.e ``s1.data = s2.data``, will raise an
error.

Date and Datetime Properties
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The ``Date`` property has been narrowed, in order to afford an unambiguous date
type in the form of an ISO date string. The ``Date`` type accepts ISO date
strings, and ``datetime.date`` objects.

As a result, the ``DatePicker`` widget no longer accepts datetime values or
timestamps. All values must be valid ``Date`` values.

The ``Datetime`` now accepts timestamps (milliseconds since epoch) directly.

Missing Renderers Warning
~~~~~~~~~~~~~~~~~~~~~~~~~

The ``W-1000 (MISSING_RENDERERS)`` validation warning will no longer trigger
for plots that have added annotations, even if no other glyphs are present.

UnitsSpec hierarchy
~~~~~~~~~~~~~~~~~~~

The ``UnitsSpec`` class is now a base class and is not useful ln its own. If you
were using ``UnitsSpec`` in an extension model, you should change to use the new
``PropertyUnitsSpec`` class, which affords the capability for adding separate
``*_units`` properties.

Broken Bokeh Commands
~~~~~~~~~~~~~~~~~~~~~

The command line utilities ``bokeh html``, ``bokeh png``, and ``bokeh svg`` were
early experimental tools that were never widely promoted. It was recently
discovered that they have been broken since version 1.0, indicating that they
are completely unused. To reduce codebase cruft, they have been removed.

BOKEH_VERSION
~~~~~~~~~~~~~

The previous environment variable BOKEH_VERSION that could be use to specify
which version of BokehJS should be loaded from CDN, has been renamed to
BOKEH_CDN_VERSION.

API Removals
~~~~~~~~~~~~

The following modules and functions were previously deprecated or were internal
and no longer needed:

``bokeh.client``
    Method ``ClientSession.loop_until_closed`` removed

``bokeh.io``
    Function ``create_webdriver`` removed, use ``webdriver_control`` instead.

``bokeh.models.callbacks``
    Methods ``CustomJS.from_py_func`` and ``CustomJS.from_coffeescript`` removed

``bokeh.models.filters``
    Methods ``CustomJSFilter.from_py_func`` and
    ``CustomJSFilter.from_coffeescript`` removed

``bokeh.models.formatters``
    Methods ``FuncTickFormatter.from_py_func`` and
    ``FuncTickFormatter.from_coffeescript`` removed

``bokeh.models.plots``
    Properties ``Plot.h_symmetry`` and ``Plot.v_symmetry`` removed

``bokeh.models.tools``
    Methods ``CustomJSHover.from_py_func`` and
    ``CustomJSHover.from_coffeescript`` removed

``bokeh.models.transforms``
    Methods ``CustomJSTransform.from_py_func`` and
    ``CustomJSTransform.from_coffeescript`` removed

``bokeh.models.widgets.buttons``
    Properties ``Dropdown.default_value``, ``Dropdown.value`` and
    ``AbstractButton.clicks`` removed.

``bokeh.models.widgets.sliders``
    ``callback``, ``callback_throttle``, and ``callback_policy`` removed from
    all sliders. Use ``value`` for continuous updates and ``value_throttled`` for
    updates only on mouseup

``bokeh.plotting.helpers``
    Entire module removed

``bokeh.protocol``
    Entire ``versions`` module removed, ``messages.register`` function removed

``bokeh.util.compiler``
    Class ``CoffeeScript`` and related code removed

``bokeh.util.future``
    Entire module removed

``bokeh.util.string``
    Functions ``encode_utf8``, ``decode_utf8``, and ``escape`` removed

Additionally, the ``callback`` property is removed from all Bokeh models except
``CustomAction``, ``HoverTool`` ``TapTool``, and ``OpenURL``. Instead, the more
general ``js_on_change`` or ``js_on_event`` methods should be used.

API Deprecations
~~~~~~~~~~~~~~~~

The following new deprecations are effective:

* ``bokeh.layouts.WidgetBox`` is deprecated use ``bokeh.layouts.Column``
  instead.

* Importing ``from_networkx`` from ``bokeh.models.graphs`` is deprecated. Import
  from ``bokeh.plotting`` instead.

.. _SRI hashes: https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity
.. _release-1-4-0:

1.4.0
=====

Bokeh Version ``1.4.0`` (October 2019) is a significant release that marks the
end of support for Python 2.7 and Python 3.5 and earlier.

*Starting with the next release, Bokeh 2.0, Python 3.6 or later will be required.*

This release includes several important fixes and features:

* Complete new site design for documentation, including search  :bokeh-issue:`8209`
* Jupyterlab ipywidgets integrations  :bokeh-issue:`9137`
* Security related improvements to the Bokeh server   :bokeh-issue:`9139`, :bokeh-issue:`9140`
* New integration added fot Django Channels   :bokeh-issue:`9009`
* Precompiled Bokeh extensions   :bokeh-issue:`9196`
* Legend improvements  :bokeh-issue:`9135`,  :bokeh-issue:`9144`

And several other bug fixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`. :bokeh-issue:`8676`

.. _release-1-4-0-migration:

`Migration Guide <releases.html#release-1-4-0-migration>`__
-----------------------------------------------------------

Deprecations
~~~~~~~~~~~~

The overburdened ``legend`` keyword argument to glyph methods is deprecated. It
is replaced with three purpose-specific keyword arguments:

* ``legend_label="some_label"``

    This will always produce a legend item with exactly the given label.

* ``legend_field="some_colname"``

    This will produce a "grouped" legend, where the grouping is done by
    JavaScript in the browser. Python code will only see a single legend item
    representing the grouping.

* ``legend_group="some_colname"``

    This will produce a "grouped" legend, where the grouping is done by *Python*
    code, bedore the content is rendered in the browser. Python code will see
    individual legend items for each group.

These keywords remove the ambiguities due to the "automagic" operation of
``legend`` with respect to legend grouping. The existing ``legend`` keyword
argument will continue to function until at least version 3.0 of Bokeh.
.. _release-0-4-2:

0.4.2
=====

Bokeh ``0.4.2`` (Mar 2014) is a minor release:

* Improved MPL interface, PolyCollection plus examples
* Extensive tutorial with exercises and solutions
* %bokeh magic for IPython notebook
* InMemory storage backend for bokeh-server (usable without Redis)
.. _release-2-3-3:

2.3.3
=====

Bokeh Version ``2.3.3`` (Jul 2021) is a patch-release that fixes some
layout and extension related bugs:

* Column ignores css class scrollable (:bokeh-issue:`11083`)
* Bad formatting of y axis labels with theme (:bokeh-issue:`11110`)
* Layout regression in panel (:bokeh-issue:`11123`)
* Div model layout differences (:bokeh-issue:`11161`)
* Active tab should be in view on render (:bokeh-issue:`11284`)
* Plot's height can not go below 600px (:bokeh-issue:`11344`)
* Dropdown menu is hidden in multi choice (:bokeh-issue:`11365`)
* Extensions should fetch exact version from CDN (:bokeh-issue:`11380`)

As well as other very minor docs, build, and bugfix updates.

For full details see the :bokeh-tree:`CHANGELOG`.
.. _release-0-13-0:

0.13.0
======

Bokeh Version ``0.13.0`` (June 2018) is an incremental update that adds a few
new features and fixes several bugs. Some of the highlights include:

* Improved hover tool fields for common stacked bar plot cases
* New ``CumSum`` transform to generate values from cumulative sums
  of CDS columns on the client side.

And several other bug fixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`.

.. _release-0-13-0-migration:

`Migration Guide <releases.html#release-0-13-0-migration>`__
------------------------------------------------------------

NOTE: the 0.13.x series is a final series of small releases leading to a
1.0 release. For more information see the `project roadmap`_.

Max Websocket Message Size
~~~~~~~~~~~~~~~~~~~~~~~~~~

A new command line option ``--websocket-max-message-size`` for the Bokeh
server can be used to configure the Tornado ``websocket_max_message_size``
option. The default value is now 20mb, an increase from the previous
10mb implicit default.

New Hover fields
~~~~~~~~~~~~~~~~

Two new hover tooltip fields are now available:

* ``$name`` will preint the value of the ``name`` property of a glyph that
  is being hovered over.

* ``@$name`` will look up values from a column like a normal ``@`` field,
  but will use ``$name`` as the name of the column.

Both of these are especially useful in conjunction with stacked bar plots.

BokehJS Build
~~~~~~~~~~~~~

The ``gulp`` tool was previously used as the build system for BokehJS. This
has been replaced with a smaller and simpler build script. This greatly
reduced the number of dependencies required to build BokehJS and a completely
clean NPM package security audit was obtained as a side effect.

To build now, run the command ``node make build`` instead of ``gulp build``.
Task names remained unchanged. If you want preserve the old workflow, e.g. to
aid ``git bisect``, it is suggested to create an alias for ``node make``,
e.g. in bash this would be ``alias gulp='node make'``.

Line Join Default
~~~~~~~~~~~~~~~~~

The default ``line_join`` style has been changed from ``miter`` to ``bevel``,
to avoid exaggerating corners where connected lines meet at a sharp angle.
The HTML Canvas ``miterLimit`` property is meant to prevent such issues,
but it does not appear to be respected by current browsers.

.. _project roadmap: https://bokeh.org/roadmap
.. _release-1-3-0:

1.3.0
=====

Bokeh Version ``1.3.0`` (Jul 2019) is a point release that adds some
interesting new features:

* ``FileInput`` widget added :bokeh-issue:`6096`
* New DataCube widget affords groups and aggregations of tabular data :bokeh-issue:`8100`
* ``TextInput`` widget now has a new per-keystroke capability. :bokeh-issue:`8676`
* Can now set ``source.data`` directly from DataFrames :bokeh-issue:`9052`

And several other bug fixes and docs additions. For more details see the
:bokeh-tree:`CHANGELOG` or the `blog announcement`_.

.. _blog announcement: https://medium.com/bokeh/bokeh-1-3-0-released-cca6b7af20ef
.. _release-0-9-1:

0.9.1
=====

Bokeh ``0.9.1`` (Jul 2015) focused on extending Bokeh's new callback system by
adding more places where callbacks can be used, expanding and improving the
new User's Guide, exposing better ways to embed Bokeh plots and widgets into
your own layouts, and providing validation error and warning feedback to
diagnose problems.

* New callbacks options for hover, selection, and range updates
* Documentation for widgets and new callbacks in the User's Guide
* Much more flexible embed.components that can embed multiple objects
* Implemented a validation framework to provide errors and warnings
* More than 30 smaller bugfixes
.. _release-2-1-1:

2.1.1
=====

Bokeh Version ``2.1.1`` (June 2020) is a patch-release that fixes some bugs:

* Can't resolve styles when importing BokehJS (:bokeh-issue:`10172`)
* Bokeh server fails to start correctly with random port (:bokeh-issue:`10175`)
* Some scalar properties seralizing incorrectly (:bokeh-issue:`10181`, :bokeh-issue:`10197`)
* Typed arrays not returned to Bokeh server as lists (:bokeh-issue:`10204`)

For full details see the :bokeh-tree:`CHANGELOG`.
.. _release-2-4-2:

2.4.2
=====

Bokeh Version ``2.4.2`` (Nov 2021) is a patch-release that fixes a number of minor bugs/regressions and build issues.

* DeserializationError when trying to change a DataTable's columns with CustomJS (:bokeh-issue:`11422`)
* Clarify use of color in first steps guide (:bokeh-issue:`11761`)
* Fix transform jitter example (:bokeh-issue:`11781`)
* Add OS to bokeh info  (:bokeh-issue:`11797`)
* DeserializationError when plotting graphs (:bokeh-issue:`11800`)
* Log axis figures don't render if they're not visible at start (:bokeh-issue:`11801`)
* Work around issues with initialization-time change discovery (:bokeh-issue:`11807`)
* Don't unnecessarily update node/edge renderers in graphs (:bokeh-issue:`11808`)
* Update docs for new issue forms (:bokeh-issue:`11810`)

As well as other very minor docs, build, and bugfix updates.

For full details see the :bokeh-tree:`CHANGELOG`.
.. _release-2-2-0:

2.2.0
=====

Bokeh Version ``2.2.0`` (Aug 2020) is a minor-release that focused with
substantial improvements to performance, SVG export, and DataTable.

* Improvements to ``DataTable`` styling and functionality (:bokeh-issue:`6864`, :bokeh-issue:`8595`, :bokeh-issue:`10251`, :bokeh-issue:`10353`, :bokeh-issue:`10363`, :bokeh-issue:`10374`, :bokeh-issue:`10416`)
* Improvements and fixes to SVG rendering  (:bokeh-issue:`6775`, :bokeh-issue:`8046`, :bokeh-issue:`8446`, :bokeh-issue:`8744`, :bokeh-issue:`9001`, :bokeh-issue:`9169`, :bokeh-issue:`9213`, :bokeh-issue:`9551`, :bokeh-issue:`10273`, :bokeh-issue:`10305`)
* Memory and Performance improvements (:bokeh-issue:`10162`, :bokeh-issue:`10176`, :bokeh-issue:`10225`, :bokeh-issue:`10226`, :bokeh-issue:`10234`, :bokeh-issue:`10235`, :bokeh-issue:`10272`, :bokeh-issue:`10384`)
* Fixes for properties not triggering updates (:bokeh-issue:`9436`, :bokeh-issue:`10147`, :bokeh-issue:`10215`, :bokeh-issue:`10247`)
* Fix over-quoting problem with ``components`` API (:bokeh-issue:`10271`)
* Support save to clipboard on supported browsers (:bokeh-issue:`10066`)
* Ensure auth hooks apply to Websocket updgrade in addition to HTTPS connection (:bokeh-issue:`10316`)
* Add a new ``DocumentReady`` event usable in Bokeh server apps (:bokeh-issue:`10265`)

And several other bug fixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`.

.. _release-2-2-0-migration:

`Migration Guide <releases.html#release-2-2-0-migration>`__
-----------------------------------------------------------

Oval glyph deprecated
~~~~~~~~~~~~~~~~~~~~~

The ``Oval`` glyph is largely duplicative of the ellipse glyph, and will be
removed in version 3.0. Use ``Ellipse`` instead.

``Tooltip.inner_only`` deprecated
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

This property was non-functional an unnecessary and has been removed. No
replacement is provided.

``scenterx`` and ``scentery`` deprecated
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Previosuly, glyphs could implement separate ``scenterx`` and ``scentery`` to
report a "center" location that could anchor hovers. These have been combined in
to a single ``Glyph.scenterxy()`` method that should be implemented instead.
(This change is only relevant if you are implementing a new glyph in Bokeh or in
a custom extension.)

Implement ``Renderer._render`` instead of ``Renderer.render``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Renderers must implement abstract method ``_render`` instead ``render``, which is
now "final". This breaking change affects only extension developers.
.. _release-0-12-3:

0.12.3
======

Bokeh Version ``0.12.3`` (Oct 2016) is a minor, incremental update that adds
a few new small features and fixes several bugs. Some of the highlights include:

* BokehJS reduced in size by nearly twenty percent
* New Categorical color mapper
* Tap tool and tooltips working for VBar and HBar
* Better hover tool support for some Charts
* Auto-generate legends from data in a column
* Many small bugfixes

.. _release-0-12-3-migration:

`Migration Guide <releases.html#release-0-12-3-migration>`__
------------------------------------------------------------

As the project approaches a 1.0 release, it is necessary to make some changes
to bring interfaces and functionality up to a point that can be maintained
long-term. We try to limit such changes as much as possible, and have a
period of deprecation.

Specifying Font Sizes
'''''''''''''''''''''

Setting text font size properties directly as strings (e.g. ``font_size="13px"``)
has been UN-DEPRECATED. This usage will continue to work, without any further
deprecation warning. (https://github.com/bokeh/bokeh/pull/5274)


output_server
'''''''''''''

The ``output_server`` function is deprecated and will be removed in the near
future. Use ``bokeh.client`` functions such as ``push_session`` instead.
(https://github.com/bokeh/bokeh/pull/5225)

Glyph Methods and Data Sources
''''''''''''''''''''''''''''''

It is now deprecated to supply both sequence literals and an explicit source
to glyph methods. For example:

.. code-block:: python

    p.circle([1,2,3], y='foo', source=source)  # BAD

Either provide only sequence literals, e.g:

.. code-block:: python

    p.circle([1,2,3], y=[4,5,6])

or put all data into the explicitly provided source, e.g:

.. code-block:: python

    p.circle(x='foo, y='foo', source=source)

The older usage will continue to function for some time with a deprecation
warning, and will result in an error in a future release.
(https://github.com/bokeh/bokeh/pull/5187)

FuncTickFormatter
'''''''''''''''''

`FuncTickFormatter` instances using JavaScript or CoffeeScript now require
code snippets (i.e., function bodies) instead of full function definitions.
Additionally, these formatters now accept Bokeh models as arguments so that
the models can be readily available to the formatter function code.
(https://github.com/bokeh/bokeh/pull/4659/files)

Legend
''''''

Several legend properties had duplicative ``legend_`` prefixes. The following
property names have been changed:

================== =================
old property name  new property name
================== =================
``legend_margin``  ``margin``
``legend_padding`` ``padding``
``legend_spacing`` ``spacing``
================== =================

The old property names will continue to work for some time with a deprecation
warning.

Additionally, the ``legends`` property of Legend has been renamed to ``items``,
and given a new type. The new type now accepts a list of ``LegendItem models``,
instead of a list of tuples. The previous format is still accepted for
convenience and compatibility and values are converted automatically. The
``legends`` property  will also continue to work for some time with a
deprecation warning.(https://github.com/bokeh/bokeh/pull/5229)

Dimensions
''''''''''

Specifying dimensions for tools has changed. The ``'x'`` and ``'y'`` aliases
for ``'width'`` and ``'height'`` have been **immediately removed**.
Additionally, instead of ``List(Enum(Dimension)``, dimensions are now specified
more simply as ``Enum(Dimension)`` with valid values ``"width"``, ``"height"``,
and ``"both"``. The previous format will continue to work for some time and be
converted automatically with a deprecation warning.
(https://github.com/bokeh/bokeh/pull/5225)


BokehJS Notes
'''''''''''''

* The BokehJS codebase organization has been cleaned up. The file
  ``common/hittest.coffee`` has been moved to ``core/hittest.coffee``. Other
  files that are unlikely to be used directly by users have also been moved.
  (https://github.com/bokeh/bokeh/pull/5266)


* The BokehJS class ``GlyphView`` no longer inherits from ``Renderer.View``,
  it now subclasses ``BokehView``. (https://github.com/bokeh/bokeh/pull/5189)


* The BokehJS palettes are now only available in the ``bokeh-api.js`` bundle,
  and not in ``bokeh.[min].js`` (https://github.com/bokeh/bokeh/pull/5183)


* The BokehJS bundle ``bokeh-compiler.js`` has been removed completely. All
  Coffeescript code (for extension modules, etc.) is now pre-compiled by the
  Bokeh Python library. (https://github.com/bokeh/bokeh/pull/4946)
.. _release-2-1-0:

2.1.0
=====

Bokeh Version ``2.1.0`` (June 2020) is a minor-release.

* New scatter marker types (:bokeh-issue:`9863`, :bokeh-issue:`9890`)
* Performance improvements (:bokeh-issue:`9515`, :bokeh-issue:`10006`, :bokeh-issue:`10021`, :bokeh-issue:`10072`)
* ``push_notebook`` fixed for Google Colaboratory (:bokeh-issue:`9302`)
* Tools fixes and features (:bokeh-issue:`4567`, :bokeh-issue:`9909`, :bokeh-issue:`9959`, :bokeh-issue:`9963`, :bokeh-issue:`10107`, :bokeh-issue:`10085`)
* Fix "Themed glyphs not applying" (:bokeh-issue:`6821`)

And several other bug fixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`.

.. _release-2-1-0-migration:

`Migration Guide <releases.html#release-2-1-0-migration>`__
-----------------------------------------------------------

Minimum Tornado Version
~~~~~~~~~~~~~~~~~~~~~~~

The minimum torndado version is now 5.1.

``render_mode`` deprecated
~~~~~~~~~~~~~~~~~~~~~~~~~~

Tool overlays are now implemented efficiently on the HTML5 canvas without any
separate CSS rendering codepath. This makes the ``render_mode`` property
obsolete. Accordingly, ``render_mode`` is deprecated (and ignored) everywhere
it currently appears, and will be removed entirely for Bokeh 3.0 in the future.
.. _release-0-12-0:

0.12.0
======

Bokeh Version ``0.12.0`` (Jun 2016) is a large release with many new
improvements:

* Responsive layout and styling improvements throughout
* BokehJS plotting and charts APIs for pure JS dev
* Legends can be placed outside / next to the central plot area
* Expanded WebGL support to all markers, fixed webgl bugs
* New color palettes: Viridis, Magma, Inferno, and Plasma
* New model types:

  - Arrow, Title, and Label annotations
  - LogColorMapper for scaled color mapping
  - FuncTickFormatter for simpler custom ticking

* Support for computed transforms (e.g. Jitter) on data columns
* Documentation improvements:

  - re-done user gude sections for layout
  - new user guide sections for JS APIs
  - new user guide sections for custom extensions

* Server features:

  - unlocked callbacks for use with threads
  - "--num-threads" option for simpler deployment
  - new index landing page listing installed aps

* UX improvements

  - toolbar moved to the right, and made sticky, by default
  - left aligned title, closer in, by default
  - smaller, italic axes labels

* New hosted demos at https://demo.bokeh.org
* Many small bug fixes

.. _release-0-12-0-migration:

`Migration Guide <releases.html#release-0-12-0-migration>`__
------------------------------------------------------------

Known Issues
~~~~~~~~~~~~

Currently the most reliable sizing modes for layouts are "fixed" and
"scale_width". Other modes may work, or may produce undesired effects.
Work on layout is still ongoing. Support for "mixes" sizing modes
will come in a future release. Additionally, the ``ResizeTool`` does
not function reliably with responsive layout, and will most likely
be deprecated in a future release.

Google Maps
~~~~~~~~~~~

Google has made a change to their terms of use for google maps, and
"effective immediately", ALL google maps API calls MUST have an API key,
or they will not function:

    http://googlegeodevelopers.blogspot.mx/2016/06/building-for-scale-updates-to-google.html

All Bokeh ``GMapPlot`` models must have their ``api_key`` property set,
or they will not function properly. PLEASE NOTE: all previously created
GMap plots from *any* previous version of Bokeh are affect by this TOS
change.

Examples
~~~~~~~~

All WebGL examples have been moved under ``examples/webgl``. The
``timeout.py`` and ``random_tiles`` app examples have been removed
in favor of new, better examples. Several examples of new layout
capability are under ``examples/howto/layout``.

BokehJS
~~~~~~~

The mechanism for declaring properties on BokehJS has changed, with the
addition of the ``@define``, ``@override`` and ``@internal`` methods.
This may affect existing custom extesnions. Until now, BokehJS details
were considered an internal implementation detail. In the future, more
attention will be given to BokehJS stability.

Deprecations and Compatibility
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The new layout work was a large undertaking. As a result, there are many
deprecations, including `hplot`, `vplot`, etc. Almost all old functions
will continue to function, while issuing deprecation  warnings. However,
there are newer functions that should be preferred. The most up-to-date
guidance for layout going forward is at:

    https://docs.bokeh.org/en/latest/docs/user_guide/layout.html

In most cases it was possible to move forward with a deprecation, for the
time being, but there are two small hard compatibility breaks that could
not be avoided:

``Plot.title``
''''''''''''''

This attribute is now a ``Title`` object. It is no longer possible to set, e.g.
``p.title = "some text"`` as a string value. Instead, you must do:

    p.title.text = "some_text"

It is still possible to pass the `title`` keyword argument a string value
to ``figure`` and Charts, as a convenience. Additionally all other title
related properties on ``Plot``, e.g ``title_text_color`` continue to work
for now, while issuing deprecation warnings.

``session.show``
''''''''''''''''

The ``ClientSession.show`` method must now be explicitly passed the thing to
be shown. It is no longer possible to call, e.g. ``session.show()`` without
a parameter. Instead, you must do:

    session.show(plot)
.. _release-0-6-0:

0.6.0
=====

Bokeh ``0.6.0`` (Sep 2014) is an incremental update:

* Abstract Rendering recipes for large data sets: isocontour, heatmap, hdalpha
* Improved, configurable tool bar for plots
* Full Python 3 support for bokeh-server
* Much expanded User Guide
* Support for multiple axes
* Plot object graph query interface
* New charts in bokeh.charts: TimeSeries and Categorical HeatMap
* Hit-testing for patch glyphs
.. _release-0-3-0:

0.3.0
=====

Bokeh ``0.3.0`` (Nov 2013) is a minor release:

* refactor bokehjs to use grunt for coffee build
* merge bokeh and bokehjs repositories
* various bug fixes
* additional and improved examples and docs
.. _release-0-8-1:

0.8.1
=====

Bokeh ``0.8.1``  (Feb 2015) is focused on stability, bug fixes and improved
documentation.

* Fixed HoverTool
* Fixed Abstract rendering implementation and docs
* Fixed chart gallery and docs
* Removed leftovers from the old plotting API implementation
* Some other minor docs fixes
.. _release-2-0-2:

2.0.2
=====

Bokeh Version ``2.0.2`` (April 2020) is a micro-release that fixes some bugs and
improves some small features. Highlights include:

* Allow multiple versions of BokehJS on a page :bokeh-issue:`9812`
* Cross-timezone issue with session token expiry :bokeh-issue:`9938`.
* Fix server resources with Django integration :bokeh-issue:`9724`
* Make `add_layout` update a figure :bokeh-issue:`8862`
* Precompiled extensions broken on Windows :bokeh-issue:`9900`
* BoxAnnotation ignores `fill_color=None` :bokeh-issue:`9877`
* A handful of documentation clarifications, corrections, and expansions

And several other bug fixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`.
.. _release-1-0-1:

1.0.1
=====

Bokeh Version ``1.0.1`` (October 2018) is a micro bugfix release.

Some of the highlights include:

* Small fixes for ``export_png`` (:bokeh-issue:`8362`, :bokeh-issue:`8374`)
* Better cleanup for ``DocumentLifeCycleHandler`` (:bokeh-issue:`8367`)
* Fix issue with oval, ellipse legends (:bokeh-issue:`8375`)
* Recognized CSS rgb(a) strings for colors (:bokeh-issue:`4096`)

For full details see the :bokeh-tree:`CHANGELOG`.
.. _release-1-1-0:

1.1.0
=====

Bokeh Version ``1.1.0`` (April 2019) is a significant release that primarily
addresses the layout system. More than 50 layout-related issues were closed,
addressing bugs, missing features, and performance. Other topics of this
release included:

* Hover tool fixes and features :bokeh-issue:`8742`, :bokeh-issue:`8668`, :bokeh-issue:`7991`
* Widget improvements :bokeh-issue:`7665`, :bokeh-issue:`8717`, :bokeh-issue:`6822`, :bokeh-issue:`6333`
* Sphinx extensions more generally useable :bokeh-issue:`5955`
* Notebook integration work :bokeh-issue:`8583`, :bokeh-issue:`8681`, :bokeh-issue:`8681`, :bokeh-issue:`8733`
* Live BokehJS examples added to docs :bokeh-issue:`8692`
* Improved DataTable performance :bokeh-issue:`8227`

And several other bug fixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`.

.. _release-1-1-0-migration:

`Migration Guide <releases.html#release-1-1-0-migration>`__
-----------------------------------------------------------

New in 1.1
~~~~~~~~~~

The ``js_link`` function was added to make it simpler to link two Bokeh model
properties together:

.. code:: python

    slider.js_link('value', r.glyph, 'radius')

See :ref:`userguide_interaction_linked_properties` for more information.

The ``Slider.value_as_date`` method was added to conveniently retrieve Slider
values as date objects when appropriate.

Deprecations
~~~~~~~~~~~~

The following features or APIs were deprecated in version 1.1 and will be
removed in a future 2.0 release:

* Support for CoffeeScript in ``CustomJS`` or custom extensions. Use JavaScript
  or Typescript instead.

* Support for ``ClientSession.loop_until_closed``. This function is intended
  to support testing only, and will be removed from the public API. Bokeh
  applications should be run directly on a Bokeh server.

* Support for "transpiling" Python code to JavaScript. All ``from_py_func``
  methods will be removed. Use JavaScript or Typescript instead.

Changes to bokeh.sphinxext
~~~~~~~~~~~~~~~~~~~~~~~~~~

In order to support a longer term goal of moving Bokeh docs to `ReadTheDocs`_,
some changes to the ``bokeh-plot`` Sphinx directive were necessary. These are:

* Plot script files are now always placed immediately adjacent to the document
  they are for, and loaded using relative URLs.

* The config values ``bokeh_plot_pyfile_include_dirs`` and
  ``bokeh_plot_use_relative_paths`` are no longer needed. Setting them will have
  no effect (but will not break existing builds). These config values will be
  removed in a future 2.0 release.

We believe that there are very few users of ``bokeh.sphinxext`` outside the
project itself, and that these changes will not cause any breakage for any of
those users. However, please reach out for support if any unforeseen issues arise.

.. _ReadTheDocs: https://readthedocs.org
.. _release-2-4-0:

2.4.0
=====

Bokeh Version ``2.4.0`` (September 2021) is a new minor-release level that
brings many updates. Some of the new feature work includes:

First support for LaTeX- and MathML-based Mathtext (axis labels, tick labels,
and Divs) over the course of several PRs: :bokeh-issue:`11466`,
:bokeh-issue:`11525`, :bokeh-issue:`11584`,  :bokeh-issue:`11585`. Look for
upcoming releases to extend support to titles, legends, and labels.

Other work in this cycle includes:

* Docs fixes and improvements
    - Contributor's guide refreshed :bokeh-issue:`11513`
    - ``pre-commit`` hooks added :bokeh-issue:`11442`
    - Reference guide improvements  :bokeh-issue:`9961`, :bokeh-issue:`11445`, :bokeh-issue:`11563`
    - Sampledata and gallery example data added :bokeh-issue:`9329`, :bokeh-issue:`11489`

* WebGL fixes and improvements
    - WebGL backend rewritten using ReGL :bokeh-issue:`10861`
    - Dashed line styles fixed :bokeh-issue:`10876`
    - Hatch patterns supported :bokeh-issue:`11159`
    - Markers and rects re-use buffers efficiently :bokeh-issue:`11343`
    - Implemented all marker types :bokeh-issue:`11098`

* SVG fixes and improvements
    - Fix line dash offset and hatch patterns :bokeh-issue:`11058`
    - Missing ellipse glyph added :bokeh-issue:`11404`
    - Clipping area problem fixed :bokeh-issue:`11551`

* Misc fixes and improvements
    - Labels can now be multi-line :bokeh-issue:`7317`
    - Individual legend items and table columns can be hidden :bokeh-issue:`9261`, :bokeh-issue:`11423`
    - Tab panels can be set to disabled :bokeh-issue:`10898`
    - Toolbar buttons respect tab ordering :bokeh-issue:`11266`
    - Radio button groups support vertical orientation :bokeh-issue:`11374`
    - New consolidated RangesUpdate event :bokeh-issue:`11095`
    - Output from json_items includes Bokeh version :bokeh-issue:`11146`

And several other bug fixes and docs additions. For full details, see the
:bokeh-tree:`CHANGELOG`.

.. _release-2-4-0-migration:

`Migration Guide <releases.html#release-2-4-0-migration>`__
-----------------------------------------------------------

Minimum Package Versions
~~~~~~~~~~~~~~~~~~~~~~~~

This release raises the minimum version for some packages

* Bokeh now requires Python 3.7 or higher.

Runtime dependencies
~~~~~~~~~~~~~~~~~~~~

Bokeh no longer requires the package ``python-dateutil``.

Bokeh can optionally use the package ``xyzservices`` for managing tile
source metadata.

Wikimedia Tile Provider
~~~~~~~~~~~~~~~~~~~~~~~

Wikimedia has restricted their tile service to only function with Wikimedia
domains, and no longer be publicly usable. Accordingly, the WIKIMEDIA tile
provider has been removed. Use any of the other tile providers instead.

Deprecations
~~~~~~~~~~~~

``ScreenDistanceSpec`` and ``DataDistanceSpec`` are deprecated, and now return
a ``SizeSpec``. Custom extensions using these should use ``SizeSpec`` instead.

``PropertyUnitsSpec`` is deprecated. Use ``UnitsSpec`` instead (this is unlikely
to impact any typical usage).

``bokeh.core.query`` functions no longer accept callables and/or context in
queries. This feature added unnecessary complication and was not used inside
the Bokeh codebase (or ever demonstrated in docs or examples).

``Document.delete_modules`` was deprecated and will be removed in the future.
Use ``Document.models.destroy`` instead.

Units Properties
~~~~~~~~~~~~~~~~

Units properties must now be configured with an ``units_enum`` that is an
``enumeration`` instead of a ``units_type`` that is an ``Enum`` property:

.. code:: python

    units_enum=SpatialUnits # use this

    units_type=Enum(SpatialUnits) # NOT this

This is only of potential interest to custom extensions.

Raw string paths in ``Image`` property
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Use ``pathlib.Path`` instead.

``gridplot(plot_width, plot_height)`` were deprecated
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Use ``width`` or ``height`` respectively instead.

``curstate().file`` is now a dataclass
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Previously it was a `dict`-based ad-hoc data structure. Replace key indexing
with attribute access.

``static init_ModelName(): void {}`` was deprecated
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Use new TypeScript 4.4 static blocks ``static {}`` instead. Support for static
``init_`` methods will be removed in bokeh 3.0. This change only affects model
providing extensions.
.. _release-3-0-0:

3.0.0
=====

Bokeh Version ``3.0.0`` () is a major milestone of Bokeh project.

* Official support for Python 3.7 was removed and for 3.10 added.
* Support added for favicon.ico files
* Initial import times reduced
* Support added for new selection policy NodesAndAdjacentNodes
* Plot.remove_tools() function added

.. _release-3-0-0-migration:

`Migration Guide`
-----------------

Additions
~~~~~~~~~

``Switch`` widget
.................

Provides a replacement for a checkbox input.

Removals
~~~~~~~~

``plot_width`` and ``plot_height``
..................................

These properties have been removed. Use standard ``width`` and ``height`` for
all layout-able models.

``AuthMixin``
.............

Class ``AuthMixin`` is replaced by ``AuthRequestHandler``, a sub-class of
``RequestHandler``.

``legend``
..........

The ``legend`` keyword argument to glyph methods has been removed. Use more
specific ``legend_label``, ``legend_group``, and ``legend_field`` instead.

``Oval``
........

The ``Oval``glyph is removed. Use ``Ellipse`` instead.

``GridSpec``
............

This model has been removed with no replacement.q

``names`` properties
....................

Some models could be configured with both a ``names`` property and a
``renderers`` property. In all cases, ``names`` has been removed. Use the
``renderers`` property to specify renderers.

``WidgetBox``
.............

The ``WidgetBox`` model and associated convenience function ``widgetbox`` have
been removed. Use row, column, and grid layouts instead.

Markers
.......

Individual scatter markers, e.g ``Square``, ``DiamondX`` have been removed,
along with their related glyph methods. Use ``Scatter`` and ``figure.scatter``
instead.

``bokeh.util.session_id``
.........................

This module has been removed. Use ``bokeh.util.token`` instead.

``WebSource``
.............

This model has been removed, use ``WebDataSource`` instead.

``from_networkx``
.................

The ``from_networkx`` function is now only available to import from
``bokeh.plotting``.

Distance Specs
..............

``ScreenDistanceSpec`` and ``DataDistanceSpec`` are removed. Use ``SizeSpec``
instead.

``EditTool.custom_icon`` was replaced with ``Tool.icon``
........................................................

Use ``Tool.icon`` property instead.

``render_mode``
...............

``render_mode`` was removed from all annotations. Annotations were cleanly
separated between those which render to canvas and those that use HTML and CSS.
The default is canvas rendering. Use the new ``HTMLTitle``, ``HTMLLabel`` and
``HTMLLabelSet`` models whenever previously ``css`` render mode was used. Note
that ``Span`` and ``BoxAnnotation`` don't have a HTML equivalent anymore.

``FuncTickFormatter``
.....................

``FuncTickFormatter`` has been renamed to ``CustomJSTickFormatter``.

``HasProps.__subtype__``
........................

Explicit sub-typing support was removed both from models and the protocol.
If you want to extend existing models without the need for providing an
implementation, then use data models (e.g. extend from ``DataModel``).

``CDSView.source``
..................

``CDSView`` now implicitly uses the source provided by a glyph renderer it
as assigned to. Previously providing a data source in both a glyph renderer
and a source view was redundant.

``RadioGroup / CheckboxGroup on_click``
.......................................

``RadioGroup`` and ``CheckboxGroup`` no longer supports ``on_click`` event handlers.
Use ``on_change('active', cb)`` instead.

Renames
~~~~~~~

* ``copy_to_clipboard`` icon was renamed to ``copy``

Runtime dependencies
~~~~~~~~~~~~~~~~~~~~

Bokeh now requires the package ``xyzservices`` for managing tile
source metadata.

Deprecations
~~~~~~~~~~~~

``tile_providers`` module providing ``get_providers`` and ``Vendors`` is now deprecated.
Any tile specification (e.g. as string name) can be now passed directly to ``add_tile``
instead.

``on_click`` event handlers on button type widgets have been replaced with ``on_event``
using ``bokeh.events.ButtonClick`` ("button_click") as the event type.

API changes
~~~~~~~~~~~

``gridplot()`` now returns ``GridPlot`` models
..............................................

Previously ``gridplot()`` returned a combination of ``Row`` and ``Column`` layouts,
depending on the supplied arguments. Additionally, setting ``merge_tools`` now tells
grid plots to actually merge tools instead of hidding the toolbar. To hide a toolbar,
use ``toolbar_location=None``.

bokehjs changes
~~~~~~~~~~~~~~~

``figure.xaxis``, etc.
......................

``xaxis``, ``yaxis``, ``axis``, ``xgrid``, ``ygrid`` and ``grid`` attributes of
``figure`` now return a model proxy object, which mimics the behavior of bokeh's
plotting API. Arrays of axes/grids can be obtained using new ``xaxes``, ``yaxes``,
``axes``, ``xgrids``, ``ygrids`` and ``grids`` attributes.

Property changes push to server
...............................

Previously all changes were pushed to server, even if no actual changes were made.
Now only effective changes are pushed, which now maches the internal behavior of
bokehjs.

Deserialization code was split-off from ``Document``
....................................................

Now the purpose of ``Document`` is to manage models and deal with high-level
serialization concerns. Low-level handling was split-off into ``Deserializer``
class.

``HasProps.constructor``
........................

The ``constructor`` of ``HasProps`` has now two clearly defined code paths,
one for deferred and the other immediate initialization. The former is triggered
with ``new HasProps({id})`` syntax (it doesn't allow providing initial values)
and the later with ``new HasProps(attrs)``, where ``attrs`` can not have an
``id`` field. As a side effect, duplicating model's identity is not permitted
by default anymore, though one can still use deferred initializtion for this.

``init_ModelName`` was removed
..............................

This static initializer was added automatically by bokehjs' build system and
extensions' compiler. This isn't needed anymore as TypeScript supports ES2022
static initialization blocks (``static {}``).

Protocol changes
~~~~~~~~~~~~~~~~

Serialization of numbers
........................

Outside of ndarrays, nan, +inf and -inf are now systematically serialized as
``{"$type": "number", "value": "nan"}``, ``{"$type": "number", "value": "+inf"}``
and ``{"$type": "number", "value": "-inf"}`` respectively.

Other changes
~~~~~~~~~~~~~

``Minimum.initial`` and ``Maximum.initial``
...........................................

Thanks to added support for serialization of infinities, ``initial`` properties can
now have intrinsic default values (inifinity and minus infinity respectively) instead
of ``None`` / ``null``.

``gridplot()`` now returns ``GridPlot`` models
..............................................

See bokeh's API changes for details.
.. _release-1-3-2:

1.3.2
=====

Bokeh Version ``1.3.2`` (Aug 2019) is a micro-release to test changes to
build and release automation.
.. _release-0-1-0:

0.1.0
=====

Bokeh ``0.1.0`` (Apr 2013) is the initial public release of the Bokeh project:

* Basic low-level interface, consisting of wrapper objects for BokehJS rendering primitives, glyphs, tools
* Beginnings of the ggplot-style interface that wraps the low-level interface
* Simple line/scatter/bar/image plots with a Matplotlib-like interface
* Static HTML output
* Live server output
* IPython notebook embedding capability
* Table widget
* Pan, Zoom, Select, Resize tools
* initial Python implementation of Abstract Rendering
.. _release-0-9-0:

0.9.0
=====

Bokeh ``0.9.9`` (May 2015) provides sophisticated interactions in static plots
using a new Callback Action, a complete rewrite of the User guide and big
BokehJS refactoring switching to use browserify.

* Callback Action, serverless interactivity in static plots
* Hover inspection along lines
* Client side LOD downsampling for interactive tools
* Full User guide rewrite
* Reduce BokehJS boilerplate and switch to use browserify
* Several example bugfixes
.. _release-1-0-0:

1.0.0
=====

Bokeh Version ``1.0.0`` (October 2018) is a major milestone of the Bokeh project.

Some of the highlights include:

* Support for ``MultiPolygons`` with holes (:bokeh-issue:`2321`)
* Fixes and improvements to `DataTable` (:bokeh-issue:`6454`, :bokeh-issue:`7116`, :bokeh-issue:`7417`, :bokeh-issue:`8021`, :bokeh-issue:`8040`, :bokeh-issue:`8050`, :bokeh-issue:`8201`)
* ``CustomAction`` for user-defined Toolbar buttons (:bokeh-issue:`8099`)
* Plain JSON export/embed functions (:bokeh-issue:`5231`)
* Toolbar ``autohide`` property to hide toolbars when not in us(:bokeh-issue:`8284`)
* Callback to allow ``AjaxDataSource`` to adapt JSON responses (:bokeh-issue:`8321`)
* ``Scatter`` glyph for parameterizable marker type (:bokeh-issue:`5884`)
* Reuse webdrivers for faster PNG/SVG export by default (:bokeh-issue:`8329`)
* Improved testing capabilities (:bokeh-issue:`2596`, :bokeh-issue:`8078`, :bokeh-issue:`8139`, :bokeh-issue:`8146`, :bokeh-issue:`8217`, :bokeh-issue:`8225`)
* Faster import times (:bokeh-issue:`8309`)

And several other bug fixes and docs additions. For full details see the
:bokeh-tree:`CHANGELOG`.

.. _release-1-0-0-migration:

`Migration Guide <releases.html#release-1-0-0-migration>`__
-----------------------------------------------------------

Handling of Selections
~~~~~~~~~~~~~~~~~~~~~~

Previous versions of Bokeh mistakenly had code paths that could replace data
source ``Selection`` objects with entirely new instances. This was a mistake,
and resulted in several regressions and other problems. Unfortunately, the
problem persisted for a few releases, and now that the situation has been fixed,
it will require some code changes for some users to adapt to correct usage.

In general, you should NOT ever listen for a change of selections objects
themselves, i.e. do not do this (anymore):

.. code-block:: python

    source.on_change('selected', callback)  # BAD, DON'T DO THIS

Instead, you should listen for changes to the individual properties that are on
``Selection`` objects. For instance, to execute a callback when the ``indices``
on a selection change, (e.g. when a selection is made on a scatter plot), do
this:

.. code-block:: python

    source.selected.on_change('indices', callback)  # GOOD

Any code that looks like the first version above should be updated to use the
second version. This applies to both Python or JavaScript callbacks for
selections.

While this breaking incompatibility is regrettable, there are now much more
extensive integration tests in place to maintain that the second version will
always function as expected from now on.

New Dependencies
~~~~~~~~~~~~~~~~

"Pillow>=4.0" has been added to the list of Bokeh runtime dependencies.

Examples
~~~~~~~~

The following examples have been removed or updated:

* *app/pivot*: This large example was unfocused and unmaintained and has been
  removed
* *embed/simple*: Old example removed
* *howto/us_marriages_divorces*: Redundant notebook removed, script moved
  to *plotting/file/us_marriages_divorces_hover.py*
* *models/file/colorspec.py* Old example removed
* *models/file/external_resources.py* Moved to *latex_extension.py*
* *models/file/glyph1.py* Moved to *basic_plot.py*
* *models/file/grid.py* Old example removed
* *models/file/line.py* Old example removed
* *models/file/transform_jitter_coffee.py* Discouraged coffeescript example removed
* *plotting/file/bar_chart.py* Removed old/duplicative example
* *plotting/file/brewer.py*: Moved to *stacked_area.py*
* *plotting/file/bollinger.py* Old example removed
* *plotting/file/joyplot.py* Moved to *ridgeplot.py*

Pretty printing functions
~~~~~~~~~~~~~~~~~~~~~~~~~

The ``pprint`` and ``pretty`` methods depended on IPython pretty-printing
in order to function. Recent changes to IPython pretty-printing machinery
made it impossible to use unless the "pretty" repr was also enabled. This
caused ipython console to be spammed with very large amounts of output,
making it unusable. As a result, both ``pprint`` and ``pretty`` methods have
been removed. A "pretty" HTML repr still functions in Jupyter notebooks. This
change is not expected to affect any normal usage.

Bokeh Object IDs
~~~~~~~~~~~~~~~~

Previously Bokeh generated unique UUIDs for every Bokeh object. Starting with
this release, Bokeh generates simple increasing integer IDs by default. You can
set the environment variable ``BOKEH_SIMPLE_IDS=no`` to restore the previous
behavior. The generation of simple IDs is faster than UUIDs, otherwise this
change is not expected to affect any normal usage. However, if you are creating
Bokeh objects for a single Document in separate processes, i.e. by using the
``multiprocessing`` module, then you will want to turn off simple IDs. (This
is expected to be a rare and unusual usage.)

``bokeh.util.plot_utils``
~~~~~~~~~~~~~~~~~~~~~~~~~

The ``bokeh.util.plot_utils`` module has been removed. This module contained
only private functions used internally. This change is not expected to affect
any normal usage.

``bokeh.server.application_context``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The ``bokeh.server.application_context`` module has been renamed to
``bokeh.server.contexts``.  This change is not expected to affect any normal
usage.

``arguments`` parameter for ``server_session``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The ``server_session`` function accepted an ``arguments`` parameter that did not
(and could not) have any actual effect. It has been removed, immediately. Since
the parameter did not function, it is not expected that this change will affect
any normal usage.

Codebase Tests
~~~~~~~~~~~~~~

The Pytest "quality" mark has been changed to "codebase". Now to run the
codebase tests, execute ``pytest -m codebase``. If you have installed a
pre-commit hook to run quality tests before allowing a commit, the hook code
should be updated as above. This change is only expected to affect those who
are developing the Bokeh codebase.

.. _project roadmap: https://bokeh.org/roadmap
.. _release-0-9-3:

0.9.3
=====

Bokeh ``0.9.3`` (Aug 2015) provides several usability enhancements, better
docs, new examples, a lot of bug fixes and an improved testing machinery (using
pytest and selenium-based test).

* Support horizontal or vertical spans
* Provide raw_components version of bokeh.embed.components
* Prevent Bokeh from eating scroll events if wheel tool is not active
* bokeh.models.actions are now called bokeh.models.callbacks and Callback is now CustomJS
* Additional validation warnings
* Cleaned up gulp source mapping
* Fixes in our build machinery
* Cleaned up models section of the reference guide
* Use pytest instead of nose
* Beginning to add selenium tests
.. _release-0-5-0:

0.5.0
=====

Bokeh ``0.5.0`` (Jul 2014) adds the following features:

* Widgets
* Initial AR integration
* bokeh.charts (scatter, bar, histogram)
* improved embedding API
* minor ticks, plot frame, and log axes
.. _release-0-6-1:

0.6.1
=====

Bokeh ``0.6.1`` (Sep 2014) is a minor release.

* Toolbar enhancements
* bokeh-server fixes
* Improved documentation
* Button widgets
* Google map support in the Python side
* Code cleanup in the JS side and examples
* New examples
.. _userguide_concepts:

Defining key concepts
=====================

.. _userguide_glossary:

Glossary
--------

These are the most important concepts and terms that you will encounter
throughout Bokeh's documentation:

.. glossary::

    Annotation
        Visual aids that make reading the plot easier. This includes titles,
        legends, labels, or bands, for example. See :ref:`userguide_annotations`
        in the |user guide| for more information and examples.

    Application
        A Bokeh application is a recipe for generating Bokeh
        :term:`documents<Document>`. Typically, this is Python code run by a
        Bokeh :term:`server<Server>` whenever a new sessions is created.

    BokehJS
        The JavaScript client library that actually renders the visuals and
        handles the UI interactions for Bokeh :term:`plots<Plot>` and
        :term:`widgets<Widget>` in the browser. In most cases, Bokeh handles all
        interactions with BokehJS automatically ("We write the JavaScript, so you
        don't have to"). For more details, see the :ref:`contributor_guide_bokehjs`
        chapter of the |contributor guide|.

    Document
        An organizing data structure for Bokeh
        :term:`applications<Application>`. Documents contain all the Bokeh
        :term:`models<Model>` and data needed to render an interactive
        visualization or application in the browser.

    Embedding
        Various methods that help with including Bokeh :term:`plots<Plot>` and
        :term:`widgets<Widget>` in web apps, web pages, or Jupyter notebooks.
        See :ref:`userguide_embed` in the |user guide| for more details.

    Glyph
        API objects that draw vectorized graphics to represent data. Glyphs are
        the basic visual building blocks of Bokeh :term:`plots<Plot>`. This
        includes elements such as lines, rectangles, squares, wedges, or the
        circles of a scatter plot. The |plotting interface| provides a
        convenient way to create plots centered around glyphs. See
        :ref:`userguide_plotting` in the |user guide| for more information.

    Layout
        A collection of Bokeh objects. This can be several :term:`plots<Plot>`
        and :term:`widgets<Widget>`, arranged in nested rows and columns. See
        :ref:`userguide_layout` in the |user guide| for more information and
        examples.

    Model
        The lowest-level objects that Bokeh visualizations consist of. Bokeh's
        models are part of the |models interface|. Most users will not use this
        level of interface to assemble plots directly. However, ultimately all
        Bokeh plots consist of collections of models. It is helpful to
        understand them enough to configure their attributes and properties.
        See :ref:`userguide_styling` in the |user guide| for more
        information.

    Plot
        Containers that hold all the various objects (such as
        :term:`renderers<Renderer>`, :term:`glyphs<Glyph>`, or
        :term:`annotations<Annotation>`) of a visualization. The
        |plotting interface| provides the |figure| function to help with
        assembling all the necessary objects.

    Renderer
        General term for any method or function that draws elements of the plot.
        Examples of elements that are generated by renderers are
        :term:`glyphs<Glyph>` or :term:`annotations<Annotation>`.

    Server
        The Bokeh server is an optional component. You can use the Bokeh server
        to share and publish Bokeh plots and apps, to handle streaming of large
        data sets, or to enable complex user interactions based on
        :term:`widgets<Widget>` and selections. See :ref:`userguide_server` in
        the |user guide| for more information and examples.

    Widget
        User interface elements that are not directly part of a Bokeh
        :term:`plot<Plot>`, such as sliders, drop-down menus, or buttons. You
        can use events and data from widgets in your Python code, or you can
        use input from widgets to update you Bokeh plot itself. You can use
        widgets in standalone :term:`applications<Application>` or with the
        Bokeh :term:`server<Server>`. For examples and information, see
        :ref:`userguide_interaction` in the |user guide|.

.. _userguide_output_methods:

Output methods
--------------

Bokeh offers a variety of ways to produce interactive output. The following
two functions are the most common:

|output_file|
    Generate simple standalone HTML documents for Bokeh visualizations.

|output_notebook|
    Display Bokeh visualizations in Jupyter/Zeppelin notebooks.

These output functions are usually used together with |show| or |save|. Here's
an example:

.. code-block:: python

    from bokeh.plotting import figure, output_file, show

    output_file("output.html")

    p = figure()
    p.line(x=[1, 2, 3], y=[4,6,2])

    show(p)

This script generates an HTML file called ``output.html`` that contains a line
plot. You can execute it with ``python foo.py``, where ``foo.py`` is the name
of the script.

These functions are often useful in interactive settings or for creating
standalone Bokeh documents to serve from backend web applications.

Another way to generate various kinds of output is by using Bokeh's powerful
:ref:`command line tool <userguide_cli>`.

.. _userguide_settings:

Bokeh settings
--------------

There are various global settings that influence how Bokeh operates. You can use
several methods to change Bokeh's configuration: Directly in the Python code, in
a YAML configuration file, or with environment variables, for example. The full
list of all available settings and how to change them is available at
:ref:`bokeh.settings`.

Some of most useful settings are:

``browser`` (environment variable ``BOKEH_BROWSER``)
    Set this configuration value to the browser you want Bokeh to use (for
    example when calling |show|). Valid values are any of the predefined browser
    names of the Python :doc:`webbrowser <python:library/webbrowser>` module.
    For example: ``chromium-browser`` or ``windows-default``. You can also set
    this variable to the full path of your browser. For example:

    .. tabs::

        .. code-tab:: sh Linux/macOS

            export BOKEH_BROWSER=/usr/bin/chromium-browser

        .. code-tab:: PowerShell Windows (PS)

            $Env:BOKEH_BROWSER="C:/Program\ Files/Google/Chrome/Application/chrome.exe %s &"

        .. code-tab:: doscon Windows (CMD)

            set BOKEH_BROWSER="C:/Program\ Files/Google/Chrome/Application/chrome.exe %s &"

``resources`` (environment variable ``BOKEH_RESOURCES``)
    To display interactive visualizations in a browser, Bokeh needs to load
    :term:`BokehJS`. Set this configuration value to define where to load
    BokehJS from. For example:

    * ``cdn`` to load BokehJS from Bokeh's Content Delivery Network (CDN)
    * ``server`` to load from a Bokeh server
    * ``relative`` to load a local version relative to the given directory.

    All available options are listed at :class:`~bokeh.resources.Resources`.

    You can combine some of the values for this variable with other
    configuration values, such as ``cdn_version`` (``BOKEH_CDN_VERSION``) and
    ``rootdir`` (``BOKEH_ROOTDIR``). See :ref:`bokeh.settings` for details.

.. _userguide_interfaces:

Interfaces
----------

Bokeh provides a simple and intuitive interface for users like data scientists
and domain experts who do not wish to be distracted by complex details of the
software. At the same time, Bokeh also caters to people such as application
developers and software engineers who may want more control or access to more
sophisticated features.

Because of this, Bokeh takes a layered approach and offers different programming
interfaces appropriate to different users.

This section provides an overview of the two interfaces that you can use: the
primary interface :ref:`bokeh.plotting <userguide_interfaces_plotting>` and
the low-level :ref:`bokeh.models<userguide_interfaces_models>` interface.

If you'd prefer to jump right into basic plotting, go to
:ref:`userguide_plotting`. For a simple step-by-step guide to creating
visualizations with Bokeh, see the :ref:`first steps guides <first_steps>`.

.. _userguide_interfaces_plotting:

The *bokeh.plotting* interface
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|bokeh.plotting| is Bokeh's **primary** interface. This general-purpose
interface is similar to plotting interfaces of libraries such as Matplotlib_
or Matlab_.

The *bokeh.plotting* interface lets you focus on relating glyphs to data. It
automatically assembles plots with default elements such as axes, grids, and
tools for you.

The |figure| function is at the core of the |bokeh.plotting| interface. This
function creates a |figure| model that includes methods for adding different
kinds of glyphs to a plot. This function also takes care of composing the
various elements of your visualization, such as axes, grids, and tools.

Below is an example of |bokeh.plotting|, along with the resulting
plot:

.. bokeh-plot:: docs/user_guide/examples/concepts_plotting.py
    :source-position: above

Calling the |figure| function is all it takes to create a basic plot object. To
add data renderers to your plot object, call a glyph method such as
|figure.circle|. You don't have to worry about axes and grids (although you can
configure them if you want to), and you only need to list the tools you want to
add. To display your visualization in a browser, in most cases, all you need to
do is call the output function |show|.

With the *bokeh.plotting* interface, you have many more possibilities to
create an customize your visualization. For example:

* saving the plot to an HTML file instead of showing it
* styling and removing axes, grids, annotations, and interactive elements
* adding more data renderers
* arranging multiple plots and widgets into layouts

The :ref:`userguide_plotting` section of this |user guide| will walk you
through many more examples and common use cases for the |bokeh.plotting|
interface.

For an easy to follow guide to building your first visualizations with Bokeh,
see the :ref:`first steps guides <first_steps>`.

.. _userguide_interfaces_models:

The *bokeh.models* interface
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

With Bokeh's **low-level** |bokeh.models| interface, you have complete control
over how Bokeh creates all elements of your visualization. However, Bokeh's
low-level interface doesn't help you assemble the various elements in meaningful
or correct ways. It is entirely up to you to put them together.

Therefore, unless you have special applications that require finer control,
you will probably want to use the *bokeh.plotting* interface
:ref:`described above <userguide_interfaces_plotting>`.

To be able to use the *bokeh.models* interface, you need to understand the
basic principle by which Bokeh enables you to generate interactive,
browser-based visualizations. Behind the scenes, Bokeh consists of two
libraries:

* BokehJS, the JavaScript library
    :term:`BokehJS` runs in the browser. This library handles rendering and user
    interactions. It takes a collection of declarative JSON objects as its input
    and uses them as instructions on how to handle the various aspects of your
    visualization in a browser. For example:

    * plots and widgets
    * layouts and arrangements
    * tools and renderers
    * plot axes

    In the browser, BokehJS converts these JSON objects into BokehJS models and
    renders them according to corresponding BokehJS views.

* Bokeh, the Python library
    The Python library generates the JSON objects that BokehJS uses to render
    your visualization in a browser.

    At its lowest level, the Python library uses a set of ``model`` classes that
    exactly mirror the set of models that BokehJS creates in a browser.

    These Python ``model`` classes are able to validate their content and
    attributes and serialize themselves to JSON. Most of the models are very
    simple and usually consist of only a few property attributes and no methods.
    You can configure the attributes of those models either by setting them when
    creating a model or later by setting attribute values on the model object.

You can access all low-level ``model`` objects through Bokeh's |bokeh.models|
interface.

For example, to create and configure a |Rect| glyph object:

.. code-block:: python

    # configure attributes when initializing a model object
    glyph = Rect(x="x", y="y2", w=10, h=20, line_color=None)

    # assign values to attributes to an existing model object
    glyph.fill_alpha = 0.5
    glyph.fill_color = "navy"

You can generally configure all Bokeh models this way. Since all Bokeh
interfaces ultimately produce collections of Bokeh models, this lets you
style and configure plots and widgets the same way regardless of the
interface.

For more information on Bokeh models, see |bokeh.models| in the |reference guide|.

.. note::

   The Python library allows for binding with other languages that can produce
   appropriate JSON output. For more details and available bindings, see
   :ref:`contributor_guide_bindings`.


.. _Matlab: http://www.mathworks.com/products/matlab/
.. _Matplotlib: http://matplotlib.org

.. |bokeh.io|       replace:: :ref:`bokeh.io <bokeh.io>`

.. |Rect| replace:: :class:`~bokeh.models.glyphs.Rect`

.. |figure.circle|   replace:: :func:`figure.circle <bokeh.plotting.figure.circle>`
.. _userguide_export:

Exporting plots
===============

.. _userguide_export_dependencies:

Additional dependencies
-----------------------

You will need the following additional dependencies to use the export
functions:

* `Selenium`_
* Either one of the following `web drivers`_:

  * geckodriver for Firefox
  * ChromeDriver for Chrome / Chromium

You can install these dependencies in various ways. The recommended way is to
use ``conda`` and install Selenium together with geckodriver.

.. tabs::

  .. tab:: Install with ``conda``

    .. tabs::

      .. tab:: Selenium and geckodriver (Firefox):

        .. code-block:: sh

          conda install selenium geckodriver -c conda-forge

        You can also install Firefox from conda-forge:

        .. code-block:: sh

          conda install firefox -c conda-forge

        Installing Firefox with ``conda`` is helpful to make sure that you are
        running compatible versions of geckodriver and Firefox.

      .. tab:: Selenium and ChromeDriver (Chrome):

        .. code-block:: sh

          conda install selenium python-chromedriver-binary -c conda-forge

        After downloading and installing with ``conda``, make sure that the
        executable ``chromedriver`` (``chromedriver.exe`` on Windows) is
        available in your PATH. See the `chromedriver-binary documentation`_ for
        more information.

        ChromeDriver requires a compatible version of Google Chrome or Chromium
        to be available on your system. See the `ChromeDriver documentation`_
        for details about which version of ChromeDriver works with which
        version of Chrome or Chromium.

  .. tab:: install with ``pip``

    .. tabs::

      .. tab:: Selenium and geckodriver (Firefox):

        .. code-block:: sh

          pip install selenium

        After installing Selenium, you need to download and install the
        geckodriver binary from the `geckodriver repository on GitHub`_. Make
        sure that geckodriver is available in your PATH. See the
        `geckodriver documentation`_ for more information.

        In order for geckodriver to work, you also need to have Firefox
        available on your system. See `Supported platforms`_ in the geckodriver
        documentation to make sure your version of Firefox is compatible.

      .. tab:: Selenium and ChromeDriver (Chrome):

        .. code-block:: sh

          pip install selenium chromedriver-binary

        After downloading and installing with ``pip``, make sure that the
        executable ``chromedriver`` (``chromedriver.exe`` on Windows) is
        available in your PATH. See the `chromedriver-binary documentation`_ for
        more information.

        ChromeDriver requires a compatible version of Google Chrome or Chromium
        to be available on your system. See the `ChromeDriver documentation`_
        for details about which version of ChromeDriver works with which
        version of Chrome or Chromium.

.. _userguide_export_png:

Exporting PNG images
--------------------

Bokeh can generate RGBA-format Portable Network Graphics (PNG) images from
layouts using the |export_png| function. This functionality renders the
layout in memory and then captures a screenshot. The output image will
have the same dimensions as the source layout.

To create a PNG with a transparent background set the
``Plot.background_fill_color`` and ``Plot.border_fill_color`` properties to
``None``.

.. code-block:: python

    plot.background_fill_color = None
    plot.border_fill_color = None

Sizing variability
~~~~~~~~~~~~~~~~~~

Responsive sizing modes may generate layouts of unexpected size and aspect
ratio. For reliable results, use the default ``fixed`` sizing mode.

Example usage
~~~~~~~~~~~~~

Usage is similar to the |save| and |show| functions.

.. code-block:: python

    from bokeh.io import export_png

    export_png(plot, filename="plot.png")

.. image:: /_images/unemployment.png

Image objects
~~~~~~~~~~~~~

To access an image object through code without saving to a file, use the
lower-level function :func:`~bokeh.io.export.get_screenshot_as_png`.

.. code-block:: python

    from bokeh.io.export import get_screenshot_as_png

    image = get_screenshot_as_png(obj, height=height, width=width, driver=webdriver)

.. _userguide_export_svg:

Exporting SVG images
--------------------

Bokeh can also replace the HTML5 Canvas plot output with a Scalable Vector
Graphics (SVG) element that can be edited in image editing programs such
as Adobe Illustrator and/or converted to PDF.

The SVG output isn't as performant as the default Canvas backend when it comes
to rendering a large number of glyphs or handling lots of user interactions such
as panning.

To activate the SVG backend, set the ``Plot.output_backend`` attribute to
``"svg"``.

.. code-block:: python

    # option one
    plot = Plot(output_backend="svg")
    # option two
    plot.output_backend = "svg"

To create an SVG with a transparent background, set the
``Plot.background_fill_color`` and ``Plot.border_fill_color``
properties to ``None``, same as for PNG exports.

You can export an SVG plot in several ways:

* With code:

  * Use the |export_svg| utility function that lets you
    save a plot or a layout of plots as a single SVG file.

    .. code-block:: python

      from bokeh.io import export_svg

      export_svg(plot, filename="plot.svg")

  * Use the |export_svgs| utility function that lets you
    export a layout of plots as a set of independent SVG
    files.

    .. code-block:: python

      from bokeh.io import export_svgs

      export_svgs(plot, filename="plot.svg")

* From browser:

  * Use the `SVG-Crowbar`_ bookmarklet that adds a prompt to
    download each plot as an SVG file. This tool is fully
    compatible with Chrome and should work with Firefox in
    most cases.
  * Use the ``SaveTool`` from the toolbar but note that the
    exported files will have a blank area where the toolbar
    was.

.. image:: /_images/unemployment.svg

.. |export|          replace:: :func:`~bokeh.io.export`
.. |export_png|      replace:: :func:`~bokeh.io.export_png`
.. |export_svg|      replace:: :func:`~bokeh.io.export_svg`
.. |export_svgs|     replace:: :func:`~bokeh.io.export_svgs`

.. _Selenium: https://www.selenium.dev/documentation/en/
.. _web drivers: https://www.selenium.dev/documentation/en/webdriver/
.. _Conda: https://docs.bokeh.org/en/latest/docs/dev_guide/setup.html?highlight=conda#id4
.. _ChromeDriver documentation: https://chromedriver.chromium.org/
.. _geckodriver repository on GitHub: https://github.com/mozilla/geckodriver/releases
.. _geckodriver documentation: https://firefox-source-docs.mozilla.org/testing/geckodriver/Usage.html
.. _chromedriver-binary documentation: https://github.com/danielkaiser/python-chromedriver-binary#usage
.. _Supported platforms: https://firefox-source-docs.mozilla.org/testing/geckodriver/Support.html
.. _SVG-Crowbar: http://nytimes.github.io/svg-crowbar/
.. _userguide_jupyter:

Using with Jupyter
==================

.. _userguide_jupyter_notebook:

Working in notebooks
--------------------

`Jupyter`_ notebooks are computable documents often used for exploratory work,
data analysis, teaching, and demonstration. A notebook is a series of *input
cells* that can execute individually to immediately display their output. In
addition to  *Classic* notebooks, there are also notebooks for the newer
*JupyterLab* project. Bokeh can embed both standalone and Bokeh server content
with either.

.. _Jupyter:  https://jupyter.org

.. _userguide_jupyter_notebook_inline_plots:

Standalone output
~~~~~~~~~~~~~~~~~

Standalone Bokeh content doesn't require a Bokeh server and can be embedded
directly in classic Jupyter notebooks as well as in JupyterLab.

Classic notebooks
'''''''''''''''''

To display Bokeh plots inline in a classic Jupyter notebook, use the
|output_notebook| function from |bokeh.io| instead of (or in addition to)
the |output_file| function. No other modifications are required. When you
call |show|, the plot will display inline in the next notebook output cell.
See a screenshot of Jupyter below:

.. image:: /_images/notebook_inline.png
    :scale: 50 %
    :align: center

To have a single notebook output cell display multiple plots, call |show|
multiple times in the input cell. The plots will display in order.

.. image:: /_images/notebook_inline_multiple.png
    :scale: 50 %
    :align: center

JupyterLab
''''''''''

To use JupyterLab with Bokeh, you should at least use version 3.0 of JupyterLab.
Enabling Bokeh visualizations in JupyterLab also requires the
`jupyter_bokeh`_ extension to be installed.

After installing JupyterLab, you can use either ``pip`` or ``conda`` to install
jupyter_bokeh:

.. panels::

    Installing with ``conda``
    ^^^^^^^^^^^^^^^^^^^^^^^^^

    Make sure you have either `Anaconda`_ or `Miniconda`_ installed. Use
    this command to install jupyter_bokeh:

    .. code-block:: sh

        conda install jupyter_bokeh

    ---

    Installing with ``pip``
    ^^^^^^^^^^^^^^^^^^^^^^^

    Use this command to install jupyter_bokeh:

    .. code-block:: sh

        pip install jupyter_bokeh

For instructions on installing jupyter_bokeh with versions of JupyterLab
older than 3.0, see the `README`_ in the GitHub repository of `jupyter_bokeh`_.

Once you have jupyter_bokeh installed, you can use Bokeh just like you would
with a :ref:`classic notebook <userguide_jupyter_notebook_inline_plots>`.

.. image:: /_images/joyplot_jupyter_lab.png
    :scale: 25 %
    :align: center

.. _jupyter_bokeh: https://github.com/bokeh/jupyter_bokeh
.. _Anaconda: https://www.anaconda.com/products/individual#Downloads
.. _Miniconda: https://docs.conda.io/en/latest/miniconda.html
.. _README: https://github.com/bokeh/jupyter_bokeh/blob/main/README.md

Bokeh server applications
~~~~~~~~~~~~~~~~~~~~~~~~~

You can also embed full Bokeh server applications connecting plot events
and Bokeh's built-in widgets directly to Python callback code.
See :ref:`userguide_server` for general information about Bokeh server
applications. For a complete example of a Bokeh application embedded in
a Jupyter notebook, refer to the following notebook:

* :bokeh-tree:`examples/howto/server_embed/notebook_embed.ipynb`

JupyterHub
''''''''''

When running notebooks from your own JupyterHub instance, some additional
steps are necessary to embed Bokeh server applications and to enable network
connectivity between the client browser and the Bokeh server running in a
JupyterLab cell. This is because your browser needs to connect to the port the
Bokeh server is listening on. However, JupyterHub is acting as a reverse proxy
between your browser and your JupyterLab container. Follow all the JupyterLab
instructions above, then continue with the following steps:

1. Install the ``jupyter-server-proxy`` package and enable the server extension as follows:

   .. code:: sh

    pip install jupyter-server-proxy && jupyter serverextension enable --py jupyter-server-proxy

   If you intend to work with JupyterLab you need to install the corresponding extension,
   either from the GUI or with the following command:

   .. code:: sh

    jupyter labextension install @jupyterlab/server-proxy

2. Define a function to help create the URL for the browser to connect to
   the Bokeh server.

   See below for a reference implementation. You'll have to either modify
   this code or assign the URL of your JupyterHub installation to the environment
   variable ``EXTERNAL_URL``. JupyterHub defaults to ``JUPYTERHUB_SERVICE_PREFIX``
   in this case.

   .. code-block:: python

    def remote_jupyter_proxy_url(port):
        """
        Callable to configure Bokeh's show method when a proxy must be
        configured.

        If port is None we're asking about the URL
        for the origin header.
        """
        base_url = os.environ['EXTERNAL_URL']
        host = urllib.parse.urlparse(base_url).netloc

        # If port is None we're asking for the URL origin
        # so return the public hostname.
        if port is None:
            return host

        service_url_path = os.environ['JUPYTERHUB_SERVICE_PREFIX']
        proxy_url_path = 'proxy/%d' % port

        user_url = urllib.parse.urljoin(base_url, service_url_path)
        full_url = urllib.parse.urljoin(user_url, proxy_url_path)
        return full_url

3. Pass the function you defined in step 2 to the |show| function
   as the ``notebook_url`` keyword argument. Bokeh then calls this
   function when it sets up the server and creates the URL to load a graph:

   .. code-block:: python

    show(obj, notebook_url=remote_jupyter_proxy_url)

You may need to restart your server after this, and then Bokeh content should load and
execute Python callbacks defined in your Jupyter environment.

Trusting notebooks
~~~~~~~~~~~~~~~~~~

Depending on the version of the notebook you are using, you may have to
`trust the notebook <https://jupyter-notebook.readthedocs.io/en/stable/security.html#explicit-trust>`_
for Bokeh plots to re-render when the notebook is closed and re-
opened. The **Trust Notebook** option is typically located under the
**File** menu:

.. image:: /_images/notebook_trust.png
    :scale: 50 %
    :align: center

.. _userguide_jupyter_notebook_slides:

Notebook slides
~~~~~~~~~~~~~~~

You can use a notebook with `Reveal.js`_ to generate slideshows from cells.
You can also include standalone (i.e. non-server) Bokeh plots in such sideshows.
However, you will need to take a few extra steps to display the output correctly.
Particularly, make sure that **the cell containing the** ``output_notebook``
**is not be skipped**.

Rendered cell output of the ``output_notebook`` call ensures that the
BokehJS library loads. Otherwise, Bokeh plots will not work. If this cell's
type is set to *"skip"*, BokehJS will not load, and Bokeh plots will not display.
If you want to hide this cell, assign it the *"notes"* slide type.

.. _userguide_jupyter_notebook_notebook_handles:

Notebook handles
~~~~~~~~~~~~~~~~

You can update a displayed plot without reloading it. To do so, pass the
``notebook_handle=True`` argument to |show| for it to return a handle object.
You can use this handle object with the |push_notebook| function to update the plot
with any recent changes to plots properties, data source values, etc.

This `notebook handle` functionality is only supported in classic Jupyter notebooks
and is not implemented in JupyterLab or Zeppelin yet.

The following screenshots illustrate basic usage of notebook handles:

1. Import standard functions and |push_notebook|:

.. image:: /_images/notebook_comms1.png
    :scale: 50 %
    :align: center

2. Create some plots and pass ``notebook_handle=True`` to |show|:

.. image:: /_images/notebook_comms2.png
    :scale: 50 %
    :align: center

3. Check that the handle is associated with the output cell for ``In[2]`` just displayed:

.. image:: /_images/notebook_comms3.png
    :scale: 50 %
    :align: center

4. Update some properties of the plot, then call |push_notebook| with the handle:

.. image:: /_images/notebook_comms4.png
    :scale: 50 %
    :align: center

5. Note that the output cell for ``In[2]`` has changed (*without* being re-executed):

.. image:: /_images/notebook_comms5.png
    :scale: 50 %
    :align: center

See the following notebooks for more detailed examples of notebook handle use:

* :bokeh-tree:`examples/howto/notebook_comms/Basic Usage.ipynb`
* :bokeh-tree:`examples/howto/notebook_comms/Continuous Updating.ipynb`
* :bokeh-tree:`examples/howto/notebook_comms/Jupyter Interactors.ipynb`
* :bokeh-tree:`examples/howto/notebook_comms/Numba Image Example.ipynb`

.. _userguide_jupyter_notebook_jupyter_interactors:

Jupyter interactors
~~~~~~~~~~~~~~~~~~~

You can use notebook widgets, known as `interactors`_, to update
Bokeh plots. The key to doing this is the |push_notebook| function.
The update callback for the interactors calls this function
to update the plot from widget values. See a screenshot of the
:bokeh-tree:`examples/howto/notebook_comms/Jupyter Interactors.ipynb` example
notebook below:

.. image:: /_images/notebook_interactors.png
    :scale: 50 %
    :align: center


.. |bokeh.io| replace:: :ref:`bokeh.io <bokeh.io>`

.. |push_notebook| replace:: :func:`~bokeh.io.push_notebook`

.. _interactors: http://ipywidgets.readthedocs.io/en/latest/examples/Using%20Interact.html
.. _Reveal.js: http://lab.hakim.se/reveal-js/#/

More example notebooks
~~~~~~~~~~~~~~~~~~~~~~

You can find many more examples of notebook use in the `bokeh-notebook`_ repository:

1. Clone the repository locally:

   .. code:: sh

    git clone https://github.com/bokeh/bokeh-notebooks.git

2. Launch the Jupyter notebooks in your web browser.

Alternatively, `Binder`_ hosts live notebooks that you can run online.

The main `Bokeh`_ repository also includes some notebooks under `examples`_:

- `categorical data`_
- `hover callback`_
- `linked panning`_
- `range update callback`_
- `embed server in notebook`_
- `US marriages and divorces interactive`_
- `color scatterplot`_
- `glyphs`_

Notebook comms examples:

- `basic usage`_
- `continuous updating`_
- `Jupyter interactors`_
- `Numba image example`_

.. _bokeh-notebook: https://github.com/bokeh/bokeh-notebooks
.. _Binder: https://mybinder.org/v2/gh/bokeh/bokeh-notebooks/master?filepath=tutorial%2F00%20-%20Introduction%20and%20Setup.ipynb
.. _examples: https://github.com/bokeh/bokeh/tree/master/examples
.. _Bokeh: https://github.com/bokeh/bokeh
.. _categorical data: https://github.com/bokeh/bokeh/blob/master/examples/howto/Categorical%20Data.ipynb
.. _hover callback: https://github.com/bokeh/bokeh/blob/master/examples/howto/Hover%20callback.ipynb
.. _linked panning: https://github.com/bokeh/bokeh/blob/master/examples/howto/Linked%20panning.ipynb
.. _range update callback: https://github.com/bokeh/bokeh/blob/master/examples/howto/Range%20update%20callback.ipynb
.. _embed server in notebook: https://github.com/bokeh/bokeh/blob/master/examples/howto/server_embed/notebook_embed.ipynb
.. _US marriages and divorces interactive: https://github.com/bokeh/bokeh/blob/master/examples/howto/us_marriages_divorces/us_marriages_divorces_interactive.ipynb
.. _color scatterplot: https://github.com/bokeh/bokeh/blob/master/examples/plotting/notebook/color_scatterplot.ipynb
.. _glyphs: https://github.com/bokeh/bokeh/blob/master/examples/plotting/notebook/glyphs.ipynb
.. _basic usage: https://github.com/bokeh/bokeh/blob/master/examples/howto/notebook_comms/Basic%20Usage.ipynb
.. _continuous updating: https://github.com/bokeh/bokeh/blob/master/examples/howto/notebook_comms/Continuous%20Updating.ipynb
.. _Jupyter interactors: https://github.com/bokeh/bokeh/blob/master/examples/howto/notebook_comms/Jupyter%20Interactors.ipynb
.. _Numba image example: https://github.com/bokeh/bokeh/blob/master/examples/howto/notebook_comms/Numba%20Image%20Example.ipynb

.. _userguide_jupyter_ipywidgets:

IPyWidgets outside the notebook
-------------------------------

Now that you know how to use Bokeh in the JupyterLab and classical notebook environments,
you might want to take advantage of the vibrant Jupyter ecosystem outside of these environments.
You can do so with the `ipywidgets_bokeh`_ extension for Bokeh:

.. code-block:: sh

    $ conda install -c bokeh ipywidgets_bokeh

or

.. code-block:: sh

    $ pip install ipywidgets_bokeh

This extension lets you use `IPyWidgets`_ in Bokeh. Simply wrap a widget in an
``IPyWidget`` model and add the wrapper to a document or include it in a layout.
You don't have to install or enable any other extensions.

Example
~~~~~~~

Follow these steps to build an application with a single Jupyter slider that
logs its adjustments to the console:

1. Start by constructing a widget and configuring an observer:

   .. code-block:: python

    from ipywidgets import FloatSlider
    angle = FloatSlider(min=0, max=360, value=0, step=1, description="Angle")

    def on_change(change):
        print(f"angle={change['new']} deg")
    angle.observe(on_change, names="value")

2. To integrate the widget with Bokeh, wrap it in ``IPyWidget``:

   .. code-block:: python

    from ipywidgets_bokeh import IPyWidget
    ipywidget = IPyWidget(widget=angle)

3. Add the wrapper to a Bokeh document:

   .. code-block:: python

    from bokeh.plotting import curdoc
    doc = curdoc()
    doc.add_root(ipywidget)

To run the app, enter ``bokeh serve ipy_slider.py``, where ``ipy_slider.py``
is the name of the application (see :ref:`userguide_server` for details).
This application is available at http://localhost:5006/ipy_slider.

You can build on the above to create more complex layouts and include advanced widgets,
such as `ipyleaflet`_ and `ipyvolume`_. For more examples, see ``examples/howto/ipywidgets``
in the Bokeh repository.

.. _IPyWidgets: https://ipywidgets.readthedocs.io
.. _ipywidgets_bokeh: https://github.com/bokeh/ipywidgets_bokeh
.. _ipyleaflet: https://jupyter.org/widgets#ipyleaflet
.. _ipyvolume: https://jupyter.org/widgets#ipyvolume
.. _userguide_layout:

Creating layouts
================

Bokeh includes several layout options for plots and widgets. These let you
arrange multiple components to create interactive dashboards and data
applications.

Layout functions let you build a grid of plots and widgets. You can have as
many rows, columns, or grids of plots in one layout as you like. Bokeh
layouts also allow for a number of sizing options, or modes. These modes
allow plots and widgets to resize to fit the browser window.

.. _userguide_layout_layouts:

Basic layouts
-------------

Column layout
~~~~~~~~~~~~~

To display plots or widgets vertically, use the |column| function.

.. bokeh-plot:: docs/user_guide/examples/layout_vertical.py
    :source-position: above

Row layout
~~~~~~~~~~

To display plots or widgets horizontally, use the |row| function.

.. bokeh-plot:: docs/user_guide/examples/layout_horizontal.py
    :source-position: above

.. _userguide_layout_gridplot:

Grid layout for plots
~~~~~~~~~~~~~~~~~~~~~~

Use the |gridplot| function to arrange Bokeh plots in a grid. This
function also merges all plot tools into a single toolbar. Each plot
in the grid then has the same active tool.

You can leave grid cells blank by passing ``None`` to them instead of
a plot object.

.. bokeh-plot:: docs/user_guide/examples/layout_grid.py
    :source-position: above

For convenience, you can also just pass a list of plots and specify the
number of columns you want in your grid. For example:

.. code-block:: python

    gridplot([s1, s2, s3], ncols=2)

You can also pass in ``width`` and ``height`` arguments.
These dimensions will then apply to all your plots.

By default, |gridplot| merges all child plot tools into a single
parent grid toolbar. To disable this behavior, set ``merge_tools``
to ``False``.

.. bokeh-plot:: docs/user_guide/examples/layout_grid_convenient.py
    :source-position: above

General grid layout
~~~~~~~~~~~~~~~~~~~

You can use the |layout| function to arrange plots and widgets into a grid.
This automatically generates appropriate |row| and |column| layouts saving
you time. Try the following code to see how this function works.

.. code-block:: python

    sliders = column(amp, freq, phase, offset)

    layout([
        [bollinger],
        [sliders, plot],
        [p1, p2, p3],
    ])


This produces the following layout:

.. image:: /_images/dashboard.png
    :width: 500px
    :height: 397px

|

For complete code see :bokeh-tree:`examples/howto/layouts/dashboard.py`.

.. _userguide_layout_sizing_mode:

Sizing modes
------------

Modes
~~~~~

Use the following sizing modes to configure how Bokeh objects behave in a layout:

``"fixed"``
    Component retains its width and height regardless of browser window size.

``"stretch_width"``
    Component resizes to fill available width but does not maintain any aspect
    ratio. Height depends on the component type and may fit its contents or be
    fixed.

``"stretch_height"``
    Component resizes to fill available height but does not maintain any aspect
    ratio. Width depends on the component type and may fit its contents or be
    fixed.

``"stretch_both"``
    Component resizes to fill available width and height but does not maintain
    any aspect ratio.

``"scale_width"``
    Component resizes to fill available width and maintains either original or
    specified aspect ratio.

``"scale_height"``
    Component resizes to fill available height and maintains either original or
    specified aspect ratio.

``"scale_both"``
    Component resizes to fill available width and height and maintains either
    original or specified aspect ratio.

Depending on the mode, you may also have to specify ``width`` and/or ``height``.
For example, you have to specify a fixed height when using the ``stretch_width``
mode.

Components such as |row| and |column| elements share their sizing mode with all
of their children that do not have their own explicit sizing mode.

Single object
~~~~~~~~~~~~~

The example below lets you select a sizing mode from a dropdown and see how
a single plot responds to different modes.

.. bokeh-plot:: docs/user_guide/examples/layout_sizing_mode.py
    :source-position: none

.. note::
    If the enclosing DOM element does not define any specific height to fill,
    sizing modes that scale or stretch to height may shrink your plot to a
    minimum size.

Multiple objects
~~~~~~~~~~~~~~~~

Below is a more sophisticated but fairly typical example of a nested layout.

.. bokeh-plot:: docs/user_guide/examples/layout_sizing_mode_multiple.py
    :source-position: none

Here the layout includes sub-components with different sizing modes as follows:

.. code-block:: python

    # plot scales to original aspect ratio based on available width
    plot = figure(..., sizing_mode="scale_width")

    # slider fills all space available to it
    amp = Slider(..., sizing_mode="stretch_both")

    # fixed sized for the entire column
    widgets = column(..., sizing_mode="fixed", height=250, width=150)

    # heading fills available width
    heading = Div(..., height=80, sizing_mode="stretch_width")

    # entire layout fills all space available to it
    layout = column(heading, row(widgets, plot), sizing_mode="stretch_both")

.. _userguide_layout_limits:

Limitations
-----------

The Bokeh layout system is not an all-purpose layout engine. It intentionally
sacrifices some capability to make common use cases and scenarios simple to
express. Complicated layouts with many different sizing modes may yield undesirable
results, both in terms of performance and visual appearance. For more involved
designs, use methods provided in :ref:`userguide_embed` along with your own
custom HTML templates. This will let you take advantage of more sophisticated
CSS layout possibilities.

.. |column|    replace:: :func:`~bokeh.layouts.column`
.. |gridplot|  replace:: :func:`~bokeh.layouts.gridplot`
.. |layout|    replace:: :func:`~bokeh.layouts.layout`
.. |row|       replace:: :func:`~bokeh.layouts.row`
.. _userguide_data:

Providing data
==============

The basis for any data visualization is the underlying data. This section
describes the various ways to provide data to Bokeh, from passing data values
directly to creating a |ColumnDataSource| (CDS) and filtering the data with a
|CDSView|.

.. _userguide_data_python_lists:

Providing data with Python lists
--------------------------------

Use standard Python lists of data to pass values directly into a plotting
function.

In this example, the lists ``x_values`` and ``y_values`` pass data
to the :func:`~bokeh.plotting.figure.circle` function (see
:ref:`plotting function <userguide_plotting>` for more examples):

.. code-block:: python

    from bokeh.plotting import figure

    x_values = [1, 2, 3, 4, 5]
    y_values = [6, 7, 2, 3, 6]

    p = figure()
    p.circle(x=x_values, y=y_values)

.. _userguide_data_numpy:

Providing NumPy data
--------------------

Similarly to using Python lists and arrays, you can also work with NumPy data
structures in Bokeh:

.. code-block:: python

    import numpy as np
    from bokeh.plotting import figure

    x = [1, 2, 3, 4, 5]
    random = np.random.standard_normal(5)
    cosine = np.cos(x)

    p = figure()
    p.circle(x=x, y=random)
    p.line(x=x, y=cosine)

.. _userguide_data_cds:

Providing data as a ColumnDataSource
------------------------------------

The |ColumnDataSource| (CDS) is the core of most Bokeh plots. It provides the
data to the glyphs of your plot.

When you pass sequences like Python lists or NumPy arrays to a Bokeh renderer,
Bokeh automatically creates a ColumnDataSource with this data for you. However,
creating a ColumnDataSource yourself gives you access to more advanced options.

For example: Creating your own |ColumnDataSource| allows you to share data
between multiple plots and widgets. If you use a single ColumnDataSource
together with multiple renderers, those renderers also share information about
data you select with a select tool from Bokeh's toolbar (see
:ref:`userguide_data_linked_selection`).

Think of a ColumnDataSource as a collection of sequences of data that each have
their own, unique column name.

Creating a ColumnDataSource
~~~~~~~~~~~~~~~~~~~~~~~~~~~

To create a basic |ColumnDataSource| object, you need a Python dictionary to
pass to the object's ``data`` parameter:

* Bokeh uses the dictionary's keys as column names.
* The dictionary's values are used as the data values for your ColumnDataSource.

The data you pass as part of your dict can be any non-string ordered sequences
of values, such as lists or arrays (including NumPy arrays and pandas Series):

.. code-block:: python

    data = {'x_values': [1, 2, 3, 4, 5],
            'y_values': [6, 7, 2, 3, 6]}

    source = ColumnDataSource(data=data)

.. note::
    All columns in a ColumnDataSource have the same length. Therefore, all sequences
    of values that you pass to a single ColumnDataSource must have the
    same length as well. If you try to pass sequences of different lengths, Bokeh
    will not be able to create your ColumnDataSource.

Plotting with a ColumnDataSource
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To use a ColumnDataSource with a renderer function, you need to pass at least
these three arguments:

* ``x``: the name of the ColumnDataSource's column that contains the data for
  the x values of your plot
* ``y``: the name of the ColumnDataSource's column that contains the data for
  the y values of your plot
* ``source``: the name of the ColumnDataSource that contains the columns you
  just referenced for the ``x`` and ``y`` arguments.

For example:

.. code-block:: python

    from bokeh.plotting import figure
    from bokeh.models import ColumnDataSource

    # create a Python dict as the basis of your ColumnDataSource
    data = {'x_values': [1, 2, 3, 4, 5],
            'y_values': [6, 7, 2, 3, 6]}

    # create a ColumnDataSource by passing the dict
    source = ColumnDataSource(data=data)

    # create a plot using the ColumnDataSource's two columns
    p = figure()
    p.circle(x='x_values', y='y_values', source=source)

Modifying a ColumnDataSource
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To modify the data of an existing ColumnDataSource, update the ``.data``
property of your ColumnDataSource object:

* To add a new column to an existing ColumnDataSource:

  .. code-block:: python

    new_sequence = [8, 1, 4, 7, 3]
    source.data["new_column"] = new_sequence

  .. note::
    The length of the column you are adding must match the length of the
    existing columns.

* To replace all data in an existing ColumnDataSource, assign the ``.data``
  property an entirely new dict:

  .. code-block:: python

    source.data = new_dict

  .. note::
    Replacing the entire contents of a ColumnDataSource is also the only way to
    update the lengths of its columns. When you update data in a way that
    changes the length of any column, you must update all columns at the same
    time by passing an new dict. It is not possible to update column lengths one
    column at a time.

.. _userguide_data_cds_pandas_data_frame:

Using a pandas DataFrame
~~~~~~~~~~~~~~~~~~~~~~~~

The ``data`` parameter can also be a pandas ``DataFrame`` or ``GroupBy`` object:

.. code-block:: python

   source = ColumnDataSource(df)

If you use a pandas ``DataFrame``, the resulting ColumnDataSource in Bokeh will
have columns that correspond to the columns of the ``DataFrame``. The naming of
the columns follows these rules:

* If the ``DataFrame`` has a named index column, the ColumnDataSource will also
  have a column with this name.
* If the index name is ``None``, the ColumnDataSource will have a generic name:
  either ``index`` (if that name is available) or ``level_0``.

.. _userguide_data_cds_pandas_multi_index:

Using a pandas MultiIndex
~~~~~~~~~~~~~~~~~~~~~~~~~
If you use a pandas ``MultiIndex`` as the basis for a Bokeh
``ColumnDataSource``, Bokeh flattens the columns and indices before creating
the ColumnDataSource. For the index, Bokeh creates an index of tuples and joins
the names of the ``MultiIndex`` with an underscore. The column names will also be
joined with an underscore. For example:

.. code-block:: python

    df = pd.DataFrame({('a', 'b'): {('A', 'B'): 1, ('A', 'C'): 2},
                       ('b', 'a'): {('A', 'C'): 7, ('A', 'B'): 8},
                       ('b', 'b'): {('A', 'D'): 9, ('A', 'B'): 10}})
    cds = ColumnDataSource(df)

This will result in a column named ``index`` with ``[(A, B), (A, C), (A, D)]``,
as well as columns named ``a_b``, ``b_a``, and ``b_b``.

This process only works with column names that are strings. If you are using
non-string column names, you need to manually flatten the ``DataFrame`` before
using it as the basis of a Bokeh ``ColumnDataSource``.

.. _userguide_data_cds_pandas_group_by:

Using pandas GroupBy
~~~~~~~~~~~~~~~~~~~~

.. code-block:: python

    group = df.groupby(('colA', 'ColB'))
    source = ColumnDataSource(group)

If you use a pandas ``GroupBy`` object, the columns of the ColumnDataSource
correspond to the result of calling ``group.describe()``. The ``describe``
method generates columns for statistical measures such as ``mean`` and ``count``
for all the non-grouped original columns.

The resulting ``DataFrame`` has ``MultiIndex`` columns with the original column
name and the computed measure. Bokeh flattens the data using the rules described
above.

For example: If a ``DataFrame`` has the columns ``'year'`` and ``'mpg'``,
passing ``df.groupby('year')`` to a ColumnDataSource will result in columns such
as ``'mpg_mean'``.

.. note::
    Adapting ``GroupBy`` objects requires pandas version 0.20.0 or above.

.. _userguide_data_cds_streaming:

Appending data to a ColumnDataSource
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|ColumnDataSource| streaming is an efficient way to append new data to a
ColumnDataSource. When you use the
:func:`~bokeh.models.sources.ColumnDataSource.stream` method, Bokeh only sends
new data to the browser instead of sending the entire dataset.

The :func:`~bokeh.models.sources.ColumnDataSource.stream` method takes a
``new_data`` parameter. This parameter expects a dict that maps column names
to the sequences of data that you want appended to the respective columns.

The method takes an additional, optional argument ``rollover``. This is the
maximum length of data to keep. When there is more data than defined by your
maximum value, Bokeh will discard data from the beginning of the column. The
default value for ``rollover`` is ``None``. This default value allows data to
grow unbounded.

.. code-block:: python

    source = ColumnDataSource(data=dict(foo=[], bar=[]))

    # has new, identical-length updates for all columns in source
    new_data = {
        'foo' : [10, 20],
        'bar' : [100, 200],
    }

    source.stream(new_data)

For an example that uses streaming, see :bokeh-tree:`examples/app/ohlc`.

.. _userguide_data_cds_patching:

Replacing data in a ColumnDataSource
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|ColumnDataSource| patching is an efficient way to update slices of a data
source. By using the :func:`~bokeh.models.sources.ColumnDataSource.patch`
method, Bokeh only sends new data to the browser instead of the entire
dataset.

The :func:`~bokeh.models.sources.ColumnDataSource.patch` requires a dict which
maps column names to list of tuples that represent a patch change to apply.

Examples of tuples that you can use with
:func:`~bokeh.models.sources.ColumnDataSource.patch`:

.. code-block:: python

    (index, new_value)  # replace a single column value

    # or

    (slice, new_values) # replace several column values

For a full example, see :bokeh-tree:`examples/howto/patch_app.py`.

.. _userguide_data_transforming:

Transforming data
-----------------

So far, you have added data to a ``ColumnDataSource`` to control Bokeh plots.
However, you can also perform some data operations directly in the browser.

Dynamically calculating color maps in the browser, for example, can reduce the
amount of Python code. If the necessary calculations for color mapping happen
directly in the browser, you will also need to send less data.

This section provides an overview of the different transform objects that are
available.

Client-side color mapping
~~~~~~~~~~~~~~~~~~~~~~~~~

Use the :func:`~bokeh.transform.linear_cmap` function to perform linear
color mapping directly in the browser. This function accepts the following
arguments:

* The name of a ``ColumnDataSource`` column containing the data to map colors to
* A palette (which can be a :ref:`built-in palette name<bokeh.palettes>` or a
  list of colors)
* ``min`` and ``max`` values for the color mapping range.

Pass the result as a ``color`` property of a glyph:

.. code-block:: python

     fill_color=linear_cmap('counts', 'Viridis256', min=0, max=10)

For example:

.. bokeh-plot:: docs/user_guide/examples/data_transforming_colors.py
    :source-position: above

In addition to :func:`~bokeh.transform.linear_cmap`, there are two similar
functions:

* :func:`~bokeh.transform.log_cmap` for color mapping on a log scale
* |factor_cmap| for color mapping categorical data (see
  the example below).

Mapping marker types
~~~~~~~~~~~~~~~~~~~~

When you use categorical data, you can use different markers for each of the
categories in your data. Use the :func:`~bokeh.transform.factor_mark`
function to assign different markers to different categories automatically:

.. bokeh-plot:: docs/user_guide/examples/data_transforming_markers.py
    :source-position: above

This example also uses |factor_cmap| to color map those
same categories.

.. note::
    The :func:`~bokeh.transform.factor_mark` transform is usually only useful
    with the ``scatter`` glyph method because parameterization by marker type
    only makes sense with scatter plots.

Including JavaScript code with CustomJSTransform
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In addition to the built-in transformation functions above, you can use your own
JavaScript code. Use the :func:`~bokeh.models.transforms.CustomJSTransform`
function to add custom JavaScript code that is executed in the browser.

The example below uses the :func:`~bokeh.models.transforms.CustomJSTransform`
function with the argument ``v_func``. ``v_func`` is short for "vectorized
function". The JavaScript code you supply to ``v_func`` needs to expect an array
of inputs in the variable ``xs``, and return a JavaScript array with the
transformed values:

.. code-block:: python

    v_func = """
        const first = xs[0]
        const norm = new Float64Array(xs.length)
        for (let i = 0; i < xs.length; i++) {
            norm[i] = xs[i] / first
        }
        return norm
    """
    normalize = CustomJSTransform(v_func=v_func)

    plot.line(x='aapl_date', y=transform('aapl_close', normalize), line_width=2,
              color='#cf3c4d', alpha=0.6,legend="Apple", source=aapl_source)

The code in this example converts raw price data into a sequence of normalized
returns that are relative to the first data point:

.. bokeh-plot:: docs/user_guide/examples/data_transforming_customjs_transform.py
    :source-position: none

.. _userguide_data_filtering:

Filtering data
--------------

Bokeh uses a concept called "view" to select subsets of data. Views are
represented by Bokeh's |CDSView| class. When you use a view, you can use one or
more filters to select specific data points without changing the underlying
data. You can also share those views between different plots.

To plot with a filtered subset of data, pass a |CDSView| to the ``view``
argument of any renderer method on a Bokeh plot.

A |CDSView| has one property, ``filters``:

* ``filters`` is a list of |Filter| objects, listed and described below.

In this example, you create a |CDSView| called ``view``. ``view`` uses the
ColumnDataSource ``source`` and a list of two filters, ``filter1`` and
``filter2``. ``view`` is then passed to a :func:`~bokeh.plotting.figure.circle`
renderer function:

.. code-block:: python

    from bokeh.plotting import figure
    from bokeh.models import ColumnDataSource, CDSView

    source = ColumnDataSource(some_data)
    view = CDSView(filters=[filter1, filter2])

    p = figure()
    p.circle(x="x", y="y", source=source, view=view)

IndexFilter
~~~~~~~~~~~

The |IndexFilter| is the simplest filter type. It has an ``indices`` property,
which is a list of integers that are the indices of the data you want to include
in your plot.

.. bokeh-plot:: docs/user_guide/examples/data_filtering_index_filter.py
    :source-position: above


BooleanFilter
~~~~~~~~~~~~~

A |BooleanFilter| selects rows from a data source using a list of ``True`` or
``False`` values in its ``booleans`` property.

.. bokeh-plot:: docs/user_guide/examples/data_filtering_boolean_filter.py
    :source-position: above

GroupFilter
~~~~~~~~~~~

The |GroupFilter| is a filter for categorical data. With this filter, you can
select rows from a dataset that are members of a specific category.

The |GroupFilter| has two properties:

* ``column_name``: the name of the column in the |ColumnDataSource| to apply the
  filter to
* ``group``: the name of the category to select for

In the example below, the data set ``flowers`` contains a categorical variable
called ``species``. All data belongs to one of the three species categories
``setosa``, ``versicolor``, or ``virginica``. The second plot in this example
uses a |GroupFilter| to only display data points that are a member of the
category ``setosa``:

.. bokeh-plot:: docs/user_guide/examples/data_filtering_group_filter.py
    :source-position: above

CustomJSFilter
~~~~~~~~~~~~~~

You can also use your own JavaScript or TypeScript code to create customized
filters. To include your custom filter code, use Bokeh's |CustomJSFilter| class.
Pass your code as a string to the parameter ``code`` of the CustomJSFilter.

Your JavaScript or TypeScript code needs to return either a list of indices or a
list of booleans representing the filtered subset. You can access the
|ColumnDataSource| you are using with |CDSView| from within your JavaScript or
TypeScript code. Bokeh makes the ColumnDataSource available through the variable
``source``:

.. code-block:: python

    custom_filter = CustomJSFilter(code='''
    const indices = [];

    // iterate through rows of data source and see if each satisfies some constraint
    for (let i = 0; i < source.get_length(); i++){
        if (source.data['some_column'][i] == 'some_value'){
            indices.push(true);
        } else {
            indices.push(false);
        }
    }
    return indices;
    ''')

.. _userguide_data_ajax_data_source:

AjaxDataSource
--------------

Updating and streaming data works very well with
:ref:`Bokeh server applications<userguide_server>`. However, it is also possible
to use similar functionality in standalone documents. The
:class:`~bokeh.models.sources.AjaxDataSource` provides this capability without
requiring a Bokeh server.

To set up an ``AjaxDataSource``, you need to configure it with a URL to a REST
endpoint and a polling interval.

In the browser, the data source requests data from the endpoint at the specified
interval. It then uses the data from the endpoint to update the data locally.

Updating data locally can happen in two ways: either by replacing the existing
local data entirely or by appending the new data to the existing data (up to a
configurable ``max_size``). Replacing local data is the default setting. Pass
either ``"replace"`` or ``"append"``as the AjaxDataSource's ``mode`` argument to
control this behavior.

The endpoint that you are using with your ``AjaxDataSource`` needs to return a
JSON dict that matches the standard |ColumnDataSource| format:

.. code-block:: python

    {
        'x' : [1, 2, 3, ...],
        'y' : [9, 3, 2, ...]
    }

Otherwise, using an ``AjaxDataSource`` is identical to using a standard
``ColumnDataSource``:

.. code-block:: python

    # setup AjaxDataSource with URL and polling interval
    source = AjaxDataSource(data_url='http://some.api.com/data',
                            polling_interval=100)

    # use the AjaxDataSource just like a ColumnDataSource
    p.circle('x', 'y', source=source)

This a preview of what a stream of live data in Bokeh can look like using
``AjaxDataSource``:

.. image:: /_images/ajax_streaming.gif

For the full example, see :bokeh-tree:`examples/howto/ajax_source.py` in Bokeh's
GitHub repository.

.. _userguide_data_linked_selection:

Linked selection
----------------

You can share selections between two plots if both of the plots use the same
|ColumnDataSource|:

.. bokeh-plot:: docs/user_guide/examples/interaction_linked_brushing.py
    :source-position: above

.. _userguide_data_linked_selection_with_filtering:

Linked selection with filtered data
-----------------------------------

Using a |ColumnDataSource|, you can also have two plots that are based on the
same data but each use a different subset of that data. Both plots still share
selections and hovered inspections through the |ColumnDataSource| they are based
on.

The following example demonstrates this behavior:

* The second plot is a subset of the data of the first plot. The second plot
  uses a |CDSView| to include only y values that are either greater than 250 or
  less than 100.
* If you make a selection with the ``BoxSelect`` tool in either plot, the
  selection is automatically reflected in the other plot as well.
* If you hover on a point in one plot, the corresponding point in the other plot
  is automatically highlighted as well, if it exists.

.. bokeh-plot:: docs/user_guide/examples/data_linked_brushing_subsets.py
    :source-position: above

Other data types
----------------

You can also use Bokeh to render network graph data and geographical data. For
more information about how to set up the data for these types of plots, see
:ref:`userguide_graph` and :ref:`userguide_geo`.

.. |CDSView| replace:: :class:`~bokeh.models.sources.CDSView`
.. |Filter| replace:: :class:`~bokeh.models.filters.Filter`
.. |IndexFilter| replace:: :class:`~bokeh.models.filters.IndexFilter`
.. |BooleanFilter| replace:: :class:`~bokeh.models.filters.BooleanFilter`
.. |GroupFilter| replace:: :class:`~bokeh.models.filters.GroupFilter`
.. |CustomJSFilter| replace:: :class:`~bokeh.models.filters.CustomJSFilter`
.. |DataTable| replace:: :class:`~bokeh.models.widgets.tables.DataTable`
.. _userguide_webgl:

Accelerating with WebGL
=======================

Bokeh provides limited support for rendering with WebGL. This can be useful
when visualizing larger data sets.

What is WebGL?
--------------

`WebGL`_ is a JavaScript API that allows rendering content in the browser
using hardware acceleration from a Graphics Processing Unit (GPU).
WebGL is standardized and available in all modern browsers.

How to enable WebGL
-------------------

To enable WebGL in Bokeh, set the plot's ``output_backend`` property to
``"webgl"``:

.. code-block:: python

    p = figure(output_backend="webgl")

Support
-------

Bokeh's WebGL support covers a subset of glyphs. This includes the :func:`~bokeh.plotting.figure.line`
glyph, and most markers:

* :func:`~bokeh.plotting.figure.asterisk`

* :func:`~bokeh.plotting.figure.circle`

* :func:`~bokeh.plotting.figure.circle_cross`

* :func:`~bokeh.plotting.figure.circle_x`

* :func:`~bokeh.plotting.figure.cross`

* :func:`~bokeh.plotting.figure.diamond`

* :func:`~bokeh.plotting.figure.diamond_cross`

* :func:`~bokeh.plotting.figure.hex`

* :func:`~bokeh.plotting.figure.inverted_triangle`

* :func:`~bokeh.plotting.figure.square`

* :func:`~bokeh.plotting.figure.square_cross`

* :func:`~bokeh.plotting.figure.square_x`

* :func:`~bokeh.plotting.figure.star`

* :func:`~bokeh.plotting.figure.triangle`

* :func:`~bokeh.plotting.figure.x`

You can combine multiple glyphs in a plot, even if some are rendered in WebGL,
and some are not.

Examples
--------

Here is an example of plotting ten thousand scatter circles with WebGL enabled.
Notice that the plot can be panned and zoomed smoothly, even without any
Level-of-Detail downsampling.

.. bokeh-plot:: ../../examples/webgl/scatter10k.py
    :source-position: above

Similarly, the plot below demonstrates plotting a single line with ten thousand
points.

.. bokeh-plot:: ../../examples/webgl/line10k.py
    :source-position: above

.. _WebGL: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API
.. _userguide_cli:

Using the command line
======================

You can produce a wide range of Bokeh outputs programmatically
with functions such as |output_file| and |output_notebook|.

However, this isn't the only way to work with the library. The ``bokeh`` command
line tool often offers better flexibility and makes iteration easier and faster.

For example:

``bokeh html``
    Create standalone HTML documents from any kind of Bokeh application
    source such as Python scripts, app directories, or JSON files.

``bokeh json``
    Generate a serialized JSON representation of a Bokeh document from any
    kind of Bokeh application source.

``bokeh serve``
    Publish Bokeh documents as interactive web applications.

An advantage of using the ``bokeh`` command on a command line is that the code
you write does not have to specify any particular output method or format. You
can write just the visualization code and decide how to output the results
later. This simplifies the above example as follows:

.. code-block:: python

    from bokeh.plotting import figure, curdoc

    p = figure()
    p.line(x=[1, 2, 3], y=[4,6,2])
    curdoc().add_root(p)

You can now run ``bokeh html foo.py`` to generate a standalone HTML file
or ``bokeh serve foo.py`` to start serving this document as a web application.

See :ref:`bokeh.command` in the |reference guide| for more information.
:orphan:
:orphan:

.. _userguide_notebook:

Working in the Notebook
=======================

This User's Guide chapter has moved to the :ref:`userguide_jupyter_notebook`
section of the :ref:`userguide_jupyter` chapter.
.. _userguide_categorical:

Handling categorical data
=========================

In addition to plotting numerical data on continuous ranges, you can also use
Bokeh to plot categorical data on categorical ranges.

Basic categorical ranges are represented in Bokeh as sequences of strings. For
example, a list of the four seasons:

.. code-block:: python

    seasons = ["Winter", "Spring", "Summer", "Fall"]

Bokeh can also handle hierarchical categories. For example, you can use nested
sequences of strings to represent the individual months within each yearly
quarter:

.. code-block:: python

    months_by_quarter = [
        ("Q1", "Jan"), ("Q1", "Feb"), ("Q1", "Mar"),
        ("Q2", "Apr"), ("Q2", "May"), ("Q2", "Jun"),
        ("Q3", "Jul"), ("Q3", "Aug"), ("Q3", "Sep"),
        ("Q4", "Oct"), ("Q4", "Nov"), ("Q4", "Dec"),
    ]

Depending on the structure of your data, you can use different kinds of charts:
bar charts, categorical heatmaps, jitter plots, and others. This chapter will
present several kinds of common plot types for categorical data.


.. _userguide_categorical_bars:

Bars
----

One of the most common ways to handle categorical data is to present it in a
bar chart. Bar charts have one categorical axis and one continuous axis. Bar
charts are useful when there is one value to plot for each category.

The values associated with each category are represented by drawing a bar for
that category. The length of this bar along the continuous axis corresponds to
the value for that category.

Bar charts may also be stacked or grouped together according to hierarchical
sub-categories. This section will demonstrate how to draw a variety of
different categorical bar charts.

.. _userguide_categorical_bars_basic:

Basic
~~~~~

To create a basic bar chart, use the |hbar| (horizontal bars) or |vbar|
(vertical bars) glyph methods. The example below shows a sequence of simple
1-level categories.

.. code-block:: python

    fruits = ['Apples', 'Pears', 'Nectarines', 'Plums', 'Grapes', 'Strawberries']

To assign these categories to the x-axis, pass this list as the
``x_range`` argument to |figure|.

.. code-block:: python

    p = figure(x_range=fruits, ... )

Doing so is a convenient shorthand for creating a
:class:`~bokeh.models.ranges.FactorRange` object.
The equivalent explicit notation is:

.. code-block:: python

    p = figure(x_range=FactorRange(factors=fruits), ... )

This form is useful when you want to customize the
``FactorRange``, for example, by changing the range
or category padding.

Next, call |vbar| with the list of fruit names as
the ``x`` coordinate and the bar height as the ``top``
coordinate. You can also specify ``width`` or other
optional properties.

.. code-block:: python

    p.vbar(x=fruits, top=[5, 3, 4, 2, 4, 6], width=0.9)

Combining the above produces the following output:

.. bokeh-plot:: docs/user_guide/examples/categorical_bar_basic.py
    :source-position: above

You can also assign the data to a |ColumnDataSource|
and supply it as the ``source`` parameter to |vbar|
instead of passing the data directly as parameters.
You will see this in later examples.

.. _userguide_categorical_bars_sorted:

Sorting
~~~~~~~

To order the bars of a given plot, sort the categories by
value.

The example below sorts the fruit categories in ascending order
based on counts and rearranges the bars accordingly.

.. bokeh-plot:: docs/user_guide/examples/categorical_bar_sorted.py
    :source-position: above

.. _userguide_categorical_bars_filled:

Filling
~~~~~~~

.. _userguide_categorical_bars_filled_colors:

Colors
''''''

You can color the bars in several ways:

* Supply all the colors along with the rest of the data to
  a |ColumnDataSource| and assign the name of the color column
  to the ``color`` argument of |vbar|.

  .. bokeh-plot:: docs/user_guide/examples/categorical_bar_colors.py
    :source-position: above

  You can also use the color column with the ``line_color`` and
  ``fill_color`` arguments to change outline and fill colors,
  respectively.

* Use the ``CategoricalColorMapper`` model to map bar colors in a browser.
  You can do this with the |factor_cmap| function.

  .. code-block:: python

      factor_cmap('fruits', palette=Spectral6, factors=fruits)

  You can then pass the result of this function to the ``color`` argument of
  |vbar| to achieve the same result:

  .. bokeh-plot:: docs/user_guide/examples/categorical_bar_colormapped.py
    :source-position: above

  See :ref:`userguide_styling_using_mappers` for more information on using
  Bokeh’s color mappers.

.. _userguide_categorical_bars_stacked:

Stacking
~~~~~~~~

To stack vertical bars, use the :func:`~bokeh.plotting.figure.vbar_stack`
function. The example below uses three sets of fruit data. Each set
corresponds to a year. This example produces a bar chart for each set and
stacks each fruit's bar elements on top of each other.

.. bokeh-plot:: docs/user_guide/examples/categorical_bar_stacked.py
    :source-position: above

You can also stack bars that represent positive and negative values:

.. bokeh-plot:: docs/user_guide/examples/categorical_bar_stacked_split.py
    :source-position: above

Tooltips
''''''''

Bokeh automatically sets the ``name`` property of each layer to
its name in the data set. You can use the ``$name`` variable to
display the names on tooltips. You can also use the ``@$name``
tooltip variable to retrieve values for each item in a layer from
the data set.

The example below demonstrates both behaviors:

.. bokeh-plot:: docs/user_guide/examples/categorical_bar_stacked_hover.py
    :source-position: above

You can override the value of ``name`` by passing it manually to
the ``vbar_stack`` or ``hbar_stack`` function. In this case,
``$@name`` will correspond to the names you provide.

The ``hbar_stack`` and ``vbar_stack`` functions return a list of
all the renderers (one per bar stack). You can use this list to
customize the tooltips for each layer.

.. code-block:: python

    renderers = p.vbar_stack(years, x='fruits', width=0.9, color=colors, source=source,
                             legend=[value(x) for x in years], name=years)

    for r in renderers:
        year = r.name
        hover = HoverTool(tooltips=[
            ("%s total" % year, "@%s" % year),
            ("index", "$index")
        ], renderers=[r])
        p.add_tools(hover)

.. _userguide_categorical_bars_grouped:

Grouping
~~~~~~~~

Instead of stacking, you also have the option to group the bars. Depending on
your use case, you can achieve this in two ways:

* :ref:`With nested categories <userguide_categorical_bars_grouped_nested>`
* :ref:`With visual offsets <userguide_categorical_bars_grouped_dodged>`

.. _userguide_categorical_bars_grouped_nested:

Nested categories
'''''''''''''''''

If you provide several subsets of data, Bokeh automatically groups the bars into
labeled categories, tags each bar with the name of the subset it
represents, and adds a separator between the categories.

The example below creates a sequence of fruit-year pairs (tuples) and
groups the bars by fruit name with a single call to |vbar|.

.. bokeh-plot:: docs/user_guide/examples/categorical_bar_nested.py
    :source-position: above

To apply different colors to the bars, use |factor_cmap| for
``fill_color`` in the |vbar| function call as follows:

.. code-block:: python

    p.vbar(x='x', top='counts', width=0.9, source=source, line_color="white",

           # use the palette to colormap based on the the x[1:2] values
           fill_color=factor_cmap('x', palette=palette, factors=years, start=1, end=2))


The ``start=1`` and ``end=2`` in the call to |factor_cmap| use the
year in the ``(fruit, year)`` pair for color mapping.

.. bokeh-plot:: docs/user_guide/examples/categorical_bar_nested_colormapped.py
    :source-position: none

.. _userguide_categorical_bars_grouped_dodged:

Visual offset
'''''''''''''

Take a scenario with separate sequences of ``(fruit, year)`` pairs
instead of a single data table. You can plot the sequences with
separate calls to |vbar|. However, since every bar in each group
belongs to the same ``fruit`` category, the bars will overlap. To
avoid this behavior, use the :func:`~bokeh.transform.dodge` function
to provide an offset for each call to |vbar|.

.. bokeh-plot:: docs/user_guide/examples/categorical_bar_dodged.py
    :source-position: above

.. _userguide_categorical_bars_stacked_and_grouped:

Stacking and grouping
~~~~~~~~~~~~~~~~~~~~~

You can also combine the above techniques to create plots of stacked and
grouped bars. Here is an example that groups bars by quarter and stacks
them by region:

.. bokeh-plot:: docs/user_guide/examples/categorical_bar_stacked_grouped.py
    :source-position: above

.. _userguide_categorical_bars_mixed:

Mixed factors
~~~~~~~~~~~~~

You can use any level in a multi-level data structure to position glyphs.

The example below groups bars for each month into financial quarters and
adds a quarterly average line at the group center coordinates from ``Q1``
to ``Q4``.

.. bokeh-plot:: docs/user_guide/examples/categorical_bar_mixed.py
    :source-position: above

.. _userguide_categorical_bars_pandas:

Using pandas
~~~~~~~~~~~~

`pandas`_ is a powerful and popular tool for analyzing tabular and time series
data in Python. While not necessary, it can make working with Bokeh easier.

For example, you can use the ``GroupBy`` objects offered by pandas to
initialize a ``ColumnDataSource`` and automatically create columns for many
statistical parameters, such as group mean and count. You can also pass these
``GroupBy`` objects as a ``range`` argument to ``figure``.

.. bokeh-plot:: docs/user_guide/examples/categorical_bar_pandas_groupby_colormapped.py
    :source-position: above

The example above groups data by the column ``'cyl'``, which is why the
``ColumnDataSource`` includes this column. It also adds associated columns
to non-grouped categories such as ``'mpg'``, providing, for instance, a mean
number of miles per gallon in the ``'mpg_mean'`` column.

This also works with multi-level groups. The example below groups the same
data by ``('cyl', 'mfr')`` and displays it in nested categories distributed
along the x-axis. Here, the index column name ``'cyl_mfr'`` is made by
joining the names of the grouped columns.

.. bokeh-plot:: docs/user_guide/examples/categorical_bar_pandas_groupby_nested.py
    :source-position: above

.. _userguide_categorical_bars_intervals:

Intervals
---------

You can use bars for more than just bar charts with a common baseline. In case
each category has both a starting and ending value associated, you can also
use bars to represent intervals across a range for each category.

The example below supplies the |hbar| function with both ``left`` and
``right`` properties to show the spread in times between gold and bronze
medalists in Olympic sprinting over many years.

.. bokeh-plot:: docs/user_guide/examples/categorical_bar_intervals.py
    :source-position: above

.. _userguide_categorical_scatters:

Scatters
--------

Sometimes there are many values associated with each category. For example, a
series of measurements on different days of the week. In this case, you can
visualize your data using a categorical scatter plot.

.. .. bokeh-plot:: docs/user_guide/examples/categorical_scatter.py
..     :source-position: above

.. _userguide_categorical_scatters_jitter:

Adding jitter
~~~~~~~~~~~~~

To avoid overlap between numerous scatter points for a single category, use
the :func:`~bokeh.transform.jitter` function to give each point a random
offset.

The example below shows a scatter plot of every commit time for a GitHub user
between 2012 and 2016. It groups commits by day of the week. By default, this
plot would show thousands of points overlapping in a narrow line for each day.
The ``jitter`` function lets you differentiate the points to produce a useful
plot:

.. bokeh-plot:: docs/user_guide/examples/categorical_scatter_jitter.py
    :source-position: above

Series
------

There may also be ordered series of data associated with each category. In such
cases, the series can be represented as a line or area plotted for each
category.
To accomplish this, Bokeh has a concept of categorical offsets that can afford
explicit control over positioning "within" a category.

.. _userguide_categorical_offsets:

Categorical offsets
~~~~~~~~~~~~~~~~~~~

Outside of the ``dodge`` and ``jitter`` functions, you can also supply an
offset to a categorical location explicitly. To do so, add a numeric value
to the end of a category. For example, ``["Jan", 0.2]`` gives the category
"Jan" an offset of 0.2.

For multi-level categories, add the value at the end of the existing list:
``["West", "Sales", -0,2]``. Bokeh interprets any numeric value at the end
of a list of categories as an offset.

Take the fruit example above and modify it as follows:

.. code-block:: python

    fruits = ['Apples', 'Pears', 'Nectarines', 'Plums', 'Grapes', 'Strawberries']

    offsets = [-0.5, -0.2, 0.0, 0.3, 0.1, 0.3]

    # This results in [ ['Apples', -0.5], ['Pears', -0.2], ... ]
    x = list(zip(fruits, offsets))

    p.vbar(x=x, top=[5, 3, 4, 2, 4, 6], width=0.8)

This will shift each bar horizontally by the corresponding offset.

.. bokeh-plot:: docs/user_guide/examples/categorical_offset.py
    :source-position: none

Below is a more sophisticated example of a ridge plot. It uses
categorical offsets to specify patch coordinates for each
category.

.. bokeh-plot:: docs/user_guide/examples/categorical_ridgeplot.py
    :source-position: below

.. _userguide_categorical_heatmaps:

Heatmaps
--------

It is possible to have values associated with *pairs* of categories. In this
situation, applying different color shades to rectangles that represent a pair
of categories will produce a *categorical heatmap*. Such a plot has two
categorical axes.

The following plot lists years from 1948 to 2016 on its x-axis and months of
the year on the y-axis. Each rectangle of the plot corresponds to a
``(year, month)`` pair. The color of the rectangle indicates the rate of
unemployment in a given month of a given year.

This example uses the ``LinearColorMapper`` to map the colors of the plot
because the unemployment rate is a continuous variable. This mapper is also
passed to the color bar to provide a visual legend on the right:

.. bokeh-plot:: docs/user_guide/examples/categorical_heatmap_unemployment.py
    :source-position: below

The following periodic table is a good example of the techniques
in this chapter:

* Color mappers
* Visual offsets
* pandas DataFrames
* Tooltips

.. bokeh-plot:: docs/user_guide/examples/categorical_heatmap_periodic.py
    :source-position: below

.. _pandas: http://pandas.pydata.org
.. _userguide_tools:

Configuring plot tools
======================

Bokeh comes with a number of interactive tools that you can use to report
information, to change plot parameters such as zoom level or range extents,
or to add, edit, or delete glyphs. Tools can be grouped into four basic
categories:

Gestures
    These tools respond to single gestures, such as a pan movement.
    The types of gesture tools are:

    - :ref:`userguide_tools_pandrag`
    - :ref:`userguide_tools_clicktap`
    - :ref:`userguide_tools_scrollpinch`

    For each type of gesture, only one tool can be active at any given time.
    The active tool is highlighted on the toolbar next to the
    tool icon.

:ref:`userguide_tools_actions`
    These are immediate or modal operations that are only activated when their
    button in the toolbar is pressed, such as the ``ResetTool``.

:ref:`userguide_tools_inspectors`
    These are passive tools that report information or annotate plots in some
    way, such as the ``HoverTool`` or ``CrosshairTool``.

:ref:`userguide_tools_edit`
    These are sophisticated multi-gesture tools that can add, delete, or modify
    glyphs on a plot. Since they may respond to several gestures at once, an
    edit tool when activated will potentially deactivate multiple single-gesture tools.

This chapter contains information about all the individual tools and describes how
the toolbar may be configured.

.. _userguide_tools_toolbar:

Positioning the toolbar
-----------------------

By default, Bokeh plots come with a toolbar above the plot. You can change the
location of the toolbar or remove it.

You can specify the toolbar location by passing the ``toolbar_location``
parameter to the |figure| function. Valid values are:

* ``"above"``
* ``"below"``
* ``"left"``
* ``"right"``

If you would like to hide the toolbar entirely, pass ``None``.

The code below positions the toolbar below the plot. Try
running the code and changing the ``toolbar_location`` value.

.. bokeh-plot:: docs/user_guide/examples/tools_position_toolbar_clash.py
    :source-position: above

Note that the toolbar position clashes with the default axes. In this case,
setting the ``toolbar_sticky`` option to ``False`` will move the toolbar
outside of the area where the axis is drawn.

.. bokeh-plot:: docs/user_guide/examples/tools_position_toolbar.py
    :source-position: above

.. _userguide_tools_specifying_tools:

Specifying tools
----------------

At the lowest |bokeh.models| level, you can add tools to a ``Plot`` by
passing instances of ``Tool`` objects to the ``add_tools()`` method:

.. code-block:: python

    from bokeh.models import LassoSelectTool, Plot, WheelZoomTool

    plot = Plot()
    plot.add_tools(LassoSelectTool())

    wheel = WheelZoomTool()
    plot.add_tools(wheel)

This way of adding tools works with any Bokeh ``Plot`` or ``Plot`` subclass,
such as ``figure``.

You can specify tools by passing the ``tools`` parameter to the |figure|
function. The tools parameter accepts a list of tool objects, for example:

.. code-block:: python

    from bokeh.models import BoxZoomTool, ResetTool
    from bokeh.plotting import figure

    plot = figure(tools=[BoxZoomTool(), ResetTool()])

You can also add multiple tools with a comma-separated string
containing tool shortcut names:

.. code-block:: python

    from bokeh.plotting import figure

    plot = figure(tools="pan,wheel_zoom,box_zoom,reset")

This method does not allow setting properties of the tools.

Remove tools by passing a tool object to the ``remove_tools()`` method of a plot.

.. code-block:: python

    from bokeh.models import BoxSelectTool, WheelZoomTool
    from bokeh.plotting import figure

    tools = box, wheel = BoxSelectTool(dimensions="width"), WheelZoomTool()
    plot = figure(tools=tools)

    plot.remove_tools(box)

.. _userguide_tools_customize_tools_icon:

Customizing tools icon
----------------------
You can change the :ref:`bokeh.models.tools` tooltip by passing it to
the ``description`` keyword using the ``add_tools()`` method of a plot or any
of it's instances like |figure|.

.. code-block:: python

    plot.add_tools(BoxSelectTool(description="My tool"))

It's also possible to change a tool icon using the ``icon`` keyword.

You can pass:

    1. A well known icon name

        .. code-block:: python

            plot.add_tools(BoxSelectTool(icon="box_zoom"))

    2. A CSS selector

        .. code-block:: python

            plot.add_tools(BoxSelectTool(icon=".my-icon-class"))

    3. An image path

        .. code-block:: python

            plot.add_tools(BoxSelectTool(icon="path/to/icon"))

.. _userguide_tools_setting_active_tools:

Setting the active tools
------------------------

Bokeh toolbars can have at most one active tool from each kind of gesture
(drag, scroll, tap).

However, it is possible to exert control over which tool is active. At the
lowest |bokeh.models| level, you can do this by using the ``active_drag``,
``active_inspect``, ``active_scroll``, and ``active_tap`` properties of
``Toolbar``. These properties can take the following values:

* ``None`` --- there is no active tool of this kind
* ``"auto"`` --- Bokeh chooses a tool of this kind to be active (possibly none)
* a ``Tool`` instance --- Bokeh sets the given tool to be the active tool

Additionally, the ``active_inspect`` tool may accept:
* A sequence of ``Tool`` instances to be set as the active tools

As an example:

.. code-block:: python

    # configure so that no drag tools are active
    plot.toolbar.active_drag = None

    # configure so that Bokeh chooses what (if any) scroll tool is active
    plot.toolbar.active_scroll = "auto"

    # configure so that a specific PolySelect tap tool is active
    plot.toolbar.active_tap = poly_select

    # configure so that a sequence of specific inspect tools are active
    # note: this only works for inspect tools
    plot.toolbar.active_inspect = [hover_tool, crosshair_tool]

The default value for all of these properties is ``"auto"``.

You can specify active tools by passing these properties as keyword
arguments to the |figure| function. It is also possible to pass any one of
the string names:

.. code-block:: python

    # configures the lasso tool to be active
    plot = figure(tools="pan,lasso_select,box_select", active_drag="lasso_select")

.. _userguide_tools_pandrag:

Pan/Drag tools
--------------

You can use these tools by panning (on touch devices) or left-dragging (on
mouse devices). Only one pan/drag tool may be active at a time. Where
applicable, Pan/Drag tools will respect any max and min values set on ranges.

BoxSelectTool
~~~~~~~~~~~~~

* name: ``'box_select'``
* icon: |box_select_icon|

The box selection tool allows you to define a rectangular selection
by left-dragging a mouse, or dragging a finger across the plot area.
You can configure the box select tool to select across only one dimension by
setting the ``dimensions`` property to ``width`` or ``height`` instead of the
default ``both``.

After a selection is made, the indices of the selected points are available
from properties on the |Selection| object for a glyph data source. For example:

.. code-block:: python

    source.selected.indices

will hold the selected indices in the common case of a "scatter" type glyph.

.. note::
    To make multiple selections, press the SHIFT key. To clear the
    selection, press the ESC key.

BoxZoomTool
~~~~~~~~~~~

* name: ``'box_zoom'``
* icon: |box_zoom_icon|

The box zoom tool allows you to define a rectangular region to zoom the
plot bounds to by left-dragging a mouse, or dragging a finger across the
plot area.

LassoSelectTool
~~~~~~~~~~~~~~~

* name: ``'lasso_select'``
* icon: |lasso_select_icon|

The lasso selection tool allows you to define an arbitrary region for
selection by left-dragging a mouse, or dragging a finger across the plot area.

After a selection is made, the indices of the selected points are available
from properties on the |Selection| object for a glyph data source. For example:

.. code-block:: python

    source.selected.indices

will hold the selected indices in the common case of a "scatter" type glyph.

.. note::
    To make a multiple selection, press the SHIFT key. To clear the selection,
    press the ESC key.

PanTool
~~~~~~~

* name: ``'pan'``, ``'xpan'``, ``'ypan'``,
* icon: |pan_icon|

The pan tool allows you to pan the plot by left-dragging a mouse or dragging a
finger across the plot region.

You can configure the pan tool to act only on either the x-axis or
the y-axis by setting the ``dimensions`` property to a list containing ``width``
or ``height``. Additionally, there are tool names ``'xpan'`` and ``'ypan'``,
respectively.

.. _userguide_tools_clicktap:

Click/Tap tools
---------------

Use these tools by tapping (on touch devices) or left-clicking (on
mouse devices). Only one click/tap tool may be active at a time.

PolySelectTool
~~~~~~~~~~~~~~

* name: ``'poly_select'``
* icon: |poly_select_icon|

The polygon selection tool allows you to define an arbitrary polygonal
region for selection by left-clicking a mouse, or tapping a finger at different
locations.

After a selection is made, the indices of the selected points are available
from properties on the |Selection| object for a glyph data source. For example:

.. code-block:: python

    source.selected.indices

will hold the selected indices in the common case of a "scatter" type glyph.

.. note::
    Complete the selection by making a double left-click or tapping. To make a
    multiple selection, press the SHIFT key. To clear the selection, press the
    ESC key.

TapTool
~~~~~~~

* name: ``'tap'``
* icon: |tap_icon|

The tap selection tool allows you to select single points by clicking
the left mouse button, or tapping with a finger.

After a selection is made, the indices of the selected points are available
from properties on the |Selection| object for a glyph data source. For example:

.. code-block:: python

    source.selected.indices

will hold the selected indices in the common case of a "scatter" type glyph.

.. note::
    To make a multiple selection, press the SHIFT key. To clear the selection,
    press the ESC key.

.. _userguide_tools_scrollpinch:

Scroll/Pinch tools
------------------

Use these tools by pinching (on touch devices) or scrolling (on
mouse devices). Only one scroll/pinch tool may be active at a time.

WheelZoomTool
~~~~~~~~~~~~~

* name: ``'wheel_zoom'``, ``'xwheel_zoom'``, ``'ywheel_zoom'``
* icon: |wheel_zoom_icon|

You can use the wheel zoom tool to zoom the plot in and out, centering on the current
mouse location. It will respect any min and max values and ranges, preventing
zooming in and out beyond these values.

You can configure the wheel zoom tool to act only on either
the x-axis or the y-axis by setting the ``dimensions`` property to
a list containing ``width`` or ``height``. Additionally, there are tool names
``'xwheel_zoom'`` and ``'ywheel_zoom'``, respectively.

WheelPanTool
~~~~~~~~~~~~

* name: ``'xwheel_pan'``, ``'ywheel_pan'``
* icon: |wheel_pan_icon|

The wheel pan tool translates the plot window along a specified
dimension without changing the window's aspect ratio. It will respect any
min and max values and ranges, preventing panning beyond these values.

.. _userguide_tools_actions:

Actions
-------

Actions are operations that are activated only when their button in the toolbar
is tapped or clicked. They are typically modal or immediate-acting.

UndoTool
~~~~~~~~

* name: ``'undo'``
* icon: |undo_icon|

The undo tool restores the previous state of the plot.

RedoTool
~~~~~~~~

* name: ``'redo'``
* icon: |redo_icon|

The redo tool reverses the last action performed by the undo tool.

ResetTool
~~~~~~~~~

* name: ``'reset'``
* icon: |reset_icon|

The reset tool restores the plot ranges to their original values.

SaveTool
~~~~~~~~

* name: ``'save'``
* icon: |save_icon|

The save tool allows you to save a PNG image of the plot. By default, you will be
prompted for a filename. Alternatively, you can create an instance of the tool
yourself and provide a filename:

.. code-block:: python

    SaveTool(filename='custom_filename') # png extension not needed

Either way, the file will then be downloaded directly or a modal dialog will open
depending on your browser.

ZoomInTool
~~~~~~~~~~

* name: ``'zoom_in'``, ``'xzoom_in'``, ``'yzoom_in'``
* icon: |zoom_in_icon|

The zoom-in tool increases the zoom of the plot. It will respect any min and max
values and ranges, preventing zooming in and out beyond these.

You can configure the wheel zoom tool to act only on either
the x-axis or the y-axis by setting the ``dimensions`` property to
a list containing ``width`` or ``height``. Additionally, there are tool names
``'xzoom_in'`` and ``'yzoom_in'``, respectively.

ZoomOutTool
~~~~~~~~~~~

* name: ``'zoom_out'``, ``'xzoom_out'``, ``'yzoom_out'``
* icon: |zoom_out_icon|

The zoom-out tool decreases the zoom level of the plot. It will respect any min and
max values and ranges, preventing zooming in and out beyond these values.

You can configure the wheel zoom tool to act only on either
the x-axis or the y-axis by setting the ``dimensions`` property to
a list containing ``width`` or ``height``. Additionally, there are tool names
``'xzoom_in'`` and ``'yzoom_in'``, respectively.

.. _userguide_tools_inspectors:

Inspectors
----------

Inspectors are passive tools that annotate or report information about
the plot based on the current cursor position. Multiple inspectors may be
active at any given time. You can toggle the active state of an inspector
in the inspectors menu in the toolbar.

CrosshairTool
~~~~~~~~~~~~~

* name: ``'crosshair'``
* menu icon: |crosshair_icon|

The crosshair tool draws a crosshair annotation over the plot, centered on
the current mouse position. You can configure the crosshair tool dimensions
by setting the ``dimensions`` property to ``width``, ``height``, or ``both``.

.. _userguide_tools_hover_tool:

HoverTool
~~~~~~~~~

* name: ``'hover'``
* menu icon: |hover_icon|

The hover tool is a passive inspector tool. It defaults to be on at all times,
but you can change this in the inspector’s menu in the toolbar.

.. _userguide_tools_basic_tooltips:

Basic Tooltips
''''''''''''''

By default, the hover tool generates a "tabular" tooltip where each row
contains a label and its associated value. The labels and values are supplied
as a list of *(label, value)* tuples. For instance, the tooltip below on the
left was created with the accompanying ``tooltips`` definition on the right.

.. this kind of sucks but gets the job done (aligns hover basic image vertically)

.. raw:: html

    <style>
        div.valign-center > table > tbody { vertical-align: middle !important; }
    </style>

.. container:: valign_center

    +--------------------+-----------------------------------------------------------+
    |                    |::                                                         |
    |                    |                                                           |
    |                    |    hover.tooltips = [                                     |
    |                    |        ("index", "$index"),                               |
    |                    |        ("(x,y)", "($x, $y)"),                             |
    |   |hover_basic|    |        ("radius", "@radius"),                             |
    |                    |        ("fill color", "$color[hex, swatch]:fill_color"),  |
    |                    |        ("fill color", "$color[hex]:fill_color"),          |
    |                    |        ("fill color", "$color:fill_color"),               |
    |                    |        ("fill color", "$swatch:fill_color"),              |
    |                    |        ("foo", "@foo"),                                   |
    |                    |        ("bar", "@bar"),                                   |
    |                    |    ]                                                      |
    +--------------------+-----------------------------------------------------------+

Field names that begin with ``$`` are "special fields". These often correspond
to values that are part of the plot, such as the coordinates of the mouse
in data or screen space. These special fields are listed here:

:``$index``:
    index of selected point in the data source
:``$name``:
    value of the ``name`` property of the hovered glyph renderer
:``$x``:
    x-coordinate under the cursor in data space
:``$y``:
    y-coordinate under the cursor in data space
:``$sx``:
    x-coordinate under the cursor in screen (canvas) space
:``$sy``:
    y-coordinate under the cursor in screen (canvas) space
:``$color``:
    colors from a data source, with the syntax: ``$color[options]:field_name``.
    The available options are: ``hex`` (to display the color as a hex value),
    ``swatch`` (color data from data source displayed as a small color box).
:``$swatch``:
    color data from data source displayed as a small color box.

Field names that begin with ``@`` are associated with columns in a
``ColumnDataSource``. For instance, the field name ``"@price"`` will display
values from the ``"price"`` column whenever a hover is triggered. If the hover
is for the 17th glyph instance, then the hover tooltip will display the 17th price value.

Note that if a column name contains spaces, it must be surrounded by
curly braces. For example, configuring ``@{adjusted close}`` will display values
from a column named ``"adjusted close"``.

Sometimes, especially with stacked charts, it is desirable to allow the
name of the column to be specified indirectly. In this case, use the field name
``@$name`` to look up the ``name`` field on the hovered glyph renderer, and use
that value as the column name. For instance, if you hover with the name
``"US East"``, then ``@$name`` is equivalent to ``@{US East}``.

Here is a complete example of how to configure and use the hover tool by setting
the ``tooltips`` argument to ``figure``:

.. bokeh-plot:: docs/user_guide/examples/tools_hover_tooltips.py
    :source-position: above

Hit-Testing behavior
''''''''''''''''''''

The hover tool displays tooltips associated with individual glyphs. You can configure
these tooltips to activate in different ways with a ``mode`` property:

:``"mouse"``:
    only when the mouse is directly over a glyph

:``"vline"``:
    whenever a vertical line from the mouse position intersects a glyph

:``"hline"``:
    whenever a horizontal line from the mouse position intersects a glyph

The default configuration is ``mode = "mouse"``. See this in the
:ref:`userguide_tools_basic_tooltips` example above. The example below in
:ref:`userguide_tools_formatting_tooltip_fields` demonstrates ``mode = "vline"``.

.. _userguide_tools_formatting_tooltip_fields:

Formatting tooltip fields
'''''''''''''''''''''''''

By default, values for fields (``@foo``, for example) are displayed in a basic numeric
format. To control the formatting of values, you can modify fields by appending
a specified format to the end in curly braces. Some examples are below.

.. code-block:: python

    "@foo{0,0.000}"    # formats 10000.1234 as: 10,000.123

    "@foo{(.00)}"      # formats -10000.1234 as: (10000.123)

    "@foo{($ 0.00 a)}" # formats 1230974 as: $ 1.23 m

The examples above all use the default formatting scheme. There are
other formatting schemes you can specify:

:``"numeral"``:
    Provides a wide variety of formats for numbers, currency, bytes, times,
    and percentages. The full set of formats can be found in the
    |NumeralTickFormatter| reference documentation.

:``"datetime"``:
    Provides formats for date and time values. The full set of formats is
    listed in the |DatetimeTickFormatter| reference documentation.

:``"printf"``:
    Provides formats similar to C-style "printf" type specifiers. See the
    |PrintfTickFormatter| reference documentation for complete details.

You can add these by configuring the ``formatters`` property of a hover
tool. This property maps tooltip variables to format schemes. For example, to
use the ``"datetime"`` scheme for formatting a column ``"@{close date}"``,
set the value:

.. code-block:: python

    hover_tool.formatters = { "@{close date}": "datetime"}

You can also supply formatters for "special variables" such as ``"$x"``:

.. code-block:: python

    hover_tool.formatters = { "$x": "datetime"}

If a formatter is not specified for a column name, the default ``"numeral"``
formatter is assumed.

Note that format specifications are also compatible with column names that
have spaces. For example, ``@{adjusted close}{($ 0.00 a)}`` applies a format
to a column named "adjusted close".

The example code below configures a ``HoverTool`` with different formatters
for different fields:

.. code-block:: python

    HoverTool(
        tooltips=[
            ( 'date',   '@date{%F}'            ),
            ( 'close',  '$@{adj close}{%0.2f}' ), # use @{ } for field names with spaces
            ( 'volume', '@volume{0.00 a}'      ),
        ],

        formatters={
            '@date'        : 'datetime', # use 'datetime' formatter for '@date' field
            '@{adj close}' : 'printf',   # use 'printf' formatter for '@{adj close}' field
                                         # use default 'numeral' formatter for other fields
        },

        # display a tooltip whenever the cursor is vertically in line with a glyph
        mode='vline'
    )

You can see the output generated from this configuration by hovering the mouse
over the plot below:

.. bokeh-plot:: docs/user_guide/examples/tools_hover_tooltip_formatting.py
    :source-position: none

The |CustomJSHover| model allows you to use JavaScript to specify a custom
formatter that can display derived quantities in the tooltip.

.. _userguide_tools_image_hover:

Image hover
'''''''''''

You can use the hover tool to inspect image glyphs which may contain
layers of data in the corresponding ``ColumnDataSource``:

.. bokeh-plot:: docs/user_guide/examples/tools_hover_tooltips_image.py
    :source-position: above

In this example, three image patterns are defined, ``ramp``,
``steps``, and ``bitmask``. The hover tooltip shows the index of the
image, the name of the pattern, the ``x`` and ``y`` position of the
cursor, as well as the corresponding value and value squared.

.. _custom_hover_tooltip:

Custom tooltip
''''''''''''''

You can supply a custom HTML template for a tooltip. To do
this, pass an HTML string with the Bokeh tooltip field name symbols wherever
substitutions are desired. All of the information above regarding formats
still applies. Note that you can also use the ``{safe}`` format after the
column name to disable the escaping of HTML in the data source. See the example
below:

.. bokeh-plot:: docs/user_guide/examples/tools_hover_custom_tooltip.py
    :source-position: above


.. _userguide_tools_edit:

Edit tools
----------

The edit tools provide functionality for drawing and editing glyphs
client-side by adding, modifying, and deleting ``ColumnDataSource``
data.

All the edit tools share a small number of key bindings:

SHIFT
  Modifier key to add to selection or start drawing

BACKSPACE
  Deletes the selected glyphs

ESC
  Clears the selection

.. note::
   On MacBooks and some other keyboards, the BACKSPACE key is labeled
   "delete".

BoxEditTool
~~~~~~~~~~~

* name: ``'box_edit'``
* menu icon: |box_edit_icon|

The BoxEditTool() allows you to draw, drag, and delete ``Rect`` glyphs
on one or more renderers by editing the underlying ``ColumnDataSource``
data. Like other drawing tools, you must pass the renderers to be edited
as a list:

.. code-block:: python

    r1 = p.rect('x', 'y', 'width', 'height', source=source)
    r2 = p.rect('x', 'y', 'width', 'height', source=source2)
    tool = BoxEditTool(renderers=[r1, r2])

The tool automatically modifies the columns of the data source
corresponding to the ``x``, ``y``, ``width``, and ``height`` values of
the glyph. Any additional columns in the data source will be padded with
the declared ``empty_value`` when adding a new point. Any newly added
points will be inserted in the ``ColumnDataSource`` of the first supplied
renderer.

It is often useful to limit the number of elements that can be
drawn. For example, when specifying a certain number of regions of interest.
Using the ``num_objects`` property, you can ensure that once the limit
has been reached, the oldest box will be popped off the queue to make
space for the newest box being added.

.. raw:: html

    <img src="https://docs.bokeh.org/static/box_edit_keyboard_optimized.gif"
     width='400px' alt="Animation showing box draw, select, and delete actions">

The animation above shows the supported tool actions, highlighting
mouse actions with a circle around the cursor, and key strokes by
showing the pressed keys. The ``BoxEditTool`` can **Add**, **Move**
and **Delete** boxes on plots:

Add box
  Hold shift, then click and drag anywhere on the plot or double tap
  once to start drawing. Move the mouse and double tap again to
  finish drawing.

Move box
  Click and drag an existing box. The box will be dropped once you let
  go of the mouse button.

Delete box
  Tap a box to select it, then press the BACKSPACE key while the mouse is
  within the plot area.

To **Move** or **Delete** multiple boxes at once:

Move selection
  Select box(es) with SHIFT+tap (or another selection tool) then drag
  anywhere on the plot. Selecting and then dragging on a specific box
  will move both.

Delete selection
  Select box(es) with SHIFT+tap (or another selection tool) then press
  BACKSPACE while the mouse is within the plot area.

.. bokeh-plot:: docs/user_guide/examples/tools_box_edit.py
    :source-position: none


FreehandDrawTool
~~~~~~~~~~~~~~~~

* name: ``'freehand_draw'``
* menu icon: |freehand_draw_icon|

The ``FreehandDrawTool()`` allows freehand drawing of lines and polygons
using the ``Patches`` and ``MultiLine`` glyphs, by editing the
underlying ``ColumnDataSource`` data. Like other drawing tools,
you must pass the renderers to be edited as a list:

.. code-block:: python

    r = p.multi_line('xs', 'ys' source=source)
    tool = FreehandDrawTool(renderers=[r])

The tool automatically modifies the columns on the data source
corresponding to the ``xs`` and ``ys`` values of the glyph. Any
additional columns in the data source will be padded with the declared
``empty_value`` when adding a new point. Any newly added points will
be inserted in the ``ColumnDataSource`` of the first supplied
renderer.

It is also often useful to limit the number of elements that can be
drawn. For example, when specifying a specific number of regions of interest.
Using the ``num_objects`` property, you can ensure that once the limit
has been reached, the oldest patch/multi-line will be popped off the
queue to make space for the new patch/multi-line being added.

.. raw:: html

    <img src="https://docs.bokeh.org/static/freehand_draw_keyboard_optimized.gif"
     width='400px' alt="Animation showing freehand drawing and delete actions">

The animation above shows the supported tool actions, highlighting
mouse actions with a circle around the cursor, and key strokes by
showing the pressed keys. The ``PolyDrawTool`` can **Draw** and
**Delete** patches and multi-lines:

Draw patch/multi-line
  Click and drag to start drawing and release the mouse button to
  finish drawing.

Delete patch/multi-line
  Tap a line or patch to select it then press the BACKSPACE key while the
  mouse is within the plot area.

 To **Delete** multiple patches/lines at once:

Delete selection
  Select patches/lines with SHIFT+tap (or another selection tool), then
  press BACKSPACE while the mouse is within the plot area.

PointDrawTool
~~~~~~~~~~~~~

* name: ``'point_draw'``
* menu icon: |point_draw_icon|

The ``PointDrawTool()`` allows you to add, drag, and delete point-like
glyphs (of ``XYGlyph`` type) on one or more renderers by editing the
underlying ``ColumnDataSource`` data. Like other drawing tools,
you must pass the renderers to be edited as a list:

.. code-block:: python

    c1 = p.circle('x', 'y', 'width', 'height', source=source)
    r1 = p.rect('x', 'y', 0.1, 0.1, source=source2)
    tool = PointDrawTool(renderers=[c1, r1])

The tool automatically modifies the columns on the data source
corresponding to the ``x`` and ``y`` values of the glyph. Any
additional columns in the data source will be padded with the declared
``empty_value`` when adding a new point. Any newly added points will
be inserted in the ``ColumnDataSource`` of the first supplied
renderer.

It is also often useful to limit the number of elements that can be
drawn. Using the ``num_objects`` property, you can ensure that once the
limit has been reached, the oldest point will be popped off the queue
to make space for the new point being added.

.. raw:: html

    <img src="https://docs.bokeh.org/static/point_draw_keyboard_optimized.gif"
     width='400px' alt="Animation showing point draw, drag, select, and delete actions">

The animation above shows the supported tool actions, highlighting
mouse actions with a circle around the cursor, and key strokes by
showing the pressed keys. The PointDrawTool can **Add**, **Move**, and
**Delete** point-like glyphs on plots:

Add point
  Tap anywhere on the plot.

Move point
  Tap and drag an existing point. The point will be dropped once
  you let go of the mouse button.

Delete point
  Tap a point to select it then press BACKSPACE key while the mouse is
  within the plot area.

To **Move** or **Delete** multiple points at once:

Move selection
  Select point(s) with SHIFT+tap (or another selection tool), then drag
  anywhere on the plot. Selecting and then dragging a specific point
  will move both.

Delete selection
  Select point(s) with SHIFT+tap (or another selection tool), then
  press BACKSPACE while the mouse is within the plot area.

.. bokeh-plot:: docs/user_guide/examples/tools_point_draw.py
    :source-position: none


PolyDrawTool
~~~~~~~~~~~~

* name: ``'poly_draw'``
* menu icon: |poly_draw_icon|

The ``PolyDrawTool()`` allows you to draw, select, and delete
``Patches`` and ``MultiLine`` glyphs on one or more renderers by
editing the underlying ``ColumnDataSource`` data. Like other drawing tools,
you must pass the renderers to be edited as a list.

The tool automatically modifies the columns on the data source
corresponding to the ``xs`` and ``ys`` values of the glyph. Any
additional columns in the data source will be padded with the declared
``empty_value``, when adding a new point. Any newly added patch or
multi-line will be inserted on the ``ColumnDataSource`` of the first
supplied renderer.

It is also often useful to limit the number of elements that can be
drawn. For example, when specifying a specific number of regions of interest.
Using the ``num_objects`` property, you can ensure that once the limit
has been reached the oldest patch/multi-line will be popped off the
queue to make space for the new patch/multi-line being added.

If a ``vertex_renderer`` with a point-like glyph is supplied, the
PolyDrawTool will use it to display the vertices of the
multi-lines/patches on all supplied renderers. This also enables the
ability to snap to existing vertices while drawing.

.. raw:: html

    <img src="https://docs.bokeh.org/static/poly_draw_keyboard_optimized.gif"
     width='400px' alt="Animation showing polygon draw, select, and delete actions">

The animation above shows the supported tool actions, highlighting
mouse actions with a circle around the cursor, and key strokes by
showing the pressed keys. The ``PolyDrawTool`` can **Add**, **Move**,
and **Delete** patches and multi-lines:

Add patch/multi-line
  Double tap to add the first vertex, then use tap to add each
  subsequent vertex. To finalize the draw action, double tap to insert
  the final vertex or press the ESC key.

Move patch/multi-line
  Tap and drag an existing patch/multi-line. The point will be dropped
  once you let go of the mouse button.

Delete patch/multi-line
  Tap a patch/multi-line to select it, then press the BACKSPACE key while
  the mouse is within the plot area.

.. bokeh-plot:: docs/user_guide/examples/tools_poly_draw.py
    :source-position: none


PolyEditTool
~~~~~~~~~~~~~~

* name: ``'poly_edit'``
* menu icon: |poly_edit_icon|

The PolyEditTool() allows you to edit the vertices of one or more
``Patches`` or ``MultiLine`` glyphs. You can define the glyphs to be
edited with the ``renderers`` property. You can define the renderer
for the vertices with the ``vertex_renderer``. It must
render a point-like Glyph (of ``XYGlyph`` type).

The tool automatically modifies the columns on the data source
corresponding to the ``xs`` and ``ys`` values of the glyph. Any
additional columns in the data source will be padded with the declared
``empty_value``, when adding a new point.

.. raw:: html

    <img src="https://docs.bokeh.org/static/poly_edit_keyboard_optimized.gif"
     width='400px' alt="Animation showing polygon and vertex drag, select, and delete actions">

The animation above shows the supported tool actions, highlighting
mouse actions with a circle around the cursor, and key strokes by
showing the pressed keys. The ``PolyEditTool`` can **Add**, **Move**,
and **Delete** vertices on existing patches and multi-lines:

Show vertices
  Double tap an existing patch or multi-line.

Add vertex
  Double tap an existing vertex to select it. The tool will draw the
  next point. To add it, tap in a new location. To finish editing
  and add a point, double tap. Otherwise press the ESC key to cancel.

Move vertex
  Drag an existing vertex and let go of the mouse button to release
  it.

Delete vertex
  After selecting one or more vertices, press BACKSPACE while the mouse
  cursor is within the plot area.

.. bokeh-plot:: docs/user_guide/examples/tools_poly_edit.py
    :source-position: none


.. _userguide_tools_lod:

Controlling level of detail
---------------------------

Although the HTML canvas can comfortably display tens or even hundreds of
thousands of glyphs, doing so can have adverse effects on interactive
performance. In order to accommodate large data sizes, Bokeh plots offer
"Level of Detail" (LOD) capability in the client.

.. note::
    Another option when dealing with very large data volumes is to use the
    Bokeh Server to perform downsampling on data before it is sent to the
    browser. Such an approach is unavoidable past a certain data size. See
    :ref:`userguide_server` for more information.

To maintain performance while handling large data sizes, the plot only draws
a small fraction of data points during interactive operations (panning
or zooming, for example). There are four properties on |Plot| objects that
control LOD behavior:

.. bokeh-prop:: Plot.lod_factor
    :module: bokeh.models.plots

.. bokeh-prop:: Plot.lod_interval
    :module: bokeh.models.plots

.. bokeh-prop:: Plot.lod_threshold
    :module: bokeh.models.plots

.. bokeh-prop:: Plot.lod_timeout
    :module: bokeh.models.plots


.. |HoverTool| replace:: :class:`~bokeh.models.tools.HoverTool`
.. |CustomJSHover| replace:: :class:`~bokeh.models.tools.CustomJSHover`

.. |NumeralTickFormatter| replace:: :class:`~bokeh.models.formatters.NumeralTickFormatter`
.. |DatetimeTickFormatter| replace:: :class:`~bokeh.models.formatters.DatetimeTickFormatter`
.. |PrintfTickFormatter| replace:: :class:`~bokeh.models.formatters.PrintfTickFormatter`

.. |Selection| replace:: :class:`~bokeh.models.selections.Selection`

.. |hover_basic| image:: /_images/hover_basic.png

.. |box_select_icon| image:: /_images/icons/BoxSelect.png
    :height: 19px
.. |box_zoom_icon| image:: /_images/icons/BoxZoom.png
    :height: 19px
.. |help_icon| image:: /_images/icons/Help.png
    :height: 19px
.. |crosshair_icon| image:: /_images/icons/Crosshair.png
    :height: 19px
.. |hover_icon| image:: /_images/icons/Hover.png
    :height: 19px
.. |lasso_select_icon| image:: /_images/icons/LassoSelect.png
    :height: 19px
.. |pan_icon| image:: /_images/icons/Pan.png
    :height: 19px
.. |poly_select_icon| image:: /_images/icons/PolygonSelect.png
    :height: 19px
.. |redo_icon| image:: /_images/icons/Redo.png
    :height: 19px
.. |reset_icon| image:: /_images/icons/Reset.png
    :height: 19px
.. |save_icon| image:: /_images/icons/Save.png
    :height: 19px
.. |tap_icon| image:: /_images/icons/Tap.png
    :height: 19px
.. |undo_icon| image:: /_images/icons/Undo.png
    :height: 19px
.. |wheel_pan_icon| image:: /_images/icons/WheelPan.png
    :height: 19px
.. |wheel_zoom_icon| image:: /_images/icons/WheelZoom.png
    :height: 19px
.. |zoom_in_icon| image:: /_images/icons/ZoomIn.png
    :height: 19px
.. |zoom_out_icon| image:: /_images/icons/ZoomOut.png
    :height: 19px
.. |box_edit_icon| image:: /_images/icons/BoxEdit.png
    :height: 19px
.. |freehand_draw_icon| image:: /_images/icons/FreehandDraw.png
    :height: 19px
.. |point_draw_icon| image:: /_images/icons/PointDraw.png
    :height: 19px
.. |poly_draw_icon| image:: /_images/icons/PolyDraw.png
    :height: 19px
.. |poly_edit_icon| image:: /_images/icons/PolyEdit.png
    :height: 19px
.. _userguide_graph:

Visualizing network graphs
==========================

Bokeh lets you create network graph visualizations and configure
interactions between edges and nodes.

Edge and node renderers
-----------------------

The ``GraphRenderer`` model maintains separate sub-``GlyphRenderers``
for graph nodes and edges. This lets you customize nodes by modifying
the ``node_renderer`` property of the ``GraphRenderer``. You can replace
the default Circle node glyph with any instance of the XYGlyph such as
Rect or Ellipse glyph. You can similarly modify the style properties
of edges through the ``edge_renderer`` property. To work with edge
glyphs, use the ``multi_line`` glyph method.

Observe the following requirements for the data sources belonging
to these sub-renderers:

* The ``ColumnDataSource`` of the node sub-renderer must have an
  ``"index"`` column with the unique indices of the nodes.
* The ``ColumnDataSource`` of the edge sub-renderer must have a
  ``"start"`` and ``"end"`` column. These columns contain the node
  indices for the start and end of the edges.

You can add extra meta-data to these sources to enable vectorized
glyph styling or make data available for callbacks or hover tooltips.

The following code snippet

* replaces a node glyph with an Ellipse,
* assigns scalar values to the ``height`` and ``width`` attributes of the Ellipse,
* assigns a palette to the ``fill_color`` attribute of the Ellipse,
* and adds the assigned values to the node data source.

.. code-block:: python

    import math
    from bokeh.plotting import figure
    from bokeh.models import GraphRenderer, Ellipse
    from bokeh.palettes import Spectral8

    # list the nodes and initialize a plot
    N = 8
    node_indices = list(range(N))

    plot = figure(title="Graph layout demonstration", x_range=(-1.1,1.1),
                  y_range=(-1.1,1.1), tools="", toolbar_location=None)

    graph = GraphRenderer()

    # replace the node glyph with an ellipse
    # set its height, width, and fill_color
    graph.node_renderer.glyph = Ellipse(height=0.1, width=0.2,
                                        fill_color="fill_color")

    # assign a palette to ``fill_color`` and add it to the data source
    graph.node_renderer.data_source.data = dict(
        index=node_indices,
        fill_color=Spectral8)

    # add the rest of the assigned values to the data source
    graph.edge_renderer.data_source.data = dict(
        start=[0]*N,
        end=node_indices)

Bokeh comes with a built-in ``LayoutProvider`` model that includes
a dictionary of (x,y) coordinates for nodes. This lets you arrange
plot elements in Cartesian space.

The following codes snippet uses this provider model to produce a
plot based on the setup above.

.. code-block:: python

    # generate ellipses based on the ``node_indices`` list
    circ = [i*2*math.pi/8 for i in node_indices]

    # create lists of x- and y-coordinates
    x = [math.cos(i) for i in circ]
    y = [math.sin(i) for i in circ]

    # convert the ``x`` and ``y`` lists into a dictionary of 2D-coordinates
    # and assign each entry to a node on the ``node_indices`` list
    graph_layout = dict(zip(node_indices, zip(x, y)))

    # use the provider model to supply coourdinates to the graph
    graph.layout_provider = StaticLayoutProvider(graph_layout=graph_layout)

    # render the graph
    plot.renderers.append(graph)

    # specify the name of the output file
    output_file('graph.html')

    # display the plot
    show(plot)

Put together, the above code snippets produce the following result:

.. bokeh-plot:: docs/user_guide/examples/graph_customize.py
    :source-position: none

Explicit paths
--------------

By default, the :class:`~bokeh.models.graphs.StaticLayoutProvider` model
draws straight-line paths between the supplied node positions. To set
explicit edge paths, supply lists of paths to the
:class:`bokeh.models.sources.ColumnDataSource` data source of the
``edge_renderer``. The :class:`~bokeh.models.graphs.StaticLayoutProvider`
model looks for these paths in the ``"xs"`` and ``"ys"`` columns of the
data source. The paths should be in the same order as the ``"start"``
and ``"end"`` points. Be extra careful when setting
explicit paths because there is no validation to check if they match
with node positions.

The following extends the example above and draws quadratic bezier
curves between the nodes:

.. bokeh-plot:: docs/user_guide/examples/graph_static_paths.py
    :source-position: above

NetworkX integration
--------------------

Bokeh integrates the NetworkX package so you can quickly plot
network graphs. The ``bokeh.plotting.from_networkx`` convenience
method accepts a ``networkx.Graph`` object and a NetworkX layout
method and returns a configured instance of the ``GraphRenderer``
model.

Here is how the ``networkx.spring_layout`` method lays out the
"Zachary's karate club graph" data set built into NetworkX:

.. bokeh-plot:: docs/user_guide/examples/graph_networkx.py
    :source-position: above

Interaction policies
--------------------

You can configure the selection or inspection behavior of graphs by
setting the ``selection_policy`` and ``inspection_policy`` attributes
of the ``GraphRenderer``. These policy attributes accept a special
``GraphHitTestPolicy`` model instance.

For example, setting ``selection_policy`` to ``NodesAndLinkedEdges()``
lets you select a node and all associated edges. Similarly, setting
``inspection_policy`` to ``EdgesAndLinkedNodes()`` lets you inspect the
``"start"`` and ``"end"`` nodes of an edge by hovering over it with the
HoverTool. ``NodesAndAdjacentNodes()`` lets you inspect a node and all
other nodes connected to it by a graph edge.

You can customize the ``selection_glyph``, ``nonselection_glyph``,
and/or ``hover_glyph`` attributes of the edge and node sub-renderers
to add dynamic visual elements to your graph interactions.

Below are examples of graphs with added node and edge interactions:

.. tabs::

   .. tab:: NodesAndLinkedEdges

      .. bokeh-plot:: docs/user_guide/examples/graph_interaction_nodeslinkededges.py
        :source-position: above

   .. tab:: EdgesAndLinkedNodes

      .. bokeh-plot:: docs/user_guide/examples/graph_interaction_edgeslinkednodes.py
        :source-position: above

   .. tab:: NodesAndAdjacentNodes

      .. bokeh-plot:: docs/user_guide/examples/graph_interaction_nodesadjacentnodes.py
        :source-position: above

Node and edge attributes
------------------------

The ``from_networkx`` method converts node and edge attributes of the
NetworkX package for use with ``node_renderer`` and ``edge_renderer``
of the ``GraphRenderer`` model.

For example, "Zachary's karate club graph" data set has a node
attribute named "club". You can hover this information with node
attributes converted with the ``from_networkx`` method. You can
also use node and edge attributes for color information.

Here is an example of a graph that hovers node attributes and changes
colors with edge attributes:

.. bokeh-plot:: docs/user_guide/examples/graph_node_and_edge_attributes.py
    :source-position: above
.. _userguide_extensions:

Extending Bokeh
===============

Bokeh comes with a rich variety of built-in features that let you produce
sophisticated interactive visualizations and data applications in the browser.
However, some useful capabilities and features may not make it into the core
library, either because they are too specialized or for lack of resources.
Fortunately, you can expand the functionality of Bokeh with custom extensions
that let you:

* Modify the behavior of existing Bokeh models
* Add new models to connect third-party JavaScript libraries to Python
* Create highly specialized models for domain-specific use cases

You can make and use custom extensions with standard releases and don't need to
set up a development environment or build anything from source. This is the
easiest way to get involved in Bokeh development. You can try new features and
improved functionality without having to wait for the core team to implement
them into Bokeh itself.

.. note::
   Extending Bokeh is an advanced feature. Some aspects of creating and using
   extensions are still under active development and should be considered
   experimental.

.. _userguide_extensions_structure:

Structure of Bokeh models
-------------------------

.. _userguide_extensions_structure_python:

Python models
~~~~~~~~~~~~~

For the most part, Python Bokeh models are completely declarative classes.
You can create custom extensions by making a subclass from |Model| and including
special class attributes to declare the properties to be mirrored on the
JavaScript side. For all of the available property types, see the
:ref:`bokeh.core.properties` section of the |reference guide|.

Here's a simple example that creates a custom readout for a slider:

.. code-block:: python

    from bokeh.core.properties import String, Instance
    from bokeh.models import HTMLBox, Slider

    class Custom(HTMLBox):

        text = String(default="Custom text")

        slider = Instance(Slider)

This example creates a subclass from :class:`~bokeh.models.layouts.HTMLBox` to
allow the extension to integrate into the DOM layout. It also adds two
properties:

* a :class:`~bokeh.core.properties.String` to configure a text message for the
  readout and
* an :class:`~bokeh.core.properties.Instance` that can hold a
  :class:`~bokeh.models.widgets.inputs.Slider`.

This creates a JavaScript ``Slider`` object that corresponds to a ``Slider`` in
Python.

.. _userguide_extensions_structure_js:

JavaScript models and views
~~~~~~~~~~~~~~~~~~~~~~~~~~~

While the Python side has little to no code, the JavaScript side requires code
to implement the model. You also have to provide code for a corresponding view
where necessary.

Here's an annotated TypeScript implementation for ``Custom`` and its
``CustomView``. For built-in models, this type of code is included directly in
the final BokehJS scripts.

.. code-block:: typescript

    import {HTMLBox, HTMLBoxView} from "models/layouts/html_box"

    import {div} from "core/dom"
    import * as p from "core/properties"

    export class CustomView extends HTMLBoxView {

      connect_signals(): void {
        super.connect_signals()

        // Set BokehJS listener so that the program can process new data when
        // the slider has a change event.
        this.connect(this.model.slider.change, () => {
          this.render()
          this.invalidate_layout()
        })
      }

      render(): void {
        // BokehJS views create <div> elements by default. These are accessible
        // as ``this.el``. Many Bokeh views ignore the default <div> and
        // instead do things like draw to the HTML canvas. In this case though,
        // the program changes the contents of the <div> based on the current
        // slider value.
        super.render()

        this.shadow_el.appendChild(div({
          style: {
            padding: '2px',
            color: '#b88d8e',
            backgroundColor: '#2a3153',
          },
        }, `${this.model.text}: ${this.model.slider.value}`))
      }
    }

    export class Custom extends HTMLBox {
      slider: {value: string}

      // Generally, the ``__name__`` class attribute should match the name of
      // the corresponding Python class exactly. TypeScript matches the name
      // automatically during compilation, so, barring some special cases, you
      // don't have to do this manually. This helps avoid typos, which stop
      // serialization/deserialization of the model.
      static __name__ = "Surface3d"

      static {
        // If there is an associated view, this is typically boilerplate.
        this.prototype.default_view = CustomView

        // The this.define() block adds corresponding "properties" to the JS
        // model. These should normally line up 1-1 with the Python model
        // class. Most property types have counterparts. For example,
        // bokeh.core.properties.String will correspond to ``String`` in the
        // JS implementation. Where JS lacks a given type, you can use
        // ``p.Any`` as a "wildcard" property type.
        this.define<Custom.Props>(({String, Ref}) => ({
          text:   [ String ],
          slider: [ Ref(Slider) ],
        }))
      }
    }

.. _userguide_extensions_structure_putting_together:

Putting it together
~~~~~~~~~~~~~~~~~~~

For built-in Bokeh models, the building process automatically matches the
implementation in BokehJS with the corresponding Python model. The Python class
should also have a class attribute called ``__implementation__`` with the value
of the JavaScript (or TypeScript) code that defines the client-side model as
well as any optional views.

Assuming you save the TypeScript code from the previous example in a file
called ``custom.ts``, the complete Python class might look like this:

.. code-block:: python

    from bokeh.core.properties import String, Instance
    from bokeh.models import HTMLBox, Slider

    class Custom(HTMLBox):

        __implementation__ = "custom.ts"

        text = String(default="Custom text")

        slider = Instance(Slider)

Assuming that a Python module ``custom.py`` defines this class, you can now use
the custom extension exactly you would any built-in Bokeh model.

.. code-block:: python

    from bokeh.io import show, output_file
    from bokeh.layouts import column
    from bokeh.models import Slider

    slider = Slider(start=0, end=10, step=0.1, value=0, title="value")

    custom = Custom(text="Special Slider Display", slider=slider)

    layout = column(slider, custom)

    show(layout)

This produces the following output:

.. bokeh-plot:: docs/user_guide/examples/extensions_putting_together_ts.py
    :source-position: none

The rendered document automatically includes the JavaScript code for the
implementation. Move the slider to see the special header update as the
slider moves.

.. _userguide_extensions_specifying_implementation_languages:

Specifying implementation languages
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If the value of ``__implementation__`` is a single line that ends in either
``.js`` or ``.ts``, Bokeh interprets it as a filename, opens the file, and
compiles its contents according to the file's extension.

In case of an incline implementation, specify the language for the source
code by using the classes ``JavaScript`` or ``TypeScript``. Here's an
example:

.. code-block:: python

    class Custom(Model):

        __implementation__ = JavaScript(" <JS code here> ")

.. _userguide_extensions_specifying_default_values:

Specifying default values
~~~~~~~~~~~~~~~~~~~~~~~~~

If your properties have default values, you must provide the default value on
both the Python side and on the JavaScript side. The values you provide should
be the same on both sides. For efficiency reasons, Bokeh only transmits property
values that a user has explicitly changed from their default values.

As a concrete example, a boolean property ``flag`` with a default value of True
should look like this on the Python side:

.. code-block:: python

    flag = Bool(default=True)

And it should look like this on the Bokeh side:

.. code-block:: typescript

    flag: [ Boolean, true ]

.. _userguide_extensions_supplying_external_resources:

Supplying external resources
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You may require third-party JavaScript libraries or CSS resources to implement
a custom model in Bokeh. You can supply external resources through the
``__javascript__`` and ``__css__`` Python class attributes of custom models.

Including URL paths to external resources adds them to the HTML document head,
making JavaScript libraries available in the global namespace and applying
custom CSS styling.

Here's an example that includes JS and CSS files for `KaTeX`_ (a JS library
with LaTeX support) in order to create a ``LatexLabel`` custom model.

.. code-block:: python

    class LatexLabel(Label):
        """A subclass of the built-in Bokeh model `Label` that supports
        rendering LaTeX with the KaTeX typesetting library.
        """
        __javascript__ = "https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.js"
        __css__ = "https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.css"
        __implementation__ = """
        # do something here
        """

For a complete implementation and its output, see the LaTeX example in the
extension gallery below.

.. _userguide_extensions_structure_server_integration:

Integration with Bokeh server
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You don't have to do any extra work to integrate custom extensions with the
Bokeh server. As for standalone documents, the rendered application
automatically includes the JavaScript implementation. Additionally, the
standard synchronization of Bokeh model properties is transparent for custom
user extensions, same as for built-in models.

.. _userguide_extensions_examples:

Examples
--------

This section aims to provide you with basic examples to help you start creating
custom extensions. This is a somewhat advanced topic, however, and you will
often have to study the source code of the base classes in
:bokeh-tree:`bokehjs/src/lib/models` to make progress.

.. toctree::

    extensions_gallery/ticking
    extensions_gallery/tool
    extensions_gallery/wrapping
    extensions_gallery/widget

:ref:`userguide_extensions_examples_ticking`
    Subclass a built-in Bokeh model for axis ticking to customize axis tick
    behavior.

:ref:`userguide_extensions_examples_tool`
    Make a completely new tool that can draw on a plot canvas.

:ref:`userguide_extensions_examples_wrapping`
    Connect Python to a third-party JavaScript library by wrapping it in
    a Bokeh custom extension.

:ref:`userguide_extensions_examples_widget`
    Include a third-party JavaScript library in an extension widget.

.. _KaTeX: https://khan.github.io/KaTeX/
.. _TypeScript: https://www.typescriptlang.org/

.. _userguide_extensions_prebuilt:

Pre-built extensions
--------------------

So far, this chapter covered simple, typically inline extensions. These are
great for ad hoc additions to Bokeh, but this approach is not particularly
convenient when it comes to serious development.

For example, the implicit nature of certain configuration files such as
``package.json`` or ``tsconfig.json`` doesn't allow you to take full advantage
of your IDE's capabilities when writing TypeScript or JavaScript for an
extension.

Enter pre-built extensions.

To create a pre-built extension, use the ``bokeh init`` command. This creates
all the necessary files, including ``bokeh.ext.json``, ``package.json``,
and ``tsconfig.json``.

To create and customize an extension step by step, run
``bokeh init --interactive``.

To build your extension, use the ``bokeh build`` command. This runs
``npm install``, if necessary, compiles TypeScript files, transpiles JavaScript
files, resolves modules, and links them together in distributable bundles.

Bokeh caches compilation products to improve performance. If this causes
issues, rebuild your extension from scratch with the ``bokeh build --rebuild``
command.
.. _userguide_compat:

Exploring other tools
=====================

Bokeh integrates well with a wide variety of other libraries, allowing
you to use the most appropriate tool for each task.

BokehJS
-------

To display visualizations in a browser, Bokeh converts Python data and
events to JSON and communicates them to its companion JavaScript library,
BokehJS. You can also use BokehJS as a standalone library or in
combination with JavaScript frameworks, such as React_, Vue_, Angular_,
and others.

See `Developing with JavaScript`_ for more information about BokehJS.

hvPlot
------

`hvPlot`_ is a concise API that lets you plot in Bokeh with the pandas
``.plot()`` function and a wide variety of data containers. This API is
particularly convenient for working with data interactively and lets
you quickly produce common types of plots.

Panel
-----

The `Panel`_ library provides a high-level reactive interface that makes
it easy to build data-intensive dashboards and web applications on top of
Bokeh. Panel enables full interoperability between `Jupyter notebooks`_
and `Bokeh server`_. This lets you develop or prototype applications in
a notebook and deploy them on a server. Panel also interfaces with other
plotting libraries and lets you incorporate multiple data-science
artifacts into a single Bokeh application. Furthermore, the library
includes a number of JavaScript templates to let you customize the
appearance your Bokeh apps.

HoloViews
---------

Bokeh offers you a lot of versatility when it comes to developing
complex data visualizations for the web. Even so, a higher-level API
can make day-to-day visualization tasks easier and less verbose.

`HoloViews`_ is a concise declarative interface that helps you build
Bokeh plots. It is a separately maintained package that focuses on
interaction with Jupyter notebooks and enables quick prototyping of
figures for data analysis. For instance, building an interactive
figure with three linked Bokeh plots requires only one line of code
in HoloViews.

.. image:: /_images/hv_sample.png
 :width: 976 px
 :height: 510 px
 :scale: 80 %
 :alt: HoloViews Bokeh example
 :align: center

Adding overlaid plots, slider widgets, selector widgets, selection
tools, and tabs is similarly straightforward.

Datashader
----------

By default, Bokeh copies datapoints from Python into a JavaScript
process running in your browser to provide responsive, locally
interactive plots. However, browsers can only handle limited
amounts of data, making it infeasible to plot millions or billions
of points directly in JavaScript. Moreover, typical plot-rendering
techniques produce misleading plots for such large datasets,
because of `overplotting`_ and related issues.

`Datashader`_ is a separate Python library that renders even the
largest datasets as fixed-size raster images that faithfully
represent the underlying data. Datashader gives you the tools to
build interactive Bokeh plot images that dynamically re-render in
Python when you zoom and pan. This approach lets you display
interactive visualizations of arbitrarily large datasets in standard
web browsers.

.. image:: /_images/ds_sample.png
    :width: 900 px
    :height: 670 px
    :scale: 70 %
    :alt: Datashader Bokeh example
    :align: center

Furthermore, Datashader works well with hvPlot and HoloViews.
This lets you switch between base and rendered versions of a
plot, interleave Datashader and Bokeh plots, and more. Here
is an `example`_ of interaction HoloViews.

.. _React: https://reactjs.org
.. _Angular: https://angular.io
.. _Vue: https://vuejs.org/
.. _Developing with JavaScript: https://docs.bokeh.org/en/dev/docs/user_guide/bokehjs.html
.. _hvPlot: https://hvplot.holoviz.org/
.. _Panel: https://panel.holoviz.org/
.. _Jupyter notebooks: https://docs.bokeh.org/en/latest/docs/user_guide/jupyter.html
.. _Bokeh server: https://docs.bokeh.org/en/latest/docs/user_guide/server.html
.. _Datashader: https://github.com/bokeh/datashader
.. _overplotting: https://anaconda.org/jbednar/plotting_pitfalls
.. _HoloViews: http://holoviews.org
.. _example: https://anaconda.org/jbednar/census-hv
.. _userguide_styling:

Styling visual attributes
=========================

.. _userguide_styling_using_themes:

Using themes
------------

Bokeh's themes are a set of pre-defined design parameters that you can apply to
your plots. Themes can include settings for parameters such as colors, fonts,
or line styles.

.. _userguide_styling_using_themes_built_in:

Applying Bokeh's built-in themes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Bokeh comes with five :ref:`built-in themes <bokeh.themes>` to quickly change
the appearance of one or more plots: ``caliber``, ``dark_minimal``,
``light_minimal``, ``night_sky``, and ``contrast``.

.. container:: theme-examples

    .. image:: /_images/themes_caliber.png
        :scale: 50%
        :alt: Screenshot of the caliber theme for Bokeh

    .. image:: /_images/themes_dark_minimal.png
        :scale: 50%
        :alt: Screenshot of the dark_minimal theme for Bokeh

    .. image:: /_images/themes_light_minimal.png
        :scale: 50%
        :alt: Screenshot of the light_minimal theme for Bokeh

    .. image:: /_images/themes_night_sky.png
        :scale: 50%
        :alt: Screenshot of the night_sky theme for Bokeh

    .. image:: /_images/themes_contrast.png
        :scale: 50%
        :alt: Screenshot of the contrast theme for Bokeh


To use one of the built-in themes, assign the name of the theme you want to use
to the ``theme`` property of your document.

For example:

.. bokeh-plot::
    :source-position: above

    from bokeh.io import curdoc
    from bokeh.plotting import figure, output_file, show

    x = [1, 2, 3, 4, 5]
    y = [6, 7, 6, 4, 5]

    output_file("dark_minimal.html")

    curdoc().theme = 'dark_minimal'

    p = figure(title='dark_minimal', width=300, height=300)
    p.line(x, y)

    show(p)

For more examples and detailed information, see :class:`bokeh.themes`.

.. _userguide_styling_using_themes_custom:

Creating custom themes
~~~~~~~~~~~~~~~~~~~~~~

Themes in Bokeh are defined in YAML or JSON files. To create your own theme
files, follow the format defined in :class:`bokeh.themes.Theme`.

Using YAML, for example:

.. code-block:: yaml

    attrs:
        figure:
            background_fill_color: '#2F2F2F'
            border_fill_color: '#2F2F2F'
            outline_line_color: '#444444'
        Axis:
            axis_line_color: !!null
        Grid:
            grid_line_dash: [6, 4]
            grid_line_alpha: .3
        Title:
            text_color: "white"

To use your custom theme in a Bokeh plot, load your YAML or JSON file into a
:class:`bokeh.themes.Theme` object:

.. code-block:: python

    from bokeh.themes import Theme
    curdoc().theme = Theme(filename="./theme.yml")

.. _userguide_styling_using_palettes:

Using palettes
--------------

Palettes are sequences of RGB(A) hex strings that define a colormap. The
sequences you use for defining colormaps can be either lists or tuples. Once you
have created a colormap, you can use it with the ``color`` attribute of many
plot objects from |bokeh.plotting|.

Bokeh includes several pre-defined palettes, such as the standard Brewer
palettes. To use one of those pre-defined palettes, import it from the
``bokeh.palettes`` module. When you import "Spectral6", for example, Bokeh gives
you access to a six element list of RGB(A) hex strings from the Brewer
"Spectral" colormap:

.. code-block:: python

    >>> from bokeh.palettes import Spectral6
    >>> Spectral6
    ['#3288bd', '#99d594', '#e6f598', '#fee08b', '#fc8d59', '#d53e4f']

For a list of all the standard palettes included in Bokeh, see
:ref:`bokeh.palettes`.

You can also create custom palettes by defining a sequence of RGB(A) hex
strings yourself.

.. _userguide_styling_using_mappers:

Using mappers
-------------

Use Bokeh's color mappers to encode a sequence of data into a palette of colors
that are based on the values in that sequence. You can then set a marker
object's ``color`` attribute to your color mapper. Bokeh includes several types
of mappers to encode colors:

* |factor_cmap|: Maps colors to specific categorical elements.
  See :ref:`userguide_categorical` for more detail.
* :func:`~bokeh.transform.linear_cmap`: Maps a range of numeric values across the
  available colors from high to low. For example, a range of `[0,99]` given the
  colors `['red', 'green', 'blue']` would be mapped as follows::

        x < 0  : 'red'     # values < low are clamped
    0 >= x < 33 : 'red'
    33 >= x < 66 : 'green'
    66 >= x < 99 : 'blue'
    99 >= x      : 'blue'    # values > high are clamped

* :func:`~bokeh.transform.log_cmap`: Similar to ``linear_cmap`` but uses a natural
  log scale to map the colors.

These mapper functions return a ``DataSpec`` property. Pass this property to
the color attribute of the glyph you want to use it with.

The dataspec that the mapper function returns includes a ``bokeh.transform``.
You can access this data to use the result of the mapper function in a different
context. To create a ``ColorBar``, for example:

.. bokeh-plot:: docs/user_guide/examples/styling_linear_mappers.py
    :source-position: above

.. _userguide_styling_visual_properties:

Customizing visual properties
-----------------------------

To style the visual attributes of Bokeh plots, you need to know what the
available properties are. The full |reference guide| contains all properties of
every object individually. However, there are three groups of properties that
many objects have in common. They are:

* **line properties**: line color, width, etc.
* **fill properties**: fill color, alpha, etc.
* **text properties**: font styles, colors, etc.

This section contains more details about some of the most common properties.

.. _userguide_styling_line_properties:

Line properties
~~~~~~~~~~~~~~~

.. include:: ../includes/line_props.txt

.. _userguide_styling_fill_properties:

Fill properties
~~~~~~~~~~~~~~~

.. include:: ../includes/fill_props.txt

.. _userguide_styling_hatch_properties:

Hatch properties
~~~~~~~~~~~~~~~~

.. include:: ../includes/hatch_props.txt

.. _userguide_styling_text_properties:

Text properties
~~~~~~~~~~~~~~~

.. include:: ../includes/text_props.txt

.. _userguide_styling_visible_property:

Visible property
~~~~~~~~~~~~~~~~

Glyph renderers, axes, grids, and annotations all have a ``visible`` property.
Use this property to turn them on and off.

.. bokeh-plot:: docs/user_guide/examples/styling_visible_property.py
    :source-position: above

This can be particularly useful in interactive examples with a Bokeh server or
CustomJS.

.. bokeh-plot:: docs/user_guide/examples/styling_visible_annotation_with_interaction.py
    :source-position: above

.. _userguide_styling_colors:

Color properties
~~~~~~~~~~~~~~~~

Bokeh objects have several properties related to colors. Use those color
properties to control the appearance of lines, fills, or text, for example.

Use one of these options to define colors in Bokeh:

- Any of the |named CSS colors|, such as ``'green'`` or ``'indigo'``. You can
  also use the additional name ``'transparent'`` (equal to ``'#00000000'``).
- An RGB(A) hex value, such as ``'#FF0000'`` (without alpha information) or
  ``'#44444444'`` (with alpha information).
- A CSS4 ``rgb()``, ``rgba()``, or ``hsl()``
  `color string <https://www.w3.org/TR/css-color-4/>`_, such as
  ``'rgb(0 127 0 / 1.0)'``, ``'rgba(255, 0, 127, 0.6)'``, or
  ``'hsl(60deg 100% 50% / 1.0)'``.
- A 3-tuple of integers ``(r, g, b)`` (where *r*, *g*, and *b* are integers
  between 0 and 255).
- A 4-tuple of ``(r, g, b, a)`` (where *r*, *g*, and *b* are integers between 0
  and 255 and *a* is a floating-point value between 0 and 1).
- A 32-bit unsigned integer representing RGBA values in a 0xRRGGBBAA
  byte order pattern, such as ``0xffff00ff`` or ``0xff0000ff``.

To define a series of colors, use an array of color data such as a list or the
column of a |ColumnDataSource|. This also includes
`NumPy arrays <https://numpy.org/doc/stable/reference/generated/numpy.array.html>`_.

For example:

.. bokeh-plot:: docs/user_guide/examples/styling_specifying_colors.py
    :source-position: above

In addition to specifying the alpha value of a color when defining the color
itself, you can also set an alpha value separately by using the
``line_alpha`` or ``fill_alpha`` properties of a glyph.

In case you define a color with an alpha value and also explicitly provide an
alpha value through a ``line_alpha`` or ``fill_alpha`` property at the same
time, the following happens: If your color definition does include an alpha
value (such as ``'#00FF0044'`` or ``'rgba(255, 0, 127, 0.6)'``), this alpha
value takes precedence over the alpha value you provide through the objects's
property. Otherwise, the alpha value defined in the objects's property is used.

The following figure demonstrates each possible combination of using RGB and
RGBA colors together with the ``line_alpha`` or ``fill_alpha`` properties:

.. bokeh-plot:: docs/user_guide/examples/styling_specifying_colors_properties.py
    :source-position: none

.. note::
    If you use
    :ref:`Bokeh's plotting interface <userguide_interfaces_plotting>`, you also
    have the option to specify ``color`` and/or ``alpha`` as keywords when
    calling a renderer method. Bokeh automatically applies these values to the
    corresponding ``fill`` and ``line`` properties of your glyphs.

    You then still have the option to provide additional ``fill_color``,
    ``fill_alpha``, ``line_color``, and ``line_alpha`` arguments as well. In
    this case, the former will take precedence.

.. _userguide_styling_units:

Screen units and data-space units
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When setting visual properties of Bokeh objects, you use either screen units or
data-space units:

* Screen units use raw numbers of pixels to specify height or width
* Data-space units are relative to the data and the axes of the plot

Take a 400 pixel by 400 pixel graph with x and y axes ranging from 0
through 10, for example. A glyph that is one fifth as wide and tall as the graph
would have a size of 80 screen units or 2 data-space units.

Objects in Bokeh that support both screen units and data-space units usually
have a dedicated property to choose which unit to use. This unit-setting
property is the name of the property with an added ``_units``. For
example: A :class:`~bokeh.models.annotations.Whisker`
:ref:`annotation <userguide_annotations_whiskers>` has the property ``upper``. To
define which unit to use, set the ``upper_units`` property to either
``'screen'`` or ``'data'``.

.. _userguide_styling_selecting:

Selecting plot objects
----------------------

If you want to customize the appearance of any element of your Bokeh plot, you
first need to identify which object you want to modify. As described in
:ref:`userguide_concepts`, Bokeh plots are a combination of Python objects that
represent all the different parts of your plot: its grids, axes, and glyphs, for
example.

Some objects have convenience methods to help you identify the objects you want
to address. See `Styling axes`_, `Styling grids`_, and `Styling legends`_ for
examples.

To query for any Bokeh plot object, use the |select| method on |Plot|. For
example, to find all `PanTool` objects in a plot:

.. code-block:: python

    >>> p.select(type=PanTool)
    [<bokeh.models.tools.PanTool at 0x106608b90>]

You can also use the |select| method to query on other attributes as well:

.. code-block:: python

    >>> p.circle(0, 0, name="mycircle")
    <bokeh.plotting.figure at 0x106608810>

    >>> p.select(name="mycircle")
    [<bokeh.models.renderers.GlyphRenderer at 0x106a4c810>]

This query method can be especially useful when you want to style visual
attributes of `Styling glyphs`_.

.. _userguide_styling_plots:

Styling plots
-------------

In addition to the individual plot elements, a |Plot| object itself also has
several visual characteristics that you can customize: the dimensions of the
plot, its backgrounds, borders, or outlines, for example. This section describes
how to change these attributes of a Bokeh plot.

The example code primarily uses the |bokeh.plotting| interface to create plots.
However, the instructions apply regardless of how a Bokeh plot was created.

.. _userguide_styling_plot_dimensions:

Dimensions
~~~~~~~~~~

To change the width and height of a |Plot|, use its ``width`` and
``height`` attributes. Those two attributes use |screen units|. They
control the size of the entire canvas area, including any axes or titles (but
not the toolbar).

If you are using the |bokeh.plotting| interface, you can pass these values to
|figure| directly:

.. bokeh-plot:: docs/user_guide/examples/styling_dimensions.py
    :source-position: above

.. _userguide_styling_plot_responsive_dimensions:

Responsive sizes
~~~~~~~~~~~~~~~~

To automatically adjust the width or height of your plot in relation to the
available space in the browser, use the plot's
:class:`~bokeh.models.plots.Plot.sizing_mode` property.

To control how the plot scales to fill its container, see the documentation for
:ref:`bokeh.models.layouts`, in particular the ``sizing_mode`` property of
:class:`~bokeh.models.layouts.LayoutDOM`.

If you set ``sizing_mode`` to anything different than ``fixed``, Bokeh adjusts
the ``width`` and ``height`` as soon as a plot is rendered. However,
Bokeh uses ``width`` and ``height`` to calculate the initial aspect
ratio of your plot.

Plots will only resize down to a minimum of 100px (height or width) to prevent
problems in displaying your plot.

.. _Bokeh GitHub repository: https://github.com/bokeh/bokeh

.. _userguide_styling_plot_title:

Title
~~~~~

To style the title of your plot, use the |Title| annotation, which is available
as the ``.title`` property of the |Plot|.

You can use most of the standard |text properties|. However, ``text_align`` and
``text_baseline`` do not apply. To position the title relative to the entire
plot, use the properties :class:`~bokeh.models.annotations.Title.align` and
:class:`~bokeh.models.annotations.Title.offset` instead.

As an example, to set the color and font style of the title text, use
``plot.title.text_color``:

.. bokeh-plot:: docs/user_guide/examples/styling_title.py
    :source-position: above

.. _userguide_styling_plot_background:

Background
~~~~~~~~~~

To change the background fill style, adjust the ``background_fill_color`` and
``background_fill_alpha`` properties of the |Plot| object:

.. bokeh-plot:: docs/user_guide/examples/styling_background_fill.py
    :source-position: above

.. _userguide_styling_plot_border:

Border
~~~~~~

To adjust the border fill style, use the ``border_fill_color`` and
``border_fill_alpha`` properties of the |Plot| object. You can also set the
minimum border on each side (in |screen units|) with these properties:

* ``min_border_left``
* ``min_border_right``
* ``min_border_top``
* ``min_border_bottom``

Additionally, if you set ``min_border``, Bokeh applies a minimum border setting
to all sides as a convenience. The ``min_border`` default value is 40px.

.. bokeh-plot:: docs/user_guide/examples/styling_min_border.py
    :source-position: above

.. _userguide_styling_plot_outline:

Outline
~~~~~~~

Bokeh |Plot| objects have various |line properties|. To change the appearance of
outlines, use those line properties that are prefixed with ``outline_``.

For example, to set the color of the outline, use ``outline_line_color``:

.. bokeh-plot:: docs/user_guide/examples/styling_plot_outline_line_color.py
    :source-position: above

.. _userguide_styling_glyphs:

Styling glyphs
--------------

To style the fill, line, or text properties of a glyph, you first need to
identify which ``GlyphRenderer`` you want to customize. If you are using the
|bokeh.plotting| interface, the glyph functions return the renderer:

.. code-block:: python

    >>> r = p.circle([1,2,3,4,5], [2,5,8,2,7])
    >>> r
    <bokeh.models.renderers.GlyphRenderer at 0x106a4c810>

Next, obtain the glyph itself from the ``.glyph`` attribute of a
``GlyphRenderer``:

.. code-block:: python

    >>> r.glyph
    <bokeh.models.glyphs.Circle at 0x10799ba10>

This is the object to set fill, line, or text property values for:

.. bokeh-plot:: docs/user_guide/examples/styling_glyph_properties.py
    :source-position: above

.. _userguide_styling_selected_unselected_glyphs:

Selected and unselected glyphs
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To customize the styling of selected and non-selected glyphs, set the
|selection_glyph| and |nonselection_glyph| attributes of the |GlyphRenderer|.
You can either set them manually or by passing them to |add_glyph|.

.. |add_glyph| replace:: :func:`~bokeh.models.plots.Plot.add_glyph`
.. |GlyphRenderer| replace:: :class:`~bokeh.models.renderers.GlyphRenderer`
.. |selection_glyph| replace:: :attr:`~bokeh.models.renderers.GlyphRenderer.selection_glyph`
.. |nonselection_glyph| replace:: :attr:`~bokeh.models.renderers.GlyphRenderer.nonselection_glyph`

The plot below uses the |bokeh.plotting| interface to set these attributes.
Click or tap any of the circles on the plot to see the effect on the selected
and non-selected glyphs. To clear the selection and restore the original state,
click anywhere in the plot *outside* of a circle.

.. bokeh-plot:: docs/user_guide/examples/styling_glyph_selections_plotting_glyph.py
    :source-position: above

If you just need to set the color or alpha parameters of the selected or
non-selected glyphs, provide color and alpha arguments to the glyph function,
prefixed by ``"selection_"`` or ``"nonselection_"``:

.. bokeh-plot:: docs/user_guide/examples/styling_glyph_selections_plotting_params.py
    :source-position: above

If you use the |bokeh.models| interface, use the
:func:`~bokeh.models.plots.Plot.add_glyph` function:

.. code-block:: python

    p = Plot()
    source = ColumnDataSource(dict(x=[1, 2, 3], y=[1, 2, 3]))

    initial_circle = Circle(x='x', y='y', fill_color='blue', size=50)
    selected_circle = Circle(fill_alpha=1, fill_color="firebrick", line_color=None)
    nonselected_circle = Circle(fill_alpha=0.2, fill_color="blue", line_color="firebrick")

    p.add_glyph(source,
                initial_circle,
                selection_glyph=selected_circle,
                nonselection_glyph=nonselected_circle)

.. note::
    When rendering, Bokeh considers only the *visual* properties of
    ``selection_glyph`` and ``nonselection_glyph``. Changing
    positions, sizes, etc., will have no effect.

.. _userguide_styling_hover_inspections:

Hover inspections
~~~~~~~~~~~~~~~~~

To style the appearance of glyphs that are hovered over, pass color or alpha
parameters prefixed with ``"hover_"`` to your renderer function.

Alternatively, set the |selection_glyph| and |nonselection_glyph| attributes of
the |GlyphRenderer|, just like in
:ref:`userguide_styling_selected_unselected_glyphs` above.

This example uses the first method of passing a color parameter with the
``"hover_"`` prefix:

.. bokeh-plot:: docs/user_guide/examples/styling_glyph_hover.py
    :source-position: above

.. note::
    When rendering, Bokeh considers only the *visual* properties of
    ``hover_glyph``. Changing positions, sizes, etc. will have no effect.

.. _userguide_styling_tool_overlays:

Styling tool overlays
---------------------

Some Bokeh tools also have configurable visual attributes.

For instance, the various region selection tools and the box zoom tool all have
an ``overlay``. To style their line and fill properties, pass values to the
respective attributes:

.. bokeh-plot:: docs/user_guide/examples/styling_tool_overlays.py
    :source-position: above

For more information, see the reference guide's entries for
:class:`BoxSelectTool.overlay <bokeh.models.tools.BoxSelectTool.overlay>`,
:class:`BoxZoomTool.overlay <bokeh.models.tools.BoxZoomTool.overlay>`,
:class:`LassoSelectTool.overlay <bokeh.models.tools.LassoSelectTool.overlay>`,
:class:`PolySelectTool.overlay <bokeh.models.tools.PolySelectTool.overlay>`, and
:class:`RangeTool.overlay <bokeh.models.tools.RangeTool.overlay>`.

.. _userguide_styling_toolbar_autohide:

Toggling ToolBar autohide
-------------------------

To make your toolbar hide automatically, set the toolbar's
:class:`~bokeh.models.tools.Toolbar.autohide` property to True. When you set
``autohide`` to True, the toolbar is visible only when the mouse is inside the
plot area and is otherwise hidden.

.. bokeh-plot:: docs/user_guide/examples/styling_toolbar_autohide.py
    :source-position: above


.. _userguide_styling_axes:

Styling axes
------------

This section focuses on changing various visual properties of Bokeh plot axes.

To set style attributes on Axis objects, use the |xaxis|, |yaxis|, and
|axis| methods on |Plot| to first obtain a plot's Axis objects. For example:

.. code-block:: python

    >>> p.xaxis
    [<bokeh.models.axes.LinearAxis at 0x106fa2390>]

Because there may be more than one axis, this method returns a list of Axis
objects. However, as a convenience, these lists are *splattable*. This means that
you can set attributes directly on this result, and the attributes will be
applied to all the axes in the list. For example:

.. code-block:: python

    p.xaxis.axis_label = "Temperature"

This changes the value of ``axis_label`` for every x-axis of ``p``, however
many there may be.

The example below demonstrates the use of the |xaxis|, |yaxis|, and
|axis| methods in more details:

.. bokeh-plot:: docs/user_guide/examples/styling_axis_properties.py
    :source-position: above

.. _userguide_styling_axes_labels:

Labels
~~~~~~

To add or change the text of an axis' overall label, use the ``axis_label``
property. To add line breaks to the text in an axis label, include ``\n`` in
your string.

To control the visual appearance of the label text, use any of the standard
|text properties| prefixed with ``axis_label_``. For instance, to set the text
color of the label, set ``axis_label_text_color``.

To change the distance between the axis label and the major tick labels, set the
``axis_label_standoff`` property.

For example:

.. bokeh-plot:: docs/user_guide/examples/styling_labels.py
    :source-position: above

.. _userguide_styling_axes_bounds:

Bounds
~~~~~~

To limit the bounds where axes are drawn, set the ``bounds`` property of an axis
object to a 2-tuple of *(start, end)*:

.. bokeh-plot:: docs/user_guide/examples/styling_bounds.py
    :source-position: above

.. _userguide_styling_axes_tick_lines:

Tick locations
~~~~~~~~~~~~~~

Bokeh uses several "ticker" models to decide where to display ticks on axes
(categorical, datetime, mercator, linear, or log scale). To configure the
placements of ticks, use the ``.ticker`` property of an axis.

If you use the |bokeh.plotting| interface, Bokeh chooses an appropriate ticker
placement model automatically.

In case you need to control which ticker placement model to use, you can also
explicitly define a list of tick locations. Assign
:class:`~bokeh.models.tickers.FixedTicker` with a list of tick locations to an
axis:

.. code-block:: python

    from bokeh.plotting import figure
    from bokeh.models.tickers import FixedTicker

    p = figure()

    # no additional tick locations will be displayed on the x-axis
    p.xaxis.ticker = FixedTicker(ticks=[10, 20, 37.4])

As a shortcut, you can also supply the list of ticks directly to an axis'
``ticker`` property:

.. bokeh-plot:: docs/user_guide/examples/styling_fixed_ticker.py
    :source-position: above

Tick lines
~~~~~~~~~~

To control the visual appearance of the major and minor ticks, set the
appropriate |line properties|, prefixed with ``major_tick_`` and
``minor_tick_``, respectively.

For instance, to set the color of the major ticks, use
``major_tick_line_color``. To hide either set of ticks, set the color to
``None``.

Additionally, to control how far in and out of the plotting area the ticks
extend, use the properties ``major_tick_in``/``major_tick_out`` and
``minor_tick_in``/``minor_tick_out``. These values are in |screen units|.
Therefore, you can use negative values.

.. bokeh-plot:: docs/user_guide/examples/styling_tick_lines.py
    :source-position: above

.. _userguide_styling_axes_tick_label_formats:

Tick label formats
~~~~~~~~~~~~~~~~~~

To style the text of axis labels, use the ``TickFormatter`` object of the axis'
``formatter`` property. Bokeh uses a number of ticker formatters by default in
different situations:

* |BasicTickFormatter| --- Default formatter for linear axes.

* |CategoricalTickFormatter| --- Default formatter for categorical axes.

* |DatetimeTickFormatter| --- Default formatter for datetime axes.

* |LogTickFormatter| --- Default formatter for log axes.

These default tick formatters do not expose many configurable properties.
To control tick formatting at a finer-grained level, use one of the
|NumeralTickFormatter| or |PrintfTickFormatter| described below.

.. note::
    To replace a tick formatter on an axis, you must set the ``formatter``
    property on an actual ``Axis`` object, not on a splattable list. This is
    why the following examples use ``p.yaxis[0].formatter``, etc. (with the
    subscript ``[0]``).

``NumeralTickFormatter``
''''''''''''''''''''''''

The |NumeralTickFormatter| has a ``format`` property that can be used
to control the text formatting of axis ticks.

.. bokeh-plot:: docs/user_guide/examples/styling_numerical_tick_formatter.py
    :source-position: above

Many additional formats are available. See the full |NumeralTickFormatter|
documentation in the |reference guide|.

``PrintfTickFormatter``
'''''''''''''''''''''''

The |PrintfTickFormatter| has a ``format`` property that can be used
to control the text formatting of axis ticks using ``printf`` style
format strings.

.. bokeh-plot:: docs/user_guide/examples/styling_printf_tick_formatter.py
    :source-position: above

For full details about formats, see the full |PrintfTickFormatter|
documentation in the |reference guide|.

``CustomJSTickFormatter``
'''''''''''''''''''''''''

To fully customize the format of axis ticks, use the |CustomJSTickFormatter| in
combination with a JavaScript snippet as its ``code`` property.

The variable ``tick`` contains the unformatted tick value. It is accessible in
the snippet or function namespace at render time:

.. bokeh-plot:: docs/user_guide/examples/styling_custom_js_tick_formatter.py
    :source-position: above

.. _userguide_styling_axes_tick_label_orientation:

Tick label orientation
~~~~~~~~~~~~~~~~~~~~~~

To control the orientation of major tick labels, use the
``major_label_orientation`` property. This property accepts the
values ``"horizontal"`` or ``"vertical"`` or a floating-point number
that gives the angle (in radians) to rotate from the horizontal:

.. bokeh-plot:: docs/user_guide/examples/styling_tick_label_orientation.py
    :source-position: above

.. note::
    There are more properties that you can use to configure Bokeh axes. For a
    complete list of all the various attributes that you can set on different
    types of Bokeh axes, see the :ref:`bokeh.models.axes` section of the
    |reference guide|.

.. _userguide_styling_grids:

Styling grids
-------------

In this section, you will learn how to set the visual properties of grid
lines and grid bands on Bokeh plots.

To obtain a plot's Grid objects, use the |xgrid|, |ygrid|, and |grid| methods on
|Plot|. This works similar to the convenience methods for axes:

.. code-block:: python

    >>> p.grid
    [<bokeh.models.grids.Grid at 0x106fa2278>,
     <bokeh.models.grids.Grid at 0x106fa22e8>]

These methods also return splattable lists. You can set an attribute
on the list as if it was a single object, and the attribute is changed
for every element of the list:

.. code-block:: python

    p.grid.line_dash = [4 2]

.. note::
    The ``xgrid`` property provides the grid objects that *intersect* the
    x-axis (meaning vertically oriented objects). Correspondingly, ``ygrid``
    provides the grid objects that intersect the y-axis (meaning horizontally
    oriented objects).

.. _userguide_styling_grid_lines:

Lines
~~~~~

To configure the visual appearance of grid lines, use a collection of
|line properties|, prefixed with ``grid_``.

For instance, to set the color of grid lines, use ``grid_line_color``. To hide
grid lines, set their line color to ``None``:

.. bokeh-plot:: docs/user_guide/examples/styling_grid_lines.py
    :source-position: above

Minor lines
~~~~~~~~~~~

To configure the visual appearance of minor grid lines, use a collection of
|line properties|, prefixed with ``minor_grid_``.

For instance, to set the color of grid lines, use ``minor_grid_line_color``. By
default, minor grid lines are hidden (which means that their line color is set
to ``None``):

.. bokeh-plot:: docs/user_guide/examples/styling_minor_grid_lines.py
    :source-position: above

.. _userguide_styling_grid_bands:

Bands
~~~~~

Use "bands" to display filled, shaded bands between adjacent grid lines. To
control the visual appearance of these bands, use a collection of
|fill properties| and |hatch properties| that are prefixed with ``band_``.

For instance, to set the color of grid bands, use ``band_fill_color``. To hide
grid bands, set their fill color to ``None`` (this is the default).

This example defines bands filled with a solid color:

.. bokeh-plot:: docs/user_guide/examples/styling_grid_band_fill.py
    :source-position: above

This example uses bands filled with a hatch pattern:

.. bokeh-plot:: docs/user_guide/examples/styling_grid_band_hatch.py
    :source-position: above

.. _userguide_styling_grid_bounds:

Bounds
~~~~~~

To set explicit bounds that limit where grids are drawn, use a 2-tuple of
*(start, end)*. This is identical to setting
:ref:`bounds for axes <userguide_styling_axes_bounds>`:

.. bokeh-plot:: docs/user_guide/examples/styling_grid_bounds.py
    :source-position: above


.. note::
    There are other properties that Bokeh grids support configuring. For a
    complete listing of all the various attributes that can be set on Bokeh
    plot grids, consult the :ref:`bokeh.models.grids` section of the
    |reference guide|.

.. _userguide_styling_legends:

Styling legends
---------------

Similar to the convenience methods for axes and grids, there is a
:func:`~bokeh.models.plots.Plot.legend` method on |Plot| that you can use to
obtain a plot's |Legend| objects:

bokeh.models.plots.Plot.legend

.. code-block:: python

    >>> p.legend
    [<bokeh.models.annotations.Legend at 0x106fa2278>]

This method also returns a splattable list. Therefore, you can set an attribute
on the list as if it was a single object, and the attribute is changed
for every element of the list:

.. code-block:: python

    p.legend.label_text_font = "times"

Location
~~~~~~~~

To control the location of the legend labels, use the ``location`` property.

Inside the plot area
''''''''''''''''''''

For legends in the central layout area, such as those created
automatically by |bokeh.plotting|, set ``location`` to one of the following
values:

``"top_left"``

``"top_center"``

``"top_right"`` (the default)

``"center_right"``

``"bottom_right"``

``"bottom_center"``

``"bottom_left"``

``"center_left"``

``"center"``

or a ``(x, y)`` tuple indicating an absolute location in screen coordinates
(pixels from the bottom-left corner).

.. bokeh-plot:: docs/user_guide/examples/styling_legend_location.py
    :source-position: above

Outside the plot area
'''''''''''''''''''''

To position a legend outside the central area, use the ``add_layout`` method of
a plot. This requires creating the |Legend| object directly:

.. bokeh-plot:: docs/user_guide/examples/styling_legend_location_outside.py
    :source-position: above

In this use-case, you need to specify the legend's location in absolute terms.
Future releases will add additional options to customize legend positions.

Title
~~~~~

To add or change a legend's title, use its ``title`` property:

.. code:: python

    plot.legend.title = "Division"

To control the visual appearance of the legend title, use any of the standard
|text properties| prefixed with ``title_``. For instance, to set the font
style of the legend, use ``title_text_font_style``.

To set the distance between the title and the rest of the legend (in pixels),
use the ``title_standoff`` property.

.. bokeh-plot:: docs/user_guide/examples/styling_legend_title.py
    :source-position: above

Orientation
~~~~~~~~~~~

To control the orientation of the legend, use the ``orientation`` property.
Valid values for this property are:

* ``"vertical"``
* ``"horizontal"``

The default orientation is ``"vertical"``.

.. bokeh-plot:: docs/user_guide/examples/styling_legend_orientation.py
    :source-position: above

Label text
~~~~~~~~~~

To control the visual appearance of the legend labels, use any of the standard
|text properties| prefixed with ``label_``. For instance, to set the font
style of the labels, use ``label_text_font_style``.

.. bokeh-plot:: docs/user_guide/examples/styling_legend_label_text.py
    :source-position: above

Border
~~~~~~

To control the visual appearance of the legend border, use a collection of
|line properties|, prefixed with ``border_``. For instance, to set the color
of the border, use ``border_line_color``. To make the border invisible, set
the border line color to ``None``.

.. bokeh-plot:: docs/user_guide/examples/styling_legend_border.py
    :source-position: above

Background
~~~~~~~~~~

To control the visual appearance of the legend background, use a collection
of |fill properties|, prefixed with ``background_``. For instance, to set the
color of the background, use ``background_fill_color``. To make the background
transparent, set the ``background_fill_alpha`` to ``0``.

.. bokeh-plot:: docs/user_guide/examples/styling_legend_background.py
    :source-position: above

Dimensions
~~~~~~~~~~

To control dimensions such as the layout or spacing of label components, use
the following properties:

There are several properties that can be used to control the layout,
spacing, etc. of the legend components:

.. bokeh-prop:: Legend.label_standoff
    :module: bokeh.models.annotations

.. bokeh-prop:: Legend.label_width
    :module: bokeh.models.annotations

.. bokeh-prop:: Legend.label_height
    :module: bokeh.models.annotations

.. bokeh-prop:: Legend.glyph_width
    :module: bokeh.models.annotations

.. bokeh-prop:: Legend.glyph_height
    :module: bokeh.models.annotations

.. bokeh-prop:: Legend.padding
    :module: bokeh.models.annotations

.. bokeh-prop:: Legend.spacing
    :module: bokeh.models.annotations

.. bokeh-prop:: Legend.margin
    :module: bokeh.models.annotations


.. bokeh-plot:: docs/user_guide/examples/styling_legend_dimensions.py
    :source-position: above

.. _userguide_styling_render_level:

Setting render levels
---------------------

To specify the order in which things are drawn, use one of the following render
levels:

:image:
    "lowest" render level, drawn before anything else
:underlay:
    default render level for grids
:glyph:
    default render level for all glyphs (which means they are drawn above grids)
:annotation:
    default render level for annotation renderers
:overlay:
    "highest" render level, for tool overlays

Within a given level, renderers are drawn in the order that they were added.

To specify a render level explicitly, use the ``level`` parameter on the
renderer.

For example, to make sure an image is rendered *under* the grid lines, assign
the render level ``"image"`` to the ``level`` argument when calling your
``image`` renderer:

.. code-block:: python

    p.image(..., level="image")

You can see a complete example with output in the section
:ref:`userguide_plotting_images_colormapped`.

.. _userguide_styling_math:

Adding mathematical notations
-----------------------------

Bokeh supports mathematical notations expressed in the LaTeX_ and MathML_ markup
languages with a growing number of elements. Currently, you can use LaTeX
and MathML notations with the following elements:

* :ref:`Axis labels <userguide_styling_axes_labels>`
* Tick labels using :func:`~bokeh.models.Axis.major_label_overrides`
* :ref:`userguide_annotations_titles`
* :ref:`userguide_annotations_labels`
* :ref:`RangeSlider widgets <userguide_interaction_widgets_range_slider>`
* :ref:`Slider widgets <userguide_interaction_widgets_slider>`
* :ref:`Div widgets <userguide_interaction_widgets_div>`
* :ref:`Paragraph widgets <userguide_interaction_widgets_paragraph>`

Bokeh uses the MathJax_ library to handle LaTeX and MathML. See the official
`MathJax documentation`_ for more information on MathJax.

.. note::
    If you use the |components| function, make sure to include the
    ``bokeh-mathjax-`` resource in your html template.

LaTeX
~~~~~

To use LaTeX notation, you can pass a string directly to any supported element.
This string needs to begin and end with one of the
`MathJax default delimiters`_. These delimiters are ``$$...$$``,  ``\[...\]``,
and ``\(...\)``. For example: ``r"$$\sin(x)$$"``.

LaTeX on axis labels, titles, and labels
    To use LaTeX notation as an :ref:`axis label <userguide_styling_axes_labels>`,
    :ref:`title <userguide_annotations_titles>`, or :ref:`label
    <userguide_annotations_labels>`, pass a raw string literal beginning and
    ending with `MathJax default delimiters`_ and containing LaTeX notation. For
    example:

    .. bokeh-plot:: docs/user_guide/examples/styling_math_text_latex_axis_labels_titles_labels.py
        :source-position: above

LaTeX and tick labels
    To add LaTeX notations to your tick labels, use the
    :func:`~bokeh.models.Axis.major_label_overrides` function with an axis.

    This function is used to replace values for existing tick labels with custom
    text. It accepts a dictionary with the tick label's original value as the
    key and your custom value as the dict's value.

    Use this function to replace any plain text tick labels with LaTeX notation:

    .. bokeh-plot:: docs/user_guide/examples/styling_math_text_latex_tick_labels.py
        :source-position: above

LaTeX on RangeSlider and Slider widget titles
    To use LaTeX notation in the title of a :ref:`userguide_interaction_widgets_range_slider`
    or :ref:`userguide_interaction_widgets_slider` widget, pass a raw string
    literal beginning and ending with `MathJax default delimiters`_ and containing
    LaTeX notation as the ``title`` parameter. For example:

    .. bokeh-plot:: docs/user_guide/examples/styling_math_text_latex_slider_widget_title.py
        :source-position: above

LaTeX with div and paragraph widgets
    To include LaTeX notation in the text of a
    :class:`div widget <bokeh.models.Div>` or :class:`paragraph widget
    <bokeh.models.Paragraph>`, use the standard `MathJax default delimiters`_
    anywhere within your string:

    .. bokeh-plot:: docs/user_guide/examples/styling_math_text_latex_div_widget.py
        :source-position: above

    To disable LaTeX rendering for a div or paragraph widget, set the widget's
    ``disable_math`` property to True.

You can use some of Bokeh's standard |text properties| to change the appearance
of rendered math text. Use ``text_font_size`` to change the font size, use
``text_color`` to change the color. For example:

.. code-block:: python

    p.xaxis.axis_label = r"$$\nu \:(10^{15} s^{-1})$$"
    p.xaxis.axis_label_text_color = "green"
    p.xaxis.axis_label_text_font_size = "50px"

Text color and sizes defined in a :ref:`Bokeh theme
<userguide_styling_using_themes>` also work.

Additionally, you have the option to use the `LaTeX extensions included in MathJax`_.
For example, use ``\text{}`` to combine literal text with a math expression. Or
use the `color extension`_ to change the color of the rendered LaTeX notation:
``\color{white} \sin(x)``. Text properties set with a LaTeX extension override
any text properties set elsewhere in your code or in a theme.

.. note::
    There are limitations to how much of LaTeX MathJax supports. See
    `Differences from Actual TeX`_ in the MathJax documentation for more details.

MathML
~~~~~~

To add mathematical notations written in MathML, use Bokeh's
:class:`~bokeh.models.text.MathML` model directly. This model has a ``text``
property that accepts a string containing MathML. For example:

.. bokeh-plot:: docs/user_guide/examples/styling_math_text_mathml_axis_labels.py
    :source-position: above

Similar to LaTeX, you can also use Bokeh's standard |text properties|
``text_font_size`` and ``text_color`` to change font size and color for MathML
notations. For example:

.. code-block:: python

    plot.xaxis.axis_label = MathML(text=mathml)
    plot.xaxis.axis_label_text_color = "green"
    plot.xaxis.axis_label_text_font_size = "50px"

For more information, see :class:`~bokeh.models.text.MathML` in the
|reference guide|.

.. _LaTeX: https://www.latex-project.org/
.. _MathML: https://www.w3.org/Math/
.. _MathJax: https://www.mathjax.org
.. _MathJax documentation: http://docs.mathjax.org/en/latest/
.. _MathJax default delimiters: http://docs.mathjax.org/en/latest/basic/mathematics.html#tex-and-latex-input
.. _Differences from Actual TeX: https://docs.mathjax.org/en/latest/input/tex/differences.html
.. _LaTeX extensions included in MathJax: http://docs.mathjax.org/en/latest/input/tex/extensions/index.html
.. _color extension: http://docs.mathjax.org/en/latest/input/tex/extensions/color.html

.. |select| replace:: :func:`~bokeh.models.plots.Plot.select`
.. |Title| replace:: :class:`~bokeh.models.annotations.Title`

.. |Range1d| replace:: :class:`~bokeh.models.ranges.Range1d`

.. |bokeh.models.formatters| replace:: :ref:`bokeh.models.formatters <bokeh.models.formatters>`
.. |BasicTickFormatter| replace:: :class:`~bokeh.models.formatters.BasicTickFormatter`
.. |CategoricalTickFormatter| replace:: :class:`~bokeh.models.formatters.CategoricalTickFormatter`
.. |DatetimeTickFormatter| replace:: :class:`~bokeh.models.formatters.DatetimeTickFormatter`
.. |CustomJSTickFormatter| replace:: :class:`~bokeh.models.formatters.CustomJSTickFormatter`
.. |LogTickFormatter| replace:: :class:`~bokeh.models.formatters.LogTickFormatter`
.. |NumeralTickFormatter| replace:: :class:`~bokeh.models.formatters.NumeralTickFormatter`
.. |PrintfTickFormatter| replace:: :class:`~bokeh.models.formatters.PrintfTickFormatter`

.. |legend| replace:: :class:`~bokeh.plotting.figure.legend`
.. |grid|   replace:: :class:`~bokeh.plotting.figure.grid`
.. |xgrid|  replace:: :class:`~bokeh.plotting.figure.xgrid`
.. |ygrid|  replace:: :class:`~bokeh.plotting.figure.ygrid`
.. |axis|   replace:: :class:`~bokeh.plotting.figure.axis`
.. |xaxis|  replace:: :class:`~bokeh.plotting.figure.xaxis`
.. |yaxis|  replace:: :class:`~bokeh.plotting.figure.yaxis`
.. _userguide_interaction:

Making Interactions
===================

.. toctree::
   interaction/linking
   interaction/legends
   interaction/widgets
   interaction/callbacks

:ref:`userguide_interaction_linked`
    Bokeh makes it simple to add certain kinds of linked interactions between
    plots, such as linked ranges when panning and zooming, or linked
    highlighting when making selections.

:ref:`userguide_interaction_legends`
    Bokeh ``Legends`` can be configured to allow for easily hiding or muting
    corresponding glyphs.

:ref:`userguide_interaction_widgets`
    Bokeh comes with a rich set of widgets that can be used with either
    client-side JavaScript callbacks, or with real Python code in a Bokeh
    server application.

:ref:`userguide_interaction_jscallbacks`
    See how to attach ``CustomJS`` callbacks to various widgets and events
    in Bokeh documents.
.. _userguide_geo:

Mapping geo data
================

Bokeh supports creating map-based visualizations and working with geographical data.

.. _userguide_geo_tile_provider_maps:

Tile provider maps
------------------

Bokeh is compatible with several XYZ tile services that use the Web Mercator projection.
Bokeh uses the `xyzservices`_ library to take care of the tile sources and their attributions.
To add these to a plot, use the method :func:`~bokeh.models.plots.Plot.add_tile`. You can pass
any name xyzservices may recognize. The ``retina`` keyword can control the resolution of tiles.

.. bokeh-plot:: docs/user_guide/examples/geo_tile_source.py
    :source-position: below

If you pass ``retina=True``, Bokeh will attempt to use the tiles in the 2x higher resolution
than with default settings. However, this functionality needs to be supported by the tile provider.
Otherwise, the keyword is ignored. Alternatively, you can include ``'retina'` as part of the tile
provider name string, e.g. ``'CartoDB Positron retina'``, which will work as ``retina=True``.

Notice that passing ``x_axis_type="mercator"`` and ``y_axis_type="mercator"``
to ``figure`` generates axes with latitude and longitude labels, instead of raw Web
Mercator coordinates.

Alternatively, you can use any :class:`xyzservices.TileProvider`, either pre-defined in
``xyzservices`` or a custom one.

.. bokeh-plot:: docs/user_guide/examples/geo_xyzservices.py
    :source-position: below

The available built-in tile providers are listed in the `xyzservices`_ documentation or
interactively as an ``xyzservices.providers`` module.

Representative samples of the most common tile providers are shown below.

CartoDB Positron
~~~~~~~~~~~~~~~~

Tile Source for CartoDB Tile Service

.. raw:: html

    <img src="https://tiles.basemaps.cartocdn.com/light_all/14/2627/6331.png" />

Esri World Imagery
~~~~~~~~~~~~~~~~~~

Tile Source for ESRI public tiles.

.. raw:: html

    <img src="https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/14/6331/2627.jpg" />

OSM
~~~

Tile Source for Open Street Map Mapnik.

.. raw:: html

    <img src="https://c.tile.openstreetmap.org/14/2627/6331.png" />

Stamen Terrain
~~~~~~~~~~~~~~

Tile Source for Stamen Terrain Service

.. raw:: html

    <img src="https://stamen-tiles.a.ssl.fastly.net/terrain/14/2627/6331.png" />

Stamen Toner
~~~~~~~~~~~~

Tile Source for Stamen Toner Service

.. raw:: html

    <img src="https://stamen-tiles.a.ssl.fastly.net/toner/14/2627/6331.png" />

Stamen Toner Background
~~~~~~~~~~~~~~~~~~~~~~~

Tile Source for Stamen Toner Background Service which does not include labels

.. raw:: html

    <img src="https://stamen-tiles.a.ssl.fastly.net/toner-background/14/2627/6331.png" />

Stamen Toner Labels
~~~~~~~~~~~~~~~~~~~

Tile Source for Stamen Toner Service which includes only labels

.. raw:: html

    <img src="https://stamen-tiles.a.ssl.fastly.net/toner-labels/14/2627/6331.png" />


.. _userguide_geo_google_maps:

Google Maps
-----------

To plot glyphs over a Google Map, use the function :func:`~bokeh.plotting.gmap`.
For the function to work, you must pass it a `Google API Key`_ and configure the Google Map underlay :class:`~bokeh.models.map_plots.GMapOptions`.
The Google API Key will be stored in the Bokeh Document JSON.

.. bokeh-plot:: docs/user_guide/examples/geo_gmap.py
    :source-position: below

.. note::
    Any use of Bokeh with Google Maps must be within Google's Terms of Service.

Google Maps exerts explicit control over aspect ratios at all
times, which imposes some limitations on ``GMapPlot``:

* Only ``Range1d`` ranges are supported. Attempting to use other range types will result in an error.

* Usage of ``BoxZoomTool`` is incompatible with ``GMapPlot`` and adding one will have no effect.

.. _userguide_geo_geojson_data:

GeoJSON data
------------

`GeoJSON`_ is a popular open standard for representing geographical features
with JSON. It describes points, lines, and polygons (called Patches in Bokeh) as a
collection of features. Each feature can also have a set of properties.

Bokeh's ``GeoJSONDataSource`` can be used almost seamlessly in place of Bokeh's
``ColumnDataSource``. For example:

.. bokeh-plot:: docs/user_guide/examples/geo_geojson_source.py
    :source-position: above

.. warning::
    Bokeh converts the GeoJSON coordinates into columns called
    ``x`` and ``y`` or ``xs`` and ``ys`` (depending on whether the features are Points,
    Lines, MultiLines, Polygons, or MultiPolygons). *Properties with clashing names
    will be overridden when the GeoJSON is converted and should be avoided*.

.. _GeoJSON: http://geojson.org
.. _github: https://github.com/bokeh/bokeh
.. _Google API Key: https://developers.google.com/maps/documentation/javascript/get-api-key
.. _Discourse: https://discourse.bokeh.org
.. _xyzservices: https://xyzservices.readthedocs.org
.. _userguide_plotting:

Plotting with basic glyphs
==========================

.. _userguide_plotting_figures:

Creating figures
----------------

Bokeh plots you create with the |bokeh.plotting| interface come with a default
set of tools and visual styles. For information on how to customize the visual
style of plots, see :ref:`userguide_styling`. For information about changing or
specifying tools, see :ref:`userguide_tools`.

.. _userguide_plotting_scatter_markers:

Scatter markers
~~~~~~~~~~~~~~~

Bokeh includes a large variety of markers for creating scatter plots. For
example, to render circle scatter markers on a plot, use the |circle| method of
|figure|:

.. bokeh-plot:: docs/user_guide/examples/plotting_scatter_circle.py
    :source-position: above

Similarly, use the |square| method of |figure| to scatter square markers
on a plot:

.. bokeh-plot:: docs/user_guide/examples/plotting_scatter_square.py
    :source-position: above

Bokeh's built-in scatter markers consist of a set of base markers, most of which
can be combined with different kinds of additional visual features. This is an
overview of all available scatter markers:

.. bokeh-plot:: docs/user_guide/examples/plotting_markertypes.py
    :source-position: none

To see details and example plots for any of the available scatter markers, click
on the corresponding glyph method in the following list:

.. hlist::
    :columns: 3

    * |asterisk|
    * |circle|
    * |circle_cross|
    * |circle_dot|
    * |circle_x|
    * |circle_y|
    * |cross|
    * |dash|
    * |dot|
    * |diamond|
    * |diamond_cross|
    * |diamond_dot|
    * |hex|
    * |hex_dot|
    * |inverted_triangle|
    * |plus|
    * |square|
    * |square_cross|
    * |square_dot|
    * |square_pin|
    * |square_x|
    * |star|
    * |star_dot|
    * |triangle|
    * |triangle_dot|
    * |triangle_pin|
    * |x|
    * |y|

All the markers have the same set of properties: ``x``, ``y``, ``size`` (in
|screen units|), and ``angle`` (in radians by default). The |circle| marker is
an exception: this method accepts an additional ``radius`` property that you can
use with |data units|.

.. _userguide_plotting_line_glyphs:

Line glyphs
~~~~~~~~~~~

Single lines
''''''''''''

The example below shows how to generate a single line glyph from
one-dimensional sequences of ``x`` and ``y`` points using the |line| glyph
method:

.. bokeh-plot:: docs/user_guide/examples/plotting_line_single.py
    :source-position: above

Step lines
''''''''''

For some kinds of data, discrete steps between data points may work better than
linear segments. To produce this type of data representation, use the |step|
glyph method.

.. bokeh-plot:: docs/user_guide/examples/plotting_line_steps.py
    :source-position: above

Adjust the ``mode`` parameter to draw step levels with the x-coordinates
before, after, or in the middle of each step.

.. _userguide_plotting_line_glyphs_multi:

Multiple lines
''''''''''''''

If you want to draw multiple lines in one go, use the |multi_line| glyph
method as follows:

.. bokeh-plot:: docs/user_guide/examples/plotting_line_multiple.py
    :source-position: above

.. note::
    Unlike many other glyph methods, |multi_line| accepts a list of lists of
    ``x`` and ``y`` positions for each line. The |multi_line| method also
    expects a scalar value or a list of scalars for each line for parameters
    such as color, alpha, and line width. You can similarly use a
    ``ColumnDataSource`` consisting of a list of lists of point coordinates
    and a list of scalar values of matching length.

Missing points
''''''''''''''

You can pass ``NaN`` values to |line| and |multi_line| glyphs. This produces
disjointed lines with gaps for ``NaN`` values.

.. bokeh-plot:: docs/user_guide/examples/plotting_line_missing_points.py
    :source-position: above

Stacked lines
'''''''''''''

You may wish to stack lines with a common index when working with time series
of percentages and other similar data. To do so, you can use the |vline_stack|
and |hline_stack| convenience methods.

.. bokeh-plot:: docs/user_guide/examples/plotting_vline_stack.py
    :source-position: above

.. note::
    This and other examples in this chapter rely on ```ColumnDataSource`` for
    data structuring. For information on how to work with this data structure,
    see :ref:`userguide_data`.

.. _userguide_plotting_bars_rects:

Bars and rectangles
~~~~~~~~~~~~~~~~~~~

Bars
''''

To make drawing rectangular bars more convenient, Bokeh provides |hbar| and
|vbar| glyph functions that combine the coordinate systems above.

To draw vertical bars by specifying a center x-coordinate, width, and top and
bottom endpoints, use the |vbar| glyph function:

.. bokeh-plot:: docs/user_guide/examples/plotting_vbar.py
    :source-position: above

To draw horizontal bars by specifying a center y-coordinate, height, and left
and right endpoints, use the |hbar| glyph function:

.. bokeh-plot:: docs/user_guide/examples/plotting_hbar.py
    :source-position: above

Stacked bars
''''''''''''

To stack the bars, you can use the |vbar_stack| and |hbar_stack| convenience
methods.

.. bokeh-plot:: docs/user_guide/examples/plotting_hbar_stack.py
    :source-position: above

For more examples of stacked bars, see :ref:`userguide_categorical`.

Rectangles
''''''''''

To draw *axis aligned* rectangles by specifying the ``left``, ``right``,
``top``, and ``bottom`` positions, use the |quad| glyph function:

.. bokeh-plot:: docs/user_guide/examples/plotting_rectangles_quad.py
    :source-position: above

To draw *axis aligned* rectangles by specifying the ``x`` and ``y``
coordinates for a corner, and a ``width`` and ``height``, use the |block|
glyph function:

.. bokeh-plot:: docs/user_guide/examples/plotting_rectangles_block.py
    :source-position: above

To draw arbitrary rectangles by specifying center coordinates, ``width``,
``height``, and ``angle``, use the |rect| glyph function:

.. bokeh-plot:: docs/user_guide/examples/plotting_rectangles_rect.py
    :source-position: above

.. _userguide_plotting_hex:

Hex tiles
~~~~~~~~~

Bokeh can plot hexagonal tiles, which you can use to show binned aggregations
and more. The :func:`~bokeh.plotting.figure.hex_tile` method takes a ``size``
parameter to define the size of the hex grid and `axial coordinates`_ to
specify the tiles.

.. bokeh-plot:: docs/user_guide/examples/plotting_hex_tile_basic.py
    :source-position: above

A more practical example below computes counts per bin using the
:func:`~bokeh.util.hex.hexbin` function and plots the color mapped counts.

.. bokeh-plot:: docs/user_guide/examples/plotting_hex_tile_binning.py
    :source-position: above

You can simplify this code by calling the :func:`~bokeh.plotting.figure.hexbin`
method of |figure|.

.. _userguide_plotting_directed_areas:

Directed areas
~~~~~~~~~~~~~~

Directed areas are filled regions between two series that share a common index.
For instance, a vertical directed area has one ``x`` coordinate array and two
``y`` coordinate arrays, ``y1`` and ``y2``, defining the space for Bokeh to
fill.

Single areas
''''''''''''

To fill an area in vertical direction, use the |varea| method. You can do the
same in horizontal direction with |harea|.

.. bokeh-plot:: docs/user_guide/examples/plotting_varea.py
    :source-position: above

Stacked areas
'''''''''''''

To stack directed areas, use the |varea_stack| and |harea_stack| convenience
methods.

.. bokeh-plot:: docs/user_guide/examples/plotting_varea_stack.py
    :source-position: above

.. _userguide_plotting_patch_polygon_glyphs:

Patches and polygons
~~~~~~~~~~~~~~~~~~~~

Single patches
''''''''''''''

The following example generates a single polygonal patch from one-dimensional
sequences of ``x`` and ``y`` points using the |patch| glyph method:

.. bokeh-plot:: docs/user_guide/examples/plotting_patch_single.py
    :source-position: above

Multiple patches
''''''''''''''''

To plot several polygonal patches, use the |patches| glyph method:

.. bokeh-plot:: docs/user_guide/examples/plotting_patch_multiple.py
    :source-position: above

.. note::
    Unlike many other glyph methods, |patches| accepts a list of lists of ``x``
    and ``y`` positions for each line. The |patches| method also expects a
    scalar value or a list of scalars for each patch for parameters such as
    color, alpha, and line width. You can similarly use a ``ColumnDataSource``
    consisting of a list of lists of point coordinates and a list of scalar
    values of matching length.

Missing points
''''''''''''''

Just as with the |line| and |multi_line| methods, you can pass ``NaN`` values
to |patch| and |patches| glyphs. This produces disjointed patches with gaps
for ``NaN`` values.

.. bokeh-plot:: docs/user_guide/examples/plotting_patch_missing_points.py
    :source-position: above

.. warning::
    Bokeh doesn't currently support hit testing on patch objects with ``NaN``
    values.

.. _userguide_plotting_multipolygons:

Polygons
~~~~~~~~

The |multi_polygons| glyph uses nesting to accept a variety of information
relevant to polygons. The method duplicates the functionality of |patches| but
you can also use it to render holes inside polygons.

.. note::
    Unlike many other glyph methods, |multi_polygons| accepts a triple-nested
    lists of ``x`` and ``y`` positions for the exterior and holes composing
    each polygon. The |multi_polygons| method also expects a scalar value or a
    list of scalars for each item for parameters such as color, alpha, and line
    width. You can similarly use a ``ColumnDataSource`` consisting of a triple-
    nested list of point coordinates and a list of scalars, with the top-level
    list of point coordinates being of equal length with the list of scalars.

Simple polygon
''''''''''''''

The following example generates a single polygon from a triple-nested list of
one-dimensional sequences of ``x`` and ``y`` points using the |multi_polygons|
glyph method.

.. bokeh-plot:: docs/user_guide/examples/plotting_multipolygon_simple.py
    :source-position: above

Polygon with holes
''''''''''''''''''

The following example generates a single polygon with holes from three
sequences of ``x`` and ``y`` points. The first sequence represents
the exterior of the polygon and the following sequences represent the holes.

.. bokeh-plot:: docs/user_guide/examples/plotting_multipolygon_with_holes.py
    :source-position: above

Multi-polygon with separate parts
'''''''''''''''''''''''''''''''''

A single polygon concept can comprise multiple polygon geometries. The
following example generates a multi-polygon glyph from several sequences of
``x`` and ``y`` points. Each item in the sequence represents a part of the
glyph.

.. bokeh-plot:: docs/user_guide/examples/plotting_multipolygon_with_separate_parts.py
    :source-position: above

Multiple multi-polygons
'''''''''''''''''''''''

The top-level of nesting separates each multi-polygon from the rest. You can
think of each multi-polygon as a row in the data source, potentially with a
corresponding label or color.

.. bokeh-plot:: docs/user_guide/examples/plotting_multipolygons.py
    :source-position: above

.. _userguide_plotting_ellipses:

Ellipses
~~~~~~~~

The |ellipse| glyph method accepts the same properties as |rect|, but renders
ellipse shapes.

.. bokeh-plot:: docs/user_guide/examples/plotting_ellipses.py
    :source-position: above


.. _userguide_plotting_images:

Images
~~~~~~

You can display images on Bokeh plots using the |image|, |image_rgba|, and
|image_url| glyph methods. You can use hovering tooltips with image glyphs
to let the user see the values of each pixel. For more information on how to
enable hovering tooltips for images, see
:ref:`Image hover <userguide_tools_image_hover>`.

.. _userguide_plotting_images_rgba:

Raw RGBA data
'''''''''''''

The following example shows how to display images using raw RGBA data with the
|image_rgba| method.

.. bokeh-plot:: docs/user_guide/examples/plotting_image_rgba.py
    :source-position: above

.. _userguide_plotting_images_colormapped:

Color mapped images
'''''''''''''''''''

The following example shows how to supply an array of *scalar values* and have
Bokeh automatically color map the data in the browser with the |image| glyph
method.

.. bokeh-plot:: docs/user_guide/examples/plotting_image.py
    :source-position: above

Note that this example sets the render level to ``"image"``. Normally, Bokeh
draws all glyphs *above* grid lines, but with this render level they appear
*below* the grid lines.

.. _userguide_plotting_segments_rays:

Segments and rays
~~~~~~~~~~~~~~~~~

To draw multiple individual line segments use the |segment| and |ray| glyph
methods.

The |segment| method accepts the starting points ``x0`` and ``y0`` and end
points ``x1`` and ``y1``. It renders segments between those points.

.. bokeh-plot:: docs/user_guide/examples/plotting_segments.py
    :source-position: above

The |ray| method accepts the starting points ``x`` and ``y`` with a ``length``
(in |screen units|) and an ``angle``. The ``angle_units`` parameter defaults to
``"rad"`` but you can also set it to ``"deg"`` to have the angle measured in
degrees instead of radians. To have an "infinite" ray that always extends to the
edge of the plot, set ``length`` to ``0``.

.. bokeh-plot:: docs/user_guide/examples/plotting_ray.py
    :source-position: above

.. _userguide_plotting_wedges_arcs:

Wedges and arcs
~~~~~~~~~~~~~~~

To draw a simple line arc, use the |arc| glyph method, which accepts
``radius``, ``start_angle``, and ``end_angle`` to determine position.
Additionally, the ``direction`` property determines whether to render
clockwise (``"clock"``) or anti-clockwise (``"anticlock"``) between the start
and end angles.

.. bokeh-plot:: docs/user_guide/examples/plotting_arcs.py
    :source-position: above

The |wedge| glyph method accepts the same properties as |arc| but renders a
filled wedge instead:

.. bokeh-plot:: docs/user_guide/examples/plotting_wedge.py
    :source-position: above

The |annular_wedge| glyph method is similar to |wedge| but leaves an inner
portion of the wedge hollow. It accepts an ``inner_radius`` and
``outer_radius`` instead of just ``radius``.

.. bokeh-plot:: docs/user_guide/examples/plotting_annular_wedge.py
    :source-position: above

Finally, the |annulus| glyph method also accepts ``inner_radius`` and
``outer_radius`` to produce hollow circles.

.. bokeh-plot:: docs/user_guide/examples/plotting_annulus.py
    :source-position: above

.. _userguide_plotting_quadratic_cubic_curves:

Specialized curves
~~~~~~~~~~~~~~~~~~

To draw parameterized quadratic and cubic curves, use the |quadratic| and
|bezier| glyph methods. For more detail on these curves, see
:ref:`reference documentation <bokeh.plotting>`.

.. _userguide_plotting_multiple_glyphs:

Combining multiple glyphs
-------------------------

You can combine multiple glyphs on a single plot by calling their methods on a
single |figure|.

.. bokeh-plot:: docs/user_guide/examples/plotting_multiple_glyphs.py
    :source-position: above

This principle applies to all |bokeh.plotting| glyph methods. You can add as
many glyphs to a Bokeh plot as you want.

.. _userguide_plotting_setting_ranges:

Setting ranges
--------------

By default, Bokeh attempts to automatically set the data bounds of plots to fit
snugly around the data. You may, however, need to set a plot's range
explicitly. To do so, set the ``x_range`` and/or ``y_range`` properties using a
``Range1d`` object that lets you set the *start* and *end* points of the range
you want.

.. code-block:: python

    p.x_range = Range1d(0, 100)

For convenience, the |figure| function can also accept *(start, end)* tuples as
values for the ``x_range`` or ``y_range`` parameters. Here's how you can use
both methods to set a range:

.. bokeh-plot:: docs/user_guide/examples/plotting_figure_range.py
    :source-position: above

Ranges also have a ``bounds`` property that lets you specify the limits of the
plot beyond which the user cannot pan or zoom.

.. code-block:: python

    # set a range using a Range1d
    p.y_range = Range1d(0, 15, bounds=(0, None))

.. _userguide_plotting_axis_types:

Specifying axis types
---------------------

All the examples above use the default linear axis. This axis is suitable for
plots that need to show numerical data on a linear scale. However, you may have
categorical data or need to display numerical data on a datetime or log scale.
This section shows you how to specify the axis type when using the
|bokeh.plotting| interface.

.. _userguide_plotting_categorical_axes:

Categorical axes
~~~~~~~~~~~~~~~~

To create a categorical axis, specify a
:class:`~bokeh.models.ranges.FactorRange` for one of the plot's ranges or a
list of factors to be converted to one. Here's an example:

.. bokeh-plot:: docs/user_guide/examples/plotting_categorical_axis.py
    :source-position: above

.. _userguide_plotting_datetime_axes:

For complete details, see :ref:`userguide_categorical`.

Datetime axes
~~~~~~~~~~~~~

.. note::
    The example in this section requires a network connection and depends on
    the open source Pandas library to present realistic time series data.

For time series, or any data that involves dates or time, you may want to
use axes with labels suitable for different date and time scales.

The |figure| function accepts ``x_axis_type`` and ``y_axis_type`` as arguments.
To specify a datetime axis, pass ``"datetime"`` for the value of either of
these parameters.

.. bokeh-plot:: docs/user_guide/examples/plotting_datetime_axis.py
    :source-position: above

.. note::
    Future versions of Bokeh will attempt to auto-detect situations when
    datetime axes are appropriate and add them automatically.

.. _userguide_plotting_log_axes:

Log scale axes
~~~~~~~~~~~~~~

Data that grows exponentially or covers many orders of magnitude often requires
one axis to be on a log scale. For data that has a power law relationship, you
may want to use log scales on both axes.

You can use the same |figure| arguments, ``x_axis_type`` and ``y_axis_type``,
to set one or both of the axes to ``"log"``.

By default, Bokeh calculates log axis ranges to fit around positive value data.
For information on how to set your own ranges, see
:ref:`userguide_plotting_setting_ranges`.

.. bokeh-plot:: docs/user_guide/examples/plotting_log_scale_axis.py
    :source-position: above

.. _userguide_plotting_twin_axes:

Twin axes
~~~~~~~~~

You can add multiple axes representing different ranges to a single plot. To do
this, configure the plot with "extra" named ranges in the ``extra_x_range`` and
``extra_y_range`` properties. You can then refer to these named ranges when
adding new glyph methods as well as when adding new axis objects with the
``add_layout`` method of the |plot|. Here's an example:

.. bokeh-plot:: docs/user_guide/examples/plotting_twin_axes.py
    :source-position: above

.. _axial coordinates: https://www.redblobgames.com/grids/hexagons/#coordinates-axial

.. |annular_wedge|     replace:: :func:`~bokeh.plotting.figure.annular_wedge`
.. |annulus|           replace:: :func:`~bokeh.plotting.figure.annulus`
.. |arc|               replace:: :func:`~bokeh.plotting.figure.arc`
.. |asterisk|          replace:: :func:`~bokeh.plotting.figure.asterisk`
.. |bezier|            replace:: :func:`~bokeh.plotting.figure.bezier`
.. |block|             replace:: :func:`~bokeh.plotting.figure.block`
.. |circle|            replace:: :func:`~bokeh.plotting.figure.circle`
.. |circle_cross|      replace:: :func:`~bokeh.plotting.figure.circle_cross`
.. |circle_dot|        replace:: :func:`~bokeh.plotting.figure.circle_dot`
.. |circle_x|          replace:: :func:`~bokeh.plotting.figure.circle_x`
.. |circle_y|          replace:: :func:`~bokeh.plotting.figure.circle_y`
.. |cross|             replace:: :func:`~bokeh.plotting.figure.cross`
.. |dash|              replace:: :func:`~bokeh.plotting.figure.dash`
.. |diamond|           replace:: :func:`~bokeh.plotting.figure.diamond`
.. |diamond_cross|     replace:: :func:`~bokeh.plotting.figure.diamond_cross`
.. |diamond_dot|       replace:: :func:`~bokeh.plotting.figure.diamond_dot`
.. |dot|               replace:: :func:`~bokeh.plotting.figure.dot`
.. |ellipse|           replace:: :func:`~bokeh.plotting.figure.ellipse`
.. |harea|             replace:: :func:`~bokeh.plotting.figure.harea`
.. |harea_stack|       replace:: :func:`~bokeh.plotting.figure.harea_stack`
.. |hbar_stack|        replace:: :func:`~bokeh.plotting.figure.hbar_stack`
.. |hex|               replace:: :func:`~bokeh.plotting.figure.hex`
.. |hex_dot|           replace:: :func:`~bokeh.plotting.figure.hex_dot`
.. |hline_stack|       replace:: :func:`~bokeh.plotting.figure.hline_stack`
.. |inverted_triangle| replace:: :func:`~bokeh.plotting.figure.inverted_triangle`
.. |image|             replace:: :func:`~bokeh.plotting.figure.image`
.. |image_rgba|        replace:: :func:`~bokeh.plotting.figure.image_rgba`
.. |image_url|         replace:: :func:`~bokeh.plotting.figure.image_url`
.. |line|              replace:: :func:`~bokeh.plotting.figure.line`
.. |multi_line|        replace:: :func:`~bokeh.plotting.figure.multi_line`
.. |multi_polygons|    replace:: :func:`~bokeh.plotting.figure.multi_polygons`
.. |patch|             replace:: :func:`~bokeh.plotting.figure.patch`
.. |patches|           replace:: :func:`~bokeh.plotting.figure.patches`
.. |plus|              replace:: :func:`~bokeh.plotting.figure.plus`
.. |quad|              replace:: :func:`~bokeh.plotting.figure.quad`
.. |quadratic|         replace:: :func:`~bokeh.plotting.figure.quadratic`
.. |ray|               replace:: :func:`~bokeh.plotting.figure.ray`
.. |rect|              replace:: :func:`~bokeh.plotting.figure.rect`
.. |segment|           replace:: :func:`~bokeh.plotting.figure.segment`
.. |step|              replace:: :func:`~bokeh.plotting.figure.step`
.. |square|            replace:: :func:`~bokeh.plotting.figure.square`
.. |square_cross|      replace:: :func:`~bokeh.plotting.figure.square_cross`
.. |square_dot|        replace:: :func:`~bokeh.plotting.figure.square_dot`
.. |square_pin|        replace:: :func:`~bokeh.plotting.figure.square_pin`
.. |square_x|          replace:: :func:`~bokeh.plotting.figure.square_x`
.. |star|              replace:: :func:`~bokeh.plotting.figure.star`
.. |star_dot|          replace:: :func:`~bokeh.plotting.figure.star_dot`
.. |triangle|          replace:: :func:`~bokeh.plotting.figure.triangle`
.. |triangle_dot|      replace:: :func:`~bokeh.plotting.figure.triangle_dot`
.. |triangle_pin|      replace:: :func:`~bokeh.plotting.figure.triangle_pin`
.. |varea|             replace:: :func:`~bokeh.plotting.figure.varea`
.. |varea_stack|       replace:: :func:`~bokeh.plotting.figure.varea_stack`
.. |vbar_stack|        replace:: :func:`~bokeh.plotting.figure.vbar_stack`
.. |vline_stack|       replace:: :func:`~bokeh.plotting.figure.vline_stack`
.. |wedge|             replace:: :func:`~bokeh.plotting.figure.wedge`
.. |x|                 replace:: :func:`~bokeh.plotting.figure.x`
.. |y|                 replace:: :func:`~bokeh.plotting.figure.y`
.. _userguide_bokehjs:

Developing with JavaScript
==========================

BokehJS is a client-side library that lets you create interactive plots and
applications. It takes care of drawing, rendering, and event handling. The
Bokeh Python library (and libraries for other languages such as R, Scala,
and Julia) enables convenient high-level interaction with BokehJS, so you
don't have to worry about JavaScript or web development.

However, BokehJS also has its own API that lets you do pure JavaScript development
using BokehJS directly. Additionally, :ref:`userguide_extensions` with custom
models typically require direct interaction with BokehJS.

.. warning::
    The BokehJS APIs is still in development and may undergo changes in future
    releases.

Obtaining BokehJS
-----------------

BokehJS is available via CDN and ``npm``. See the :ref:`install_bokehjs`
section of the :ref:`installation` page for more details.


.. _userguide_bokehjs_models:

Low-level models
----------------

Generally, the low-level models for plots and applications (such as guides,
glyphs, widgets) match the Bokeh Python models exactly. The |reference guide|
is therefore the primary reference for BokehJS models, even though it
focuses on Python.

Whereas the Python library is organized hierarchically, JavaScript models
are all in one flat ``Bokeh`` module. Typically any Python ``ClassName``
is available as ``Bokeh.ClassName`` in JavaScript. For a complete list
of JavaScript models, see :bokeh-tree:`bokehjs/src/lib/api/models.ts`.

When creating models in JavaScript, make a JavaScript object of all the
keyword arguments you'd pass to the Python object initializer. Here is an
example of how to initialize a `Range1d` model in both languages:

• Python

  .. code-block:: python

    xdr = Range1d(start=-0.5, end=20.5)

• JavaScript

  .. code-block:: javascript

    const xdr = new Bokeh.Range1d({ start: -0.5, end: 20.5 });

This pattern works in all similar situations. Once you create a Bokeh model,
you can set its properties in exactly the same way in both languages. For
example, ``xdr.end = 30`` sets the ``end`` value to 30 on the `Range1d` model
above in both Python and JavaScript.

Below is an example that creates a plot with axes, grids, and a line glyph
from scratch. Compare with samples in :bokeh-tree:`examples/models` and
you'll see that the code in Python and JavaScript is nearly identical at
this level:

.. bokehjs-content::
    :title: Bokeh simple line
    :js_file: docs/user_guide/examples/simple_line.js

.. _userguide_bokehjs_interfaces:

Interfaces
----------

Similar to the Python Bokeh library, BokehJS provides various higher-level
interfaces. These interfaces let you interact with and compose low-level
model objects. The higher-level interfaces comprise ``Bokeh.Plotting`` and
``Bokeh.Charts``.

.. note::
    Starting from version ``0.12.2`` these APIs make up the BokehJS API in
    the ``bokeh-api.js`` file. You'll have to import this file in addition
    to ``bokeh.js`` to enable these APIs.

.. _userguide_bokehjs_interfaces_plotting:

``Bokeh.Plotting``
~~~~~~~~~~~~~~~~~~

The JavaScript ``Bokeh.Plotting`` API is a port of the Python
|bokeh.plotting| interface. Accordingly, the information in the
:ref:`userguide_plotting` section of the User guide can be a useful
reference in addition to the material provided here.

The JavaScript sample below is very similar to the Python code in
:bokeh-tree:`examples/plotting/file/color_scatter.py`:

.. bokehjs-content::
    :title: Bokeh color scatter

    const plt = Bokeh.Plotting;

    // set up some data
    const M = 100;
    const xx = [];
    const yy = [];
    const colors = [];
    const radii = [];
    for (let y = 0; y <= M; y += 4) {
        for (let x = 0; x <= M; x += 4) {
            xx.push(x);
            yy.push(y);
            colors.push(plt.color([50+2*x, 30+2*y, 150]));
            radii.push(Math.random() * 0.4 + 1.7)
        }
    }

    // create a data source
    const source = new Bokeh.ColumnDataSource({
        data: { x: xx, y: yy, radius: radii, colors: colors }
    });

    // make the plot and add some tools
    const tools = "pan,crosshair,wheel_zoom,box_zoom,reset,save";
    const p = plt.figure({ title: "Colorful Scatter", tools: tools });

    // call the circle glyph method to add some circle glyphs
    const circles = p.circle({ field: "x" }, { field: "y" }, {
        source: source,
        radius: radii,
        fill_color: { field: "colors" },
        fill_alpha: 0.6,
        line_color: null
    });

    // show the plot
    plt.show(p);

.. _userguide_bokehjs_interfaces_charts:

``Bokeh.Charts``
~~~~~~~~~~~~~~~~

The JavaScript ``Bokeh.Charts`` API is a high-level charting interface that
is unique to BokehJS. The API supports two high-level charts: ``pie`` and ``bar``.

.. _userguide_bokehjs_interfaces_charts_pie:

``Bokeh.Charts.pie``
''''''''''''''''''''

The following lets you create basic pie charts with ``Bokeh.Charts.pie``:

.. code-block:: javascript

    Bokeh.Charts.pie(data, { options })

Where ``data`` is a JavaScript object that has ``labels`` and
``values`` keys and ``options`` is an object that can include
any of the following optional keys:

:``width``: *number* --- chart width in pixels
:``height``: *number* --- chart height in pixels
:``inner_radius``: *number* --- inner radius for wedges in pixels
:``outer_radius``: *number* --- outer radius for wedges in pixels
:``start_angle``: *number* --- start angle for wedges in radians
:``end_angle``: *number* --- end angle for wedges in radians
:``center``: *[number, number]* --- ``(x, y)`` location of the pie center in pixels
:``palette``: *Palette | Array<Color>* --- a named palette or list of colors to color-map the values
:``slice_labels``: *"labels" | "values" | "percentages"* --- what the tooltip should show

By default, plots created with ``Bokeh.Charts.pie`` automatically add a tooltip
and hover policy. Here is an example of a ``pie`` chart and the plot it generates:

.. bokehjs-content::
    :title: Bokeh pie chart

    const plt = Bokeh.Plotting;

    const pie_data = {
        labels: ['Work', 'Eat', 'Commute', 'Sport', 'Watch TV', 'Sleep'],
        values: [8, 2, 2, 4, 0, 8],
    };

    const p1 = Bokeh.Charts.pie(pie_data);
    const p2 = Bokeh.Charts.pie(pie_data, {
        inner_radius: 0.2,
        start_angle: Math.PI / 2
    });
    const p3 = Bokeh.Charts.pie(pie_data, {
        inner_radius: 0.2,
        start_angle: Math.PI / 6,
        end_angle: 5 * Math.PI / 6
    });
    const p4 = Bokeh.Charts.pie(pie_data, {
        inner_radius: 0.2,
        palette: "Oranges9",
        slice_labels: "percentages"
    });

    // add the plot to a document and display it
    const doc = new Bokeh.Document();
    doc.add_root(plt.gridplot(
                     [[p1, p2], [p3, p4]],
                     {width: 250, height: 250}));
    Bokeh.embed.add_document_standalone(doc, document.currentScript.parentElement);

.. _userguide_bokehjs_interfaces_charts_bar:

``Bokeh.Charts.bar``
''''''''''''''''''''

The following lets you create basic bar charts with ``Bokeh.Charts.bar``:

.. code-block:: javascript

    Bokeh.Charts.bar(data, { options })

Where ``data`` is an array with entries representing rows of a data table.
The first row should contain the column headers. Here is an example of
some sales data from different regions for different years:

.. code-block:: javascript

    const data = [
        ['Region', 'Year', 'Sales'],
        ['East',   2015,    23000 ],
        ['East',   2016,    35000 ],
        ['West',   2015,    16000 ],
        ['West',   2016,    34000 ],
        ['North',  2016,    12000 ],
    ];

Similar to the ``pie`` chart, the ``options`` parameter is an object that
can include any of the following optional keys:

:``width``: *number* --- chart width in pixels
:``height``: *number* --- chart height in pixels
:``stacked``: *boolean* --- whether the bars should be stacked or not
:``orientation``: *"horizontal" | "vertical"* --- how the bars should be oriented
:``bar_width``: *number* --- width of each bar in pixels
:``palette``: *Palette | Array<Color>* --- a named palette or list of colors to color-map the values
:``axis_number_format``: *string* --- a format string to use for axis ticks

By default, plots created with ``Bokeh.Charts.bar`` automatically add a tooltip
and hover policy. Here is an example of a ``bar`` chart and the plot it generates:

.. bokehjs-content::
    :title: Bokeh bar chart

    const plt = Bokeh.Plotting;

    const bar_data = [
        ['City', '2010 Population', '2000 Population'],
        ['NYC', 8175000, 8008000],
        ['LA', 3792000, 3694000],
        ['Chicago', 2695000, 2896000],
        ['Houston', 2099000, 1953000],
        ['Philadelphia', 1526000, 1517000],
    ];

    const p1 = Bokeh.Charts.bar(bar_data, {
        axis_number_format: "0.[00]a"
    });
    const p2 = Bokeh.Charts.bar(bar_data, {
        axis_number_format: "0.[00]a",
        stacked: true
    });
    const p3 = Bokeh.Charts.bar(bar_data, {
        axis_number_format: "0.[00]a",
        orientation: "vertical"
    });
    const p4 = Bokeh.Charts.bar(bar_data, {
        axis_number_format: "0.[00]a",
        orientation: "vertical",
        stacked: true
    });

    plt.show(plt.gridplot([[p1, p2], [p3, p4]], {width: 350, height: 350}));

.. _userguide_bokehjs_issues:

Known Issues
------------

* :bokeh-issue:`11016` figure name passed to `renderer.glyph.name` but not `renderer.name`
* :bokeh-issue:`11034` Palettes not accessible by name for `ColorMapper` objects in BokehJS
* :bokeh-issue:`11035` `Bokeh.Widgets.Div()` missing `tools`, required by `Bokeh.Plotting.gridplot()`
* :bokeh-issue:`11036` Making axis range padding persistent requires changing `._initial_range_padding` as well
* :bokeh-issue:`11037` Using `sizing_mode` in gridplot layouts requires explicit assignment
* :bokeh-issue:`11038` Calling `figure({title:"some title"})` replaces Title object with string, prevents subsequent updates to title text

Minimal example
---------------

The following basic example shows how to import libraries and
create and modify plots.

.. bokehjs-content::
    :title: Minimal Example
    :include_html: true
    :disable_codepen: true

    // create a data source to hold data
    const source = new Bokeh.ColumnDataSource({
        data: { x: [], y: [] }
    });

    // make a plot with some tools
    const plot = Bokeh.Plotting.figure({
        title: 'Example of random data',
        tools: "pan,wheel_zoom,box_zoom,reset,save",
        height: 300,
        width: 300
    });

    // add a line with data from the source
    plot.line({ field: "x" }, { field: "y" }, {
        source: source,
        line_width: 2
    });

    // show the plot, appending it to the end of the current section
    Bokeh.Plotting.show(plot);

    function addPoint() {
        // add data --- all fields must be the same length.
        source.data.x.push(Math.random())
        source.data.y.push(Math.random())

        // update the data source with local changes
        source.change.emit()
    }

    const addDataButton = document.createElement("Button");
    addDataButton.appendChild(document.createTextNode("Some data."));
    document.currentScript.parentElement.appendChild(addDataButton);
    addDataButton.addEventListener("click", addPoint);

    addPoint();
    addPoint();
.. _userguide_server:

Running a Bokeh server
======================

.. _userguide_server_purpose:

Purpose
-------

.. note::
    To make this guide easier to follow, consider familiarizing
    yourself with some of the core concepts of Bokeh in the section
    :ref:`userguide_concepts`.

Bokeh server makes it easy to create interactive web applications that connect
front-end UI events to running Python code.

Bokeh creates high-level Python models, such as plots, ranges, axes, and
glyphs, and then converts these objects to JSON to pass them to its client
library, BokehJS. For more information on the latter, see
:ref:`contributor_guide_bokehjs`.

This flexible and decoupled design offers some advantages. For instance, it is
easy to have other languages, such as R or Scala, drive Bokeh plots and
visualizations in the browser.

However, keeping these models in sync between the Python environment and the
browser would provide further powerful capabilities:

* respond to UI and tool events in the browser with computations or queries
  using the full power of Python
* automatically push server-side updates to the UI elements such as widgets or
  plots in the browser
* use periodic, timeout, and asynchronous callbacks to drive streaming updates

This is where the Bokeh server comes into play:

**The primary purpose of the Bokeh server is to synchronize data between the
underlying Python environment and the BokehJS library running in the browser.**

----

Here's a simple example from `demo.bokeh.org`_ that illustrates this behavior.

.. raw:: html

    <div>
    <iframe
        src="https://demo.bokeh.org/sliders"
        frameborder="0"
        style="overflow:hidden;height:400px;width: 90%;

        -moz-transform-origin: top left;
        -webkit-transform-origin: top left;
        -o-transform-origin: top left;
        -ms-transform-origin: top left;
        transform-origin: top left;"
        height="460"
    ></iframe>
    </div>

Manipulating the UI controls communicates new values to the backend via Bokeh
server. This also triggers callbacks that update the plots with the input in
real time.

.. _userguide_server_use_case:

Use case scenarios
------------------

Consider a few different scenarios when you might want to use the Bokeh server.

.. _userguide_server_use_case_individual:

Local or individual use
~~~~~~~~~~~~~~~~~~~~~~~

You might want to use the Bokeh server for exploratory data analysis, possibly
in a Jupyter notebook, or for a small app that you and your colleagues can run
locally.

The Bokeh server is very convenient here, allowing for quick and simple
deployment through effective use of Bokeh server applications. For more
detail, see :ref:`userguide_server_applications`.

.. _userguide_server_use_case_deployed:

Creating deployable applications
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You might also want to use the Bokeh server to publish interactive data
visualizations and applications to a wider audience, say, on the internet
or an internal company network. The Bokeh server also suits this usage well,
but you might want to first consult the following:

* For information on how to create Bokeh applications, see
  :ref:`userguide_server_applications`.
* For information on how to deploy a server with your application, see
  :ref:`userguide_server_deployment`.


.. _userguide_server_use_case_shared:

Shared publishing
~~~~~~~~~~~~~~~~~

Both of the scenarios above involve *one person* making applications on the
server, either for personal use or for consumption by a larger audience.

While it is possible for *several people* to publish different applications
to the same server, **this does not make for a good use case** because hosted
applications can execute arbitrary Python code. This raises process isolation
and security concerns and makes this kind of shared tenancy prohibitive.

One way to support this kind of multi-application environment with multiple
users is to build up infrastructure that can run a Bokeh server for each app or
at least for each user. The Bokeh project or a third party might create a
public service for this kind of usage in the future but such developments are
beyond the scope this documentation.

Another possibility is to have one app that can access data and other artifacts
published by many different people, possibly with access controls. This sort of
scenario *is* possible with the Bokeh server, but often involves integrating it
with other web application frameworks.

.. _userguide_server_applications:

Building Bokeh applications
---------------------------

By far the most flexible way to create interactive data visualizations with
the Bokeh server is to create Bokeh applications and serve them with the
``bokeh serve`` command. The Bokeh server then uses the application code to
create sessions and documents for all connecting browsers.

.. figure:: /_images/bokeh_serve.svg
    :align: center
    :width: 65%

    The Bokeh server (left) uses the application code to create Bokeh
    documents. Every new connection from a browser (right) results in
    the server creating a new document just for that session.

The Bokeh server executes the application code with every new connection and
creates a new Bokeh document, syncing it to the browser. The application code
also sets up the callbacks that should run whenever properties, such as widget
values, change.

You can provide the application code in several ways.

.. _userguide_server_applications_single_module:

Single module format
~~~~~~~~~~~~~~~~~~~~

Consider the following complete example.

.. code-block:: python

    # myapp.py

    from random import random

    from bokeh.layouts import column
    from bokeh.models import Button
    from bokeh.palettes import RdYlBu3
    from bokeh.plotting import figure, curdoc

    # create a plot and style its properties
    p = figure(x_range=(0, 100), y_range=(0, 100), toolbar_location=None)
    p.border_fill_color = 'black'
    p.background_fill_color = 'black'
    p.outline_line_color = None
    p.grid.grid_line_color = None

    # add a text renderer to the plot (no data yet)
    r = p.text(x=[], y=[], text=[], text_color=[], text_font_size="26px",
               text_baseline="middle", text_align="center")

    i = 0

    ds = r.data_source

    # create a callback that adds a number in a random location
    def callback():
        global i

        # BEST PRACTICE --- update .data in one step with a new dict
        new_data = dict()
        new_data['x'] = ds.data['x'] + [random()*70 + 15]
        new_data['y'] = ds.data['y'] + [random()*70 + 15]
        new_data['text_color'] = ds.data['text_color'] + [RdYlBu3[i%3]]
        new_data['text'] = ds.data['text'] + [str(i)]
        ds.data = new_data

        i = i + 1

    # add a button widget and configure with the call back
    button = Button(label="Press Me")
    button.on_event('button_click', callback)

    # put the button and plot in a layout and add to the document
    curdoc().add_root(column(button, p))

The code above doesn't specify any output or connection method. It is a simple
script that creates and updates objects. The ``bokeh`` command line tool lets
you specify output options after processing your data. You could, for example,
run ``bokeh json myapp.py`` to get a JSON-serialized version of the app.
However, to run the app on a Bokeh server, use the following command:

.. code-block:: sh

    bokeh serve --show myapp.py

The ``--show`` option will cause your default browser to open a new tab at the
address of the running application, which in this case is:

.. code-block:: none

    http://localhost:5006/myapp

If you have only one application, the server root will redirect to it.
Otherwise, you will see an index of all applications running on the server
root:

.. code-block:: none

    http://localhost:5006/

You can disable this index with the ``--disable-index`` option. Likewise, you
can disable redirecting with the ``--disable-index-redirect`` option.

In addition to creating Bokeh applications from single Python files, you can
also create applications from directories.


.. _userguide_server_applications_directory:

Directory format
~~~~~~~~~~~~~~~~

You can create Bokeh apps by creating and populating a filesystem directory
with application files. To start an application in a directory named ``myapp``,
you could execute ``bokeh serve`` as follows:

.. code-block:: sh

    bokeh serve --show myapp

This directory must contain a ``main.py`` file that constructs a document for
the Bokeh server to serve:

.. code-block:: none

    myapp
       |
       +---main.py

The following is the directory app structure that the Bokeh server is familiar
with:

.. code-block:: none

    myapp
       |
       +---__init__.py
       +---app_hooks.py
       +---main.py
       +---request_handler.py
       +---static
       +---theme.yaml
       +---templates
            +---index.html

Some of the files and subdirectories above are optional.

* An ``__init__.py`` file that marks this directory as a package. You can make
  imports relative to the package, such as ``from . import mymod`` and
  ``from .mymod import func``.

* A ``request_handler.py`` file that lets you declare an optional function to
  process HTTP requests and return a dictionary of items that the session token
  includes as described in :ref:`userguide_server_request_handler`.

* A ``app_hooks.py`` file that lets you trigger optional callbacks at different
  stages of application execution as described in
  :ref:`userguide_server_applications_hooks` and
  :ref:`userguide_server_request_handler`.

* A ``static`` subdirectory that you can use to serve static resources
  associated with this application.

* A ``theme.yaml`` file where you can declare default attributes for Bokeh to
  apply to model types.

* A ``templates`` subdirectory with an ``index.html`` Jinja template file. The
  directory may contain additional Jinja templates for ``index.html`` to refer
  to. The template should have the same parameters as the
  :class:`~bokeh.core.templates.FILE` template. For more information, see
  :ref:`userguide_server_template`.

When executing your ``main.py``, the Bokeh server ensures that the standard
``__file__`` module attribute works as you would expect. So you can include
data files or custom user-defined models in your directory however you like.

Bokeh also adds the application directory ``sys.path`` to facilitate importing
of Python modules in the application directory. However, if an ``__init__.py``
is in the directory, you can use the app as a package as well as make standard
package-relative imports.

Here's an example of a more developed directory tree:

.. code-block:: none

    myapp
       |
       +---__init__.py
       |
       +---app_hooks.py
       +---data
       |    +---things.csv
       |
       +---helpers.py
       +---main.py
       |---models
       |    +---custom.js
       |
       +---request_handler.py
       +---static
       |    +---css
       |    |    +---special.css
       |    |
       |    +---images
       |    |    +---foo.png
       |    |    +---bar.png
       |    |
       |    +---js
       |        +---special.js
       |
       |---templates
       |    +---index.html
       |
       +---theme.yaml

In this case, your code might be similar to the following:

.. code-block:: python

    from os.path import dirname, join
    from .helpers import load_data

    load_data(join(dirname(__file__), 'data', 'things.csv'))

The code to load a JavaScript implementation for a custom model from
``models/custom.js`` is also similar.

.. _userguide_server_template:

Customizing the application's Jinja template
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The :ref:`userguide_server_applications_directory` section mentions that you
can override the default Jinja template, which the Bokeh server uses to
generate user-facing HTML.

This lets you use CSS and JavaScript to tweak the way the application appears
in the browser.

For more details on how Jinja templating works, see the
`Jinja project documentation`_.

Embedding figures in the template
'''''''''''''''''''''''''''''''''

To reference a Bokeh figure in the templated code, you need to set its ``name``
attribute and add the figure to the current document root in the main thread of
your Bokeh app, that is ``main.py``.

.. code-block:: python

    from bokeh.plotting import curdoc

    # templates can refer to a configured name value
    plot = figure(name="bokeh_jinja_figure")

    curdoc().add_root(plot)

You can then use that name in the corresponding Jinja template to reference the
figure via the ``roots`` template parameter as follows:

.. code-block:: html

    {% extends base %}

    {% block contents %}
    <div>
        {{ embed(roots.bokeh_jinja_figure) }}
    </div>
    {% endblock %}

Defining custom variables
'''''''''''''''''''''''''

You can pass custom variables to the template with the
``curdoc().template_variables`` dictionary as follows:

.. code-block:: python

    # set a new single key/value pair
    curdoc().template_variables["user_id"] = user_id

    # or update multiple pairs at once
    curdoc().template_variables.update(first_name="Mary", last_name="Jones")

You can then reference the variables in the corresponding Jinja template.

.. code-block:: html

    {% extends base %}

    {% block contents %}
    <div>
        <p> Hello {{ user_id }}, AKA '{{ last_name }}, {{ first_name }}'! </p>
    </div>
    {% endblock %}

.. _userguide_server_session_request:

Accessing HTTP requests
~~~~~~~~~~~~~~~~~~~~~~~

When creating a session for an application, Bokeh makes the session context
available as ``curdoc().session_context``. The most useful function of the
session context is to make the Tornado HTTP request object available to the
application as ``session_context.request``. HTTP requests are not available
directly because of an incompatibility with ``--num-procs``. Instead, only the
``arguments`` attribute is available in full and only a subset of ``cookies``
and ``headers`` allowed by the ``--include-headers``, ``--exclude-headers``,
``--include-cookies``, and ``--exclude-cookies`` parameters is available.
Attempting to access any other attribute on a ``request`` results in an error.

You can enable additional request attributes as described in
:ref:`userguide_server_request_handler`.

The following code accesses the request ``arguments`` to provide a value for
the variable ``N`` that could, for example, control the number of plot points.

.. code-block:: python

  # request.arguments is a dict that maps argument names to lists of strings,
  # for example, the query string ?N=10 results in {'N': [b'10']}

  args = curdoc().session_context.request.arguments

  try:
    N = int(args.get('N')[0])
  except:
    N = 200

.. warning::
  The request object makes inspecting values, such as ``arguments``, easy.
  However, calling any of the Tornado methods, such as ``finish()``,  or
  writing directly to ``request.connection`` is unsupported and results in
  undefined behavior.


.. _userguide_server_request_handler:

Request handler hooks
~~~~~~~~~~~~~~~~~~~~~

To provide additional information where full Tornado HTTP requests may not be
available, you can define a custom handler hook.

To do so, create an app in :ref:`directory format<userguide_server_applications_directory>` and
include a file called ``request_handler.py`` in the directory. This file must
include a ``process_request`` function.

.. code-block:: python

    def process_request(request):
        '''If present, this function executes when an HTTP request arrives.'''
        return {}

The process then passes Tornado HTTP requests to the handler, which returns a
dictionary for ``curdoc().session_context.token_payload``. This lets you work
around some of the ``--num-procs`` issues and provide additional information.

.. _userguide_server_applications_callbacks:

Callbacks and events
~~~~~~~~~~~~~~~~~~~~

Before jumping into callbacks and events specifically in the context of the
Bokeh server, it's worth discussing different use cases for callbacks in
general.

JavaScript callbacks in the browser
'''''''''''''''''''''''''''''''''''

Whether you are using the Bokeh server or not, you can create callbacks that
execute in the browser with ``CustomJS`` and other methods. For more
information and examples, see :ref:`userguide_interaction_jscallbacks`.

``CustomJS`` callbacks **never** execute Python code, not even if you convert a
Python callback into JavaScript. ``CustomJS`` callbacks only execute inside the
browser's JavaScript interpreter, which means that they can only interact with
JavaScript data and functions, such as BokehJS models.

Python callbacks with Jupyter interactors
'''''''''''''''''''''''''''''''''''''''''

When working with Jupyter notebooks, you can use Jupyter interactors to quickly
create simple GUI forms. Updates to GUI widgets trigger Python callbacks that
execute in the Python kernel of Jupyter. It is often useful to have these
callbacks call :func:`~bokeh.io.push_notebook` to push updates to displayed
plots. For more information, see
:ref:`userguide_jupyter_notebook_jupyter_interactors`.

.. note::
    You can push plot updates from Python to BokehJS with
    :func:`~bokeh.io.push_notebook`. For two-way communication, embed a Bokeh
    server in the notebook. For example, this lets range and selection updates
    trigger Python callbacks. For further details, see
    :bokeh-tree:`examples/howto/server_embed/notebook_embed.ipynb`

Updating from threads
'''''''''''''''''''''

You can make blocking computations in separate threads. However, you **must**
schedule document updates via a next tick callback. This callback executes
as soon as possible with the next iteration of the Tornado event loop and
automatically acquires necessary locks to safely update the document state.

.. warning::
    The ONLY safe operations to perform on a document from a different thread
    are :func:`~bokeh.document.Document.add_next_tick_callback` and
    :func:`~bokeh.document.Document.remove_next_tick_callback`

Remember, direct updates to the document state issuing from another thread,
whether through other document methods or setting of Bokeh model properties,
risk data and protocol corruption.

To allow all threads access to the same document, save a local copy of
``curdoc()``. The example below illustrates this process.

.. code-block:: python

    from functools import partial
    from random import random
    from threading import Thread
    import time

    from bokeh.models import ColumnDataSource
    from bokeh.plotting import curdoc, figure

    from tornado import gen

    # only modify from a Bokeh session callback
    source = ColumnDataSource(data=dict(x=[0], y=[0]))

    # This is important! Save curdoc() to make sure all threads
    # see the same document.
    doc = curdoc()

    @gen.coroutine
    def update(x, y):
        source.stream(dict(x=[x], y=[y]))

    def blocking_task():
        while True:
            # do some blocking computation
            time.sleep(0.1)
            x, y = random(), random()

            # but update the document from a callback
            doc.add_next_tick_callback(partial(update, x=x, y=y))

    p = figure(x_range=[0, 1], y_range=[0,1])
    l = p.circle(x='x', y='y', source=source)

    doc.add_root(p)

    thread = Thread(target=blocking_task)
    thread.start()

To see this example in action, save the above code to a Python file, for
example, ``testapp.py``, and then execute the following command:

.. code-block:: sh

    bokeh serve --show testapp.py

.. warning::
    There is currently no locking around adding next tick callbacks to
    documents. Bokeh should have a more fine-grained locking for callback
    methods in the future, but for now it is best to have each thread add no
    more than one callback to the document.

Updating from unlocked callbacks
''''''''''''''''''''''''''''''''

Normally Bokeh session callbacks recursively lock the document until all
future work they initiate is completed. However, you may want to drive
blocking computations from callbacks using Tornado's ``ThreadPoolExecutor``
in an asynchronous callback. This requires that you use the
:func:`~bokeh.document.without_document_lock` decorator to suppress the normal
locking behavior.

As with the thread example above, **all actions that update document state
must go through a next tick callback**.

The following example demonstrates an application that drives a blocking
computation from one unlocked Bokeh session callback. It yields to a blocking
function that runs on the thread pool executor and then updates with a next
tick callback. The example also updates the state simply from a standard locked
session callback with a different update rate.

.. code-block:: python

    from functools import partial
    import time

    from concurrent.futures import ThreadPoolExecutor
    from tornado import gen

    from bokeh.document import without_document_lock
    from bokeh.models import ColumnDataSource
    from bokeh.plotting import curdoc, figure

    source = ColumnDataSource(data=dict(x=[0], y=[0], color=["blue"]))

    i = 0

    doc = curdoc()

    executor = ThreadPoolExecutor(max_workers=2)

    def blocking_task(i):
        time.sleep(1)
        return i

    # the unlocked callback uses this locked callback to safely update
    @gen.coroutine
    def locked_update(i):
        source.stream(dict(x=[source.data['x'][-1]+1], y=[i], color=["blue"]))

    # this unlocked callback will not prevent other session callbacks from
    # executing while it is running
    @gen.coroutine
    @without_document_lock
    def unlocked_task():
        global i
        i += 1
        res = yield executor.submit(blocking_task, i)
        doc.add_next_tick_callback(partial(locked_update, i=res))

    @gen.coroutine
    def update():
        source.stream(dict(x=[source.data['x'][-1]+1], y=[i], color=["red"]))

    p = figure(x_range=[0, 100], y_range=[0,20])
    l = p.circle(x='x', y='y', color='color', source=source)

    doc.add_periodic_callback(unlocked_task, 1000)
    doc.add_periodic_callback(update, 200)
    doc.add_root(p)

As before, you can run this example by saving to a Python file and running
``bokeh serve`` on it.

.. _userguide_server_applications_hooks:

Lifecycle hooks
~~~~~~~~~~~~~~~

You may want to execute code at specific points of server or session runtime.
For instance, if you are using a Bokeh server with a Django server, you need to
call ``django.setup()`` for each Bokeh server to properly initialize Django for
use by Bokeh application code.

Bokeh enables this through a set of *lifecycle hooks*. To use these hooks,
create your application in
:ref:`directory format<userguide_server_applications_directory>` and include a
designated file called ``app_hooks.py`` in the directory. In this file you can
include any or all of the following conventionally named functions:

.. code-block:: python

    def on_server_loaded(server_context):
        # If present, this function executes when the server starts.
        pass

    def on_server_unloaded(server_context):
        # If present, this function executes when the server shuts down.
        pass

    def on_session_created(session_context):
        # If present, this function executes when the server creates a session.
        pass

    def on_session_destroyed(session_context):
        # If present, this function executes when the server closes a session.
        pass

You can also define ``on_session_destroyed`` lifecycle hooks directly on the
``Document`` being served. This makes it easy to clean up after a user closes
a session by performing such actions as database connection shutdown without
the need to bundle a separate file. To declare such a callback, define a
function and register it with the ``Document.on_session_destroyed`` method:

.. code-block:: python

    doc = Document()

    def cleanup_session(session_context):
        # This function executes when the user closes the session.
        pass

    doc.on_session_destroyed(cleanup_session)

Besides the lifecycle hooks above, you may also define request hooks to
access the HTTP requests your users make. For further information, see
:ref:`userguide_server_request_handler`.


.. _userguide_server_embedding:

Embedding Bokeh server as a library
-----------------------------------

It can be useful to embed the Bokeh Server in a larger Tornado application, or a
Jupyter notebook, and use the already existing Tornado ``IOloop``. Here is the
basis for integration of Bokeh in such a scenario:

.. code-block:: python

   from bokeh.server.server import Server

   server = Server(
       bokeh_applications,  # list of Bokeh applications
       io_loop=loop,        # Tornado IOLoop
       **server_kwargs      # port, num_procs, etc.
   )

   # start timers and services and immediately return
   server.start()

You can also create and control an ``IOLoop`` directly. This can be useful when
creating standalone "normal" Python scripts that serve Bokeh apps or embedding
a Bokeh application in a framework like Flask or Django without having to run a
separate Bokeh server process. You can find some examples of this technique in
the examples directory:

* :bokeh-tree:`examples/howto/server_embed/flask_embed.py`
* :bokeh-tree:`examples/howto/server_embed/notebook_embed.ipynb`
* :bokeh-tree:`examples/howto/server_embed/standalone_embed.py`
* :bokeh-tree:`examples/howto/server_embed/tornado_embed.py`

Also note that every command line argument for ``bokeh serve`` has a
corresponding keyword argument for ``Server``. For instance, using the
``--allow-websocket-origin`` command line argument is equivalent to passing
``allow_websocket_origin`` as a parameter.

.. _userguide_server_bokeh_client:

Connecting with ``bokeh.client``
--------------------------------

You can directly interact with the Bokeh server via a client API, which you can
use to make modifications to Bokeh documents in existing sessions on a Bokeh
server.

.. figure:: /_images/bokeh_serve_client.svg
    :align: center
    :width: 65%

    Typically, web browsers connect to the Bokeh server, but you can make a
    connection from Python by using the ``bokeh.client`` module.

This can be useful, for example, to make user-specific customizations to a
Bokeh app that is embedded by another web framework, such as Flask or Django.
In the following example, a Flask endpoint embeds a "sliders" app already
running on the server but changes the plot title *before* passing the output
to the user.

.. code-block:: python

    from flask import Flask, render_template

    from bokeh.client import pull_session
    from bokeh.embed import server_session

    app = Flask(__name__)

    @app.route('/', methods=['GET'])
    def bkapp_page():

        with pull_session(url="http://localhost:5006/sliders") as session:

            # update or customize that session
            session.document.roots[0].children[1].title.text = "Special sliders for a specific user!"

            # generate a script to load the customized session
            script = server_session(session_id=session.id, url='http://localhost:5006/sliders')

            # use the script in the rendered page
            return render_template("embed.html", script=script, template="Flask")

    if __name__ == '__main__':
        app.run(port=8080)

.. _userguide_server_deployment:

Deployment scenarios
--------------------

To make your application into a user-friendly service, you'll have to deploy
your work. This subsection explores various aspects of deployment.

.. _userguide_server_deployment_standalone:

Standalone Bokeh server
~~~~~~~~~~~~~~~~~~~~~~~

You can have the Bokeh server running on a network for users to interact with
your app directly. This can be a simple solution for local network deployment,
provided the capabilities of the hardware running the server match your app
requirements and the expected number of users.

However, if you have authentication, scaling, or uptime requirements, you'll
have to consider more sophisticated deployment configurations.

SSH tunnels
'''''''''''

To run a standalone instance of the Bokeh server on a host with restricted
access, use SSH to "tunnel" to the server.

In the simplest scenario, the user accesses the Bokeh server from another
location, such as a laptop with no intermediary machines.

Run the server as usual on the **remote host**.

.. code-block:: sh

    bokeh server

Next, issue the following command on the **local machine** to establish an SSH
tunnel to the remote host:

.. code-block:: sh

    ssh -NfL localhost:5006:localhost:5006 user@remote.host

Replace *user* with your username on the remote host and *remote.host* with
the hostname or IP address of the system hosting the Bokeh server. The remote
system may prompt you for login credentials. Once you are connected, you will
be able to navigate to ``localhost:5006`` as though the Bokeh server were
running on the local machine.

A slightly more complicated scenario involves a gateway between the server and
the local machine. In that situation, a reverse tunnel must be established from
the server to the gateway with another tunnel connecting the gateway with the
local machine.

Issue the following commands on the **remote host** where the Bokeh server
will be running:

.. code-block:: sh

    nohup bokeh server &
    ssh -NfR 5006:localhost:5006 user@gateway.host

Replace *user* with your username on the gateway and *gateway.host* with the
hostname or IP address of the gateway. The gateway may prompt you for login
credentials.

To setup the tunnel between the local machine and the gateway, run the
following command on the **local machine**:

.. code-block:: sh

    ssh -NfL localhost:5006:localhost:5006 user@gateway.host

Again, replace *user* with your username on the gateway and *gateway.host*
with the hostname or IP address of the gateway.

You should now be able to access the Bokeh server from the local machine by
navigating to ``localhost:5006``. You can even set up client connections from
a Jupyter notebook running on the local machine.

.. note::
    We intend to expand this section with more guidance for other tools and
    configurations. If you have experience with other web deployment scenarios
    and wish to contribute your knowledge here, please contact us on
    https://discourse.bokeh.org

.. _userguide_server_deployment_ssl:

SSL termination
~~~~~~~~~~~~~~~

You can configure the Bokeh server to terminate SSL connections and serve
secure HTTPS and WSS sessions directly. To do so, you'll have to supply the
``--ssl-certfile`` argument with the value of the path to a single PEM file
containing a certificate as well as any number of `CA certificates
<https://en.wikipedia.org/wiki/Certificate_authority>`_ needed to establish
the certificate's authenticity.

.. code-block:: sh

    bokeh serve --ssl-certfile /path/to/cert.pem

You can also supply a path to the certificate file by setting the environment
variable ``BOKEH_SSL_CERTFILE``.

If the private key is stored separately, you can supply its location by setting
the ``--ssl-keyfile`` command line argument or by setting the
``BOKEH_SSL_KEYFILE`` environment variable. If the private key requires a
password, supply it by setting the ``BOKEH_SSL_PASSWORD`` environment variable.

Alternatively, you may wish to run a Bokeh server behind a proxy and have the
proxy terminate SSL connections. See the next subsection for details.

.. _userguide_server_deployment_proxy:

Basic reverse proxy setup
~~~~~~~~~~~~~~~~~~~~~~~~~

To serve a web application to the general internet, you may wish to host your
app on an internal network and proxy connections to it through some dedicated
HTTP server. This subsection provides guidance on how to configure some common
reverse proxies.

.. _userguide_server_deployment_nginx_proxy:

Nginx
'''''

One very common HTTP and reverse-proxying server is Nginx. Here's an example
of a ``server`` configuration stanza:

.. code-block:: nginx

    server {
        listen 80 default_server;
        server_name _;

        access_log  /tmp/bokeh.access.log;
        error_log   /tmp/bokeh.error.log debug;

        location / {
            proxy_pass http://127.0.0.1:5100;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_http_version 1.1;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host $host:$server_port;
            proxy_buffering off;
        }

    }

The above ``server`` block sets up Nginx to proxy incoming connections to
``127.0.0.1`` on port 80 over to ``127.0.0.1`` on port 5100. To work in this
configuration, you need to use some of the command line options to configure
the Bokeh server. In particular, use ``--port`` to have the Bokeh server
listen on port 5100.

.. code-block:: sh

    bokeh serve myapp.py --port 5100

The basic server block above does not configure any special handling for static
resources, such as Bokeh JS and CSS files. This means that the Bokeh server
serves these files directly.

Although this is a viable option, it requires that the Bokeh server do extra
work that is better handled with Nginx. To serve static assets with Nginx, add
the following sub-block to the code above, substituting the path to your
static assets for ``/path/to/bokeh/server/static``:

.. code-block:: nginx

    location /static {
        alias /path/to/bokeh/server/static;
    }

Make sure that the account running Nginx has permissions to access Bokeh
resources. Alternatively, you can copy the resources to a global static
directory during the deployment.

To communicate cookies and headers across processes, Bokeh may include this
information in a JSON web token, sending it via a WebSocket. In certain cases
this token can grow very large causing Nginx to drop the request. You may have
to work around this by overriding the default Nginx setting
`large_client_header_buffers`:

.. code-block:: nginx

    large_client_header_buffers 4 24k;

Apache
''''''

Another common HTTP server and proxy is Apache. Here is an example
configuration for a Bokeh server running behind Apache:

.. code-block:: apache

    <VirtualHost *:80>
        ServerName localhost

        CustomLog "/path/to/logs/access_log" combined
        ErrorLog "/path/to/logs/error_log"

        ProxyPreserveHost On
        ProxyPass /myapp/ws ws://127.0.0.1:5100/myapp/ws
        ProxyPassReverse /myapp/ws ws://127.0.0.1:5100/myapp/ws

        ProxyPass /myapp http://127.0.0.1:5100/myapp/
        ProxyPassReverse /myapp http://127.0.0.1:5100/myapp/

        <Directory />
            Require all granted
            Options -Indexes
        </Directory>

        Alias /static /path/to/bokeh/server/static
        <Directory /path/to/bokeh/server/static>
            # directives to effect the static directory
            Options +Indexes
        </Directory>

    </VirtualHost>

The above configuration aliases `/static` to the location of the Bokeh static
resources directory. However, it is also possible (and probably preferable) to
copy the static resources to whatever standard location for static files you
configure for Apache as part of the deployment.

You may also need to enable some modules for the above configuration:

.. code-block:: sh

    a2enmod proxy
    a2enmod proxy_http
    a2enmod proxy_wstunnel
    apache2ctl restart

Depending on your system, you may have to use ``sudo`` to run the above.

As before, run the Bokeh server with the following command:

.. code-block:: sh

    bokeh serve myapp.py --port 5100

.. _userguide_server_deployment_nginx_proxy_ssl:

Reverse proxying with Nginx and SSL
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To deploy a Bokeh server behind an SSL-terminated Nginx proxy, you'll need a
few additional customizations. In particular, you'll have to configure the
Bokeh server with the ``--use-xheaders`` flag.

.. code-block:: sh

    bokeh serve myapp.py --port 5100 --use-xheaders

The ``--use-xheaders`` flag causes Bokeh to override the remote IP and
URI scheme/protocol for all requests with ``X-Real-Ip``, ``X-Forwarded-For``,
``X-Scheme``, and ``X-Forwarded-Proto`` headers when they are available.

You'll also have to customize Nginx. In particular, you have to configure Nginx
to send ``X-Forwarded-Proto`` headers and use SSL termination. Optionally, you
may want to redirect all HTTP traffic to HTTPS.

The complete details of this configuration, such as how and where to install
SSL certificates and keys, varies by platform and the following is only a
reference ``nginx.conf`` setup:

.. code-block:: nginx

    # redirect HTTP traffic to HTTPS (optional)
    server {
        listen      80;
        server_name foo.com;
        return      301 https://$server_name$request_uri;
    }

    server {
        listen      443 default_server;
        server_name foo.com;

        # adds Strict-Transport-Security to prevent man-in-the-middle attacks
        add_header Strict-Transport-Security "max-age=31536000";

        ssl on;

        # SSL installation details vary by platform
        ssl_certificate /etc/ssl/certs/my-ssl-bundle.crt;
        ssl_certificate_key /etc/ssl/private/my_ssl.key;

        # enables all versions of TLS, but not the deprecated SSLv2 or v3
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;

        # disables all weak ciphers
        ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

        ssl_prefer_server_ciphers on;

        location / {
            proxy_pass http://127.0.0.1:5100;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_http_version 1.1;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host $host:$server_port;
            proxy_buffering off;
        }

    }

This configuration will proxy all incoming HTTPS connections to ``foo.com``
over to a Bokeh server running internally on ``http://127.0.0.1:5100``.

.. _userguide_server_deployment_nginx_load_balance:

Load balancing with Nginx
~~~~~~~~~~~~~~~~~~~~~~~~~

The Bokeh server is scalable by design. If you need more capacity, you can
simply run additional servers. In this case, you'll generally want to run all
the Bokeh server instances behind a load balancer so that new connections are
distributed among individual servers.

.. figure:: /_images/bokeh_serve_scale.svg
    :align: center
    :width: 65%

    The Bokeh server is horizontally scalable. To add more capacity, you
    can run more servers behind a load balancer.

Nginx can help with load balancing. This section describes some of the basics
of one possible configuration, but please also refer to the
`Nginx load balancer documentation`_. For instance, there are different
strategies available for choosing what server to connect to next.

First, you need to add an ``upstream`` stanza to the Nginx configuration.
This typically goes above the ``server`` stanza and looks something like the
following:

.. code-block:: nginx

    upstream myapp {
        least_conn;                 # Use the least-connected strategy
        server 127.0.0.1:5100;      # Bokeh Server 0
        server 127.0.0.1:5101;      # Bokeh Server 1
        server 127.0.0.1:5102;      # Bokeh Server 2
        server 127.0.0.1:5103;      # Bokeh Server 3
        server 127.0.0.1:5104;      # Bokeh Server 4
        server 127.0.0.1:5105;      # Bokeh Server 5
    }

The rest of the configuration uses the name ``myapp`` to refer to the above
``upstream`` stanza, which lists the internal connection information for six
different Bokeh server instances (each running on a different port). You can
run and list as many Bokeh servers as you need.

To run a Bokeh server instance, use commands similar to the following:

.. code-block:: sh

    serve myapp.py --port 5100
    serve myapp.py --port 5101
    ...

Next, in the ``location`` stanza for the Bokeh server, change the
``proxy_pass`` value to refer to the ``upstream`` stanza above. The
code below uses ``proxy_pass http://myapp;``.

.. code-block:: nginx

    server {

        location / {
            proxy_pass http://myapp;

            # all other settings unchanged
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_http_version 1.1;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host $host:$server_port;
            proxy_buffering off;
        }

    }

.. _userguide_server_deployment_auth:

Authentication
~~~~~~~~~~~~~~

The Bokeh server itself does not have any facilities for authentication or
authorization. However, you can configure the Bokeh server with an "auth
provider" that hooks into Tornado's underlying capabilities. For background
information, see the Tornado docs for `Authentication and security`_. The rest
of this section assumes some familiarity with that material.

Auth module
'''''''''''

You can configure the Bokeh server to only allow authenticated users to
connect. To do so, provide a path to the module that implements the necessary
functions on the command line.

.. code-block:: sh

    bokeh serve --auth-module=/path/to/auth.py

Alternatively, you can set the ``BOKEH_AUTH_MODULE`` environment variable to
this path.

The module must contain *one* of the following two functions that return the
current user (or ``None``):

.. code-block:: python

    def get_user(request_handler):
        pass

    async def get_user_async(request_handler):
        pass

The module passes the function to the Tornado ``RequestHandler`` that can
inspect cookies or request headers to determine the authenticated user. If
there is no authenticated user, these functions should return ``None``.

Additionally, the module must specify where to redirect unauthenticated users
by including either:

* a module attribute ``login_url`` and (optionally) a ``LoginHandler`` class
* a function definition for ``get_login_url``

.. code-block:: python

    login_url = "..."

    class LoginHandler(RequestHandler):
        pass

    def get_login_url(request_handler):
        pass

If the module provides a relative ``login_url``, it can also provide an
optional ``LoginHandler`` class, which the Bokeh server will incorporate
automatically.

The ``get_login_url`` function is useful in cases where the login URL must
vary based on the request, cookies, or other factors. You can also specify a
``LoginHandler`` when defining the ``get_url_function``.

To define an endpoint for logging users out, you can also use optional
``logout_url`` and ``LogoutHandler`` parameters, similar to the login options.

If you don't provide an authentication module, the configuration will not
require any authentication to access Bokeh server endpoints.

.. warning::
    The configuration executes the contents of the authentication module.

Secure cookies
''''''''''''''

If you want to use Tornado's `set_secure_cookie`_ and `get_secure_cookie`_
functions in your auth module, you'll have to set a cookie secret. To do so,
use the ``BOKEH_COOKIE_SECRET`` environment variable.

.. code-block:: sh

    export BOKEH_COOKIE_SECRET=<cookie secret value>

The value should be a long, random sequence of bytes.

.. _userguide_server_deployment_security:

Security
~~~~~~~~

By default, the Bokeh server will accept any incoming connections with an
allowed WebSocket origin. If you specify a session ID, and a session with
that ID already exists on the server, the server will connect to that session.
Otherwise, the server will automatically create and use a new session.

If you are deploying an embedded Bokeh app within a large organization or
to the wider internet, you may want to limit who can initiate sessions, and
from where. Bokeh lets you manage session creation privileges.

WebSocket origin
''''''''''''''''

When a Bokeh server receives an HTTP request, it immediately returns a script
that initiates a WebSocket connection. All subsequent communication happens
over the WebSocket.

To reduce the risk of cross-site misuse, the Bokeh server will only initiate
WebSocket connections from the origins that are explicitly allowed. Requests
with ``Origin`` headers that are not on the allowed list will generate HTTP 403
error responses.

By default, only ``localhost:5006`` is allowed, making the following two
invocations identical:

.. code-block:: sh

    bokeh serve --show myapp.py

and

.. code-block:: sh

    bokeh serve --show --allow-websocket-origin=localhost:5006 myapp.py

Both of these open your default browser to the default application URL
``localhost:5006`` and, since ``localhost:5006`` is on the list of allowed
WebSocket origins, the Bokeh server creates and displays a new session.

When you embed a Bokeh server in another web page with |server_document| or
|server_session|, the ``Origin`` header for the request to the Bokeh server
is the URL of the page that hosts your Bokeh content.

For example, if a user navigates to your page at ``https://acme.com/products``,
the origin header reported by the browser will be ``acme.com``. In this case,
you'd typically restrict the Bokeh server to honoring *only* the requests that
originate from the ``acme.com`` page, preventing other pages from embedding
your Bokeh app without your knowledge.

You can do so by setting the ``--allow-websocket-origin`` command line argument
as follows:

.. code-block:: sh

    bokeh serve --show --allow-websocket-origin=acme.com myapp.py

This will prevent other sites from embedding your Bokeh application in their
pages because requests from users viewing those pages will report a different
origin than ``acme.com``, causing the Bokeh server to reject them.

.. warning::
    Bear in mind that this only prevents *other web pages* from embedding your
    Bokeh app without your knowledge.

If you require multiple allowed origins, you can pass multiple instances of
``--allow-websocket-origin`` on the command line.

You can also configure the Bokeh server to allow all connections regardless of
origin:

.. code-block:: sh

    bokeh serve --show --allow-websocket-origin='*' myapp.py

This option is only suitable for testing, experimentation, and local notebook
usage.

Signed session IDs
''''''''''''''''''

By default, the Bokeh server will automatically create new sessions for all
new requests from allowed WebSocket origins, even if you provide no session ID.

When embedding a Bokeh app inside another web application, such as Flask or
Django, make sure that *only* your web application is capable of generating
viable requests to the Bokeh server, which you can configure to only create
sessions with a cryptographically signed session ID.

First, use the ``bokeh secret`` command to create a secret to sign session IDs.

.. code-block:: sh

    export BOKEH_SECRET_KEY=`bokeh secret`

Then set ``BOKEH_SIGN_SESSIONS`` to ``yes`` when starting the Bokeh server.
You'll typically also want to set the allowed WebSocket origin at this point.

.. code-block:: sh

    BOKEH_SIGN_SESSIONS=yes bokeh serve --allow-websocket-origin=acme.com myapp.py

Then, in your web application, explicitly provide signed session IDs with
``generate_session_id``:

.. code-block:: python

    from bokeh.util.token import generate_session_id

    script = server_session(url='http://localhost:5006/bkapp',
                            session_id=generate_session_id())
    return render_template("embed.html", script=script, template="Flask")

Make sure to set identical ``BOKEH_SECRET_KEY`` environment variables both for
the Bokeh server and for the web app processes, such as Flask, Django, or any
other tool you are using.

.. note::

    Signed session IDs serve as access tokens. As with any token system,
    security is predicated on keeping the token secret. You should also run
    the Bokeh server behind a proxy that terminates SSL connections, or
    configure the Bokeh server to terminate SSL directly. This lets you
    securely transmit session IDs to the client browsers.

XSRF cookies
''''''''''''

Bokeh server can use Tornado's cross-site request forgery protection. To turn
this feature on, use the ``--enable-xsrf-cookies`` option or set the
environment variable ``BOKEH_XSRF_COOKIES`` to ``yes``.

With this setting, you'll have to properly instrument all PUT, POST, and DELETE
operations on custom and login handlers in order for them to function.
Typically, this means adding the following code to all HTML form submission
templates:

.. code-block:: html

    {% module xsrf_form_html() %}

For full details, see the Tornado documentation on `XSRF Cookies`_.

.. _userguide_server_deployment_scaling:

Scaling the server
~~~~~~~~~~~~~~~~~~

You can fork multiple server processes with the `num-procs` option. For
example, run the following command to fork 3 processes:

.. code-block:: sh

    bokeh serve --num-procs 3

Note that the forking operation happens in the underlying Tornado server. For
further information, see the `Tornado docs`_.

.. _Tornado docs: http://www.tornadoweb.org/en/stable/tcpserver.html#tornado.tcpserver.TCPServer.start

Further reading
---------------
Now that you are familiar with the concepts of
:ref:`running a Bokeh server<userguide_server>`,
you may be interested in learning more about the internals of the Bokeh server
in :ref:`contributor_guide_server`.

.. _Authentication and security: https://www.tornadoweb.org/en/stable/guide/security.html
.. _demo.bokeh.org: https://demo.bokeh.org
.. _get_secure_cookie: https://www.tornadoweb.org/en/stable/web.html#tornado.web.RequestHandler.get_secure_cookie
.. _Nginx load balancer documentation: http://nginx.org/en/docs/http/load_balancing.html
.. _set_secure_cookie: https://www.tornadoweb.org/en/stable/web.html#tornado.web.RequestHandler.set_secure_cookie
.. _XSRF Cookies:  https://www.tornadoweb.org/en/stable/guide/security.html#cross-site-request-forgery-protection
.. _Jinja project documentation: https://jinja.palletsprojects.com/en/2.10.x/

.. |server_document|  replace:: :func:`~bokeh.embed.server_document`
.. |server_session|  replace:: :func:`~bokeh.embed.server_session`
.. _userguide_annotations:

Adding annotations
==================

Bokeh includes several different types of :term:`annotations <Annotation>` you
can use to add supplemental information to your visualizations.

.. _userguide_annotations_titles:

Titles
------

Use |Title| annotations to add descriptive text which is rendered around
the edges of a plot.

If you use the |plotting interface|, the quickest way to add a basic title is to
pass the text as the ``title`` parameter to |figure|:

.. bokeh-plot:: docs/user_guide/examples/plotting_title_basic.py
    :source-position: above

The default title is generally located above a plot, aligned to the left.

The title text may value contain newline characters which will result in a
multi-line title.

.. code-block:: python

    p = figure(title="A longer title\nwith a second line underneath")

To define the placement of the title in relation to the plot, use the
``title_location`` parameter. A title can be located above, below, left, or
right of a plot. For example:

.. bokeh-plot:: docs/user_guide/examples/plotting_title_location.py
    :source-position: above

Use your plot's ``.title`` property to customize the default |Title|. Use the
standard |text properties| to define visual properties such as font, border, and
background.

This example uses the ``.title`` property to set the font and background
properties as well as the title text and title alignment:

.. bokeh-plot:: docs/user_guide/examples/plotting_title_visuals.py
    :source-position: above

Note that the ``align`` property is relative to the direction of the text. For
example: If you have placed your title on the left side of your plot, setting
the ``align`` property to ``"left"`` means your text is rendered in the lower
left corner.

To add more titles to your document, you need to create additional |Title|
objects. Use the |add layout| method of your plot to include those additional
|Title| objects in your document:

.. bokeh-plot:: docs/user_guide/examples/plotting_title_additional.py
    :source-position: above

If a title and a :ref:`toolbar <userguide_tools>` are placed on the same side
of a plot, they will occupy the same space:

.. bokeh-plot:: docs/user_guide/examples/plotting_title_toolbar.py
    :source-position: above

If the plot size is large enough, this can result in a more compact plot.
However, if the plot size is not large enough, the title and toolbar may
visually overlap.

.. _userguide_annotations_legends:

Legends
-------

The easiest way to add a legend to your plot is to include any of the
:ref:`legend_label <userguide_annotations_legends_legend_label>`,
:ref:`legend_group <userguide_annotations_legends_legend_group>`,
or :ref:`legend_field <userguide_annotations_legends_legend_field>` properties
when calling glyph methods. Bokeh then creates a |Legend| object for you
automatically.

For more advanced control over a plot's legend, access the |Legend| object
:ref:`directly <userguide_annotations_legends_manual>`.

.. _userguide_annotations_legends_legend_label:

Basic legend label
~~~~~~~~~~~~~~~~~~

To provide a simple explicit label for a glyph, pass the ``legend_label``
keyword argument:

.. code-block:: python

    p.circle('x', 'y', legend_label="some label")

If you assign the same label name to multiple glyphs, all the glyphs will be
combined into a single legend item with that label.

.. bokeh-plot:: docs/user_guide/examples/plotting_legend_label.py
    :source-position: above

.. _userguide_annotations_legends_legend_group:

Automatic grouping (Python-side)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If your data is in the form of a |ColumnDataSource|, Bokeh can generate legend
entries from strings in one of the ColumnDataSource's columns. This way, you can
create legend entries based on groups of glyphs.

To use data from a column of a ColumnDataSource to generate your plot's legend,
pass the column name as the ``legend_group`` keyword argument to a glyph method:

.. code-block:: python

    p.circle('x', 'y', legend_group="colname", source=source)

Because ``legend_group`` references a column of a ColumnDataSource, you need to
always provide a ``source`` argument to the glyph method as well. Additionally,
the column containing the label names has to be present in the data source at
that point:

.. bokeh-plot:: docs/user_guide/examples/plotting_legend_group.py
    :source-position: above

Using ``legend_group`` means that Bokeh groups the legend entries immediately.
Therefore, any subsequent Python code will be able to see the individual legend
items in the ``Legend.items`` property. This way, you can re-arrange or modify
the legend at any time.

.. _userguide_annotations_legends_legend_field:

Automatic grouping (browser-side)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You also have the option to only group elements within your legend on the
:term:`JavaScript side <BokehJS>`, in the browser. Using browser-side grouping
makes sense if you want to group a column that is only computed on the
JavaScript side, for example.

.. code-block:: python

    p.circle('x', 'y', legend_field="colname", source=source)

In this case, the Python code does *not* see multiple items in ``Legend.items``.
Instead, there is only a single item that represents the grouping, and the
grouping happens in the browser.

.. bokeh-plot:: docs/user_guide/examples/plotting_legend_field.py
    :source-position: above

.. _userguide_annotations_legends_item_visibility:

Hiding legend items
~~~~~~~~~~~~~~~~~~~

To manually control the visibility of individual legend items, set the
``visible`` property of a :class:`~bokeh.models.annotations.LegendItem` to
either ``True`` or ``False``.

.. bokeh-plot:: docs/user_guide/examples/plotting_legends_item_visibility.py
    :source-position: above

.. note::
    If all items in a legend are invisible, the entire legend will be hidden.
    Also, if you use
    :ref:`automatic grouping on the browser side <userguide_annotations_legends_legend_field>`
    and set the visibility of a ``legend_field`` item to ``False``, the entire
    group will be invisible.

.. _userguide_annotations_legends_manual:

Manual legends
~~~~~~~~~~~~~~

To build a legend by hand, don't use any of the ``legend`` arguments and instead
assign values to the various properties of a |Legend| object directly.

See :bokeh-tree:`examples/models/file/legends.py` for an example.

Explicit index
~~~~~~~~~~~~~~

To explicitly specify which index into a |ColumnDataSource| to use in a legend,
set the ``index`` property of a :class:`~bokeh.models.annotations.LegendItem`.

This is useful for displaying multiple entries in a legend when you use glyphs
that are rendered in several parts, such as
:class:`~bokeh.models.glyphs.MultiLine`
(:func:`~bokeh.plotting.figure.multi_line`) or
:class:`~bokeh.models.glyphs.Patches` :func:`~bokeh.plotting.figure.patches`:

.. bokeh-plot:: docs/user_guide/examples/plotting_legends_multi_index.py
    :source-position: above

Interactive legends
~~~~~~~~~~~~~~~~~~~

You can use legends as interactive elements to control some aspects of the
appearance of your plot. Clicking or tapping on interactive legend entries
controls the visibility of the glyphs associated with the legend entry.

See |interactive legends| in the user guide for more information and examples.

.. note::
    The features of |interactive legends| currently only work on the basic
    legend labels described :ref:`above <userguide_annotations_legends_legend_label>`.
    Legends that are created by specifying a column to automatically group do
    not yet support interactive features.

.. _userguide_annotations_color_bars:

Color bars
----------

To create a |ColorBar|, use an instance of |ColorMapper| containing a color
palette.

Color bars can be located inside as well as left, right, below, or above the
plot. Specify the location of a color bar when adding the |ColorBar| object to
the plot using the |add layout| method.

.. bokeh-plot:: docs/user_guide/examples/plotting_color_bars.py
    :source-position: above

.. _userguide_annotations_arrows:

Arrows
------

You can use |Arrow| annotations to connect glyphs and label annotations. Arrows
can also help highlight plot regions.

Arrows are compound annotations. This means that they use additional |ArrowHead|
objects as their ``start`` and ``end``. By default, the |Arrow| annotation is a
one-sided arrow: The ``end`` property is set to an ``OpenHead``-type arrowhead
(looking like an open-backed wedge style) and the ``start`` property is set to
``None``. If you want to create double-sided arrows, set both the ``start`` and
``end`` properties to one of the available arrowheads.

The available arrowheads are:

.. bokeh-plot:: docs/user_guide/examples/annotations_arrowheads.py
    :source-position: none

Control the appearance of an arrowhead with these properties:

* use the ``size`` property to control the size of any arrowheads
* use the standard |line properties| such as ``line_color`` and ``line_alpha``
  to control the appearance of the outline of the arrowhead.
* use ``fill_color`` and ``fill_alpha`` to control the appearance of the
  arrowhead's inner surface, if applicable.

|Arrow| objects themselves have the standard |line properties|. Set those
properties to control the color and appearance of the arrow shaft. For example:

.. code-block:: python

    my_arrow.line_color = "blue"
    my_arrow.line_alpha = 0.6

Optionally, you can set the ``x_range`` and ``y_range`` properties to make an
arrow annotation refer to additional non-default x- or y-ranges. This works the
same as :ref:`userguide_plotting_twin_axes`.

.. bokeh-plot:: docs/user_guide/examples/plotting_arrow.py
    :source-position: above

.. _userguide_annotations_bands:

Bands
-----

A |Band| annotation is a colored stripe that is dimensionally linked to the data
in a plot. One common use for the band annotation is to indicate uncertainty
related to a series of measurements.

To define a band, use either |screen units| or |data units|.

.. bokeh-plot:: docs/user_guide/examples/plotting_band.py
    :source-position: above

.. _userguide_annotations_box_annotations:

Box annotations
---------------

A |BoxAnnotation| is a rectangular box that you can use to highlight specific
plot regions. Use either |screen units| or |data units| to position a box
annotation.

To define the bounds of these boxes, use the ``left``/``right`` or ``top``/
``bottom`` properties. If you provide only one bound (for example, a ``left``
value but no ``right`` value), the box will extend to the edge of the available
plot area for the dimension you did not specify.

.. bokeh-plot:: docs/user_guide/examples/plotting_box_annotation.py
    :source-position: above

.. _userguide_annotations_polygon_annotations:

Polygon annotations
-------------------

A |PolyAnnotation| is a polygon with vertices in either |screen units| or
|data units|.

To define the polygon's vertices, supply a series of coordinates to the
``xs`` and ``ys`` properties. Bokeh automatically connects the last vertex
to the first to create a closed shape.

.. bokeh-plot:: docs/user_guide/examples/plotting_polygon_annotation.py
    :source-position: above

.. _userguide_annotations_labels:

Labels
------

Labels are rectangular boxes with additional information about glyphs or plot
regions.

To create a single text label, use the |Label| annotation. Those are the most
important properties for this annotation:

* A ``text`` property containing the text to display inside the label.
* ``x`` and ``y`` properties to set the position (in |screen units| or
  |data units|).
* ``x_offset`` and ``y_offset`` properties to specify where to place the label
  in relation to its ``x`` and ``y`` coordinates.
* The standard |text properties| as well as other styling parameters such as
* ``border_line`` and ``background_fill`` properties.

.. code-block:: python

    Label(x=100, y=5, x_units='screen', text='Some Stuff',
          border_line_color='black', border_line_alpha=1.0,
          background_fill_color='white', background_fill_alpha=1.0)

The ``text`` may value contain newline characters which will result in a
multi-line label.

.. code-block:: python

    Label(x=100, y=5, text='A very long label\nwith mutiple lines')

To create several labels at once, use the |LabelSet| annotation. To configure
the labels of a label set, use a data source that contains columns with data for
the labels' properties such as ``text``, ``x`` and ``y``. If you assign a
value to a property such as ``x_offset`` and ``y_offset`` directly instead of a
column name, this value is used for all labels of the label set.

.. code-block:: python

    LabelSet(x='x', y='y', text='names',
             x_offset=5, y_offset=5, source=source)

The following example illustrates the use of |Label| and |LabelSet|:

.. bokeh-plot:: docs/user_guide/examples/plotting_label.py
    :source-position: above

The ``text`` values for ``LabelSet`` may value contain newline characters which
will result in multi-line labels.

.. _userguide_annotations_slope:

Slopes
------

|Slope| annotations are lines that can go from one edge of the plot to
another at a specific angle.

These are the most commonly used properties for this annotation:

* ``gradient``: The gradient of the line, in |data units|.
* ``y_intercept``: The y intercept of the line, in |data units|.
* The standard |line properties|.

.. bokeh-plot:: docs/user_guide/examples/plotting_slope.py
    :source-position: above

.. _userguide_annotations_spans:

Spans
-----

|Span| annotations are lines that are orthogonal to the x or y axis of a plot.
They have a single dimension (width or height) and go from one edge of the plot
area to the opposite edge.

These are the most commonly used properties for this annotation:

* ``dimension``: The direction of the span line. The direction can be one of
  these two values: Either * ``"height"`` for a line that is parallel to the
  plot's x axis. Or ``"width"`` for a line that is parallel to the plot's y
  axis.
* ``location``: The location of the span along the axis specified with
  ``dimension``.
* ``location_units``: The |unit| type for the ``location`` property. The default
  is to use |data units|.
* The standard |line properties|.

.. bokeh-plot:: docs/user_guide/examples/plotting_span.py
    :source-position: above

.. _userguide_annotations_whiskers:

Whiskers
--------

A |Whisker| annotation is a "stem" that is dimensionally linked to the data in
the plot. You can define this annotation using |data units| or |screen units|.

A common use for whisker annotations is to indicate error margins or
uncertainty for measurements at a single point.

These are the most commonly used properties for this annotation:

* ``lower``: The coordinates of the lower end of the whisker.
* ``upper``: The coordinates of the upper end of the whisker.
* ``dimension``: The direction of the whisker. The direction can be one of
  these two values: Either * ``"width"`` for whiskers that are parallel to the
  plot's x axis. Or ``"height"`` for whiskers that are parallel to the plot's y
  axis.
* ``base``: The location of the whisker along the dimension specified with
  ``dimension``.
* The standard |line properties|.

.. bokeh-plot:: docs/user_guide/examples/plotting_whisker.py
    :source-position: above

.. |ColorMapper| replace:: :class:`~bokeh.models.mappers.ColorMapper`

.. |Arrow|         replace:: :class:`~bokeh.models.annotations.Arrow`
.. |ArrowHead|     replace:: :class:`~bokeh.models.arrow_heads.ArrowHead`
.. |Band|          replace:: :class:`~bokeh.models.annotations.Band`
.. |PolyAnnotation| replace:: :class:`~bokeh.models.annotations.PolyAnnotation`
.. |ColorBar|      replace:: :class:`~bokeh.models.annotations.ColorBar`
.. |Label|         replace:: :class:`~bokeh.models.annotations.Label`
.. |LabelSet|      replace:: :class:`~bokeh.models.annotations.LabelSet`
.. |Slope|         replace:: :class:`~bokeh.models.annotations.Slope`
.. |Span|          replace:: :class:`~bokeh.models.annotations.Span`
.. |Title|         replace:: :class:`~bokeh.models.annotations.Title`
.. |Whisker|       replace:: :class:`~bokeh.models.annotations.Whisker`
.. _userguide_embed:

Embedding Bokeh content
=======================

This chapter explores a variety of ways to embed standalone Bokeh documents and
Bokeh applications into web pages. First, here's how standalone documents
differ from applications:

:ref:`userguide_embed_standalone`
    These documents don't require a Bokeh server to work. They may have many
    tools and interactions such as custom JavaScript callbacks but are
    otherwise nothing but HTML, CSS, and JavaScript. These documents can be
    embedded into other HTML pages as one large document or as a set of
    sub-components with individual templating.

:ref:`userguide_embed_apps`
    These applications require a Bokeh server to work. Having a Bokeh server
    lets you connect events and tools to real-time Python callbacks that
    execute on the server. For more information about creating and running
    Bokeh apps, see :ref:`userguide_server`.

.. _userguide_embed_standalone:

Standalone documents
--------------------

This section describes different ways to publish and embed standalone Bokeh
documents.

.. _userguide_embed_standalone_html:

HTML files
~~~~~~~~~~

Bokeh can generate complete HTML pages for Bokeh documents using the
|file_html| function. This function can create an HTML document from its own
generic template or from a template you provide. These HTML files contain plot
data and are fully portable while still providing interactive tools
(pan, zoom, etc.) for your plot. Here is an example:

.. code-block:: python

    from bokeh.plotting import figure
    from bokeh.resources import CDN
    from bokeh.embed import file_html

    plot = figure()
    plot.circle([1,2], [3,4])

    html = file_html(plot, CDN, "my plot")

You can save the returned HTML text to a file using standard Python file
operations. You can also provide your own template for the HTML output
and pass in custom, or additional, template variables. For more details,
see the |file_html| documentation.

This is a low-level, explicit way to generate an HTML file, which can be
useful for web applications such as Flask apps.

In scripts and Jupyter notebooks employing the |bokeh.plotting| interface, you
can call the |output_file| function in conjunction with |show| or |save|
instead. The |show| function creates an HTML document and displays it in a
web browser whereas |save| creates an HTML document and saves it locally.

.. _userguide_embed_json_items:

JSON items
~~~~~~~~~~

Bokeh can also supply JSON data that BokehJS can use to render a standalone
Bokeh document in a specified ``<div>``. The |json_item| function accepts a
Bokeh model (for example, a plot) and an optional ID of the target ``<div>``.

.. code-block:: python

        p = figure()
        p.circle(x, y)

        item_text = json.dumps(json_item(p, "myplot"))

The :func:`~Bokeh.embed.embed_item` function can then use this output
on a web page:

.. code-block:: javascript

    item = JSON.parse(item_text);
    Bokeh.embed.embed_item(item);

This renders the plot in the ``<div>`` with the ID *"myplot"*.

You can also omit the target ID when calling |json_item|:

.. code-block:: python

        p = figure()
        p.circle(x, y)

        item_text = json.dumps(json_item(p)) # no target ID given

You can then specify the ID in JavaScript:

.. code-block:: javascript

    item = JSON.parse(item_text);
    Bokeh.embed.embed_item(item, "myplot");

Here's a more complete example of a Flask app serving Bokeh JSON items from a
*/plot* endpoint:

.. code-block:: python

    @app.route('/plot')
    def plot():
        p = make_plot('petal_width', 'petal_length')
        return json.dumps(json_item(p, "myplot"))

This produces JavaScript code that looks either like this:

.. code-block:: html

    <script>
    fetch('/plot')
        .then(function(response) { return response.json() })
        .then(function(item) { return Bokeh.embed.embed_item(item) })
    </script>

Or, with modern syntax, like this:

.. code-block:: html

    <script>
    const response = await fetch('/plot')
    const item = await response.json()
    Bokeh.embed.embed_item(item)
    </script>

For a complete example, see :bokeh-tree:`examples/embed/json_item.py`.

.. _userguide_embed_standalone_components:

Components
~~~~~~~~~~

You can also have Bokeh return individual components of a standalone document
to embed them one by one with the |components| function. This function returns
a ``<script>`` that contains the data for your plot and provides a target
``<div>`` to display the plot view. You can use these elements in HTML
documents however you like.

.. code-block:: python

    from bokeh.plotting import figure
    from bokeh.embed import components

    plot = figure()
    plot.circle([1,2], [3,4])

    script, div = components(plot)

The returned ``<script>`` will look something like this:

.. code-block:: html

    <script type="text/javascript">
        (function() {
      const fn = function() {
        Bokeh.safely(function() {
          const docs_json = { DOCUMENT DATA HERE };
          const render_items = [{
            "docid":"6833819f-9b5b-4904-821e-3f5eec77de9b",
            "elementid":"9574d123-9332-4b5f-96cc-6323bef37f40",
            "modelid":"7b328b27-9b14-4f7b-a5d8-0138bc7b0f59"
          }];

          Bokeh.embed.embed_items(docs_json, render_items);
        });
      };
      if (document.readyState != "loading") fn();
      else document.addEventListener("DOMContentLoaded", fn);
    })();

    </script>

Note that Jupyter notebooks do not allow for use of the |components| and |show|
functions in the same notebook cell.

The ``docs_json`` contains all the data as well as plot or widget objects
(omitted here for brevity). The resulting ``<div>`` looks something like
this:

.. code-block:: html

    <div class="bk-root" id="9574d123-9332-4b5f-96cc-6323bef37f40"></div>

You can insert or template this script and its companion ``<div>`` in an HTML
document and, when the script executes, your plot replaces the ``<div>``.

For this to work you first need to load BokehJS, either locally or from a
content delivery network (CDN). To load BokehJS from a CDN, add the following
lines to your HTML text or template with the appropriate version replacing
the ``x.y.z``:

.. code-block:: html

    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-x.y.z.min.js"
            crossorigin="anonymous"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-x.y.z.min.js"
            crossorigin="anonymous"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-x.y.z.min.js"
            crossorigin="anonymous"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-gl-x.y.z.min.js"
            crossorigin="anonymous"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-x.y.z.min.js"
            crossorigin="anonymous"></script>

The ``"-widgets"``, ``"-tables"``, and ``"-mathjax"`` files are only necessary
if your document includes :ref:`Bokeh widgets <userguide_interaction_widgets>`,
:ref:`data tables <userguide_interaction_widgets_examples_datatable>`, or
:ref:`math text <userguide_styling_math>`, respectively.

For example, to use version ``2.4.0`` with support for widgets, tables, and
math text, include the following in your HTML:

.. code-block:: html

    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.0.min.js"
            crossorigin="anonymous"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.0.min.js"
            crossorigin="anonymous"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.0.min.js"
            crossorigin="anonymous"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-gl-2.4.0.min.js"
            crossorigin="anonymous"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-2.4.0.min.js"
            crossorigin="anonymous"></script>

.. note::
    Always provide the closing ``</script>`` tag. This is required by all
    browsers and the page will typically not render without it. You should also
    always include the ``crossorigin="anonymous"`` attribute on the script tag.

If you would like to include `Subresource Integrity`_ (SRI) hashes in your
explicit script tags by setting the ``integrity`` attribute, the necessary
hashes can be obtained by calling
:func:`~bokeh.resources.get_sri_hashes_for_version`. Here's an example:

.. code-block:: python

    In [1]: import bokeh.resources

    In [2]: bokeh.resources.get_sri_hashes_for_version("2.2.0")
    Out[2]:
    {'bokeh-2.2.0.js': 'TQAjsk2/lDn1NHjYoe8HIascd3/Cw4EWdk6GNtYXVVyAiUkbEZiuP7fEgbSwM37Y',

    ...

    'bokeh-widgets-2.2.0.min.js': '2ltAd1cQhavmLeBEZXGgnna8fjbw+FjvDq9m2dig4+8KVS8JcYFUQaALvLT//qHE'}

These are bare hashes, and you have to prefix them with `sha384-` to use. For
example:

.. code-block:: html

     <script src="https://cdn.bokeh.org/bokeh/release/bokeh-2.2.0.min.js"
             integrity="sha384-5Y+xuMRAbgBj/2WKUiL8yzV4fBFic1HJPo2hT3pq2IsEzbsJjj8kT2i0b1lZ7C2N"
             crossorigin="anonymous"></script>

You can produce SRI hashes only for full release versions, not for dev builds
or release candidates.

In addition to a single Bokeh model, such as a plot, the |components| function
can also accept a list or tuple of models or a dictionary of keys and models.
Each returns a tuple with one script and a corresponding data structure for the
target ``<div>`` elements.

The following illustrates how different input types correlate to outputs:

.. code-block:: python

    components(plot)
    #=> (script, plot_div)

    components((plot_1, plot_2))
    #=> (script, (plot_1_div, plot_2_div))

    components({"Plot 1": plot_1, "Plot 2": plot_2})
    #=> (script, {"Plot 1": plot_1_div, "Plot 2": plot_2_div})

Here's an example of how you could use a multiple plot generator:

.. code-block:: python

    # scatter.py

    from bokeh.plotting import figure
    from bokeh.models import Range1d
    from bokeh.embed import components

    # create some data
    x1 = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    y1 = [0, 8, 2, 4, 6, 9, 5, 6, 25, 28, 4, 7]
    x2 = [2, 5, 7, 15, 18, 19, 25, 28, 9, 10, 4]
    y2 = [2, 4, 6, 9, 15, 18, 0, 8, 2, 25, 28]
    x3 = [0, 1, 0, 8, 2, 4, 6, 9, 7, 8, 9]
    y3 = [0, 8, 4, 6, 9, 15, 18, 19, 19, 25, 28]

    # select the tools you want
    TOOLS="pan,wheel_zoom,box_zoom,reset,save"

    # the red and blue graphs share this data range
    xr1 = Range1d(start=0, end=30)
    yr1 = Range1d(start=0, end=30)

    # only the green graph uses this data range
    xr2 = Range1d(start=0, end=30)
    yr2 = Range1d(start=0, end=30)

    # build the figures
    p1 = figure(x_range=xr1, y_range=yr1, tools=TOOLS, width=300, height=300)
    p1.scatter(x1, y1, size=12, color="red", alpha=0.5)

    p2 = figure(x_range=xr1, y_range=yr1, tools=TOOLS, width=300, height=300)
    p2.scatter(x2, y2, size=12, color="blue", alpha=0.5)

    p3 = figure(x_range=xr2, y_range=yr2, tools=TOOLS, width=300, height=300)
    p3.scatter(x3, y3, size=12, color="green", alpha=0.5)

    # plots can be a single Bokeh model, a list/tuple, or even a dictionary
    plots = {'Red': p1, 'Blue': p2, 'Green': p3}

    script, div = components(plots)
    print(script)
    print(div)

Running ``python scatter.py`` prints out the following:

.. code-block:: shell

    <script type="text/javascript">
        const docs_json = { DOCUMENT DATA HERE }
        const render_items = [{
          "docid":"33961aa6-fd96-4055-886f-b2afec7ff193",
          "elementid":"e89297cf-a2dc-4edd-8993-e16f0ca6af04",
          "modelid":"4eff3fdb-80f4-4b4c-a592-f99911e14398"
        },{
          "docid":"33961aa6-fd96-4055-886f-b2afec7ff193",
          "elementid":"eeb9a417-02a1-47e3-ab82-221abe8a1644",
          "modelid":"0e5ccbaf-62af-42cc-98de-7c597d83747a"
        },{
          "docid":"33961aa6-fd96-4055-886f-b2afec7ff193",
          "elementid":"c311f123-368f-43ba-88b6-4e3ecd9aed94",
          "modelid":"57f18497-9598-4c70-a251-6072baf223ff"
        }];

        Bokeh.embed.embed_items(docs_json, render_items);
    </script>

        {
            'Green': '\n<div class="bk-root" id="e89297cf-a2dc-4edd-8993-e16f0ca6af04"></div>',
            'Blue': '\n<div class="bk-root" id="eeb9a417-02a1-47e3-ab82-221abe8a1644"></div>',
            'Red': '\n<div class="bk-root" id="c311f123-368f-43ba-88b6-4e3ecd9aed94"></div>'
        }

You can then insert the resulting script and ``<div>`` elements into a
boilerplate such as the following:

.. code-block:: html

    <!DOCTYPE html>
    <html lang="en">
        <head>
            <meta charset="utf-8">
            <title>Bokeh Scatter Plots</title>

            <script src="https://cdn.bokeh.org/bokeh/release/bokeh-2.2.0.min.js"></script>

            <!-- COPY/PASTE SCRIPT HERE -->

        </head>
        <body>
            <!-- INSERT DIVS HERE -->
        </body>
    </html>

Note that this doesn't include JavaScript and CSS files for ``"-widgets"``
because the document doesn't use any Bokeh widgets.

You can see an example of multiple plot generation by executing the following:

.. code:: bash

    python /bokeh/examples/embed/embed_multiple.py

.. _userguide_embed_standalone_autoload:

Autoloading scripts
~~~~~~~~~~~~~~~~~~~

You can also embed standalone documents with the |autoload_static| function.
This function provides a ``<script>`` tag that replaces itself with a Bokeh
plot. This script also checks for BokehJS and loads it if necessary. This
function lets you embed a plot with nothing but this ``<script>`` tag.

This function takes a Bokeh model, such as a plot, that you want to display, a
``Resources`` object, and a path to load a script from. Then |autoload_static|
returns a self-contained ``<script>`` tag and a block of JavaScript code. The
JavaScript code saves to the path you provide and the ``<script>`` loads and
runs it to display your plot on a web page.

Here is how you might use |autoload_static| with a simple plot:

.. code-block:: python

    from bokeh.resources import CDN
    from bokeh.plotting import figure
    from bokeh.embed import autoload_static

    plot = figure()
    plot.circle([1,2], [3,4])

    js, tag = autoload_static(plot, CDN, "some/path")

The resulting ``<script>`` tag looks like this:

.. code-block:: html

    <script
        src="some/path"
        id="c5339dfd-a354-4e09-bba4-466f58a574f1"
        async="true"
        data-bokeh-modelid="7b226555-8e16-4c29-ba2a-df2d308588dc"
        data-bokeh-loglevel="info"
    ></script>

Include this tag anywhere you want your plot to display on an HTML page.

Save the JavaScript code to a file at `"some/path"` on the server where the
document containing the plot can reach it.

.. note::
    The ``<script>`` tag replaces itself with a ``<div>``, so it must be placed
    within the ``<body>`` of the document.

.. _userguide_embed_apps:

Bokeh applications
------------------

This section describes how to embed entire Bokeh server applications. You can
embed Bokeh apps so that every page load either creates and displays a new
session and document or outputs a specific, existing session.

App documents
~~~~~~~~~~~~~

If an application is running on a Bokeh server that makes it available at some
URL, you will typically want to embed the entire application in a web page.
This way, the page will create a new session and display it to the user every
time it loads.

You can achieve this with the |server_document| function. This function
accepts the URL to a Bokeh server application and returns a script that
embeds a new session from that server every time the script executes.

Here is an example of the |server_document| function in use:

.. code-block:: python

    from bokeh.embed import server_document
    script = server_document("https://demo.bokeh.org/sliders")

This returns a ``<script>`` tag that looks something like this:

.. code-block:: html

    <script
        src="https://demo.bokeh.org/sliders/autoload.js?bokeh-autoload-element=1000&bokeh-app-path=/sliders&bokeh-absolute-url=https://demo.bokeh.org/sliders"
        id="1000">
    </script>

You can add this tag to an HTML page to include the Bokeh application at that
point.

App sessions
~~~~~~~~~~~~

Sometimes, instead of loading a new session, you might wish to load a
*specific* one.

Take a Flask app that renders a page for an authenticated user. You might want
it to pull a new session, make some customizations for that specific user, and
serve this customized Bokeh server session.

You can accomplish this with the |server_session| function. This function
accepts a specific model to embed (or ``None`` for an entire session document),
session ID, and a URL to the Bokeh application.

Here is an example of how to use |server_session| with Flask:

.. code-block:: python

    from flask import Flask, render_template

    from bokeh.client import pull_session
    from bokeh.embed import server_session

    app = Flask(__name__)

    @app.route('/', methods=['GET'])
    def bkapp_page():

        # pull a new session from a running Bokeh server
        with pull_session(url="http://localhost:5006/sliders") as session:

            # update or customize that session
            session.document.roots[0].children[1].title.text = "Special sliders for a specific user!"

            # generate a script to load the customized session
            script = server_session(session_id=session.id, url='http://localhost:5006/sliders')

            # use the script in the rendered page
            return render_template("embed.html", script=script, template="Flask")

    if __name__ == '__main__':
        app.run(port=8080)

Standard template
-----------------

Bokeh also provides a standard Jinja template that helps you quickly and
flexibly embed different document roots by extending the "base" template. This
is especially useful when you need to embed individual components of a Bokeh
app in a non-Bokeh layout, such as Bootstrap.

Here's a minimal example for an application that creates two roots with name
properties set:

.. code-block:: python

    p1 = figure(..., name="scatter")

    p2 = figure(..., name="line")

    curdoc().add_root(p1)
    curdoc().add_root(p2)

You can then refer to these roots by their names and pass them to the ``embed``
macro to place them in any part of the template:

.. code-block:: html

    {% extends base %}

    <!-- goes in head -->
    {% block preamble %}
    <link href="app/static/css/custom.min.css" rel="stylesheet">
    {% endblock %}

    <!-- goes in body -->
    {% block contents %}
    <div> {{ embed(roots.scatter) }} </div>
    <div> {{ embed(roots.line) }} </div>
    {% endblock %}


Here's a full template with all the sections that you can override:

.. code-block:: html

    <!DOCTYPE html>
    <html lang="en">
    {% block head %}
    <head>
    {% block inner_head %}
        <meta charset="utf-8">
        <title>{% block title %}{{ title | e if title else "Bokeh Plot" }}{% endblock %}</title>
    {%  block preamble -%}{%- endblock %}
    {%  block resources -%}
    {%   block css_resources -%}
        {{- bokeh_css if bokeh_css }}
    {%-  endblock css_resources %}
    {%   block js_resources -%}
        {{  bokeh_js if bokeh_js }}
    {%-  endblock js_resources %}
    {%  endblock resources %}
    {%  block postamble %}{% endblock %}
    {% endblock inner_head %}
    </head>
    {% endblock head%}
    {% block body %}
    <body>
    {%  block inner_body %}
    {%    block contents %}
    {%      for doc in docs %}
    {{        embed(doc) if doc.elementid }}
    {%-       for root in doc.roots %}
    {%          block root scoped %}
    {{            embed(root) }}
    {%          endblock %}
    {%        endfor %}
    {%      endfor %}
    {%    endblock contents %}
    {{ plot_script | indent(4) }}
    {%  endblock inner_body %}
    </body>
    {% endblock body%}
    </html>


.. |autoload_static| replace:: :func:`~bokeh.embed.autoload_static`
.. |file_html|       replace:: :func:`~bokeh.embed.file_html`
.. |json_item|       replace:: :func:`~bokeh.embed.json_item`
.. |server_document| replace:: :func:`~bokeh.embed.server_document`
.. |server_session|  replace:: :func:`~bokeh.embed.server_session`

.. _Subresource Integrity: https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity
.. _userguide_extensions_examples_wrapping:

Wrapping a JavaScript library
-----------------------------

This example is a scaled-down standalone version of the demo at
`https://demo.bokeh.org/surface3d`_ that does not involve a Bokeh
server.

.. bokeh-plot:: docs/user_guide/examples/extensions_example_wrapping.py
    :source-position: below

.. _https://demo.bokeh.org/surface3d: https://demo.bokeh.org/surface3d
.. _userguide_extensions_examples_latex:

:orphan:

Deprecated. See :ref:`userguide_styling_math` for more information.
.. _userguide_extensions_examples_ticking:

Specialized axis ticking
------------------------

This example shows how to create a custom ``TickFormatter`` class that displays
the first tick of every axis as-is, and every subsequent tick as an offset from
the first. Pan and zoom the plot below and watch the x-axis.

.. bokeh-plot:: docs/user_guide/examples/extensions_example_ticking.py
    :source-position: below
.. _userguide_extensions_examples_widget:

Adding a custom widget
----------------------

This example shows how to add a double-ended slider widget to the plot.

The single normal Bokeh slider controls the power of the line.
The double ended sliders control the x range for the line.

.. bokeh-plot:: docs/user_guide/examples/extensions_example_widget.py
    :source-position: none

Python script:

.. literalinclude:: ../examples/extensions_example_widget.py
   :language: python

TypeScript for IonRangeSlider:

.. literalinclude:: ../examples/extensions_ion_range_slider.ts
   :language: coffee
.. _userguide_extensions_examples_tool:

A new custom tool
-----------------

This example shows a custom `GestureTool` subclass that can be used to sketch
on the plot canvas by dragging a mouse (or finger on a touch device).

.. bokeh-plot:: docs/user_guide/examples/extensions_example_tool.py
    :source-position: below
.. _userguide_interaction_jscallbacks:

JavaScript callbacks
--------------------

While the main goal of Bokeh is to provide a path to create rich interactive
visualizations in the browser purely from Python, there will always be
specialized use-cases that are outside the capabilities of the core library.
For this reason, Bokeh provides different ways for users to supply custom
JavaScript when necessary, so that users may add custom or specialized
behaviors in response to property changes and other events.

One mechanism is the ability to add entire new custom extension models,
as described in :ref:`userguide_extensions`. However, it is also possible
to supply small snippets of JavaScript as callbacks to use, e.g when property
values change or when UI or other events occur. This kind of callback can be
used to add interesting interactions to Bokeh documents without requiring
a Bokeh server (but can also be used in conjunction with a Bokeh server).

.. warning::
    The explicit purpose of these callbacks is to embed *raw JavaScript
    code* for a browser to execute. If any part of the code is derived from
    untrusted user inputs, then you must take appropriate care to sanitize
    the user input prior to passing it to Bokeh.

.. _userguide_interaction_jscallbacks_customjs:

CustomJS callbacks
~~~~~~~~~~~~~~~~~~

To supply a snippet of JavaScript code that should be executed (in the
browser) when some event occurs, use the ``CustomJS`` model:

.. code:: python

    from bokeh.models.callbacks import CustomJS

    callback = CustomJS(args=dict(xr=plot.x_range), code="""

    // JavaScript code goes here

    const a = 10;

    // the model that triggered the callback is cb_obj:
    const b = cb_obj.value;

    // models passed as args are automagically available
    xr.start = a;
    xr.end = b;

    """)

Note that in addition to the ``code`` property, ``CustomJS`` also accepts
an ``args`` property that maps string names to Bokeh models. Any Bokeh
models that are configured in ``args`` (on the "Python side") will
automatically be available to the JavaScript code by the corresponding name.
Additionally, the model that triggers the callback (that is the model that
the callback is attached to) will be available as ``cb_obj``.

.. _userguide_interaction_jscallbacks_customjs_properties:

CustomJS for model property events
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

These ``CustomJS`` callbacks can be attached to property change events on
any Bokeh model, using the ``js_on_change`` method of Bokeh models:

.. code:: python

    p = figure()

    # execute a callback whenever p.x_range.start changes
    p.x_range.js_on_change('start', callback)

It should be mentioned that the first parameter to ``js_on_change`` is
actually the name of a BokehJS event. The full format for a property
change event is, for example, ``"change:start"``, but Bokeh will automatically
convert any property name into one of these BokehJS change events for you.
Additionally, some Bokeh models have additional specialized events. For
example, the ``ColumnDataSource`` also supports ``"patch"`` and ``"stream"``
events, for executing ``CustomJS`` callbacks whenever the data source is
patched or streamed to.

Below is an example that shows how to attach a ``CustomJS`` callback to a
``Slider`` widget, so that whenever the slider value updates, the callback
is executed to update some data:

.. bokeh-plot:: docs/user_guide/examples/interaction_callbacks_js_on_change.py
    :source-position: above

.. _userguide_interaction_jscallbacks_customjs_interactions:

CustomJS for user interaction events
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In addition to responding to property change events using js_on_change, Bokeh
allows CustomJS callbacks to be triggered by specific interaction events with
the plot canvas, on button click events, and on LOD events.

These event callbacks are defined on models using the js_on_event method,
with the callback receiving the event object as a locally defined cb_obj
variable:

.. code:: python

    from bokeh.models.callbacks import CustomJS

    callback = CustomJS(code="""
    // the event that triggered the callback is cb_obj:
    // The event type determines the relevant attributes
    console.log('Tap event occurred at x-position: ' + cb_obj.x)
    """)

    p = figure()
    # execute a callback whenever the plot canvas is tapped
    p.js_on_event('tap', callback)

The event can be specified as a string such as ``'tap'`` above, or an event
class import from the ``bokeh.events`` module
(i.e. ``from bokeh.events import Tap``).

The following code imports ``bokeh.events`` and registers all of the
available event classes using the ``display_event`` function in order to
generate the ``CustomJS`` objects. This function is used to update the ``Div``
with the event name (always accessible from the ``event_name``
attribute) as well as all the other applicable event attributes. The
result is a plot that displays the corresponding event on the right when the
user interacts with it:

.. bokeh-plot:: docs/user_guide/examples/js_events.py
    :source-position: above

Examples
~~~~~~~~

CustomJS for widgets
''''''''''''''''''''

A common use case for property callbacks is responding to changes to widgets.
The code below shows an example of ``CustomJS`` set on a slider Widget that
changes the source of a plot when the slider is used.

.. bokeh-plot:: docs/user_guide/examples/interaction_callbacks_for_widgets.py
    :source-position: above

CustomJS for selections
'''''''''''''''''''''''

Another common scenario is wanting to specify the same kind of callback to be
executed whenever a selection changes. As a simple demonstration, the example
below simply copies selected points on the first plot to the second. However,
more sophisticated actions and computations are easily constructed in a
similar way.

.. bokeh-plot:: docs/user_guide/examples/interaction_callbacks_for_selections.py
    :source-position: above

Another more sophisticated example is shown below. It computes the average `y`
value of any selected points (including multiple disjoint selections) and draws
a line through that value.

.. bokeh-plot:: docs/user_guide/examples/interaction_callbacks_for_selections_lasso_mean.py
    :source-position: above

CustomJS for ranges
'''''''''''''''''''

The properties of range objects may also be connected to ``CustomJS`` callbacks
in order to perform specialized work whenever a range changes:

.. bokeh-plot:: docs/user_guide/examples/interaction_callbacks_for_range_update.py
    :source-position: above

CustomJS for tools
''''''''''''''''''

Selection tools emit events that can drive useful callbacks. Below, a
callback for ``SelectionGeometry`` uses the ``BoxSelectTool`` geometry (accessed
via the geometry field of the ``cb_data`` callback object), in order to update a
``Rect`` glyph.

.. bokeh-plot:: docs/user_guide/examples/interaction_callbacks_for_tools.py
    :source-position: above


CustomJS for specialized events
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In addition to the generic mechanisms described above for adding ``CustomJS``
callbacks to Bokeh models, there are also some Bokeh models that have a
``.callback`` property specifically for executing ``CustomJS`` in response
to specific events or situations.

.. warning::
    The callbacks described below were added early to Bokeh in an ad-hoc
    fashion. Many of them can be accomplished with the generic mechanism
    described above, and as such, may be deprecated in favor of the generic
    mechanism in the future.

CustomJS for hover tool
'''''''''''''''''''''''

The ``HoverTool`` has a callback which comes with two pieces of built-in data:
the ``index`` and the ``geometry``. The ``index`` is the indices of any points
that the hover tool is over.

.. bokeh-plot:: docs/user_guide/examples/interaction_callbacks_for_hover.py
    :source-position: above

OpenURL
'''''''

Opening an URL when users click on a glyph (for instance a circle marker) is
a very popular feature. Bokeh lets users enable this feature by exposing an
OpenURL callback object that can be passed to a Tap tool in order to have that
action called whenever the user clicks on the glyph.

The following code shows how to use the OpenURL action combined with a TapTool
to open an URL whenever the user clicks on a circle.

.. bokeh-plot:: docs/user_guide/examples/interaction_open_url.py
    :source-position: above

Please note that ``OpenURL`` callbacks specifically and only work with
``TapTool``, and are only invoked when a glyph is hit. That is, they do not
execute on every tap. If you would like to execute a callback on every
mouse tap, please see :ref:`userguide_interaction_jscallbacks_customjs_interactions`.
.. _userguide_interaction_legends:

Interactive legends
-------------------

:ref:`userguide_annotations_legends` added to Bokeh plots can be made interactive
so that clicking or tapping on the legend entries will hide or mute the
corresponding glyph in a plot. These modes are activated by setting the
``click_policy`` property on a :class:`~bokeh.models.annotation.Legend` to
either ``"hide"`` or ``"mute"``.

.. note::
    Interactive legends only work on "per-glyph" legends. Grouped legends
    do not yet support the features described below.

Hiding glyphs
~~~~~~~~~~~~~

Sometimes it is desirable to be able to hide glyphs by clicking on an entry
in a ``Legend``. In Bokeh this can be accomplished by setting the legend
``click_policy`` property to ``"hide"`` as shown in the example below:

.. bokeh-plot:: docs/user_guide/examples/interaction_legend_hide.py
    :source-position: above

Muting glyphs
~~~~~~~~~~~~~

Other times it is preferable for legend interaction to mute a glyph, instead
of hiding it entirely. In this case, set ``click_policy`` property to
``"mute"``. Additionally, the visual properties of a "muted glyph" also
need to be specified. In general, this is done in exactly the same way as for
:ref:`userguide_styling_selected_unselected_glyphs` or
:ref:`userguide_styling_hover_inspections`. In the example below,
``muted_alpha=0.2`` and ``muted_color=color`` are passed to ``circle`` to
specify that muted lines should be drawn with a low alpha muted glyph.

.. bokeh-plot:: docs/user_guide/examples/interaction_legend_mute.py
    :source-position: above
.. _userguide_interaction_linked:

Linking behavior
----------------

It's often useful to link plots to add connected interactivity between plots.
This section shows an easy way to do this, using the |bokeh.plotting| interface.

.. _userguide_interaction_linked_panning:

Linked panning
~~~~~~~~~~~~~~

It's often desired to link pan or zooming actions across many plots. All that is
needed to enable this feature is to share range objects between |figure|
calls.

.. bokeh-plot:: docs/user_guide/examples/interaction_linked_panning.py
    :source-position: above

Now you have learned how to link panning between multiple plots with the
|bokeh.plotting| interface.

.. _userguide_interaction_linked_brushing:

Linked brushing
~~~~~~~~~~~~~~~

Linked brushing in Bokeh is expressed by sharing data sources between glyph
renderers. This is all Bokeh needs to understand that selections acted on one
glyph must pass to all other glyphs that share that same source. To see how linked
selection extends to glyph renderers that plot only a subset of data from a data
source, see :ref:`userguide_data_linked_selection_with_filtering`.

The following code shows an example of linked brushing between circle glyphs on
two different |figure| calls.

.. bokeh-plot:: docs/user_guide/examples/interaction_linked_brushing.py
    :source-position: above

.. _userguide_interaction_linked_properties:

Linked properties
~~~~~~~~~~~~~~~~~

It is also possible to link values of Bokeh model properties together so that
they remain synchronized, using the ``js_link`` method. The example below links
a circle glyph radius to the value of a Slider widget:

.. bokeh-plot:: docs/user_guide/examples/interaction_linked_properties.py
    :source-position: above

The linking is accomplished in JavaScript, so this method works in standalone
Bokeh documents, or in Bokeh server applications.

See :ref:`userguide_interaction_widgets` for more information about different
widgets, and :ref:`userguide_interaction_jscallbacks` for more information about
creating arbitrary JavaScript callbacks.
.. _userguide_interaction_widgets:

Adding widgets
==============

Widgets are interactive controls that can be added to Bokeh applications to
provide a front end user interface to a visualization. They can drive new
computations, update plots, and connect to other programmatic functionality.
When used with the Bokeh server, widgets can run arbitrary Python code, enabling
complex applications. Widgets can also be used without the Bokeh server in
standalone HTML documents through the browser's JavaScript runtime.

.. _userguide_interaction_widgets_callbacks:

Callbacks
---------

To use widgets, you must add them to your document and define their callbacks.
Widgets can be added directly to the document root or nested inside a layout.
There are two ways to use a widget's functionality:

    * A ``CustomJS`` callback (see :ref:`userguide_interaction_jscallbacks`).
      This approach will work in standalone HTML documents or Bokeh server apps.
    * Use ``bokeh serve`` to start a Bokeh server and set up event handlers with
      ``.on_change`` or ``.on_event``.

Event handlers are Python functions that users can attach to widgets. These
functions are then called when certain attributes on the widget are changed.
The function signature of event handlers is determined by how they are attached
to widgets (whether by ``.on_change`` or ``.on_event``, for example).

All widgets have an ``.on_change`` method that takes an attribute name and one
or more event handlers as parameters. These handlers are expected to have the
function signature, ``(attr, old, new)``, where ``attr`` refers to the changed
attribute's name, and ``old`` and ``new`` refer to the previous and updated
values of the attribute.

.. code-block:: python

    def my_text_input_handler(attr, old, new):
        print("Previous label: " + old)
        print("Updated label: " + new)

    text_input = TextInput(value="default", title="Label:")
    text_input.on_change("value", my_text_input_handler)

Additionally, some widgets, including the button, dropdown, and checkbox, have
an ``.on_event`` method that takes an event handler as its only parameter. For
a plain ``Button``, this handler is called without parameters. For the other
widgets with ``.on_event``, the handler is passed the new attribute value.

.. code-block:: python

    def my_radio_handler(new):
        print('Radio button option ' + str(new) + ' selected.')

    radio_group = RadioGroup(labels=["Option 1", "Option 2", "Option 3"], active=0)
    radio_group.on_event('button_click', my_radio_handler)

Bokeh provides a simple default set of widgets. Users can create their own
custom widgets, or wrap different third party widget libraries by creating
custom extensions as described in :ref:`userguide_extensions`.

For more information about the attributes to watch using ``.on_change``, see the
|reference guide|. (Information about widgets is found under |bokeh.models|.)

.. _userguide_interaction_widgets_examples:

Examples
--------

The sections below collect short but complete examples of using all the built-in
widgets. Many of the examples print output that can be observed by looking at
your browser JavaScript console log.

Button
~~~~~~

Bokeh provides a simple Button:

.. bokeh-plot:: docs/user_guide/examples/interaction_button.py
    :source-position: below

More information can be found in the Reference for |Button|.

CheckboxButtonGroup
~~~~~~~~~~~~~~~~~~~

Bokeh also provides a checkbox button group, that can have multiple options
selected simultaneously:

.. bokeh-plot:: docs/user_guide/examples/interaction_checkbox_button_group.py
    :source-position: below

More information can be found in the Reference for |CheckboxButtonGroup|.

CheckboxGroup
~~~~~~~~~~~~~

A standard checkbox:

.. bokeh-plot:: docs/user_guide/examples/interaction_checkbox_group.py
    :source-position: below

More information can be found in the Reference for |CheckboxGroup|.

ColorPicker
~~~~~~~~~~~

A widget to allow the user to specify an RGB color value.

.. bokeh-plot:: docs/user_guide/examples/interaction_colorpicker.py
    :source-position: below

More information can be found in the Reference for |ColorPicker|.

.. _userguide_interaction_widgets_examples_datatable:

DataTable
~~~~~~~~~

Bokeh provides a sophisticated data table widget based on SlickGrid. Note
that since the table is configured with a data source object, any plots that
share this data source will automatically have selections linked between the
plot and the table (even in static HTML documents).

.. bokeh-plot:: docs/user_guide/examples/interaction_data_table.py
    :source-position: below

More information can be found in the Reference for |DataTable|.

DatePicker
~~~~~~~~~~~

A widget to allow the user to specify a date value.

.. bokeh-plot:: docs/user_guide/examples/interaction_datepicker.py
    :source-position: below

More information can be found in the Reference for |DatePicker|.

DateRangeSlider
~~~~~~~~~~~~~~~

The Bokeh date range-slider can be configured with ``start`` and ``end`` date
values, a ``step`` size, an initial ``value``, and a ``title``:

.. bokeh-plot:: docs/user_guide/examples/interaction_daterangeslider.py
    :source-position: below

More information can be found in the Reference for |DateRangeSlider|.

.. _userguide_interaction_widgets_div:

Div
~~~

A widget for displaying text that can support HTML in a <div> tag:

.. bokeh-plot:: docs/user_guide/examples/interaction_div.py
    :source-position: below

More information can be found in the Reference for |Div|.

Dropdown
~~~~~~~~

A *button* that displays a drop-down list of mutually exclusive items when
clicked.

.. bokeh-plot:: docs/user_guide/examples/interaction_dropdown.py
    :source-position: below

More information can be found in the Reference for |Dropdown|.

FileInput
~~~~~~~~~

A widget allowing users to choose a file and store its contents.

.. bokeh-plot:: docs/user_guide/examples/interaction_fileinput.py
    :source-position: below

More information can be found in the Reference for |FileInput|.

MultiChoice
~~~~~~~~~~~

A multi-select widget to present multiple available options in a compact
horizontal layout:

.. bokeh-plot:: docs/user_guide/examples/interaction_multichoice.py
    :source-position: below

More information can be found in the Reference for |MultiChoice|.

MultiSelect
~~~~~~~~~~~

A multi-select widget to present multiple available options in vertical list:

.. bokeh-plot:: docs/user_guide/examples/interaction_multiselect.py
    :source-position: below

More information can be found in the Reference for |MultiSelect|.

.. _userguide_interaction_widgets_paragraph:

Paragraph
~~~~~~~~~

A widget for displaying a block of text in an HTML <p> tag:

.. bokeh-plot:: docs/user_guide/examples/interaction_paragraph.py
    :source-position: below

More information can be found in the Reference for |Paragraph|.

PasswordInput
~~~~~~~~~~~~~

A text input that obscures the entered text:

.. bokeh-plot:: docs/user_guide/examples/interaction_passwordinput.py
    :source-position: below

More information can be found in the Reference for |PasswordInput|.

PreText
~~~~~~~

A widget for displaying a block of pre-formatted text in an HTML <pre> tag:

.. bokeh-plot:: docs/user_guide/examples/interaction_pretext.py
    :source-position: below

More information can be found in the Reference for |PreText|.

RadioButtonGroup
~~~~~~~~~~~~~~~~

A radio button group can have at most one selected button at a time:

.. bokeh-plot:: docs/user_guide/examples/interaction_radio_button_group.py
    :source-position: below

More information can be found in the Reference for |RadioButtonGroup|.

RadioGroup
~~~~~~~~~~

A radio group uses standard radio button appearance:

.. bokeh-plot:: docs/user_guide/examples/interaction_radio_group.py
    :source-position: below

More information can be found in the Reference for |RadioGroup|.

.. _userguide_interaction_widgets_range_slider:

RangeSlider
~~~~~~~~~~~

The Bokeh range-slider can be configured with ``start`` and ``end`` values, a ``step`` size,
an initial ``value``, and a ``title``:

.. bokeh-plot:: docs/user_guide/examples/interaction_range_slider.py
    :source-position: below

More information can be found in the Reference for |RangeSlider|.

Select
~~~~~~

A single selection widget:

.. bokeh-plot:: docs/user_guide/examples/interaction_select.py
    :source-position: below

More information can be found in the Reference for |Select|.

.. _userguide_interaction_widgets_slider:

Slider
~~~~~~

The Bokeh slider can be configured with ``start`` and ``end`` values, a ``step`` size,
an initial ``value``, and a ``title``:

.. bokeh-plot:: docs/user_guide/examples/interaction_slider.py
    :source-position: below

More information can be found in the Reference for |Slider|.

Spinner
~~~~~~~

A numeric spinner widget:

.. bokeh-plot:: docs/user_guide/examples/interaction_spinner.py
    :source-position: below

More information can be found in the Reference for |Spinner|.

Tabs
~~~~

Tab panes allow multiple plots or layouts to be shown in selectable tabs:

.. bokeh-plot:: docs/user_guide/examples/interaction_tab_panes.py
    :source-position: below

More information can be found in the Reference for |Tabs|.

TextAreaInput
~~~~~~~~~~~~~

A widget for collecting multiple lines of text from a user:

.. bokeh-plot:: docs/user_guide/examples/interaction_textareainput.py
    :source-position: below

More information can be found in the Reference for |TextAreaInput|.

TextInput
~~~~~~~~~

A widget for collecting a line of text from a user:

.. bokeh-plot:: docs/user_guide/examples/interaction_textinput.py
    :source-position: below

More information can be found in the Reference for |TextInput|.

Toggle
~~~~~~

The toggle button holds an on/off state:

.. bokeh-plot:: docs/user_guide/examples/interaction_toggle_button.py
    :source-position: below

More information can be found in the Reference for |Toggle|.

.. |Button|                 replace:: :class:`~bokeh.models.widgets.buttons.Button`
.. |CheckboxButtonGroup|    replace:: :class:`~bokeh.models.widgets.groups.CheckboxButtonGroup`
.. |CheckboxGroup|          replace:: :class:`~bokeh.models.widgets.groups.CheckboxGroup`
.. |ColorPicker|            replace:: :class:`~bokeh.models.widgets.inputs.ColorPicker`
.. |DataTable|              replace:: :class:`~bokeh.models.widgets.tables.DataTable`
.. |DatePicker|             replace:: :class:`~bokeh.models.widgets.inputs.DatePicker`
.. |DateRangeSlider|        replace:: :class:`~bokeh.models.widgets.sliders.DateRangeSlider`
.. |Div|                    replace:: :class:`~bokeh.models.widgets.markups.Div`
.. |Dropdown|               replace:: :class:`~bokeh.models.widgets.buttons.Dropdown`
.. |FileInput|              replace:: :class:`~bokeh.models.widgets.inputs.FileInput`
.. |MultiChoice|            replace:: :class:`~bokeh.models.widgets.inputs.MultiChoice`
.. |MultiSelect|            replace:: :class:`~bokeh.models.widgets.inputs.MultiSelect`
.. |Paragraph|              replace:: :class:`~bokeh.models.widgets.markups.Paragraph`
.. |PasswordInput|          replace:: :class:`~bokeh.models.widgets.inputs.PasswordInput`
.. |PreText|                replace:: :class:`~bokeh.models.widgets.markups.PreText`
.. |RadioButtonGroup|       replace:: :class:`~bokeh.models.widgets.groups.RadioButtonGroup`
.. |RadioGroup|             replace:: :class:`~bokeh.models.widgets.groups.RadioGroup`
.. |RangeSlider|            replace:: :class:`~bokeh.models.widgets.sliders.RangeSlider`
.. |Select|                 replace:: :class:`~bokeh.models.widgets.inputs.Select`
.. |Slider|                 replace:: :class:`~bokeh.models.widgets.sliders.Slider`
.. |Spinner|                replace:: :class:`~bokeh.models.widgets.inputs.Spinner`
.. |Tabs|                   replace:: :class:`~bokeh.models.layouts.Tabs`
.. |TextAreaInput|          replace:: :class:`~bokeh.models.widgets.inputs.TextAreaInput`
.. |TextInput|              replace:: :class:`~bokeh.models.widgets.inputs.TextInput`
.. |Toggle|                 replace:: :class:`~bokeh.models.widgets.buttons.Toggle`
.. _contributor_guide_pull_requests:

Making a successful pull request
================================

All changes to Bokeh's codebase and documentation are managed through
`pull requests`_.

Prerequisites
-------------

Creating a pull request requires some basic knowledge of GitHub. See the
`GitHub documentation`_ for general information about GitHub and pull requests.

To create a pull request, you need a development environment as described in
:ref:`contributor_guide_setup`.

You can format any text you enter when working with pull requests. To learn more
about your formatting options, see `Writing on GitHub`_ in the
`GitHub documentation`_.

Pull request workflow
---------------------

1. Find an issue to reference
    Every pull request to the Bokeh repository begins with an issue. See
    `Pull Requests in the Bokeh wiki <wiki pull requests_>`_ for more
    information on exceptions.

    First, pick an issue from Bokeh's `issue tracker`_. Issues that are
    relatively easy to get started on are labeled `good first issue`_.

    Next, post a comment in the issue's discussion to indicate that you are
    working on this issue. If there is no issue yet, you should first
    :ref:`create one <contributor_guide_issues>`.

2. Create a branch
    Before writing any code, you need to create a new `branch`_ on
    :ref:`your fork <contributor_guide_setup_cloning>` of the Bokeh repository.
    In most cases, you should base your new branch on Bokeh's ``default``
    branch. The default branch is usually a branch that represents the next
    version of Bokeh, for example ``branch-3.0``.

    Use this pattern to name your branch:

    ``[issue number]_[short_description]``

    For example:

    ``11423_table_column_add_visible``

    See `BEP 6: Branching Strategy`_ for more information on the different
    branches in the Bokeh repository.

    To create this example branch and check it out:

    ``git checkout -b 11423_table_column_add_visible``

3. Add commits to your local branch
    Make some changes to the code and save the modified files. To view which
    files were modified:

    ``git status``

    When you're satisfied with the current change, stage each modified file:

    ``git add filename1 filename2 filenameN``

    And then commit the change with a commit message:

    ``git commit -m "one-liner describing change"``

4. Push your local branch to your fork on GitHub
    Before you can open a pull request, you first need to `push your branch`_
    from your local clone to your fork on GitHub. For example:

    ``git push --set-upstream origin 11423_table_column_add_visible``

5. Open a new pull request
    After publishing your branch and adding a first commit, go to the
    `Bokeh repository`_ on GitHub. GitHub should have detected your recent
    updates to your branch. In this case, GitHub will suggest opening a pull
    request for you. If not, switch to the tab "Pull request" in the top menu
    and use the button "New pull request".

    To create a pull request, make sure to select the default branch you used
    when creating your branch as ``base`` (for example, ``branch-3.0``). Select
    your branch as ``compare``.

6. Write your pull request
    After creating your pull request, GitHub will compare your branch to the
    base branch and highlight all your proposed changes.

    First, enter a title for your pull request. This title should make clear
    what your pull request does. For example: "Fix PNG export", "Add panel to
    tests", or "Document SVG backend".

    Next, enter a description. Include some background about what your pull
    request does and why you decided to write things the way you did. Also, link
    to the issue your pull request is based on. To do so, use a keyword such as
    "fixes," followed by the number of the issue. For example "Fixes #11479".
    See `Linking a pull request to an issue using a keyword`_ in the
    `GitHub documentation`_ for more information. Your description should also
    include information about :ref:`tests <contributor_guide_writing_tests>` and
    :ref:`documentation <contributor_guide_documentation>`, if applicable.

7. Add more commits to your pull request
    Once you have created a pull request, a member of the `Bokeh core team`_
    will begin `reviewing your pull request`_ and may request changes or
    additions. If so, they will help you along the way with any questions you
    may have. You can make new changes in your existing local branch and push
    them to Github. The PR will update automatically, there is no need to open a
    new PR. The team member will also update any
    `labels in your pull request <wiki pull requests_>`_. Reviewing pull
    requests can be time-consuming, so be aware that it might take a while to
    receive feedback.

8. Look for the next issue to work on
    With your first pull request merged, you should take another look at Bokeh's
    `issue tracker`_ to find the next issue to work on.

    Once your successfully complete two substantive pull requests, you are
    eligible to become a member of the `Bokeh development team`_. This means
    you will have direct access to the Bokeh repository and won't need to use
    a fork, for example. See `BEP 4: Project Roles`_ for more information about
    all roles in the Bokeh project.

Tips
----

If you have any questions or encounter any problems with your pull request,
please reach out on the `Bokeh's contributor Slack`_ or the `Bokeh Discourse`_.
Also, check the :ref:`additional resources available to contributors
<contributor_guide_resources>`.

Things to keep in mind when working on a pull request:

* When writing code, try to match the existing coding style.
* Try to divide your work into smaller chunks and push small, incremental
  commits.
* Include :ref:`new tests <contributor_guide_writing_tests>` when adding new
  features.
* Include :ref:`tests <contributor_guide_writing_tests>` to check for
  regressions when fixing bugs.
* Keep the discussions focused. When a new or related topic comes up, it's
  often better to create a new issue than to sidetrack the discussion.
* Don't submit a big pull request unannounced. Instead, file an issue and
  start a discussion about what direction to take before investing a large
  amount of time.
* Never commit code or documentation that you didn't write (or don't have the
  necessary rights to). If you find code or text that is compatible with
  `Bokeh's BSD license`_ and that you think would be useful to add to Bokeh,
  :ref:`file an issue <contributor_guide_issues>` and start a discussion first.
* In case your pull request includes additional or updated dependencies, you
  not only need to update :bokeh-tree:`environment.yml` but also the
  :ref:`environment files Bokeh's CI <contributor_guide_testing_ci_environments>`
  in the :bokeh-tree:`ci` folder.

See the `"Pull Requests" section in BEP 1: Issues and PRs management <wiki pull requests_>`_
for more information about labels and the pull request management process.

.. _pull requests: https://docs.github.com/en/github/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests
.. _GitHub documentation: https://docs.github.com/en/get-started
.. _issue tracker: https://github.com/bokeh/bokeh/issues
.. _Writing on GitHub: https://docs.github.com/en/github/writing-on-github
.. _wiki pull requests: https://github.com/bokeh/bokeh/wiki/BEP-1:-Issues-and-PRs-management#pull-requests
.. _good first issue: https://github.com/bokeh/bokeh/labels/good%20first%20issue
.. _branch: https://docs.github.com/en/github/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-branches
.. _`BEP 6: Branching Strategy`: https://github.com/bokeh/bokeh/wiki/BEP-6:-Branching-Strategy
.. _push your branch: https://docs.github.com/en/get-started/using-git/pushing-commits-to-a-remote-repository
.. _reviewing your pull request: https://docs.github.com/en/github/collaborating-with-pull-requests/reviewing-changes-in-pull-requests
.. _Bokeh Discourse: https://discourse.bokeh.org/
.. _Bokeh's contributor Slack: https://slack-invite.bokeh.org/
.. _Bokeh repository: https://github.com/bokeh/bokeh/
.. _Linking a pull request to an issue using a keyword: https://docs.github.com/en/issues/tracking-your-work-with-issues/linking-a-pull-request-to-an-issue#linking-a-pull-request-to-an-issue-using-a-keyword
.. _Bokeh core team: https://github.com/bokeh/bokeh/wiki/BEP-4:-Project-Roles#core-team
.. _Bokeh development team: https://github.com/bokeh/bokeh/wiki/BEP-4:-Project-Roles#development-team
.. _`BEP 4: Project Roles`: https://github.com/bokeh/bokeh/wiki/BEP-4:-Project-Roles
.. _Bokeh's BSD license: https://github.com/bokeh/bokeh/blob/main/LICENSE.txt
.. _contributor_guide_setup:

Setting up a development environment
====================================

The Bokeh project consists of two major components: the Bokeh package source
code, written in Python, and the :term:`BokehJS` client-side library, written in
TypeScript.

Therefore, you need to set up two environments to contribute to Bokeh: A Python
environment and a TypeScript environment. This chapter walks you through all the
necessary steps to set up a full development environment.

.. _contributor_guide_setup_preliminaries:

1. Check basic requirements
---------------------------

Install or update Git
~~~~~~~~~~~~~~~~~~~~~

The Bokeh source code is stored in a `Git`_ source control repository. The first
step to working on Bokeh is to install or update Git on your system.

There are different ways to do this, depending on whether you are using
Windows, OSX, or Linux. To install Git on any platform, refer to the
`Installing Git`_ section of the `Pro Git Book`_.

If you have never used Git before, you can find links to several beginner
tutorials and resources in the `Git documentation`_.

Install or update conda
~~~~~~~~~~~~~~~~~~~~~~~

Working on the Bokeh codebase requires installing several software packages that
are not Python packages. For example, `Node.js`_ for TypeScript development or
`Selenium`_ for testing and exporting.

To be able to manage Python and non-Python dependencies in one place, Bokeh uses
the `conda package manager`_. ``conda`` is part of the free `Anaconda`_ Python
distribution available for Windows, macOS, and Linux. Conda creates and manages
virtual environments for you. Therefore, you don't need tools like ``venv``,
``virtualenv``, or ``pipenv``. While it is technically possible to install all
dependencies manually without ``conda``, this guide will assume that you have
``conda`` installed.

To install or update Conda on your system, see `Installation`_ in the `Conda
documentation`_.

.. note::
    If ``conda`` is already installed on your system, make sure it is up to date
    by running the following command:

    .. code-block:: sh

        conda update -n base -c defaults conda

.. _contributor_guide_setup_cloning:

2. Fork and clone the repository
--------------------------------

The source code for the Bokeh project is hosted on GitHub_, at
https://github.com/bokeh/bokeh.

Unless you are a `@bokeh/dev team member`_, you first need to create a fork of
Bokeh's main repository. For more information on creating a fork, see
`Fork a repo`_ in `GitHub Help`_.

Next, clone the version of the Bokeh repository you want to work on to a local
folder on your hard drive. Use ``git clone`` or follow the instructions for
`cloning a forked repository`_ in `GitHub Help`_.

Cloning the repository creates a ``bokeh`` directory at your file system
location. This local ``bokeh`` directory is referred to as the *source checkout*
for the remainder of this document.

.. _contributor_guide_setup_creating_conda_env:

3. Create a conda environment
-----------------------------

The Bokeh repository you just cloned to your local hard drive contains an
:bokeh-tree:`environment.yml` file. In this file is all the necessary
information to automatically create a basic development environment. The name of
this virtual environment will be ``bkdev``.

Use ``conda env create`` at the root level of your *source checkout* directory
to set up the environment and install all necessary packages:

.. code-block:: sh

    conda env create -f environment.yml

Then, activate the environment:

.. code-block:: sh

    conda activate bkdev

.. note::
    To update your local environment, use
    ``conda env update -f environment.yml``. Updating your local environment
    is necessary whenever the dependencies in ``environment.yml`` change. This
    can happen when the environment file is updated in the main Bokeh repository
    or when you switch branches to work on different issues, for example.

To learn more about creating and managing conda environments, see `Managing
environments`_ in the `Conda documentation`_.

.. _contributor_guide_setup_installing_node_packages:

4. Install Node packages
------------------------

Building BokehJS also requires installing JavaScript dependencies using
the `Node Package Manager (npm) <npm_>`_. If you have followed the
:ref:`instructions above <contributor_guide_setup_creating_conda_env>`,
``conda`` has already installed the necessary ``npm`` and ``node.js``
packages to your system.

Bokeh usually requires the latest major revision of ``npm``. To install the
newest version globally, start from the top level of the *source checkout*
directory, and run the following commands:

.. code-block:: sh

    cd bokehjs
    npm install -g npm@8

If you do not want to install npm globally, leave out the ``-g`` flag. In this
case, you need to adjust all subsequent ``npm`` commands to use the local
version installed under ``bokehjs/node_modules``.

Next, still in the ``bokehjs`` subdirectory, run the following command
to install all the JavaScript dependencies for BokehJS:

.. code-block:: sh

    npm ci

This command installs the necessary packages into the ``node_modules``
subdirectory.

.. note::
    Typically, you only need to do this once when you first set up your local
    environment. However, if dependencies are added or changed, you need to
    repeat these steps to install and update the respective packages.

.. _contributor_guide_setup_pre-commit:

5. Set up pre-commit
--------------------

Bokeh uses `pre-commit`_ to help you prevent some common mistakes in your
commits.

To set up pre-commit locally, run the following command from the top level of
your *source checkout* directory:

.. code-block:: sh

    python scripts/hooks/install.py

This configures pre-commit to use two `Git hooks`_ that will check your code
whenever you push a commit to Bokeh's GitHub repository:

Codebase tests
    git-commit will run Bokeh's
    :ref:`codebase tests <contributor_guide_testing_local_codebase>` to check
    for codebase quality issues such as whitespaces and imports. This includes
    testing with `Flake8`_, `ESLint`_, and `isort`_.

Protected branches
    git-commit will make sure you don't accidentally push a commit to `Bokeh's
    protected branches`_ ``main`` and ``branch-x.y`` on GitHub.

.. note::
    Depending on your system, running those tests may take several dozen
    seconds. If any of the tests fail, check the output of your console. In most
    cases, this is where you will find the necessary information about what you
    need to change to pass the tests.

To uninstall the Git hooks, run the following command from the top level of your
*source checkout* directory:

    .. code-block:: sh

        python scripts/hooks/uninstall.py

.. _contributor_guide_setup_install_locally:

6. Build and install locally
----------------------------

Once you have all the required dependencies installed, the simplest way to
build and install Bokeh and BokehJS is to use the ``setup.py`` script. This
script is located at the top level of the *source checkout* directory.

The ``setup.py`` script has two main modes of operation:

``python setup.py develop``
    Bokeh will be installed to refer to your local source directory. Any changes
    you make to the Python source code will be available immediately without
    any additional steps. **This is the recommended mode when working on the
    Bokeh codebase.**

``python setup.py install``
    Bokeh will be installed in your local Python ``site-packages`` directory.
    In this mode, any changes to the Python source code will have no effect
    until you run ``setup.py install`` again.

Running either of those two commands also builds and installs a local version of
:term:`BokehJS`. If you want to skip building a new version of BokehJS and use a
different local version instead, use the ``--install-js`` flag:
``python setup.py develop --install-js``

.. note::
    You need to **rebuild BokehJS each time the BokehJS source code changes**.
    This can be necessary because you made changes yourself or because you
    pulled updated code from GitHub. Re-run ``python setup.py develop`` to build
    and install BokehJS.

    Occasionally, the **list of JavaScript dependencies also changes**. If this
    happens, you will need to re-run the instructions in the
    :ref:`contributor_guide_setup_installing_node_packages` section above before
    rebuilding BokehJS.

    In case you **update from a development environment based on Bokeh 2.3 or
    older**, you most likely also need to delete the ``bokehjs/build`` folder in
    your local environment before building and installing a fresh BokehJS.

.. _contributor_guide_setup_sample_data:

7. Download sample data
-----------------------

Several tests and examples require Bokeh's sample data to be available on your
hard drive. After :ref:`installing <contributor_guide_setup_install_locally>`
Bokeh, use the following command to download and install the data:

.. code-block:: sh

    bokeh sampledata

You also have the opportunity to configure the download location or to start the
download programmatically. See the :ref:`install_sampledata` section of the
first steps guides for more details.

.. _contributor_guide_setup_environment_variables:

8. Set environment variables
----------------------------

Bokeh uses :ref:`environment variables <userguide_settings>` to control several
aspects of how the different parts of the library operate and interact.

To learn about all environment variables available in Bokeh, see
:ref:`bokeh.settings` in the reference guide.

``BOKEH_RESOURCES``
~~~~~~~~~~~~~~~~~~~

When working on Bokeh's codebase, the most important environment variable to be
aware of is ``BOKEH_RESOURCES``. This variable controls which version of
:term:`BokehJS` to use.

By default, Bokeh downloads any necessary JavaScript code for BokehJS from a
Content Delivery Network (CDN). If you have modified any BokehJS code and built
BokehJS locally, you need to change how Bokeh loads those JavaScript resources.
You will not see any effects of your local changes to BokehJS unless you
configure Bokeh to use your local version of BokehJS instead of the default
version from the CDN.

You have the following three options to use your local version of BokehJS:

Use ``absolute-dev``
    Set ``BOKEH_RESOURCES`` to ``absolute-dev`` to load JavaScript resources
    from the static directory of your locally installed Bokeh library. This way,
    Bokeh will also use unminified BokehJS resources for improved readability.

    .. tabs::

        .. code-tab:: sh Linux/macOS

            export BOKEH_RESOURCES=absolute-dev

        .. code-tab:: PowerShell Windows (PS)

            $Env:BOKEH_RESOURCES = "absolute-dev"

        .. code-tab:: doscon Windows (CMD)

            set BOKEH_RESOURCES=absolute-dev

Use ``inline``
    Set ``BOKEH_RESOURCES`` to ``inline`` to include all necessary local
    JavaScript resources directly inside the generated HTML file.

    .. tabs::

        .. code-tab:: sh Linux/macOS

            export BOKEH_RESOURCES=inline

        .. code-tab:: PowerShell Windows (PS)

            $Env:BOKEH_RESOURCES = "inline"

        .. code-tab:: doscon Windows (CMD)

            set BOKEH_RESOURCES=inline

Use ``server-dev``
    Set ``BOKEH_RESOURCES`` to ``server-dev`` to load your local BokehJS through
    a Bokeh server.

    First, start a local server.

    .. tabs::

        .. code-tab:: sh Linux/macOS

            BOKEH_DEV=true bokeh static

        .. code-tab:: PowerShell Windows (PS)

            $Env:BOKEH_DEV = "true"
            bokeh static

        .. code-tab:: doscon Windows (CMD)

            set BOKEH_DEV=true
            bokeh static

    Next, open a new terminal window and set ``BOKEH_RESOURCES`` to
    ``server-dev``.

    .. tabs::

        .. code-tab:: sh Linux/macOS

            export BOKEH_RESOURCES=server-dev

        .. code-tab:: PowerShell Windows (PS)

            $Env:BOKEH_RESOURCES = "server-dev"

        .. code-tab:: doscon Windows (CMD)

            set BOKEH_RESOURCES=server-dev

    This way, you have access to more development functions, such as
    `source maps` to help debug the original TypeScript instead of the compiled
    JavaScript.

See :class:`~bokeh.resources.Resources` for more details.

``BOKEH_DEV``
~~~~~~~~~~~~~

There are several other environment variables that are helpful when working on
Bokeh's codebase. The most common settings for local development are combined in
the variable ``BOKEH_DEV``.

To enable development settings, set ``BOKEH_DEV`` to ``true``:

.. tabs::

    .. code-tab:: sh Linux/macOS

        export BOKEH_DEV=true

    .. code-tab:: PowerShell Windows (PS)

        $Env:BOKEH_DEV = "true"

    .. code-tab:: doscon Windows (CMD)

        set BOKEH_DEV=true

Setting ``BOKEH_DEV`` to ``true`` is equivalent to setting all of the following
variables individually:

- ``BOKEH_BROWSER=none``
- ``BOKEH_LOG_LEVEL=debug``
- ``BOKEH_MINIFIED=false``
- ``BOKEH_PRETTY=true``
- ``BOKEH_PY_LOG_LEVEL=debug``
- ``BOKEH_RESOURCES=absolute-dev``

This way, Bokeh will use local and unminified BokehJS resources, the default log
levels are increased, the generated HTML and JSON code will be more
human-readable, and Bokeh will not open a new browser window each time |show| is
called.

.. note::
    Setting ``BOKEH_DEV=true`` enables ``BOKEH_RESOURCES=absolute-dev``, which
    causes rendering problems when used with :term:`Bokeh server <Server>` or in
    :ref:`Jupyter notebooks <userguide_jupyter>`. To avoid those problems,
    use the following settings instead:

    * Set ``BOKEH_RESOURCES`` to ``server`` for server
    * Set ``BOKEH_RESOURCES`` to ``inline`` for notebooks

.. _contributor_guide_setup_test_setup:

9. Test your local setup
------------------------

Run the following tests to check that everything is installed and set up
correctly:


Test Bokeh core
~~~~~~~~~~~~~~~

First, use the following command to test the Bokeh installation:

.. code-block:: sh

    python -m bokeh info

You should see output similar to:

.. code-block:: sh

    Python version      :  3.9.7 | packaged by conda-forge | (default, Sep 29 2021, 19:20:46)
    IPython version     :  7.20.0
    Tornado version     :  6.1
    Bokeh version       :  3.0.0dev1+20.g6c394d579
    BokehJS static path :  /opt/anaconda/envs/test/lib/python3.9/site-packages/bokeh/server/static
    node.js version     :  v16.12.0
    npm version         :  7.24.2
    Operating system    :  Linux-5.11.0-40-generic-x86_64-with-glibc2.31

Run examples
~~~~~~~~~~~~

Next, run some of the standalone examples included with Bokeh.

Make sure the :ref:`environment variable <contributor_guide_setup_environment_variables>`
``BOKEH_RESOURCES`` is set to ``absolute-dev`` or ``inline`` in order to use
your local version of BokehJS. In the *source checkout* directory, run the
following command(s):

.. tabs::

    .. code-tab:: sh Linux/macOS

        BOKEH_RESOURCES=inline python examples/plotting/file/marker_map.py

    .. code-tab:: PowerShell Windows (PS)

        $Env:BOKEH_RESOURCES = "inline"
        python.exe .\examples\plotting\file\marker_map.py

    .. code-tab:: doscon Windows (CMD)

        set BOKEH_RESOURCES=inline
        python examples\plotting\file\marker_map.py

This creates a file ``marker_map.html`` locally. When you open this file in a web
browser, it should display this visualization:

.. image:: /_images/bokeh_marker_map_html.png
    :class: image-border
    :scale: 50 %
    :align: center

Run Bokeh Server
~~~~~~~~~~~~~~~~

Another way to use Bokeh is as a :term:`server <Server>`. Set the
:ref:`environment variable <contributor_guide_setup_environment_variables>`
``BOKEH_DEV=false`` and run the ``bokeh serve`` command in the *source
checkout* directory:

.. tabs::

    .. code-tab:: sh Linux/macOS

        BOKEH_DEV=false python -m bokeh serve --show examples/app/sliders.py

    .. code-tab:: PowerShell Windows (PS)

        $Env:BOKEH_DEV = "False"
        python.exe -m bokeh serve --show .\examples\app\sliders.py

    .. code-tab:: doscon Windows (CMD)

        set BOKEH_DEV=false
        python -m bokeh serve --show examples\app\sliders.py

This should open up a browser with an interactive figure:

.. image:: /_images/bokeh_app_sliders.png
    :class: image-border
    :align: center

All the sliders allow interactive control of the sine wave, with each update
redrawing the line with the new parameters. The ``--show`` option opens a
web browser. The default URL for the Bokeh server is ``localhost:5006``.

Troubleshooting
---------------

Updating an existing development environment does not always work as
expected. Make sure your
:ref:`conda environment <contributor_guide_setup_creating_conda_env>`,
:ref:`Node packages <contributor_guide_setup_installing_node_packages>`, and
:ref:`local build <contributor_guide_setup_install_locally>` are up to date.

If you keep getting errors after updating an older environment, use
``conda remove --name bkdev --all``, delete your local ``bokeh`` folder,
and reinstall your development environment, following the steps in this guide
from :ref:`the beginning <contributor_guide_setup_preliminaries>`.

For more information on running and installing Bokeh, check the
:ref:`additional resources available to contributors <contributor_guide_resources>`.
Please feel free to ask at the `Bokeh Discourse`_ or `Bokeh's contributor
Slack`_.

.. _Node.js: https://nodejs.org/en/
.. _Selenium: https://www.selenium.dev/
.. _Anaconda: https://www.anaconda.com/distribution/
.. _Bokeh's contributor Slack: https://slack-invite.bokeh.org/
.. _conda package manager: https://docs.conda.io/projects/conda/en/latest/
.. _Installation: https://conda.io/projects/conda/en/latest/user-guide/install/index.html
.. _Bokeh Discourse: https://discourse.bokeh.org/
.. _Git: https://git-scm.com
.. _Installing Git: https://git-scm.com/book/en/v2/Getting-Started-Installing-Git
.. _Pro Git Book: https://git-scm.com/book/en/v2
.. _Git documentation: https://git-scm.com/doc/ext
.. _@bokeh/dev team member: https://github.com/bokeh/bokeh/wiki/BEP-4:-Project-Roles#development-team
.. _GitHub: https://github.com
.. _Fork a repo: https://help.github.com/en/github/getting-started-with-github/fork-a-repo
.. _GitHub Help: https://help.github.com
.. _cloning a forked repository: https://docs.github.com/en/get-started/quickstart/fork-a-repo#cloning-your-forked-repository
.. _Managing environments: https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html
.. _Conda documentation: https://conda.io/projects/conda/en/latest/index.html
.. _npm: https://www.npmjs.com/
.. _pre-commit: https://pre-commit.com/
.. _Git hooks: https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks
.. _Flake8: https://flake8.pycqa.org/
.. _ESLint: https://eslint.org/
.. _isort: https://pycqa.github.io/isort/
.. _Bokeh's protected branches: https://github.com/bokeh/bokeh/wiki/BEP-6:-Branching-Strategy
.. _merge conflicts: https://git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging#_basic_merge_conflicts
.. _source maps: https://developer.mozilla.org/en-US/docs/Tools/Debugger/How_to/Use_a_source_map
.. _contributor_guide_documentation:

Writing documentation
=====================

The Bokeh documentation is an important resource for the entire Bokeh
community. It helps guide new users, and it is the definitive reference for
seasoned users and developers. That is why all contributions to Bokeh must
contain adequate documentation. It is also why we have set standards to ensure
that Bokeh's documentation remains easily accessible and up to date.

Just like Bokeh itself, the documentation is a community effort. And just like
Bokeh, the documentation is being adapted and improved all the time. In fact,
helping with the documentation is one of the most valuable ways to contribute
to Bokeh. It's also a good way to get started and introduce yourself as a new
contributor.

This section describes Bokeh's
:ref:`documentation style guidelines <contributor_guide_documentation_style_guidelines>`
for contributing to the documentation. This section also includes details on how
to :ref:`build <contributor_guide_documentation_build>` and
:ref:`edit <contributor_guide_documentation_edit>` the documentation in your local
development environment.

.. _contributor_guide_documentation_get_started:

Where to get started
--------------------

An easy way to start contributing to Bokeh's docs is to submit pull requests for
any typos or other small errors you might find in Bokeh's documentation. *This
is always appreciated!*

In addition to quick fixes, check the list of `open documentation issues`_ on
GitHub. This list contains several projects as a starting point.

.. _contributor_guide_documentation_style_guidelines:

Documentation style guidelines
------------------------------

Bokeh's documentation uses the `Google developer documentation style guide`_.

If your contribution includes substantial edits or additions, please
familiarize yourself with Google's style guide. A simple way to get started
is using Google's free `technical writing courses`_.

.. note::
  You will find that many parts of Bokeh's documentation do not yet follow
  these style guidelines. We are currently working on implementing these
  changes. However, we request that all documentation contributions follow
  the standards described in this document.

Principles of good style
~~~~~~~~~~~~~~~~~~~~~~~~

Follow these basic guidelines in all your writing for Bokeh:

* Be aware of **sentence length**. Try to avoid sentences that require more
  than two commas. Consider breaking up longer sentences. You could also use
  bulleted or numbered lists instead.
* Avoid jargon or uncommon words and phrases. Keep in mind that many users of
  Bokeh don't use English as their primary language.
* Use **active voice** instead of passive voice whenever possible.
* Address the reader in the **second person ('you')**. Avoid using the first
  person ('we') or the third person ('the user').
* Use **American English** spelling and grammar (refer to `Merriam-Webster`_ for
  consistent spelling).
* Use **sentence case for headlines** (capitalize words like in a regular
  sentence, but do not use any punctuation at the end).
* Use **serial commas**, also known as Oxford Commas.
* Write in a way that is inclusive_ and accessible_.
* Use a **spell checker** in your development environment.

Refer to the `Google developer documentation style guide`_ for more detailed
information.

Commonly used terms
~~~~~~~~~~~~~~~~~~~

These are some commonly used terms and phrases and their spellings used
throughout the narrative documentation:

.. csv-table::
   :header: "Term", "Details"
   :widths: 25, 75

   "Bokeh, BokehJS", "Always capitalize Bokeh and BokehJS"
   "JavaScript", "Capitalize both 'J' and 'S'"
   "Jupyter notebook", "Capitalize Jupyter, but not notebook"
   "pandas", "Don't capitalize `pandas`_"
   "Python", "Always capitalize Python (the language)"

For definitions and concepts used throughout Bokeh's documentation, see the
:ref:`userguide_glossary` in :ref:`userguide_concepts`.

In general, see the `word list of the Google developer documentation style
guide`_ for reference.

.. _contributor_guide_documentation_build:

Setting up and building Bokeh's documentation
---------------------------------------------

Bokeh uses :doc:`Sphinx <sphinx:contents>` to generate the HTML files displayed
at docs.bokeh.org_. The documentation is written in
:doc:`reStructuredText (ReST) <sphinx:usage/restructuredtext/index>`.

HTML is the only output format supported by Bokeh's documentation. Many pages
use dynamic content and rely heavily on JavaScript. Bokeh's documentation also
uses several :ref:`custom Sphinx extensions <bokeh.sphinxext>`.

1. Prepare your environment
~~~~~~~~~~~~~~~~~~~~~~~~~~~

To build the documentation, follow the instructions in :ref:`contributor_guide_setup`
and make sure you have activated the ``bkdev`` environment in your console:

.. code-block:: sh

    conda activate bkdev

Unless you have just installed or updated your conda environment, you should
make sure that all the packages are up to date. Run this command from the
root level of your *source checkout* directory to update ``bkdev``:

.. code-block:: sh

    conda env update --file environment.yml --prune

Some of the examples in the documentation require additional sample data. Use
this command to automatically download and install the
necessary data:

.. code-block:: sh

    bokeh sampledata

See :ref:`install_sampledata` for alternative instructions on how to
download the sample data.

2. Set environment variable
~~~~~~~~~~~~~~~~~~~~~~~~~~~

In order to build the documentation, you must set the
:ref:`environment variable <userguide_settings>` ``GOOGLE_API_KEY``. The
documentation includes some plots with maps, and a valid Google API key is
required to build those plots correctly. You have two options:

* Follow the instructions on the `Google developers website`_ to generate a new
  API key.

* Use a placeholder value like ``some_value`` instead of a valid API key. If
  you use a placeholder, some map plots in Bokeh's documentation might not be
  rendered correctly, but the documentation should otherwise be built correctly.
  This will only affect your local environment and should have no effect on any
  changes you might commit to the Bokeh repository.

After activating your conda environment, use the following command to set the
environment variable:

.. code-block:: sh

    conda env config vars set GOOGLE_API_KEY=some_value

Next, you have to reactivate your environment:

.. code-block:: sh

  conda deactivate
  conda activate bkdev

Using ``conda env config vars set`` makes this environment variable part of your
``bkdev`` environment. Whenever you activate your ``bkdev`` environment, conda
will now set this environment variable for you.

3. Build Bokeh's documentation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You can find all source files for Bokeh's documentation in the ``sphinx``
directory of the Bokeh source tree.

.. code-block:: sh

    cd sphinx

Sphinx uses the standard Unix ``make`` command to control the build process. For
Windows users, the ``sphinx`` directory includes the file ``make.bat``. Use this
Windows batch file instead of ``make``, which is usually only available on
Unix-based systems.

When building Bokeh's documentation, the most common options for ``make`` are:

* ``clean``: remove all previously built documentation output. All output files
  are generated from scratch on the next build.
* ``html``: build any HTML output that hasn't been built yet or needs to be
  rebuilt to include changes to the documentation source files.
* ``serve``: start a minimal web server and open a web browser to display the
  docs. Starting a server is necessary because large portions of the
  documentation require JavaScript files in the background.

To build the docs, run the following command:

.. tabs::

  .. code-tab:: sh Linux/macOS

      make html

  .. code-tab:: PowerShell Windows (PS)

      .\make.bat html

  .. code-tab:: doscon Windows (CMD)

      make.bat html

After building the docs, run the following command to start a server and display
the docs in a web browser:

.. tabs::

  .. code-tab:: sh Linux/macOS

      make serve

  .. code-tab:: PowerShell Windows (PS)

      .\make.bat serve

  .. code-tab:: doscon Windows (CMD)

      make.bat serve

**Linux/macOS only:** You can combine multiple targets in one command (not
supported by ``make.bat``). For example:

.. code-block:: sh

    make clean html serve

.. note::
    Documents that you build yourself in your local environment load the most
    recent version of :term:`BokehJS` from Bokeh's Content Delivery Network
    (CDN) by default. If you would like to use your local version of BokehJS
    instead, set the
    :ref:`environment variable <contributor_guide_setup_environment_variables>`
    ``BOKEH_DOCS_CDN`` to ``local`` before calling ``make``:

    .. tabs::

      .. code-tab:: sh Linux/macOS

          BOKEH_DOCS_CDN=local make clean html serve

      .. code-tab:: PowerShell Windows (PS)

          $Env:BOKEH_DOCS_CDN = "local"
          .\make.bat html
          .\make.bat serve

      .. code-tab:: doscon Windows (CMD)

          set BOKEH_DOCS_CDN=local
          make.bat html
          make.bat serve

To speed up the build of your local documentation, you have the option to use
an `experimental Sphinx feature`_ that distributes the build process over
several CPUs and cores. This only works on Linux and macOS (not on Windows). On
macOS, this feature only works on Python 3.7. To use this experimental feature,
add the option ``SPHINXOPTS="-j auto"`` to your build command:

.. code-block:: sh

    make clean html serve SPHINXOPTS="-j auto"

To learn more about options for the Sphinx build process, see
:doc:`sphinx:man/sphinx-build` in the Sphinx documentation.

.. _contributor_guide_documentation_edit:

Writing Bokeh's documentation
-----------------------------
The documentation available at docs.bokeh.org_ mainly consists of those two
elements:

:ref:`Narrative documentation <contributor_guide_documentation_edit_narrative>`
  This part of the documentation consists of tutorial-like descriptions and
  instructions for Bokeh. This includes the :ref:`user guide <userguide>` and
  :ref:`contributor guide <contributor_guide>`.

:ref:`Docstrings and Model help text within the Python source code of Bokeh <contributor_guide_documentation_edit_source>`
  This part of the documentation consists of detailed explanations of all Bokeh
  modules and their properties. These texts are available from the Python
  interpreter and within most Python development environments. Sphinx also uses
  those texts to generate the :ref:`reference guide <refguide>` section of
  Bokeh's documentation.

In the file :bokeh-tree:`sphinx/source/rst_epilog.txt`, you can find many common
substitutions used across the narrative documentation as well as docstrings and
model help texts. This file is loaded as the
:confval:`epilog.rst environment variable <sphinx:rst_epilog>` for Bokeh's
Sphinx configuration.

.. _contributor_guide_documentation_edit_narrative:

Writing for Bokeh's narrative documentation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Bokeh's narrative documentation consists of these four elements:

* :ref:`first_steps`: first steps guides and installation instructions
* :ref:`userguide`: descriptions and instructions for using Bokeh
* :ref:`gallery`: interactive examples with source code
* :ref:`Contributor guide <contributor_guide>`: instructions for contributing
  to Bokeh

Sphinx generates each of those elements from reStructuredText (.rst) files. To
edit any of those elements, open the corresponding ReST source file in the
``sphinx/source/docs`` folder of the Bokeh source tree.

For information on how to format text using reStructuredText, see the
:doc:`reStructuredText primer on the Sphinx website <sphinx:usage/restructuredtext/basics>`
or the `official reStructuredText website`_.

For information on writing style, see Bokeh's
:ref:`documentation style guidelines <contributor_guide_documentation_style_guidelines>`
and the `Google developer documentation style guide`_.

.. _contributor_guide_documentation_edit_source:

Contributing to Bokeh's source code documentation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
All functions and methods in Bokeh use
:ref:`docstrings <contributor_guide_documentation_edit_docstrings>`. In
addition, Bokeh uses its own system to provide
:ref:`detailed information on individual properties <contributor_guide_documentation_edit_properties_help>`.

.. _contributor_guide_documentation_edit_docstrings:

Writing docstrings
''''''''''''''''''

To automatically process Python docstrings, Bokeh uses an extension for Sphinx
called `Napoleon`_ with `Napoleon's Google style`_. For Napoleon to work
correctly, all docstrings you write need to follow the rules in the `Google
Python Style Guide`_.

Docstrings generally include these three elements:

* A short description of what the function does, starting with a verb. For
  example: "Create and return a new Foo."
* Args: list all parameters, if any.
* Returns: describe the return values of the function, even if the
  function returns ``None``.

For example:

.. code-block:: python

    def foo_function(name, level):
        ''' Creates and returns a new Foo.

        Args:
            name (str) :
                A name for the Foo

            level (int) :
                A level for the Foo to be configured for

        Returns:
            Foo
        '''

.. _contributor_guide_documentation_edit_properties_help:

Writing models and properties help
''''''''''''''''''''''''''''''''''

Bokeh's models use a custom system to provide documentation about individual
properties directly in the source code. You can add this kind of text to any
property type by including a ``help`` argument.

Any string passed as a ``help`` argument can be formatted using
:doc:`reStructuredText (ReST) <sphinx:usage/restructuredtext/index>`.

For example:

.. code-block:: python

    class DataRange(Range):
        ''' A base class for all data range types.

        '''

        names = List(String, help="""
        A list of names to query for. If set, only renderers that
        have a matching value for their ``name`` attribute will be used
        for autoranging.
        """)

        renderers = List(Instance(Renderer), help="""
        An explicit list of renderers to autorange against. If unset,
        defaults to all renderers on a plot.
        """)

.. note::
  `Release Notes`_ are generally handled by the Bokeh core team as part of
  Bokeh's `release management`_. Each release should add a new file under
  ``sphinx/source/docs/releases`` that briefly describes the changes in the
  release, including any migration notes. The filename should be
  ``<version>.rst``, for example ``sphinx/source/docs/releases/0.12.7.rst``.The
  Sphinx build will automatically add this content to the list of all releases.

.. _open documentation issues: https://github.com/bokeh/bokeh/issues?q=is%3Aopen+is%3Aissue+label%3A%22tag%3A+component%3A+docs%22
.. _Google developer documentation style guide: https://developers.google.com/style
.. _technical writing courses: https://developers.google.com/tech-writing
.. _pandas: https://pandas.pydata.org/about/citing.html
.. _Merriam-Webster: https://www.merriam-webster.com/
.. _inclusive: https://developers.google.com/style/inclusive-documentation
.. _accessible: https://developers.google.com/style/accessibility
.. _word list of the Google developer documentation style guide: https://developers.google.com/style/word-list
.. _docs.bokeh.org: https://docs.bokeh.org/en/latest/
.. _Google developers website: https://developers.google.com/maps/documentation/javascript/get-api-key
.. _Napoleon: http://sphinxcontrib-napoleon.readthedocs.org/en/latest/index.html
.. _Napoleon's Google style: https://sphinxcontrib-napoleon.readthedocs.io/en/latest/example_google.html#example-google
.. _Google Python Style Guide: https://google.github.io/styleguide/pyguide.html#383-functions-and-methods
.. _official reStructuredText website: https://docutils.sourceforge.io/rst.html
.. _experimental Sphinx feature: https://github.com/sphinx-doc/sphinx/issues/6881
.. _Release Notes: https://docs.bokeh.org/en/latest/docs/releases.html
.. _release management: https://github.com/bokeh/bokeh/wiki/BEP-2:-Release-Management
.. _contributor_guide_issues:

Creating issues
===============

Bug reports and feature requests in Bokeh's issue tracker are the foundation of
almost all improvements implemented in Bokeh. `Bokeh's issue tracker <issue tracker_>`_
is part of the Bokeh GitHub repository.

.. _contributor_guide_issues_before:

Before opening an issue
-----------------------

As a first step, you should always check
`Bokeh's GitHub issue tracker <issue tracker_>`_ and the
`Bokeh Discourse`_ for similar or identical issues. There are lots of issues,
and it's possible to miss duplicates even after searching. If a team member
closes your issue as a duplicate, you can always add your input and thoughts to
the linked issue.

It is also possible that the issue you want to report has already been resolved
in a newer version of Bokeh. Update Bokeh to the most recent stable version
available with `conda`_ or `pip`_ and try to reproduce the issue.

You can format any text you enter when filing an issue. To learn more about
your formatting options, see `Writing on GitHub`_ in the
`GitHub documentation`_.

.. _contributor_guide_issues_kinds:

Kinds of issues
---------------

Bokeh's issue tracker accepts two kinds of issues:

Bug report
    Please use this kind of issue to report anything that does not work as it
    should. This can be an unexpected error, a fault in the code, or a
    discrepancy between the documentation and the actual behavior of the code,
    for example.

Feature request
    Please use this kind of issue to propose a new feature or anything else that
    expands Bokeh's current capabilities.

When you `create a new issue`_, you can choose between creating these two types
of issues. When creating either type of issue, GitHub will present you with a
form. Please follow the instructions in those forms closely and provide
all necessary information.

.. note::
    The issue tracker is not the place for general support. For questions and
    technical assistance, visit the `Bokeh Discourse`_. When you are unsure,
    post a question to the Discourse first before opening an issue.

.. _contributor_guide_issues_kinds_bugs:

Reporting bugs
~~~~~~~~~~~~~~

To `file a new bug report`_, you should have the following information ready.
This will help with resolving your issue as quickly as possible:

Title
    Add a short, descriptive title for your bug report. The form field already
    contains ``[BUG]``, add your title after that.

Software version info
    To find the version of packages such as Bokeh, Python, IPython, and Node.js,
    use the following command in the environment where you have Bokeh installed:

    .. code-block:: sh

        bokeh info

    This provides you with a list of the versions of relevant software packages.
    Copy and paste this information into your bug report.

Issue details
    Describe the behavior you would have expected and the behavior you observed
    instead.

Complete, minimal, self-contained example code that reproduces the issue
    Provide a code example that follows the
    `definition of a minimal, reproducible example at stackoverflow.com`_.
    For more details, see `Craft Minimal Bug Reports at matthewrocklin.com`_.

Stack traceback and/or browser JavaScript console output
    Optionally, add any error messages or logs that might be helpful in
    reproducing and identifying the bug.

Screenshots or screencasts of the bug in action
    If possible, add additional information that might help understand what
    your bug report is about. This can be screenshots or `screencasts`_ that
    demonstrate the behavior you are filing an issues about, for example.

.. _contributor_guide_issues_kinds_feature:

Feature requests
~~~~~~~~~~~~~~~~

To `file a new feature request`_, you should have the following information
ready. This will help with reaching a decision on your proposed feature as
quickly as possible:

Title
    Add a short, descriptive title for your feature request. The form field
    already contains ``[FEATURE]``, add your title after that.

Description of the problem you'd like solved
    A clear and concise description of what problem you would like to solve with
    the suggested feature..

Description of the solution you'd like
    A clear and concise description of what you want to happen.

Description of alternatives you've considered
    A clear and concise description of any alternative solutions or features
    you've considered.

Additional context
    Add any additional information about your feature request. This can be
    screenshots or `screencasts`_ that illustrate the functionality you would
    like to see in Bokeh, for example.

.. _contributor_guide_issues_next:

Next steps
----------

When you create a new issue, GitHub will automatically add the label ``TRIAGE``.

Once you create an issue, a member of the `Bokeh core team`_ will review your
issue and update the label. This might also include requesting further
information from you. Reviewing issues is a time-consuming, manual process, so
be aware that it might take a while for your issue to be processed.

See the `section "Issues" in BEP 1: Issues and PRs management`_ for more
information about labels and the issue management process.

.. _issue tracker: https://github.com/bokeh/bokeh/issues
.. _Bokeh Discourse: https://discourse.bokeh.org/
.. _conda: https://anaconda.org/conda-forge/bokeh
.. _pip: https://pypi.org/project/bokeh/
.. _Writing on GitHub: https://docs.github.com/en/github/writing-on-github
.. _GitHub documentation: https://docs.github.com/en/get-started
.. _definition of a minimal, reproducible example at stackoverflow.com: https://stackoverflow.com/help/minimal-reproducible-example
.. _Craft Minimal Bug Reports at matthewrocklin.com: https://matthewrocklin.com/blog/work/2018/02/28/minimal-bug-reports
.. _create a new issue: https://github.com/bokeh/bokeh/issues/new/choose
.. _file a new bug report: https://github.com/bokeh/bokeh/issues/new?assignees=&labels=TRIAGE&template=bug_report.yml&title=%5BBUG%5D+
.. _screencasts: https://github.blog/2021-05-13-video-uploads-available-github/
.. _file a new feature request: https://github.com/bokeh/bokeh/issues/new?assignees=&labels=TRIAGE&template=feature_request.yml&title=%5BFEATURE%5D+
.. _Bokeh core team: https://github.com/bokeh/bokeh/wiki/BEP-4:-Project-Roles#core-team
.. _`section "Issues" in BEP 1: Issues and PRs management`: https://github.com/bokeh/bokeh/wiki/BEP-1:-Issues-and-PRs-management
.. _contributor_guide_models:

:orphan:

Models (moved)
==============

Content moved to :ref:`contributor_guide_python_models`
.. _devguide_envvars:

:orphan:

Environment variables (moved)
=============================

Content moved to :ref:`contributor_guide_setup_environment_variables`
:orphan:

.. _contributor_guide_debug_headless:

Debugging in headless Chrome
============================

Some of :ref:`Bokeh's JavaScript tests <contributor_guide_testing_local_javascript>`
include running fully automated tests with a headless version of Chrome. For
local testing and especially for running and updating specific tests, :ref:`run
these tests manually with Chrome's GUI
<contributor_guide_testing_local_javascript_devtools>`.

In most cases, the results of running tests locally with Chrome's GUI are the
same as running them in the CI with headless Chrome. However, there are rare
cases where headless and GUI Chrome generate different results. In this
situation, you can't use the GUI - instead, you need to debug BokehJS' code
directly in the headless browser.

.. note::
    The following instructions only apply to the rare cases where you actually
    need to debug specifically in the headless version of Chrome. In most cases,
    you should be able to debug BokehJS with the GUI version of Chrome. See
    :ref:`contributor_guide_testing_local_javascript_devtools` for instructions
    on debugging BokehJS with the GUI version of Chrome.

Follow these steps in case you need to debug directly in the headless version of
Chrome:

1. Use ``node test/devtools server`` to start a BokehJS devtools server.
2. Open another console and run ``node make test:run:headless``. This starts
   Chrome in headless mode preconfigured for the BokehJS testing setup.
3. Open a Chrome or Chromium web browser and enter the URL
   ``http://localhost:9222``
4. Click the ``about:blank`` link at the bottom of the page. You can ignore the
   rest of that page.
5. Clicking this link opens a remote devtools console. Use the navigation bar
   inside this console to use the :ref:`endpoints
   <contributor_guide_testing_local_javascript_devtools_endpoints>` you would
   usually use with Bokeh's devtools server in the GUI version of the browser.

.. image:: /_images/chrome_headless_debugging.png
    :class: image-border
    :alt: Screenshot of a Chromium web browser displaying controls for Bokeh's
          preconfigured version of headless Chrome.
    :align: center
    :width: 100%

See :ref:`contributor_guide_testing_local_javascript_devtools` for more
information on Bokeh's devtools server.
.. _contributor_guide_python:

Contributing Python code
========================

The Bokeh codebase combines code written in Python and :ref:`TypeScript
<contributor_guide_bokehjs>`. This chapter provides an overview of the most
important things to know when working on Bokeh's Python code.

.. _contributor_guide_python_style:

Code style
----------

Bokeh's Python code generally follows the `PEP8`_ standard. Some notable
exceptions include:

* for consistency, use double quotation marks for strings (``"string"``)
* don't write lines that are longer than 165 characters
* write `Google Python Style Guide`_ docstrings (see
  :ref:`contributor_guide_documentation_edit_docstrings` for more information)

Bokeh uses a combination of code quality tests for each :ref:`Pull Request
<contributor_guide_pull_requests>`. Relevant tests for Python code include
`Flake8`_ and `isort`_. Use the following command to run those codebase tests
locally:

.. code-block:: sh

    pytest tests/codebase

To learn more about running those tests on your system, see
:ref:`contributor_guide_testing_local_codebase`.

.. _contributor_guide_python_tests:

Tests
-----

All :ref:`Pull Requests <contributor_guide_pull_requests>` that add or update
code should include new or updated tests. See :ref:`contributor_guide_testing`
and :ref:`contributor_guide_writing_tests` for more information on testing,
including Python-specific tests.

.. _contributor_guide_python_organization:

Source code organization
------------------------

The Bokeh repository contains Bokeh's Python code as well as the JavaScript code
of :ref:`BokehJS <contributor_guide_bokehjs>`. These are the most relevant
folders containing Python code:

``bokeh/``
  The Python code for the Bokeh library itself is located in the
  :bokeh-tree:`bokeh` folder.

  Everything that comprises a Bokeh visualization (such as
  :ref:`tools <userguide_tools>`, :term:`glyphs <Glyph>`,
  :term:`widgets <Widget>`, or :ref:`ColumnDataSources <userguide_data_cds>`) is
  based on a Bokeh model. The Python code for all models is located in
  :bokeh-tree:`bokeh/models`. See :ref:`contributor_guide_python_models` below
  for more information on models.

  Other subdirectories in this folder include:

  * :bokeh-tree:`bokeh/plotting` contains Bokeh's :ref:`plotting interface
    <userguide_interfaces_plotting>`
  * :bokeh-tree:`bokeh/colors` contains code for handling
    :ref:`colors <userguide_styling_colors>`
  * :bokeh-tree:`bokeh/embed` contains code for :ref:`embedding Bokeh content
    in web pages <userguide_embed>`.
  * :bokeh-tree:`bokeh/io` contains code for Bokeh's IO functions, such as
    :ref:`file export <userguide_export>` and :ref:`notebook output
    <userguide_jupyter>`
  * :bokeh-tree:`bokeh/palettes` contains code for Bokeh's :ref:`palettes
    <bokeh.palettes>`
  * :bokeh-tree:`bokeh/sphinxext` contains code for custom Sphinx extension
    used in :ref:`Bokeh's documentation <contributor_guide_documentation>`

  See the |reference guide| for more information on the structure of this
  directory and its subdirectories.

``examples/``
  The :bokeh-tree:`examples` folder contains examples for most of Bokeh's
  functionalities. Some of those examples are used in Bokeh's :ref:`gallery
  <gallery>`.

``tests/``
  The :bokeh-tree:`tests` folder contains Bokeh's suite of tests. See
  :ref:`contributor_guide_testing` and :ref:`contributor_guide_writing_tests`
  for more information on testing.

``typings/``
  The :bokeh-tree:`typings` folder contains `stub files`_ for Bokeh's type
  hints.

.. _contributor_guide_python_models:

Models and properties
---------------------

The central building blocks of all Bokeh visualizations are objects based on
Bokeh's :term:`models <Model>`. These models are representations of
:term:`plot <Plot>` elements, such as :ref:`axes <userguide_styling_axes>`,
:term:`glyphs <Glyph>`, or :term:`widgets <Widget>`.

On the Python side, Bokeh serializes the attributes of each plot element object
into JSON data. On the browser side, BokehJS deserializes this JSON data and
creates JavaScript objects based on this information. :term:`BokehJS` then uses
these JavaScript objects to render the visualization.

.. image:: /_images/bokeh_bokehjs.svg
    :class: image-border
    :alt: Flowchart describing the flow of data from Python objects through JSON
          to the browser-side. There, the JSON data is converted into JavaScript
          objects which then get rendered as output. Output can be HTML Canvas,
          WebGL, or SVG.
    :align: center
    :width: 100%

Whenever you update or add models in Python, you need to also :ref:`update the
corresponding TypeScript code for BokehJS <contributor_guide_bokehjs>`.

All of Bokeh's Python models are located in :bokeh-tree:`bokeh/models` and its
subfolders. They all are subclasses of :class:`~bokeh.model.Model`:

.. code-block:: python

    class SomeNewModel(Model):
        """ Some new model. """

Models contain properties, which are class attributes defined in
:class:`bokeh.core.properties`. For example:

.. code-block:: python

    class ModelWithIntProps(Model):
        prop1 = Int()
        prop2 = Int(10)

In this example, the ``ModelWithIntProps`` model represents objects that have
two integer values, ``prop1`` and ``prop2``.

Bokeh uses a wide variety of property types:

* Primitive types like :class:`~bokeh.core.properties.Byte`,
  :class:`~bokeh.core.properties.Int`, :class:`~bokeh.core.properties.Float`,
  :class:`~bokeh.core.properties.Complex`, or
  :class:`~bokeh.core.properties.String`
* Container-like properties that take other properties as parameters, such as
  :class:`~bokeh.core.properties.List` (``List(Int)``) or
  :class:`~bokeh.core.properties.Dict` (``Dict(String, Double)``)
* Specialized types like :class:`~bokeh.core.properties.Instance`
  (``Instance(Plot)``), :class:`~bokeh.core.properties.Enum`
  (``Enum("foo", "bar", "baz")``), or :class:`~bokeh.core.properties.Either`
  (``Either(Int, String)``)

These property types have several purposes:

* :ref:`type checking <contributor_guide_python_typing>` the different models
* making sure that models remain compatible between Python and JavaScript
* automatically generating some basic documentation for the |reference guide|

An example of a more realistic model might look like this:

.. code-block:: python

    class SomeModel(Model):
        prop1 = Int(127)
        prop2 = Either(Int, List(Int), Dict(String, List(Int)))
        prop3 = Enum("x", "y", "z")
        prop4 = Range(Float, 0.0, 1.0)
        prop5 = List(Instance(Range1d))

See :ref:`bokeh.core.properties` for more details.

.. warning::
    The class :class:`~bokeh.core.properties.Any` is the super-type of all other
    types and will accept any type of value. Since this circumvents all type
    validation, make sure to use it sparingly, if at all.

.. _contributor_guide_python_typing:

Typing
------

Bokeh uses two systems for type checking Python code:

* For the :ref:`system of models described above
  <contributor_guide_python_models>`, Bokeh uses its own system of
  properties. See :ref:`contributor_guide_python_models` for more information.
* For any code not using models, Bokeh uses `PEP 484
  <https://www.python.org/dev/peps/pep-0484/>`_ style hints. Use the Python
  standard `typing` and `typing_extensions` modules if necessary.

:ref:`Bokeh's CI <contributor_guide_testing_ci>` uses `mypy`_ to check types.
To type check your code locally, run ``mypy bokeh``.

.. note::
    In case you want to use type information with tools other than mypy (such as
    extracting information with ``typing.get_type_hints``, for example), you
    will most likely need to use Python 3.10 or later. This is because some
    of Bokeh's type hints use the ``X | Y`` syntax for union types as defined in
    `PEP 604`_.

.. _PEP8: https://www.python.org/dev/peps/pep-0008/
.. _Google Python Style Guide: https://google.github.io/styleguide/pyguide.html#383-functions-and-methods
.. _Flake8: https://flake8.pycqa.org/
.. _isort: https://pycqa.github.io/isort/
.. _mypy: https://mypy.readthedocs.io
.. _stub files: https://www.python.org/dev/peps/pep-0484/#stub-files
.. _PEP 604: https://www.python.org/dev/peps/pep-0604/
.. _devguide_bindings:

:orphan:

Bindings (moved)
================

Content moved to :ref:`contributor_guide_bindings`
.. _contributor_guide_bokehjs:

Contributing to BokehJS
=======================

:term:`BokehJS` is the in-browser client-side runtime library that users of Bokeh
ultimately interact with. This library is written primarily in TypeScript
and is one of the unique things about the Bokeh plotting system.

The central building blocks of all Bokeh visualizations are objects based on
Bokeh's :term:`models <Model>`. These models are representations of
:term:`plot <Plot>` elements, such as axes, :term:`glyphs <Glyph>`, or
:term:`widgets <Widget>`.

On the Python side, Bokeh serializes the attributes of each plot element object
into JSON data. On the browser side, BokehJS deserializes this JSON data and
creates JavaScript objects based on this information. BokehJS then uses these
JavaScript objects to render the visualization.

.. image:: /_images/bokeh_bokehjs.svg
    :class: image-border
    :alt: Flowchart describing the flow of data from Python objects through JSON
          to the browser-side. There, the JSON data is converted into JavaScript
          objects which then get rendered as output. Output can be HTML Canvas,
          WebGL, or SVG.
    :align: center
    :width: 100%

This combination of Python and JavaScript allows you to define a visualization
in Python while taking advantage of all the interactivity offered by JavaScript
running in a browser. Additionally, this combination enables you to do almost
all data handling with Python and use large and streaming server-side data with
an interactive JavaScript visualization.

In addition to using BokehJS to create visualizations based on JSON data, you
can also use BokehJS as a standalone JavaScript library. See
:ref:`userguide_bokehjs` for more information on creating visualizations
directly with BokehJS.

.. _contributor_guide_bokehjs_source_location:

Source code location
--------------------

The Bokeh repository contains Bokeh's Python code as well as the JavaScript code
of BokehJS. The BokehJS source code is located in the :bokeh-tree:`bokehjs`
directory in this monorepo repository.

**All further instructions and shell commands assume that** ``bokehjs/`` **is
your current directory.**

.. tip::
  Set the working folder of your IDE to the ``bokehjs`` directory. This way,
  some of the tools within your IDE might work better with the BokehJS source
  code.

.. _contributor_guide_bokehjs_css:

CSS for BokehJS
---------------

The CSS definitions for BokehJS are contained in several ``.less`` files in the
:bokeh-tree:`bokehjs/src/less/` directory. All CSS classes for Bokeh DOM
elements are prefixed with ``bk-``. For example: ``.bk-plot`` or
``.bk-toolbar-button``.

.. _contributor_guide_bokehjs_development:
.. _contributor_guide_bokehjs_style_guide:

Code Style Guide
-----------------

BokehJS doesn't have an explicit style guide. Make sure to run ``node make
lint`` or ``node make lint --fix`` before committing to the Bokeh repository.
Also, review the surrounding code and try to be consistent with the existing
code.

Some guidelines and tips to keep in mind when working on BokehJS:

* Do not use ``for-in`` loops, especially unguarded by ``hasOwnProperty()`` Use
  ``for-of`` loop in combination with ``keys()``, ``values()`` and/or
  ``entries()`` from the ``core/util/object`` module instead.
* Use double quotes (``"string"``) for strings by default. Use single
  quotes in cases where they help you avoid escaping quotation marks
  (``case '"': return "&quot;"``).
* Use `template literals (template strings)`_ for multiline, tagged, and
  interpolated strings ( ```Bokeh ${Bokeh.version}``` ).

Always lint your BokehJS code with ESLint_: From the :bokeh-tree:`bokehjs`
directory, run ``node make lint`` to check your code. Run
``node make lint --fix`` to have ESLint fix some problems automatically. For
more details, see the rules defined in :bokeh-tree:`bokehjs/eslint.json`.

.. tip::
  If you use VSCode, you can use the following configuration for your workspace
  to use ESLint directly in the editor:

  .. code-block:: json

        "eslint.format.enable": true,
        "eslint.lintTask.enable": true,
        "eslint.debug": false,
        "eslint.quiet": false,
        "eslint.options": {
          "cache": true,
          "extensions": [".ts"],
          "overrideConfigFile": "./eslint.json"
        },
        "eslint.workingDirectories": [
          "./bokehjs"
        ]

  This requires the `ESLint extension for VSCode`_ and ESLint version 8 or above
  to be installed.

.. _contributor_guide_bokehjs_requirements:

Development requirements
------------------------

To build and test BokehJS locally, follow the instructions in
:ref:`contributor_guide_setup`. This way, all required packages
should be installed and configured on your system.

Developing BokehJS requires the following minimum versions:

* Node.js 14+
* npm 7.4+
* Chrome/Chromium browser 94+ or equivalent

Bokeh officially supports the following platforms for development and testing:

* Linux Ubuntu 20.04+ or equivalent
* Windows 10 (or Server 2019)
* MacOS 10.15

It is possible to work on BokehJS using different platforms and versions.
However, things might not work as intended, and some tests will not work.

.. _contributor_guide_bokehjs_building:

Building BokehJS
----------------

For building, BokehJS relies on a custom tool similar to gulp_. All
commands start with ``node make``.

Use ``node make help`` to list all available commands for the BokehJS build
system. These are the most common commands:

* ``node make build``: Builds the entire library, including the extensions
  compiler.
* ``node make dev``: Builds the library without the extensions compiler. This is
  faster than ``node make build`` but not suitable for production code or
  packaging.
* ``node make test``: Runs all BokehJS tests. To only run specific tests, see
  :ref:`contributor_guide_testing_local_javascript_selecting`.
* ``node make lint`` lint BokehJS with ESLint_. Run ``node make lint --fix`` to
  have ESLint fix some problems automatically.

``node make`` automatically runs ``npm install`` whenever ``package.json``
changes.

.. _contributor_guide_bokehjs_testing:

Testing
-------

The Bokeh repository contains several :ref:`test suites
<contributor_guide_testing>`. These tests help to make sure that BokehJS
functions consistently as its own library as well as in combination with all
other components of Bokeh.

To learn more about running tests for BokehJS locally, see
:ref:`contributor_guide_testing_local_javascript`.

To learn more about adding and updating tests for BokehJS, see
:ref:`contributor_guide_writing_tests_bokehjs`.

.. _contributor_guide_bokehjs_models_views:

Models and views in BokehJS
---------------------------

The fundamental building blocks of visualizations in BokehJS are models and
views:

Models
  A model is a data structure that may or may not have a visual representation.
  BokehJS' models and their properties match the :ref:`models and respective
  properties in Bokeh's Python code <contributor_guide_python_models>`. Bokeh
  uses :ref:`defaults tests <contributor_guide_testing_local_javascript_selecting>`
  to make sure that models stay compatible between Python and BokehJS.

Views
  A view defines the visual representation of a model. Any model that influences
  how things look in the browser requires a corresponding view.

For each model, the model definition and the corresponding view should be in the
same file in the :bokeh-tree:`bokehjs/models` directory.

.. tip::
  When updating or adding new models and views, look at how similar models and
  views are currently implemented.

Base classes for models and views
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

BokehJS models usually extend a base class. For example: the ``Axis`` model
extends ``GuideRenderer``, the ``Circle`` model extends ``XYGlyph``.

The model's corresponding view extends a corresponding base view class. For
example: ``AxisView`` extends ``GuideRendererView``, ``CircleView``
extends ``XYGlyphView``.

Suppose you want to define a new type of :ref:`action button tool for the Bokeh
tool bar <userguide_tools_actions>`, called ``NewActionTool``. The model for
your new button would inherit from ``ActionTool``, and its corresponding view
would inherit from ``ActionToolView``:

.. code-block:: typescript

  import {ActionTool, ActionToolView} from "./action_tool"

Models
~~~~~~

BokehJS models require a ``namespace`` and ``interface``. At a minimum, this
includes ``Attrs`` and ``Props``. There are also more properties you can use,
like ``Mixins`` or ``Visuals``.

.. code-block:: typescript

  export namespace NewActionTool {
    export type Attrs = p.AttrsOf<Props>

    export type Props = ActionTool.Props & {
      some_property: p.Property<number>
      some_other_property: p.Property<string>
    }
  }

  export interface NewActionTool extends NewActionTool.Attrs {}

If you want to update a model, the most relevant property in most cases is
``Props``. The properties you define there need to match the properties and
types of the respective Python model. The BokehJS properties are defined in
``core.properties`` and are usually imported with
``import * as p from "core/properties"``.

Next, define the actual model itself. The model extends the respective
``BaseModel`` base class. If your model includes a view, this is also where you
link model and view.

.. code-block:: typescript

  export class NewActionTool extends ActionTool {
    properties: NewActionTool.Props
    // only when a view is required:
    __view_type__: NewActionToolView

    // do not remove this constructor, or you won't be
    // able to use `new NewActionTool({some_property: 1})`
    // this constructor
    constructor(attrs?: Partial<NewActionTool.Attrs>) {
      super(attrs)
    }

    static {
      this.prototype.default_view = NewActionToolView

      this.define<NewActionTool.Props>(({Number, String}) => ({
        some_property: [ Number, 0 ],
        some_other_property: [ String, "Default String" ],
        ...
        // add more property definitions and defaults
        // use properties from lib/core/property and primitives from lib/core/kinds
        // does have to match Python, both type and default value (and nullability)
      }))
    }
  }

Views
~~~~~

If your model requires display-related logic, you need to define a view. A view
generally handles how a model is displayed in the browser.

Views extend the respective ``BaseView`` base class.

.. code-block:: typescript

    export class NewActionToolView extends ActionToolView {
      override model: NewActionToolView

      initialize(): void {
        super.initialize()
        // perform view initialization (remove if not needed)
      }

      async lazy_initialize(): Promise<void> {
        await super.lazy_initialize()
        // perform view lazy initialization (remove if not needed)
      }

      ...
    }

.. _gulp: https://gulpjs.com/
.. _ESLint: https://eslint.org/
.. _JSFiddle: http://jsfiddle.net/
.. _GitHub_Actions: https://github.com/bokeh/bokeh/actions?query=workflow%3ABokehJS-CI
.. _ESLint extension for VSCode: https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint
.. _template literals (template strings): https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals
.. _contributor_guide_server:

Understanding Bokeh server
==========================

This chapter is a "deep dive" into Bokeh server's internals. It assumes you're
already familiar with the information on Bokeh server in :ref:`userguide_server`.

You might want to read this if you are:

- trying to work on the Bokeh codebase
- writing your own custom server process to use rather than ``bokeh serve``

A custom server process can add additional routes (web pages or
REST endpoints) using Tornado's web framework.

If an application developer uses ``bokeh serve``, they typically should not need
to import from ``bokeh.server`` at all. An application developer would only use
the ``Server`` class if it is doing something specialized, such as a custom
or embedded server process.

Applications, sessions, and connections
---------------------------------------

Each server contains one or more applications; you can think of an application
as a session template, or a factory for sessions. Sessions have a 1-1
relationship with instances of |Document|: each session has a document instance.
When a browser connects to the server, it gets a new session; the application
fills in the session's document with whatever plots, widgets, or other content
it desires. The application can also set up callbacks, to run periodically or to
run when the document changes.

Applications are represented by the ``Application`` class. This class
contains a list of ``Handler`` instances and optional metadata. Handlers
can be created in lots of ways: from JSON files, from Python functions, from
Python files, and perhaps many more ways in the future. The optional metadata
is available as a JSON blob via the ``/metadata`` endpoint. For example,
creating a ``Application`` instance with::

    Application(metadata=dict(hi="hi", there="there"))

will have ``http://server/myapp/metadata`` return (``application/json``)::

  {
      "data": {
          "hi": "hi",
          "there": "there"
      },
      "url": "/myapp"
  }

Around each application, the server creates an ``ApplicationContext``. Its
primary role is to hold the set of sessions for the application.

Sessions are represented by the class ``ServerSession``.

Each application has a route (called an ``app_path`` in the client
API), and each session has an ID. The combination of the two
specifies a ``Document`` instance (the server looks up the
application by path, and then looks up the session by ID).

Each session has 0-N connections, represented by the ``ServerConnection``
class. Connections are websocket connections. In general, sessions last as
long as they have connections, though they only expire after a timeout (to
allow for page reloads and the like).

Applications and application handlers cannot access the ``Server``
``ServerSession``, or ``ApplicationContext`` directly; they have a much more
limited interface defined in two pieces, ``ServerContext``  and
``SessionContext``. ``ServerContext`` presents a limited interface to some
aspects of ``ApplicationContext`` and ``Server``, while ``SessionContext``
presents a limited interface to some aspects of ``ServerSession``. Concrete
implementations of these interfaces are ``BokehServerContext`` and
``BokehSessionContext``.

Summarizing the object graph:

- ``Server`` implemented by ``BokehTornado``

 - has N ``ApplicationContext``

  - has 1 ``Application`` capable of creating new sessions
  - has 1 path used to identify it in URLs
  - has 1 ``ServerContext`` representing the aspects of
    the server visible to application code
  - has N ``ServerSession``

   - has 1 session ID which is a string naming the session
   - has 1 ``Document`` representing the session state
   - has N ``ServerConnection`` representing websockets
     attached to the session
   - has 1 ``SessionContext`` representing the aspects of
     the session visible to application code

Tornado ``IOLoop`` and Async Code
---------------------------------

To work on the server, you'll need an understanding of Tornado's
``IOLoop`` and the ``tornado.gen`` module.

The Tornado documentation will be the best resource, but here are
some quick things to know:

- The Bokeh server is single-threaded, so it's important not to
  write "blocking" code, meaning code that uses up the single
  thread while it waits for IO or performs a long computation. If
  you do this, you'll rapidly increase the latency seen by users
  of your application. For example, if you block for 100ms every
  time someone moves a slider, and ten users are doing this at
  once, users could easily see 10*100ms=1s of lag with only
  ten users.
- In Tornado, non-blocking code is implemented with Python native
  coroutrines, i.e. ``async def``.
- When no code is running, Tornado waits in its ``IOLoop``
  (sometimes called a "main loop" or "event loop"), which means
  it's waiting for something to happen. When something happens,
  ``IOLoop`` executes any callbacks that were interested in that
  event.

Applications and the ``IOLoop``
-------------------------------

We don't want applications to touch the Tornado ``IOLoop``
directly to add callbacks, because when a session expires or an
application is reloaded, we need the ability to remove all
callbacks belonging to a session or application.

To enable this, applications should only add callbacks using the
APIs on ``Document`` and ``ServerContext``. Methods on those
classes allow applications to ``add_periodic_callback``,
``add_timeout_callback``, and ``add_next_tick_callback``. We
intercept these callback additions and are able to remove them
when we unload an application or destroy a session.

Lifecycle
---------

If you look at the ``Application`` class, there are two ways the
server can call into it.

1. the ``modify_document()`` method which does just what it says: it
   passes in the session's ``Document`` and allows the application
   to modify it (perhaps adding some plots and widgets).
2. a set of "hooks" ``on_server_loaded()``, ``on_server_unloaded()``,
   ``on_session_created()``, ``on_session_destroyed()``.

The "hooks" are called "lifecycle hooks" since they happen at
defined points in the lifetime of an application and a session.

Here are the steps in the lifecycle:

1. When the server process starts up, it calls
   ``on_server_loaded()`` on each application.
2. When a client connects with a previously-unused session ID, the
   server creates a ``ServerSession`` and calls
   ``on_session_created()`` with an empty ``Document``, then
   ``modify_document()`` to initialize the ``Document``. The
   ``on_session_created()`` can also initialize part of the
   ``Document`` if it likes. ``on_session_created()`` happens before
   ``modify_document()``.
3. When there are no connections to a session, it will eventually
   time out, and ``on_session_destroyed()`` will be called.
4. If the server process shuts down cleanly, it will call
   ``on_server_unloaded()`` on each application. This is probably
   rare in production: it's typical for server processes to be
   killed by a signal.  ``on_server_unloaded()`` may be more useful
   during development so that apps can be reloaded without leaking
   resources.

These hooks can add periodic or one-shot callbacks to the
``ServerContext``. These callbacks may be asynchronous (using
Tornado's async IO facilities) and are able to update all live
session documents.

**Critical consideration when using ``on_server_loaded()``**:
Process-global is NOT the same as cluster-global. If you scale a
Bokeh application, you'll want a separate process for each CPU
core, roughly. Processes in a cluster may not even be on the same
machine. A server process can never assume that it knows about
"all sessions that exist," only "all sessions hosted in this
process."

Details of ``ServerSession``
----------------------------

The session object handles most interaction between the client and
the server.

Locking
^^^^^^^

The trickiest aspect of ``ServerSession`` may be locking. In general, we
want one callback or one websocket request to be processed at a time; we
don't want to interleave them, because it would be difficult to implement
callbacks and request handlers if they had to worry about interleaving.

So ``ServerSession`` does one thing at a time, controlled by
``ServerSession._lock``, which is a Tornado lock.

If you're familiar with locking and threads, the situation here is conceptually
identical; but race conditions can only happen at "yield points" (when we
return to the ``IOLoop``) rather than at any point, and the lock is a Tornado
lock rather than a thread lock.

The rule is: *to touch* ``ServerSession.document`` *code must
hold* ``ServerSession._lock``.

For callbacks added through the ``Document`` API, we automatically
acquire the lock on the callback's behalf before we execute the
callback, and release it afterward.

Callbacks added through the ``ServerContext`` API, can only obtain
a reference to the session document using ``SessionContext.with_locked_document()``.
It executes a provided function with
the document lock held, passing the document to that function.

.. warning::
  It is very easy to modify the server code in such a way that you're
  touching the document without holding the lock. If you do this, things will
  break in subtle and painful-to-debug ways. When you touch the session document,
  triple-check that the lock is held.

Session security
^^^^^^^^^^^^^^^^

We rely on session IDs being cryptographically random and difficult to guess.
If an attacker knows someone's session ID, they can eavesdrop on or modify
the session. If you're writing a larger web app with a Bokeh app embedded
inside, this may affect how you design your larger app.

Session timeout
^^^^^^^^^^^^^^^^

To avoid resource exhaustion, unused sessions will time out according to code
in ``application_context.py``

Websocket protocol
------------------

The server has a websocket connection open to each client (each browser tab,
in typical usage). The primary role of the websocket is to keep the session's
``Document`` in sync between the client and the server.

There are two client implementations in the Bokeh codebase: one is a Python
``ClientSession``, the other is a JavaScript ``ClientSession``.
Client and server sessions are mostly symmetrical. On both sides, we are
receiving change notifications from the other side's ``Document``, and sending
notification of changes made on our side. In this way, the two ``Document``
are kept in sync.

The Python implementation of the websocket protocol can be found in
``bokeh.server.protocol``, though both the client side and the server side
use it.

Websockets already implement "frames" for us, and they guarantee frames will
arrive in the same order they were sent. Frames are strings or byte arrays
(or special internal frame types, such as pings). A websocket looks like
two sequences of frames, one sequence in each direction ("full duplex").

On top of websocket frames, we implement our own ``Message`` concept. A Bokeh
``Message`` spans multiple websocket frames. It always contains a header frame,
metadata frame, and content frame. These three frames each contain a JSON
string. The code permits these three frames to be followed by optional binary data
frames. In principle, this could allow, for example, for sending NumPy arrays
directly from their memory buffers to the websocket with no additional copies.
However, the binary data frames are not yet used in Bokeh.

The header frame indicates the message type and gives messages an ID. Message
IDs are used to match replies with requests (the reply contains a field saying
"I am the reply to the request with ID xyz").

The metadata frame has nothing in it for now but could be used for debugging
data or for another purpose in the future.

The content frame has the "body" of the message.

There aren't many messages right now. A quick overview:

- ``ACK`` is used for an initial handshake when setting up the connection
- ``OK`` is a generic reply when a request doesn't require any
  more specific reply
- ``ERROR``  is a generic error reply when something goes wrong
- ``SERVER-INFO-REQ`` and ``SERVER-INFO-REPLY`` are a
  request-reply pair where the reply contains information about
  the server, such as its Bokeh version
- ``PULL-DOC-REQ`` asks to get the entire contents of the
  session's ``Document`` as JSON, and ``PULL-DOC-REPLY`` is the
  reply containing said JSON.
- ``PUSH-DOC`` sends the entire contents of the session's
  ``Document`` as JSON, and the other side should replace its
  document with these new contents.
- ``PATCH-DOC`` sends changes to the session's document to the
  other side

Typically, when opening a connection, one side will pull or push
the entire document; after the initial pull or push, the two sides
stay in sync using ``PATCH-DOC`` messages.

Some current protocol caveats
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

1. In the current protocol, conflicts where both sides change the
   same thing at the same time are not handled (the two sides can
   end up out-of-sync if this happens, because the two
   ``PATCH-DOC`` are in flight at the same time). It's easy to
   devise a scheme to detect this situation, but it's less clear
   what to do when it's detected, so right now, we don't detect it
   and do nothing. In most cases, applications should avoid this
   situation because even if we could make sense of it and handle
   it somehow, it would probably be inefficient for the two sides
   of the app to "fight" over the same value. (If real-world
   applications trip on this issue, we will have to figure out
   what they're trying to do and devise a solution.)

2. At the moment, we are not smart about patching collections; if
   there's a ``Model`` property that's a giant dictionary, we'll
   send the whole giant dictionary whenever any entry in it
   changes.

HTTP endpoints
--------------

The server only supports a few HTTP routes; you can find them in
``bokeh.server.urls``.

In brief:

- ``/static/`` serves Bokeh's JS and CSS resources
- ``/app_path/`` serves a page that displays a new session
- ``/app_path/ws`` is the websocket connection URL
- ``/app_path/autoload.js`` serves a chunk of JavaScript that
  backs the ``bokeh.embed.server_document()`` and ``bokeh.embed.server_session()``
  functionality

Bokeh server isn't intended to be a general-purpose web framework. You can,
however, pass new endpoints to ``Server`` using the ``extra_patterns`` parameter
and the Tornado APIs.

Additional details
------------------

Events
^^^^^^

In general, whenever a model property is modified, the new value is
first validated, and the ``Document`` is notified of the change. Just
as models may have ``on_change`` callbacks, so can a
``Document``. When a ``Document`` is notified of a change to one of
its models, it will generate the appropriate event (usually a
``ModelChangedEvent``) and trigger the ``on_change`` callbacks,
passing them this new event. Sessions are one such callback, which
will turn the event into a patch that can be sent across the web
socket connection. When a message is received by the client or server
session, it will extract the patch and apply it directly to the
``Document``.

In order to avoid events bouncing back and forth between client and
server (as each patch would generate new events, which would in turn
be sent back), the session informs the ``Document`` that it was
responsible for generating the patch and any subsequent events that
are generated. In this way, when a ``Session`` is notified of a change
to the document, it can check whether the ``event.setter`` is identical
with itself and therefore skip processing the event.

Serialization
^^^^^^^^^^^^^

In general, all the concepts above are agnostic as to how precisely the
models and change events are encoded and decoded. Each model and its
properties are responsible for converting their values to a JSON-like
format, which can be sent across the websocket connection. One
difficulty here is that one model can reference other models, often in
highly interconnected and even circular ways. Therefore, during the
conversion to a JSON-like format, all references by one model to other
models are replaced with ID references. Additionally, models and
properties can define special serialization behavior. One such
example is the ``ColumnData`` property on a ``ColumnDataSource``,
which will convert NumPy arrays to a base64 encoded representation,
which is significantly more efficient than sending numeric arrays in a
string-based format. The ``ColumnData`` property
``serializable_value`` method applies this encoding, and the from_json
method will convert the data back. Equivalently, the JS-based
``ColumnDataSource`` knows how to interpret the base64 encoded data
and converts it to JavaScript typed arrays, and its
``attributes_as_json`` methods also knows how to encode the data. In
this way, models can implement optimized serialization formats.


Testing
-------

To test client-server functionality, use the utilities in
``bokeh.server.tests.utils``.

Using ``ManagedServerLoop``, you can start up a server instance
in-process. Share ``server.io_loop`` with a client, and you can
test any aspect of the server. Check out the existing tests for
lots of examples. Anytime you add a new websocket message or HTTP
endpoint, be sure to add tests!
.. _contributor_guide_testing:

Running tests
=============

Bokeh is a large, multi-language project and relies on complex and
comprehensive tests and testing tools to help ensure consistency and
prevent regressions.

This chapter describes how to run various tests in a
:ref:`local development environment <contributor_guide_testing_local>` and in
:ref:`Bokeh's continuous integration (CI) system on GitHub
<contributor_guide_testing_ci>`.

.. _contributor_guide_testing_local:

Local testing
-------------

Almost all of Bokeh's tests can be run locally. However, some of the tests can
be complex to set up and run correctly on a local system. Therefore, all tests
will run in :ref:`Bokeh's CI <contributor_guide_testing_ci>` when you
:ref:`create a Pull Request <contributor_guide_pull_requests>` on Bokeh's GitHub
repository. **You don't need to set up and run all tests locally**.

Follow those general guidelines to decide which tests to run locally:

Whenever you change anything in Bokeh's codebase
    Run Bokeh's :ref:`codebase tests <contributor_guide_testing_local_codebase>`

When you edit Bokeh's Python code
    Run Bokeh's :ref:`Python unit tests
    <contributor_guide_testing_local_python_unit>`

When your work involves UI elements
    Run Bokeh's :ref:`Python integration tests
    <contributor_guide_testing_local_python_unit>`

When your change anything related to BokehJS
    Run Bokeh's :ref:`JavaScript tests
    <contributor_guide_testing_local_javascript_all>`

For reference, this section provides an overview of all available tests and how
to run them locally on most systems. Generally, it makes the most sense to
**only run specific tests related to what you are working on**. See
:ref:`Select specific tests <contributor_guide_testing_local_python_select>` for
instructions on how to select and deselect specific Python tests. See
:ref:`Select specific BokehJS tests
<contributor_guide_testing_local_javascript_selecting>` for instructions on how
to select and deselect specific :term:`BokehJS` tests.

Check basic requirements
~~~~~~~~~~~~~~~~~~~~~~~~

Before attempting to run Bokeh tests locally, make sure you have successfully
completed all of the steps in the :ref:`contributor_guide_setup` section of this
contributor guide.

Check that :ref:`Bokeh's sampledata <install_sampledata>` is installed and up to
date by running ``bokeh sampledata``. In case you are not able to install the
sampledata on your system, you have the option to
:ref:`disable those specific tests <contributor_guide_testing_local_python_select>`.

Several tests also require `Selenium`_ and a corresponding `web driver`_ to be
available on your system. While it is possible to use other web drivers for some
tests, the recommended setup is to use Selenium with `ChromeDriver`_ and
`Chrome`_. See :ref:`userguide_export_dependencies` for
installation instructions and more information. In case Selenium is not
available on your system, you have the option to
:ref:`disable those specific tests <contributor_guide_testing_local_python_select>`.

On some Unix platforms, you may also need to increase the "maximum
number of open file descriptors". Some tests open many files when testing the
server, so this number should be at least 1024.

.. code-block:: sh

    ulimit -n 1024

.. _contributor_guide_testing_local_codebase:

Run codebase tests
~~~~~~~~~~~~~~~~~~

The most basic set of tests are Bokeh's codebase tests. This includes
checking Python code with `flake8`_, checking JavaScript code with `ESLint`_,
and various other tests for issues such as unused imports and extra white
spaces.

Any edits you make to Bokeh's Python or JavaScript codebase should pass this
test.

Run this command from the top level of the repository:

.. code-block:: sh

    pytest tests/codebase

.. _contributor_guide_testing_local_python:

Run Python tests
~~~~~~~~~~~~~~~~

Bokeh includes a number of tests that are focused on Bokeh's Python code.
These tests use `pytest`_ and are located in the :bokeh-tree:`tests` folder.

Whenever you work with Bokeh's Python code, you should run Bokeh's
:ref:`codebase <contributor_guide_testing_local_codebase>` and
:ref:`Python unit tests <contributor_guide_testing_local_python_unit>`. In case
your work also included changes to user interface elements, you should also run
Bokeh's :ref:`Python integration tests
<contributor_guide_testing_local_python_integration>`.

These are some command-line arguments for ``pytest`` that are helpful to know
when working with Bokeh's pytest-based tests:

* ``-k``: Provide a search string to filter for specific tests. See
  :ref:`Select specific tests <contributor_guide_testing_local_python_select>`.
* ``-m``: Select or deselect specific tests based on markers. See
  :ref:`Select specific tests <contributor_guide_testing_local_python_select>`.
* ``-n``: Distribute testing over several CPUs or cores. Provide a number to
  define the number of cores to use. Set to ``auto`` to use all available cores.
  For example: ``pytest -n 4 tests/codebase``. See `pytest-xdist`_.
* ``-v``: Run test with more verbose output.
* ``--driver``: Use a specific web driver for Selenium-based tests
  (``"chrome"``, ``"firefox"``, or ``"safari"``). For example:
  ``pytest --driver="firefox" tests/integration/``.
* ``--no-js``: Skip any JavaScript code and only test Python code.

See the `pytest documentation`_ for more options.

.. _contributor_guide_testing_local_python_unit:

Unit tests
    To run Bokeh's Python unit tests, use the following command at the top
    level of the repository:

    .. code-block:: sh

        pytest -m "not selenium" tests/unit

    .. note::
        This command will exclude unit tests that require `Selenium`_. Because
        Selenium can be difficult to set up and because some unit tests require
        both `geckodriver`_ and `ChromeDriver`_ to be available on your system,
        using ``-m "not selenium"`` is the recommended way to run unit tests
        locally. Once you :ref:`create a Pull Request
        <contributor_guide_pull_requests>`, :ref:`Bokeh's CI
        <contributor_guide_testing_ci>` will run all tests, including
        Selenium-based unit tests. In case Selenium with both geckodriver and
        ChromeDriver is available on your system, you can run all unit tests
        with ``pytest tests/unit``.

.. _contributor_guide_testing_local_python_coverage:

Code coverage (Python unit tests)
    To create a coverage report for Python unit tests, use ``pytest`` with the
    command-line options ``--cov=bokeh`` and ``--cov-config=tests/.coveragerc``:

    .. code-block:: sh

        pytest --cov=bokeh --cov-config=tests/.coveragerc

    Coverage with Bokeh's Python unit tests should be around 90%. Coverage
    reports are only relevant for Python unit tests. There are no coverage
    reports for other Python tests or for any of the JavaScript code of BokehJS.

    You also have the option to add
    ``--cov=bokeh --cov-config=tests/.coveragerc`` when running a specific
    subset of Python unit tests. This adds a coverage report to the test
    results. For example:

    .. code-block:: sh

        pytest --cov=bokeh --cov-config=tests/.coveragerc -m "not selenium" tests/unit/bokeh/test_objects.py

    .. seealso::
        Coverage reports use the pytest plugin `pytest-cov`_. For more
        information, see the `documentation for pytest-cov`_.

.. _contributor_guide_testing_local_python_integration:

Integration tests
    To run Bokeh's Python-focused integration tests, use this command from the
    top level of the repository:

    .. code-block:: sh

        pytest tests/integration

    These tests mostly simulate UI interactions. Therefore, they require
    `Chrome`_ or `Chromium`_ and `Selenium`_ with the `ChromeDriver`_ web
    driver.

Run all available tests
    You can run all available tests (Python and JavaScript unit tests, examples,
    and integration tests) by running the following command from the top-level
    directory:

    .. code-block:: sh

        pytest

.. _contributor_guide_testing_local_python_select:

Select specific tests
    To test a subset of the Bokeh package, pass a path to ``pytest``:

    .. code-block:: sh

        pytest tests/unit/bokeh/models/

    Similarly, you can run a specific test by passing a specific file to
    ``pytest``:

    .. code-block:: sh

        pytest tests/unit/bokeh/models/test_grids.py

    Another way to select or deselect specific tests is to use markers.
    Currently, Bokeh's tests use the following two markers:

    * ``sampledata``: a test that requires ``bokeh.sampledata`` to be downloaded
    * ``selenium``: a test that requires selenium

    For more information on setting your own markers, see
    `Working with custom markers`_ in the `pytest documentation`_. To learn more
    about pytest's various options to select specific tests, see
    `Specifying which tests to run`_.

.. seealso::
    For information on adding and updating Python tests, see
    :ref:`contributor_guide_writing_tests_python`.

.. _contributor_guide_testing_local_javascript:

Run JavaScript tests
~~~~~~~~~~~~~~~~~~~~

Most of the JavaScript-based tests for :term:`BokehJS` use a custom-made testing
framework. This framework **requires Google Chrome or Chromium**. You need a
recent version of one of these browsers available on your system to run those
tests locally.

.. _contributor_guide_testing_local_javascript_all:

Run all BokehJS tests
'''''''''''''''''''''

You can use ``pytest`` to run all available tests for BokehJS:

.. code-block:: sh

    pytest tests/test_bokehjs.py

This is a shortcut to run all BokehJS tests. You can run the same set of tests
directly with ``node make``, from the `bokehjs` subdirectory
of the source checkout:

.. code-block:: sh

    node make test

This runs a combination of codebase, defaults, unit, and integration test
suites.

.. _contributor_guide_testing_local_javascript_selecting:

Select specific BokehJS tests
'''''''''''''''''''''''''''''

You also have the option to run these test suites individually, using
``node make test:suite_name`` in the `bokehjs` subdirectory of the source
checkout:

* ``node make test:codebase``: Codebase tests checking file size limits
* ``node make test:defaults``: Tests checking whether the defaults in Bokeh’s
  Python models match those of Bokeh’s JavaScript models
* ``node make test:unit``: Unit tests for BokehJS
* ``node make test:integration``: Visual integration tests comparing locally
  generated plots against a set of baseline files

You can combine the last two test suites by running ``node make test:lib``.

Additionally, you can use search strings to select individual tests or groups
of tests. Use the ``-k`` argument to supply your search string. The search
string is case-sensitive. The BokehJS testing framework tries to match your
search string to the strings defined in the tests' ``describe()`` and
``it()`` functions. For example:

.. code-block:: sh

    $ node make test:integration -k "Legend"

This will only run integration tests that contain the string "Legend".

.. note::
    BokehJS Unit and integration tests require a recent version of Chrome or
    Chromium. The BokehJS testing framework starts the browser automatically
    with the right settings to produce consistent test results.

.. _contributor_guide_testing_local_javascript_devtools:

Testing with devtools server
''''''''''''''''''''''''''''

In addition to running BokehJS tests from the command-line, you can also use
the BokehJS devtools server. This system requires the Chrome web browser to be
available on your system. Use the BokehJS devtools server to run tests and
review the visual tests' output.

First, start the devtools server from the :bokeh-tree:`bokehjs` subdirectory
with the following command:

.. code-block:: sh

    $ node test/devtools server
    listening on 127.0.0.1:5777

You can now use the devtools server for the following operations:

.. _contributor_guide_testing_local_javascript_devtools_endpoints:

Inspecting visual test results
    After running integration tests, you can use the devtools server to
    compare your local results with the baseline images. Open the displayed
    server URL (usually ``127.0.0.1:5777``) in the Chrome web browser and append
    ``/integration/report``. This will open a comparison view of any tests where
    your locally rendered plot is different from the baseline file. For example:

    .. image:: /_images/bokehjs_devtools_report.png
        :class: image-border
        :alt: Screenshot of devtool displaying a locally rendered image, an
            image diff and a baseline image.

Initiate test runs
    You can also use the devtools server to initiate test runs. You have two
    options:

    * Run tests from a JavaScript console
        Open one of these three endpoints in your web browser:

        * ``/unit``
        * ``/defaults``
        * ``/integration``

        This loads BokehJS and the tests. To run the tests, issue
        ``Tests.run_all()`` in Chrome's JavaScript console. This allows
        you to set breakpoints before running code. You can also pass a
        search string, list of strings, or regular expression as the function's
        ``query`` parameter to only run specific tests. For example:

        .. code-block:: TypeScript

            Tests.run_all(query=/[Ll]egend/);

    * Use endpoint to run tests
        Initiate test runs by accessing one of the following endpoints with your
        browser:

        * ``/unit/run``
        * ``/defaults/run``
        * ``/integration/run``

        .. image:: /_images/bokehjs_devtools_test_run.png
            :class: image-border
            :alt: Screenshot of devtool displaying various plots as a result of
                running integration tests.

To only run or view specific tests, append ``?k=some%20text`` to the URL. This
will filter tests by keyword.

To only run or view tests for a specific platform, append either
``platform=linux``, ``platform=macos``, or ``platform=windows`` to the URL.

For information on adding and updating BokehJS tests, see
:ref:`contributor_guide_writing_tests_bokehjs`.

.. note::
    In most cases, the results of running tests locally with the regular Chrome
    GUI are the same as running them in :ref:`Bokeh's CI
    <contributor_guide_testing_ci>` which uses a headless version of Chrome.
    However, there are rare cases where headless and GUI Chrome generate
    different results. In this situation, you can't use the GUI - instead, you
    need to debug BokehJS' code directly in the headless browser. See
    :ref:`contributor_guide_debug_headless` for more information.

.. _contributor_guide_testing_local_examples:

Run examples tests
~~~~~~~~~~~~~~~~~~

In addition to Bokeh's Python- and JavaScript-focused tests, Bokeh uses a suite
of examples tests. This suite runs a selection of the examples in the Bokeh
repository to check whether each of the examples builds without generating
errors. Running these tests also generates a report with screenshots of those
plots.

The examples tests use a specialized testing framework, including a custom
configuration of Chrome. Therefore, it is **recommended not to run those
tests locally**. Instead, :ref:`Bokeh's CI <contributor_guide_testing_ci>` runs
all examples tests once you :ref:`create a Pull Request
<contributor_guide_pull_requests>`.

To run the examples tests locally, you first need to start a customized headless
version of Chrome in the background. This headless browser needs to be
started from the ``bokehjs`` folder. Use the following commands from the top
level of your *source checkout* directory:

.. code-block:: sh

    cd bokehjs
    node make test:run:headless

This starts a headless Chrome tool. Next, open a second terminal and run the
tests from the top level of your *source checkout* directory:

.. code-block:: sh

    pytest tests/test_examples.py

When running the tests, pytest also generates a report with screenshots of the
visual output of each of the examples. These screenshots are available in
``examples-report.html``. This file is located in the same directory that you
ran the tests from:

.. image:: /_images/examples_test_report.png
    :class: image-border
    :alt: Screenshot of a browser window displaying an examples test report
        consisting of various plots.

.. note::
    The examples tests don't analyze the generated screenshots and therefore
    won't fail based on the visual output. You need to inspect the test report
    manually.

In addition, the examples tests generate a log file called ``examples.log``
in the same directory.

.. _contributor_guide_testing_ci:

Continuous Integration (CI)
---------------------------

Every time you start a :ref:`Pull Request <contributor_guide_pull_requests>` or
add new commits to an existing Pull Request branch on Bokeh's GitHub repository,
`Bokeh's Continuous Integration (CI) <GithubCI_>`_ will run all available tests
on your branch.

You can see the list of all current and previous CI runs at this URL:
https://github.com/bokeh/bokeh/actions

.. _contributor_guide_testing_ci_environments:

Environment files
~~~~~~~~~~~~~~~~~

Bokeh's CI runs tests on Linux, macOS, and Windows. It also runs tests with
different versions of Python. The various testing environments are defined
in their respective YAML files in the :bokeh-tree:`ci` folder. In case you add
or change dependencies, you need to update these files, in addition to
:bokeh-tree:`environment.yml` in the *source checkout* directory.

Etiquette
~~~~~~~~~

CI services provide finite free build workers to Open Source projects. Please
group your commits into meaningful chunks of work before pushing to GitHub
instead of pushing every commit individually. This will help you be considerate
of others who require access to these limited resources.

.. _ESLint: https://eslint.org/
.. _flake8: https://gitlab.com/pycqa/flake8
.. _pytest: https://pytest.org/
.. _pytest-xdist: https://github.com/pytest-dev/pytest-xdist
.. _Selenium: https://www.selenium.dev/documentation/en/
.. _web driver: https://www.selenium.dev/documentation/en/webdriver/
.. _ChromeDriver: https://chromedriver.chromium.org/
.. _Chrome: https://www.google.com/chrome/
.. _Chromium: https://www.chromium.org/Home
.. _geckodriver: https://firefox-source-docs.mozilla.org/testing/geckodriver/Usage.html
.. _pytest-cov: https://github.com/pytest-dev/pytest-cov
.. _Specifying which tests to run: https://docs.pytest.org/en/latest/how-to/usage.html#specifying-which-tests-to-run
.. _documentation for pytest-cov: https://pytest-cov.readthedocs.io/en/latest/
.. _GithubCI: https://github.com/bokeh/bokeh/actions
.. _Working with custom markers: http://pytest.org/latest/example/markers.html#working-with-custom-markers
.. _pytest documentation: https://docs.pytest.org
.. _Release Management: https://github.com/bokeh/bokeh/wiki/BEP-2:-Release-Management
.. _contributor_guide_writing_tests:

Writing tests
=============

To help keep Bokeh maintainable, all
:ref:`Pull Requests <contributor_guide_pull_requests>` that add or update code
should include new or updated tests. While exceptions are possible, a Pull
Request without adequate tests will generally not be considered ready to merge.

Follow those general guidelines to decide which kinds of tests to update or add:

When you edit Bokeh's Python code
    Check whether you should update or add
    :ref:`Python tests <contributor_guide_writing_tests_python>`

When your change anything related to BokehJS
    Check whether you should update or add
    :ref:`JavaScript tests <contributor_guide_writing_tests_bokehjs>`

When you fix a bug from Bokeh's issue tracker:
    Check whether you should add a
    :ref:`regression test <contributor_guide_writing_tests_bokehjs_regression>`

Before writing any tests, you should make sure to go through the relevant
passages in :ref:`contributor_guide_testing`. This chapter on writing tests
assumes you know how to run the tests you are working on.

.. _contributor_guide_writing_tests_python:

Writing Python tests
--------------------

If all or parts of your changes affect Bokeh's Python code, you should add or
update the relevant unit and integration tests.

These tests are located in the :bokeh-tree:`tests` folder. See
:ref:`contributor_guide_testing_local_python` for information on how to run
them.

General information on contributing to Bokeh's Python code and models is
available in :ref:`contributor_guide_python`.

.. _contributor_guide_writing_tests_python_unit:

Python unit tests
~~~~~~~~~~~~~~~~~
Python unit tests help maintain the basic functionality of the Python portion of
Bokeh. They are located in :bokeh-tree:`tests/unit/bokeh`. The folder structure
resembles the structure of :ref:`Bokeh's Python models <refguide>`. The name of
each test file begins with ``test_``, followed by the module's name.

Follow these general guidelines when writing Python unit tests:

Import the model under test with ``as``
    Always import the specific model you are testing using the ``import as``
    syntax. Use the model's initials to name your import. For example:

    .. code-block:: Python

        import bokeh.plotting.graph as bpg

Use absolute imports
    Bokeh's unit tests should be as relocatable and unambiguous as possible.
    Therefore, you should use absolute imports (``from bokeh.embed import
    components``) in test files whenever possible. Don't use relative imports
    (``from ..document import Document``).

Use ``pytest`` (not ``unittest``)
    All new tests should use and assume `pytest`_ for all testing-related
    aspects, such as test running, fixtures, or parameterized testing. Please
    do *not* use the ``unittest`` module of the Python standard library.

.. _contributor_guide_writing_tests_integration:

Python integration tests
~~~~~~~~~~~~~~~~~~~~~~~~

Bokeh's Python-focused integration tests help make sure that Bokeh's Python code
works as intended with the TypeScript code of :term:`BokehJS`.

The Python integration tests use `Selenium`_ with `ChromeDriver`_. The test
scripts are located in :bokeh-tree:`tests/integration`. The folder structure
resembles the structure of Bokeh's Python models.

Python integration tests use pytest fixtures to handle the web driver
configuration and interaction with Selenium. Depending on which context you
want to test an object in, choose from ``bokeh_model_page``,
``single_plot_page``, or ``bokeh_server_page``. See
:bokeh-tree:`bokeh/_testing/plugins/project.py` for more details.

Follow these guidelines when adding or updating Python integration tests:

Keep your code as simple as possible
    Try to only include things that are essential to your test. Focus your test
    on one specific functionality. If possible, write several small tests
    instead of one complex one.

Use the |bokeh.models| API whenever possible
    Try to use Bokeh's
    :ref:`low-level bokeh.models interface <userguide_interfaces_models>`
    instead of the more high-level
    :ref:`bokeh.plotting interface <userguide_interfaces_plotting>`.

.. _contributor_guide_writing_tests_bokehjs:

Writing JavaScript tests (BokehJS)
----------------------------------

To maintain the functionality of all :term:`BokehJS` components, Bokeh includes
various tests written in TypeScript. If all or parts of your changes affect
the JavaScript code of BokehJS, you should add or update the relevant BokehJS
tests.

Bokeh's JavaScript tests use a custom testing framework that **requires Google
Chrome or Chromium**. You need a recent version of one of these browsers
available on your system to work with these tests.

Like several other testing frameworks such as `Mocha`_ or `Jasmine`_, the
BokehJS testing framework uses ``describe()`` and ``it()`` functions to set up
tests. Assertions are made with ``expect()`` and ``assert()``. Use ``assert()``
when you need to narrow types.

The BokehJS tests are located in :bokeh-tree:`bokehjs/test`. See
:ref:`contributor_guide_testing_local_javascript` for information on how to run
them.

General information on contributing to BokehJS is available in
:ref:`contributor_guide_bokehjs`.

.. _contributor_guide_writing_tests_bokehjs_unit:

BokehJS unit tests
~~~~~~~~~~~~~~~~~~

The :term:`BokehJS` unit tests help make sure that the individual sections of
BokehJS function as expected. The unit tests for BokehJS are located in the
:bokeh-tree:`bokehjs/test/unit/` folder and sub-folders.

The basic structure for writing tests for Bokeh's testing framework is in parts
inspired by the `Chai "expect" assertion style <Chai_>`_. See the `API
documentation of the Chai Assertion Library <Chai documentation_>`_ for some
general ideas.

Use ``expect()`` together with the following elements to create assertions for
the BokehJS testing framework:

* ``to`` and ``be``: tokens to improve readability of assertions and connect
  elements
* ``not``: negates the following assertions
* ``throw``: asserts that an error is thrown. Accepts the following optional
  parameters: ``error_type`` (filter by ``Error``) and ``pattern`` (filter by
  regular expression or string).
* ``equal``: asserts (deep) value equality. Expects an operand to compare to.
* ``similar``: asserts similarity within a defined tolerance, based on the same
  value equality as ``equal``. Expects an operand to compare to as well as an
  optional ``number`` as ``tolerance``.
* ``identical``: asserts strict equality (``===``). Expects an operand to
  compare to.
* ``instanceof``: asserts that the tested element is an instance of the given
  constructor. Expects a ``Constructor`` to test against.
* ``undefined``: asserts strict equality (``===``) to ``undefined``
* ``null``: asserts strict equality (``===``) to ``null``
* ``true``: asserts strict equality (``===``) to ``true``
* ``false``: asserts strict equality (``===``) to ``false``
* ``NaN``: asserts that the tested element is ``NaN``
* ``empty``: asserts a length of ``0`` (for example, an empty string or an
  iterable that does not contain any retrievable values)
* ``below``: asserts that the tested element is below (``<``) a value. Expects a
  ``number`` to compare to.
* ``above``: asserts that the tested element is below (``>``) a value. Expects a
  ``number`` to compare to.

For example:

.. code-block:: TypeScript

    expect(m.name).to.be.null
    expect(grid0).to.be.instanceof(Column)
    expect(h.msgid).to.not.be.equal(h2.msgid)

.. _contributor_guide_writing_tests_bokehjs_visual:

BokehJS visual tests
~~~~~~~~~~~~~~~~~~~~

:term:`BokehJS` uses visual regression tests as integration tests. These
baseline comparison tests help make sure that Bokeh's visual output is
consistent with the output expected by design. Any BokehJS-related pull requests
that result in changes to the visual output generated by BokehJS should include
visual baseline comparison tests.

In the background, the BokehJS testing framework runs a headless browser and
takes screenshots of the browser's output. The testing framework then compares
the visual output to each test's individual baseline files.

Each test in ``test:integration`` consists of two types of baseline comparisons:

Textual baseline comparison
    For each test, the testing framework compares the pixel location of certain
    elements in the visual output to pixel locations in the baseline data. This
    baseline data is stored as plain text in each test's respective ``.blf``
    file.

Visual baseline comparison
    For each test, the testing framework does a pixel-by-pixel comparison of a
    screenshot and a baseline image. These baseline images are stored as
    ``.png`` files. In contrast to textual baseline comparisons, visual baseline
    comparisons are platform-dependent. Even minor differences in font
    rendering, for example, will make the pixel-by-pixel comparison fail.

The visual baseline comparison tests are located in the
:bokeh-tree:`bokehjs/test/integration/` folder and sub-folders.
:ref:`Bokeh's CI <contributor_guide_testing_ci>` runs these tests on Linux,
macOS, and Windows environments. The baseline files for each environment are
located in the :bokeh-tree:`bokehjs/test/baselines/` folder.

Follow these steps to write new visual tests or update existing tests:

1. Create or update visual testing scripts:
    To write a visual test for the BokehJS testing framework, start by importing
    the ``display()`` and ``fig()`` functions from the testing framework's
    ``_util`` module (located in :bokeh-tree:`bokehjs/test/integration/`):

    .. code-block:: TypeScript

        import {display, fig} from "./_util"

    When writing tests, replace the standard BokehJS ``show()`` function with
    the ``display()`` function in ``_util``. The ``display()`` function accepts
    the same arguments as ``show()`` but also captures the visual output for
    comparison.

    Similarly, replace the standard BokehJS ``figure()`` function with the
    ``fig()`` function in ``_util``. The ``fig()`` function expects an array of
    ``[width, height]`` as the first argument, followed by the same arguments as
    ``figure()``. However, to keep visual tests as efficient as possible, you
    should only use ``width`` and ``height`` wherever you can.

    Keep the width and height of your testing plot as small as possible while
    still being able to see the details you want to test with the naked eye. Try
    to keep the number of elements on your plot to a minimum.

    Follow this general pattern for visual tests:

    .. code-block:: TypeScript

        describe("Your Object", () => {
          it("should show certain behavior", async () => {
            const p = fig([width, height], {figure_attrs})

            ...

            await display(p)
          })
        })

    To change the sensitivity of a visual test, you have the option to set a
    threshold value. The threshold value represents the amounts of pixels by
    which a test image can differ from the baseline image before a test fails.
    To set a threshold value, use ``it.allowing(threshold)``. For example:

    .. code-block:: TypeScript

        describe("Your Object", () => {
          it.allowing(16)("should show certain behavior", async () => {

    Always run ``node make lint`` before committing TypeScript files.

2. Run tests locally:
    Run ``node make tests`` to test your changes on your system. To only run
    integration tests, use ``node make test:integration``.

    If you want to run a specific test only, use the ``-k`` argument and supply
    a search string. The search string is case-sensitive. The BokehJS testing
    framework tries to match your search string to the strings defined in the
    code's ``describe()`` and ``it()`` functions. For example:

    .. code-block:: sh

        $ node make test:integration -k 'Legend annotation'

    The first time you run a new or updated visual test, the BokehJS testing
    framework will notify you that baseline files are missing or outdated. At
    this point, it will also generate all missing or outdated baseline files for
    your operating system. The baseline files will be in a subfolder of
    :bokeh-tree:`bokehjs/test/baselines/`.

    Use the BokehJS :ref:`devtools server
    <contributor_guide_testing_local_javascript_devtools>` to review your local
    test results. Optionally, you can use any PNG viewer to inspect the
    generated PNG files. Adjust your testing code until the test's visual output
    matches your expectations.

3. Generate CI baselines and commit test:
    As a final step before pushing your visual tests to Bokeh's GitHub
    repository, you need to generate and commit the baseline files using
    :ref:`Bokeh's CI <contributor_guide_testing_ci>`.

    The baseline files are platform-dependent. This is why the CI will only work
    reliably if you upload baseline files that were created by the CI, not
    locally created files.

    Before generating new baseline images with Bokeh's CI, `rebase`_ your branch
    to make sure all tests are up to date.

    Follow these steps to generate the necessary baseline files and upload them
    to Bokeh's CI:

    1. Push your changes to GitHub and wait for CI to finish.
    2. The CI will expectedly fail because baseline images are either missing
       (in case you created new tests) or outdated (in case you updated existing
       tests).
    3. After the CI has finished running, go to Bokeh's GitHubCI_ page. Find
       the most recent test run for your PR and download the associated
       ``bokehjs-report`` artifact.
    4. Unzip the downloaded artifact file into the root folder of your local
       Bokeh repository.
    5. Use the :ref:`devtools server
       <contributor_guide_testing_local_javascript_devtools>` to review the
       baseline files the CI has created for each platform: first, go to
       ``/integration/report?platform=linux``, then to
       ``/integration/report?platform=macos``, and finally to
       ``/integration/report?platform=windows``.
    6. If you did not detect any unintentional differences, commit all new or
       modified ``*.blf`` and ``*.png`` files from the folders
       :bokeh-tree:`bokehjs/test/baselines/linux`,
       :bokeh-tree:`bokehjs/test/baselines/macos`, and
       :bokeh-tree:`bokehjs/test/baselines/windows`.
    7. Push your changes to GitHub again and verify that the tests pass this
       time.

.. note::
    Make sure to only push baseline files to the CI that the CI created for
    your specific pull request. Do not include any locally created baseline
    files in your pull request.

    After downloading and unpacking the baseline files from the CI, check your
    local :bokeh-tree:`bokehjs/test/baselines` directory for any modified files
    that are not part of your changes. Make sure only to commit baseline files
    that are necessary for your pull request. Reset the ``baselines`` directory
    after every failed test run with ``git clean`` or ``git clean -f``.

    If you encounter any problems with the steps described here, feel free to
    get in touch at the `Bokeh Discourse`_ or `Bokeh's contributor
    Slack`_.


.. _contributor_guide_writing_tests_bokehjs_regression:

BokehJS regression tests
~~~~~~~~~~~~~~~~~~~~~~~~

Additionally, :term:`BokehJS` uses regression tests with its unit and
integration tests. Regression tests are located in
:bokeh-tree:`bokehjs/test/unit/regressions.ts` and
:bokeh-tree:`bokehjs/test/integration/regressions.ts`.

You should add a regression test whenever you fix a bug related to BokehJS.
Write your regression test so that it fails in case the bug you fixed occurs
again.

Add your testing function to the outermost ``describe()`` function that has
``"Bug"`` passed to it as its ``description`` argument. Add the bug's issue
number to your test's ``describe()`` function and provide a short description of
the fixed bug in your ``it()`` function.

For example:

.. code-block:: TypeScript

      describe("in issue #9522", () => {
        it("disallows arrow to be positioned correctly in stacked layouts", async () => {

          ...

          await display(row([p1, p2]))
        })
      })

.. _contributor_guide_writing_tests_examples:

Working with examples tests
---------------------------

Bokeh's example tests are based on examples found in the :bokeh-tree:`examples`
and :bokeh-tree:`sphinx/source/docs/user_guide/examples` folders.

When you add a new example to one of these folders, they are usually
included in the examples tests automatically. Edit
:bokeh-tree:`tests/examples.yaml` to explicitly include or exclude specific
examples.

See :ref:`contributor_guide_testing_local_examples` for more information on
running the examples tests.

.. _`Mocha`: https://mochajs.org/
.. _`Jasmine`: https://jasmine.github.io/
.. _Chai: https://www.chaijs.com/guide/styles/#expect
.. _Chai documentation: https://www.chaijs.com/api/bdd/
.. _rebase: https://docs.github.com/en/get-started/using-git/about-git-rebase
.. _GithubCI: https://github.com/bokeh/bokeh/actions
.. _pytest: https://docs.pytest.org
.. _Bokeh Discourse: https://discourse.bokeh.org/
.. _Bokeh's contributor Slack: https://slack-invite.bokeh.org/
.. _Selenium: https://www.selenium.dev/documentation/en/
.. _ChromeDriver: https://chromedriver.chromium.org/
.. _bokeh.driving:

bokeh.driving
=============

.. automodule:: bokeh.driving
    :members:
.. _bokeh.command:

bokeh.command
=============

Navigate the tree on the left for information about each subcommand.

.. toctree::
    :maxdepth: 3
    :glob:

    command/*
.. _bokeh.sphinxext:

bokeh.sphinxext
===============

In order to help automate and simplify the generation of Bokeh
documentation, several Sphinx extensions have been created. Most
of these will not be of general interest, except for `bokeh.sphinxext.bokeh_plot`_,
which allows anyone to include and embed bokeh plots directly
in their own Sphinx docs.

.. _bokeh.sphinxext.bokeh_autodoc:

bokeh_autodoc
-------------

.. automodule:: bokeh.sphinxext.bokeh_autodoc

.. _bokeh.sphinxext.bokeh_color:

bokeh_color
-----------

.. automodule:: bokeh.sphinxext.bokeh_color

.. _bokeh.sphinxext.bokeh_dataframe:

bokeh_dataframe
---------------

.. automodule:: bokeh.sphinxext.bokeh_dataframe

.. _bokeh.sphinxext.bokeh_enum:

bokeh_enum
----------

.. automodule:: bokeh.sphinxext.bokeh_enum

.. _bokeh.sphinxext.bokeh_gallery:

bokeh_gallery
-------------

.. automodule:: bokeh.sphinxext.bokeh_gallery

.. _bokeh.sphinxext.bokeh_jinja:

bokeh_jinja
-----------

.. automodule:: bokeh.sphinxext.bokeh_jinja

.. _bokeh.sphinxext.bokeh_model:

bokeh_model
-----------

.. automodule:: bokeh.sphinxext.bokeh_model

.. _bokeh.sphinxext.bokeh_options:

bokeh_options
-------------

.. automodule:: bokeh.sphinxext.bokeh_options

.. _bokeh.sphinxext.bokeh_palette:

bokeh_palette
-------------

.. automodule:: bokeh.sphinxext.bokeh_palette

.. _bokeh.sphinxext.bokeh_palette_group:

bokeh_palette_group
-------------------

.. automodule:: bokeh.sphinxext.bokeh_palette_group

.. _bokeh.sphinxext.bokeh_plot:

bokeh_plot
----------

.. automodule:: bokeh.sphinxext.bokeh_plot

.. _bokeh.sphinxext.bokeh_prop:

bokeh_prop
----------

.. automodule:: bokeh.sphinxext.bokeh_prop

.. _bokeh.sphinxext.bokeh_releases:

bokeh_releases
--------------

.. automodule:: bokeh.sphinxext.bokeh_releases

.. _bokeh.sphinxext.bokeh_roles:

bokeh_roles
-----------

.. automodule:: bokeh.sphinxext.bokeh_roles

.. _bokeh.sphinxext.bokeh_sitemap:

bokeh_sitemap
-------------

.. automodule:: bokeh.sphinxext.bokeh_sitemap

.. _bokeh.sphinxext.collapsible_code_block:

collapsible_code_block
----------------------

.. automodule:: bokeh.sphinxext.collapsible_code_block
.. _bokeh.sampledata:

bokeh.sampledata
================

.. automodule:: bokeh.sampledata
  :members:

----

.. _sampledata_anscombe:

anscombe
--------

.. automodule:: bokeh.sampledata.anscombe

.. _sampledata_antibiotics:

antibiotics
-----------

.. automodule:: bokeh.sampledata.antibiotics

.. _sampledata_airport_routes:

airport_routes
--------------

.. automodule:: bokeh.sampledata.airport_routes

.. _sampledata_airport:

airport
-------

.. automodule:: bokeh.sampledata.airports

.. _sampledata_autompg:

autompg
-------

.. automodule:: bokeh.sampledata.autompg

.. _sampledata_autompg2:

autompg2
--------

.. automodule:: bokeh.sampledata.autompg2

.. _sampledata_browsers:

browsers
--------

.. automodule:: bokeh.sampledata.browsers

.. _sampledata_commits:

commits
-------

.. automodule:: bokeh.sampledata.commits

.. _sampledata_daylight:

daylight
--------

.. automodule:: bokeh.sampledata.daylight

.. _sampledata_degrees:

degrees
-------

.. automodule:: bokeh.sampledata.degrees

.. _sampledata_gapminder:

gapminder
---------

.. automodule:: bokeh.sampledata.gapminder

.. _sampledata_glucose:

glucose
-------

.. automodule:: bokeh.sampledata.glucose

.. _sampledata_haar_cascade:

haar_cascade
------------

.. automodule:: bokeh.sampledata.haar_cascade

.. _sampledata_iris:

iris
----

.. automodule:: bokeh.sampledata.iris

.. _sampledata_les_mis:

les_mis
-------

.. automodule:: bokeh.sampledata.les_mis

.. _sampledata_movies_data:

movies_data
-----------

.. automodule:: bokeh.sampledata.movies_data

.. _sampledata_mtb:

mtb
---

.. automodule:: bokeh.sampledata.mtb

.. _sampledata_olympics2014:

olympics2014
------------

.. automodule:: bokeh.sampledata.olympics2014

.. _sampledata_penguins:

penguins
--------

.. automodule:: bokeh.sampledata.penguins

.. _sampledata_perceptions:

perceptions
-----------

.. automodule:: bokeh.sampledata.perceptions

.. _sampledata_periodic_table:

periodic_table
--------------

.. automodule:: bokeh.sampledata.periodic_table

.. _sampledata_population:

population
----------

.. automodule:: bokeh.sampledata.population

.. _sampledata_sample_geojson:

sample_geojson
--------------

.. automodule:: bokeh.sampledata.sample_geojson

.. _sampledata_sea_surface_temperature:

sea_surface_temperature
-----------------------

.. automodule:: bokeh.sampledata.sea_surface_temperature

.. _sampledata_sprint:

sprint
------

.. automodule:: bokeh.sampledata.sprint

.. _sampledata_stocks:

stocks
------

.. automodule:: bokeh.sampledata.stocks

.. _sampledata_unemployment:

unemployment
------------

.. automodule:: bokeh.sampledata.unemployment

.. _sampledata_unemployment1948:

unemployment1948
----------------

.. automodule:: bokeh.sampledata.unemployment1948

.. _sampledata_us_cities:

us_cities
---------

.. automodule:: bokeh.sampledata.us_cities

.. _sampledata_us_counties:

us_counties
------------

.. automodule:: bokeh.sampledata.us_counties

.. _sampledata_us_holidays:

us_holidays
-----------

.. automodule:: bokeh.sampledata.us_holidays

.. _sampledata_us_marriages_divorces:

us_marriages_divorces
---------------------

.. automodule:: bokeh.sampledata.us_marriages_divorces

.. _sampledata_us_states:

us_states
---------

.. automodule:: bokeh.sampledata.us_states

.. _sampledata_world_cities:

world_cities
------------

.. automodule:: bokeh.sampledata.world_cities
.. _bokeh.document:

bokeh.document
==============

.. automodule:: bokeh.document
    :members:

.. toctree::
    :maxdepth: 3
    :glob:

    document/*
.. _bokeh.resources:

bokeh.resources
===============

.. automodule:: bokeh.resources
  :members:
.. _bokeh.util:

bokeh.util
==========

.. automodule:: bokeh.util
  :members:
.. _bokeh:

bokeh
=====

.. automodule:: bokeh
.. _bokeh.colors:

bokeh.colors
============

.. automodule:: bokeh.colors

.. _bokeh.colors.Color:

bokeh.colors.Color
------------------

.. automodule:: bokeh.colors.color
   :members:
   :inherited-members:

.. _bokeh.colors.groups:

bokeh.colors.groups
-------------------

.. automodule:: bokeh.colors.groups
   :members:

.. _bokeh.colors.named:

bokeh.colors.named
------------------

.. automodule:: bokeh.colors.named
   :members:
   :undoc-members:
.. _bokeh.client:

bokeh.client
============

.. automodule:: bokeh.client

.. toctree::
    :maxdepth: 2
    :glob:

    client/*
.. _bokeh.model:

bokeh.model
===========

.. use autodata below for model_class_reverse_map otherwise it prints the
.. huge actual reverse map contents in the rendered docs

.. automodule:: bokeh.model
    :members:

    .. autoclass: Model
        :members:
        :show-inheritance:
        :inherited-members:

        .. autoclasstoc::

        .. autodata:: model_class_reverse_map
            :annotation: = {}

            Stores a mapping from __view_model__ names to Bokeh model classes
.. _bokeh.layouts:

bokeh.layouts
=============

.. We can't use automodule here because of transitive imports of models
.. from bokeh.models, which therefore need a :noindex: flag added. It would
.. probably be good to deprecate usage of these models from this location

.. module:: bokeh.layouts

Functions for arranging bokeh layout objects.

.. _bokeh.layouts.column:

column
------

.. autofunction:: column

.. _bokeh.layouts.grid:

grid
----

.. autofunction:: grid

.. _bokeh.layouts.gridplot:

gridplot
--------

.. autofunction:: gridplot

.. _bokeh.layouts.layout:

layout
------

.. autofunction:: layout

.. _bokeh.layouts.row:

row
---

.. autofunction:: row

.. _bokeh.layouts.Spacer:

Spacer
------

.. autoclass:: Spacer
    :noindex:
.. _bokeh.models:

bokeh.models
============

.. automodule:: bokeh.models

These models are accumulated into |Document| instances which can be serialized
and sent to clients (typically browsers) for display or use there.

As a concrete example, consider a column layout with ``Slider`` and ``Select``
widgets, and a plot with some tools, an axis and grid, and a glyph renderer
for circles. A simplified representation oh this document might look like the
figure below:

.. figure:: /_images/document.svg
    :align: center
    :width: 65%

    A Bokeh Document collects of Bokeh Models (e.g. plots, tools,
    glyphs, etc.) so that can be serialized as a single collection.

All of the rectangular boxes above are Bokeh models.

This reference links in the sidebar document all built-in Bokeh models,
together with their property attributes, as well as a JSON prototype
illustrating what a serialized version of the model looks like.

.. toctree::
    :maxdepth: 3
    :hidden:
    :glob:

    models/*
.. _bokeh.core:

bokeh.core
==========

.. automodule:: bokeh.core

.. toctree::
    :maxdepth: 2
    :glob:

    core/*
.. _bokeh.themes:

bokeh.themes
============

.. automodule:: bokeh.themes
.. _bokeh.events:

bokeh.events
============

.. automodule:: bokeh.events
  :members:
.. _bokeh.palettes:

bokeh.palettes
==============

.. automodule:: bokeh.palettes
.. _bokeh.io:

bokeh.io
========

.. automodule:: bokeh.io
  :members:


.. _bokeh.io.doc:

bokeh.io.doc
------------

.. automodule:: bokeh.io.doc
    :members:

.. _bokeh.io.export:

bokeh.io.export
---------------

.. automodule:: bokeh.io.export
    :members:

.. _bokeh.io.notebook:

bokeh.io.notebook
-----------------

.. automodule:: bokeh.io.notebook
    :members:

.. _bokeh.io.output:

bokeh.io.output
---------------

.. automodule:: bokeh.io.output
    :members:

.. _bokeh.io.saving:

bokeh.io.saving
---------------

.. automodule:: bokeh.io.saving
    :members:

.. _bokeh.io.showing:

bokeh.io.showing
----------------

.. automodule:: bokeh.io.showing
    :members:

.. _bokeh.io.state:

bokeh.io.state
--------------

.. automodule:: bokeh.io.state
    :members:

.. _bokeh.io.util:

bokeh.io.util
-------------

.. automodule:: bokeh.io.util
    :members:
.. _bokeh.application:

bokeh.application
=================

.. automodule:: bokeh.application

.. toctree::
    :maxdepth: 2
    :glob:

    application/*
.. _bokeh.plotting:

bokeh.plotting
==============

The ``bokeh.plotting`` API is Bokeh's **primary** interface, and lets you focus
on relating glyphs to data. It automatically assembles plots with default
elements such as axes, grids, and tools for you.

Below is a basic example:

.. bokeh-plot:: docs/user_guide/examples/concepts_plotting.py
    :source-position: above

This reference guide chapter has a few sections split out for the different
main components:

.. toctree::
    :maxdepth: 1
    :glob:

    plotting/*
.. _bokeh.server:

bokeh.server
============

.. automodule:: bokeh.server

By far the most flexible way to create interactive data visualizations using
the Bokeh server is to create Bokeh Applications, and serve them with a Bokeh
server. In this scenario, a Bokeh server uses the application code to create
sessions and documents for all clients (typically browsers) that connect:

.. figure:: /_images/bokeh_serve.svg
    :align: center
    :width: 65%

    A Bokeh server (left) uses Application code to create Bokeh Documents.
    Every new connection from a browser (right) results in the Bokeh server
    creating a new document, just for that session.

The application code is executed in the Bokeh server every time a new
connection is made, to create the new Bokeh ``Document`` that will be synced
to the browser. The application code also sets up any callbacks that should be
run whenever properties such as widget values are changes.

The reference links in the sidebar document the details of the Bokeh Server.
Most users will probably not need to be concerned with these details, unless
they have specialized requirements, and should refer to the User's Guide
chapter :ref:`userguide_server` for information about using the Bokeh Server.

.. toctree::
    :maxdepth: 2
    :glob:

    server/*
.. _bokeh.settings:

bokeh.settings
==============

.. automodule:: bokeh.settings
.. _bokeh.tile_providers:

bokeh.tile_providers
====================

.. automodule:: bokeh.tile_providers
  :members:
.. _bokeh.embed:

bokeh.embed
===========

.. automodule:: bokeh.embed
  :members:
.. _bokeh.transform:

bokeh.transform
===============

.. automodule:: bokeh.transform
  :members:
.. _bokeh.protocol:

bokeh.protocol
==============

.. automodule:: bokeh.protocol
  :members:

.. _bokeh.protocol.exceptions:

bokeh.protocol.exceptions
-------------------------

.. automodule:: bokeh.protocol.exceptions
   :members:

.. _bokeh.protocol.message:

bokeh.protocol.message
----------------------

.. automodule:: bokeh.protocol.message
   :members:

bokeh.protocol.messages
-----------------------

.. automodule:: bokeh.protocol.messages
   :members:

.. _bokeh.protocol.receiver:

bokeh.protocol.receiver
-----------------------

.. automodule:: bokeh.protocol.receiver
   :members:
.. _bokeh.plotting.figure:

figure
======

.. autoclass:: bokeh.plotting.figure
    :members:
    :undoc-members:
    :show-inheritance:
    :inherited-members:
    :exclude-members: js_event_callbacks, js_property_callbacks, subscribed_events, model_class_reverse_map

    .. autoclasstoc::
.. _bokeh.plotting.gmap:

gmap
====

The ``gmap`` function is similar to |figure|, but configures a plot that also
has a Google Maps underlay.

gmap
----

.. autofunction:: bokeh.plotting.gmap

GMap
----

.. autoclass:: bokeh.plotting.GMap
    :members:
    :undoc-members:
    :show-inheritance:
    :inherited-members:
    :exclude-members: js_event_callbacks, js_property_callbacks, subscribed_events, model_class_reverse_map

    .. autoclasstoc::
.. _bokeh.plotting.helpers:

helpers
=======

Besides |figure| and |gmap| the ``bokeh.plotting`` module also contains
additional functions and attributes liste in this section.

The following functions and classes are imported transitively and made
available from ``bokeh.plotting`` as a convenience:

* :class:`bokeh.document.Document`
* :class:`bokeh.io.curdoc`
* :class:`bokeh.io.output_file`
* :class:`bokeh.io.output_notebook`
* :class:`bokeh.io.reset_output`
* :class:`bokeh.io.save`
* :class:`bokeh.io.show`
* :class:`bokeh.layouts.column`
* :class:`bokeh.layouts.gridplot`
* :class:`bokeh.layouts.row`
* :class:`bokeh.models.ColumnDataSource`

from_networkx
-------------

.. autofunction:: bokeh.plotting.from_networkx

markers
-------

.. autofunction:: bokeh.plotting.markers

DEFAULT_TOOLS
-------------

.. autodata:: bokeh.plotting.DEFAULT_TOOLS

    A default set of tools configured if no configuration is provided.
.. _bokeh.server.callbacks:

bokeh.server.callbacks
----------------------

.. automodule:: bokeh.server.callbacks
   :members:
.. _bokeh.server.urls:

bokeh.server.urls
-----------------

.. automodule:: bokeh.server.urls
   :members:
.. _bokeh.server.util:

bokeh.server.util
-----------------

.. automodule:: bokeh.server.util
   :members:
.. _bokeh.server.connection:

bokeh.server.connection
-----------------------

.. automodule:: bokeh.server.connection
   :members:
.. _bokeh.server.protocol_handler:

bokeh.server.protocol_handler
-----------------------------

.. automodule:: bokeh.server.protocol_handler
   :members:
.. _bokeh.server.tornado:

bokeh.server.tornado
--------------------

.. automodule:: bokeh.server.tornado
   :members:
.. _bokeh.server.session:

bokeh.server.session
--------------------

.. automodule:: bokeh.server.session
   :members:
.. _bokeh.server.auth_provider:

bokeh.server.auth_provider
--------------------------

.. automodule:: bokeh.server.auth_provider
   :members:
.. _bokeh.server.server:

bokeh.server.server
-------------------

.. automodule:: bokeh.server.server
   :members:
.. _bokeh.server.contexts:

bokeh.server.contexts
---------------------

.. automodule:: bokeh.server.contexts
   :members:
bokeh.server.views
------------------

auth_request_handler
~~~~~~~~~~~~~~~~~~~~

.. automodule:: bokeh.server.views.auth_request_handler
   :members:

autoload_js_handler
~~~~~~~~~~~~~~~~~~~

.. automodule:: bokeh.server.views.autoload_js_handler
   :members:

doc_handler
~~~~~~~~~~~

.. automodule:: bokeh.server.views.doc_handler
   :members:

autoload_metadata_handler
~~~~~~~~~~~~~~~~~~~~~~~~~

.. automodule:: bokeh.server.views.metadata_handler
   :members:

root_handler
~~~~~~~~~~~~

.. automodule:: bokeh.server.views.root_handler
   :members:

session_handler
~~~~~~~~~~~~~~~

.. automodule:: bokeh.server.views.session_handler
   :members:

static_handler
~~~~~~~~~~~~~~

.. automodule:: bokeh.server.views.static_handler
   :members:

ws
~~

.. automodule:: bokeh.server.views.ws
   :members:
.. _bokeh.models.formatters:

formatters
----------

.. automodule:: bokeh.models.formatters
   :members:
   :undoc-members:
.. _bokeh.models.callbacks:

callbacks
---------

.. automodule:: bokeh.models.callbacks
   :members:
   :undoc-members:
.. _bokeh.models.tickers:

tickers
-------

.. automodule:: bokeh.models.tickers
   :members:
   :undoc-members:
.. _bokeh.models.map_plots:

map_plots
---------

.. automodule:: bokeh.models.map_plots
   :members:
   :undoc-members:
.. _bokeh.models.tools:

tools
-----

.. automodule:: bokeh.models.tools
   :members:
   :undoc-members:
.. _bokeh.models.textures:

textures
--------

.. automodule:: bokeh.models.textures
   :members:
   :undoc-members:
.. _bokeh.models_plots:

plots
-----

.. automodule:: bokeh.models.plots
   :members:
   :undoc-members:
.. _bokeh.models.graphs:

graphs
------

.. automodule:: bokeh.models.graphs
   :members:
   :undoc-members:
.. _bokeh.models.ranges:

ranges
------

.. automodule:: bokeh.models.ranges
   :members:
   :undoc-members:
.. _bokeh.models.layouts:

layouts
-------

.. automodule:: bokeh.models.layouts
   :members:
   :undoc-members:
.. _bokeh.models.axes:

axes
----

.. automodule:: bokeh.models.axes
   :members:
   :undoc-members:
.. _bokeh.models.sources:

sources
-------

.. automodule:: bokeh.models.sources
   :members:
   :undoc-members:
.. _bokeh.models.mappers:

mappers
-------

.. automodule:: bokeh.models.mappers
   :members:
   :undoc-members:
.. _bokeh.models.renderers:

renderers
---------

.. automodule:: bokeh.models.renderers
   :members:
   :undoc-members:
.. _bokeh.models.transforms:

transforms
----------

.. automodule:: bokeh.models.transforms
   :members:
   :undoc-members:
.. _bokeh.models.widgets:

widgets
-------

Display a variety of interactive widgets.

.. note::
    including widgets in Bokeh output requires that the separate
    ``bokeh-widgets.js`` is loaded. Most Bokeh output functions will
    take care of this automatically. For more advanced use-cases, see
    :ref:`bokeh.resources`.

The full list of wiget categories is below:

.. toctree::
   :maxdepth: 2
   :glob:

   widgets/*
.. _bokeh.models.scales:

scales
------

.. automodule:: bokeh.models.scales
   :members:
   :undoc-members:
.. _bokeh.models.text:

text
----

.. automodule:: bokeh.models.text
   :members:
   :undoc-members:
.. _bokeh.models.selections:

selections
----------

.. automodule:: bokeh.models.selections
   :members:
   :undoc-members:
.. _bokeh.models.expressions:

expressions
-----------

.. automodule:: bokeh.models.expressions
   :members:
   :undoc-members:
.. _bokeh.models.tiles:

tiles
-----

.. automodule:: bokeh.models.tiles
   :members:
   :undoc-members:
.. _bokeh.models.annotations:

annotations
-----------

.. automodule:: bokeh.models.annotations
   :members:
   :undoc-members:
.. _bokeh.models.filters:

filters
-------

.. automodule:: bokeh.models.filters
   :members:
   :undoc-members:
.. _bokeh.models.glyphs:

glyphs
------

.. automodule:: bokeh.models.glyphs
.. _bokeh.models.grids:

grids
-----

.. automodule:: bokeh.models.grids
   :members:
   :undoc-members:
.. _bokeh.models.widgets.markups:

markups
-------

.. automodule:: bokeh.models.widgets.markups
   :members:
   :undoc-members:
.. _bokeh.models.widgets.icons:

icons
-----

.. automodule:: bokeh.models.widgets.icons
   :members:
   :undoc-members:
.. _bokeh.models.widgets.tables:

tables
------

.. automodule:: bokeh.models.widgets.tables
   :members:
   :undoc-members:
.. _bokeh.models.widgets.sliders:

sliders
-------

.. automodule:: bokeh.models.widgets.sliders
   :members:
   :undoc-members:
.. _bokeh.models.widgets.buttons:

buttons
-------

.. automodule:: bokeh.models.widgets.buttons
   :members:
   :undoc-members:
.. _bokeh.models.widgets.inputs:

inputs
------

.. automodule:: bokeh.models.widgets.inputs
   :members:
   :undoc-members:
.. _bokeh.models.widgets.groups:

groups
------

.. automodule:: bokeh.models.widgets.groups
   :members:
   :undoc-members:
.. _bokeh.models.widgets.widget:

widget
------

.. automodule:: bokeh.models.widgets.widget
   :members:
   :undoc-members:
.. _bokeh.models.glyphs.Rect:

.. bokeh-model:: Rect
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.HBar:

.. bokeh-model:: HBar
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.VArea:

.. bokeh-model:: VArea
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Scatter:

.. bokeh-model:: Scatter
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Arc:

.. bokeh-model:: Arc
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.HexTile:

.. bokeh-model:: HexTile
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Line:

.. bokeh-model:: Line
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Circle:

.. bokeh-model:: Circle
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.MultiLine:

.. bokeh-model:: MultiLine
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.ImageRGBA:

.. bokeh-model:: ImageRGBA
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Quadratic:

.. bokeh-model:: Quadratic
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.ImageURL:

.. bokeh-model:: ImageURL
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Patch:

.. bokeh-model:: Patch
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Annulus:

.. bokeh-model:: Annulus
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Segment:

.. bokeh-model:: Segment
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Block:

.. bokeh-model:: Block
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Ray:

.. bokeh-model:: Ray
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Image:

.. bokeh-model:: Image
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Bezier:

.. bokeh-model:: Bezier
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.MultiPolygons:

.. bokeh-model:: MultiPolygons
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Patches:

.. bokeh-model:: Patches
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.AnnularWedge:

.. bokeh-model:: AnnularWedge
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Text:

.. bokeh-model:: Text
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.VBar:

.. bokeh-model:: VBar
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Quad:

.. bokeh-model:: Quad
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Wedge:

.. bokeh-model:: Wedge
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.HArea:

.. bokeh-model:: HArea
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Step:

.. bokeh-model:: Step
    :module: bokeh.models.glyphs
.. _bokeh.models.glyphs.Ellipse:

.. bokeh-model:: Ellipse
    :module: bokeh.models.glyphs
.. _bokeh.core.json_encoder:

bokeh.core.json_encoder
-----------------------

.. automodule:: bokeh.core.json_encoder

    .. autofunction:: serialize_json

    .. autoclass:: BokehJSONEncoder
        :members:
        :show-inheritance:
        :inherited-members:

        .. autoclasstoc::
Properties
----------

.. toctree::
   :maxdepth: 2
   :glob:

   property/*
.. _bokeh.core.validation:

bokeh.core.validation
---------------------

.. automodule:: bokeh.core.validation

.. _bokeh.core.validation.errors:

Error Codes
~~~~~~~~~~~

.. automodule:: bokeh.core.validation.errors
   :members:
   :undoc-members:

.. _bokeh.core.validation.warnings:

Warning Codes
~~~~~~~~~~~~~

.. automodule:: bokeh.core.validation.warnings
   :members:
   :undoc-members:

.. _bokeh.core.validation.helpers:

Helper Functions
~~~~~~~~~~~~~~~~

These helper functions can be used to perform integrity checks on collections
of Bokeh models, or mark methods on Models as warning or error checks.

.. autofunction:: bokeh.core.validation.check.check_integrity

.. autofunction:: bokeh.core.validation.check.silence

.. autofunction:: bokeh.core.validation.decorators.error

.. autofunction:: bokeh.core.validation.decorators.warning

.. |GlyphRenderer| replace:: :class:`~bokeh.models.renderers.GlyphRenderer`
.. |Scale| replace:: :class:`~bokeh.models.scales.Scale`
.. _bokeh.core.has_props:

bokeh.core.has_props
--------------------

.. automodule:: bokeh.core.has_props
  :members:
  :undoc-members:
.. _bokeh.core.query:

bokeh.core.query
----------------

.. automodule:: bokeh.core.query
  :members:
.. _bokeh.core.properties:

bokeh.core.properties
---------------------

In order to streamline and automate the creation and use of models that can be used
for describing plots and scenes, Bokeh provides a collection of properties
and property mixins. Property classes provide automatic validation and
serialization for a large collection of useful types. Mixin and container
classes provide for easy bulk addition of properties to model classes.

.. automodule:: bokeh.core.properties
.. _bokeh.core.property_mixins:

bokeh.core.property_mixins
--------------------------

.. automodule:: bokeh.core.property_mixins
    :members:
.. _bokeh.core.templates:

bokeh.core.templates
--------------------

.. automodule:: bokeh.core.templates
.. _bokeh.core.enums:

bokeh.core.enums
----------------

.. enumeration is excluded below so that it can be explicitly
.. included earlier in the module docstring

.. automodule:: bokeh.core.enums
  :members:
  :undoc-members:
  :exclude-members: enumeration
.. _bokeh.core.property.descriptors:


bokeh.core.property.descriptors
-------------------------------

.. automodule:: bokeh.core.property.descriptors
    :members:
    :member-order: bysource
    :special-members:
    :exclude-members: __weakref__
.. _bokeh.core.property.bases:

bokeh.core.property.bases
-------------------------

.. automodule:: bokeh.core.property.bases
    :members:
    :special-members:
    :exclude-members: __weakref__
.. _bokeh.core.property.descriptor_factory:

bokeh.core.property.descriptor_factory
--------------------------------------

.. automodule:: bokeh.core.property.descriptor_factory
    :members:
    :special-members:
    :exclude-members: __weakref__
Handlers
--------

.. toctree::
    :maxdepth: 2
    :glob:

    handlers/*
.. _bokeh.application.application:

bokeh.application.application
-----------------------------

.. automodule:: bokeh.application.application
    :members:
.. _bokeh.application.handlers.script:

bokeh.application.handlers.script
---------------------------------

.. automodule:: bokeh.application.handlers.script
    :members:
.. _bokeh.application.handlers.code_runner:

bokeh.application.handlers.code_runner
--------------------------------------

.. automodule:: bokeh.application.handlers.code_runner
    :members:
.. _bokeh.application.handlers.code:

bokeh.application.handlers.code
-------------------------------

.. automodule:: bokeh.application.handlers.code
    :members:
.. _bokeh.application.handlers.server_lifecycle:

bokeh.application.handlers.server_lifecycle
-------------------------------------------

.. automodule:: bokeh.application.handlers.server_lifecycle
    :members:
.. _bokeh.application.handlers.notebook:

bokeh.application.handlers.notebook
-----------------------------------

.. automodule:: bokeh.application.handlers.notebook
    :members:
.. _bokeh.application.handlers.function:

bokeh.application.handlers.function
-----------------------------------

.. automodule:: bokeh.application.handlers.function
    :members:
.. _bokeh.application.handlers.directory:

bokeh.application.handlers.directory
------------------------------------

.. automodule:: bokeh.application.handlers.directory
    :members:
.. _bokeh.application.handlers.handler:

bokeh.application.handlers.handler
----------------------------------

.. automodule:: bokeh.application.handlers.handler
    :members:
bokeh.command.subcommands
-------------------------

.. toctree::
    :maxdepth: 3
    :glob:

    subcommands/*
.. _bokeh.command.util:

bokeh.command.util
------------------

.. automodule:: bokeh.command.util
    :members:
.. _bokeh.command.subcommand:

bokeh.command.subcommand
------------------------

.. automodule:: bokeh.command.subcommand
    :members:
.. _bokeh.command.bootstrap:

bokeh.command.bootstrap
-----------------------

.. automodule:: bokeh.command.bootstrap
    :members:
.. _bokeh.command.subcommands.static:

static
~~~~~~

.. automodule:: bokeh.command.subcommands.static
    :members:
.. _bokeh.command.subcommands.sampledata:

sampledata
~~~~~~~~~~

.. automodule:: bokeh.command.subcommands.sampledata
    :members:
.. _bokeh.command.subcommands.secret:

secret
~~~~~~

.. automodule:: bokeh.command.subcommands.secret
    :members:
.. _bokeh.command.subcommands.file_output:

file_output
~~~~~~~~~~~

.. automodule:: bokeh.command.subcommands.file_output
    :members:
.. _bokeh.command.subcommands.info:

info
~~~~

.. automodule:: bokeh.command.subcommands.info
    :members:
.. _bokeh.command.subcommands.serve:

serve
~~~~~

.. automodule:: bokeh.command.subcommands.serve
    :members:
.. _bokeh.command.subcommands.json:

json
~~~~

.. automodule:: bokeh.command.subcommands.json
    :members:
.. _bokeh.document.document:

bokeh.document.document
-----------------------

.. note::
    This section documents the physical filesystem module that implements
    ``Document``. However the intended public interface is in :ref:`bokeh.document`.

.. automodule:: bokeh.document.document
    :members:
    :noindex:
.. _bokeh.document.util:

bokeh.document.util
-------------------

.. automodule:: bokeh.document.util
    :members:
.. _bokeh.document.locking:

bokeh.document.locking
----------------------

.. automodule:: bokeh.document.locking
    :members:
.. _bokeh.document.events:

bokeh.document.events
---------------------

.. automodule:: bokeh.document.events
    :members:
.. _bokeh.client.states:

bokeh.client.states
-------------------

.. automodule:: bokeh.client.states
   :members:
.. _bokeh.client.util:

bokeh.client.util
-----------------

.. automodule:: bokeh.client.util
   :members:
.. _bokeh.client.connection:

bokeh.client.connection
-----------------------

.. automodule:: bokeh.client.connection
   :members:
.. _bokeh.client.session:

bokeh.client.session
--------------------

.. automodule:: bokeh.client.session
   :members:
.. _bokeh.client.websocket:

bokeh.client.websocket
----------------------

.. automodule:: bokeh.client.websocket
   :members:
.. _first_steps_4:

First steps 4: Customizing your plot
====================================

In the :ref:`previous first steps guides <first_steps_3>`, you generated
different glyphs and added more information such as a title, legend, and
annotations.

In this section, you will customize the appearance of the plot as a whole. This
includes :ref:`resizing<first_steps_4_resizing>` your plot, changing its
:ref:`lines and colors<first_steps_4_grid>`, and customizing the
:ref:`axes<first_steps_4_axes>` and :ref:`tools<first_steps_4_toolbar>`.

.. _first_steps_4_themes:

Using Themes
------------

With Bokeh's themes, you can quickly change the appearance of your plot. Themes
are a set of pre-defined design parameters such as colors, fonts, or line
styles.

Bokeh comes with five :ref:`built-in themes <bokeh.themes>`: ``caliber``,
``dark_minimal``, ``light_minimal``, ``night_sky``, and ``contrast``.
Additionally, you can define your own custom themes.

To use one of the built-in themes, assign the name of the theme you want to use
to the ``theme`` property of your document:

.. literalinclude:: examples/first_steps_4_themes.py
   :language: python
   :emphasize-lines: 9

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_themes.py
    :source-position: none

You can also create your own themes to use across multiple plots. Bokeh's themes
can be either in a YAML or JSON format. To learn more about creating and using
customized themes, see :ref:`userguide_styling_using_themes_custom` in the user
guide.

.. seealso::
    For more information on using themes with Bokeh, see
    :ref:`userguide_styling_using_themes` in the user guide and
    :class:`bokeh.themes` in the reference guide.

.. _first_steps_4_resizing:

Resizing your plot
------------------

Bokeh's |Plot| objects have various attributes that influence the way your plot
looks.

Setting width and height
~~~~~~~~~~~~~~~~~~~~~~~~

To set the size of your plot, use the attributes ``width`` and ``height`` when
calling the |figure| function:

.. literalinclude:: examples/first_steps_4_plot_size.py
   :language: python
   :emphasize-lines: 10-11

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_plot_size.py
    :source-position: none

Similar to :ref:`changing the design of an existing
glyph<first_steps_2_altering_existing>`, you can change a plot's attributes at
any time after its creation:

.. literalinclude:: examples/first_steps_4_resize_plot.py
   :language: python
   :emphasize-lines: 17,18

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_resize_plot.py
    :source-position: none

Enabling responsive plot sizing
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To make your plot automatically adjust to your browser or screen size, use the
attribute :class:`~bokeh.models.plots.Plot.sizing_mode`:

.. literalinclude:: examples/first_steps_4_plot_size_responsive.py
   :language: python
   :emphasize-lines: 10,11

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_plot_size_responsive.py
    :source-position: none

.. seealso::
    To learn more about how to control the size of plots, see
    :ref:`userguide_styling_plots` in the user guide and the entry for
    |Plot| in the reference guide.

    For more information on responsive sizing, see
    :ref:`userguide_layout_sizing_mode` in the user guide and
    :class:`~bokeh.models.plots.Plot.sizing_mode` in the reference guide.

.. _first_steps_4_axes:

Customizing axes
----------------

You can set various attributes to change the way the axes in your plot work and
look.

Setting your axes' appearance
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Options for customizing the appearance of your plot include:

* setting labels for your axes
* styling the numbers displayed with your axes
* defining colors and other layout properties for the axes themselves

For example:

.. literalinclude:: examples/first_steps_4_axes_customizing.py
   :language: python
   :emphasize-lines: 19-21,24-26,29-30

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_axes_customizing.py
    :source-position: none

Defining axis ranges
~~~~~~~~~~~~~~~~~~~~

When drawing the axes for your plot, Bokeh automatically determines the range
each axis needs to cover in order to display all your values. For example, if
the values on your y-axis are between 2 and 17, Bokeh automatically creates
a y-axis that ranges from a little below 2 to a little above 17.

To define the range for your axes manually, use the
:func:`~bokeh.models.plots.Plot.y_range` function or the
:func:`~bokeh.models.plots.Plot.y_range` properties of your |Plot| object when
you call the |figure| function:

.. literalinclude:: examples/first_steps_4_plot_axis_ranges.py
   :language: python
   :emphasize-lines: 9

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_plot_axis_ranges.py
    :source-position: none

Formatting axis ticks
~~~~~~~~~~~~~~~~~~~~~

You can format the text that appears alongside your axes with Bokeh's
``TickFormatter`` objects. Use these formatters to display currency
symbols on your y-axis, for example:

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_tick_formatter.py
    :source-position: none

To display dollar amounts instead of just numbers on your y-axis, use the
:class:`~bokeh.models.formatters.NumeralTickFormatter`:

First, import the :class:`~bokeh.models.formatters.NumeralTickFormatter` from
|bokeh.models|:

.. code-block:: python

    from bokeh.models import NumeralTickFormatter

Then, after creating your plot with the ``figure()`` function, assign the
``NumeralTickFormatter`` to the ``formatter`` property of your plot's ``yaxis``:

.. code-block:: python

    p.yaxis[0].formatter = NumeralTickFormatter(format="$0.00")

The :class:`~bokeh.models.formatters.NumeralTickFormatter` supports different
formats, including ``"$0.00"`` to generate values such as ``"$7.42"``.

This is what the completed code looks like:

.. literalinclude:: examples/first_steps_4_tick_formatter.py
   :language: python
   :emphasize-lines: 1,17

.. seealso::
    For more information about formatting ticks, see
    :ref:`userguide_styling_axes_tick_label_formats` in the user guide. For a
    list of all available tick formatters, see :class:`~bokeh.models.formatters`
    in the reference guide.

Enabling logarithmic axes
~~~~~~~~~~~~~~~~~~~~~~~~~

You can also change the axis type altogether. Use ``y_axis_type="log"`` to
switch to logarithmic axes:

.. literalinclude:: examples/first_steps_4_axes_logarithmic.py
   :language: python
   :emphasize-lines: 15,16

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_axes_logarithmic.py
    :source-position: none

Enabling datetime axes
~~~~~~~~~~~~~~~~~~~~~~

Set the ``x_axis_type`` or ``y_axis_type`` to ``datetime`` to display date or
time information on an axis. Bokeh then creates a
:class:`~bokeh.models.axes.DatetimeAxis`.

To format the ticks of a ``DatetimeAxis``, use the
:class:`~bokeh.models.formatters.DatetimeTickFormatter`.

.. literalinclude:: examples/first_steps_4_datetime_axis.py
   :language: python
   :emphasize-lines: 15,28

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_datetime_axis.py
    :source-position: none

.. seealso::
    See :ref:`userguide_styling_axes` in the user guide for more information on
    customizing axes. The entry for :class:`~bokeh.models.Axis` in the
    reference guide contains a list of all available attributes you can use to
    customize the axes of your plot.

.. _first_steps_4_grid:

Customizing the grid
--------------------

To change the appearance of the grid, set the various properties of the
:func:`~bokeh.models.plots.Plot.xgrid`,
:func:`~bokeh.models.plots.Plot.ygrid`, and
:func:`~bokeh.models.plots.Plot.grid` methods of your |Plot| object.

Styling lines
~~~~~~~~~~~~~

Change what the horizontal and vertical lines of your grid look like by setting
the various ``grid_line`` properties:

.. literalinclude:: examples/first_steps_4_grid_lines.py
   :language: python
   :emphasize-lines: 19,22,23

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_grid_lines.py
    :source-position: none

.. seealso::
    For more information on lines and minor lines, see
    :ref:`userguide_styling_grid_lines` in the user guide.

Using bands and bounds
~~~~~~~~~~~~~~~~~~~~~~

Another way to make reading your plot easier is to use bands and bounds.

Bands and bounds are more examples of the annotations you learned about in
:ref:`first_steps_3_annotations`.

.. literalinclude:: examples/first_steps_4_bands.py
   :language: python
   :emphasize-lines: 19,20,23

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_bands.py
    :source-position: none

.. seealso::
    For more information on styling bands and bounds, see
    :ref:`userguide_styling_grid_bands` and :ref:`userguide_styling_grid_bounds`
    in the user guide.

Setting background colors
~~~~~~~~~~~~~~~~~~~~~~~~~

You have several options to :ref:`define colors <userguide_styling_colors>` in
Bokeh. For example:

* Use one of the |named CSS colors| (for example, ``"firebrick"``)
* Use hexadecimal values, prefaced with a ``#`` (for example ``"#00ff00"``)
* Use a 3-tuple for RGB colors (for example, ``(100, 100, 255)``
* Use a 4-tuple for RGBA colors (for example ``(100, 100, 255, 0.5)``)

To change the appearance of the plane that Bokeh draws your plot elements on,
use the various ``fill_color`` attributes of your |Plot| object:

.. literalinclude:: examples/first_steps_4_background.py
   :language: python
   :emphasize-lines: 19-21

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_background.py
    :source-position: none

.. seealso::
    For more information on colors in Bokeh, see the entry for |Color| in the
    reference guide.

.. _first_steps_4_toolbar:

Customizing the toolbar
-----------------------

Bokeh comes with a powerful toolbar to explore plots. You saw those tools in
your very fist visualization, as part of
:ref:`first step guide 1 <first_steps_1_line_chart>`.

Positioning the toolbar
~~~~~~~~~~~~~~~~~~~~~~~
To define the position of the toolbar, use the
:class:`~bokeh.models.plots.Plot.toolbar_location` attribute with one of these
values: ``above``, ``below``, ``left``, ``right``

Pass a value to ``toolbar_location`` when creating your figure:

.. code-block:: python

    p = figure(title="Toolbar positioning example", toolbar_location="below")

Another option is to change the attribute ``toolbar_location`` at any time after
creating your figure:

.. code-block:: python

    p.toolbar_location = "below"

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_toolbar.py
    :source-position: none

Deactivating and hiding the toolbar
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To deactivate the toolbar completely, set ``toolbar_location`` to ``None``.

.. code-block:: python

    p.toolbar_location = None

To make your toolbar hide automatically, set
:class:`~bokeh.models.tools.Toolbar.autohide` to ``True``:

.. literalinclude:: examples/first_steps_4_toolbar_autohide.py
   :language: python
   :emphasize-lines: 16

With ``autohide`` set to ``True``, Bokeh will hide the toolbar unless the mouse
is inside the plot area or you tap inside the plot area:

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_toolbar_autohide.py
    :source-position: none

Similarly, use the :class:`~bokeh.models.tools.Toolbar.logo` property of the
:class:`~bokeh.models.tools.Toolbar` to deactivate the Bokeh logo:

.. code-block:: python

    p.toolbar.logo = None

Customizing available tools
~~~~~~~~~~~~~~~~~~~~~~~~~~~

You can customize which tools Bokeh displays in the toolbar. For a detailed
list of all available tools, see :ref:`userguide_tools` in the
user guide.

To customize which tools to use, you first need to import the relevant tools.
For example:

.. code-block:: python

    from bokeh.models.tools import BoxZoomTool, ResetTool

Next, define which tools to use when creating a new figure by passing the
``tools`` attribute to the |figure| function.

The ``tools`` attribute accepts a list of tools. This example enables only the
:class:`~bokeh.models.tools.BoxZoomTool` and
:class:`~bokeh.models.tools.ResetTool`:

.. code-block:: python

    p = figure(tools = [BoxZoomTool(), ResetTool()])

This way, only the box zoom tool and the reset tool will be available in the
toolbar:

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_tools.py
    :source-position: none

To change the available tools at any time after creating your figure,
use the :func:`~bokeh.models.plots.Plot.add_tools` and :func:`~bokeh.models.plots.Plot.remove_tools` functions.

All tools also offer various properties to define how they can be used. With the
:class:`~bokeh.models.tools.PanTool`, for example, you can limit the movement to
only horizontal or vertical panning. The default behavior is to allow panning in
both directions.

.. literalinclude:: examples/first_steps_4_add_tools.py
   :language: python
   :emphasize-lines: 1,11,19

In this example, you first include the box zoom tool and the reset tool when
creating your function. Next, you add a pan zoom tool. This results in all three
tools being available:

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_add_tools.py
    :source-position: none

.. seealso::
    To learn more about tools and toolbars, see :ref:`userguide_tools`. For
    detailed information about all tools and their respective properties, see
    :class:`~bokeh.models.tools` and :class:`~bokeh.models.tools.Toolbar` in the
    reference guide.

.. _first_steps_4_tooltips:

Adding tooltips
---------------

Tooltips are little windows that appear when you hover your mouse over a
data point or when you tap on a data point:

.. bokeh-plot:: docs/first_steps/examples/first_steps_4_tooltips.py
    :source-position: none

Tooltips are based on the :class:`~bokeh.models.tools.HoverTool`. The hover tool
is part of Bokeh's toolbar.

There are several ways to enable tooltips in Bokeh. This is the quickest:

1. Import the :class:`~bokeh.models.tools.HoverTool` class from
   :class:`bokeh.models.tools`.

2. Include ``HoverTool()`` in the list passed to the ``tools`` argument when
   calling the |figure| function.

3. Include the :class:`~bokeh.models.tools.HoverTool.tooltips` argument when
   calling the |figure| function.

The ``tooltips`` argument accepts a string with a special syntax. Use the "@"
symbol to include the name of the source for the data you want Bokeh to display.
This example includes ``@x`` and ``@y``. When the browser displays a tooltip,
Bokeh replaces both those fields with the actual data from the lists ``x`` and
``y`` .

This is what the code looks like:

.. literalinclude:: examples/first_steps_4_tooltips.py
   :language: python
   :emphasize-lines: 1,11,12

.. seealso::
    The user guide contains much more information on using the hover tool to
    create tooltips. See :ref:`userguide_tools_basic_tooltips` for more details.
    More information is also available at the entry for
    :class:`~bokeh.models.tools.HoverTool` in the reference guide.
.. _first_steps_5:

First steps 5: Vectorizing glyph properties
===========================================

In the :ref:`previous first steps guide <first_steps_4>`, you customized
various aspects of your plot by adding and changing attributes.

In this section, you will use vectors of data to influence aspects of your
plot and its elements.

.. _first_steps_5_colors:

Vectorizing colors
------------------

So far, you have assigned specific colors to a glyph by using properties such as
``fill_color``.

To change colors depending on values in a variable, pass a variable containing
color information to the ``fill_color`` attribute:

.. literalinclude:: examples/first_steps_5_vectorize_color.py
   :language: python
   :emphasize-lines: 10,22

.. bokeh-plot:: docs/first_steps/examples/first_steps_5_vectorize_color.py
    :source-position: none

In this example, the color of every circle corresponds to the y value of that
circle.

.. seealso::
    For more information on how to map data points to colors and color palettes,
    see :ref:`userguide_styling_using_mappers` in the user guide.

.. _first_steps_5_colors_and_radii:

Vectorizing colors and sizes
----------------------------

To create a plot with colors and sizes in relation to your data, apply the same
principle to the ``radius`` argument of your renderer:

.. literalinclude:: examples/first_steps_5_vectorize_color_and_size.py
   :language: python
   :emphasize-lines: 11-12, 26-27

.. bokeh-plot:: docs/first_steps/examples/first_steps_5_vectorize_color_and_size.py
    :source-position: none

In this example, the color and diameter of every circle correspond to the y
value of that circle.

Color mapping with palettes
---------------------------------------

Bokeh comes with dozens of pre-defined color palettes that you can use to map
colors to your data. This includes palettes from `Brewer`_, `D3`_, or
`Matplotlib`_. See :class:`~bokeh.palettes` for a list of all available
palettes.

First, use the :func:`~bokeh.transform.linear_cmap` function to create a color
map for your data. The required attributes for this function are:

* ``field_name``: the data sequence to map colors to
* ``palette``: the palette to use
* ``low``: the lowest value to map a color to
* ``high``: the highest value to map a color to

Then assign your color mapper to the ``color`` parameter of your renderer:

.. literalinclude:: examples/first_steps_5_color_mapping.py
   :language: python
   :emphasize-lines: 2,4,11,17

.. bokeh-plot:: docs/first_steps/examples/first_steps_5_color_mapping.py
    :source-position: none

.. seealso::
   For more information about color mapping and other similar operations, see
   :ref:`userguide_styling_using_mappers` and :ref:`userguide_data_transforming`
   in the user guide. In addition to ``linear_cmap``, this includes ``log_cmap``
   and ``factor_cmap``, for example.

   To learn more about Bokeh's color palettes, see :class:`~bokeh.palettes` in
   the reference guide. This document contains an overview of all available
   palettes and the various ways you can make those palettes available to your
   plots.

.. _Brewer: http://colorbrewer2.org/#type=sequential&scheme=BuGn&n=3
.. _D3: https://github.com/d3/d3-3.x-api-reference/blob/master/Ordinal-Scales.md#categorical-colors
.. _Matplotlib: https://matplotlib.org/examples/color/colormaps_reference.html
.. _first_steps_9:

First steps 9: Using widgets
============================

In the :ref:`previous first steps guides <first_steps_8>`, you used different
sources and structures to import and filter data.

In this section, you will add interactive widgets to your plots.

Adding widgets
--------------

Widgets are additional visual elements that you can include in your
visualization. Use widgets to display additional information or to
interactively control elements of your Bokeh document, for example:

.. bokeh-plot:: docs/first_steps/examples/first_steps_9_widgets.py
    :source-position: none

This Bokeh document combines a plot with three widgets:

* A :class:`~bokeh.models.widgets.markups.Div` widget to display HTML text
* A :class:`~bokeh.models.widgets.inputs.Spinner` widget to select a numeric
  value
* A :class:`~bokeh.models.widgets.sliders.RangeSlider` widget to adjust a
  range

See :ref:`userguide_interaction_widgets_examples` in the user guide for a
complete list of Bokeh's widgets.

Follow these steps to recreate the example from above:

1. Import the ``Div``, ``RangeSlider``, and ``Spinner`` widgets
   from ``bokeh.models``:

    .. code-block:: python

        from bokeh.models import Div, RangeSlider, Spinner

2. Set up your data, your figure, and your renderer:

    .. code-block:: python

        x = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
        y = [4, 5, 5, 7, 2, 6, 4, 9, 1, 3]

        p = figure(x_range=(1,9), width=500, height=250)
        points = p.circle(x=x, y=y, size=30, fill_color="#21a7df")

3. Create a ``Div`` object and pass it some HTML code as a string:

    .. code-block:: python

        div = Div(
            text="""
                <p>Select the circle's size using this control element:</p>
                """,
            width=200,
            height=30,
        )

4. Create a ``Spinner`` object:

    .. code-block:: python

        spinner = Spinner(
            title="Circle size",  # a string to display above the widget
            low=0,  # the lowest possible number to pick
            high=60,  # the highest possible number to pick
            step=5,  # the increments by which the number can be adjusted
            value=points.glyph.size,  # the initial value to display in the widget
            width=200,  #  the width of the widget in pixels
            )

5. To link the value generated by the spinner to the ``size`` property of your
   glyph, use the :func:`~bokeh.model.Model.js_link` function. This function
   uses JavaScript to interactively link two Bokeh models. The first argument
   you pass to this function is the attribute of your spinner (``"value"``)
   that you want to link to your circle glyphs. The second attribute is the
   glyph you want to link to your spinner (``points.glyph``). The third
   argument is the property of your glyph that you want to link to your
   spinner's ``value``:

    .. code-block:: python

        spinner.js_link("value", points.glyph, "size")

6. Create a RangeSlider object:

    .. code-block:: python

        range_slider = RangeSlider(
            title="Adjust x-axis range", # a title to display above the slider
            start=0,  # set the minimum value for the slider
            end=10,  # set the maximum value for the slider
            step=1,  # increments for the slider
            value=(p.x_range.start, p.x_range.end),  # initial values for slider
            )

7. To link the values generated by the RangeSlider to the existing plot, use the
   :func:`~bokeh.model.Model.js_link` function again. This time, however, you
   need to assign two values at once: the beginning of the plot's x-axis and
   the end of its x-axis. The RangeSlider returns a tuple of those two values.
   Therefore, you need to use the ``attr_selector`` of the ``js_link()``
   function to tell Bokeh which part of the Tuple to assign to either the start
   or the end of the plot's x-axis:

    .. code-block:: python

        range_slider.js_link("value", p.x_range, "start", attr_selector=0)
        range_slider.js_link("value", p.x_range, "end", attr_selector=1)

8. Create a layout with all the elements of your dashboard and display it in a
   browser:

    .. code-block:: python

        layout = layout([
            [div, spinner],
            [range_slider],
            [p],
        ])

        show(layout)

This is what the completed example looks like:

.. literalinclude:: examples/first_steps_9_widgets.py
   :language: python
   :emphasize-lines: 2,14-20,23-31,34-42

.. seealso::
    To learn more about Bokeh's widgets and building interactive dashboards, see
    :ref:`userguide_interaction_widgets` in the user guide.

    To learn about creating interactive legends, see |interactive legends| in
    the user guide.

    See :ref:`userguide_interaction_jscallbacks` in the user guide to learn more
    about adding custom JavaScript code that you can use in combination
    with widgets, among other things.

    To learn more about combining widgets and plots into layouts, see
    :ref:`userguide_layout` in the user guide.

Using widgets with a Bokeh server
---------------------------------

Another way to use widgets is with a Bokeh server application. Bokeh includes a
standalone server component. Use the Bokeh server if you want to connect your
JavaScript-based visualization running in a browser to Python code running on a
server.

Use this command on a command line to start Bokeh in server mode:

.. code-block:: sh

    bokeh serve

You can use Bokeh Server to build complex dashboards and interactive
applications. Some of the capabilities of the Bokeh server include:

* UI widgets and plot selections that drive computations and plot updates
* Streaming live data to automatically updating plots
* Intelligent server-side downsampling of large datasets
* Sophisticated glyph re-writing and transformations for “Big Data”
* Plot and dashboard publishing for wider audiences

This is an example of a simple Bokeh server app. Adjust the sliders in the
widgets on the left to change the sine wave on the right:

.. raw:: html

    <div>
    <iframe
        src="https://demo.bokeh.org/sliders"
        frameborder="0"
        style="overflow:hidden;height:460px;width: 120%;
        -moz-transform: scale(0.85, 0.85);
        -webkit-transform: scale(0.85, 0.85);
        -o-transform: scale(0.85, 0.85);
        -ms-transform: scale(0.85, 0.85);
        transform: scale(0.85, 0.85);
        -moz-transform-origin: top left;
        -webkit-transform-origin: top left;
        -o-transform-origin: top left;
        -ms-transform-origin: top left;
        transform-origin: top left;"
        height="460"
    ></iframe>
    </div>

Find the source code for this Bokeh server app in the
`Bokeh repository on GitHub <https://github.com/bokeh/bokeh/blob/master/examples/app/sliders.py>`_.
For more examples of Bokeh server applications, see the
:ref:`gallery_server_examples` section of the :ref:`gallery`.

.. seealso::
    For information on using the server and writing Bokeh server plots
    and apps, see :ref:`userguide_server` in the user guide.

    For more examples of Bokeh server applications, see the
    :ref:`gallery_server_examples` section of the :ref:`gallery`.

    An easy way to create more complex dashboards is to use
    `Panel (https://panel.holoviz.org) <https://panel.holoviz.org/index.html>`_.
    Panel is a separate Python library that uses Bokeh and Bokeh server in the
    background.

Next steps
----------

Congratulations, you have completed all of Bokeh's first steps guides!

More information about Bokeh is available in the |user guide|. For more in-depth
information about all aspects of Bokeh, see the |reference guide|.

For more examples of what you can do with Bokeh, check the :ref:`gallery` and
the :bokeh-tree:`examples` directory in Bokeh's GitHub repository.

Finally, on the `Bokeh community page <https://bokeh.org/community/>`_, you can
find links and information about asking for help and contributing to Bokeh and
the Bokeh community.
.. _first_steps_1:

First steps 1: Creating a line chart
====================================

With just a few lines of Python code, Bokeh enables you to create
interactive, JavaScript-powered visualizations displayable in a web browser.

The basic idea of Bokeh is a two-step process: First, you select from Bokeh's
building blocks to create your visualization. Second, you customize these
building blocks to fit your needs.

To do that, Bokeh combines two elements:

* A Python library for defining the content and interactive functionalities of
  your visualization.
* A JavaScript library called BokehJS that is working in the background to
  display your interactive visualizations in a web browser.

Based on your Python code, Bokeh automatically generates all the necessary
JavaScript and HTML code for you. In its default setting, Bokeh automatically
loads any additional JavaScript code from Bokeh's CDN (content delivery
network).

Bokeh's documentation consists of several elements, including the
|user guide| with detailed explanations and examples and the |reference guide|
that systematically describes every element of Bokeh. In this guide, you will
find links to both those resources.

.. _first_steps_1_line_chart:

Creating a simple line chart
----------------------------

Your first visualization will be a plot with a single line that looks like
this:

.. bokeh-plot:: docs/first_steps/examples/first_steps_1_simple_line.py
    :source-position: none

Even a simple graph like this has interactive features. Use the tools on the
right of the plot to explore:

* |pan_tool| Use the **pan tool** to move the graph within your plot.
* |box_zoom| Use the **box zoom tool** to zoom into an area of your plot.
* |wheel_zoom| Use the **wheel zoom tool** to zoom in and out with a mouse
  wheel.
* |save_tool| Use the **save tool** to export the current view of your plot as a
  PNG file.
* |reset| Use the **reset tool** to return your view to the plot's default
  settings.
* |help| Use the **help symbol** to learn more about the tools available in
  Bokeh.

Follow these steps to recreate this simple line chart:

1. Import the necessary functions from the |bokeh.plotting| module:

    .. code-block:: python

        from bokeh.plotting import figure, show

2. Define two lists containing the data for your line chart:

    .. code-block:: python

        # prepare some data
        x = [1, 2, 3, 4, 5]
        y = [6, 7, 2, 4, 5]

3. Use the |figure| function to create your plot. Pass the following arguments:

   * ``title``: the title of your line chart (optional)
   * ``x_axis_label``: a text label to put on the chart's x-axis (optional)
   * ``y_axis_label``: a text label to put on the chart's y-axis (optional)

    .. code-block:: python

        # create a new plot with a title and axis labels
        p = figure(title="Simple line example", x_axis_label='x', y_axis_label='y')

4. Add a line graph to the plot you just created, using the
   :func:`~bokeh.plotting.figure.line` function. Pass the following arguments:

   * your lists ``x`` and ``y`` containing the data
   * ``legend_label``: a string to label the line graph with (optional)
   * ``line_width``: define the line width (in pixels, optional)

    .. code-block:: python

        # add a line renderer with legend and line thickness to the plot
        p.line(x, y, legend_label="Temp.", line_width=2)

5. Finally, use the |show| function to generate your graph and
   open a web browser to display the generated HTML file.

    .. code-block:: python

        # show the results
        show(p)

When you execute these lines of code, Bokeh creates an output file
``"lines.html"``. Bokeh also opens a browser to display it.

This is what the completed code for your line graph should look like:

.. literalinclude:: examples/first_steps_1_simple_line.py
   :language: python

Combining multiple graphs
-------------------------

With Bokeh's |bokeh.plotting| interface, you can add more glyphs to your plot:

.. bokeh-plot:: docs/first_steps/examples/first_steps_1_multiple_lines.py
    :source-position: none

To add more line graphs to your plot, all you need to do is call the
:func:`~bokeh.plotting.figure.line` function multiple times.

First, add more data as the basis for additional graphs:

.. code-block:: python

    # prepare some data
    x = [1, 2, 3, 4, 5]
    y1 = [6, 7, 2, 4, 5]
    y2 = [2, 3, 4, 5, 6]
    y3 = [4, 5, 5, 7, 2]

Next, update the title for your plot by changing the string for the ``title``
argument in the |figure| function:

.. code-block:: python

    # create a new plot with a title and axis labels
    p = figure(title="Multiple line example", x_axis_label='x', y_axis_label='y')

Finally, add more calls to the |figure.line| function:

.. code-block:: python

    # add multiple renderers
    p.line(x, y1, legend_label="Temp.", color="blue", line_width=2)
    p.line(x, y2, legend_label="Rate", color="red", line_width=2)
    p.line(x, y3, legend_label="Objects", color="green", line_width=2)

In this example, you also assign a different color to each of the lines by
passing a different :ref:`named color <userguide_styling_colors>` to each line's
``color`` argument.

This is what the completed code for your multi-line plot should look like:

.. literalinclude:: examples/first_steps_1_multiple_lines.py
   :language: python

Recap: building visualizations
------------------------------

You just completed all the basic steps that most basic visualizations with
Bokeh's |bokeh.plotting| interface require:

1. Preparing the data
    You used a plain Python list, but other forms of serialized data work
    as well.

2. Calling the |figure| function
    This creates a plot with the most common default options. You can customize
    various properties of your plot, such as its title, tools, and axes labels.

3. Adding renderers
    You used |figure.line| to create a line. Renderers have various options
    that allow you to specify visual attributes such as colors, legends, and
    widths.

4. Asking Bokeh to |show| or |save| the results
    These functions either save your plot to an HTML file or display it in a
    browser.

.. |pan_tool| image:: /_images/icons/Pan.png
    :alt: Icon representing the pan tool
    :height: 19px
.. |box_zoom| image:: /_images/icons/BoxZoom.png
    :alt: Icon representing box zoom
    :height: 19px
.. |wheel_zoom| image:: /_images/icons/WheelZoom.png
    :height: 19px
    :alt: Icon representing the wheel zoom
.. |save_tool| image:: /_images/icons/Save.png
    :height: 19px
    :alt: Icon representing the save tool
.. |reset| image:: /_images/icons/Reset.png
    :height: 19px
    :alt: Icon representing the reset tool
.. |help| image:: /_images/icons/Help.png
    :height: 19px
    :alt: Help symbol

.. |figure.line|     replace:: :func:`~bokeh.plotting.figure.line`
.. _first_steps_6:

First steps 6: Combining plots
==============================

In the :ref:`previous first steps guides <first_steps_5>`, you created
individual plots.

In this section, you will combine several plots into different kinds of layouts.

Creating rows, columns, and grids
---------------------------------

The easiest way to combine individual plots is to assign them to rows or
columns.

For example:

.. bokeh-plot:: docs/first_steps/examples/first_steps_6_row_layout.py
    :source-position: none

To combine several plots into a horizontal row layout, you first need to import
``row``. Then use the :func:`~bokeh.layouts.row` function when calling
``show()``:

.. literalinclude:: examples/first_steps_6_row_layout.py
   :language: python
   :emphasize-lines: 1,21

To display several plots in a vertical column layout, use the
:func:`~bokeh.layouts.column` function instead.

A more flexible way to arrange elements in Bokeh is to use the
:func:`~bokeh.layouts.gridplot` function.

.. seealso::
    For more information on ``row()``, ``column()``, and ``gridplot()``, see
    :ref:`userguide_layout` in the user guide.

Defining sizing behavior
------------------------

You can use the functions ``row()``, ``column()``, and ``gridplot()`` with
additional arguments to define how Bokeh scales the individual plots. See
:class:`~bokeh.models.layouts.LayoutDOM.sizing_mode` for a list of all sizing
modes that Bokeh supports.

For example: To make all plots in a row responsively fill the available width
of the browser window, assign ``scale_width`` to ``sizing_mode``:

.. literalinclude:: examples/first_steps_6_row_layout_responsive.py
   :language: python
   :emphasize-lines: 22

.. bokeh-plot:: docs/first_steps/examples/first_steps_6_row_layout_responsive.py
    :source-position: none

.. seealso::
    For more information on sizing modes, see
    :ref:`userguide_layout_sizing_mode` in the user guide.
.. _first_steps_3:

First steps 3: Adding legends, text, and annotations
====================================================

In the :ref:`previous first steps guide <first_steps_2>`, you generated
different glyphs and defined their appearance.

In this section, you will add and style a :ref:`legend<first_steps_3_legend>`
and a :ref:`headline<first_steps_3_headlines>`. You will also add additional
information to your plot by including
:ref:`annotations<first_steps_3_annotations>`.

.. _first_steps_3_legend:

Adding and styling a legend
---------------------------

Bokeh automatically adds a legend to your plot if you include the
``legend_label`` attribute when calling the renderer function. For example:

.. code-block:: python

    p.circle(x, y3, legend_label="Objects")

This adds a legend with the entry "Objects" to your plot.

Use the properties of the |Legend| object to customize the legend. For example:

.. literalinclude:: examples/first_steps_3_legend.py
   :language: python
   :emphasize-lines: 16,24,27,30-32,35-39

.. bokeh-plot:: docs/first_steps/examples/first_steps_3_legend.py
    :source-position: none

.. seealso::
    To learn more about legends, see :ref:`userguide_annotations_legends` in the
    annotations section and :ref:`userguide_styling_legends` in the styling
    section of the user guide. The entry |Legend| in the reference guide
    contains a list of all available attributes for legends.

    See |interactive legends| in the user guide to learn about using legends to
    hide or mute glyphs in a plot.

.. _first_steps_3_headlines:

Customizing headlines
---------------------

Most of the examples so far have included a headline. You did this by passing
the ``title`` argument to the |figure| function:

.. code-block:: python

    p = figure(title="Headline example")

There are various ways to style the text for your headline. For example:

.. literalinclude:: examples/first_steps_3_title.py
   :language: python
   :emphasize-lines: 8,14,17,20-23

.. bokeh-plot:: docs/first_steps/examples/first_steps_3_title.py
    :source-position: none

.. seealso::
    For more information on working with ``title``, see
    :ref:`userguide_annotations_titles` in the user guide. In the reference guide,
    the entry for :class:`~bokeh.models.annotations.Title` contains a list of
    all available properties.

.. _first_steps_3_annotations:

Using annotations
-----------------

Annotations are visual elements that you add to your plot to make it easier
to read. For more information on the various kinds of annotations, see
:ref:`userguide_annotations` in the user guide.

One example are box annotations. You can use box annotations to highlight
certain areas of your plot:

.. bokeh-plot:: docs/first_steps/examples/first_steps_3_box_annotation.py
    :source-position: none

To add box annotations to your plot, you first need to import the
|BoxAnnotation| class from |bokeh.models|:

.. code-block:: python

    from bokeh.models import BoxAnnotation

Next, create the |BoxAnnotation| objects. If you do not pass a value for
``bottom`` or ``top``, Bokeh automatically extends the box's dimension to the
edges of the plot:

.. code-block:: python

    low_box = BoxAnnotation(top=20, fill_alpha=0.2, fill_color="#F0E442")
    mid_box = BoxAnnotation(bottom=20, top=80, fill_alpha=0.2, fill_color="#009E73")
    high_box = BoxAnnotation(bottom=80, fill_alpha=0.2, fill_color="#F0E442")

Finally, you need to add the |BoxAnnotation| objects to your existing figure.
Use the |add layout| method to add your boxes:

.. code-block:: python

    p.add_layout(low_box)
    p.add_layout(mid_box)
    p.add_layout(high_box)

This is what the finished code looks like:

.. literalinclude:: examples/first_steps_3_box_annotation.py
   :language: python
   :emphasize-lines: 3,17-19,22-24

.. seealso::
    To find out more about the different kinds of annotations in Bokeh, see
    :ref:`userguide_annotations` in the user guide.
.. _first_steps_8:

First steps 8: Providing and filtering data
===========================================

In the :ref:`previous first steps guides <first_steps_7>`, you used different
methods to display and export your visualizations.

In this section, you will use various sources and structures to import and
filter data.

.. _first_steps_8_column_data_source:

Using ColumnDataSource
----------------------

The :class:`~bokeh.models.sources.ColumnDataSource` is Bokeh's own data
structure. For details about the ``ColumnDataSource``, see |ColumnDataSource| in
the user guide.

So far, you have used data sequences like Python lists and NumPy arrays to pass
data to Bokeh. Bokeh has automatically converted these lists into
``ColumnDataSource`` objects for you.

Follow these steps to create a ``ColumnDataSource`` directly:

* First, import :class:`~bokeh.models.sources.ColumnDataSource`.
* Next, create a dict with your data: The dict's keys are the column names
  (strings). The dict's values are lists or arrays of data.
* Then, pass your dict as the ``data`` argument to
  :class:`~bokeh.models.sources.ColumnDataSource`:
* You can then use your ``ColumnDataSource`` as ``source`` for your
  renderer.

.. code-block:: python

    from bokeh.plotting import figure
    from bokeh.models import ColumnDataSource

    # create dict as basis for ColumnDataSource
    data = {'x_values': [1, 2, 3, 4, 5],
            'y_values': [6, 7, 2, 3, 6]}

    # create ColumnDataSource based on dict
    source = ColumnDataSource(data=data)

    # create a plot and renderer with ColumnDataSource data
    p = figure()
    p.circle(x='x_values', y='y_values', source=source)

.. seealso::
   For more information on Bokeh's ``ColumnDataSource``, see
   |ColumnDataSource| in the user guide and
   :class:`~bokeh.models.sources.ColumnDataSource` in the reference guide.

   For information about adding data to a ColumnDataSource, see
   :ref:`userguide_data_cds_streaming`. Information about replacing data of a
   ColumnDataSource is available at :ref:`userguide_data_cds_patching` in the
   user guide.

   For more information on using Python lists, see
   :ref:`userguide_data_python_lists`. For more information on using NumPy
   data with Bokeh, see :ref:`userguide_data_numpy`.

Converting pandas data
^^^^^^^^^^^^^^^^^^^^^^

To use data from a pandas ``DataFrame``, pass your pandas data to a
``ColumnDataSource``:

.. code-block:: python

   source = ColumnDataSource(df)

.. seealso::
   For more information on using pandas data in Bokeh, see
   :ref:`userguide_data_cds_pandas_data_frame` in the user guide. This
   includes information on using pandas ``DataFrame``, ``MultiIndex``, and
   ``GroupBy`` data.

Filtering data
--------------

Bokeh comes with various filtering methods. Use these filters if you want to
create a specific subset of the data contained in your ColumnDataSource.

In Bokeh, these filtered subsets are called "views". Views are represented by
Bokeh's :class:`~bokeh.models.sources.CDSView` class.

To plot with a filtered subset of data, pass a ``CDSView`` object to the
``view`` argument of your renderer.

A :class:`~bokeh.models.sources.CDSView` object has one property:

* ``filters``: a list of :class:`~bokeh.models.filters.Filter` objects

The simplest filter is the :class:`~bokeh.models.filters.IndexFilter`. An
IndexFilter uses a list of index positions and creates a view that contains
nothing but the data points located at those index positions.

For example, if your ColumnDataSource contains a list of five values and you
apply an IndexFilter with ``[0,2,4]``, the resulting ``view`` contains only the
first, the third, and the fifth value of your original list:

.. literalinclude:: examples/first_steps_8_filter.py
   :language: python
   :emphasize-lines: 2,9,20

.. bokeh-plot:: docs/first_steps/examples/first_steps_8_filter.py
    :source-position: none

.. seealso::
   For more information on the various filters in Bokeh, see
   :ref:`userguide_data_filtering` in the user guide. More information is also
   available in the entries for :class:`~bokeh.models.sources.CDSView` and
   :class:`~bokeh.models.filters.Filter` in the reference guide.
.. _installation:

Installation details
====================

This section provides more detailed information about installing Bokeh. This
includes details about Bokeh's prerequisites as well as Bokeh's required and
optional dependencies.

Supported platforms
-------------------

Bokeh is officially supported (and continuously tested) on CPython versions
:bokeh-minpy:`cpython` and later. It's possible that Bokeh does work on other
versions of Python, but no guarantees or support are provided.

Installing with ``conda`` or ``pip``
------------------------------------

The easiest way to install Bokeh is to use ``conda``. Conda is part of the
`Anaconda Python Distribution`_, which is designed with scientific and data
analysis applications like Bokeh in mind.

If you use Anaconda on your system, installing with ``conda`` is the recommended
method. Otherwise, use ``pip``.


.. panels::

    Installing with ``conda``
    ^^^^^^^^^^^^^^^^^^^^^^^^^

    Make sure you have either `Anaconda`_ or `Miniconda`_ installed. Use
    this command to install Bokeh:

    .. code-block:: sh

        conda install bokeh

    Alternatively, if you want to make sure you always have the most recent
    version of Bokeh after each new release, install from the
    `Bokeh channel <https://anaconda.org/bokeh/bokeh>`_ directly:

    .. code-block:: sh

        conda install -c bokeh bokeh

    ---

    Installing with ``pip``
    ^^^^^^^^^^^^^^^^^^^^^^^

    Use this command to install Bokeh:

    .. code-block:: sh

        pip install bokeh

    .. note::
        On some systems, pip displays an error message about the wheel package
        when installing tornado. This is a `known issue`_, you can usually
        ignore the error.

Checking your installation
--------------------------

To verify whether the installation was successful, use this command:

.. code-block:: sh

    bokeh info

You should see, among other things, a line with information on the installed
version of Bokeh.

If you receive an error instead, try searching for more information by using
the `"bokeh" tag on Stack Overflow`_ or asking a question in the
`Bokeh Discourse`_ community.

.. tip::
    Once you have Bokeh installed, build your first visualization by following
    the :ref:`first steps guides <first_steps_overview>`.

    Check the |user guide| for a comprehensive overview of all the things you
    can do with Bokeh.

Installing for development
--------------------------

If you want to install a development version of Bokeh to contribute to the
project, please see the :ref:`contributor_guide_setup` instructions in the
|contributor guide|.

.. _install_required:

Installing required dependencies
--------------------------------

For basic usage, Bokeh requires the following libraries:

:bokeh-requires:`cpython`

All those packages are automatically installed if you use ``conda`` or
``pip``.

.. _install_optional:

Installing optional dependencies
--------------------------------

In addition to the required dependencies, some additional packages are
necessary for certain optional features:

Jupyter
    Bokeh can display content in classic Jupyter notebooks as well as in
    JupyterLab. Depending on your setup, there may be additional packages or
    Jupyter extensions to install. See :ref:`userguide_jupyter` for full
    details.

NodeJS
    Necessary for :ref:`userguide_extensions` or for defining
    ``CustomJS`` implementations in TypeScript.

NetworkX
    Necessary to use the :func:`~bokeh.plotting.graph.from_networkx` function
    to generate Bokeh graph renderers directly from NetworkX data.

pandas
    Necessary for the :func:`~bokeh.plotting.figure.hexbin` function.
    Additionally, having pandas installed makes some aspects of Bokeh simpler
    to use. For example, glyph functions are able to automatically convert
    pandas DataFrames to Bokeh data sources.

psutil
    Necessary to enable detailed memory logging in the Bokeh server.

Selenium, GeckoDriver, Firefox
    Necessary for :ref:`userguide_export` to PNG and SVG images.

Sphinx
    Necessary to make use of the ``bokeh.sphinxext`` Sphinx extension for
    including Bokeh plots in Sphinx documentation.

.. _install_sampledata:

Installing sample data
----------------------

Optionally, Bokeh can download and install a collection of sample data. This
includes a variety of freely available data tables and databases that you can
use with Bokeh. Because this sample data is rather large, it is not included in
Bokeh's installation packages.

In `Bokeh's GitHub repository`_, you can find a number of examples. Those
examples also use this sample data. See :ref:`bokeh.sampledata` for more
information on the data sets included in Bokeh's sample data.

After installing Bokeh, you can automatically download and install the
sample data with this command:

.. code-block:: sh

    bokeh sampledata

Alternatively, you can download and install the sample data from within your
Python code:

.. code-block:: python

    import bokeh.sampledata
    bokeh.sampledata.download()

If you want to change the location where Bokeh stores the sample data, check
the |bokeh.sampledata| reference for details.

.. _install_bokehjs:

Installing standalone BokehJS
-----------------------------

BokehJS is Bokeh's client-side runtime library. You can also use BokehJS as a
standalone JavaScript library. To do so, download the code from Bokeh's content
delivery network (CDN) at ``cdn.bokeh.org``. The CDN uses the following naming
scheme::

    # Javascript files
    https://cdn.bokeh.org/bokeh/release/bokeh-x.y.z.min.js
    https://cdn.bokeh.org/bokeh/release/bokeh-widgets-x.y.z.min.js
    https://cdn.bokeh.org/bokeh/release/bokeh-tables-x.y.z.min.js
    https://cdn.bokeh.org/bokeh/release/bokeh-api-x.y.z.min.js
    https://cdn.bokeh.org/bokeh/release/bokeh-gl-x.y.z.min.js
    https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-x.y.z.min.js

There are additional components to BokehJS that are necessary only for specific
use cases:

* The ``"-widgets"`` files are only necessary if you are using any of the
  widgets built into Bokeh in ``bokeh.models.widgets``.
* The ``"-tables"`` files are only necessary if you are using Bokeh data
  tables.
* The ``"bokeh-api"`` files are required to use the BokehJS API and must be
  loaded *after* the core BokehJS library.

For example, the links for version ``2.0.1`` are:

* https://cdn.bokeh.org/bokeh/release/bokeh-2.0.1.min.js
* https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.0.1.min.js
* https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.0.1.min.js
* https://cdn.bokeh.org/bokeh/release/bokeh-api-2.0.1.min.js
* https://cdn.bokeh.org/bokeh/release/bokeh-gl-2.0.1.min.js
* https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-2.0.1.min.js

.. note::
    You should always set ``crossorigin="anonymous"`` on script tags that load
    BokehJS from CDN.

.. _Anaconda Python Distribution: http://anaconda.com/anaconda
.. _Anaconda: https://www.anaconda.com/products/individual#Downloads
.. _Miniconda: https://docs.conda.io/en/latest/miniconda.html
.. _known issue: https://github.com/tornadoweb/tornado/issues/1602#issuecomment-163472168
.. _`"bokeh" tag on Stack Overflow`: https://stackoverflow.com/questions/tagged/bokeh
.. _Bokeh Discourse: https://discourse.bokeh.org
.. _`Bokeh's GitHub repository`: https://github.com/bokeh/bokeh

.. |bokeh.sampledata| replace:: :ref:`bokeh.sampledata <bokeh.sampledata>`
.. _first_steps_2:

First steps 2: Adding and customizing renderers
===============================================

In the :ref:`previous first steps guide <first_steps_1>`, you used Bokeh's
|figure| function to render line charts.

In this section, you will use different renderer functions to create various
other kinds of graphs. You will also customize what your glyphs look like.

Rendering different glyphs
--------------------------

Bokeh's :ref:`plotting <userguide_plotting>` interface supports many different
glyphs, such as lines, bars, hex tiles, or other polygons.

.. seealso::
   A full list of all supported glyph methods is available in Bokeh's reference
   guide for the |figure| function. For detailed
   information on Bokeh's glyphs, see :ref:`userguide_plotting` in Bokeh's user
   guide.

Rendering circles
^^^^^^^^^^^^^^^^^

Use the :func:`~bokeh.plotting.figure.circle` function instead of
:func:`~bokeh.plotting.figure.line` to render circles:

.. code-block:: python

    p.circle(x, y3, legend_label="Objects", color="yellow", size=12)

Replace one of the ``line()`` functions in your previous visualization with
the :func:`~bokeh.plotting.figure.circle` function to create circles:

.. literalinclude:: examples/first_steps_2_add_circles.py
   :language: python
   :emphasize-lines: 15

.. bokeh-plot:: docs/first_steps/examples/first_steps_2_add_circles.py
    :source-position: none

Rendering bars
^^^^^^^^^^^^^^

Similarly, use the :func:`~bokeh.plotting.figure.vbar` function to render
vertical bars:

.. code-block:: python

    p.vbar(x=x, top=y2, legend_label="Rate", width=0.5, bottom=0, color="red")

Add the :func:`~bokeh.plotting.figure.vbar` function to your previous
visualization:

.. literalinclude:: examples/first_steps_2_add_bars.py
   :language: python
   :emphasize-lines: 14

.. bokeh-plot:: docs/first_steps/examples/first_steps_2_add_bars.py
    :source-position: none

.. seealso::
    To learn more about bar graphs and other ways Bokeh handles categorical
    data, see :ref:`userguide_categorical` in the user guide.

Customizing glyphs
------------------

The different renderer functions accept various arguments to control what
your glyphs look like.

Defining properties of new glyphs
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The :func:`~bokeh.plotting.figure.circle` function, for example, lets you
define aspects like the color or diameter of the circles:

* ``fill_color``: the fill color of the circles
* ``fill_alpha``: the transparency of the fill color (any value between ``0``
  and ``1``)
* ``line_color``: the fill color of the circles' outlines
* ``size``: the size of the circles (in |screen units| or |data units|)
* ``legend_label``: legend entry for the circles

Note that in the previous examples, you used the ``color`` property to define
the color of an object. ``color`` is an alias that automatically sets all
color properties of an object to the same color. For example, passing
``"yellow"`` to a circle's ``color`` property is the same as setting
``fill_color`` and ``line_color`` to yellow individually.

In Bokeh, you can :ref:`specify colors <userguide_styling_colors>` in several
ways. For example:

* Use one of the |named CSS colors| (for example, ``"firebrick"``)
* Use hexadecimal values, prefaced with a ``#`` (for example ``"#00ff00"``)
* Use a 3-tuple for RGB colors (for example, ``(100, 100, 255)``
* Use a 4-tuple for RGBA colors (for example ``(100, 100, 255, 0.5)``)

Create circles with the legend label "Objects" and make the circles appear
slightly transparent with a red fill color and blue outlines:

.. literalinclude:: examples/first_steps_2_style_circle.py
   :language: python
   :emphasize-lines: 11-19

.. bokeh-plot:: docs/first_steps/examples/first_steps_2_style_circle.py
    :source-position: none

.. _first_steps_2_altering_existing:

Altering properties of existing glyphs
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

If you want to change any property after creating an object, you can define
and overwrite the object's attributes directly.

Take the circles from above, for example. You defined the circles to have a
red color by passing the argument ``fill_color="red"``.

To change the color of your circles from red to blue, you first need to assign
a variable name (such as ``circle``) to the new object when you call the
:func:`~bokeh.plotting.figure.circle` function.

.. code-block:: python

    circle = p.circle(
        x,
        y,
        legend_label="Objects",
        fill_color="red",
        fill_alpha=0.5,
        line_color="blue",
        size=80,
        )

Next, use that variable to access the object's ``glyph`` attribute and change
its properties:

.. code-block:: python

    glyph = circle.glyph
    glyph.fill_color = "blue"

Generate red circles once more, but this time change their color to blue before
outputting the plot:

.. literalinclude:: examples/first_steps_2_style_existing_circle.py
   :language: python
   :emphasize-lines: 22-23

.. bokeh-plot:: docs/first_steps/examples/first_steps_2_style_existing_circle.py
    :source-position: none

.. seealso::
    For more information about the various visual properties, see
    :ref:`userguide_styling_glyphs` and :ref:`userguide_styling_visual_properties`
    in the user guide.

    Each type of glyph has different properties. Refer to
    |figure| in the reference guide to see all available
    properties for each glyph method.
.. _first_steps_7:

First steps 7: Displaying and exporting
=======================================

In the :ref:`previous first steps guides <first_steps_6>`, you created,
customized, and combined visualizations.

In this section, you will use various methods to display and export your
visualizations.

.. _first_steps_7_html_file:

Creating a standalone HTML file
-------------------------------

All examples so far have used the |show| function to save your visualization to
an HTML file. This HTML file contains all the necessary information to display
your plot.

To customize the file Bokeh creates for your visualization, import and call the
|output_file| function. ``output_file()`` accepts various file-related
arguments. For example:

* ``filename``: the filename for the HTML file. If you don't supply a file name,
  Bokeh will use the file name of your python file as a filename for the HTML
  file it creates.
* ``title``: the title for you document (to be used in the HTML's ``<title>``
  tag)

Bokeh creates the HTML file when you call the |show| function. This function
also automatically opens a web browser to display the HTML file.

If you want Bokeh to only generate the file but not open it in a web browser,
use the |save| function instead.

You need to import the |save| and |output_file| functions before using,
just like you did for |show|.

.. literalinclude:: examples/first_steps_7_export_html.py
   :language: python
   :emphasize-lines: 1,8,17

.. seealso::
    For more information on embedding Bokeh visualizations online, see
    :ref:`userguide_embed` in the user guide.

.. note::
    By default, Bokeh-generated HTML files include a standard version of BokehJS
    that is automatically downloaded from Bokeh's servers. Use the argument
    ``mode`` with the function ``output_file()`` to change this behavior. For
    more information, see |output_file| and :class:`~bokeh.resources.Resources`
    in the reference guide.

.. _first_steps_7_jupyter_notebook:

Displaying in a Jupyter notebook
--------------------------------

If you use Jupyter notebooks, call Bokeh's |output_notebook| function in your
code. Then, use the |show| function to display your visualization right inside
your notebook:

.. image:: /_images/notebook_inline.png
    :scale: 50 %
    :align: center
    :alt: Screenshot of a Bokeh plot in a Jupyter notebook

.. seealso::
    For more information on using Jupyter notebooks, see
    :ref:`userguide_jupyter` in the user guide.

    Interact directly with `live tutorial notebooks <https://mybinder.org/v2/gh/bokeh/bokeh-notebooks/master?filepath=tutorial%2F00%20-%20Introduction%20and%20Setup.ipynb>`_
    hosted online by MyBinder.

.. _first_steps_7_export_png_svg:

Exporting PNG files
-------------------

To export PNG or SVG files, you might need to install additional dependencies.

In order to create PNG and SVG files, Bokeh uses
`Selenium <https://github.com/SeleniumHQ/selenium>`_. Selenium allows Bokeh to
run in a browser without a graphical user interface. Bokeh uses this
browser to render the PNG or SVG files. In order for this to work, Selenium
needs to be able to access either a Firefox browser (through the geckodriver
package) or a Chrome/Chromium browser (through the chromedriver package).

Use this command to install Selenium with geckodriver and Firefox in a conda
environment:

.. code-block:: sh

    conda install selenium geckodriver firefox -c conda-forge

See :ref:`userguide_export_dependencies` for more options to install the
required packages.

Once the requirements are installed, you can use the
:func:`~bokeh.io.export_png` function to export your plot into a PNG file:

.. literalinclude:: examples/first_steps_7_export_png.py
   :language: python
   :emphasize-lines: 1,15

.. seealso::
    For information on how to export PNG and SVG files, see
    :ref:`userguide_export` in the user guide.
