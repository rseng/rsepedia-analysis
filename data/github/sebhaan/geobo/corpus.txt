httpsgithubcomsebhaangeoboblobmasterdocslogo_geobopngrawtru geobo python packag multiobject bayesian optimis joint invers geoscienc geobo build upon probabilist framework use gaussian process gp prior jointli solv multilinear forward model softwar gener multioutput cube geophys properti eg densiti magnet suscept miner concentr uncertainti survey data eg magnet graviti preexist drillcor measur reconstruct model use queri next promis measur locat given expens cost function eg drillcor rank list new measur propos base userdefin object defin acquisit function typic aim optim explor reduc global model uncertainti exploit focus highli promis region minim cost geobo frameworkhttpsgithubcomsebhaangeoboblobmasterdocsoverview_illustrationpngrawtru tabl content definitionsdefinit functionalityfunction instal requirementsinstallationandrequir requirementsrequir installationinstal documentationdocument usag settingsusageandset exampl testsexampl synthet modelssyntheticmodel drillcor test exampledrillcoretestexampl result output filesresultsandoutputfil option customizationoptionsandcustom custom linear forward modelscustomlinearforwardmodel gaussian process kernel functionsgaussianprocesskernelfunct literatureliteratur relat softwarerelatedsoftwar attribut acknowledgmentsattributionandacknowledg project contributorsprojectcontributor licenselicens definit bayesian optimis bo power framework find extrema object function noisi expens evalu closedform eg blackboxfunct access deriv model use approxim object function call surrog model typic base gaussian process modelshttpsenwikipediaorgwikigaussian_process tractabl gaussian process defin prior function typic given kernel function use propos point search space sampl like yield improv specif set object improv defin acquisit function guid search userdefin optimum exampl use case scenario describ nutshel optimization_for_active_sensorfusion_in_a_nutshellpdfhttpsgithubcomsebhaangeoboblobmasterdocsoptimization_for_active_sensorfusion_in_a_nutshellpdf acquisit function key bo acquisit function typic balanc explor ie queri point maximis inform gain minim uncertainti model b exploit ie queri point maximis reward eg concentr search vicin locat high valu miner c minim number sampl given expens cost function new measur forward model joint invers geolog geophys invers problem occur whenev goal reconstruct geolog condit ie distribut physic rock properti give rise set geophys observ sinc number possibl geolog configur typic greater number observ constraint problem nearli alway underdetermin forward model transform local measur remot sensor grid represent geophys properti region common geophys linear forward model graviti magnet forward model comput use li tractabl approxim joint invers simultan interpret multipl distinct sensor measur use singl model provid better constrain joint solut rather take individu solut satisfi aspect data function geobo probabilist framework includ step prior select data fusion invers sensor optimis real world model output main function geobo summaris follow joint probabilist invers tool solv simultan multilinear forward model eg graviti magnet use crossvari geophys properti crossvari term specifi user output gener cube comput complet posterior distribut geophys properti describ mean varianc valu locat cubecel aka voxel output gener rank propos list new promis drillcor base global optimis acquisit function templat acquisit function use bayesian optimis flexibl paramet set explorationexploit tradeoff inclus local cost function acquisit function featur gener simul geophys data choic three differ model packag includ geolog surveydrillcor sampl well synthet data function synthet data gener gener dd visualis plot reconstruct cube survey data cube export vtk format subsequ analysi eg python paraview option includ preexist drillcor data includ linear forward model densitytograv magnet susceptibilitytomagnet field custom linear forward model ad see custom linear forward modelscustomlinearforwardmodel librari gaussian process gp kernel includ spars gp kernel flexibl set cube geometri resolut option optim gp hyperparamet crosscorrel coeffici via comput margin gp likelihood exampl output found directori examplesresult instal requir instal instal geobo local use setuptool sh python setuppi build python setuppi instal use pip sh pip instal geobo instal test run exampl includ synthet data default set sh cd geobo python mainpi testssettings_exampleyaml requir python numpi matplotlib scikit_imag scipi rasterio panda pyvista skimag pyyaml document document convers gener use pandoc readm markdown file convert pdf bash pandoc v geometrymarginin readmemd readmepdf complet api document modul found run_geobopyhttphtmlpreviewgithubiohttpsgithubcomsebhaangeoboblobreleasedocsapidocsgeoborun_geobohtml inversionpyhttphtmlpreviewgithubiohttpsgithubcomsebhaangeoboblobreleasedocsapidocsgeoboinversionhtml kernelspyhttphtmlpreviewgithubiohttpsgithubcomsebhaangeoboblobreleasedocsapidocsgeobokernelshtml cubeshowpyhttphtmlpreviewgithubiohttpsgithubcomsebhaangeoboblobreleasedocsapidocsgeobocubeshowhtml sensormodelpyhttphtmlpreviewgithubiohttpsgithubcomsebhaangeoboblobreleasedocsapidocsgeobosensormodelhtml simcubepyhttphtmlpreviewgithubiohttpsgithubcomsebhaangeoboblobreleasedocsapidocsgeobosimcubehtml utilspyhttphtmlpreviewgithubiohttpsgithubcomsebhaangeoboblobreleasedocsapidocsgeoboutilshtml usag set chang main set filenam paramet settingsyaml set specifi directori filenam geophys drillcor properti gener cube geometri size resolut gaussian process set lengthscal input data uncertainti correl coeffici kernel function local earth magnet field vector bayesian optimis set verticalnonvert drillcor explorationexploit cost weight plot set option gener simul data run geobo sh cd geobo python mainpi settingsyaml main function acquisit function found run_geobopydocsapidocsgeoborun_geobohtml visualis function vtk export defin cubeshowpydocsapidocsgeobocubeshowhtml invers function defin inversionpydocsapidocsgeoboinversionhtml exampl test synthet model synthet geophys model creat set switch gen_simul set yaml file three differ model far implement twocylindr dip bodi modelnam cylind two layer model modelnam layer three layer model modelnam layer model voxel cube geolog structur gener densiti magnet suscept properti plu correspond graviti magnet remot sensor measur custom model includ ad new model function create_syncub simcubepi result exampl synthet model store subfold examplestestdatasynthet exampl set file given settings_exampleyaml run sh cd geobo python mainpi testssettings_exampleyaml drillcor test exampl anoth exampl includ drillcor gravitymagnet survey data examplestestdatasampl exampl run sh cd geobo python mainpi testssettings_exampleyaml creat reconstruct densiti magnet suscept cube uncertainti cube result output file output result includ gener reconstruct densiti magnet suscept cube correspond uncertainti cube visualis origin survey data reconstruct properti list new measur propos list joint invers result output cube file vtk format use eg pyvista paraview output crosscorrel reconstruct properti densiti cube_densityvtk magnet suscept cube_magsusvtk properti drill cube_drillvtk uncertain cube term standard deviat cube_density_variancevtk cube_drill_variancevtk cube_drill_variancevtk case crosscovari term gp_coeff set file set zero solut forward model independ option default optiion plottru function read_surveydata imag input gravit field gravfieldpng magnet field magfieldpng correspond downsampl imag gravfield_downsampledpng magfield_downsampledpng option plotdtru set preview reconstruct properti densiti densitymeshdpng magnet suscpet magsusmeshdpng drill properti drillmeshdpng howev recommend use pyvista paraview instead futur updat visualis base pyvista option plot_verticaltru set map vertic along zaxi mean valu cube properti dens_recd_locpng magsus_recd_locpng drill_recd_locpng list bayesian optimis output list new measur propos drillcor rank maximum hightest gain minimum optimis function result save csv file newdrill_proposals_nonverticalcsv newdrill_proposals_verticalcsv includ vertic drillcor posit east north nonvert drillcor posit drill angl azimuth dip point propos measur posit top reconstruct drill properti imag mean project along zaxi output figur nonvert drillcoresnewdrill_proposalspng vertic drillcoresnewdrill_vertical_proposalspng show locat alreadi exist drill given input measur black point new propos drill posit white best maximum optims function new drill locat red exampl imag new measur propos black_ exist white new propos red best propos top reconstruct properti mean valu projectionhttpsgithubcomsebhaangeoboblobmasterdocsnewdrill_proposalspngrawtru option custom custom linear forward model relationship physic system model paramet p observ sensor data describ linear forward model g p g transform oper matrix gravit magnet forward model determin analyt use li tractabl approxim see li oldenburg field prism constant suscept densiti geobo appli prism shape model comput correspond sensor sensit graviti anomal magnet field relat prism cell current implement includ magnet graviti forward model defin modul sensormodelpi function a_sensgrav_func magn_func easiest way add custom model creat new forward model function similar includ function grav_func magn_func comput forward model matrix a_sen possibl custom function need describ sensit relationship particular point rel sensor origin see eg grav_func gener linear forward model ad chang accordingli forward model matrix comput a_sen long function return matrix g satisfi linear relat g p gaussian process kernel function gaussian process gp flexibl probabilist approach use kernel machin propag consist uncertainti input output space bayesian formal anoth advantag gp margin likelihood function well defin valu hyperparamet thu optim choic appropri covari kernel function import mani stationari invari translat input space nonstationari covari function avail overview see eg rasmussen william handl comput problem invert larg covari matrix geobo use default intrins spars covari function melkumyan et al howev standard kernel function avail see modul kernelspi includ squar exponenti matern function correspond multikernel covari function see melkumyan et al set yaml file allow choos kernel function configur paramet kernelfunc set either spars default exp squar exponenti matern new custom kernel ad modul kernelspi requir write covari function see exampl gpkernel crosscovari function see exampl gpkernel_spars add function name settingsyaml create_cov kernelspi hyperparamet gp kernel configur set yaml file see gaussian process set given lengthscal gp_lengthscal nois regular term gp_err per forward model crosscovari amplitud term www coorrepond correl coeffici model properti eg rock densiti magnet suscept drillcor measur mathemat detail construct multikernel covari function describ haan et al bayesian optimis option find optim new sampl point geobo maximis object function acquisit function defin upper confid bound ucb ucbx mx k sigmax b cx mean valu predict mx varianc sigmasupsupx cost function cx defin cost obtain measur sampl point x paramet k b defin tradeoff explorationtoexploit gaintocost respect exampl maxim mean valu benefici goal sampl new data locat high densiti miner content uncertainti high paramet k b accordingli specifi user set yaml file moreov set allow user choos vertic nonvert drillcor latter case geobo optimis also dip azimuth angl drillcor addit drillcor posit literatur sebastian haan fabio ramo dietmar muller multiobject bayesian optimis joint invers activ sensor fusion geophys pp arxiv preprinthttpsarxivorgab carl edward rasmussen christoph ki william gaussian process machin learn mit press li yaoguo dougla w oldenburg dinvers graviti data geophys vol pp arman melkumyan fabio ramo spars covari function exact gaussian process infer larg dataset ijcai vol pp armon melkuyman fabio ramo multikernel gaussian process ijcai vol p reid simon timothi e v bonilla l mccalman rawl f ramo bayesian joint invers explor earth resourc ijcai eric brochu vlad cora nando de freita tutori bayesian optim expens cost function applic activ user model hierarch reinforc learn arxiv preprint arxiv relat softwar invers part geobo use direct invers method via transform gaussian process prior enabl joint invers limit linear forward model eg graviti magnet drillcor solv complex nonlinear forward model eg seismic prior geolog knowledg follow bayesian invers method potenti appli gener geophys surrog model refin geobo posterior model hippylib extens softwar framework largescal determinist bayesian invers problem public linkhttpswwwtheojorgjosspapersjossjosspdf softwar code avail hippylibgithubiohttpshippylibgithubio obsidian flexibl softwar platform mcmc sampl multimod geophys model distribut comput cluster public linkhttpsgmdcopernicusorgarticl code version obsidian avail httpsdoiorgzenodohttpsdoiorgzenodo gempi opensourc stochast geolog model invers geoscientif model develop see gempyorghttpswwwgempyorg attribut acknowledg acknowledg import way us demonstr valu bring research research outcom vital ongo fund sydney informat hub make use code research project pleas includ follow acknowledg research support sydney informat hub core research facil univers sydney project contributor key project contributor geobo project dr sebastian haan usyd sydney informat hub expert machin learn physic main contributor softwar develop geobo prof fabian ramo usyd comput scientist research expert machin learn bayesian comput techniqu prof dietmar muller usyd school geoscienc research expert geophys geoscienc applic dr ben mather usyd sydney informat hubschool geoscienc comput geophysicist geobo test licens copyright sebastian haan geobo free softwar redistribut andor modifi term gnu affero gener public licens agpl version publish free softwar foundat program distribut hope use without warranti without even impli warranti merchant fit particular purpos see gnu affero gener public licens detail receiv copi gnu affero gener public licens along program see licensemd see httpswwwgnuorglicenseshttpswwwgnuorglicens contribut welcom contribut geobo contribut form new code function improv document point bug potenti improv bug report featur request bug suggest pleas submit bug report featur request use github issu trackerhttpsgithubcomsebhaangeoboissu search exist close issu first problem idea yet address pleas open new issu github allow classifi issu know bug report featur request feedback author submit code would like contribut pleas submit pull request see github hello worldhttpsguidesgithubcomactivitieshelloworld exampl new github pleas document function clearli contribut repositori state copyright contribut agre includ contribut part project apgl licens futur work welcom contribut geobo particular would appreci pull request pertain follow area implement new forward model sensormodelpi expand exampl studi use case test current develop continu integr test perform pytest mean run sourc directori bash python setuppi test exist test pass start code rais issu case new function also test use verifi code titl geobo python packag multiobject bayesian optimis joint invers geoscienc tag python geoscienc bayesian optimis invers gaussian process author name sebastian haan orcid affili affili name sydney informat hub univers sydney australia index date novemb bibliographi paperbib pandoc v geometrymarginin v fontsizept filter pandocciteproc paperpdf papermd add author sebastian haan meta standard pandoc convers summari critic decis process geophys data collect effici combin varieti sensor type collect new observ particular measur costli resourc limit may includ drillcor placement layout geophys survey bayesian optimis bo solv decis make problem find global optim solut given multipl often distinct measur model uncertainti one major challeng appli bo geoscienc still lie construct model spars typic sensor data comput effici evalu transform combin data uncertainti multipl sensor measur coher posterior function approxim true model also known invers problem geobo python packag solv multiobject optimis joint invers within one probabilist framework prior select input data fusion invers final sensor optimis real world model output current implement gener geophys properti base graviti magnet invers search optim new drillcor measur principl model appli wide rang sensor fusion problem alloc problem posit activ sensor quasilinear invers problem eg seismic tomographi model state dynam sampl cost function incomplet fig show graphic overview model geobo two main process step summar follow first geobo jointli solv multilinear forward model survey data eg magnet graviti dgeophys properti use gaussian process kernel rasmussen melkumyan without requir prior geolog knowledg addit spars drillhol measur taken account one key featur consid correl geophys properti solv simultan multipl forward model melkumyan reid thu approach provid better constrain combin solut multipl distinct sensor type rather take individu solut anoth practic advantag probabilist approach predict describ posterior distribut locat voxel cube cell quantifi uncertainti predict credibl interv work field joint invers report point estim quantiti interest zeyen gallardo moorkamp invers method limit linear forward model reconstruct posterior distribut geophys properti refin use sitespecif knowledg complex invers method sampl nonlinear forward model hippylib hippylib obsidian obsidian gempi gempi second step bo geobo allow user defin object acquisit function mocku brochu haan typic balanc explor ie queri point maximis inform gain minim uncertainti geophys site model b exploit ie queri point maximis reward eg concentr search vicin locat high valu miner c minim number sampl given cost function new measur eg costli drillcor reconstruct model output joint invers model use queri next promis point base aquisit function guid search userdefin optimum geobo allow applic specifi prior addit option typic correl lengthscal geolog structur via gp hyperparamet b gaincost paramet bo acquisit function c correl coeffici differ geophys properti packag includ forward model graviti magnet survey li drillcor testset geolog model data test solv problem alloc iter new expens drillcor sampl haan method appli wide rang optimis sensor fusion problem overview probabilist framework multiobject optimis joint invers process stage joint invers via gaussian process base multipl sensor data fusion forward model posterior model gener multigeophys properti maximis acquisit function alloc optim new sensor locat type new acquir data combin exist data process repeat maximum number iter achiev detail see haangraphmodelpng instal depend usag geobo instal use setuptool pip requir follow python packag numpi matplotlib scikit_imag scipi rasterio panda pyvista skimag pyyaml detail see requirementstxt instal test run script includ synthet data default set use geobo chang main set filenam paramet settingsyaml see descript run sh cd geobo python mainpi settingsyaml core featur geobo joint probabilist invers tool solv simultan multilinear forward model eg graviti magnet use crossvari geophys properti crossvari term specifi use settingsyaml comput complet posterior distribut geophys properti describ mean varianc valu locationvoxel gener rank propos list new promis drillcor option nonvert drillcor base global optimis acquisit function see settingsyaml templat acquisit function use bayesian optimis see futil function run_geobopi flexibl paramet set settingsyaml explorationexploit tradeoff inclus local cost function acquisit function see function create_costcub run_geobopi featur packag includ geolog surveydrillcor sampl well synthet data function synthet data gener gener dd visualis plot reconstruct cube survey data see plot set settingsyaml cube export vtk format subsequ analysi eg paraview option includ preexist drillcor data see settingsyaml featur name well format sampl drilldata includ linear forward model densitytograv magnet susceptibilitytomagnet field custom linear forward model ad sensormodelpi librari gaussian process gp kernel includ spars gp kernel kernelspi flexibl set cube geometri resolut cube lengthwidthheight voxel resolut option margin gp likelihood optim gp hyperparamet invers process result output first joint invers gener reconstruct properti uncertainti cube densiti magnet suscept physic properti obtain ad custom forward model see section custom linear forward model readm secondli bayesian optimis use probabilist invers result queri new potenti measur base specif set object defin acquisit function guid search userdefin optimum final list new measur propos rank maximum minimum improv gener includ map promis new measur locat acknowledg sebastian haan would like acknowledg dietmar muller fabio ramo ben mather valuabl contribut project research support sydney informat hub core research facil univers sydney refer rolemain sectionintro section copyright sebastian haan script creat reconstruct cube mean subtract properti densiti magnet suscept drill core properti plu predict varianc cube see inversionpi detail see settingsyaml specif todo implement gp hyperparamet optimis adavanc user level expand sourc code copyright sebastian haan script creat reconstruct cube mean subtract properti densiti magnet suscept drill core properti plu predict varianc cube see inversionpi detail see settingsyaml specif todo implement gp hyperparamet optimis adavanc user level import numpi np import panda pd import rasterio scipi import interpol scipyndimageinterpol import zoom scipyoptim import minim least_squar shgo scipystat import norm pareto scipi import interpol mpl_toolkitsmplotd import axesd import matplotlibpyplot plt matplotlib import cm import custom function config_load import load set import cubeshow cs util import import invers import simcub def read_surveydataplot true read graviti data magnet data includ crop downsampl cube size paramet param plot boolean true plot survey data downsampl return graviti data magnet data sensor locat fname_gravsurvey none gravimg rasterioopeninpath fname_gravsurvey grav gravimgread els grav none fname_magsurvey none magimg rasterioopeninpath fname_magsurvey mag magimgread els mag none downsampl cube voxels zoomfac xncube gravshap grav zoomgrav zoomfac assert gravshap yncube xncube zoomfac xncube magshap mag zoommag zoomfac assert magshap yncube xncube creat survey sensor coordin x_ nplinspac xncube xncube xvoxsiz y_ nplinspac yncube yncube yvoxsiz z_ zmax zoff x_sensor y_sensor z_sensor npmeshgridx_sy_sz_ locat npasarrayx_sensorflatten y_sensorflatten z_sensorflatt ospathexistsoutpath osmakedirsoutpath plot extentxminxmaxyminymax pltimshowgrav aspect equal cmap viridi extentext pltcolorbar pltsavefigoutpath gravfieldpng pltclf pltimshowmag aspect equal cmap viridi extentext pltcolorbar pltsavefigoutpath magfieldpng pltclf pltimshowgrav aspect equal cmap viridi extentext pltcolorbar pltsavefigoutpath gravfield_downsampledpng pltclf pltimshowmag aspect equal cmap viridi extentext pltcolorbar pltsavefigoutpath magfield_downsampledpng pltcloseal return gravflatten magflatten locat def read_drilldatafeatur read drill data paramet param featur list drill featur interest see settingsyaml return drill data xyz coordin drilldata xyz minmax array drilldata fname_drilldata none drill pdread_csvinpath fname_drilldata drill drilldrillx xmin drillx xmax drilli ymin drilli ymax drillz zmax drillz zmincopi els drill none select data within extent convert local coordin system origin xy drillx drillx xmin drilli drilli ymin set voxel coordin grid xdrill drillxvalu ydrill drillyvalu zdrill drillzvalu tri drillfirst drillgroupbysiteidfirst drilllast drillgroupbysiteidlast xdrillminmax npasarraydrillfirstxvalu drilllastxvaluest ydrillminmax npasarraydrillfirstyvalu drilllastyvaluest zdrillminmax npasarraydrillfirstzvalu drilllastzvaluest except xdrillminmax npasarrayxdrillmin xdrillmin ydrillminmax npasarrayydrillmin ydrillmin zdrillminmax npasarrayzdrillmin zdrillmin coord npvstackxdril ydrill zdrillt drilldata featur featur data drillfeatur drilldataappendalign_drillcoord data return npasarraydrilldata coord xdrillminmax ydrillminmax zdrillminmax def align_drillcoord data convert drillcor data model cube shape iter voxel paramet param coord xyz coordin drillcor shape n_drill param data dim data drillcor shape n_drill return drilldata voxel shape dx xvoxsiz dy yvoxsiz dz zvoxsiz data npasarraydata re npzeros_likexxx ix rangexxxshap iy rangexxxshap iz rangexxxshap sel npwherexxxixiyiz dx coord coord xxxixiyiz dx yyyixiyiz dy coord coord yyyixiyiz dy zzzixiyiz dz coord coord zzzixiyiz dz npsizedatasel printsel npnanmeandatasel npisfinitem resixiyiz return re defineit acquisit function function bo key bo acquisit function typic balanc explor ie queri point maximis inform gain minim uncertainti model b exploit ie queri point maximis reward eg concentr search vicin locat high valu miner c minim number sampl given expens cost function new measur explorationexploit cost tradeoff paramet set settingsyaml def futility_verticalparam cost none utilityaquisit function bayesian optimis assum vertic drillcor paramet param paramet drillhol x_drilly_dril param cost cube cost shape reconstruct cube return output util function scalar cost none cost drill_rec param npasarrayparam xmaxvox drill_recshap ymaxvox drill_recshap npisfiniteparamsal xd intnproundparam yd intnproundparam xd xd xmaxvox yd yd ymaxvox func npsumdrill_recxd yd kappa npsqrtnpsumdrill_varxd yd beta npsumcostsxdyd els func npinf els func npinf return func neg optimis use minim def futility_drillparam length_newdril zlcube cost none calcul util function propos nonvert drillcor take account azimuth dip addit locat drillcor length paramet param param x azimuth dip x meter azimuth dip degre param length_newdril length drillcor meter param cost cube cost shape reconstruct cube return output util function scalar cost none cost drill_rec x azimuth dip param nstep int length_newdrillnpminxvoxs yvoxsiz zvoxsiz rladder nplinspacelength_newdril nstep x rladder x rladder z rladder zmax azimuth rladder azimuth dip rladder dip tri xdrillnew ydrillnew zdrillnew sphericalcartesx z azimuth nppi dip nppi rladder xnew xdrillnewxvoxsizeastypeint ynew ydrillnewyvoxsizeastypeint znew zdrillnewzvoxsizeastypeint funct npsumdrill_recxnewynewznew kappa npsqrtnpsumdrill_varxnewynewznew beta npsumcostsxnewynewznew except funct return funct chose settingsyaml sepcif whether vertic nonvert drillcor optimis acquisitioan function perform global optimis shgo sobol sampl advantag propos sort multipl local maxima def bayesopt_vertdrillcoord none new drillcor propos base mean uncertainti cost defin acquisitian function futility_vert optimis acquisitioan function perform global optimis shgo sobol sampl advantag propos sort multipl local maxima paramet param drillcoord exisit x x drill coordin return save list propos new drillcor coordin file newdrill_vertical_proposalscsv printcalcul propoal list new vertic drillhol defin boundari optimis bp npasarrayyncub xncube blb npasarray yncube bub npasarray xncube bopt_r minimizefutility_vert bp bound blb bub methodslsqp optionsmaxit tol e methodslsqp bopt_r shgofutility_vert bound yncube xncube n iter sampling_methodsobol tol e methodslsqp bopt_ressuccess printwarn bopt_resmessag printnew drillcor propos print_______________________ printeast meter nproundbopt_resx xvoxsiz xmin xvoxsiz printnorth meter nproundbopt_resx yvoxsiz ymin yvoxsiz write new drillcor propos csv file printsav new drillhol propos file newdrill_proposalscsv newdf_valu bopt_resxl newdf_head northingeast df_newdril pddataframenproundnewdf_valu column newdf_head df_newdrilleast nprounddf_newdrilleast xvoxsiz xmin xvoxsiz df_newdrillnorth nprounddf_newdrillnorth yvoxsiz ymin yvoxsiz df_newdrillbo_gain nproundbopt_resfunl df_newdrillto_csvoutpath newdrill_vertical_proposalscsv indexfals creat imag porpos drillcor posit densimg density_recmeanaxi magsusimg magsus_recmeanaxi drillimg drill_recmeanaxi drillvarimg drill_varmeanaxi extentxmin xvoxsiz xmax xvoxsizeymin yvoxsizeymax yvoxsiz extentxmin xmax ymin ymax pltclf pltimshowdrillimg aspect equal cmap viridi extentext originlow pltxlabeleast pltylabelnorth drillcoord none xdrill ydrill zdrill drillcoordt pltscatterxdrillxmin ydrillymin colork pltscatterdf_newdrilleastingvalu df_newdrillnorthingvalu colorwhit pltscatterdf_newdrillloceast df_newdrilllocnorth color plttitlepropos vertic drillcor plttight_layout pltsavefigoutpath newdrill_vertical_proposalspng pltcloseal def bayesopt_nonvertdrillcoord none new drillcor propos base mean uncertainti cost defin acquisitian function futility_vert optimis acquisitioan function perform global optimis shgo sobol sampl advantag propos sort multipl local maxima paramet param drillcoord exisit x x drill coordin return save list propos new drillcor coordin file newdrill_vertical_proposalscsv bnd yvoxsizeylcub yvoxsiz xvoxsizexlcub xvoxsiz bopt_r shgofutility_dril bnd n iter sampling_methodsobol printnew drillcor propos print_______________________ printeast meter nproundbopt_resx ymin printnorth meter nproundbopt_resx xmin printazimuth angl degre nproundbopt_resx printdip angl degre nproundbopt_resx write new drillcor propos csv file printsav new drillhol propos file newdrill_proposalscsv newdf_valu bopt_resxl newdf_head north east azimuth dip df_newdril pddataframenproundnewdf_valu column newdf_head df_newdrilleast nprounddf_newdrilleast xmin df_newdrillnorth nprounddf_newdrillnorth ymin df_newdrillbo_gain nproundbopt_resfunl df_newdrillto_csvoutpath newdrill_proposalscsv indexfals creat imag prppose drillcor posit densimg density_recmeanaxi magsusimg magsus_recmeanaxi drillimg drill_recmeanaxi drillvarimg drill_varmeanaxi extentxmin xvoxsiz xmax xvoxsizeymin yvoxsizeymax yvoxsiz extentxmin xmax ymin ymax pltclf pltimshowdrillimg aspect equal cmap viridi extentext originlow pltxlabeleast pltylabelnorth drillcoord none xdrill ydrill zdrill drillcoordt pltscatterxdrillxmin ydrillymin colork pltscatterdf_newdrilleastingvalu df_newdrillnorthingvalu colorwhit pltscatterdf_newdrillloceast df_newdrilllocnorth color plttitlepropos drillcor plttight_layout pltsavefigoutpath newdrill_proposalspng pltcloseal def create_costcubecubeshap xncube yncube zncube user function creat costcub drill need cube shape reconstruct cube default set zero cost input param cubeshap shape cube default xncube yncube zncube return costcub cost set zero chang costcub npzeroscubeshap return costcub main comput gen_simul creat first simul datacub see settingsyaml simcubecreate_simdatamodelnam initi invers class inv inversioninvers creat new cube geometri voxelpo invcreate_cubegeometri xxx yyy zzz voxelpo xxx invxxx xxxreshapexncub yncube zncube yyy invyyi yyyreshapexncub yncube zncube zzz invzzz zzzreshapexncub yncube zncube read survey data gravfield magfield sensor_loc read_surveydata read exist drillcor data drilldata drillcoord drillminmax read_drilldatadrill_featur drilldata drilldataifeatur drillfield drilldatadrilldata xdrillminmax ydrillminmax zdrillminmax drillminmax joint invers reconmstyrcut cube geophys properti density_rec magsus_rec drill_rec density_var magsus_var drill_var invcubinggravfield magfield drillfield sensor_loc drilldata creat vtk cube reconstruct cube origin voxelposmin voxelposmin voxelposmin voxels xvoxsiz yvoxsizezvoxs cscreate_vtkcubedensity_rec origin voxels fname outpath cube_densityvtk cscreate_vtkcubemagsus_rec origin voxels fname outpath cube_magsusvtk cscreate_vtkcubedrill_rec origin voxels fname outpath cube_drillvtk cscreate_vtkcubedensity_var origin voxels fname outpath cube_density_variancevtk cscreate_vtkcubemagsus_var origin voxels fname outpath cube_magsus_variancevtk cscreate_vtkcubedrill_var origin voxels fname outpath cube_drill_variancevtk creat plot map vertic integr cube properti plot_vert densimg density_recmeanaxi magsusimg magsus_recmeanaxi drillimg drill_recmeanaxi extentxmin xvoxsiz xmax xvoxsizeymin yvoxsizeymax yvoxsiz pltclf pltimshowdensimg aspect equal cmap viridi extentext pltcolorbar pltsavefigoutpath dens_recd_locpng pltclf pltimshowmagsusimg aspect equal cmap viridi extentext pltcolorbar pltsavefigoutpath magsus_recd_locpng pltclf pltimshowdrillimg aspect equal cmap viridi extentext pltcolorbar pltsavefigoutpath drill_recd_locpng pltcloseal creat cube plot need data vtk cube plotd pltclf csskplotdensity_rec nsize xncube yncube zncube drill yyydrillxvoxsizexxxdrillyvoxsizezzzdrillzvoxs sensor x_sensorxvoxs y_sensoryvoxs x_sensor show fals path_out outpath filenam densitydrillmeshpng csskplotdensity_rec nsize yncube xncube zncube drill ydrillminmaxxvoxs xdrillminmaxyvoxsizezdrillminmaxzvoxs sensor sensor_locationsxvoxsizesensor_locationsyvoxs sensor_loc zmax show fals path_out outpath filenam densitymeshdpng pltclf csskplotdrill_rec nsize yncube xncube zncube drill ydrillminmaxxvoxs xdrillminmaxyvoxsizezdrillminmaxzvoxs sensor sensor_locationsxvoxsizesensor_locationsyvoxs sensor_loc zmax show fals path_out outpath filenam drillmeshdpng pltcloseal default cost chang function create_costcub specifi cost costcub create_costcub propos new drillcor chose settingsyaml sepcif whether vertic nonvert drillcor bayesopt_vert bayesopt_vertdrillcoord bayesopt_nonvert bayesopt_nonvertdrillcoord section section section function headerfunct sectiontitl def align_drillcoord datanam flex section desc convert drillcor data model cube shape iter voxel paramet param coord xyz coordin drillcor shape n_drill param data dim data drillcor shape n_drill return drilldata voxel shape expand sourc code def align_drillcoord data convert drillcor data model cube shape iter voxel paramet param coord xyz coordin drillcor shape n_drill param data dim data drillcor shape n_drill return drilldata voxel shape dx xvoxsiz dy yvoxsiz dz zvoxsiz data npasarraydata re npzeros_likexxx ix rangexxxshap iy rangexxxshap iz rangexxxshap sel npwherexxxixiyiz dx coord coord xxxixiyiz dx yyyixiyiz dy coord coord yyyixiyiz dy zzzixiyiz dz coord coord zzzixiyiz dz npsizedatasel printsel npnanmeandatasel npisfinitem resixiyiz return re def bayesopt_nonvertdrillcoordnonenam flex section desc new drillcor propos base mean uncertainti cost defin acquisitian function futility_vert optimis acquisitioan function perform global optimis shgo sobol sampl advantag propos sort multipl local maxima paramet param drillcoord exisit x x drill coordin return save list propos new drillcor coordin file newdrill_vertical_proposalscsv expand sourc code def bayesopt_nonvertdrillcoord none new drillcor propos base mean uncertainti cost defin acquisitian function futility_vert optimis acquisitioan function perform global optimis shgo sobol sampl advantag propos sort multipl local maxima paramet param drillcoord exisit x x drill coordin return save list propos new drillcor coordin file newdrill_vertical_proposalscsv bnd yvoxsizeylcub yvoxsiz xvoxsizexlcub xvoxsiz bopt_r shgofutility_dril bnd n iter sampling_methodsobol printnew drillcor propos print_______________________ printeast meter nproundbopt_resx ymin printnorth meter nproundbopt_resx xmin printazimuth angl degre nproundbopt_resx printdip angl degre nproundbopt_resx write new drillcor propos csv file printsav new drillhol propos file newdrill_proposalscsv newdf_valu bopt_resxl newdf_head north east azimuth dip df_newdril pddataframenproundnewdf_valu column newdf_head df_newdrilleast nprounddf_newdrilleast xmin df_newdrillnorth nprounddf_newdrillnorth ymin df_newdrillbo_gain nproundbopt_resfunl df_newdrillto_csvoutpath newdrill_proposalscsv indexfals creat imag prppose drillcor posit densimg density_recmeanaxi magsusimg magsus_recmeanaxi drillimg drill_recmeanaxi drillvarimg drill_varmeanaxi extentxmin xvoxsiz xmax xvoxsizeymin yvoxsizeymax yvoxsiz extentxmin xmax ymin ymax pltclf pltimshowdrillimg aspect equal cmap viridi extentext originlow pltxlabeleast pltylabelnorth drillcoord none xdrill ydrill zdrill drillcoordt pltscatterxdrillxmin ydrillymin colork pltscatterdf_newdrilleastingvalu df_newdrillnorthingvalu colorwhit pltscatterdf_newdrillloceast df_newdrilllocnorth color plttitlepropos drillcor plttight_layout pltsavefigoutpath newdrill_proposalspng pltcloseal def bayesopt_vertdrillcoordnonenam flex section desc new drillcor propos base mean uncertainti cost defin acquisitian function futility_vert optimis acquisitioan function perform global optimis shgo sobol sampl advantag propos sort multipl local maxima paramet param drillcoord exisit x x drill coordin return save list propos new drillcor coordin file newdrill_vertical_proposalscsv expand sourc code def bayesopt_vertdrillcoord none new drillcor propos base mean uncertainti cost defin acquisitian function futility_vert optimis acquisitioan function perform global optimis shgo sobol sampl advantag propos sort multipl local maxima paramet param drillcoord exisit x x drill coordin return save list propos new drillcor coordin file newdrill_vertical_proposalscsv printcalcul propoal list new vertic drillhol defin boundari optimis bp npasarrayyncub xncube blb npasarray yncube bub npasarray xncube bopt_r minimizefutility_vert bp bound blb bub methodslsqp optionsmaxit tol e methodslsqp bopt_r shgofutility_vert bound yncube xncube n iter sampling_methodsobol tol e methodslsqp bopt_ressuccess printwarn bopt_resmessag printnew drillcor propos print_______________________ printeast meter nproundbopt_resx xvoxsiz xmin xvoxsiz printnorth meter nproundbopt_resx yvoxsiz ymin yvoxsiz write new drillcor propos csv file printsav new drillhol propos file newdrill_proposalscsv newdf_valu bopt_resxl newdf_head northingeast df_newdril pddataframenproundnewdf_valu column newdf_head df_newdrilleast nprounddf_newdrilleast xvoxsiz xmin xvoxsiz df_newdrillnorth nprounddf_newdrillnorth yvoxsiz ymin yvoxsiz df_newdrillbo_gain nproundbopt_resfunl df_newdrillto_csvoutpath newdrill_vertical_proposalscsv indexfals creat imag porpos drillcor posit densimg density_recmeanaxi magsusimg magsus_recmeanaxi drillimg drill_recmeanaxi drillvarimg drill_varmeanaxi extentxmin xvoxsiz xmax xvoxsizeymin yvoxsizeymax yvoxsiz extentxmin xmax ymin ymax pltclf pltimshowdrillimg aspect equal cmap viridi extentext originlow pltxlabeleast pltylabelnorth drillcoord none xdrill ydrill zdrill drillcoordt pltscatterxdrillxmin ydrillymin colork pltscatterdf_newdrilleastingvalu df_newdrillnorthingvalu colorwhit pltscatterdf_newdrillloceast df_newdrilllocnorth color plttitlepropos vertic drillcor plttight_layout pltsavefigoutpath newdrill_vertical_proposalspng pltcloseal def costcubecubeshap name flex section desc user function creat costcub drill need cube shape reconstruct cube default set zero cost input param cubeshap shape cube default xncube yncube zncube return costcub expand sourc code def create_costcubecubeshap xncube yncube zncube user function creat costcub drill need cube shape reconstruct cube default set zero cost input param cubeshap shape cube default xncube yncube zncube return costcub cost set zero chang costcub npzeroscubeshap return costcub def create_costcubecubeshap name flex section desc user function creat costcub drill need cube shape reconstruct cube default set zero cost input param cubeshap shape cube default xncube yncube zncube return costcub expand sourc code def create_costcubecubeshap xncube yncube zncube user function creat costcub drill need cube shape reconstruct cube default set zero cost input param cubeshap shape cube default xncube yncube zncube return costcub cost set zero chang costcub npzeroscubeshap return costcub def futility_drillparam length_newdril costsnonenam flex section desc calcul util function propos nonvert drillcor take account azimuth dip addit locat drillcor length paramet param param x azimuth dip x meter azimuth dip degre param length_newdril length drillcor meter param cost cube cost shape reconstruct cube return output util function scalar expand sourc code def futility_drillparam length_newdril zlcube cost none calcul util function propos nonvert drillcor take account azimuth dip addit locat drillcor length paramet param param x azimuth dip x meter azimuth dip degre param length_newdril length drillcor meter param cost cube cost shape reconstruct cube return output util function scalar cost none cost drill_rec x azimuth dip param nstep int length_newdrillnpminxvoxs yvoxsiz zvoxsiz rladder nplinspacelength_newdril nstep x rladder x rladder z rladder zmax azimuth rladder azimuth dip rladder dip tri xdrillnew ydrillnew zdrillnew sphericalcartesx z azimuth nppi dip nppi rladder xnew xdrillnewxvoxsizeastypeint ynew ydrillnewyvoxsizeastypeint znew zdrillnewzvoxsizeastypeint funct npsumdrill_recxnewynewznew kappa npsqrtnpsumdrill_varxnewynewznew beta npsumcostsxnewynewznew except funct return funct def futility_verticalparam costsnonenam flex section desc utilityaquisit function bayesian optimis assum vertic drillcor paramet param paramet drillhol x_drilly_dril param cost cube cost shape reconstruct cube return output util function scalar expand sourc code def futility_verticalparam cost none utilityaquisit function bayesian optimis assum vertic drillcor paramet param paramet drillhol x_drilly_dril param cost cube cost shape reconstruct cube return output util function scalar cost none cost drill_rec param npasarrayparam xmaxvox drill_recshap ymaxvox drill_recshap npisfiniteparamsal xd intnproundparam yd intnproundparam xd xd xmaxvox yd yd ymaxvox func npsumdrill_recxd yd kappa npsqrtnpsumdrill_varxd yd beta npsumcostsxdyd els func npinf els func npinf return func neg optimis use minim def read_drilldatafeaturesnam flex section desc read drill data paramet param featur list drill featur interest see settingsyaml return drill data xyz coordin drilldata xyz minmax array drilldata expand sourc code def read_drilldatafeatur read drill data paramet param featur list drill featur interest see settingsyaml return drill data xyz coordin drilldata xyz minmax array drilldata fname_drilldata none drill pdread_csvinpath fname_drilldata drill drilldrillx xmin drillx xmax drilli ymin drilli ymax drillz zmax drillz zmincopi els drill none select data within extent convert local coordin system origin xy drillx drillx xmin drilli drilli ymin set voxel coordin grid xdrill drillxvalu ydrill drillyvalu zdrill drillzvalu tri drillfirst drillgroupbysiteidfirst drilllast drillgroupbysiteidlast xdrillminmax npasarraydrillfirstxvalu drilllastxvaluest ydrillminmax npasarraydrillfirstyvalu drilllastyvaluest zdrillminmax npasarraydrillfirstzvalu drilllastzvaluest except xdrillminmax npasarrayxdrillmin xdrillmin ydrillminmax npasarrayydrillmin ydrillmin zdrillminmax npasarrayzdrillmin zdrillmin coord npvstackxdril ydrill zdrillt drilldata featur featur data drillfeatur drilldataappendalign_drillcoord data return npasarraydrilldata coord xdrillminmax ydrillminmax zdrillminmax def read_surveydataplottruenam flex section desc read graviti data magnet data includ crop downsampl cube size paramet param plot boolean true plot survey data downsampl return graviti data magnet data sensor locat expand sourc code def read_surveydataplot true read graviti data magnet data includ crop downsampl cube size paramet param plot boolean true plot survey data downsampl return graviti data magnet data sensor locat fname_gravsurvey none gravimg rasterioopeninpath fname_gravsurvey grav gravimgread els grav none fname_magsurvey none magimg rasterioopeninpath fname_magsurvey mag magimgread els mag none downsampl cube voxels zoomfac xncube gravshap grav zoomgrav zoomfac assert gravshap yncube xncube zoomfac xncube magshap mag zoommag zoomfac assert magshap yncube xncube creat survey sensor coordin x_ nplinspac xncube xncube xvoxsiz y_ nplinspac yncube yncube yvoxsiz z_ zmax zoff x_sensor y_sensor z_sensor npmeshgridx_sy_sz_ locat npasarrayx_sensorflatten y_sensorflatten z_sensorflatt ospathexistsoutpath osmakedirsoutpath plot extentxminxmaxyminymax pltimshowgrav aspect equal cmap viridi extentext pltcolorbar pltsavefigoutpath gravfieldpng pltclf pltimshowmag aspect equal cmap viridi extentext pltcolorbar pltsavefigoutpath magfieldpng pltclf pltimshowgrav aspect equal cmap viridi extentext pltcolorbar pltsavefigoutpath gravfield_downsampledpng pltclf pltimshowmag aspect equal cmap viridi extentext pltcolorbar pltsavefigoutpath magfield_downsampledpng pltcloseal return gravflatten magflatten locat section index toc supermodul geobo functionsheaderfunct function align_dril bayesopt_nonvert bayesopt_vert costcub create_costcub futility_dril futility_vert read_drilldata read_surveydata gener pdoc httpspdocgithubiopdoc rolemain sectionintro section script run invers reconstruct cube sensor data use gaussina process author sebastian haan expand sourc code script run invers reconstruct cube sensor data use gaussina process author sebastian haan import numpi np import sy scipylinalg import pinv solv choleski solve_triangular config_load import import kernel kernel gaussian process prior import sensormodel class invers class invers reconstructon cube sensor data solv invers problem linear system deploy bayesian framework gaussian process prior physic properti interest gaussian process gp flexibl probabilist approach use kernel machin nonparametr prior see eg rasmussen import advantag bayesian method gener predict distribut mean varianc prerequisit bayesian optimis respect eg inform gain new measur anoth advantag gp margin likelihood function well defin valu hyperparamet allow optimis exactli reason function uncertainti welltun interpol charact allow gp work extrem well spars data well big data use spars covari matrix see eg melkumyan take fulli account crosscovari multipl model paramet eg rock densiti magnet suscept construct spars crosscovari term kernel pair follow melkumyan full covari matrix construct set spars covari function diagon block element sparsespars crosscovari function nondiagon block element crosscovari amplitud term given linear correl coeffici correspond geophys properti call function cube run invers def __init__self set lengthscal amplitud gp selfgp_length gp_lengthscal npasarrayxvoxs xvoxsiz xvoxsiz voxels seem max logl selfgp_sigma npasarraygp_err selfcoeffm npasarraygp_coeff coeffici gp kernel mix def create_cubegeometryself creat cube geometri coordin see settingsyaml cube specif creat voxel edg coordin xedg nplinspac xncube xncube xvoxsiz yedg nplinspac yncube yncube yvoxsiz zedg nplinspac zncube zncube zvoxsiz zmax zedg nplinspacencubezfactor ncubezfactor voxsiz xedg yedg zedg npmeshgridxedg yedg zedg selfedg npasarrayxedg yedg zedg creat voxel coordin xnew nparangexvoxs xlcube xvoxsiz xvoxsiz ynew nparangeyvoxs ylcube yvoxsiz yvoxsiz znew zmax nparangezvoxs zlcube zvoxsiz zvoxsiz xx yy npmeshgridxnewynew selfxxx selfyyi selfzzz npmeshgridxnew ynew znew selfvoxelpo npvstackselfxxxflatten selfyyyflatten selfzzzflatten return selfvoxelpo def predictself calclogl fals calcul mean varianc likelihood likelihood gp x kernel block matrix paramet param calclogl true calcul margin gp loglikelihood fals logl return set return mean covari loglikelihood calcul kernel x block matrix selfdatastd npmeannpnanstdselfgravfield npnanstdselfmagfield npnanstdselfdrillfield selfkcov kernelcreate_covselfd selfgp_length selfcoeffm fkernel kernelfunc ak npdotselfasen kcov shape nsensor ncube yerr nphstackselfgravfield selfgp_sigma selfmagfield selfgp_sigma selfdrillfield selfgp_sigma tri aka npdotselfasen npdotselfkcov selfasenst npdiagyerr aka npdotak selfasenst npdiagyerr shapensensor nsensor choleski decomposit tri aka_chol choleskyaka lowertru except printcholeski decompost fail aka matrix like posit semit printchang gp paramet set sysexit usolv solve_triangularaka_chol selff lowertru shapensensor calcul likelihood option set calclogl log_det_aka nplognpdiagaka_cholsum n_log_pi xncube yncube zncube nplog nppi logl npdotusolv usolv log_det_aka n_log_pi els logl predict mean self_v solve_triangularaka_chol npdotselfasen selfkcov lowertru shapensensor ncube mu npdotself_vt usolv _fstd _fmean covari covar selfkcov npdotself_vt self_v var npdiagonalcovar _fstd except printwarn gp invers fail mu covar logl npzerosxncubeyncubezncub kcov e npinf return mu covar logl def cubingself gravfield magfield drillfield sensor_loc drilldata joint invers cube sensor data paramet param gravfield gravit survey data param magfield magnet survey data param drillfield drilldata return density_rec cube mean densiti magsus_rec cube mean magnet suscept drill_rec cube mean drillcor properti density_var varic cube densiti magsus_var varianc cube magnet suscept drill_var varianbc cube drillcor properti selfgravfield gravfield selfmagfield magfield selfdrillfield drillfield selfsensor_loc sensor_loc selfdrilldata drilldata normal data grav_mean grav_std selfgravfieldmean selfgravfieldstd gravfield_norm selfgravfield grav_mean grav_std magn_mean magn_std selfmagfieldmean selfmagfieldstd magfield_norm selfmagfield magn_mean magn_std drill_mean drill_std selfdrillfieldmean selfdrillfieldstd drillfield_norm selfdrillfield drill_mean drill_std creat kernel distanc matrix selfpointsd kernelcalcgridpointsdxncub yncube zncube xvoxsiz yvoxsiz zvoxsiz selfd kernelcalcdistancematrixselfpointsd combin data forward model voxelpos_dril npvstackselfxxxselfdrilldata selfyyyselfdrilldata selfzzzselfdrilldata combin data selff nphstackgravfield_norm magfield_norm drillfield_norm calcul sensit matrix asens_grav _ a_sensmagneticfield selfsensor_loc selfedg grav asens_mag _ a_sensmagneticfield selfsensor_loc selfedg magn asens_dril a_drillvoxelpos_dril selfvoxelpo calcul total transform matrix asens_g npvstackasens_grav npzeros_likeasens_mag npzeros_likeasens_dril asens_m npvstacknpzeros_likeasens_grav asens_mag npzeros_likeasens_dril asens_d npvstacknpzeros_likeasens_grav npzeros_likeasens_mag asens_dril selfasen nphstackasens_g asens_m asens_d run actual gp invers selfmu_rec selfcov_rec selflogl selfpredictcalclogl true reshap result multipli stadnard deviatio results_rec selfmu_recreshap yncube xncube zncube results_var npdiagselfcov_recreshap yncube xncube zncube cut outer voxel row results_rec results_rec yncube xncube results_var results_var yncube xncube density_rec results_rec grav_std model repres deviat mean density_var results_var grav_std magsus_rec results_rec magn_std model repres deviat mean magsus_var results_var magn_std drill_rec results_rec drill_std model repres deviat mean drill_var results_var drill_std return density_rec magsus_rec drill_rec density_var magsus_var drill_var section section section section class headerclass sectiontitl class inversionflex name class section desc class invers reconstructon cube sensor data solv invers problem linear system deploy bayesian framework gaussian process prior physic properti interest gaussian process gp flexibl probabilist approach use kernel machin nonparametr prior see eg rasmussen import advantag bayesian method gener predict distribut mean varianc prerequisit bayesian optimis respect eg inform gain new measur anoth advantag gp margin likelihood function well defin valu hyperparamet allow optimis exactli reason function uncertainti welltun interpol charact allow gp work extrem well spars data well big data use spars covari matrix see eg melkumyan take fulli account crosscovari multipl model paramet eg rock densiti magnet suscept construct spars crosscovari term kernel pair follow melkumyan full covari matrix construct set spars covari function diagon block element sparsespars crosscovari function nondiagon block element crosscovari amplitud term given linear correl coeffici correspond geophys properti call function cube run invers expand sourc code class invers class invers reconstructon cube sensor data solv invers problem linear system deploy bayesian framework gaussian process prior physic properti interest gaussian process gp flexibl probabilist approach use kernel machin nonparametr prior see eg rasmussen import advantag bayesian method gener predict distribut mean varianc prerequisit bayesian optimis respect eg inform gain new measur anoth advantag gp margin likelihood function well defin valu hyperparamet allow optimis exactli reason function uncertainti welltun interpol charact allow gp work extrem well spars data well big data use spars covari matrix see eg melkumyan take fulli account crosscovari multipl model paramet eg rock densiti magnet suscept construct spars crosscovari term kernel pair follow melkumyan full covari matrix construct set spars covari function diagon block element sparsespars crosscovari function nondiagon block element crosscovari amplitud term given linear correl coeffici correspond geophys properti call function cube run invers def __init__self set lengthscal amplitud gp selfgp_length gp_lengthscal npasarrayxvoxs xvoxsiz xvoxsiz voxels seem max logl selfgp_sigma npasarraygp_err selfcoeffm npasarraygp_coeff coeffici gp kernel mix def create_cubegeometryself creat cube geometri coordin see settingsyaml cube specif creat voxel edg coordin xedg nplinspac xncube xncube xvoxsiz yedg nplinspac yncube yncube yvoxsiz zedg nplinspac zncube zncube zvoxsiz zmax zedg nplinspacencubezfactor ncubezfactor voxsiz xedg yedg zedg npmeshgridxedg yedg zedg selfedg npasarrayxedg yedg zedg creat voxel coordin xnew nparangexvoxs xlcube xvoxsiz xvoxsiz ynew nparangeyvoxs ylcube yvoxsiz yvoxsiz znew zmax nparangezvoxs zlcube zvoxsiz zvoxsiz xx yy npmeshgridxnewynew selfxxx selfyyi selfzzz npmeshgridxnew ynew znew selfvoxelpo npvstackselfxxxflatten selfyyyflatten selfzzzflatten return selfvoxelpo def predictself calclogl fals calcul mean varianc likelihood likelihood gp x kernel block matrix paramet param calclogl true calcul margin gp loglikelihood fals logl return set return mean covari loglikelihood calcul kernel x block matrix selfdatastd npmeannpnanstdselfgravfield npnanstdselfmagfield npnanstdselfdrillfield selfkcov kernelcreate_covselfd selfgp_length selfcoeffm fkernel kernelfunc ak npdotselfasen kcov shape nsensor ncube yerr nphstackselfgravfield selfgp_sigma selfmagfield selfgp_sigma selfdrillfield selfgp_sigma tri aka npdotselfasen npdotselfkcov selfasenst npdiagyerr aka npdotak selfasenst npdiagyerr shapensensor nsensor choleski decomposit tri aka_chol choleskyaka lowertru except printcholeski decompost fail aka matrix like posit semit printchang gp paramet set sysexit usolv solve_triangularaka_chol selff lowertru shapensensor calcul likelihood option set calclogl log_det_aka nplognpdiagaka_cholsum n_log_pi xncube yncube zncube nplog nppi logl npdotusolv usolv log_det_aka n_log_pi els logl predict mean self_v solve_triangularaka_chol npdotselfasen selfkcov lowertru shapensensor ncube mu npdotself_vt usolv _fstd _fmean covari covar selfkcov npdotself_vt self_v var npdiagonalcovar _fstd except printwarn gp invers fail mu covar logl npzerosxncubeyncubezncub kcov e npinf return mu covar logl def cubingself gravfield magfield drillfield sensor_loc drilldata joint invers cube sensor data paramet param gravfield gravit survey data param magfield magnet survey data param drillfield drilldata return density_rec cube mean densiti magsus_rec cube mean magnet suscept drill_rec cube mean drillcor properti density_var varic cube densiti magsus_var varianc cube magnet suscept drill_var varianbc cube drillcor properti selfgravfield gravfield selfmagfield magfield selfdrillfield drillfield selfsensor_loc sensor_loc selfdrilldata drilldata normal data grav_mean grav_std selfgravfieldmean selfgravfieldstd gravfield_norm selfgravfield grav_mean grav_std magn_mean magn_std selfmagfieldmean selfmagfieldstd magfield_norm selfmagfield magn_mean magn_std drill_mean drill_std selfdrillfieldmean selfdrillfieldstd drillfield_norm selfdrillfield drill_mean drill_std creat kernel distanc matrix selfpointsd kernelcalcgridpointsdxncub yncube zncube xvoxsiz yvoxsiz zvoxsiz selfd kernelcalcdistancematrixselfpointsd combin data forward model voxelpos_dril npvstackselfxxxselfdrilldata selfyyyselfdrilldata selfzzzselfdrilldata combin data selff nphstackgravfield_norm magfield_norm drillfield_norm calcul sensit matrix asens_grav _ a_sensmagneticfield selfsensor_loc selfedg grav asens_mag _ a_sensmagneticfield selfsensor_loc selfedg magn asens_dril a_drillvoxelpos_dril selfvoxelpo calcul total transform matrix asens_g npvstackasens_grav npzeros_likeasens_mag npzeros_likeasens_dril asens_m npvstacknpzeros_likeasens_grav asens_mag npzeros_likeasens_dril asens_d npvstacknpzeros_likeasens_grav npzeros_likeasens_mag asens_dril selfasen nphstackasens_g asens_m asens_d run actual gp invers selfmu_rec selfcov_rec selflogl selfpredictcalclogl true reshap result multipli stadnard deviatio results_rec selfmu_recreshap yncube xncube zncube results_var npdiagselfcov_recreshap yncube xncube zncube cut outer voxel row results_rec results_rec yncube xncube results_var results_var yncube xncube density_rec results_rec grav_std model repres deviat mean density_var results_var grav_std magsus_rec results_rec magn_std model repres deviat mean magsus_var results_var magn_std drill_rec results_rec drill_std model repres deviat mean drill_var results_var drill_std return density_rec magsus_rec drill_rec density_var magsus_var drill_var method def create_cubegeometryselfnam flex section desc creat cube geometri coordin see settingsyaml cube specif expand sourc code def create_cubegeometryself creat cube geometri coordin see settingsyaml cube specif creat voxel edg coordin xedg nplinspac xncube xncube xvoxsiz yedg nplinspac yncube yncube yvoxsiz zedg nplinspac zncube zncube zvoxsiz zmax zedg nplinspacencubezfactor ncubezfactor voxsiz xedg yedg zedg npmeshgridxedg yedg zedg selfedg npasarrayxedg yedg zedg creat voxel coordin xnew nparangexvoxs xlcube xvoxsiz xvoxsiz ynew nparangeyvoxs ylcube yvoxsiz yvoxsiz znew zmax nparangezvoxs zlcube zvoxsiz zvoxsiz xx yy npmeshgridxnewynew selfxxx selfyyi selfzzz npmeshgridxnew ynew znew selfvoxelpo npvstackselfxxxflatten selfyyyflatten selfzzzflatten return selfvoxelpo def cubingself gravfield magfield drillfield sensor_loc drilldatanam flex section desc joint invers cube sensor data paramet param gravfield gravit survey data param magfield magnet survey data param drillfield drilldata return density_rec cube mean densiti magsus_rec cube mean magnet suscept drill_rec cube mean drillcor properti density_var varic cube densiti magsus_var varianc cube magnet suscept drill_var varianbc cube drillcor properti expand sourc code def cubingself gravfield magfield drillfield sensor_loc drilldata joint invers cube sensor data paramet param gravfield gravit survey data param magfield magnet survey data param drillfield drilldata return density_rec cube mean densiti magsus_rec cube mean magnet suscept drill_rec cube mean drillcor properti density_var varic cube densiti magsus_var varianc cube magnet suscept drill_var varianbc cube drillcor properti selfgravfield gravfield selfmagfield magfield selfdrillfield drillfield selfsensor_loc sensor_loc selfdrilldata drilldata normal data grav_mean grav_std selfgravfieldmean selfgravfieldstd gravfield_norm selfgravfield grav_mean grav_std magn_mean magn_std selfmagfieldmean selfmagfieldstd magfield_norm selfmagfield magn_mean magn_std drill_mean drill_std selfdrillfieldmean selfdrillfieldstd drillfield_norm selfdrillfield drill_mean drill_std creat kernel distanc matrix selfpointsd kernelcalcgridpointsdxncub yncube zncube xvoxsiz yvoxsiz zvoxsiz selfd kernelcalcdistancematrixselfpointsd combin data forward model voxelpos_dril npvstackselfxxxselfdrilldata selfyyyselfdrilldata selfzzzselfdrilldata combin data selff nphstackgravfield_norm magfield_norm drillfield_norm calcul sensit matrix asens_grav _ a_sensmagneticfield selfsensor_loc selfedg grav asens_mag _ a_sensmagneticfield selfsensor_loc selfedg magn asens_dril a_drillvoxelpos_dril selfvoxelpo calcul total transform matrix asens_g npvstackasens_grav npzeros_likeasens_mag npzeros_likeasens_dril asens_m npvstacknpzeros_likeasens_grav asens_mag npzeros_likeasens_dril asens_d npvstacknpzeros_likeasens_grav npzeros_likeasens_mag asens_dril selfasen nphstackasens_g asens_m asens_d run actual gp invers selfmu_rec selfcov_rec selflogl selfpredictcalclogl true reshap result multipli stadnard deviatio results_rec selfmu_recreshap yncube xncube zncube results_var npdiagselfcov_recreshap yncube xncube zncube cut outer voxel row results_rec results_rec yncube xncube results_var results_var yncube xncube density_rec results_rec grav_std model repres deviat mean density_var results_var grav_std magsus_rec results_rec magn_std model repres deviat mean magsus_var results_var magn_std drill_rec results_rec drill_std model repres deviat mean drill_var results_var drill_std return density_rec magsus_rec drill_rec density_var magsus_var drill_var def predictself calcloglfalsenam flex section desc calcul mean varianc likelihood likelihood gp x kernel block matrix paramet param calclogl true calcul margin gp loglikelihood fals logl return set return mean covari loglikelihood expand sourc code def predictself calclogl fals calcul mean varianc likelihood likelihood gp x kernel block matrix paramet param calclogl true calcul margin gp loglikelihood fals logl return set return mean covari loglikelihood calcul kernel x block matrix selfdatastd npmeannpnanstdselfgravfield npnanstdselfmagfield npnanstdselfdrillfield selfkcov kernelcreate_covselfd selfgp_length selfcoeffm fkernel kernelfunc ak npdotselfasen kcov shape nsensor ncube yerr nphstackselfgravfield selfgp_sigma selfmagfield selfgp_sigma selfdrillfield selfgp_sigma tri aka npdotselfasen npdotselfkcov selfasenst npdiagyerr aka npdotak selfasenst npdiagyerr shapensensor nsensor choleski decomposit tri aka_chol choleskyaka lowertru except printcholeski decompost fail aka matrix like posit semit printchang gp paramet set sysexit usolv solve_triangularaka_chol selff lowertru shapensensor calcul likelihood option set calclogl log_det_aka nplognpdiagaka_cholsum n_log_pi xncube yncube zncube nplog nppi logl npdotusolv usolv log_det_aka n_log_pi els logl predict mean self_v solve_triangularaka_chol npdotselfasen selfkcov lowertru shapensensor ncube mu npdotself_vt usolv _fstd _fmean covari covar selfkcov npdotself_vt self_v var npdiagonalcovar _fstd except printwarn gp invers fail mu covar logl npzerosxncubeyncubezncub kcov e npinf return mu covar logl index toc supermodul geobo classesheaderclass class invers create_cubegeometri cube predict gener pdoc httpspdocgithubiopdoc rolemain sectionintro section framework plot volumetr data cube voxel grid includ export datacub vtk file author sebastian haan expand sourc code framework plot volumetr data cube voxel grid includ export datacub vtk file author sebastian haan __future__ import print_funct import numpi np import os import sy mpl_toolkitsmplotd import axesd import matplotlibpyplot plt matplotlib import cm matplotlibcolor import lightsourc import pyvista pv helper modul visual toolkit vtk import plotlyplotli py mpl_toolkitsmplotdartd import polydcollect skimag import measur def skplotdens nsize drill sensor savefig true show true path_out filenam densitydrillmeshpng make volumetr mesh plot differ densiti level plot vertic drillhol well param drill x drillposit savefig ospathexistspath_out rais valueerrorpath found path_out els outfil path_out filenam nsize npasarrayns lendril drill npasarraydril xdrill drill ydrill drill lensensor sensor npasarraysensor x_sensor sensor y_sensor sensor z_sensor sensor colorschem cmviridi fstd densitystd fmean densitymean fmax densitymax fmean sface nplinspacefstd fmax els sface nplinspacefmeanfstd fmax cface colorschemesfacessfacesmax fig pltfigurefigs ax figadd_subplot projectiond plot densiti sfact sfacesminsfacesmax cface sfacessfacesmax introduc new librari rangelensfac sfacesi vert face normal valu measuremarching_cubes_lewinerdens sfacesi mesh polydcollectionvertsfac meshset_facecolorcfacesi meshset_alphasfacesisfacesmax meshset_edgecolorcfacesi axadd_collectiondmesh plot drillhol lendril rangelenxdril axplotxdrillixdrilliydrilliydrillidensityshap k plot grav mag sensor lensensor axscatterx_sensorflatten y_sensorflatten z_sensorflatten cr markero axset_xlab axset_ylabelx axset_zlabelz axset_xlim nsize time two nd ellipsoid axset_ylim nsize b axset_zlim nsize c axinvert_zaxi axset_titledrillhol strlenxdril cmscalarmappablecmap colorschem mset_arraysfac cbar pltcolorbarm plttight_layout savefig pltsavefigoutfil show pltshow def skplotdens nsize drill sensor savefig true show true path_out filenam densitydrillmeshpng make columetr mesh plot differ densiti level plot nonvert drillhol param drill x z drillposit savefig ospathexistspath_out rais valueerrorpath found path_out els outfil path_out filenam nsize npasarrayns lendril drill npasarraydril xdrill drill ydrill drill zdrill drill lensensor sensor npasarraysensor x_sensor sensor y_sensor sensor z_sensor sensor colorschem cmviridi fstd densitystd fmean densitymean fmax nppercentiledens fmax densitymax fmin nppercentiledens fmean sface nplinspacefstd fmax els sface nplinspacefminfstd fmax cface colorschemesfac fminsfac fminmax fig pltfigurefigs ax figadd_subplot projectiond plot densiti sfact sfacesminsfacesmax cface sfacessfacesmax introduc new librari rangelensfac sfacesi vert face normal valu measuremarching_cubes_lewinerdens sfacesi mesh polydcollectionvertsfac meshset_facecolorcfacesi meshset_alphasfacesisfacesmax meshset_edgecolorcfacesi axadd_collectiondmesh plot drillhol lendril axscatterxdril ydrill zdrill c k marker rangelenxdril axplotxdrilli xdrilli ydrilli ydrilli zdrilli zdrilli k plot grav mag sensor lensensor axscatterx_sensorflatten y_sensorflatten z_sensorflatten cr markero axset_xlab axset_ylabelx axset_zlabelz axset_xlim nsize time two nd ellipsoid axset_ylim nsize b axset_zlim nsize c axinvert_zaxi axset_titledrillhol strlenxdril cmscalarmappablecmap colorschem mset_arraysfac cbar pltcolorbarm plttight_layout savefig pltsavefigoutfil show pltshow def create_vtkcubedens origin voxels fname export cube vtk file use eg paraview creat rang cube plot pyvista param densiti cube shape xdim ydim zdim param origin origin cooridn cube param voxels voxel size xsize ysize zsize param fname path filenam file grid pvuniformgrid griddimens nparraydensityshap gridorigin origin gridspac voxels gridcell_arraysvalu densityflattenorderf gridsavefnam section section section function headerfunct sectiontitl def create_vtkcubedens origin voxels fnamenam flex section desc export cube vtk file use eg paraview creat rang cube plot pyvista param densiti cube shape xdim ydim zdim param origin origin cooridn cube param voxels voxel size xsize ysize zsize param fname path filenam file expand sourc code def create_vtkcubedens origin voxels fname export cube vtk file use eg paraview creat rang cube plot pyvista param densiti cube shape xdim ydim zdim param origin origin cooridn cube param voxels voxel size xsize ysize zsize param fname path filenam file grid pvuniformgrid griddimens nparraydensityshap gridorigin origin gridspac voxels gridcell_arraysvalu densityflattenorderf gridsavefnam def skplotdens nsize drill sensor savefigtru showtru path_out filenamedensitydrillmeshpngnam flex section desc make volumetr mesh plot differ densiti level plot vertic drillhol well param drill x drillposit expand sourc code def skplotdens nsize drill sensor savefig true show true path_out filenam densitydrillmeshpng make volumetr mesh plot differ densiti level plot vertic drillhol well param drill x drillposit savefig ospathexistspath_out rais valueerrorpath found path_out els outfil path_out filenam nsize npasarrayns lendril drill npasarraydril xdrill drill ydrill drill lensensor sensor npasarraysensor x_sensor sensor y_sensor sensor z_sensor sensor colorschem cmviridi fstd densitystd fmean densitymean fmax densitymax fmean sface nplinspacefstd fmax els sface nplinspacefmeanfstd fmax cface colorschemesfacessfacesmax fig pltfigurefigs ax figadd_subplot projectiond plot densiti sfact sfacesminsfacesmax cface sfacessfacesmax introduc new librari rangelensfac sfacesi vert face normal valu measuremarching_cubes_lewinerdens sfacesi mesh polydcollectionvertsfac meshset_facecolorcfacesi meshset_alphasfacesisfacesmax meshset_edgecolorcfacesi axadd_collectiondmesh plot drillhol lendril rangelenxdril axplotxdrillixdrilliydrilliydrillidensityshap k plot grav mag sensor lensensor axscatterx_sensorflatten y_sensorflatten z_sensorflatten cr markero axset_xlab axset_ylabelx axset_zlabelz axset_xlim nsize time two nd ellipsoid axset_ylim nsize b axset_zlim nsize c axinvert_zaxi axset_titledrillhol strlenxdril cmscalarmappablecmap colorschem mset_arraysfac cbar pltcolorbarm plttight_layout savefig pltsavefigoutfil show pltshow def skplotdens nsize drill sensor savefigtru showtru path_out filenamedensitydrillmeshpngnam flex section desc make columetr mesh plot differ densiti level plot nonvert drillhol param drill x z drillposit expand sourc code def skplotdens nsize drill sensor savefig true show true path_out filenam densitydrillmeshpng make columetr mesh plot differ densiti level plot nonvert drillhol param drill x z drillposit savefig ospathexistspath_out rais valueerrorpath found path_out els outfil path_out filenam nsize npasarrayns lendril drill npasarraydril xdrill drill ydrill drill zdrill drill lensensor sensor npasarraysensor x_sensor sensor y_sensor sensor z_sensor sensor colorschem cmviridi fstd densitystd fmean densitymean fmax nppercentiledens fmax densitymax fmin nppercentiledens fmean sface nplinspacefstd fmax els sface nplinspacefminfstd fmax cface colorschemesfac fminsfac fminmax fig pltfigurefigs ax figadd_subplot projectiond plot densiti sfact sfacesminsfacesmax cface sfacessfacesmax introduc new librari rangelensfac sfacesi vert face normal valu measuremarching_cubes_lewinerdens sfacesi mesh polydcollectionvertsfac meshset_facecolorcfacesi meshset_alphasfacesisfacesmax meshset_edgecolorcfacesi axadd_collectiondmesh plot drillhol lendril axscatterxdril ydrill zdrill c k marker rangelenxdril axplotxdrilli xdrilli ydrilli ydrilli zdrilli zdrilli k plot grav mag sensor lensensor axscatterx_sensorflatten y_sensorflatten z_sensorflatten cr markero axset_xlab axset_ylabelx axset_zlabelz axset_xlim nsize time two nd ellipsoid axset_ylim nsize b axset_zlim nsize c axinvert_zaxi axset_titledrillhol strlenxdril cmscalarmappablecmap colorschem mset_arraysfac cbar pltcolorbarm plttight_layout savefig pltsavefigoutfil show pltshow section index toc supermodul geobo functionsheaderfunct function create_vtkcub skplot skplot gener pdoc httpspdocgithubiopdoc rolemain sectionintro section expand sourc code util function coordin convers read ion drillcor survey data import numpi np import panda pd import rasterio import os scipyndimageinterpol import zoom config_load import def sphericalcartesx z phi theta r convers spheric coordin cartesian paramet param x yz coordin origin param phi azimuth angl param theta polar angl param r radial length return x z coordin x x r npsintheta npcosphi r npsintheta npsinphi z z r npcostheta return x z def cartesspherialx z x z convers cartesian coordin spehric paramet param x yz coordin origin param x yz coordin end point return radiu polar angl azimuth angl r npsqrtxx yy zz theta nparccoszzr phi nparctanyyxx return r theta phi def align_drillcoord data convert drillcor data model cube shape iteratinon voxel paramet param coord xyz coordin drillcor shape n_drill param data dim data drillcor shape n_drill return drillcor voxel data cube dx xvoxsiz dy yvoxsiz dz zvoxsiz data npasarraydata re npzeros_likexxx ix rangexxxshap iy rangexxxshap iz rangexxxshap sel npwherexxxixiyiz dx coord coord xxxixiyiz dx yyyixiyiz dy coord coord yyyixiyiz dy zzzixiyiz dz coord coord zzzixiyiz dz npsizesel printsel npnanmeandatasel npisfinitem resixiyiz return re def normalizex normalis x param x input array normalis return normal array absxmax xmin norm x xmin xmax xmin els norm x xmax return norm def readcsv_drillfnam prop_nam pos_nam cartesian true read csv file drillcor data ectract data densiti magsu miner content drillcor data convert casrtesian xyz coordin xy posit length azimuth dip angl avail paramet param fname path filenam csv file param prop_nam string array properti name header file eg densiti magsu miner param pos_nam string array posit name header x z east north elev depthfrom depthto azimuth dip east north meter azimuth drip degre param cartesian true default drill posit provid xyz fromat meter fals drill posit cualcuat drill depth azimuth dip return return panda array posit drill properti name prop_nam pos_nam drill pdread_csvfname_drilldata name name cartesian xdrill ydrill zdrill drillpos_namesvalu drillpos_namesvalu drillpos_namesvalu els xdrillydrillzdril sphericalcartesdrilleastvalu drillnorthvalu drillelevvalu drillazimuthvalu nppi drilldipvalu nppi drilldepthfromvalu drilldepthtovalu data pddatafram datax xdrill datay ydrill dataz zdrill datadens drillprop_namesvalu datamagsu drillprop_namesvalu dataminer drillprop_namesvalu return data def readraster_surveyfnam pixr none clipext none read geotif rasterfil one band per properti paramet param fname path filenam csv file param pixr desir pixel resolut meter assum resolut x param clipext provid boundari box xminyminxmaxymax crop data extent return return numpi array survey data xy pixelcoordin img rasterioopenfnam bound imgbound format xmin ymin xmax ymax img_shap imgshap nativ pixel resolutiojn ypixr xpixr imgr ypixsiz xpixsiz printwarn input raster pixels resolut vertic horizont direct read data numpi array array imgread regrid array desir pixr none assert ypixr xpixr raster pixels resolut vertic horizont direct array zoomarray ypixsiz pixr xpixr ypixr pixr defin pixel coordin origin imag xx yy npmeshgridnplinspacebound xpixr bound xpixr arrayshap nplinspacebound ypixr bound ypixr arrayshap clipext none clipext npasarrayclipext check clip extent within boudn box bound clipext bound bound clipext bound bound clipext bound bound clipext bound clip array array arrayxx xpixr clipext xx xpixr clipext yy ypixr clipext yy ypixr clipext xx xxxx xpixr clipext xx xpixr clipext yy ypixr clipext yy ypixr clipext yy yyxx xpixr clipext xx xpixr clipext yy ypixr clipext yy ypixr clipext array arrayreshap nproundyymaxyyminypixr astypeint nproundxxmaxxxminxpixr astypeint xx xxreshap nproundyymaxyyminypixr astypeint nproundxxmaxxxminxpixr astypeint yy yyreshap nproundyymaxyyminypixr astypeint nproundxxmaxxxminxpixr astypeint els printwarn clip extent exce imag boundari clip appli els xx yy xx yy return array npasarrayxx yy section section section function headerfunct sectiontitl def align_drillcoord datanam flex section desc convert drillcor data model cube shape iteratinon voxel paramet param coord xyz coordin drillcor shape n_drill param data dim data drillcor shape n_drill return drillcor voxel data cube expand sourc code def align_drillcoord data convert drillcor data model cube shape iteratinon voxel paramet param coord xyz coordin drillcor shape n_drill param data dim data drillcor shape n_drill return drillcor voxel data cube dx xvoxsiz dy yvoxsiz dz zvoxsiz data npasarraydata re npzeros_likexxx ix rangexxxshap iy rangexxxshap iz rangexxxshap sel npwherexxxixiyiz dx coord coord xxxixiyiz dx yyyixiyiz dy coord coord yyyixiyiz dy zzzixiyiz dz coord coord zzzixiyiz dz npsizesel printsel npnanmeandatasel npisfinitem resixiyiz return re def cartesspherialx z x zname flex section desc convers cartesian coordin spehric paramet param x yz coordin origin param x yz coordin end point return radiu polar angl azimuth angl expand sourc code def cartesspherialx z x z convers cartesian coordin spehric paramet param x yz coordin origin param x yz coordin end point return radiu polar angl azimuth angl r npsqrtxx yy zz theta nparccoszzr phi nparctanyyxx return r theta phi def normalizexnam flex section desc normalis x param x input array normalis return normal array expand sourc code def normalizex normalis x param x input array normalis return normal array absxmax xmin norm x xmin xmax xmin els norm x xmax return norm def readcsv_drillfnam prop_nam pos_nam cartesiantruenam flex section desc read csv file drillcor data ectract data densiti magsu miner content drillcor data convert casrtesian xyz coordin xy posit length azimuth dip angl avail paramet param fname path filenam csv file param prop_nam string array properti name header file eg densiti magsu miner param pos_nam string array posit name header x z east north elev depthfrom depthto azimuth dip east north meter azimuth drip degre param cartesian true default drill posit provid xyz fromat meter fals drill posit cualcuat drill depth azimuth dip return return panda array posit drill properti expand sourc code def readcsv_drillfnam prop_nam pos_nam cartesian true read csv file drillcor data ectract data densiti magsu miner content drillcor data convert casrtesian xyz coordin xy posit length azimuth dip angl avail paramet param fname path filenam csv file param prop_nam string array properti name header file eg densiti magsu miner param pos_nam string array posit name header x z east north elev depthfrom depthto azimuth dip east north meter azimuth drip degre param cartesian true default drill posit provid xyz fromat meter fals drill posit cualcuat drill depth azimuth dip return return panda array posit drill properti name prop_nam pos_nam drill pdread_csvfname_drilldata name name cartesian xdrill ydrill zdrill drillpos_namesvalu drillpos_namesvalu drillpos_namesvalu els xdrillydrillzdril sphericalcartesdrilleastvalu drillnorthvalu drillelevvalu drillazimuthvalu nppi drilldipvalu nppi drilldepthfromvalu drilldepthtovalu data pddatafram datax xdrill datay ydrill dataz zdrill datadens drillprop_namesvalu datamagsu drillprop_namesvalu dataminer drillprop_namesvalu return data def readraster_surveyfnam pixresnon clipextnonenam flex section desc read geotif rasterfil one band per properti paramet param fname path filenam csv file param pixr desir pixel resolut meter assum resolut x param clipext provid boundari box xminyminxmaxymax crop data extent return return numpi array survey data xy pixelcoordin expand sourc code def readraster_surveyfnam pixr none clipext none read geotif rasterfil one band per properti paramet param fname path filenam csv file param pixr desir pixel resolut meter assum resolut x param clipext provid boundari box xminyminxmaxymax crop data extent return return numpi array survey data xy pixelcoordin img rasterioopenfnam bound imgbound format xmin ymin xmax ymax img_shap imgshap nativ pixel resolutiojn ypixr xpixr imgr ypixsiz xpixsiz printwarn input raster pixels resolut vertic horizont direct read data numpi array array imgread regrid array desir pixr none assert ypixr xpixr raster pixels resolut vertic horizont direct array zoomarray ypixsiz pixr xpixr ypixr pixr defin pixel coordin origin imag xx yy npmeshgridnplinspacebound xpixr bound xpixr arrayshap nplinspacebound ypixr bound ypixr arrayshap clipext none clipext npasarrayclipext check clip extent within boudn box bound clipext bound bound clipext bound bound clipext bound bound clipext bound clip array array arrayxx xpixr clipext xx xpixr clipext yy ypixr clipext yy ypixr clipext xx xxxx xpixr clipext xx xpixr clipext yy ypixr clipext yy ypixr clipext yy yyxx xpixr clipext xx xpixr clipext yy ypixr clipext yy ypixr clipext array arrayreshap nproundyymaxyyminypixr astypeint nproundxxmaxxxminxpixr astypeint xx xxreshap nproundyymaxyyminypixr astypeint nproundxxmaxxxminxpixr astypeint yy yyreshap nproundyymaxyyminypixr astypeint nproundxxmaxxxminxpixr astypeint els printwarn clip extent exce imag boundari clip appli els xx yy xx yy return array npasarrayxx yy def sphericalcartesx z phi theta rname flex section desc convers spheric coordin cartesian paramet param x yz coordin origin param phi azimuth angl param theta polar angl param r radial length return x z coordin expand sourc code def sphericalcartesx z phi theta r convers spheric coordin cartesian paramet param x yz coordin origin param phi azimuth angl param theta polar angl param r radial length return x z coordin x x r npsintheta npcosphi r npsintheta npsinphi z z r npcostheta return x z section index toc supermodul geobo functionsheaderfunct function align_dril cartesspheri normal readcsv_dril readraster_survey sphericalcart gener pdoc httpspdocgithubiopdoc rolemain sectionintro section calcuat forward model graviti magnet sensit well drill core transfrom forward model transform local measur remot sensor grid represent geophys properti region graviti magnet forward model graviti forward model defin use li tractabl approxim field constant densiti prism li oldenbur dinvers graviti data determin analyt induc magnet field calcul use li tractabl approxim field prism constant magnet suscept depend magnet miner content surfac measur respons magnet dipol induc earth magnet field joint gp invers take account covari exist densiti magnet suscept author sebastian haan expand sourc code calcuat forward model graviti magnet sensit well drill core transfrom forward model transform local measur remot sensor grid represent geophys properti region graviti magnet forward model graviti forward model defin use li tractabl approxim field constant densiti prism li oldenbur dinvers graviti data determin analyt induc magnet field calcul use li tractabl approxim field prism constant magnet suscept depend magnet miner content surfac measur respons magnet dipol induc earth magnet field joint gp invers take account covari exist densiti magnet suscept author sebastian haan import numpi np config_load import def a_sensmagneticfield locat edg func calcul graviti magnet forward model matrix paramet param magneicfield ambient magnet field param func grav graviti magn magnet return forward model ez edg npasarrayedg xedg edg yedg edg zedg edg bx magneticfield magneticfield bz magneticfield nprism xncube yncube zncube nedg xncube yncube zncube sen npzero xncube yncube nprism result_ez npzero xncube yncube nedg sensor locat n rang xncube yncube x xedg locationsn yedg locationsn z zedg locationsn zaxi alreadi invert lazi edg pad grav mag alongway e metr chosen obsedian x alongway alongway x alongway alongway precomput ez point func grav ez grav_funcx z shape ncubencubencub elif func magn ez magn_funcx z bx bz els printfunct support result_ezn ezreshapexncubeyncubezncub comput sensit idx rangexedgesshap j rangeyedgesshap k rangezedgesshap sensn idx ezi j k ezi j k ezi j k ezi j k ezi j k ezi j k ezi j k ezi j k idx func grav sen c_milligals_unit sen fcor_grav func magn sen sen fcor_mag return sen result_ez def grav_funcx z comput vertic compon graviti comput sensit particular point graviti paramet param x x coordin posit param coordin posit param z z coordin posit ep e r npsqrtx z func x nplogi r nplogx r z nparctanx z r ep return func def magn_funcxyzbxbybz comput magnet forward model calcul magnet sensit particular posit rel origin paramet param x x coordin posit param coordin posit param z z coordin posit param bx magnet field xdirect posit param magnet field ydirect posit param bz magnet field zdirect posit r npsqrtx z comput normalis factor magnet field normb npsqrtbx bx bz bz func normb bz nplogx r bz bx nplogi r bx nplogz r bz bz nparctanx z r bz bz bx bx nparctani z x r re func return re def a_drillloc voxelpo transform voxel cube filter matrix drill hole sensit paramet param loc xyz drillcor coordin shape ndrillcor param voxelpo xyz coordin shape nvoxel x voxelposflatten voxelposflatten z voxelposflatten sen npzeroslocshap xncube yncube zncube rangelocshap coord lociastypeint sel npwherex coord coord z coord sensi sel return sen section section section function headerfunct sectiontitl def a_drillloc voxelposnam flex section desc transform voxel cube filter matrix drill hole sensit paramet param loc xyz drillcor coordin shape ndrillcor param voxelpo xyz coordin shape nvoxel expand sourc code def a_drillloc voxelpo transform voxel cube filter matrix drill hole sensit paramet param loc xyz drillcor coordin shape ndrillcor param voxelpo xyz coordin shape nvoxel x voxelposflatten voxelposflatten z voxelposflatten sen npzeroslocshap xncube yncube zncube rangelocshap coord lociastypeint sel npwherex coord coord z coord sensi sel return sen def a_sensmagneticfield locat edg funcnam flex section desc calcul graviti magnet forward model matrix paramet param magneicfield ambient magnet field param func grav graviti magn magnet return forward model ez expand sourc code def a_sensmagneticfield locat edg func calcul graviti magnet forward model matrix paramet param magneicfield ambient magnet field param func grav graviti magn magnet return forward model ez edg npasarrayedg xedg edg yedg edg zedg edg bx magneticfield magneticfield bz magneticfield nprism xncube yncube zncube nedg xncube yncube zncube sen npzero xncube yncube nprism result_ez npzero xncube yncube nedg sensor locat n rang xncube yncube x xedg locationsn yedg locationsn z zedg locationsn zaxi alreadi invert lazi edg pad grav mag alongway e metr chosen obsedian x alongway alongway x alongway alongway precomput ez point func grav ez grav_funcx z shape ncubencubencub elif func magn ez magn_funcx z bx bz els printfunct support result_ezn ezreshapexncubeyncubezncub comput sensit idx rangexedgesshap j rangeyedgesshap k rangezedgesshap sensn idx ezi j k ezi j k ezi j k ezi j k ezi j k ezi j k ezi j k ezi j k idx func grav sen c_milligals_unit sen fcor_grav func magn sen sen fcor_mag return sen result_ez def grav_funcx zname flex section desc comput vertic compon graviti comput sensit particular point graviti paramet param x x coordin posit param coordin posit param z z coordin posit expand sourc code def grav_funcx z comput vertic compon graviti comput sensit particular point graviti paramet param x x coordin posit param coordin posit param z z coordin posit ep e r npsqrtx z func x nplogi r nplogx r z nparctanx z r ep return func def magn_funcx z bx bzname flex section desc comput magnet forward model calcul magnet sensit particular posit rel origin paramet param x x coordin posit param coordin posit param z z coordin posit param bx magnet field xdirect posit param magnet field ydirect posit param bz magnet field zdirect posit expand sourc code def magn_funcxyzbxbybz comput magnet forward model calcul magnet sensit particular posit rel origin paramet param x x coordin posit param coordin posit param z z coordin posit param bx magnet field xdirect posit param magnet field ydirect posit param bz magnet field zdirect posit r npsqrtx z comput normalis factor magnet field normb npsqrtbx bx bz bz func normb bz nplogx r bz bx nplogi r bx nplogz r bz bz nparctanx z r bz bz bx bx nparctani z x r re func return re section index toc supermodul geobo functionsheaderfunct function a_dril a_sen grav_func magn_func gener pdoc httpspdocgithubiopdoc rolemain sectionintro section script gener simul cube sensor set multipl distinct synthet geophys model creat includ twodip bodi cylind layer model model voxel cube geolog structur gener given densiti magnet suscept well correspond graviti magnet remot sensor measur custom model includ ad new model function create_syncub author sebastian haan expand sourc code script gener simul cube sensor set multipl distinct synthet geophys model creat includ twodip bodi cylind layer model model voxel cube geolog structur gener given densiti magnet suscept well correspond graviti magnet remot sensor measur custom model includ ad new model function create_syncub author sebastian haan mpl_toolkitsmplotd import axesd import matplotlibpyplot plt matplotlib import cm import panda pd import random import rasterio config_load import import invers sensormodel import import cubeshow cs def create_syncubemodelnam voxelpo creat synthet cube densiti magnet suscept gener two output file one vtk cube one csv file paramet param modelnam string option layers_ layers_ cylind param voxelpo voxel posit x z return densiti cube suscept cube printcreat simul cube data xxx yyy zzz voxelpo x xxxreshapeyncub xncube zncube yyyreshapeyncub xncube zncube z zzzreshapeyncub xncube zncube modelnam layers_ zshift zlcube npexpi zlcube layer npexpz zlcube zshift npexpz zlcube zshift cut nppercentilelay layerlay cut layerlay cut layermax layer npexpz zlcube zshift npexpz zlcube zshift cut nppercentilelay layerlay cut layerlay cut layermax densiti layer layer assum simpl correl magnet densiti magsu gp_coeff densiti modelnam layers_ zshift zlcube npexpi ylcube layer npexpz zlcube zshift npexpz zlcube zshift cut nppercentilelay layerlay cut layerlay cut layermax layer npexpz zlcube zshift npexpz zlcube zshift cut nppercentilelay layerlay cut layerlay cut layermax layer npexpz zlcube zshift npexpz zlcube zshift cut nppercentilelay layerlay cut layerlay cut layermax densiti layer layer layer magsu gp_coeff densiti modelnam cylind rad ylcube rc yylcub rad z zlcube rad rc yylcub rad z zlcube rad densiti x densityrc rad densityrc rad densityxxlcub xxlcube magnet densiti magsu gp_coeff densiti creat simul vtk cube origin voxelposmin voxelposmin voxelposmin voxels xvoxsiz yvoxsizezvoxs cscreate_vtkcubedens origin voxels fname inpath simcube_ modelnam vtk save simul data csv file newdf_head xyz densiti magsu data npasarrayxflatten yflatten zflatten densityflatten magsusflatten df pddataframedatat column newdf_head dfto_csvinpath simcube_ modelnam csv index fals creat simul drill data drillcor select four random xy coordin dfdrill dfcopi xdrill randomrandintxncub p rang ydrill randomrandrangeyncub p rang xdrill npasarrayxdril xvoxsiz xvoxsiz ydrill npasarrayydril yvoxsiz yvoxsiz dfdrill dfdrilllocdfdrillxisinxdril dfdrillyisinydril dfdrillsiteid siteid_ dfdrillxastypestr dfdrillyastypestr dfdrillto_csvinpath simdrill_ modelnam csv index fals return densiti magsu def create_synsurveymodelnam densiti magsu gener synthet graviti magntic survey data sensor position top cube data paramet param densiti densiti cube data param magsu magnet susceptibi cube data return graviti array magnet array printcreat simul sensor data creat voxel edg xedg nplinspac xncube xncube xvoxsiz yedg nplinspac yncube yncube yvoxsiz zedg nplinspac zncube zncube zvoxsiz zmax xedg yedg zedg npmeshgridxedg yedg zedg edg npasarrayxedg yedg zedg creat sensor posit xnew nparangexvoxs xlcube xvoxsiz xvoxsiz ynew nparangeyvoxs ylcube yvoxsiz yvoxsiz xx yy npmeshgridxnewynew zz xx zoff sensor_loc npasarrayxxflatten yyflatten zzflattent calcul sensit gravsen _ a_sensmagneticfield sensor_loc edg grav magsen _ a_sensmagneticfield sensor_loc edg magn gravfield npdotgravsen densityflatten shape nsensor equival gravsen propertiessumaxi magfield npdotmagsen magsusflatten gravd gravfieldreshapexxshap magnd magfieldreshapexxshap write csv file newdf_head xy graviti magnet data npasarrayxxflatten yyflatten gravfield magfield df pddataframedatat column newdf_head dfto_csvinpath simsurveydata_ modelnam csv index fals return gravd magnd def create_simdatamodelnam cylind plot true gener two simul cube densiti magnet suscept plu correspond graviti magnet sensor data surfac sensor data calcul via forward model specifi sensormodelpi set cube geometri earth magnet field sensor height ground specifi set sensor xy posit default center grid top voxel center paramet param modelnam string layers_ layers_ cylind default cylind param plot boolean true plot sensor simul data creat return simul data save output directori set csv file one cube one sensor data two cube aslo save addit vtk format file graviti magent survey data tif file plot sensor vertic integr cube data save output directori inv inversioninvers voxelpo invcreate_cubegeometri creat cube densiti magsu create_syncubemodelnam voxelpo creat sensor data gravd magnd create_synsurveymodelnam densiti magsu creat tif survey file rasterioopeninpath gravity_simdata_ modelnam tif wdriver gtiff width gravdshap heightgravdshap count dtypefloat dst dstwritegravdastyperasteriofloat rasterioopeninpath magnetic_simdata_ modelnam tif wdriver gtiff width magndshap heightmagndshap count dtypefloat dst dstwritemagndastyperasteriofloat plot sensor data integr cube data along vertic axi plot printcreat plot simul data extent npasarray xlcube ylcube fig ax pltsubplot sharextru shareytru figsiz axsimshowgravd extent extent axsset_titlegrav measur axsgridtru axsimshowmagnd extent extent axsset_titlemagnet meauerement axsgridtru axsimshownpsumdens axi extent extent axsset_titlevert sum densiti axsgridtru axsimshownpsummagsu axi extent extent axsset_titlevert sum magnet suscept axsgridtru plttight_layout pltsavefiginpath figure_simdata_ modelnam png dpi pltclose section section section function headerfunct sectiontitl def create_simdatamodelnamecylind plottruenam flex section desc gener two simul cube densiti magnet suscept plu correspond graviti magnet sensor data surfac sensor data calcul via forward model specifi sensormodelpi set cube geometri earth magnet field sensor height ground specifi set sensor xy posit default center grid top voxel center paramet param modelnam string layers_ layers_ cylind default cylind param plot boolean true plot sensor simul data creat return simul data save output directori set csv file one cube one sensor data two cube aslo save addit vtk format file graviti magent survey data tif file plot sensor vertic integr cube data save output directori expand sourc code def create_simdatamodelnam cylind plot true gener two simul cube densiti magnet suscept plu correspond graviti magnet sensor data surfac sensor data calcul via forward model specifi sensormodelpi set cube geometri earth magnet field sensor height ground specifi set sensor xy posit default center grid top voxel center paramet param modelnam string layers_ layers_ cylind default cylind param plot boolean true plot sensor simul data creat return simul data save output directori set csv file one cube one sensor data two cube aslo save addit vtk format file graviti magent survey data tif file plot sensor vertic integr cube data save output directori inv inversioninvers voxelpo invcreate_cubegeometri creat cube densiti magsu create_syncubemodelnam voxelpo creat sensor data gravd magnd create_synsurveymodelnam densiti magsu creat tif survey file rasterioopeninpath gravity_simdata_ modelnam tif wdriver gtiff width gravdshap heightgravdshap count dtypefloat dst dstwritegravdastyperasteriofloat rasterioopeninpath magnetic_simdata_ modelnam tif wdriver gtiff width magndshap heightmagndshap count dtypefloat dst dstwritemagndastyperasteriofloat plot sensor data integr cube data along vertic axi plot printcreat plot simul data extent npasarray xlcube ylcube fig ax pltsubplot sharextru shareytru figsiz axsimshowgravd extent extent axsset_titlegrav measur axsgridtru axsimshowmagnd extent extent axsset_titlemagnet meauerement axsgridtru axsimshownpsumdens axi extent extent axsset_titlevert sum densiti axsgridtru axsimshownpsummagsu axi extent extent axsset_titlevert sum magnet suscept axsgridtru plttight_layout pltsavefiginpath figure_simdata_ modelnam png dpi pltclose def create_syncubemodelnam voxelposnam flex section desc creat synthet cube densiti magnet suscept gener two output file one vtk cube one csv file paramet param modelnam string option layers_ layers_ cylind param voxelpo voxel posit x z return densiti cube suscept cube expand sourc code def create_syncubemodelnam voxelpo creat synthet cube densiti magnet suscept gener two output file one vtk cube one csv file paramet param modelnam string option layers_ layers_ cylind param voxelpo voxel posit x z return densiti cube suscept cube printcreat simul cube data xxx yyy zzz voxelpo x xxxreshapeyncub xncube zncube yyyreshapeyncub xncube zncube z zzzreshapeyncub xncube zncube modelnam layers_ zshift zlcube npexpi zlcube layer npexpz zlcube zshift npexpz zlcube zshift cut nppercentilelay layerlay cut layerlay cut layermax layer npexpz zlcube zshift npexpz zlcube zshift cut nppercentilelay layerlay cut layerlay cut layermax densiti layer layer assum simpl correl magnet densiti magsu gp_coeff densiti modelnam layers_ zshift zlcube npexpi ylcube layer npexpz zlcube zshift npexpz zlcube zshift cut nppercentilelay layerlay cut layerlay cut layermax layer npexpz zlcube zshift npexpz zlcube zshift cut nppercentilelay layerlay cut layerlay cut layermax layer npexpz zlcube zshift npexpz zlcube zshift cut nppercentilelay layerlay cut layerlay cut layermax densiti layer layer layer magsu gp_coeff densiti modelnam cylind rad ylcube rc yylcub rad z zlcube rad rc yylcub rad z zlcube rad densiti x densityrc rad densityrc rad densityxxlcub xxlcube magnet densiti magsu gp_coeff densiti creat simul vtk cube origin voxelposmin voxelposmin voxelposmin voxels xvoxsiz yvoxsizezvoxs cscreate_vtkcubedens origin voxels fname inpath simcube_ modelnam vtk save simul data csv file newdf_head xyz densiti magsu data npasarrayxflatten yflatten zflatten densityflatten magsusflatten df pddataframedatat column newdf_head dfto_csvinpath simcube_ modelnam csv index fals creat simul drill data drillcor select four random xy coordin dfdrill dfcopi xdrill randomrandintxncub p rang ydrill randomrandrangeyncub p rang xdrill npasarrayxdril xvoxsiz xvoxsiz ydrill npasarrayydril yvoxsiz yvoxsiz dfdrill dfdrilllocdfdrillxisinxdril dfdrillyisinydril dfdrillsiteid siteid_ dfdrillxastypestr dfdrillyastypestr dfdrillto_csvinpath simdrill_ modelnam csv index fals return densiti magsu def create_synsurveymodelnam densiti magsusnam flex section desc gener synthet graviti magntic survey data sensor position top cube data paramet param densiti densiti cube data param magsu magnet susceptibi cube data return graviti array magnet array expand sourc code def create_synsurveymodelnam densiti magsu gener synthet graviti magntic survey data sensor position top cube data paramet param densiti densiti cube data param magsu magnet susceptibi cube data return graviti array magnet array printcreat simul sensor data creat voxel edg xedg nplinspac xncube xncube xvoxsiz yedg nplinspac yncube yncube yvoxsiz zedg nplinspac zncube zncube zvoxsiz zmax xedg yedg zedg npmeshgridxedg yedg zedg edg npasarrayxedg yedg zedg creat sensor posit xnew nparangexvoxs xlcube xvoxsiz xvoxsiz ynew nparangeyvoxs ylcube yvoxsiz yvoxsiz xx yy npmeshgridxnewynew zz xx zoff sensor_loc npasarrayxxflatten yyflatten zzflattent calcul sensit gravsen _ a_sensmagneticfield sensor_loc edg grav magsen _ a_sensmagneticfield sensor_loc edg magn gravfield npdotgravsen densityflatten shape nsensor equival gravsen propertiessumaxi magfield npdotmagsen magsusflatten gravd gravfieldreshapexxshap magnd magfieldreshapexxshap write csv file newdf_head xy graviti magnet data npasarrayxxflatten yyflatten gravfield magfield df pddataframedatat column newdf_head dfto_csvinpath simsurveydata_ modelnam csv index fals return gravd magnd section index toc supermodul geobo functionsheaderfunct function create_simdata create_syncub create_synsurvey gener pdoc httpspdocgithubiopdoc rolemain sectionintro section kernel librari gaussian process includ spars kernel crosscovari term choic appropri covari function import gp output directli depend paramet covari function refer hyperparamet gp either given fix covari scale nois learn data optimis margin likelihood handl comput problem invert larg covari matrix spars covari function includ well take fulli account crosscovari multipl model paramet eg rock densiti magnet suscept construct crosscovari term label edn kernel pair one import requir construct crosscovari term must defin posit semidefinit inform overview construct matrix detail see melkumyan author sebastian haan expand sourc code kernel librari gaussian process includ spars kernel crosscovari term choic appropri covari function import gp output directli depend paramet covari function refer hyperparamet gp either given fix covari scale nois learn data optimis margin likelihood handl comput problem invert larg covari matrix spars covari function includ well take fulli account crosscovari multipl model paramet eg rock densiti magnet suscept construct crosscovari term label edn kernel pair one import requir construct crosscovari term must defin posit semidefinit inform overview construct matrix detail see melkumyan author sebastian haan scipi import reshap sqrt ident import numpi np def calcgridpointsdlpix pixscal return grid point distanc matrix calcul param lpix number pixel dimens array xlpix ylpix zlpix param pixscal pixelscal dimens array xpixscal ypixscal zpixscal lpix npasarraylpix pixscal npasarraypixscal xlpix ylpix zlpix lpix lpix lpix xpixscal ypixscal zpixscal pixscal pixscal pixscal xrang nparang xlpix xpixscal yrang nparang ylpix ypixscal zrang nparang zlpix zpixscal _xg _yg _zg npmeshgridxrang yrang zrang xr yr zr _xgravel _ygravel _zgravel return npasarrayxr yr zrt def calcdistancematrixndimpoint distfunclambda deltapoint npsumdeltapointd rangelendeltapoint return matrix squar distanc one coordin param ndimpoint list ndim tupl param distfunc calcul distanc base differ ndimpoint nparrayndimpoint dim lenndimpoint delta nonedim rangedim data ndimpointsd deltad data npreshapedatalendata comput possibl combin dist distfuncdelta dist dist npidentitylendatadistmax elimin self match return squar distanc return dist def calc_square_distancesdlpix pixscal initi squar distanc matrix stationari kernel lpix npasarraylpix pixscal npasarraypixscal xlpix ylpix lpix lpix xpixscal ypixscal pixscal pixscal xrang nparang xlpix xlpix xpixscal yrang nparang ylpix xlpix ypixscal _xg _yg npmeshgridxrang yrang xr yr _xgravel _ygravel dx xr npnewaxi xrnpnewaxi dy yr npnewaxi yrnpnewaxi return dx dy def gpkerneld gamma round rbf kernel length scale standard deviat psf gaussian process scene drawn kernel squar exponenti kernel param pairwis squar distanc param gamma kernel length scale return npexp dgamma def gpkerneld gamma exp squar x qxp squar kernel psf gaussian process scene drawn kernel squar exponenti kernel param pairwis squar distanc param gamma kernel length scale gamma gamma l gamma l gamma return npsqrtl l npexp dl l def gpkernel_spars gamma round spars rbf kernel defin melkumyan ramo lengthscal roughli equivlanet time lengthcal squar exponenti gpcubesolve_rpi param pairwis squar distanc param gamma kernel length scale npsqrtd gamma gamma re npzeros_lik resd gamma npcosnppi dd gamma gammadd gamma gamma nppi npsinnppidd gamma gamma remov float error resr return re def gpkernel_spars gamma spars matrix x spars matrix param pairwis squar distanc param gamma kernel length scale gamma gamma npsqrtd l gamma l gamma offset avoid nonzero term l l l e l lmean npmeanl l lmin npminll lmax npmaxll lmean re npzeros_lik absl l resd absl l npsqrtll lmin nppilmaxlmax lmin npsinnppilminlmaxnpcosnppidd absl l lmax absl l dl l resd absl l dl l npsqrtll lmean dd absl l dl l lnpsinnppildd absl l dl llnppill lnpsinnppildd absl l dl llnppill remov float error resr return re def gpkernel_maternd gamma matern kernel param pairwis squar distanc param gamma kernel length scale nu npsqrt npsqrtd gamma return nu npexpnu def gpkernel_matern_d gamma matern x matern kernel param pairwis squar distanc param gamma kernel length scale gamma gamma l gamma l gamma norm npsqrtl l return norm l npexp npsqrtdl l npexp npsqrtdl def create_covd gplength crossweight fkernel spars comput crosscorrel covari matrix param distanc matrix param gplength scalar array lengthscal properti three param crossweight array crosscorrel coeffic correspdon output properti www param fkernel kernel function either spars default exp squar exponenti matern cross weight www defin w densiti drill correlt w magent drill correl w densiti magnet correl return crosscorrel matrix first calcul kernel param npasarraygplength param param param param param param param param param param param param w w w npasarraycrossweight kcov npasarraygpkerneld param gpkerneld param gpkerneld param gpkerneld paramst fkernel matern kcov npvstackgpkernel_maternd param w gpkernel_matern_d param w gpkernel_matern_d param kcov npvstackw gpkernel_matern_d param gpkernel_maternd param w gpkernel_matern_d param kcov npvstackw gpkernel_matern_d param w gpkernel_matern_d param gpkernel_maternd param fkernel spars kcov npvstackgpkernel_spars param w gpkernel_spars param w gpkernel_spars param kcov npvstackw gpkernel_spars param gpkernel_spars param w gpkernel_spars param kcov npvstackw gpkernel_spars param w gpkernel_spars param gpkernel_spars param fkernel exp kcov npvstackgpkerneld param w gpkerneld param w gpkerneld param kcov npvstackw gpkerneld param gpkerneld param w gpkerneld param kcov npvstackw gpkerneld param w gpkerneld param gpkerneld param return nphstackkcov kcov kcov section section section function headerfunct sectiontitl def calcdistancematrixndimpoint distfuncfunct lambdanam flex section desc return matrix squar distanc one coordin param ndimpoint list ndim tupl param distfunc calcul distanc base differ expand sourc code def calcdistancematrixndimpoint distfunclambda deltapoint npsumdeltapointd rangelendeltapoint return matrix squar distanc one coordin param ndimpoint list ndim tupl param distfunc calcul distanc base differ ndimpoint nparrayndimpoint dim lenndimpoint delta nonedim rangedim data ndimpointsd deltad data npreshapedatalendata comput possibl combin dist distfuncdelta dist dist npidentitylendatadistmax elimin self match return squar distanc return dist def calcgridpointsdlpix pixscalenam flex section desc return grid point distanc matrix calcul param lpix number pixel dimens array xlpix ylpix zlpix param pixscal pixelscal dimens array xpixscal ypixscal zpixscal expand sourc code def calcgridpointsdlpix pixscal return grid point distanc matrix calcul param lpix number pixel dimens array xlpix ylpix zlpix param pixscal pixelscal dimens array xpixscal ypixscal zpixscal lpix npasarraylpix pixscal npasarraypixscal xlpix ylpix zlpix lpix lpix lpix xpixscal ypixscal zpixscal pixscal pixscal pixscal xrang nparang xlpix xpixscal yrang nparang ylpix ypixscal zrang nparang zlpix zpixscal _xg _yg _zg npmeshgridxrang yrang zrang xr yr zr _xgravel _ygravel _zgravel return npasarrayxr yr zrt def calc_square_distancesdlpix pixscalenam flex section desc initi squar distanc matrix stationari kernel expand sourc code def calc_square_distancesdlpix pixscal initi squar distanc matrix stationari kernel lpix npasarraylpix pixscal npasarraypixscal xlpix ylpix lpix lpix xpixscal ypixscal pixscal pixscal xrang nparang xlpix xlpix xpixscal yrang nparang ylpix xlpix ypixscal _xg _yg npmeshgridxrang yrang xr yr _xgravel _ygravel dx xr npnewaxi xrnpnewaxi dy yr npnewaxi yrnpnewaxi return dx dy def create_covd gplength crossweight fkernelsparsenam flex section desc comput crosscorrel covari matrix param distanc matrix param gplength scalar array lengthscal properti three param crossweight array crosscorrel coeffic correspdon output properti www param fkernel kernel function either spars default exp squar exponenti matern cross weight www defin w densiti drill correlt w magent drill correl w densiti magnet correl return crosscorrel matrix expand sourc code def create_covd gplength crossweight fkernel spars comput crosscorrel covari matrix param distanc matrix param gplength scalar array lengthscal properti three param crossweight array crosscorrel coeffic correspdon output properti www param fkernel kernel function either spars default exp squar exponenti matern cross weight www defin w densiti drill correlt w magent drill correl w densiti magnet correl return crosscorrel matrix first calcul kernel param npasarraygplength param param param param param param param param param param param param w w w npasarraycrossweight kcov npasarraygpkerneld param gpkerneld param gpkerneld param gpkerneld paramst fkernel matern kcov npvstackgpkernel_maternd param w gpkernel_matern_d param w gpkernel_matern_d param kcov npvstackw gpkernel_matern_d param gpkernel_maternd param w gpkernel_matern_d param kcov npvstackw gpkernel_matern_d param w gpkernel_matern_d param gpkernel_maternd param fkernel spars kcov npvstackgpkernel_spars param w gpkernel_spars param w gpkernel_spars param kcov npvstackw gpkernel_spars param gpkernel_spars param w gpkernel_spars param kcov npvstackw gpkernel_spars param w gpkernel_spars param gpkernel_spars param fkernel exp kcov npvstackgpkerneld param w gpkerneld param w gpkerneld param kcov npvstackw gpkerneld param gpkerneld param w gpkerneld param kcov npvstackw gpkerneld param w gpkerneld param gpkerneld param return nphstackkcov kcov kcov def gpkerneld gammanam flex section desc round rbf kernel length scale standard deviat psf gaussian process scene drawn kernel squar exponenti kernel param pairwis squar distanc param gamma kernel length scale expand sourc code def gpkerneld gamma round rbf kernel length scale standard deviat psf gaussian process scene drawn kernel squar exponenti kernel param pairwis squar distanc param gamma kernel length scale return npexp dgamma def gpkerneld gammasnam flex section desc exp squar x qxp squar kernel psf gaussian process scene drawn kernel squar exponenti kernel param pairwis squar distanc param gamma kernel length scale gamma gamma expand sourc code def gpkerneld gamma exp squar x qxp squar kernel psf gaussian process scene drawn kernel squar exponenti kernel param pairwis squar distanc param gamma kernel length scale gamma gamma l gamma l gamma return npsqrtl l npexp dl l def gpkernel_maternd gammanam flex section desc matern kernel param pairwis squar distanc param gamma kernel length scale expand sourc code def gpkernel_maternd gamma matern kernel param pairwis squar distanc param gamma kernel length scale nu npsqrt npsqrtd gamma return nu npexpnu def gpkernel_matern_d gammasnam flex section desc matern x matern kernel param pairwis squar distanc param gamma kernel length scale gamma gamma expand sourc code def gpkernel_matern_d gamma matern x matern kernel param pairwis squar distanc param gamma kernel length scale gamma gamma l gamma l gamma norm npsqrtl l return norm l npexp npsqrtdl l npexp npsqrtdl def gpkernel_spars gammanam flex section desc round spars rbf kernel defin melkumyan ramo lengthscal roughli equivlanet time lengthcal squar exponenti gpcubesolve_rpi param pairwis squar distanc param gamma kernel length scale expand sourc code def gpkernel_spars gamma round spars rbf kernel defin melkumyan ramo lengthscal roughli equivlanet time lengthcal squar exponenti gpcubesolve_rpi param pairwis squar distanc param gamma kernel length scale npsqrtd gamma gamma re npzeros_lik resd gamma npcosnppi dd gamma gammadd gamma gamma nppi npsinnppidd gamma gamma remov float error resr return re def gpkernel_spars gammasnam flex section desc spars matrix x spars matrix param pairwis squar distanc param gamma kernel length scale gamma gamma expand sourc code def gpkernel_spars gamma spars matrix x spars matrix param pairwis squar distanc param gamma kernel length scale gamma gamma npsqrtd l gamma l gamma offset avoid nonzero term l l l e l lmean npmeanl l lmin npminll lmax npmaxll lmean re npzeros_lik absl l resd absl l npsqrtll lmin nppilmaxlmax lmin npsinnppilminlmaxnpcosnppidd absl l lmax absl l dl l resd absl l dl l npsqrtll lmean dd absl l dl l lnpsinnppildd absl l dl llnppill lnpsinnppildd absl l dl llnppill remov float error resr return re section index toc supermodul geobo functionsheaderfunct function calcdistancematrix calcgridpointsd calc_square_distancesd create_cov gpkernel gpkernel gpkernel_matern gpkernel_matern_ gpkernel_spars gpkernel_spars gener pdoc httpspdocgithubiopdoc