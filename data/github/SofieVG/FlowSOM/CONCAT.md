# FlowSOM
Using self-organizing maps for visualization and interpretation of cytometry data

## Citation

If you use the FlowSOM package, please use the following citation: 

Sofie Van Gassen, Britt Callebaut, Mary J. Van Helden, Bart N. Lambrecht, Piet Demeester, Tom Dhaene and Yvan Saeys. FlowSOM: Using self-organizing maps for visualization and interpretation of cytometry data. Cytometry A 2015, volume 87.7 (p. 636-645)

DOI: 10.1002/cyto.a.22625


## Get the package

Check the [releases](https://github.com/saeyslab/FlowSOM/releases) to obtain the [latest release](https://github.com/saeyslab/FlowSOM/releases/latest)

Or you can install this package using the devtools library.

```
devtools::install_github("saeyslab/FlowSOM", build_vignettes = TRUE)
```
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{PlotLabels}
\alias{PlotLabels}
\title{PlotLabels}
\usage{
PlotLabels(
  fsom,
  labels,
  maxNodeSize = 0,
  textSize = 3.88,
  textColor = "black",
  ...
)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{FlowSOM}}}

\item{labels}{A vector of labels for every node.}

\item{maxNodeSize}{Determines the maximum nodesize. Default is 0.}

\item{textSize}{Size for geom_text. Default (=3.88) is from geom_text.}

\item{textColor}{Color for geom_text. Default = black.}

\item{...}{Additional arguments to pass to \code{\link{PlotFlowSOM}}}
}
\value{
Nothing is returned. A plot is drawn in which each node is 
represented by a label.
}
\description{
Plot labels for each cluster
}
\details{
Plot FlowSOM grid or tree, with in each node a label. 
Especially useful to show metacluster numbers
}
\examples{
# Read from file, build self-organizing map and minimal spanning tree
fileName <- system.file("extdata", "68983.fcs", package="FlowSOM")
ff <- flowCore::read.FCS(fileName)
ff <- flowCore::compensate(ff, flowCore::keyword(ff)[["SPILL"]])
ff <- flowCore::transform(ff,
         flowCore::transformList(colnames(flowCore::keyword(ff)[["SPILL"]]),
                                flowCore::logicleTransform()))
flowSOM.res <- FlowSOM(ff,
                       scale = TRUE,
                       colsToUse = c(9, 12, 14:18),
                       nClus = 10,
                       seed = 1)

# Plot the node IDs
PlotLabels( flowSOM.res, 
            flowSOM.res$metaclustering)

}
\seealso{
\code{\link{PlotStars}}, \code{\link{PlotVariable}},
\code{\link{PlotFlowSOM}}, \code{\link{PlotMarker}}, 
\code{\link{PlotNumbers}}, \code{\link{PlotPies}}, 
\code{\link{QueryStarPlot}}, \code{\link{PlotSD}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/1_readInput.R
\name{ReadInput}
\alias{ReadInput}
\title{Read fcs-files or flowframes}
\usage{
ReadInput(
  input,
  pattern = ".fcs",
  compensate = FALSE,
  spillover = NULL,
  transform = FALSE,
  toTransform = NULL,
  transformFunction = flowCore::logicleTransform(),
  transformList = NULL,
  scale = FALSE,
  scaled.center = TRUE,
  scaled.scale = TRUE,
  silent = FALSE
)
}
\arguments{
\item{input}{a flowFrame, a flowSet or an array of paths to files 
or directories}

\item{pattern}{if input is an array of file- or directorynames, 
select only files containing pattern}

\item{compensate}{logical, does the data need to be compensated}

\item{spillover}{spillover matrix to compensate with
If \code{NULL} and compensate = \code{TRUE}, we will
look for \code{$SPILL} description in fcs file.}

\item{transform}{logical, does the data need to be transformed}

\item{toTransform}{column names or indices that need to be transformed.
Will be ignored if \code{transformList} is given.
If \code{NULL} and transform = \code{TRUE}, column names
of \code{$SPILL} description in fcs file will be used.}

\item{transformFunction}{Defaults to logicleTransform()}

\item{transformList}{transformList to apply on the samples.}

\item{scale}{logical, does the data needs to be rescaled}

\item{scaled.center}{see \code{\link{scale}}}

\item{scaled.scale}{see \code{\link{scale}}}

\item{silent}{if \code{TRUE}, no progress updates will be printed. 
Default = \code{FALSE}}
}
\value{
FlowSOM object containing the data, which can be used as input
for the BuildSOM function
}
\description{
Take some input and return FlowSOM object containing a matrix with 
the preprocessed data (compensated, transformed, scaled)
}
\examples{
# Read from file
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
flowSOM.res <- ReadInput(fileName, compensate = TRUE, transform = TRUE,
                         scale = TRUE)

# Or read from flowFrame object
ff <- flowCore::read.FCS(fileName)
ff <- flowCore::compensate(ff, flowCore::keyword(ff)[["SPILL"]])
ff <- flowCore::transform(ff,
         flowCore::transformList(colnames(flowCore::keyword(ff)[["SPILL"]]),
                                flowCore::logicleTransform()))
flowSOM.res <- ReadInput(ff, scale = TRUE)

# Build the self-organizing map and the minimal spanning tree
flowSOM.res <- BuildSOM(flowSOM.res, colsToUse = c(9, 12, 14:18))
flowSOM.res <- BuildMST(flowSOM.res)

# Apply metaclustering
metacl <- MetaClustering(flowSOM.res$map$codes,
                         "metaClustering_consensus", max = 10)

# Get metaclustering per cell
flowSOM.clustering <- metacl[flowSOM.res$map$mapping[, 1]]    
 
}
\seealso{
\code{\link{scale}}, \code{\link{BuildSOM}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{GetClusters}
\alias{GetClusters}
\title{Get cluster label for all individual cells}
\usage{
GetClusters(fsom)
}
\arguments{
\item{fsom}{FlowSOM object as generated by the FlowSOM function
or the BuildSOM function}
}
\value{
vector label for every cell
}
\description{
Get cluster label for all individual cells
}
\examples{
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
flowSOM.res <- FlowSOM(fileName, compensate = TRUE, transform = TRUE,
                      scale = TRUE, colsToUse = c(9, 12, 14:18), nClus = 10)
cluster_labels <- GetClusters(flowSOM.res)

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{QueryStarPlot}
\alias{QueryStarPlot}
\title{QueryStarPlot}
\usage{
QueryStarPlot(
  fsom,
  query,
  plot = TRUE,
  colorPalette = FlowSOM_colors,
  backgroundColors = "#CA0020",
  ...
)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{BuildMST}}}

\item{query}{Array containing "high" or "low" for the specified 
column names of the FlowSOM data.}

\item{plot}{If true, a plot with a gradient of scores for the 
nodes is shown.}

\item{colorPalette}{ColorPalette to be used for colors for "stars", 
"pies" or "marker". Can be either a function or an 
array specifying colors.}

\item{backgroundColors}{Color to use for nodes with a high score in the plot.
Default is red.}

\item{...}{Additional arguments to pass to \code{\link{PlotFlowSOM}}}
}
\value{
A list, containing the ids of the selected nodes, the individual 
        scores for all nodes and the scores for each marker for each node
}
\description{
Query a certain cell type
}
\details{
Identify nodes in the tree which resemble a certain profile of "high"
or "low" marker expressions.
}
\examples{
   file <- system.file("extdata", "68983.fcs", package="FlowSOM")
   flowSOM.res <- FlowSOM(file, compensate = TRUE, transform = TRUE, 
                  scale = TRUE, colsToUse = c(9, 12, 14:18), nClus = 10, 
                  silent = FALSE, xdim = 7, ydim = 7)
   query <- c("CD3" = "high", #CD3
              "CD4" = "low", #TCRb
              "CD8" = "high") #CD8
   query_res <- QueryStarPlot(flowSOM.res, query, equalNodeSize = TRUE)
   
   cellTypes <- factor(rep("Unlabeled", 49), 
                       levels = c("Unlabeled", "CD8 T cells"))
   cellTypes[query_res$selected] <- "CD8 T cells"
   PlotStars(flowSOM.res,
             backgroundValues = cellTypes,
             backgroundColors = c("#FFFFFF00", "#ca0020aa"))
   
}
\seealso{
\code{\link{PlotStars}}, \code{\link{PlotVariable}},
\code{\link{PlotFlowSOM}}, \code{\link{PlotLabels}}, 
\code{\link{PlotNumbers}}, \code{\link{PlotMarker}}, 
\code{\link{PlotPies}}, \code{\link{PlotSD}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{GetClusterCVs}
\alias{GetClusterCVs}
\title{Get CV values for all clusters}
\usage{
GetClusterCVs(fsom)
}
\arguments{
\item{fsom}{FlowSOM object as generated by the FlowSOM function
or the BuildSOM function}
}
\value{
Matrix with coefficient of variation values for each marker

fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
flowSOM.res <- FlowSOM(fileName, compensate = TRUE, transform = TRUE,
                      scale = TRUE, colsToUse = c(9, 12, 14:18), nClus = 10)
cvs <- GetClusterCVs(flowSOM.res)
}
\description{
Get CV values for all clusters
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{ParseLayout}
\alias{ParseLayout}
\title{ParseLayout}
\usage{
ParseLayout(fsom, layout)
}
\arguments{
\item{fsom}{FlowSOM object}

\item{layout}{"MST", "grid" or a matrix/dataframe with 2 columns and 1 row
per cluster}
}
\value{
dataframe with 2 columns and 1 row per cluster
}
\description{
ParseLayout
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6_deprecated.R
\name{PlotGroups}
\alias{PlotGroups}
\title{PlotGroups}
\usage{
PlotGroups(fsom, groups, threshold = NULL, pThreshold = 0.05, ...)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{BuildMST}}}

\item{groups}{Groups result as generated by \code{\link{CountGroups}}}

\item{threshold}{Relative difference in groups before the node is 
coloured}

\item{pThreshold}{Threshold on p-value from wilcox-test before the 
node is coloured. If this is not NULL, threshold will 
be ignored.}

\item{...}{Additional arguments to pass to \code{\link{PlotFlowSOM}}}
}
\value{
A vector containing the labels assigned to the nodes for
        all groups except the first
}
\description{
Plot differences between groups
}
\details{
Plot FlowSOM trees, where each node is represented by 
a star chart indicating mean marker values, the size of the node is relative
to the mean percentage of cells present in each
}
\examples{
#Run FlowSOM
fileName <-  system.file("extdata", "68983.fcs", package="FlowSOM")
fsom <- FlowSOM(fileName, compensate = TRUE, transform = TRUE,
                      scale = TRUE, colsToUse = c(9,12,14:18), nClus = 10)

ff <- flowCore::read.FCS(fileName)
# Make an additional file without cluster 7 and double amount of cluster 5
selection <- c(which(GetClusters(fsom) \%in\% which(fsom$metaclustering != 7)),
                 which(GetClusters(fsom) \%in\% which(fsom$metaclustering == 5)))
ff_tmp <- ff[selection,]
flowCore::write.FCS(ff_tmp, file="ff_tmp.fcs")

# Compare only the file with the double amount of cluster 10
features <- GetFeatures(fsom, 
                        c(fileName, "ff_tmp.fcs"),
                        level = "clusters",
                        type = "percentages")
stats <- GroupStats(features$cluster_percentages,                     
                    groups = list("AllCells" = c(fileName),
                                  "Without_ydTcells" = c("ff_tmp.fcs")))

fold_changes <- stats["fold changes", ]
fold_changes_label <- factor(ifelse(fold_changes < -1.5, 
                           "Underrepresented compared to Group 1",
                           ifelse(fold_changes > 1.5, 
                                  "Overrepresented compared to Group 1",
                                  "--")), 
                            levels = c("--", 
                               "Underrepresented compared to Group 1",
                               "Overrepresented compared to Group 1"))
fold_changes_label[is.na(fold_changes_label)] <- "--"                                   
gr_1 <- PlotStars(fsom, 
                  title = "All Cells", 
                  nodeSizes = stats["medians AllCells", ], 
                  list_insteadof_ggarrange = TRUE)
gr_2 <- PlotStars(fsom, title = "Group 2", 
               nodeSizes = stats["medians Without_ydTcells", ], 
                backgroundValues = fold_changes_label,
               backgroundColors = c("white", "red", "blue"), 
               list_insteadof_ggarrange = TRUE)
p <- ggpubr::ggarrange(plotlist = c(list(gr_1$tree), gr_2),
                    heights = c(3, 1))
p                   
         
}
\seealso{
\code{\link{PlotStars}},\code{\link{PlotVariable}},
\code{\link{PlotFlowSOM}},\code{\link{PlotLabels}},\code{\link{PlotNumbers}},
\code{\link{PlotMarker}},\code{\link{PlotPies}},\code{\link{QueryStarPlot}},
\code{\link{PlotSD}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{Purity}
\alias{Purity}
\title{Calculate mean weighted cluster purity}
\usage{
Purity(realClusters, predictedClusters, weighted = TRUE)
}
\arguments{
\item{realClusters}{array with real cluster values}

\item{predictedClusters}{array with predicted cluster values}

\item{weighted}{logical. Should the mean be weighted
depending on the number of poins in the predicted 
clusters}
}
\value{
Mean purity score, worst score, number of clusters with score < 0.75
}
\description{
Calculate mean weighted cluster purity
}
\examples{
# Generate some random data as an example
realClusters <- sample(1:5, 100, replace = TRUE)
predictedClusters <- sample(1:6, 100, replace = TRUE)

# Calculate the FMeasure
Purity(realClusters, predictedClusters)
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{GetMetaclusters}
\alias{GetMetaclusters}
\title{Get metacluster label for all individual cells}
\usage{
GetMetaclusters(fsom, meta = NULL)
}
\arguments{
\item{fsom}{FlowSOM object as generated by the FlowSOM function
or the BuildSOM function}

\item{meta}{Metacluster label for each FlowSOM cluster. If this
is NULL, the fsom argument should be as generated by
the FlowSOM function, and fsom$metaclustering will
be used.}
}
\value{
vector label for every cell
}
\description{
Get metacluster label for all individual cells
}
\examples{
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
flowSOM.res <- FlowSOM(fileName, compensate = TRUE, transform = TRUE,
                      scale = TRUE, colsToUse = c(9, 12, 14:18), nClus = 10)
metacluster_labels <- GetMetaclusters(flowSOM.res)
metacluster_labels <- GetMetaclusters(flowSOM.res,
                                      meta = flowSOM.res$metaclustering)

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{QueryMultiple}
\alias{QueryMultiple}
\title{QueryMultiple}
\usage{
QueryMultiple(fsom, cellTypes, plotFile = "queryMultiple.pdf", ...)
}
\arguments{
\item{fsom}{FlowSOM object}

\item{cellTypes}{Description of the cell types. Named list, with one named
vector per cell type containing "high"/"low" values}

\item{plotFile}{Path to a pdf file to save the plots (default is 
queryMultiple.pdf). If \code{NULL}, no plots will be 
generated}

\item{...}{Additional arguments to pass to \code{\link{QueryStarPlot}}}
}
\value{
A label for every FlowSOM cluster (Unknown or one of the celltype
        names of the list, if selected by QueryStarPlot)
}
\description{
Function which takes a named list of multiple cell types, where every item is
a named vector with values "high"/"low" and the names correspond to the
markers or channels (e.g. as generated by parse_markertable).
}
\examples{
   file <- system.file("extdata", "68983.fcs", package = "FlowSOM")
   ff <- flowCore::read.FCS(file)
   # Use the wrapper function to build a flowSOM object (saved in flowSOM.res)
   # and a metaclustering (saved in flowSOM.res[["metaclustering"]])
   flowSOM.res <- FlowSOM(ff, compensate = TRUE, transform = TRUE, scale = TRUE,
                  colsToUse = c(9, 12, 14:18), nClus = 10, silent = FALSE,
                  xdim = 7, ydim = 7)
   cellTypes <- list("CD8 T cells" = c("PE-Cy7-A" = "high",
                                        "APC-Cy7-A" = "high",
                                        "Pacific Blue-A" = "high"),
                       "B cells" = c("PE-Cy5-A" = "high"),
                       "NK cells" = c("PE-A" = "high",
                                      "PE-Cy7-A" = "low",
                                      "APC-Cy7-A" = "low"))
   query_res <- QueryMultiple(flowSOM.res, cellTypes, "query_multiple.pdf")
   
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{AddNodes}
\alias{AddNodes}
\title{AddNodes}
\usage{
AddNodes(
  p,
  nodeInfo = NULL,
  values = NULL,
  lim = NULL,
  colorPalette = NULL,
  fillColor = "white",
  showLegend = TRUE,
  label = "",
  ...
)
}
\arguments{
\item{p}{GGplot object}

\item{nodeInfo}{Dataframe with for every node an x, y and size value,
if null the dataframe from the ggplot object will be 
reused.}

\item{values}{Values used for coloring the nodes. Default = NULL,
in which case all nodes are filled in fillColor.}

\item{lim}{The limits of the color scale, not used if values = NULL.}

\item{colorPalette}{Colorpalette for color in nodes, not used if values = 
NULL. A vector of colors or a color function.}

\item{fillColor}{Fixed fill for node colors, default = white.}

\item{showLegend}{Boolean, default = TRUE.}

\item{label}{Title for the legend.}

\item{...}{Additional arguments to pass to geom_circle}
}
\value{
Returns nothing, but plots the nodes
}
\description{
Function plots the nodes
}
\seealso{
\code{\link{PlotFlowSOM}}, \code{\link{PlotMarker}},
\code{\link{PlotVariable}}, \code{\link{AddLabels}}, 
\code{\link{AddBackground}}, \code{\link{AddPies}}, 
\code{\link{AddStars}}, \code{\link{AddStarsPies}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6_deprecated.R
\name{GetMFIs}
\alias{GetMFIs}
\title{Get MFI values for all clusters}
\usage{
GetMFIs(fsom, colsUsed = FALSE, prettyColnames = FALSE)
}
\arguments{
\item{fsom}{FlowSOM object as generated by the FlowSOM function
or the BuildSOM function}

\item{colsUsed}{logical. Should report only the columns used to 
build the SOM. Default = FALSE.}

\item{prettyColnames}{logical. Should report pretty column names instead
of standard column names. Default = FALSE.}
}
\value{
Matrix with median values for each marker
}
\description{
Get MFI values for all clusters
}
\examples{
fileName <- system.file("extdata", "68983.fcs", package="FlowSOM")
flowSOM.res <- FlowSOM(fileName, compensate=TRUE,transform=TRUE,
                      scale=TRUE,colsToUse=c(9,12,14:18),nClus=10)
mfis <- GetClusterMFIs(flowSOM.res)
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/3_buildMST.R
\name{BuildMST}
\alias{BuildMST}
\title{BuildMST}
\usage{
BuildMST(fsom, silent = FALSE, tSNE = FALSE)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{BuildSOM}}}

\item{silent}{If \code{TRUE}, no progress updates will be printed}

\item{tSNE}{If \code{TRUE}, an alternative tSNE layout is computed as well}
}
\value{
FlowSOM object containing MST description
}
\description{
Build Minimal Spanning Tree
}
\details{
Add minimal spanning tree description to the FlowSOM object
}
\examples{
# Read from file, build self-organizing map
fileName <- system.file("extdata", "68983.fcs", package="FlowSOM")
flowSOM.res <- ReadInput(fileName, compensate=TRUE, transform = TRUE,
                         scale = TRUE)
flowSOM.res <- BuildSOM(flowSOM.res, colsToUse = c(9, 12, 14:18))

# Build the Minimal Spanning Tree
flowSOM.res <- BuildMST(flowSOM.res)

}
\seealso{
\code{\link{BuildSOM}}, \code{\link{PlotStars}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{AddLabels}
\alias{AddLabels}
\title{AddLabels}
\usage{
AddLabels(
  p,
  labels,
  hjust = 0.5,
  layout = NULL,
  textSize = 3.88,
  textColor = "black",
  ...
)
}
\arguments{
\item{p}{ggplot object}

\item{labels}{Labels to be added to each node}

\item{hjust}{Horizontal adjust for labels. Default is centered.}

\item{layout}{Dataframe with x and y columns. If null, the dataframe from
the ggplot object will be reused.}

\item{textSize}{Size for geom_text. Default (=3.88) is from geom_text.}

\item{textColor}{Color for geom_text. Default = black.}

\item{...}{Additional parameters to pass to geom_text}
}
\value{
Returns the ggplot object with labels added
}
\description{
AddLabels
}
\seealso{
\code{\link{PlotLabels}}, \code{\link{PlotNumbers}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6_deprecated.R
\name{query_multiple}
\alias{query_multiple}
\title{query_multiple}
\usage{
query_multiple(fsom, cell_types, pdf_name = "query_multiple.pdf", ...)
}
\arguments{
\item{fsom}{FlowSOM object}

\item{cell_types}{Description of the cell types. Named list, with one named
vector per cell type containing "high"/"low" values}

\item{pdf_name}{Path to a pdf file to save figures}

\item{...}{Additional arguments to pass to \code{\link{QueryStarPlot}}}
}
\value{
A label for every FlowSOM cluster (Unknown or one of the celltype
        names of the list, if selected by QueryStarPlot)
}
\description{
Function which takes a named list of multiple cell types, where every item is
a named vector with values "high"/"low" and the names correspond to the
markers or channels (e.g. as generated by parse_markertable).
}
\examples{
   file <- system.file("extdata", "68983.fcs", package="FlowSOM")
   ff <- flowCore::read.FCS(file)
   # Use the wrapper function to build a flowSOM object (saved in flowSOM.res)
   # and a metaclustering (saved in flowSOM.res[["metaclustering"]])
   flowSOM.res <- FlowSOM(ff,compensate = TRUE, transform = TRUE,scale = TRUE,
                  colsToUse = c(9,12,14:18), nClus = 10, silent = FALSE,
                  xdim=7, ydim=7)
   cell_types <- list("CD8 T cells" = c("PE-Cy7-A" = "high",
                                        "APC-Cy7-A" = "high",
                                        "Pacific Blue-A" = "high"),
                       "B cells" = c("PE-Cy5-A" = "high"),
                       "NK cells" = c("PE-A" = "high",
                                      "PE-Cy7-A" = "low",
                                      "APC-Cy7-A" = "low"))
   query_res <- QueryMultiple(flowSOM.res, cell_types, "query_multiple.pdf")
   
}
\seealso{
\code{\link{QueryStarPlot}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/0_FlowSOM.R
\name{FlowSOM}
\alias{FlowSOM}
\title{Run the FlowSOM algorithm}
\usage{
FlowSOM(
  input,
  pattern = ".fcs",
  compensate = FALSE,
  spillover = NULL,
  transform = FALSE,
  toTransform = NULL,
  transformFunction = flowCore::logicleTransform(),
  transformList = NULL,
  scale = FALSE,
  scaled.center = TRUE,
  scaled.scale = TRUE,
  silent = TRUE,
  colsToUse = NULL,
  nClus = 10,
  maxMeta = NULL,
  importance = NULL,
  seed = NULL,
  ...
)
}
\arguments{
\item{input}{a flowFrame, a flowSet or an array of paths to files or 
directories}

\item{pattern}{if input is an array of file- or directorynames, select 
only files containing pattern}

\item{compensate}{logical, does the data need to be compensated}

\item{spillover}{spillover matrix to compensate with
If NULL and compensate = TRUE, we will look for $SPILL 
description in fcs file.}

\item{transform}{logical, does the data need to be transformed with the
transformation given in \code{transformFunction}.}

\item{toTransform}{column names or indices that need to be transformed.
Will be ignored if \code{transformList} is given.
If \code{NULL} and transform = \code{TRUE}, column names
of \code{$SPILL} description in fcs file will be used.}

\item{transformFunction}{Defaults to logicleTransform()}

\item{transformList}{transformList to apply on the samples.}

\item{scale}{logical, does the data needs to be rescaled. 
Default = FALSE}

\item{scaled.center}{see \code{\link{scale}}}

\item{scaled.scale}{see \code{\link{scale}}}

\item{silent}{if \code{TRUE}, no progress updates will be printed}

\item{colsToUse}{Markers, channels or indices to use for building the SOM. 
Default (NULL) is all the columns used to build the 
FlowSOM object.}

\item{nClus}{Exact number of clusters for meta-clustering. 
Ignored if maxMeta is specified.
Default = 10.}

\item{maxMeta}{Maximum number of clusters to try out for 
meta-clustering. If \code{NULL} (default), only one 
option will be computed (\code{nClus}).}

\item{importance}{array with numeric values. Parameters will be scaled 
according to importance}

\item{seed}{Set a seed for reproducible results}

\item{...}{options to pass on to the SOM function 
(xdim, ydim, rlen, mst, alpha, radius, init, distf)}
}
\value{
A \code{list} with two items: the first is the flowSOM object 
        containing all information (see the vignette for more detailed 
        information about this object), the second is the metaclustering of 
        the nodes of the grid. This is a wrapper function for 
        \code{\link{ReadInput}}, \code{\link{BuildSOM}}, 
        \code{\link{BuildMST}} and \code{\link{MetaClustering}}. 
        Executing them separately may provide more options.
}
\description{
Method to run general FlowSOM workflow. 
Will scale the data and uses consensus meta-clustering by default.
}
\examples{
# Read from file
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
flowSOM.res <- FlowSOM(fileName, compensate = TRUE, transform = TRUE,
                      scale = TRUE, colsToUse = c(9, 12, 14:18), nClus = 10)
# Or read from flowFrame object
ff <- flowCore::read.FCS(fileName)
ff <- flowCore::compensate(ff, flowCore::keyword(ff)[["SPILL"]])
ff <- flowCore::transform(ff,
         flowCore::transformList(colnames(flowCore::keyword(ff)[["SPILL"]]),
                                flowCore::logicleTransform()))
flowSOM.res <- FlowSOM(ff, 
                       scale = TRUE, 
                       colsToUse = c(9, 12, 14:18), 
                       nClus = 10)

# Plot results
PlotStars(flowSOM.res,
          backgroundValues = flowSOM.res$metaclustering)

# Get metaclustering per cell
flowSOM.clustering <- GetMetaclusters(flowSOM.res)



}
\seealso{
\code{\link{scale}}, 
         \code{\link{ReadInput}}, 
         \code{\link{BuildSOM}},
         \code{\link{BuildMST}}, 
         \code{\link{MetaClustering}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{FlowSOM_colors}
\alias{FlowSOM_colors}
\title{FlowSOM default colors}
\usage{
FlowSOM_colors(n)
}
\arguments{
\item{n}{Number of colors to generate}
}
\value{
array of n colors
}
\description{
FlowSOM default colors
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{PlotSD}
\alias{PlotSD}
\title{PlotSD}
\usage{
PlotSD(fsom, marker = NULL, ...)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{FlowSOM}}}

\item{marker}{If a marker/channel is given, the sd for this marker is 
shown. Otherwise, the maximum ratio is used.}

\item{...}{Additional arguments to pass to \code{\link{PlotFlowSOM}}}
}
\value{
Nothing is returned. A plot is drawn in which each node 
        is coloured depending on its standard deviation
}
\description{
Plot FlowSOM grid or tree, coloured by standard deviaton.
}
\examples{
# Read from file, build self-organizing map and minimal spanning tree
fileName <- system.file("extdata", "68983.fcs", package  = "FlowSOM")
flowSOM.res <- ReadInput(fileName, compensate  = TRUE, transform  = TRUE,
                         scale  = TRUE)
flowSOM.res <- BuildSOM(flowSOM.res, colsToUse  = c(9, 12, 14:18))
flowSOM.res <- BuildMST(flowSOM.res)

PlotSD(flowSOM.res)

}
\seealso{
\code{\link{PlotStars}}, \code{\link{PlotVariable}},
\code{\link{PlotFlowSOM}}, \code{\link{PlotLabels}}, 
\code{\link{PlotNumbers}}, \code{\link{PlotMarker}}, 
\code{\link{PlotPies}}, \code{\link{QueryStarPlot}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{Initialize_KWSP}
\alias{Initialize_KWSP}
\title{Select k well spread points from X}
\usage{
Initialize_KWSP(X, xdim, ydim)
}
\arguments{
\item{X}{matrix in which each row represents a point}

\item{xdim}{x dimension of the grid}

\item{ydim}{y dimension of the grid}
}
\value{
array containing the selected selected rows
}
\description{
Select k well spread points from X
}
\examples{

points <- matrix(1:1000, ncol = 10)
selection <- Initialize_KWSP(points, 3, 3)

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{ParseEdges}
\alias{ParseEdges}
\title{ParseEdges}
\usage{
ParseEdges(fsom)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{FlowSOM}}}
}
\value{
A dataframe consisting of start and end coordinates of edges
}
\description{
Parses edges
}
\details{
Function that parses the graph edges of the FlowSOM object into a dataframe
}
\seealso{
\code{\link{PlotFlowSOM}}, \code{\link{ParseNodeSize}},
\code{\link{ParseArcs}}, \code{\link{ParseQuery}},
\code{\link{ParseSD}}, \code{\link{AddMST}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6_deprecated.R
\name{MetaclusterMFIs}
\alias{MetaclusterMFIs}
\title{MetaclusterMFIs}
\usage{
MetaclusterMFIs(fsom)
}
\arguments{
\item{fsom}{Result of calling the FlowSOM function}
}
\value{
Metacluster MFIs
}
\description{
Compute the median fluorescence intensities for the metaclusters
}
\examples{
fileName <- system.file("extdata", "68983.fcs", package="FlowSOM")
ff <- flowCore::read.FCS(fileName)
ff <- flowCore::compensate(ff,ff@description$SPILL)
ff <- flowCore::transform(ff,
         flowCore::transformList(colnames(ff@description$SPILL),
                                flowCore::logicleTransform()))
flowSOM.res <- FlowSOM(ff,scale=TRUE,colsToUse=c(9,12,14:18),maxMeta=10)
mfis <- GetMetaclusterMFIs(flowSOM.res)
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{AddAnnotation}
\alias{AddAnnotation}
\title{AddAnnotation}
\usage{
AddAnnotation(
  p,
  fsom,
  layout = fsom$MST$l,
  cl = NULL,
  mcl = NULL,
  clCustomLabels = NULL,
  mclCustomLabels = NULL,
  hjust = 0.5,
  ...
)
}
\arguments{
\item{p}{Plot to add annotation to. When using type = "stars", please 
use plot = FALSE in \code{\link{PlotFlowSOM}}.}

\item{fsom}{FlowSOM object that goes with the plot}

\item{layout}{Layout to use. Default fsom$MST$l}

\item{cl}{Clusters to annotate. If cl = "all", all clusters will be 
annotated}

\item{mcl}{Metaclusters to annotate. If mcl = "all", all metaclusters 
will be annotated}

\item{clCustomLabels}{Cluster labels to use for annotation}

\item{mclCustomLabels}{Metacluster labels to use for annotation}

\item{hjust}{Label adjustment. Default = 0.5}

\item{...}{Arguments passed to geom_text_repel}
}
\value{
The updated plot
}
\description{
Add annotation to a FlowSOM plot
}
\examples{

#' # Identify the files
fcs <- flowCore::read.FCS(system.file("extdata", "68983.fcs", 
                                      package = "FlowSOM"))
# Build a FlowSOM object
flowSOM.res <- FlowSOM(fcs, 
                       scale = TRUE,
                       compensate = TRUE, 
                       transform = TRUE,
                       toTransform = 8:18, 
                       colsToUse = c(9, 12, 14:18),
                       nClus = 10,
                       seed = 1)
                       
p <- PlotStars(flowSOM.res, backgroundValues = flowSOM.res$metaclustering,
               list_insteadof_ggarrange = TRUE)
AddAnnotation(p, flowSOM.res, cl = c(1, 2), mcl = c(3, 4))

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{ParseSD}
\alias{ParseSD}
\title{ParseSD 
 
Parses SD in FlowSOM object}
\usage{
ParseSD(fsom, marker = NULL)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{FlowSOM}}}

\item{marker}{If a marker is given, the sd for this marker is shown.
Otherwise, the maximum ratio is used.}
}
\value{
A vector containing the SDs
}
\description{
Calculates the  standard deviaton of a FlowSOM object
}
\seealso{
\code{\link{PlotFlowSOM}}, \code{\link{ParseEdges}}, 
\code{\link{ParseNodeSize}}, \code{\link{ParseArcs}},
\code{\link{ParseQuery}}, \code{\link{PlotSD}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6_deprecated.R
\name{PlotNode}
\alias{PlotNode}
\title{PlotNode
Plot star chart}
\usage{
PlotNode(
  fsom,
  id,
  markers = fsom$map$colsUsed,
  colorPalette = grDevices::colorRampPalette(c("#00007F", "blue", "#007FFF", "cyan",
    "#7FFF7F", "yellow", "#FF7F00", "red", "#7F0000")),
  main = paste0("Cluster ", id)
)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{BuildMST}} or
the first element of the list returned by 
\code{\link{FlowSOM}}}

\item{id}{Id of the node to plot (check PlotNumbers to get the ids)}

\item{markers}{Array of markers to use. Default: the markers used to build 
the tree}

\item{colorPalette}{Colorpalette to be used for the markers}

\item{main}{Title of the plot}
}
\value{
Nothing is returned. A plot is drawn in which the node is 
represented by a star chart indicating the median fluorescence intensities.
}
\description{
Plot a star chart indicating median marker values of a single node
}
\examples{
   # Read from file, build self-organizing map and minimal spanning tree
   fileName <- system.file("extdata", "68983.fcs", package="FlowSOM")
   flowSOM.res <- FlowSOM(fileName, compensate=TRUE,transform=TRUE,
                            scale=TRUE,colsToUse=c(9,12,14:18),nClus=10)
   
   # Deprecated, it is currently not possible anymore to plot an individual
   # node alone. If necessary, zooming in on a node can be approximated by
   # exagerating the size of the node.
   PlotStars(flowSOM.res, nodeSizes = c(100, rep(0,99)), maxNodeSize = 10)

}
\seealso{
\code{\link{PlotStars}},\code{\link{PlotNumbers}},
 \code{\link{FlowSOM}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/4_metaClustering.R
\name{metaClustering_consensus}
\alias{metaClustering_consensus}
\title{MetaClustering}
\usage{
metaClustering_consensus(data, k = 7, seed = NULL)
}
\arguments{
\item{data}{Matrix containing the data to cluster}

\item{k}{Number of clusters}

\item{seed}{Seed to pass to consensusClusterPlus}
}
\value{
Numeric array indicating cluster for each datapoint
}
\description{
Cluster data using hierarchical consensus clustering with k clusters
}
\examples{
   # Read from file, build self-organizing map and minimal spanning tree
   fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
   flowSOM.res <- ReadInput(fileName, compensate = TRUE,transform = TRUE,
                            scale = TRUE)
   flowSOM.res <- BuildSOM(flowSOM.res,colsToUse = c(9, 12, 14:18))
   flowSOM.res <- BuildMST(flowSOM.res)
   
   # Apply consensus metaclustering
   metacl <- metaClustering_consensus(flowSOM.res$map$codes, k = 10)    

}
\seealso{
\code{\link{MetaClustering}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{GetClusterMFIs}
\alias{GetClusterMFIs}
\title{Get MFI values for all clusters}
\usage{
GetClusterMFIs(fsom, colsUsed = FALSE, prettyColnames = FALSE)
}
\arguments{
\item{fsom}{FlowSOM object as generated by the FlowSOM function
or the BuildSOM function}

\item{colsUsed}{logical. Should report only the columns used to 
build the SOM. Default = FALSE.}

\item{prettyColnames}{logical. Should report pretty column names instead
of standard column names. Default = FALSE.}
}
\value{
Matrix with median values for each marker
}
\description{
Get MFI values for all clusters
}
\examples{
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
flowSOM.res <- FlowSOM(fileName, compensate = TRUE, transform = TRUE,
                      scale = TRUE, colsToUse = c(9, 12, 14:18), nClus = 10)
mfis <- GetClusterMFIs(flowSOM.res)
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{Initialize_PCA}
\alias{Initialize_PCA}
\title{Create a grid from first 2 PCA components}
\usage{
Initialize_PCA(data, xdim, ydim)
}
\arguments{
\item{data}{matrix in which each row represents a point}

\item{xdim}{x dimension of the grid}

\item{ydim}{y dimension of the grid}
}
\value{
array containing the selected selected rows
}
\description{
Create a grid from first 2 PCA components
}
\examples{

points <- matrix(1:1000, ncol = 10)
selection <- Initialize_PCA(points, 3, 3)

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/4_metaClustering.R
\name{GetMetaclusterCVs}
\alias{GetMetaclusterCVs}
\title{GetMetaclusterCVs}
\usage{
GetMetaclusterCVs(fsom)
}
\arguments{
\item{fsom}{Result of calling the FlowSOM function}
}
\value{
Metacluster CVs
}
\description{
Compute the coefficient of variation for the metaclusters
}
\examples{
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
ff <- flowCore::read.FCS(fileName)
ff <- flowCore::compensate(ff, flowCore::keyword(ff)[["SPILL"]])
ff <- flowCore::transform(ff,
         flowCore::transformList(colnames(flowCore::keyword(ff)[["SPILL"]]),
                                flowCore::logicleTransform()))
flowSOM.res <- FlowSOM(ff,
                       scale = TRUE,
                       colsToUse = c(9, 12, 14:18), 
                       nClus = 10)
cvs <- GetMetaclusterCVs(flowSOM.res)
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{GetPercentages}
\alias{GetPercentages}
\title{GetPercentages}
\usage{
GetPercentages(fsom, level = "metaclusters")
}
\arguments{
\item{fsom}{FlowSOM object}

\item{level}{Character string, should be either "clusters" or 
"metaclusters" (default)}
}
\value{
A named vector with the percentages
}
\description{
Get percentages of number of cells in clusters or metaclusters
}
\examples{
# Read from file, build self-organizing map and minimal spanning tree
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
ff <- flowCore::read.FCS(fileName)
ff <- flowCore::compensate(ff, flowCore::keyword(ff)[["SPILL"]])
ff <- flowCore::transform(ff, flowCore::estimateLogicle(ff,
                                               flowCore::colnames(ff)[8:18]))
flowSOM.res <- FlowSOM(ff,
                       scale = TRUE,
                       colsToUse = c(9, 12, 14:18),
                       nClus = 10,
                       seed = 1)
GetPercentages(flowSOM.res)                      
GetPercentages(flowSOM.res, level = "clusters")
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{PlotVariable}
\alias{PlotVariable}
\title{PlotVariable}
\usage{
PlotVariable(
  fsom,
  variable,
  variableName = "",
  colorPalette = FlowSOM_colors,
  lim = NULL,
  ...
)
}
\arguments{
\item{fsom}{FlowSOM object}

\item{variable}{A vector containing a value for every cluster}

\item{variableName}{Label to show on the legend}

\item{colorPalette}{Colorpalette to use. Can be a function or a vector.}

\item{lim}{Limits for the scale}

\item{...}{Additional arguments to pass to \code{\link{PlotFlowSOM}},
e.g. view, backgroundValues, equalNodeSize ...}
}
\description{
Plot a variable for all nodes
}
\details{
Plot FlowSOM grid or tree, coloured by node values given in variable
}
\examples{
# Build FlowSOM model
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
flowSOM.res <- FlowSOM(fileName, 
                       compensate = TRUE, transform = TRUE, scale = FALSE,
                       colsToUse = c(9, 12, 14:18),
                       nClus = 10,
                       seed = 1)
                       
# Plot some random values
rand <- runif(flowSOM.res$map$nNodes)
PlotVariable(flowSOM.res, 
             variable = rand,
             variableName = "Random")
   
}
\seealso{
\code{\link{PlotStars}}, \code{\link{QueryStarPlot}},
\code{\link{PlotFlowSOM}}, \code{\link{PlotLabels}}, 
\code{\link{PlotNumbers}}, \code{\link{PlotMarker}}, 
\code{\link{PlotPies}}, \code{\link{PlotSD}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/0_FlowSOM.R
\name{print.FlowSOM}
\alias{print.FlowSOM}
\title{Print FlowSOM object}
\usage{
\method{print}{FlowSOM}(x, ...)
}
\arguments{
\item{x}{FlowSOM object to print information about}

\item{...}{Further arguments, not used}
}
\description{
Print FlowSOM object
}
\examples{
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
flowSOM.res <- FlowSOM(fileName, compensate = TRUE, transform = TRUE,
                      scale = TRUE, colsToUse = c(9, 12, 14:18), nClus = 10)
print(flowSOM.res)

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/4_metaClustering.R
\name{MetaClustering}
\alias{MetaClustering}
\title{MetaClustering}
\usage{
MetaClustering(data, method, max = 20, seed = NULL, ...)
}
\arguments{
\item{data}{Matrix containing the data to cluster}

\item{method}{Clustering method to use}

\item{max}{Maximum number of clusters to try out}

\item{seed}{Seed to pass on to given clustering method}

\item{...}{Extra parameters to pass along}
}
\value{
Numeric array indicating cluster for each datapoint
}
\description{
Cluster data with automatic number of cluster determination for 
several algorithms
}
\examples{
   # Read from file, build self-organizing map and minimal spanning tree
   fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
   flowSOM.res <- ReadInput(fileName, compensate = TRUE,transform = TRUE,
                            scale = TRUE)
   flowSOM.res <- BuildSOM(flowSOM.res,colsToUse = c(9, 12, 14:18))
   flowSOM.res <- BuildMST(flowSOM.res)
   
   # Apply metaclustering
   metacl <- MetaClustering(flowSOM.res$map$codes,
                            "metaClustering_consensus",
                            max = 10)
   
   # Get metaclustering per cell
   flowSOM.clustering <- metacl[flowSOM.res$map$mapping[, 1]]    

}
\seealso{
\code{\link{metaClustering_consensus}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{GetCounts}
\alias{GetCounts}
\title{GetCounts}
\usage{
GetCounts(fsom, level = "metaclusters")
}
\arguments{
\item{fsom}{FlowSOM object}

\item{level}{Character string, should be either "clusters" or 
"metaclusters" (default)}
}
\value{
A named vector with the counts
}
\description{
Get counts of number of cells in clusters or metaclusters
}
\examples{
# Read from file, build self-organizing map and minimal spanning tree
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
ff <- flowCore::read.FCS(fileName)
ff <- flowCore::compensate(ff, flowCore::keyword(ff)[["SPILL"]])
ff <- flowCore::transform(ff, flowCore::estimateLogicle(ff,
                                               flowCore::colnames(ff)[8:18]))
flowSOM.res <- FlowSOM(ff,
                       scale = TRUE,
                       colsToUse = c(9, 12, 14:18),
                       nClus = 10,
                       seed = 1)
GetCounts(flowSOM.res)                      
GetCounts(flowSOM.res, level = "clusters")
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{PlotFlowSOM}
\alias{PlotFlowSOM}
\title{PlotFlowSOM}
\usage{
PlotFlowSOM(
  fsom,
  view = "MST",
  nodeSizes = fsom$map$pctgs,
  maxNodeSize = 1,
  refNodeSize = max(nodeSizes),
  equalNodeSize = FALSE,
  backgroundValues = NULL,
  backgroundColors = NULL,
  backgroundLim = NULL,
  title = NULL
)
}
\arguments{
\item{fsom}{FlowSOM object, as created by \code{\link{FlowSOM}}}

\item{view}{Preferred view, options: "MST", "grid" or "matrix" 
with a matrix/dataframe consisting of coordinates 
given in coords. Default = "MST"}

\item{nodeSizes}{A vector containing nodesizes. These will 
automatically be scaled between 0 and maxNodeSize 
and transformed with a sqrt. Default = fsom$MST$sizes}

\item{maxNodeSize}{Determines the maximum nodesize. Default is 1.}

\item{refNodeSize}{Reference for nodesize against which the nodeSizes 
will be scaled. Default = max(nodeSizes)}

\item{equalNodeSize}{If \code{TRUE}, the nodes will be equal to 
maxNodeSize. If \code{FALSE} (default), the nodes  
will be scaled to the number of cells in each 
cluster}

\item{backgroundValues}{Values to be used for background coloring, either
numerical values or something that can be made into
a factor (e.g. a clustering)}

\item{backgroundColors}{Colorpalette to be used for the background coloring.
Can be either a function or an array specifying
colors.}

\item{backgroundLim}{Only used when backgroundValues are numerical. 
Defaults to min and max of the backgroundValues.}

\item{title}{Title of the plot}
}
\value{
A ggplot object with the base layer of a FlowSOM plot
}
\description{
Base layer to plot a FlowSOM result
}
\details{
Base layer of the FlowSOM plot, where you can choose layout (MST, grid or 
coordinates of your own choosing), background colors and node size. Can
then be extended by e.g. \code{\link{AddStars}}, \code{\link{AddLabels}},
\code{\link{AddPies}}, ...
}
\examples{
# Locate file on file system
fcs_file <- system.file("extdata", "68983.fcs", package = "FlowSOM")

# Build FlowSOM model
flowSOM.res <- FlowSOM(fcs_file, 
                       scale = TRUE,
                       compensate = TRUE, 
                       transform = TRUE,
                       toTransform = 8:18, 
                       colsToUse = c(9, 12, 14:18),
                       nClus = 10,
                       seed = 1)
                       
# Plot with background coloring
PlotFlowSOM(flowSOM.res,
            backgroundValues = flowSOM.res$metaclustering)

# Own layout
mfis <- GetClusterMFIs(flowSOM.res)[,GetChannels(flowSOM.res, c("CD3", "CD4"))]
PlotFlowSOM(flowSOM.res,
            view = mfis,
            maxNodeSize = 0.1,
            backgroundValues = flowSOM.res$metaclustering)
            
# Adapted node sizes
PlotFlowSOM(flowSOM.res,
              nodeSizes = 1:100,
              view = "grid")

}
\seealso{
\code{\link{PlotStars}}, \code{\link{PlotVariable}},
\code{\link{PlotMarker}}, \code{\link{PlotLabels}}, 
\code{\link{PlotNumbers}}, \code{\link{PlotPies}}, 
\code{\link{QueryStarPlot}}, \code{\link{PlotSD}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/3_buildMST.R
\name{FlowSOMSubset}
\alias{FlowSOMSubset}
\title{FlowSOMSubset}
\usage{
FlowSOMSubset(fsom, ids)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{BuildMST}}}

\item{ids}{Array containing the ids to keep}
}
\value{
FlowSOM object containg updated data and medianvalues, 
   but with the same grid
}
\description{
FlowSOM subset
}
\details{
Take a subset from a FlowSOM object
}
\examples{
   # Read two files (Artificially, as we just split 1 file in 2 subsets)
   fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
   ff1 <- flowCore::read.FCS(fileName)[1:1000, ]
   flowCore::keyword(ff1)[["FIL"]] <- "File1"
   ff2 <- flowCore::read.FCS(fileName)[1001:2000, ]
   flowCore::keyword(ff2)[["FIL"]] <- "File2"
   
   flowSOM.res <- FlowSOM(flowCore::flowSet(c(ff1, ff2)), compensate = TRUE,
                          transform = TRUE, scale = TRUE,
                          colsToUse = c(9, 12, 14:18), maxMeta = 10)
   
   # see $metadata for subsets:
   flowSOM.res$metaData
   
   # Use only the second file, without changing the map
   fSOM2 <- FlowSOMSubset(flowSOM.res,
                          (flowSOM.res$metaData[[2]][1]):
                           (flowSOM.res$metaData[[2]][2]))

}
\seealso{
\code{\link{BuildMST}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/3_buildMST.R
\name{TestOutliers}
\alias{TestOutliers}
\title{TestOutliers}
\usage{
TestOutliers(fsom, madAllowed = 4, fsomReference = NULL, plotFile = NULL)
}
\arguments{
\item{fsom}{FlowSOM object}

\item{madAllowed}{Number of median absolute deviations allowed. Default = 4.}

\item{fsomReference}{FlowSOM object to use as reference. If NULL (default),
the original fsom object is used.}

\item{plotFile}{If \code{NULL} (default), no plot will be created. If a 
filepath is given for a pdf, the plot will be written in the
corresponding file}
}
\value{
A new FlowSOM object
}
\description{
Test if any cells are too far from their cluster centers
}
\details{
For every cluster, the distance from the cells to the cluster centers is
used to label cells which deviate too far as outliers. The threshold is
chosen as the median distance + \code{madAllowed} times the median absolute
deviation of the distances.
}
\examples{
 # Build FlowSom result
 fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
 ff <- flowCore::read.FCS(fileName)
 flowSOM.res <- FlowSOM(ff,
                        compensate = TRUE, transform = TRUE, scale = TRUE,
                        colsToUse = c(9, 12, 14:18),
                        maxMeta = 10)
   
 # Map new data
 outlier_report <- TestOutliers(flowSOM.res)
 
}
\seealso{
\code{\link{FlowSOMSubset}} if you want to get a subset of the
         current data instead of a new dataset
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{ParseArcs}
\alias{ParseArcs}
\title{ParseArcs}
\usage{
ParseArcs(x, y, arcValues, arcHeights)
}
\arguments{
\item{x}{x coordinate of node}

\item{y}{y coordinate of node}

\item{arcValues}{A named vector with the frequency of how the node 
should be divided}

\item{arcHeights}{The heights of the arcs}
}
\value{
A dataframe ready to use with ggplot, consisting of the coordinates 
        of centers, the radius and angles of the star values
}
\description{
Parses stars
}
\details{
Function that parses the FlowSOM object into a dataframe for the star values 
for ggplot
}
\seealso{
\code{\link{PlotFlowSOM}}, \code{\link{ParseEdges}}, 
\code{\link{ParseNodeSize}},
\code{\link{ParseQuery}}, \code{\link{ParseSD}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/3_buildMST.R
\name{NMetaclusters}
\alias{NMetaclusters}
\title{NMetaclusters}
\usage{
NMetaclusters(fsom)
}
\arguments{
\item{fsom}{FlowSOM object}
}
\value{
The number of metaclusters
}
\description{
Extracts the number of metaclusters from a FlowSOM object
}
\examples{
 # Build FlowSom result
 fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
 ff <- flowCore::read.FCS(fileName)
 flowSOM.res <- FlowSOM(ff,
                        compensate = TRUE, transform = TRUE, scale = TRUE,
                        colsToUse = c(9, 12, 14:18),
                        maxMeta = 10)
 NMetaclusters(flowSOM.res)
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{GetFeatures}
\alias{GetFeatures}
\title{GetFeatures}
\usage{
GetFeatures(
  fsom,
  files,
  level = c("clusters", "metaclusters"),
  type = "counts",
  MFI = NULL,
  filenames = NULL,
  silent = FALSE
)
}
\arguments{
\item{fsom}{FlowSOM object as generated by the FlowSOM function
or the BuildSOM function}

\item{files}{Either a vector of fcs files or paths to fcs files}

\item{level}{Level(s) of interest. Default is c("clusters",
"metaclusters"), but can also be only one of them}

\item{type}{Type of features to extract. Default is "counts", 
can be a vector of "counts", "percentages" and/or 
"MFIs"}

\item{MFI}{Vector with channels / markers for which the MFI 
values must be returned when "MFIs" is in \code{type}}

\item{filenames}{An optional vector with filenames that will be used
as rownames in the count matrices. If NULL (default)
either the paths will be used or a numerical vector.}

\item{silent}{Logical. If \code{TRUE}, print progress messages.
Default = \code{FALSE}.}
}
\value{
matrix with features per population - type combination
}
\description{
Map fcs files on an existing FlowSOM object
}
\examples{
 # Build FlowSom result
 fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
 ff <- flowCore::read.FCS(fileName)
 ff <- flowCore::compensate(ff, flowCore::keyword(ff)[["SPILL"]])
 ff <- flowCore::transform(ff,
         flowCore::transformList(colnames(flowCore::keyword(ff)[["SPILL"]]),
                                flowCore::logicleTransform()))
 flowSOM.res <- FlowSOM(ff[1:1000, ], 
                        scale = TRUE, 
                        colsToUse = c(9, 12, 14:18),
                        nClus = 10)
   
 # Map new data
 counts <- GetFeatures(fsom = flowSOM.res, 
                       level = "clusters",
                       files = c(ff[1001:2000, ], ff[2001:3000, ]))
 features <- GetFeatures(fsom = flowSOM.res, 
                         files = c(ff[1001:2000, ], ff[2001:3000, ]),
                         type = c("counts", "percentages", "MFIs"), 
                         MFI = "APC-A", 
                         filenames = c("ff_1001-2000", "ff_2001-3000"))

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/1_readInput.R
\name{AddFlowFrame}
\alias{AddFlowFrame}
\title{Add a flowFrame to the data variable of the FlowSOM object}
\usage{
AddFlowFrame(fsom, flowFrame)
}
\arguments{
\item{fsom}{FlowSOM object, as constructed by the ReadInput function}

\item{flowFrame}{flowFrame to add to the FlowSOM object}
}
\value{
FlowSOM object with data added
}
\description{
Add a flowFrame to the data variable of the FlowSOM object
}
\seealso{
\code{\link{ReadInput}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{ParseNodeSize}
\alias{ParseNodeSize}
\title{ParseNodeSize}
\usage{
ParseNodeSize(nodeSizes, maxNodeSize, refNodeSize)
}
\arguments{
\item{nodeSizes}{A vector with nodesizes}

\item{maxNodeSize}{Determines the maximum nodesize.}

\item{refNodeSize}{Reference for nodesize against which the nodeSizes 
will be scaled. Default = max(nodeSizes)}
}
\value{
A vector is returned consisting of node sizes
}
\description{
Parses node size
}
\details{
Function that parses the mapping of the FlowSOM object into node sizes 
relative to the abundances of cells per cluster

Scales node size relative to the abundances of cells per cluster
}
\seealso{
\code{\link{PlotFlowSOM}}, \code{\link{ParseEdges}}, 
\code{\link{AutoMaxNodeSize}}, \code{\link{ParseArcs}},
\code{\link{ParseQuery}}, \code{\link{ParseSD}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{PlotStars}
\alias{PlotStars}
\title{PlotStars}
\usage{
PlotStars(
  fsom,
  markers = fsom$map$colsUsed,
  colorPalette = FlowSOM_colors,
  list_insteadof_ggarrange = FALSE,
  ...
)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{BuildMST}}}

\item{markers}{Markers to plot (will be parsed by GetChannels)}

\item{colorPalette}{ColorPalette to use}

\item{list_insteadof_ggarrange}{If FALSE (default), the plot and the legend
are combined by ggarrange. If TRUE, the
seperate elements are returned in a list,
to allow further customization.}

\item{...}{Additional arguments to pass to \code{\link{PlotFlowSOM}}}
}
\value{
Nothing is returned. A plot is drawn in which each node is 
represented by a star chart indicating the median fluorescence intensities.
Resets the layout back to 1 plot at the end.
}
\description{
Plot star charts
}
\details{
Plot FlowSOM grid or tree, where each node is represented by 
a star chart indicating median marker values
}
\examples{
# Read from file, build self-organizing map and minimal spanning tree
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
flowSOM.res <- FlowSOM(fileName, compensate = TRUE, transform = TRUE,
                       scale = TRUE, colsToUse = c(9, 12, 14:18))

# Plot stars indicating the MFI of the cells present in the nodes
PlotStars(flowSOM.res)

}
\seealso{
\code{\link{PlotMarker}}, \code{\link{PlotVariable}},
\code{\link{PlotFlowSOM}}, \code{\link{PlotLabels}}, 
\code{\link{PlotNumbers}}, \code{\link{PlotPies}}, 
\code{\link{QueryStarPlot}}, \code{\link{PlotSD}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/3_buildMST.R
\name{NClusters}
\alias{NClusters}
\title{NClusters}
\usage{
NClusters(fsom)
}
\arguments{
\item{fsom}{FlowSOM object}
}
\value{
The number of clusters
}
\description{
Extracts the number of clusters from a FlowSOM object
}
\examples{
 # Build FlowSom result
 fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
 ff <- flowCore::read.FCS(fileName)
 flowSOM.res <- FlowSOM(ff,
                        compensate = TRUE, transform = TRUE, scale = TRUE,
                        colsToUse = c(9, 12, 14:18),
                        maxMeta = 10)
 NClusters(flowSOM.res)

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/4_metaClustering.R
\name{UpdateMetaclusters}
\alias{UpdateMetaclusters}
\title{UpdateMetaclusters}
\usage{
UpdateMetaclusters(
  fsom,
  newLabels = NULL,
  clusterAssignment = NULL,
  levelOrder = NULL
)
}
\arguments{
\item{fsom}{Result of calling the FlowSOM function.}

\item{newLabels}{Optional. Named vector, with the names the original 
metacluster names and the values the replacement. Can be 
used to rename or merge metaclusters.}

\item{clusterAssignment}{Optional. Either a named vector, with the names 
the cluster numbers (characters) or a vector of 
length NClusters(fsom). Can be used to assign 
clusters to existing or new metaclusters.}

\item{levelOrder}{Optional. Vector showing the preferred order of the fsom 
metacluster levels.}
}
\value{
Updated FlowSOM object
}
\description{
Adapt the metacluster levels. Can be used to rename the metaclusters, split 
or merge existing metaclusters, add a metaclustering and/or reorder the levels 
of the metaclustering.
}
\examples{
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
ff <- flowCore::read.FCS(fileName)
ff <- flowCore::compensate(ff, flowCore::keyword(ff)[["SPILL"]])
ff <- flowCore::transform(ff,
         flowCore::transformList(colnames(flowCore::keyword(ff)[["SPILL"]]),
                                flowCore::logicleTransform()))
flowSOM.res <- FlowSOM(ff,
                       scale = TRUE,
                       colsToUse = c(9, 12, 14:18), 
                       nClus = 10,
                       seed = 1)
                       
PlotStars(flowSOM.res, backgroundValues = flowSOM.res$metaclustering)
GetCounts(flowSOM.res)

# Merge MC8 and MC9
flowSOM.res <- UpdateMetaclusters(flowSOM.res, newLabels = c("8" = "8+9",
                                                             "9" = "8+9")) 
PlotStars(flowSOM.res, backgroundValues = flowSOM.res$metaclustering)
GetCounts(flowSOM.res)

# Split cluster 24 from metacluster 2 and order the metacluster levels
flowSOM.res <- UpdateMetaclusters(flowSOM.res, 
                                  clusterAssignment = c("24" = "debris?"),
                                  levelOrder = c("debris?", as.character(c(1:7)),
                                                  "8+9", "10"))
PlotStars(flowSOM.res, backgroundValues = flowSOM.res$metaclustering)
PlotNumbers(flowSOM.res, level = "metaclusters")

GetCounts(flowSOM.res)

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{PlotDimRed}
\alias{PlotDimRed}
\title{PlotDimRed}
\usage{
PlotDimRed(
  fsom,
  colsToUse = fsom$map$colsUsed,
  colorBy = "metaclusters",
  cTotal = NULL,
  dimred = Rtsne::Rtsne,
  extractLayout = function(dimred) {     dimred$Y },
  label = TRUE,
  returnLayout = FALSE,
  seed = NULL,
  title = NULL,
  ...
)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{BuildMST}}}

\item{colsToUse}{The columns used for the dimensionality reduction. 
Default = fsom$map$colsUsed.}

\item{colorBy}{Defines how the dimensionality reduction will be 
colored. Can be "metaclusters" (default), "clusters"
or a marker/channel/index.}

\item{cTotal}{The total amount of cells to be used in the 
dimensionality reduction. Default is all the cells.}

\item{dimred}{A dimensionality reduction function. 
Default = Rtsne::Rtsne. Alternatively, a data.frame or
matrix with either equal number of rows to the
fsom or an OriginalID column. Recommended to put
cTotal to NULL when providing a matrix (or ensuring
that the dimred corresponds to subsampling the
flowSOM data for cTotal cells with the same seed).}

\item{extractLayout}{A function to extract the coordinates from the results
of the dimred default = function(dimred){dimred$Y}.}

\item{label}{If label = TRUE (default), labels are added to plot.}

\item{returnLayout}{If TRUE, this function returns a dataframe with 
the layout of dimred and the original IDs and the 
plot. Default = FALSE.}

\item{seed}{A seed for reproducibility.}

\item{title}{A title for the plot.}

\item{...}{Additional arguments to pass to dimred.}
}
\value{
A dimensionality reduction plot made in ggplot2
}
\description{
Plot a dimensionality reduction
}
\details{
Plot a dimensionality reduction of fsom$data
}
\examples{
   file <- system.file("extdata", "68983.fcs", package="FlowSOM")
   flowSOM.res <- FlowSOM(file, compensate = TRUE, transform = TRUE, 
                  scale = TRUE,
                  colsToUse = c(9, 12, 14:18), nClus = 10, silent = FALSE,
                  xdim = 7, ydim = 7)
   PlotDimRed(flowSOM.res, cTotal = 5000, seed = 1, title = "t-SNE")
   PlotDimRed(flowSOM.res, cTotal = 5000, colorBy = "CD3", seed = 1, 
              title = "t-SNE")
   
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6_deprecated.R
\name{PlotClusters2D}
\alias{PlotClusters2D}
\title{PlotClusters2D}
\usage{
PlotClusters2D(
  fsom,
  marker1,
  marker2,
  nodes,
  col = "#FF0000",
  maxBgPoints = 10000,
  pchBackground = ".",
  pchCluster = ".",
  main = "",
  xlab = fsom$prettyColnames[marker1],
  ylab = fsom$prettyColnames[marker2],
  xlim = c(min(fsom$data[, marker1]), max(fsom$data[, marker1])),
  ylim = c(min(fsom$data[, marker2]), max(fsom$data[, marker2])),
  ...
)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{BuildMST}}}

\item{marker1}{Marker to plot on the x-axis}

\item{marker2}{Marker to plot on the y-axis}

\item{nodes}{Nodes of which the cells should be plotted in red}

\item{col}{Colors for all the cells in the selected nodes (ordered array)}

\item{maxBgPoints}{Maximum number of background points to plot}

\item{pchBackground}{Character to use for background cells}

\item{pchCluster}{Character to use for cells in cluster}

\item{main}{Title of the plot}

\item{xlab}{Label for the x axis}

\item{ylab}{Label for the y axis}

\item{xlim}{Limits for the x axis}

\item{ylim}{Limits for the y axis}

\item{...}{Other parameters to pass on to plot}
}
\value{
Nothing is returned. A plot is drawn in which all cells are plotted
        in black and the cells of the selected nodes in red.
}
\description{
Plot nodes on scatter plot
}
\details{
Plot a 2D scatter plot. All cells of fsom$data are plotted in
black, and those of the selected nodes are plotted in red.
The nodes in the grid are indexed starting from the left bottom,
first going right, then up. E.g. In a 10x10 grid, the node at
top left will have index 91.
}
\examples{

   ## Deprecated - use Plot2DScatters instead ##
 
   # Read from file, build self-organizing map and minimal spanning tree
   fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
   flowSOM.res <- ReadInput(fileName, compensate = TRUE, transform = TRUE,
                            scale = TRUE)
   flowSOM.res <- BuildSOM(flowSOM.res, colsToUse = c(9, 12, 14:18))
  flowSOM.res <- BuildMST(flowSOM.res)
   
   # Plot cells
   \dontrun{
   Plot2DScatters(flowSOM.res, c(1, 2), clusters = 91)
   }

}
\seealso{
\code{\link{PlotNumbers}}, \code{\link{PlotCenters}},
         \code{\link{BuildMST}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{SOM}
\alias{SOM}
\title{Build a self-organizing map}
\usage{
SOM(
  data,
  xdim = 10,
  ydim = 10,
  rlen = 10,
  mst = 1,
  alpha = c(0.05, 0.01),
  radius = stats::quantile(nhbrdist, 0.67) * c(1, 0),
  init = FALSE,
  initf = Initialize_KWSP,
  distf = 2,
  silent = FALSE,
  codes = NULL,
  importance = NULL
)
}
\arguments{
\item{data}{Matrix containing the training data}

\item{xdim}{Width of the grid}

\item{ydim}{Hight of the grid}

\item{rlen}{Number of times to loop over the training data for each MST}

\item{mst}{Number of times to build an MST}

\item{alpha}{Start and end learning rate}

\item{radius}{Start and end radius}

\item{init}{Initialize cluster centers in a non-random way}

\item{initf}{Use the given initialization function if init == T
(default: Initialize_KWSP)}

\item{distf}{Distance function (1 = manhattan, 2 = euclidean, 3 = chebyshev, 
4 = cosine)}

\item{silent}{If FALSE, print status updates}

\item{codes}{Cluster centers to start with}

\item{importance}{array with numeric values. Parameters will be scaled 
according to importance}
}
\value{
A list containing all parameter settings and results
}
\description{
Build a self-organizing map
}
\references{
This code is strongly based on the \code{kohonen} package.
            R. Wehrens and L.M.C. Buydens, Self- and Super-organising Maps 
            in R: the kohonen package J. Stat. Softw., 21(5), 2007
}
\seealso{
\code{\link{BuildSOM}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{GroupStats}
\alias{GroupStats}
\title{GroupStats}
\usage{
GroupStats(features, groups)
}
\arguments{
\item{features}{Feature matrix as generated by \code{\link{GetFeatures}}, 
e.g. a percentages matrix}

\item{groups}{Named list with file or patient IDs per group (should match
with the rownames of the \code{matrix}).}
}
\value{
Matrix with the medians per group, the p-values (the raw, Benjamini 
Hochberg corrected one and the -log10) that resulted from a Wilcox test and 
the fold and log10 fold changes between the medians of the 2 groups
}
\description{
Calculate statistics between 2 groups based on the \code{\link{GetFeatures}}
output
}
\examples{
# Build FlowSom result
 fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
 ff <- flowCore::read.FCS(fileName)
 ff <- flowCore::compensate(ff, flowCore::keyword(ff)[["SPILL"]])
 ff <- flowCore::transform(ff,
         flowCore::transformList(colnames(flowCore::keyword(ff)[["SPILL"]]),
                                flowCore::logicleTransform()))
 flowSOM.res <- FlowSOM(ff, scale = TRUE, colsToUse = c(9, 12, 14:18),
                          nClus = 10)
   
# Create new data
# To illustrate the output, we here generate new fcs files (with more 
# cells in metaclusters 1 and 9).
# In practice you would not generate any new file but use your different
# files from your different groups
 flowCore::write.FCS(ff[sample(1:nrow(ff), 1000), ], file = "ff_tmp1.fcs")
 flowCore::write.FCS(ff[sample(1:nrow(ff), 1000), ], file = "ff_tmp2.fcs")
 flowCore::write.FCS(ff[sample(1:nrow(ff), 1000), ], file = "ff_tmp3.fcs")
 ff_tmp <- ff[c(1:1000,
                which(flowSOM.res$map$mapping[, 1] \%in\% 
                     which(flowSOM.res$metaclustering == 9)),
                which(flowSOM.res$map$mapping[, 1] \%in\% 
                     which(flowSOM.res$metaclustering == 1))), ]
 flowCore::write.FCS(ff_tmp[sample(1:nrow(ff_tmp), 1000), ],
                     file = "ff_tmp4.fcs")
 flowCore::write.FCS(ff_tmp[sample(1:nrow(ff_tmp), 1000), ], 
                     file = "ff_tmp5.fcs")
 
# Get the count matrix
 percentages <- GetFeatures(fsom = flowSOM.res, 
                            files = c("ff_tmp1.fcs", 
                                      "ff_tmp2.fcs", 
                                      "ff_tmp3.fcs",
                                      "ff_tmp4.fcs", 
                                      "ff_tmp5.fcs"), 
                            type = "percentages")
                       
  
# Perform the statistics
groups <- list("Group 1" = c("ff_tmp1.fcs", "ff_tmp2.fcs", "ff_tmp3.fcs"), 
               "Group 2" = c("ff_tmp4.fcs", "ff_tmp5.fcs"))
MC_stats <- GroupStats(percentages[["metacluster_percentages"]], groups)
C_stats <- GroupStats(percentages[["cluster_percentages"]], groups)

# Process the fold changes vector
fold_changes <- C_stats["fold changes", ]
fold_changes <- factor(ifelse(fold_changes < -3, 
                              "Underrepresented compared to Group 1",
                              ifelse(fold_changes > 3, 
                                     "Overrepresented compared to Group 1",
                                      "--")), 
                        levels = c("--", 
                                   "Underrepresented compared to Group 1",
                                   "Overrepresented compared to Group 1"))
fold_changes[is.na(fold_changes)] <- "--"

# Show in figure
## Fold change
gr_1 <- PlotStars(flowSOM.res, 
                  title = "Group 1", 
                  nodeSizes = C_stats["medians Group 1", ], 
                  list_insteadof_ggarrange = TRUE)
gr_2 <- PlotStars(flowSOM.res, title = "Group 2", 
            nodeSizes = C_stats["medians Group 2", ], 
            backgroundValues = fold_changes,
            backgroundColors = c("white", "red", "blue"), 
            list_insteadof_ggarrange = TRUE)
p <- ggpubr::ggarrange(plotlist = c(list(gr_1$tree), gr_2),
                       heights = c(3, 1))
ggplot2::ggsave("Groups_foldchanges.pdf", p, width = 10)

## p values
p <- PlotVariable(flowSOM.res, title = "Wilcox test group 1 vs. group 2",
variable = C_stats["p values", ])
ggplot2::ggsave("Groups_pvalues.pdf", p)

## volcano plot
p <- ggplot2::ggplot(data.frame("-log10 p values" = c(C_stats[4, ], 
                                                      MC_stats[4, ]), 
                                "log10 fold changes" = c(C_stats[7, ],
                                                         MC_stats[7, ]), 
check.names = FALSE), ggplot2::aes(x = `log10 fold changes`, 
                                   y = `-log10 p values`)) +
ggplot2::xlim(-3, 3) +
ggplot2::ylim(0, 3) +
ggplot2::geom_point() 

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/0_FlowSOM.R
\name{PlotFileScatters}
\alias{PlotFileScatters}
\title{PlotFileScatters}
\usage{
PlotFileScatters(
  input,
  channels = NULL,
  yMargin = NULL,
  yLabel = c("marker"),
  quantiles = NULL,
  names = NULL,
  groups = NULL,
  color = NULL,
  legend = FALSE,
  maxPoints = 50000,
  ncol = NULL,
  nrow = NULL,
  silent = FALSE,
  plotFile = "FileScatters.png"
)
}
\arguments{
\item{input}{Either a flowSet, a flowFrame (output from the 
\code{\link{AggregateFlowFrames}} function) or a 
vector of paths pointing to fcs files}

\item{channels}{Vector of channels or markers that need to be plotted, 
if NULL (default), all channels from the input will be 
plotted}

\item{yMargin}{Optional parameter to specify the margins of the 
y-axis}

\item{yLabel}{Determines the label of the y-axis. Can be "marker" and\\or
"channel". Default = "marker".}

\item{quantiles}{If provided (default NULL), a numeric vector with values
between 0 and 1. These quantiles are indicated on the plot}

\item{names}{Optional parameter to provide filenames. If \code{NULL} 
(default), the filenames will be numbers. Duplicated 
filenames will be made unique.}

\item{groups}{Optional parameter to specify groups of files, should have
the same length as the \code{input}. Id \code{NULL} 
(default), all files will be plotted in the same color}

\item{color}{Optional parameter to provide colors. Should have the same
lengths as the number of groups (or 1 if \code{groups} is 
\code{NULL})}

\item{legend}{Logical parameter to specify whether the group levels 
should be displayed. Default is \code{FALSE}}

\item{maxPoints}{Total number of data points that will be plotted per 
channel, default is 50000}

\item{ncol}{Number of columns in the final plot, optional}

\item{nrow}{Number of rows in the final plot, optional}

\item{silent}{If FALSE, prints an update every time it starts processing 
a new file. Default = FALSE.}

\item{plotFile}{Path to png file, default is "FileScatters.png". If 
\code{NULL}, the output will be a list of ggplots}
}
\value{
List of ggplot objects if \code{plot} is \code{FALSE}, 
        otherwise \code{filePlot} with plot is created.
}
\description{
Make a scatter plot per channel for all provided files
}
\examples{
# Preprocessing
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
ff <- flowCore::read.FCS(fileName)
ff <- flowCore::compensate(ff, flowCore::keyword(ff)[["SPILL"]])
ff <- flowCore::transform(ff,
         flowCore::transformList(colnames(flowCore::keyword(ff)[["SPILL"]]),
                                flowCore::logicleTransform()))

flowCore::write.FCS(ff[1:1000, ], file = "ff_tmp1.fcs")
flowCore::write.FCS(ff[1001:2000, ], file = "ff_tmp2.fcs")
flowCore::write.FCS(ff[2001:3000, ], file = "ff_tmp3.fcs")
 
# Make plot
PlotFileScatters(input = c("ff_tmp1.fcs", "ff_tmp2.fcs", "ff_tmp3.fcs"),
                 channels = c("Pacific Blue-A", 
                              "Alexa Fluor 700-A", 
                              "PE-Cy7-A"), 
                 maxPoints = 1000)

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{Dist.MST}
\alias{Dist.MST}
\title{Calculate distance matrix using a minimal spanning tree neighbourhood}
\usage{
Dist.MST(X)
}
\arguments{
\item{X}{matrix in which each row represents a point}
}
\value{
Distance matrix
}
\description{
Calculate distance matrix using a minimal spanning tree neighbourhood
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6_deprecated.R
\name{GetCVs}
\alias{GetCVs}
\title{Get CV values for all clusters}
\usage{
GetCVs(fsom)
}
\arguments{
\item{fsom}{FlowSOM object as generated by the FlowSOM function
or the BuildSOM function}
}
\value{
Matrix with coefficient of variation values for each marker

fileName <- system.file("extdata", "68983.fcs", package="FlowSOM")
flowSOM.res <- FlowSOM(fileName, compensate=TRUE,transform=TRUE,
                      scale=TRUE,colsToUse=c(9,12,14:18),nClus=10)
cvs <- GetClusterCVs(flowSOM.res)
}
\description{
Get CV values for all clusters
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{ParseQuery}
\alias{ParseQuery}
\title{ParseQuery}
\usage{
ParseQuery(fsom, query)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{FlowSOM}}}

\item{query}{Array containing "high" or "low" for the specified 
column names of the FlowSOM data}
}
\value{
A list, containing the ids of the selected nodes, the individual  
        scores for all nodes and the scores for each marker for each node
}
\description{
Parses query
}
\details{
Identify nodes in the tree which resemble a certain profile of "high" 
or "low" marker expressions.
}
\seealso{
\code{\link{PlotFlowSOM}}, \code{\link{ParseEdges}}, 
\code{\link{ParseNodeSize}}, \code{\link{ParseArcs}},
\code{\link{QueryStarPlot}}, \code{\link{ParseSD}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/0_FlowSOM.R
\name{GetFlowJoLabels}
\alias{GetFlowJoLabels}
\title{Process a flowjo workspace file}
\usage{
GetFlowJoLabels(
  files,
  wspFile,
  group = "All Samples",
  cellTypes = NULL,
  getData = FALSE,
  ...
)
}
\arguments{
\item{files}{The fcs files of interest}

\item{wspFile}{The FlowJo wsp file to read}

\item{group}{The FlowJo group to parse. Default "All Samples".}

\item{cellTypes}{Cell types to use for final labeling the cells. Should
correspond with a subset of the gate names in FlowJo.}

\item{getData}{If true, flowframes are returned as well.}

\item{...}{Extra arguments to pass to CytoML::flowjo_to_gatingset}
}
\value{
This function returns a list, which for every file contains a list
in which the first element ("matrix") is a matrix containing filtering 
results for each specified gate and the second element ("manual") is a vector
which assigns one label to each cell. If only one file is given, only one
list is returned instead of a list of lists.
}
\description{
Reads a flowjo workspace file using the \code{\link{flowWorkspace}} library 
and returns a list with a matrix containing gating results and a vector with 
a label for each cell from a set of specified gates
}
\examples{

# Identify the files
fcs_file <- system.file("extdata", "68983.fcs", package = "FlowSOM")
wspFile <- system.file("extdata", "gating.wsp", package = "FlowSOM")

# Specify the cell types of interest for assigning one label per cell
cellTypes <- c("B cells",
                "gd T cells", "CD4 T cells", "CD8 T cells",
                "NK cells", "NK T cells")

# Parse the FlowJo workspace   
gatingResult <- GetFlowJoLabels(fcs_file, wspFile,
                                cellTypes = cellTypes,
                                getData = TRUE)

# Check the number of cells assigned to each gate
colSums(gatingResult$matrix)

# Build a FlowSOM tree
flowSOM.res <- FlowSOM(gatingResult$flowFrame,
                       colsToUse = c(9, 12, 14:18),
                       nClus = 10,
                       seed = 1)
   
 # Plot pies indicating the percentage of cell types present in the nodes
 PlotPies(flowSOM.res,
          gatingResult$manual,
          backgroundValues = flowSOM.res$metaclustering)

}
\seealso{
\code{\link{PlotPies}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{ScaleStarHeights}
\alias{ScaleStarHeights}
\title{ScaleStarHeights}
\usage{
ScaleStarHeights(data, nodeSizes)
}
\arguments{
\item{data}{MedianValues of relevant markers extraced from 
FlowSOM object}

\item{nodeSizes}{A vector that is returned from \code{ParseNodeSize}}
}
\value{
A dataframe consisting of the scaled values of the stars. 
        The stars are scaled between 0 and the maximum of all stars
}
\description{
Scales starheights
}
\details{
Function that scales the star values between 0 and the node size
}
\seealso{
\code{\link{PlotFlowSOM}}, \code{\link{ParseNodeSize}}, 
\code{\link{AutoMaxNodeSize}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{FlowSOMmary}
\alias{FlowSOMmary}
\title{FlowSOMmary}
\usage{
FlowSOMmary(fsom, plotFile = "FlowSOMmary.pdf")
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{FlowSOM}}}

\item{plotFile}{Name of the pdf file that will be generated (default is 
FlowSOMmary.pdf). If \code{NULL}, a list of ggplots will 
be returned.}
}
\value{
Returns a summary of the FlowSOM object
}
\description{
This functions plots a summary of a flowSOM object. It includes a table of 
(meta)cluster data, the flowSOM trees and grid view, the (meta)cluster 
labels, the markers expression, the file distribution if present,
the cluster per metacluster percentage, a t-SNE plot,
and the MFI per metacluster.
}
\examples{
# Identify the files
fcs <- flowCore::read.FCS(system.file("extdata", "68983.fcs", 
                                      package = "FlowSOM"))

# Build a FlowSOM object
flowSOM.res <- FlowSOM(fcs, 
                       scale = TRUE,
                       compensate = TRUE, 
                       transform = TRUE,
                       toTransform = 8:18, 
                       colsToUse = c(9, 12, 14:18),
                       nClus = 10,
                       seed = 1)
                       
FlowSOMmary(flowSOM.res)

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{PlotNumbers}
\alias{PlotNumbers}
\title{PlotNumbers}
\usage{
PlotNumbers(fsom, level = "clusters", maxNodeSize = 0, ...)
}
\arguments{
\item{fsom}{FlowSOM object}

\item{level}{Character string, should be either "clusters" or 
"metaclusters"}

\item{maxNodeSize}{Determines the maximum nodesize. Default is 0. 
See \code{\link{PlotFlowSOM}} for more options.}

\item{...}{Additional arguments to pass to \code{\link{PlotLabels}} 
and to \code{\link{PlotFlowSOM}}}
}
\value{
Nothing is returned. A plot is drawn in which each node is 
labeled by its cluster id.
}
\description{
Plot cluster ids for each cluster
}
\details{
Plot FlowSOM grid or tree, with in each node the cluster id.
}
\examples{
# Read from file, build self-organizing map and minimal spanning tree
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
ff <- flowCore::read.FCS(fileName)
ff <- flowCore::compensate(ff, flowCore::keyword(ff)[["SPILL"]])
ff <- flowCore::transform(ff, flowCore::estimateLogicle(ff,
                                               flowCore::colnames(ff)[8:18]))
flowSOM.res <- FlowSOM(ff,
                       scale = TRUE,
                       colsToUse = c(9, 12, 14:18),
                       nClus = 10,
                       seed = 1)

# Plot the node IDs
PlotNumbers(flowSOM.res)
PlotNumbers(flowSOM.res, "metaclusters")

PlotNumbers(flowSOM.res,
            view = "grid")

PlotNumbers(flowSOM.res,
            maxNodeSize = 1,
            equalNodeSize = TRUE)

}
\seealso{
\code{\link{PlotStars}}, \code{\link{PlotVariable}},
\code{\link{PlotFlowSOM}}, \code{\link{PlotLabels}}, 
\code{\link{PlotMarker}}, \code{\link{PlotPies}},
 \code{\link{QueryStarPlot}}, \code{\link{PlotSD}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{UpdateFlowSOM}
\alias{UpdateFlowSOM}
\title{UpdateFlowSOM}
\usage{
UpdateFlowSOM(fsom)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{BuildMST}} or
\code{\link{FlowSOM}}}
}
\value{
A FlowSOM object
}
\description{
Update old FlowSOM object to a new one and checks if it is a flowSOM object
}
\details{
Determines whether or not the fsom input is of class "FlowSOM" and returns  
the FlowSOM object and metaclustering object inside fsom
}
\seealso{
\code{\link{PlotFlowSOM}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utils-pipe.R
\name{\%>\%}
\alias{\%>\%}
\title{Pipe operator}
\usage{
lhs \%>\% rhs
}
\description{
See \code{magrittr::\link[magrittr:pipe]{\%>\%}} for details.
}
\keyword{internal}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{PlotManualBars}
\alias{PlotManualBars}
\title{PlotManualBars}
\usage{
PlotManualBars(
  fsom,
  fcs = NULL,
  manualVector,
  manualOrder = NULL,
  colors = NULL,
  list_insteadof_plots = FALSE
)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{FlowSOM}} or 
by \code{\link{NewData}}. The clusters and metaclsuters 
will be plotted in the order of the factor levels.}

\item{fcs}{Fcs file that should be mapped on the FlowSOM object.
Default is NULL.}

\item{manualVector}{Vector with cell labels, e.g. obtained by manual gating}

\item{manualOrder}{Optional vector with unique cell labels to fix in which
order the cell labels should be shown}

\item{colors}{Optional color vector, should have the same length as
the number of unque cell labels}

\item{list_insteadof_plots}{If \code{FALSE} (default), it returns multiple 
plots. If \code{TRUE}, it returns a list of 
ggplot objects}
}
\value{
Either a plot or a ggplot objects list is returned.
}
\description{
Function to plot the manual labels per FlowSOM (meta)cluster in a barplot
}
\examples{
# Identify the files
fcs_file <- system.file("extdata", "68983.fcs", package = "FlowSOM")
wsp_file <- system.file("extdata", "gating.wsp", package = "FlowSOM")

# Specify the cell types of interest for assigning one label per cell
cellTypes <- c("B cells",
                "gd T cells", "CD4 T cells", "CD8 T cells",
                "NK cells", "NK T cells")
                
# Parse the FlowJo workspace   
library(flowWorkspace)             
gatingResult <- GetFlowJoLabels(fcs_file, wsp_file,
                                cellTypes = cellTypes)               

# Build a FlowSOM object
flowSOM.res <- FlowSOM(fcs_file,
                       scale = TRUE,
                       compensate = TRUE, 
                       transform = TRUE,
                       toTransform = 8:18, 
                       colsToUse = c(9, 12, 14:18),
                       nClus = 10,
                       seed = 1)

# Make the barplot of the manual labels
pdf("PlotManualBars.pdf")
PlotManualBars(fsom = flowSOM.res,
               fcs = fcs_file,
               manualVector = gatingResult$manual,
               manualOrder = c(cellTypes, "Unlabeled"),
               colors = c("#F8766D", "#B79F00", "#00BA38", "#00BFC4", 
                          "#619CFF", "#F564E3", "#D3D3D3"))
dev.off()

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{AddStars}
\alias{AddStars}
\title{AddStars}
\usage{
AddStars(p, fsom, markers = fsom$map$colsUsed, colorPalette = NULL)
}
\arguments{
\item{p}{GGplot object}

\item{fsom}{FlowSOM object, as generated by \code{\link{BuildMST}}}

\item{markers}{Determines which markers to plot. 
Default = "fsom$map$colsUsed"}

\item{colorPalette}{ColorPalette to be used for colors. Can be either a 
function or an array specifying colors.}
}
\value{
ggplot object with the stars added
}
\description{
Function plots the stars
}
\seealso{
\code{\link{PlotFlowSOM}}, \code{\link{AddLabels}},
\code{\link{AddNodes}}, \code{\link{AddBackground}}, \code{\link{PlotStars}},
\code{\link{AddPies}}, \code{\link{ParseArcs}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{SaveClustersToFCS}
\alias{SaveClustersToFCS}
\title{Write FlowSOM clustering results to the original FCS files}
\usage{
SaveClustersToFCS(
  fsom,
  originalFiles,
  preprocessedFiles = NULL,
  selectionColumn = NULL,
  silent = FALSE,
  outputDir = ".",
  suffix = "_FlowSOM.fcs"
)
}
\arguments{
\item{fsom}{FlowSOM object as generated by BuildSOM}

\item{originalFiles}{FCS files that should be extended}

\item{preprocessedFiles}{FCS files that correspond to the input of FlowSOM,
If NULL (default), the originalFiles are used.}

\item{selectionColumn}{Column of the FCS file indicating the original cell
ids. If NULL (default), no selection is made.}

\item{silent}{If FALSE (default), print some extra output}

\item{outputDir}{Directory to save the fcs files. Default to the
current working directory (".")}

\item{suffix}{Suffix added to the filename. Default _FlowSOM.fcs}
}
\value{
Saves the extended fcs file as [originalName]_FlowSOM.fcs
}
\description{
Write FlowSOM clustering results to the original FCS files
}
\examples{
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
flowSOM.res <- FlowSOM(fileName, compensate = TRUE, transform = TRUE,
                      scale = TRUE, colsToUse = c(9, 12, 14:18), nClus = 10)
SaveClustersToFCS(flowSOM.res, fileName)

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6_deprecated.R
\name{PlotCenters}
\alias{PlotCenters}
\title{PlotCenters}
\usage{
PlotCenters(fsom, marker1, marker2, MST = TRUE)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{BuildMST}}}

\item{marker1}{Marker to show on the x-axis}

\item{marker2}{Marker to show on the y-axis}

\item{MST}{Type of visualization, if 1 plot tree, else plot grid}
}
\value{
Nothing is returned. A 2D scatter plot is drawn on which the nodes 
        of the grid are indicated
}
\description{
Plot cluster centers on a 2D plot
}
\details{
Plot FlowSOM nodes on a 2D scatter plot of the data
}
\examples{
   # Read from file, build self-organizing map and minimal spanning tree
   fileName <- system.file("extdata", "68983.fcs", package="FlowSOM")
   flowSOM.res <- ReadInput(fileName, compensate=TRUE,transform=TRUE,
                            scale=TRUE)
   flowSOM.res <- BuildSOM(flowSOM.res,colsToUse=c(9,12,14:18))
   flowSOM.res <- BuildMST(flowSOM.res)
   
   # Plot centers
   plot <- Plot2DScatters(flowSOM.res,
                  channelpairs = list(c("FSC-A","SSC-A")),
                  clusters = list(seq_len(NClusters(flowSOM.res))),
                  maxPoints = 0,
                  plotFile = NULL)

}
\seealso{
\code{\link{PlotStars}},\code{\link{PlotPies}},
         \code{\link{PlotMarker}},\code{\link{BuildMST}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6_deprecated.R
\name{get_channels}
\alias{get_channels}
\title{get_channels}
\usage{
get_channels(ff, markers)
}
\arguments{
\item{ff}{The flowFrame of interest}

\item{markers}{Vector with markers or channels of interest}
}
\value{
Corresponding channel names
}
\description{
Get channel names for an array of markers, given a flowframe
}
\examples{

   # Read the flowFrame
   fileName <- system.file("extdata", "68983.fcs", package="FlowSOM")
   ff <- flowCore::read.FCS(fileName)
   GetChannels(ff, c("FSC-A", "CD3", "FITC-A"))
   GetMarkers(ff, c("FSC-A", "CD3", "FITC-A"))

}
\seealso{
\code{\link{get_markers}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{AddBackground}
\alias{AddBackground}
\title{AddBackground}
\usage{
AddBackground(
  p,
  backgroundValues,
  backgroundColors = NULL,
  backgroundLim = NULL
)
}
\arguments{
\item{p}{GGplot object}

\item{backgroundValues}{Vector of values to be plotted as background for 
the nodes}

\item{backgroundColors}{Colorpalette for backgroundcolors}

\item{backgroundLim}{Background limits (can be used to ensure consistent
colorpalette between plots). If NULL (default), will
be automatically adapted to the data.}
}
\value{
Returns nothing, but plots the background
}
\description{
Function plots the background
}
\seealso{
\code{\link{PlotFlowSOM}}, \code{\link{AddLabels}},
\code{\link{AddNodes}}, \code{\link{AddPies}}, \code{\link{AddStars}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/4_metaClustering.R
\name{FMeasure}
\alias{FMeasure}
\title{F measure}
\usage{
FMeasure(realClusters, predictedClusters, silent = FALSE)
}
\arguments{
\item{realClusters}{Array containing real cluster labels for each sample}

\item{predictedClusters}{Array containing predicted cluster labels for each
sample}

\item{silent}{Logical, if FALSE (default), print some information about 
precision and recall}
}
\value{
F measure score
}
\description{
Compute the F measure between two clustering results
}
\examples{
# Generate some random data as an example
realClusters <- sample(1:5,100,replace = TRUE)
predictedClusters <- sample(1:6, 100, replace = TRUE)

# Calculate the FMeasure
FMeasure(realClusters,predictedClusters)
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6_deprecated.R
\name{MetaclusterCVs}
\alias{MetaclusterCVs}
\title{MetaclusterCVs}
\usage{
MetaclusterCVs(fsom)
}
\arguments{
\item{fsom}{Result of calling the FlowSOM function}
}
\value{
Metacluster CVs
}
\description{
Compute the coefficient of variation for the metaclusters
}
\examples{
fileName <- system.file("extdata", "68983.fcs", package="FlowSOM")
ff <- flowCore::read.FCS(fileName)
ff <- flowCore::compensate(ff,ff@description$SPILL)
ff <- flowCore::transform(ff,
         flowCore::transformList(colnames(ff@description$SPILL),
                                flowCore::logicleTransform()))
flowSOM.res <- FlowSOM(ff,scale=TRUE,colsToUse=c(9,12,14:18), nClus=10)
cvs <- GetMetaclusterCVs(flowSOM.res)
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{PlotPies}
\alias{PlotPies}
\title{PlotPies}
\usage{
PlotPies(
  fsom,
  cellTypes,
  colorPalette = grDevices::colorRampPalette(c("white", "#00007F", "blue", "#007FFF",
    "cyan", "#7FFF7F", "yellow", "#FF7F00", "red", "#7F0000")),
  ...
)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{FlowSOM}}}

\item{cellTypes}{Array of factors indicating the celltypes}

\item{colorPalette}{Color palette to use.}

\item{...}{Additional arguments to pass to \code{\link{PlotFlowSOM}}}
}
\value{
Ggplot plot
}
\description{
Plot comparison with other clustering
}
\details{
Plot FlowSOM grid or tree, with pies indicating another clustering
   or manual gating result
}
\examples{
# Identify the files
fcs_file <- system.file("extdata", "68983.fcs", package = "FlowSOM")
wsp_file <- system.file("extdata", "gating.wsp", package = "FlowSOM")

# Specify the cell types of interest for assigning one label per cell
cellTypes <- c("B cells",
                "gd T cells", "CD4 T cells", "CD8 T cells",
                "NK cells", "NK T cells")

# Parse the FlowJo workspace     
gatingResult <- GetFlowJoLabels(fcs_file, wsp_file,
                                cellTypes = cellTypes)

# Check the number of cells assigned to each gate
colSums(gatingResult$matrix)

# Build a FlowSOM tree
flowSOM.res <- FlowSOM(fcs_file,
                       scale = TRUE, 
                       compensate = TRUE, 
                       transform = TRUE,
                       toTransform = 8:18, 
                       colsToUse = c(9, 12, 14:18),
                       nClus = 10,
                       seed = 1)
   
 # Plot pies indicating the percentage of cell types present in the nodes
 PlotPies(flowSOM.res,
          gatingResult$manual,
          backgroundValues = flowSOM.res$metaclustering)
          
}
\seealso{
\code{\link{PlotStars}}, \code{\link{PlotVariable}},
\code{\link{PlotFlowSOM}}, \code{\link{PlotLabels}}, 
\code{\link{PlotNumbers}}, \code{\link{PlotMarker}},
 \code{\link{QueryStarPlot}}, \code{\link{PlotSD}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{AutoMaxNodeSize}
\alias{AutoMaxNodeSize}
\title{AutoMaxNodeSize}
\usage{
AutoMaxNodeSize(layout, overlap)
}
\arguments{
\item{layout}{Coordinates of nodes}

\item{overlap}{Parameter that determines how much overlap there 
will be. If negative the nodes will be smaller}
}
\value{
Returns the maxNodeSize with some overlap
}
\description{
Calculate node size
}
\details{
Function that calculates the minimum distance between the nodes
to use this to adapt the maxNodeSize for better plotting
}
\seealso{
\code{\link{PlotFlowSOM}}, \code{\link{ScaleStarHeights}}, 
\code{\link{ParseNodeSize}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6_deprecated.R
\name{get_markers}
\alias{get_markers}
\title{get_markers}
\usage{
get_markers(ff, markers)
}
\arguments{
\item{ff}{The flowFrame of interest}

\item{markers}{Vector with markers or channels of interest}
}
\value{
Corresponding marker names
}
\description{
Get marker names, given a flowframe. As available in "desc". If this is NA,
defaults to channel name.
}
\examples{

   # Read the flowFrame
   fileName <- system.file("extdata", "68983.fcs", package="FlowSOM")
   ff <- flowCore::read.FCS(fileName)
   GetChannels(ff, c("FSC-A", "CD3", "FITC-A"))
   GetMarkers(ff, c("FSC-A", "CD3", "FITC-A"))

}
\seealso{
\code{\link{get_channels}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{AddPies}
\alias{AddPies}
\title{AddPies}
\usage{
AddPies(p, fsom, cellLabels, layout = NULL, colorPalette = NULL)
}
\arguments{
\item{p}{GGplot object}

\item{fsom}{FlowSOM object, as generated by \code{\link{BuildMST}}}

\item{cellLabels}{Array of factors indicating the cell labels}

\item{layout}{Coordinates of nodes. Uses dataframe of the ggplot 
object if NULL.}

\item{colorPalette}{ColorPalette to be used for colors. Can be either a 
function or an array specifying colors.}
}
\value{
ggplot object with the pies added
}
\description{
Function plots the pies
}
\seealso{
\code{\link{PlotFlowSOM}}, \code{\link{AddLabels}},
\code{\link{AddNodes}}, \code{\link{AddBackground}}, \code{\link{PlotPies}},
\code{\link{AddStars}}, \code{\link{ParseArcs}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/0_FlowSOM.R
\name{AggregateFlowFrames}
\alias{AggregateFlowFrames}
\title{Aggregate multiple fcs files together}
\usage{
AggregateFlowFrames(
  fileNames,
  cTotal,
  channels = NULL,
  writeOutput = FALSE,
  outputFile = "aggregate.fcs",
  keepOrder = FALSE,
  silent = FALSE,
  ...
)
}
\arguments{
\item{fileNames}{Character vector containing full paths to the fcs files
to aggregate}

\item{cTotal}{Total number of cells to write to the output file}

\item{channels}{Channels/markers to keep in the aggregate. Default NULL 
takes all channels of the first file.}

\item{writeOutput}{Whether to write the resulting flowframe to a file. 
Default FALSE}

\item{outputFile}{Full path to output file. Default "aggregate.fcs"}

\item{keepOrder}{If TRUE, the random subsample will be ordered in the same
way as they were originally ordered in the file. Default =
FALSE.}

\item{silent}{If FALSE, prints an update every time it starts processing a
new file. Default = FALSE.}

\item{...}{Additional arguments to pass to read.FCS}
}
\value{
This function does not return anything, but will write a file with
        about \code{cTotal} cells to \code{outputFile}
}
\description{
Aggregate multiple fcs files to analyze them simultaneously. 
A new fcs file is written, which contains about \code{cTotal} cells,
with \code{ceiling(cTotal/nFiles)} cells from each file. Two new columns
are added: a column indicating the original file by index, and a noisy 
version of this for better plotting opportunities (index plus or minus a 
value between 0 and 0.1).
}
\examples{
# Define filename
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
# This example will sample 2 times 500 cells.
ff_new <- AggregateFlowFrames(c(fileName, fileName), 1000)

}
\seealso{
\code{\link{ceiling}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/4_metaClustering.R
\name{GetMetaclusterMFIs}
\alias{GetMetaclusterMFIs}
\title{GetMetaclusterMFIs}
\usage{
GetMetaclusterMFIs(fsom, colsUsed = FALSE, prettyColnames = FALSE)
}
\arguments{
\item{fsom}{Result of calling the FlowSOM function}

\item{colsUsed}{Logical. Should report only the columns used to 
build the SOM. Default = FALSE.}

\item{prettyColnames}{Logical. Should report pretty column names instead
of standard column names. Default = FALSE.}
}
\value{
Metacluster MFIs
}
\description{
Compute the median fluorescence intensities for the metaclusters
}
\examples{
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
ff <- flowCore::read.FCS(fileName)
ff <- flowCore::compensate(ff, flowCore::keyword(ff)[["SPILL"]])
ff <- flowCore::transform(ff,
         flowCore::transformList(colnames(flowCore::keyword(ff)[["SPILL"]]),
                                flowCore::logicleTransform()))
flowSOM.res <- FlowSOM(ff,
                       scale = TRUE,
                       colsToUse = c(9, 12, 14:18),
                       nClus = 10)
mfis <- GetMetaclusterMFIs(flowSOM.res)
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/0_FlowSOM.R
\name{GetMarkers}
\alias{GetMarkers}
\title{GetMarkers}
\usage{
GetMarkers(object, channels, exact = TRUE)
}
\arguments{
\item{object}{The flowFrame or the FlowSOM object of interest}

\item{channels}{Vector with markers or channels of interest. Also accepts the
index of the channel in the object.}

\item{exact}{If TRUE (default), the grep pattern will be extended to
start with ^\\\\Q and end with \\\\E$, so only exact matches 
are possible.}
}
\value{
Corresponding marker names
}
\description{
Get marker names for an array of channels, given a flowframe or a FlowSOM 
object. As available in "desc". If this is NA, defaults to channel name. 
\code{\link{grep}} is used to look for the markers. Other regex can be added.
}
\examples{

   # Read the flowFrame
   fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
   ff <- flowCore::read.FCS(fileName)
   GetChannels(ff, c("FSC-A", "CD3", "FITC-A"))
   GetMarkers(ff, c("FSC-A", "CD3", "FITC-A"))

}
\seealso{
\code{\link{GetChannels}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{PlotStarLegend}
\alias{PlotStarLegend}
\title{PlotStarLegend}
\usage{
PlotStarLegend(markers, colors, starHeight = 1)
}
\arguments{
\item{markers}{Vector of markers used in legend}

\item{colors}{ColorPalette for the legend. Can be a vector or a 
function.}

\item{starHeight}{Star height. Default = 1.}
}
\value{
Returns nothing, but plots a legend for FlowSOM star plot
}
\description{
Plots star legend
}
\details{
Function makes the legend of the FlowSOM star plot
}
\examples{
PlotStarLegend(c("CD3", "CD4", "CD8"),
               FlowSOM_colors(3))

}
\seealso{
\code{\link{PlotFlowSOM}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/3_buildMST.R
\name{NewData}
\alias{NewData}
\title{NewData}
\usage{
NewData(
  fsom,
  input,
  madAllowed = 4,
  compensate = NULL,
  spillover = NULL,
  transform = NULL,
  toTransform = NULL,
  transformFunction = NULL,
  transformList = NULL,
  scale = NULL,
  scaled.center = NULL,
  scaled.scale = NULL,
  silent = FALSE
)
}
\arguments{
\item{fsom}{FlowSOM object}

\item{input}{A flowFrame, a flowSet or an array of paths to files 
or directories}

\item{madAllowed}{A warning is generated if the distance of the new
data points to their closest cluster center is too
big. This is computed based on the typical distance
of the points from the original dataset assigned to
that cluster, the threshold being set to
median + madAllowed * MAD. Default is 4.}

\item{compensate}{logical, does the data need to be compensated. If NULL,
the same value as in the original FlowSOM call will be 
used.}

\item{spillover}{spillover matrix to compensate with. If NULL,
the same value as in the original FlowSOM call will be 
used.}

\item{transform}{logical, does the data need to be transformed. If NULL,
the same value as in the original FlowSOM call will be 
used.}

\item{toTransform}{column names or indices that need to be transformed.
If NULL,  the same value as in the original FlowSOM 
call will be used.}

\item{transformFunction}{If NULL, the same value as in the original FlowSOM 
call will be used.}

\item{transformList}{If NULL, the same value as in the original FlowSOM 
call will be used.}

\item{scale}{Logical, does the data needs to be rescaled. If NULL, 
the same value as in the original FlowSOM call will be 
used.}

\item{scaled.center}{See \code{\link{scale}}. If NULL, the same value as in 
the original FlowSOM call will be used.}

\item{scaled.scale}{See \code{\link{scale}}. If NULL, the same value as in 
the original FlowSOM call will be used.}

\item{silent}{Logical. If \code{TRUE}, print progress messages. 
Default = \code{FALSE}.}
}
\value{
A new FlowSOM object
}
\description{
Map new data to a FlowSOM grid
}
\details{
New data is mapped to an existing FlowSOM object. The input is similar to the
readInput function.
A new FlowSOM object is created, with the same grid, but a new
mapping, node sizes and mean values. The same preprocessing steps
(compensation, tranformation and scaling) will happen to this file as was 
specified in the original FlowSOM call. The scaling parameters from the 
original grid will be used.
}
\examples{
 # Build FlowSom result
 fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
 ff <- flowCore::read.FCS(fileName)
 ff <- flowCore::compensate(ff, flowCore::keyword(ff)[["SPILL"]])
 ff <- flowCore::transform(ff,
         flowCore::transformList(colnames(flowCore::keyword(ff)[["SPILL"]]),
                                flowCore::logicleTransform()))
   flowSOM.res <- FlowSOM(ff[1:1000, ], 
                          scale = TRUE, 
                          colsToUse = c(9, 12, 14:18),
                          nClus = 10)
   
   # Map new data
   fSOM2 <- NewData(flowSOM.res, ff[1001:2000, ])

}
\seealso{
\code{\link{FlowSOMSubset}} if you want to get a subset of the
         current data instead of a new dataset
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{AddMST}
\alias{AddMST}
\title{AddMST}
\usage{
AddMST(p, fsom)
}
\arguments{
\item{p}{GGplot object}

\item{fsom}{FlowSOM object, as generated by \code{\link{FlowSOM}}}
}
\value{
Returns nothing, but plots the MST for FlowSOM MST view
}
\description{
Function plots the MST
}
\seealso{
\code{\link{PlotFlowSOM}}, \code{\link{ParseEdges}}, 
\code{\link{AddStarsPies}}, \code{\link{AddLabels}}, \code{\link{AddNodes}},
\code{\link{AddBackground}}, \code{\link{AddPies}}, \code{\link{AddStars}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{gg_color_hue}
\alias{gg_color_hue}
\title{gg_color_hue}
\usage{
gg_color_hue(n)
}
\arguments{
\item{n}{Number of colors}
}
\value{
array with hexadecimal color values
}
\description{
Helper function to get the ggplot colors
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6_deprecated.R
\name{UpdateNodeSize}
\alias{UpdateNodeSize}
\title{UpdateNodeSize}
\usage{
UpdateNodeSize(
  fsom,
  count = NULL,
  reset = FALSE,
  transform = sqrt,
  maxNodeSize = 15,
  shift = 0,
  scale = NULL
)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{BuildMST}}}

\item{count}{Absolute cell count of the sample}

\item{reset}{Logical. If \code{TRUE}, all nodes get the same size}

\item{transform}{Transformation function. Use e.g. square root to let counts
correspond with area of node instead of radius}

\item{maxNodeSize}{Maximum node size after rescaling. Default: 15}

\item{shift}{Shift of the counts, defaults to 0}

\item{scale}{Scaling of the counts, defaults to the maximum of the value
minus the shift. With shift and scale set as default, the 
largest node will be maxNodesize and an empty node will have
size 0}
}
\value{
Updated FlowSOM object
}
\description{
Update nodesize of FlowSOM object
}
\details{
Add size property to the graph based on cellcount for each node
}
\examples{
# Read from file, build self-organizing map and minimal spanning tree
fileName <- system.file("extdata", "68983.fcs", package="FlowSOM")
flowSOM.res <- ReadInput(fileName, compensate=TRUE,transform=TRUE,
                        scale=TRUE)
flowSOM.res <- BuildSOM(flowSOM.res,colsToUse=c(9,12,14:18))
flowSOM.res <- BuildMST(flowSOM.res)

# Give all nodes same size
PlotStars(flowSOM.res, equalNodeSize = TRUE)

# Node sizes relative to amount of cells assigned to the node
PlotStars(flowSOM.res)

}
\seealso{
\code{\link{BuildMST}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/0_FlowSOM.R
\name{ManualVector}
\alias{ManualVector}
\title{Summarise the gating matrix into one vector, only including the cell types of
interest}
\usage{
ManualVector(manualMatrix, cellTypes)
}
\arguments{
\item{manualMatrix}{Matrix containing boolean values, indicating for every
gate (column) whether the cell (row) is part of it or not.}

\item{cellTypes}{Cell types to use in the summary vector. All others will be
ignored and cells which do not fall in one of these gates
will get the label "Unknown". Order is important!}
}
\value{
A factor with one label for every cell
}
\description{
Extract the compensated and transformed data and all gate labels.
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{AddScale}
\alias{AddScale}
\title{AddScale}
\usage{
AddScale(
  p,
  values = NULL,
  colors = NULL,
  limits = NULL,
  showLegend = TRUE,
  labelLegend = "",
  type = "fill"
)
}
\arguments{
\item{p}{ggplot object}

\item{values}{Values used for the fill}

\item{colors}{Colors to use (can be a vector or a function)}

\item{limits}{Limits to use in the scale}

\item{showLegend}{Boolean on whether to show the legend}

\item{labelLegend}{Label to show as title of the legend}

\item{type}{fill (default) or color}
}
\value{
ggplot object with scale added
}
\description{
AddScale
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/0_FlowSOM.R
\name{GetChannels}
\alias{GetChannels}
\title{GetChannels}
\usage{
GetChannels(object, markers, exact = TRUE)
}
\arguments{
\item{object}{The flowFrame or the FlowSOM object of interest}

\item{markers}{Vector with markers or channels of interest. Also accepts the
index of the marker found in the object.}

\item{exact}{If TRUE (default), the grep pattern will be extended to
start with ^\\\\Q and end with \\\\E$, so only exact matches 
are possible.}
}
\value{
Corresponding channel names
}
\description{
Get channel names for an array of markers, given a flowframe or a FlowSOM
object. As available in "name". \code{\link{grep}} is used to look for the 
markers. Other regex can be added.
}
\examples{

   # Read the flowFrame
   fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
   ff <- flowCore::read.FCS(fileName)
   GetChannels(ff, c("FSC-A", "CD3", "FITC-A"))
   GetMarkers(ff, c("FSC-A", "CD3", "FITC-A"))

}
\seealso{
\code{\link{GetMarkers}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{BuildSOM}
\alias{BuildSOM}
\title{Build a self-organizing map}
\usage{
BuildSOM(fsom, colsToUse = NULL, silent = FALSE, outlierMAD = 4, ...)
}
\arguments{
\item{fsom}{FlowSOM object containing the data, as constructed by 
the \code{\link{ReadInput}} function}

\item{colsToUse}{Markers, channels or indices to use for building the SOM}

\item{silent}{if \code{TRUE}, no progress updates will be printed}

\item{outlierMAD}{Number of MAD when a cell is considered an outlier.
See also \code{\link{TestOutliers}}}

\item{...}{options to pass on to the SOM function (xdim, ydim, rlen, 
mst, alpha, radius, init, distf, importance)}
}
\value{
FlowSOM object containing the SOM result, which can be used as input
        for the \code{\link{BuildMST}} function
}
\description{
Build a SOM based on the data contained in the FlowSOM object
}
\examples{

# Read from file
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
flowSOM.res <- ReadInput(fileName, compensate = TRUE, transform = TRUE,
                         scale = TRUE)

# Build the Self-Organizing Map
# E.g. with gridsize 5x5, presenting the dataset 20 times, 
# no use of MST in neighbourhood calculations in between
flowSOM.res <- BuildSOM(flowSOM.res, colsToUse = c(9, 12, 14:18),
                        xdim = 5, ydim = 5, rlen = 20)

# Build the minimal spanning tree and apply metaclustering
flowSOM.res <- BuildMST(flowSOM.res)
metacl <- MetaClustering(flowSOM.res$map$codes,
                         "metaClustering_consensus", max = 10)

}
\references{
This code is strongly based on the \code{kohonen} package.
            R. Wehrens and L.M.C. Buydens, Self- and Super-organising Maps 
            in R: the kohonen package J. Stat. Softw., 21(5), 2007
}
\seealso{
\code{\link{ReadInput}}, \code{\link{BuildMST}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6_deprecated.R
\name{CountGroups}
\alias{CountGroups}
\title{Calculate differences in cell counts between groups}
\usage{
CountGroups(fsom, groups, plot = TRUE, silent = FALSE)
}
\arguments{
\item{fsom}{FlowSOM object as generated by BuildSOM}

\item{groups}{List containing an array with file names for each group}

\item{plot}{Logical. If TRUE, make a starplot of each individual file}

\item{silent}{Logical. If TRUE, print progress messages}
}
\value{
Distance matrix
}
\description{
Calculate differences in cell counts between groups
}
\examples{
set.seed(1)
fileName <-  system.file("extdata", "68983.fcs", package="FlowSOM")
flowSOM.res <- FlowSOM(fileName, compensate = TRUE, transform = TRUE,
                      scale = TRUE, colsToUse = c(9,12,14:18), nClus = 10)

ff <- flowCore::read.FCS(fileName)
# Make an additional file without cluster 7 and double amount of cluster 5
selection <- c(which(GetClusters(flowSOM.res) \%in\% 
                                 which(flowSOM.res$metaclustering != 7)),
                 which(GetClusters(flowSOM.res) \%in\% 
                                 which(flowSOM.res$metaclustering == 5)))
ff_tmp <- ff[selection,]
flowCore::write.FCS(ff_tmp, file="ff_tmp.fcs")

# Compare only the file with the double amount of cluster 10
features <- GetFeatures(flowSOM.res, 
                        c(fileName, "ff_tmp.fcs"),
                        level = "clusters",
                        type = "percentages")
stats <- GroupStats(features$cluster_percentages,                     
                    groups = list("AllCells" = c(fileName),
                                  "Without_ydTcells" = c("ff_tmp.fcs")))

}
\seealso{
Groupstats
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{PlotMarker}
\alias{PlotMarker}
\title{PlotMarker}
\usage{
PlotMarker(
  fsom,
  marker,
  refMarkers = fsom$map$colsUsed,
  title = GetMarkers(fsom, marker),
  colorPalette = FlowSOM_colors,
  lim = NULL,
  ...
)
}
\arguments{
\item{fsom}{FlowSOM object}

\item{marker}{A vector of markers/channels to plot.}

\item{refMarkers}{Is used to determine relative scale of the marker 
that will be plotted. Default are all markers used in the
clustering.}

\item{title}{A vector with custom titles for the plot. Default is 
the marker name.}

\item{colorPalette}{Colorpalette to use. Can be a function or a vector.}

\item{lim}{Limits for the scale}

\item{...}{Additional arguments to pass to \code{\link{PlotFlowSOM}},
e.g. view, backgroundValues, equalNodeSize ...}
}
\value{
A ggplot figure is returned in which every cluster is colored
        according to the MFI value for the specified marker
}
\description{
Plot comparison with other clustering
}
\details{
Plot FlowSOM grid or tree, coloured by node values for a specific marker
}
\examples{
# Build FlowSOM model
fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
flowSOM.res <- FlowSOM(fileName, 
                       compensate = TRUE, transform = TRUE, scale = FALSE,
                       colsToUse = c(9, 12, 14:18),
                       nClus = 10,
                       seed = 1)
# Plot one marker
PlotMarker(flowSOM.res, 
           "CD19")
           
PlotMarker(flowSOM.res, 
           "CD19",
           colorPalette = c("grey", "red"))
           
# Plot all markers
PlotMarker(flowSOM.res,
           c(9, 12, 14:18))

# Use specific limits if the ones from the columns used for clustering
# are not relevant for  your marker of choice
PlotMarker(flowSOM.res, 
           "FSC-A",
            lim = c(55000, 130000))

# Example with additional FlowSOM plotting options
PlotMarker(flowSOM.res, 
           "CD19",
           view = "grid",
           equalNodeSize = TRUE,
           backgroundValues = 1:100 == 27,
           backgroundColors = c("white", "red"))
           
           
}
\seealso{
\code{\link{PlotStars}}, \code{\link{PlotVariable}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/6_deprecated.R
\name{PlotOverview2D}
\alias{PlotOverview2D}
\title{PlotOverview2D}
\usage{
PlotOverview2D(fsom, markerlist, metaclusters, colors = NULL, ff, ...)
}
\arguments{
\item{fsom}{FlowSOM object, as generated by \code{\link{FlowSOM}}.
If using a FlowSOM object as generated by 
\code{\link{BuildMST}}, it needs to be wrapped in a list,
list(FlowSOM = fsom, metaclustering = metaclustering).}

\item{markerlist}{List in which each element is a pair of marker names}

\item{metaclusters}{Metaclusters of interest}

\item{colors}{Named vector with color value for each metacluster. 
If NULL (default) colorbrewer "paired" is interpolated}

\item{ff}{flowFrame to use as reference for the marker names}

\item{...}{Other parameters to pass on to PlotClusters2D}
}
\value{
Nothing is returned, but a plot is drawn for every markerpair and
        every metacluster. The individual cells are colored, and the 
        center of each FlowSOM cluster is indicated with a blue cross.
}
\description{
Plot metaclusters on scatter plots
}
\details{
Write multiple 2D scatter plots to a png file. 
All cells of fsom$data are plotted in black, and those of the selected 
metaclusters are plotted in color.
}
\examples{

   ## Deprecated - use Plot2DScatters instead ##

   # Read from file, build self-organizing map and minimal spanning tree
   fileName <- system.file("extdata", "68983.fcs", package = "FlowSOM")
   flowSOM.res <- FlowSOM(fileName, 
                          compensate = TRUE, transform = TRUE, scale = TRUE,
                          colsToUse = c(9, 12, 14:18),
                          nClus = 10,
                          seed = 1)
                          
   # Plot cells
   markers_of_interest = list(c("FSC-A", "SSC-A"),
                              c("CD3", "CD19"),
                              c("TCRb", "TCRyd"),
                              c("CD4", "CD8"))
   metaclusters_of_interest = 1:10
   
   # Recommended to write to png
   
   \dontrun{
     png("Markeroverview.png",
         width = 500 * length(markers_of_interest),
         height = 500 * length(metaclusters_of_interest))
     Plot2DScatters(flowSOM.res,
                    channelpairs = markers_of_interest,
                    metaclusters = metaclusters_of_interest)
     dev.off()
   }

}
\seealso{
\code{\link{PlotClusters2D}}
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2_buildSOM.R
\name{MapDataToCodes}
\alias{MapDataToCodes}
\title{Assign nearest node to each datapoint}
\usage{
MapDataToCodes(codes, newdata, distf = 2)
}
\arguments{
\item{codes}{matrix with nodes of the SOM}

\item{newdata}{datapoints to assign}

\item{distf}{Distance function (1 = manhattan, 2 = euclidean, 3 = chebyshev, 
4 = cosine)}
}
\value{
Array with nearest node id for each datapoint
}
\description{
Assign nearest node to each datapoint
}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{Plot2DScatters}
\alias{Plot2DScatters}
\title{Plot2DScatters}
\usage{
Plot2DScatters(
  fsom,
  channelpairs,
  clusters = NULL,
  metaclusters = NULL,
  maxBgPoints = 3000,
  sizeBgPoints = 0.5,
  maxPoints = 1000,
  sizePoints = 0.5,
  xLim = NULL,
  yLim = NULL,
  density = TRUE,
  centers = TRUE,
  color = NULL,
  plotFile = "2DScatterPlots.png"
)
}
\arguments{
\item{fsom}{FlowSOM object, as created by \code{\link{FlowSOM}}}

\item{channelpairs}{List in which each element is a pair of channel
or marker names}

\item{clusters}{Vector or list (to combine multiple clusters in one
plot) with clusters of interest}

\item{metaclusters}{Vector or list (to combine multiple metaclusters in 
one plot) with metaclusters of interest}

\item{maxBgPoints}{Maximum number of background cells to plot}

\item{sizeBgPoints}{Size of the background cells}

\item{maxPoints}{Maximum number of (meta)cluster cells to plot}

\item{sizePoints}{Size of the (meta)cluster cells}

\item{xLim}{A vector of a lower and upper limit of the x-axis}

\item{yLim}{A vector of a lower and upper limit of the y-axis}

\item{density}{Default is \code{TRUE} to color the (meta)cluster 
points according to density. Set to \code{FALSE} to 
use a plain color}

\item{centers}{Default is \code{TRUE} to show the cluster centers}

\item{color}{Colors for all the cells in the selected nodes 
(ordered list). If  \code{NULL} the default ggplot 
colors, indexed by metacluster number are used.}

\item{plotFile}{If a filepath for a png is given (default = 
2DScatterPlots.png), the plots will be plotted in 
the corresponding png file. If \code{NULL}, a list 
of ggplot objects will be returned}
}
\value{
If \code{plot} is \code{TRUE}, nothing is returned and a plot is 
        drawn in which background cells are plotted in grey and the cells of
        the selected nodes in color. If \code{plot} is \code{FALSE}, a ggplot
         objects list is returned.
}
\description{
Function to draw 2D scatter plots of FlowSOM (meta)clusters
}
\details{
Plot multiple 2D scatter plots in a png file. A subset of fsom$data is 
plotted in grey, and those of the selected clusters and metaclusters are 
plotted in color.
}
\examples{
# Identify the files
fcs <- flowCore::read.FCS(system.file("extdata", "68983.fcs", 
                                      package = "FlowSOM"))

# Build a FlowSOM object
flowSOM.res <- FlowSOM(fcs, 
                       scale = TRUE,
                       compensate = TRUE, 
                       transform = TRUE,
                       toTransform = 8:18, 
                       colsToUse = c(9, 12, 14:18),
                       nClus = 10,
                       seed = 1)

# Make the 2D scatter plots of the clusters and metaclusters of interest
Plot2DScatters(fsom = flowSOM.res,
               channelpairs = list(c("PE-Cy7-A", "PE-Cy5-A"),
                                   c("PE-Texas Red-A", "Pacific Blue-A")),
               clusters = c(1, 48, 49, 82, 95),
               metaclusters = list(c(1, 4), 9),
               density = FALSE)
               
Plot2DScatters(fsom = flowSOM.res,
               channelpairs = list(c("PE-Texas Red-A", "Pacific Blue-A")),
               metaclusters = list(c(1, 4)),
               density = FALSE,
               color = list(c("red", "green")))

}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5_plotFunctions.R
\name{AddStarsPies}
\alias{AddStarsPies}
\title{AddStarsPies}
\usage{
AddStarsPies(p, arcs, colorPalette, showLegend = TRUE)
}
\arguments{
\item{p}{ggplot object}

\item{arcs}{Dataframe that contains all the data for the plotting 
the pies or stars}

\item{colorPalette}{A vector of colors or a color function}

\item{showLegend}{Boolean on whether to show the legend}
}
\value{
Returns nothing, but plots the stars or pies
}
\description{
Function plots stars or pies
}
\seealso{
\code{\link{PlotFlowSOM}}, \code{\link{AddLabels}},
\code{\link{AddNodes}}, \code{\link{AddBackground}}, \code{\link{AddPies}},
\code{\link{AddStars}}, \code{\link{ParseArcs}}, \code{\link{PlotStars}}
\code{\link{PlotPies}}
}
